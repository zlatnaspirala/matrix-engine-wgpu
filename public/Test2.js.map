{
  "version": 3,
  "sources": ["../node_modules/src/utils.ts", "../node_modules/src/vec2.ts", "../node_modules/src/vec3.ts", "../node_modules/src/vec2-impl.ts", "../node_modules/src/mat3-impl.ts", "../node_modules/src/vec3-impl.ts", "../node_modules/src/mat4-impl.ts", "../node_modules/src/quat.ts", "../node_modules/src/quat-impl.ts", "../node_modules/src/vec4.ts", "../node_modules/src/vec4-impl.ts", "../node_modules/src/wgpu-matrix.ts", "../src/engine/utils.js", "../src/engine/engine.js", "../src/engine/matrix-class.js", "../src/shaders/vertex.wgsl.js", "../src/shaders/fragment.wgsl.js", "../src/shaders/fragment.wgsl.metal.js", "../src/shaders/fragment.wgsl.normalmap.js", "../src/shaders/fragment.wgsl.pong.js", "../src/shaders/fragment.wgsl.power.js", "../src/shaders/mixed/fragmentMix1.wgsl.js", "../src/shaders/water/water-c.wgls.js", "../src/engine/materials.js", "../src/shaders/fragment.video.wgsl.js", "../src/shaders/vertex.wgsl.normalmap.js", "../src/shaders/topology-point/pointEffect.js", "../src/engine/effects/topology-point.js", "../src/shaders/gizmo/gimzoShader.js", "../src/engine/effects/gizmo.js", "../src/shaders/desctruction/dust-shader.wgsl.js", "../src/engine/effects/destruction.js", "../src/shaders/flame-effect/flameEffect.js", "../src/engine/effects/flame.js", "../src/shaders/flame-effect/flame-instanced.js", "../src/engine/effects/flame-emmiter.js", "../src/engine/mesh-obj.js", "../src/physics/matrix-ammo.js", "res/multilang/en-backup.js", "../src/multilang/lang.js", "../src/sounds/sounds.js", "../src/engine/loader-obj.js", "../src/shaders/vertexShadow.wgsl.js", "../src/engine/behavior.js", "../src/shaders/instanced/vertexShadow.instanced.wgsl.js", "../src/engine/lights.js", "../node_modules/src/utils.ts", "../node_modules/src/vec2.ts", "../node_modules/src/vec2-impl.ts", "../node_modules/src/mat3-impl.ts", "../node_modules/src/vec3.ts", "../node_modules/src/vec3-impl.ts", "../node_modules/src/mat4-impl.ts", "../node_modules/src/vec4-impl.ts", "../node_modules/src/wgpu-matrix.ts", "../node_modules/bvh-loader/module/bvh-loader.js", "../node_modules/bvh-loader/index.js", "../node_modules/gl-matrix/esm/common.js", "../node_modules/gl-matrix/esm/mat4.js", "../src/engine/loaders/webgpu-gltf.js", "../src/engine/loaders/bvh.js", "../src/shaders/standalone/pointer.effect.js", "../src/engine/effects/pointerEffect.js", "../src/shaders/instanced/fragment.instanced.wgsl.js", "../src/engine/instanced/materials-instanced.js", "../src/shaders/instanced/vertex.instanced.wgsl.js", "../src/engine/geometry-factory.js", "../src/shaders/standalone/geo.instanced.js", "../src/engine/effects/gen.js", "../src/shaders/energy-bars/energy-bar-shader.js", "../src/engine/effects/energy-bar.js", "../src/engine/effects/mana-bar.js", "../src/shaders/standalone/geo.tex.js", "../src/engine/effects/gen-tex.js", "../src/engine/effects/gen-tex2.js", "../src/engine/instanced/mesh-obj-instances.js", "../src/engine/loaders/bvh-instaced.js", "../src/engine/plugin/tooltip/ToolTip.js", "../src/tools/editor/client.js", "../src/tools/editor/editor.provider.js", "../src/tools/editor/flexCodexShaderAdapter.js", "../src/tools/editor/flexCodexShader.js", "../src/tools/editor/curve-editor.js", "../src/tools/editor/generateAISchema.js", "../src/tools/editor/fluxCodexVertex.js", "../src/tools/editor/hud.js", "../src/tools/editor/methodsManager.js", "../src/tools/editor/editor.js", "../src/engine/postprocessing/bloom.js", "../src/engine/raycast.js", "../src/engine/generators/generator.js", "../src/engine/core-cache.js", "../src/sounds/audioAsset.js", "../src/engine/postprocessing/volumetric.js", "../src/world.js", "../projects/Test2/graph.js", "../projects/Test2/shader-graphs.js", "../projects/Test2/app-gen.js"],
  "sourcesContent": ["/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nexport let EPSILON = 0.000001;\n\n/**\n * Set the value for EPSILON for various checks\n * @param v - Value to use for EPSILON.\n * @returns previous value of EPSILON;\n */\nexport function setEpsilon(v: number): number {\n  const old = EPSILON;\n  EPSILON = v;\n  return old;\n}\n\n/**\n * Convert degrees to radians\n * @param degrees - Angle in degrees\n * @returns angle converted to radians\n */\nexport function degToRad(degrees: number): number {\n  return degrees * Math.PI / 180;\n}\n\n/**\n * Convert radians to degrees\n * @param radians - Angle in radians\n * @returns angle converted to degrees\n */\nexport function radToDeg(radians: number): number {\n  return radians * 180 / Math.PI;\n}\n\n/**\n * Lerps between a and b via t\n * @param a - starting value\n * @param b - ending value\n * @param t - value where 0 = a and 1 = b\n * @returns a + (b - a) * t\n */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/**\n * Compute the opposite of lerp. Given a and b and a value between\n * a and b returns a value between 0 and 1. 0 if a, 1 if b.\n * Note: no clamping is done.\n * @param a - start value\n * @param b - end value\n * @param v - value between a and b\n * @returns (v - a) / (b - a)\n */\nexport function inverseLerp(a: number, b: number, v: number): number {\n  const d = b - a;\n  return (Math.abs(b - a) < EPSILON)\n     ? a\n     : (v - a) / d;\n}\n\n/**\n * Compute the euclidean modulo\n *\n * ```\n * // table for n / 3\n * -5, -4, -3, -2, -1,  0,  1,  2,  3,  4,  5   <- n\n * ------------------------------------\n * -2  -1  -0  -2  -1   0,  1,  2,  0,  1,  2   <- n % 3\n *  1   2   0   1   2   0,  1,  2,  0,  1,  2   <- euclideanModule(n, 3)\n * ```\n *\n * @param n - dividend\n * @param m - divisor\n * @returns the euclidean modulo of n / m\n */\nexport function euclideanModulo(n: number, m: number) {\n  return ((n % m) + m) % m;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 2 values, Float32Array with 2 values, or a Float64Array with 2 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec2.setDefaultType}.\n */\nexport type Vec2 = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Vec2 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new Vec2. In other words you can do this\n *\n *     const v = vec2.cross(v1, v2);  // Creates a new Vec2 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec2.create();\n *     vec2.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec2.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec2 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec2\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Vec2\n */\nexport function setDefaultType(ctor: new (n: number) => Vec2) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values.\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Vec2's specified type\n * it would be faster to use\n *\n * ```\n * const v = vec2.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Vec2Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `vec2.create` is usually used\n * to create a Vec2 to be filled out as in\n *\n * ```\n * const sum = vec2.create();\n * vec2.add(v1, v2, sum);\n * ```\n *\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport function create(x = 0, y = 0): Vec2 {\n  const dst = new VecType(2);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n    }\n  }\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 3 values, Float32Array with 3 values, or a Float64Array with 3 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec3.setDefaultType}.\n */\nexport type Vec3 = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Vec3 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec3`. In other words you can do this\n *\n *     const v = vec3.cross(v1, v2);  // Creates a new Vec3 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec3.create();\n *     vec3.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec3.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec3 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec3\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Vec3\n */\nexport function setDefaultType(ctor: new (n: number) => Vec3) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number): Vec3 {\n  const dst = new VecType(3);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Vec2, create, setDefaultType, VecType } from './vec2';\nimport { Vec3, VecType as Vec3Type } from './vec3';\n\nexport default Vec2;\nexport { create, setDefaultType };\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Vec2\n * Also see {@link vec2.create} and {@link vec2.copy}\n *\n * @param x first value\n * @param y second value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = x;\n  dst[1] = y;\n\n  return dst;\n}\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec2, min = 0, max = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec2, b: Vec2, scale: number, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec2, b: Vec2): number {\n  const ax = a[0];\n  const ay = a[1];\n  const bx = a[0];\n  const by = a[1];\n  const mag1 = Math.sqrt(ax * ax + ay * ay);\n  const mag2 = Math.sqrt(bx * bx + by * by);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec2, b: Vec2): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec2, b: Vec2): boolean {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec2, b: Vec2, t: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec2, b: Vec2, t: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec2, b: Vec2, dst?: Vec3): Vec3 {\n  dst = dst || new Vec3Type(3);\n  const z = a[0] * b[1] - a[1] * b[0];\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = z;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec2, b: Vec2): number {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return Math.sqrt(v0 * v0 + v1 * v1);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return v0 * v0 + v1 * v1;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return dx * dx + dy * dy;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const len = Math.sqrt(v0 * v0 + v1 * v1);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as {@link vec2.clone})\n * Also see {@link vec2.create} and {@link vec2.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as {@link vec2.copy})\n * Also see {@link vec2.create} and {@link vec2.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec2, b: Vec2, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random unit vector * scale\n * @param scale - Default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const angle = Math.random() * 2 * Math.PI;\n  dst[0] = Math.cos(angle) * scale;\n  dst[1] = Math.sin(angle) * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 0;\n  dst[1] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform Vec2 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec2, m: Mat4, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = x * m[0] + y * m[4] + m[12];\n  dst[1] = x * m[1] + y * m[5] + m[13];\n\n  return dst;\n}\n\n/**\n * Transforms vec4 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec2, m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = m[0] * x + m[4] * y + m[8];\n  dst[1] = m[1] * x + m[5] * y + m[9];\n\n  return dst;\n}\n\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport * as utils from './utils.js';\nimport { Quat } from './quat';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport Vec2, * as vec2 from './vec2-impl';\n\nexport default Mat3;\n\nexport type Mat3LikeCtor = new (n: number) => Mat3;\n\n/**\n * 3x3 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat3.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat3.create();\n *     mat3.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat3.identity();\n *     const trans = mat3.translation([1, 2, 3]);\n *     mat3.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: Mat3LikeCtor = Float32Array;\n\n// This mess is because with Mat3 we have 3 unused elements.\n// For Float32Array and Float64Array that's not an issue\n// but for Array it's troublesome\nconst ctorMap = new Map<Mat3LikeCtor,() => Mat3>([\n  [Float32Array, () => new Float32Array(12)],\n  [Float64Array, () => new Float64Array(12)],\n  [Array, () => new Array(12).fill(0)],\n]);\nlet newMat3: () => Mat3 = ctorMap.get(Float32Array)!;\n\n/**\n * Sets the type this library creates for a Mat3\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Mat3\n */\nexport function setDefaultType(ctor: new (n: number) => Mat3) {\n  const oldType = MatType;\n  MatType = ctor;\n  newMat3 = ctorMap.get(ctor)!;\n  return oldType;\n}\n\n/**\n * Create a Mat3 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat3's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat3.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat3Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat3.create` is usually used\n * to create a Mat3 to be filled out as in\n *\n * ```\n * const m = mat3.create();\n * mat3.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @returns matrix created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number,\n    v3?: number, v4?: number, v5?: number,\n    v6?: number, v7?: number, v8?: number): Mat3 {\n  const dst = newMat3();\n  // to make the array homogenous\n  dst[3] = 0;\n  dst[7] = 0;\n  dst[11] = 0;\n\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[4] = v3;\n          if (v4 !== undefined) {\n            dst[5] = v4;\n            if (v5 !== undefined) {\n              dst[6] = v5;\n              if (v6 !== undefined) {\n                dst[8] = v6;\n                if (v7 !== undefined) {\n                  dst[9] = v7;\n                  if (v8 !== undefined) {\n                    dst[10] = v8;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return dst;\n}\n\n/**\n * Sets the values of a Mat3\n * Also see {@link mat3.create} and {@link mat3.copy}\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat3 set from values.\n */\nexport function set(\n    v0: number, v1: number, v2: number,\n    v3: number, v4: number, v5: number,\n    v6: number, v7: number, v8: number, dst?: Mat3) {\n  dst = dst || newMat3();\n\n  dst[0] = v0;  dst[1] = v1;  dst[ 2] = v2;  dst[ 3] = 0;\n  dst[4] = v3;  dst[5] = v4;  dst[ 6] = v5;  dst[ 7] = 0;\n  dst[8] = v6;  dst[9] = v7;  dst[10] = v8;  dst[11] = 0;\n\n  return dst;\n}\n\n/**\n * Creates a Mat3 from the upper left 3x3 part of a Mat4\n * @param m4 - source matrix\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat3 made from m4\n */\nexport function fromMat4(m4: Mat4, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n  dst[0] = m4[0];  dst[1] = m4[1];  dst[ 2] = m4[ 2];  dst[ 3] = 0;\n  dst[4] = m4[4];  dst[5] = m4[5];  dst[ 6] = m4[ 6];  dst[ 7] = 0;\n  dst[8] = m4[8];  dst[9] = m4[9];  dst[10] = m4[10];  dst[11] = 0;\n  return dst;\n}\n\n/**\n * Creates a Mat3 rotation matrix from a quaternion\n * @param q - quaternion to create matrix from\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat3 made from q\n */\nexport function fromQuat(q: Quat, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const x = q[0]; const y = q[1]; const z = q[2]; const w = q[3];\n  const x2 = x + x; const y2 = y + y; const z2 = z + z;\n\n  const xx = x * x2;\n  const yx = y * x2;\n  const yy = y * y2;\n  const zx = z * x2;\n  const zy = z * y2;\n  const zz = z * z2;\n  const wx = w * x2;\n  const wy = w * y2;\n  const wz = w * z2;\n\n  dst[ 0] = 1 - yy - zz;  dst[ 1] = yx + wz;      dst[ 2] = zx - wy;      dst[ 3] = 0;\n  dst[ 4] = yx - wz;      dst[ 5] = 1 - xx - zz;  dst[ 6] = zy + wx;      dst[ 7] = 0;\n  dst[ 8] = zx + wy;      dst[ 9] = zy - wx;      dst[10] = 1 - xx - yy;  dst[11] = 0;\n\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = -m[ 0];  dst[ 1] = -m[ 1];  dst[ 2] = -m[ 2];\n  dst[ 4] = -m[ 4];  dst[ 5] = -m[ 5];  dst[ 6] = -m[ 6];\n  dst[ 8] = -m[ 8];  dst[ 9] = -m[ 9];  dst[10] = -m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix. (same as {@link mat3.clone})\n * Also see {@link mat3.create} and {@link mat3.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = m[ 0];  dst[ 1] = m[ 1];  dst[ 2] = m[ 2];\n  dst[ 4] = m[ 4];  dst[ 5] = m[ 5];  dst[ 6] = m[ 6];\n  dst[ 8] = m[ 8];  dst[ 9] = m[ 9];  dst[10] = m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as {@link mat3.copy})\n * Also see {@link mat3.create} and {@link mat3.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat3, b: Mat3): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat3, b: Mat3): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10];\n}\n\n/**\n * Creates a 3-by-3 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 3-by-3 identity matrix.\n */\nexport function identity(dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;  dst[ 1] = 0;  dst[ 2] = 0;\n  dst[ 4] = 0;  dst[ 5] = 1;  dst[ 6] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n  if (dst === m) {\n    let t: number;\n\n    // 0 1 2\n    // 4 5 6\n    // 8 9 10\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  dst[ 0] = m00;  dst[ 1] = m10;  dst[ 2] = m20;\n  dst[ 4] = m01;  dst[ 5] = m11;  dst[ 6] = m21;\n  dst[ 8] = m02;  dst[ 9] = m12;  dst[10] = m22;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  const b01 =  m22 * m11 - m12 * m21;\n  const b11 = -m22 * m10 + m12 * m20;\n  const b21 =  m21 * m10 - m11 * m20;\n\n  const invDet = 1 / (m00 * b01 + m01 * b11 + m02 * b21);\n\n  dst[ 0] = b01 * invDet;\n  dst[ 1] = (-m22 * m01 + m02 * m21) * invDet;\n  dst[ 2] = ( m12 * m01 - m02 * m11) * invDet;\n  dst[ 4] = b11 * invDet;\n  dst[ 5] = ( m22 * m00 - m02 * m20) * invDet;\n  dst[ 6] = (-m12 * m00 + m02 * m10) * invDet;\n  dst[ 8] = b21 * invDet;\n  dst[ 9] = (-m21 * m00 + m01 * m20) * invDet;\n  dst[10] = ( m11 * m00 - m01 * m10) * invDet;\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat3): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  return m00 * (m11 * m22 - m21 * m12) -\n         m10 * (m01 * m22 - m21 * m02) +\n         m20 * (m01 * m12 - m11 * m02);\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat3, b: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22;\n\n  return dst;\n}\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 3-by-3 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n  }\n  dst[ 8] = v[0];\n  dst[ 9] = v[1];\n  dst[10] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 3-by-3 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  dst[0] = m[8];\n  dst[1] = m[9];\n  return dst;\n}\n\n/**\n * Returns an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y,\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat3, axis: number, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  return dst;\n}\n\n/**\n * Sets an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(m: Mat3, v: Vec2, axis: number, dst?: Mat3): Mat3 {\n  if (dst !== m) {\n    dst = copy(m, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const yx = m[4];\n  const yy = m[5];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy);\n  dst[1] = Math.sqrt(yx * yx + yy * yy);\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which translates by the given vector v.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;     dst[ 1] = 0;     dst[ 2] = 0;\n  dst[ 4] = 0;     dst[ 5] = 1;     dst[ 6] = 0;\n  dst[ 8] = v[0];  dst[ 9] = v[1];  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Translates the given 3-by-3 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n  }\n\n  dst[ 8] = m00 * v0 + m10 * v1 + m20;\n  dst[ 9] = m01 * v0 + m11 * v1 + m21;\n  dst[10] = m02 * v0 + m12 * v1 + m22;\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which rotates  by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotation(angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] =  c;  dst[ 1] = s;  dst[ 2] = 0;\n  dst[ 4] = -s;  dst[ 5] = c;  dst[ 6] = 0;\n  dst[ 8] =  0;  dst[ 9] = 0;  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 3-by-3 matrix  by the given angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotate(m: Mat3, angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     2 entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = v[0];  dst[ 1] = 0;     dst[ 2] = 0;\n  dst[ 4] = 0;     dst[ 5] = v[1];  dst[ 6] = 0;\n  dst[ 8] = 0;     dst[ 9] = 0;     dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 3-by-3 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of 2 entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which scales uniformly in each dimension\n * @param s - Amount to scale\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function uniformScaling(s: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = s;  dst[ 1] = 0;  dst[ 2] = 0;\n  dst[ 4] = 0;  dst[ 5] = s;  dst[ 6] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 3-by-3 matrix in each dimension by an amount\n * given.\n * @param m - The matrix to be modified.\n * @param s - Amount to scale.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function uniformScale(m: Mat3, s: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = s * m[0 * 4 + 0];\n  dst[ 1] = s * m[0 * 4 + 1];\n  dst[ 2] = s * m[0 * 4 + 2];\n\n  dst[ 4] = s * m[1 * 4 + 0];\n  dst[ 5] = s * m[1 * 4 + 1];\n  dst[ 6] = s * m[1 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Vec3, create, setDefaultType, VecType } from './vec3';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Quat } from './quat';\n\nexport default Vec3;\nexport { create, setDefaultType };\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Vec3\n * Also see {@link vec3.create} and {@link vec3.copy}\n *\n * @param x first value\n * @param y second value\n * @param z third value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, z: number, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = x;\n  dst[1] = y;\n  dst[2] = z;\n\n  return dst;\n}\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec3, min = 0, max = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec3, b: Vec3, scale: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec3, b: Vec3): number {\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const bx = a[0];\n  const by = a[1];\n  const bz = a[2];\n  const mag1 = Math.sqrt(ax * ax + ay * ay + az * az);\n  const mag2 = Math.sqrt(bx * bx + by * by + bz * bz);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec3, b: Vec3): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec3, b: Vec3): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec3, b: Vec3, t: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec3, b: Vec3, t: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const t1 = a[2] * b[0] - a[0] * b[2];\n  const t2 = a[0] * b[1] - a[1] * b[0];\n  dst[0] = a[1] * b[2] - a[2] * b[1];\n  dst[1] = t1;\n  dst[2] = t2;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec3, b: Vec3): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return v0 * v0 + v1 * v1 + v2 * v2;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return dx * dx + dy * dy + dz * dz;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n  }\n\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as {@link vec3.clone})\n * Also see {@link vec3.create} and {@link vec3.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as {@link vec3.copy})\n * Also see {@link vec3.create} and {@link vec3.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random vector\n * @param scale - Default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const angle = Math.random() * 2 * Math.PI;\n  const z = Math.random() * 2 - 1;\n  const zScale = Math.sqrt(1 - z * z) * scale;\n  dst[0] = Math.cos(angle) * zScale;\n  dst[1] = Math.sin(angle) * zScale;\n  dst[2] = z * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec3 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = (m[3] * x + m[7] * y + m[11] * z + m[15]) || 1;\n\n  dst[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  dst[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  dst[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n\n  return dst;\n}\n\n/**\n * Transform vec4 by upper 3x3 matrix inside 4x4 matrix.\n * @param v - The direction.\n * @param m - The matrix.\n * @param dst - optional Vec3 to store result. If not passed a new one is created.\n * @returns The transformed vector.\n */\nexport function transformMat4Upper3x3(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[0] = v0 * m[0 * 4 + 0] + v1 * m[1 * 4 + 0] + v2 * m[2 * 4 + 0];\n  dst[1] = v0 * m[0 * 4 + 1] + v1 * m[1 * 4 + 1] + v2 * m[2 * 4 + 1];\n  dst[2] = v0 * m[0 * 4 + 2] + v1 * m[1 * 4 + 2] + v2 * m[2 * 4 + 2];\n\n  return dst;\n}\n\n/**\n * Transforms vec3 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec3, m: Mat3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n\n  dst[0] = x * m[0] + y * m[4] + z * m[8];\n  dst[1] = x * m[1] + y * m[5] + z * m[9];\n  dst[2] = x * m[2] + y * m[6] + z * m[10];\n\n  return dst;\n}\n\n/**\n * Transforms vec3 by Quaternion\n * @param v - the vector to transform\n * @param q - the quaternion to transform by\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed\n */\nexport function transformQuat(v: Vec3, q: Quat, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const w2 = q[3] * 2;\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n\n  const uvX = qy * z - qz * y;\n  const uvY = qz * x - qx * z;\n  const uvZ = qx * y - qy * x;\n\n  dst[0] = x + uvX * w2 + (qy * uvZ - qz * uvY) * 2;\n  dst[1] = y + uvY * w2 + (qz * uvX - qx * uvZ) * 2;\n  dst[2] = z + uvZ * w2 + (qx * uvY - qy * uvX) * 2;\n\n  return dst;\n}\n\n/**\n * Returns the translation component of a 4-by-4 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat3, dst?: Vec3) {\n    dst = dst || new VecType(3);\n    dst[0] = m[12];\n    dst[1] = m[13];\n    dst[2] = m[14];\n    return dst;\n}\n/**\n * Returns an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y, 2 = z;\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat4, axis: number, dst?: Vec3) {\n    dst = dst || new VecType(3);\n    const off = axis * 4;\n    dst[0] = m[off + 0];\n    dst[1] = m[off + 1];\n    dst[2] = m[off + 2];\n    return dst;\n}\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat4, dst: Vec3) {\n    dst = dst || new VecType(3);\n    const xx = m[0];\n    const xy = m[1];\n    const xz = m[2];\n    const yx = m[4];\n    const yy = m[5];\n    const yz = m[6];\n    const zx = m[8];\n    const zy = m[9];\n    const zz = m[10];\n    dst[0] = Math.sqrt(xx * xx + xy * xy + xz * xz);\n    dst[1] = Math.sqrt(yx * yx + yy * yy + yz * yz);\n    dst[2] = Math.sqrt(zx * zx + zy * zy + zz * zz);\n    return dst;\n}", "\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Quat } from './quat';\nimport Vec3, * as vec3 from './vec3-impl';\nimport * as utils from './utils';\n\nexport default Mat4;\n\nexport type Mat4LikeCtor = new (n: number) => Mat4;\n\n/**\n * 4x4 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat4.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat4.create();\n *     mat4.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat4.identity();\n *     const trans = mat4.translation([1, 2, 3]);\n *     mat4.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: Mat4LikeCtor = Float32Array;\n\n/**\n * Sets the type this library creates for a Mat4\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Mat4\n */\nexport function setDefaultType(ctor: new (n: number) => Mat4) {\n  const oldType = MatType;\n  MatType = ctor;\n  return oldType;\n}\n\n/**\n * Create a Mat4 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat4's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat4.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat4Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat4.create` is usually used\n * to create a Mat4 to be filled out as in\n *\n * ```\n * const m = mat4.create();\n * mat4.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param v9 - value for element 9\n * @param v10 - value for element 10\n * @param v11 - value for element 11\n * @param v12 - value for element 12\n * @param v13 - value for element 13\n * @param v14 - value for element 14\n * @param v15 - value for element 15\n * @returns created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number, v3?: number,\n    v4?: number, v5?: number, v6?: number, v7?: number,\n    v8?: number, v9?: number, v10?: number, v11?: number,\n    v12?: number, v13?: number, v14?: number, v15?: number): Mat4 {\n  const dst = new MatType(16);\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[3] = v3;\n          if (v4 !== undefined) {\n            dst[4] = v4;\n            if (v5 !== undefined) {\n              dst[5] = v5;\n              if (v6 !== undefined) {\n                dst[6] = v6;\n                if (v7 !== undefined) {\n                  dst[7] = v7;\n                  if (v8 !== undefined) {\n                    dst[8] = v8;\n                    if (v9 !== undefined) {\n                      dst[9] = v9;\n                      if (v10 !== undefined) {\n                        dst[10] = v10;\n                        if (v11 !== undefined) {\n                          dst[11] = v11;\n                          if (v12 !== undefined) {\n                            dst[12] = v12;\n                            if (v13 !== undefined) {\n                              dst[13] = v13;\n                              if (v14 !== undefined) {\n                                dst[14] = v14;\n                                if (v15 !== undefined) {\n                                  dst[15] = v15;\n                                }\n                              }\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  return dst;\n}\n\n/**\n * Sets the values of a Mat4\n * Also see {@link mat4.create} and {@link mat4.copy}\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param v9 - value for element 9\n * @param v10 - value for element 10\n * @param v11 - value for element 11\n * @param v12 - value for element 12\n * @param v13 - value for element 13\n * @param v14 - value for element 14\n * @param v15 - value for element 15\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat4 created from values.\n */\nexport function set(\n    v0: number, v1: number, v2: number, v3: number,\n    v4: number, v5: number, v6: number, v7: number,\n    v8: number, v9: number, v10: number, v11: number,\n    v12: number, v13: number, v14: number, v15: number,\n    dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = v0;   dst[ 1] = v1;   dst[ 2] = v2;   dst[ 3] = v3;\n  dst[ 4] = v4;   dst[ 5] = v5;   dst[ 6] = v6;   dst[ 7] = v7;\n  dst[ 8] = v8;   dst[ 9] = v9;   dst[10] = v10;  dst[11] = v11;\n  dst[12] = v12;  dst[13] = v13;  dst[14] = v14;  dst[15] = v15;\n\n  return dst;\n}\n\n/**\n * Creates a Mat4 from a Mat3\n * @param m3 - source matrix\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat4 made from m3\n */\nexport function fromMat3(m3: Mat3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = m3[0];  dst[ 1] = m3[1];  dst[ 2] = m3[ 2];  dst[ 3] = 0;\n  dst[ 4] = m3[4];  dst[ 5] = m3[5];  dst[ 6] = m3[ 6];  dst[ 7] = 0;\n  dst[ 8] = m3[8];  dst[ 9] = m3[9];  dst[10] = m3[10];  dst[11] = 0;\n  dst[12] = 0;      dst[13] = 0;      dst[14] = 0;       dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a Mat4 rotation matrix from a quaternion\n * @param q - quaternion to create matrix from\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat4 made from q\n */\nexport function fromQuat(q: Quat, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const x = q[0]; const y = q[1]; const z = q[2]; const w = q[3];\n  const x2 = x + x; const y2 = y + y; const z2 = z + z;\n\n  const xx = x * x2;\n  const yx = y * x2;\n  const yy = y * y2;\n  const zx = z * x2;\n  const zy = z * y2;\n  const zz = z * z2;\n  const wx = w * x2;\n  const wy = w * y2;\n  const wz = w * z2;\n\n  dst[ 0] = 1 - yy - zz;  dst[ 1] = yx + wz;      dst[ 2] = zx - wy;      dst[ 3] = 0;\n  dst[ 4] = yx - wz;      dst[ 5] = 1 - xx - zz;  dst[ 6] = zy + wx;      dst[ 7] = 0;\n  dst[ 8] = zx + wy;      dst[ 9] = zy - wx;      dst[10] = 1 - xx - yy;  dst[11] = 0;\n  dst[12] = 0;            dst[13] = 0;            dst[14] = 0;            dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = -m[ 0];  dst[ 1] = -m[ 1];  dst[ 2] = -m[ 2];  dst[ 3] = -m[ 3];\n  dst[ 4] = -m[ 4];  dst[ 5] = -m[ 5];  dst[ 6] = -m[ 6];  dst[ 7] = -m[ 7];\n  dst[ 8] = -m[ 8];  dst[ 9] = -m[ 9];  dst[10] = -m[10];  dst[11] = -m[11];\n  dst[12] = -m[12];  dst[13] = -m[13];  dst[14] = -m[14];  dst[15] = -m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix. (same as {@link mat4.clone})\n * Also see {@link mat4.create} and {@link mat4.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = m[ 0];  dst[ 1] = m[ 1];  dst[ 2] = m[ 2];  dst[ 3] = m[ 3];\n  dst[ 4] = m[ 4];  dst[ 5] = m[ 5];  dst[ 6] = m[ 6];  dst[ 7] = m[ 7];\n  dst[ 8] = m[ 8];  dst[ 9] = m[ 9];  dst[10] = m[10];  dst[11] = m[11];\n  dst[12] = m[12];  dst[13] = m[13];  dst[14] = m[14];  dst[15] = m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as {@link mat4.copy})\n * Also see {@link mat4.create} and {@link mat4.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat4, b: Mat4): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 3] - b[ 3]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 7] - b[ 7]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON &&\n         Math.abs(a[11] - b[11]) < utils.EPSILON &&\n         Math.abs(a[12] - b[12]) < utils.EPSILON &&\n         Math.abs(a[13] - b[13]) < utils.EPSILON &&\n         Math.abs(a[14] - b[14]) < utils.EPSILON &&\n         Math.abs(a[15] - b[15]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat4, b: Mat4): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 3] === b[ 3] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 7] === b[ 7] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10] &&\n         a[11] === b[11] &&\n         a[12] === b[12] &&\n         a[13] === b[13] &&\n         a[14] === b[14] &&\n         a[15] === b[15];\n}\n\n/**\n * Creates a 4-by-4 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 4-by-4 identity matrix.\n */\nexport function identity(dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;  dst[ 1] = 0;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] = 1;  dst[ 6] = 0;  dst[ 7] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = 1;  dst[11] = 0;\n  dst[12] = 0;  dst[13] = 0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n  if (dst === m) {\n    let t;\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[3];\n    m[3] = m[12];\n    m[12] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    t = m[7];\n    m[7] = m[13];\n    m[13] = t;\n\n    t = m[11];\n    m[11] = m[14];\n    m[14] = t;\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  dst[ 0] = m00;  dst[ 1] = m10;  dst[ 2] = m20;  dst[ 3] = m30;\n  dst[ 4] = m01;  dst[ 5] = m11;  dst[ 6] = m21;  dst[ 7] = m31;\n  dst[ 8] = m02;  dst[ 9] = m12;  dst[10] = m22;  dst[11] = m32;\n  dst[12] = m03;  dst[13] = m13;  dst[14] = m23;  dst[15] = m33;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n  const tmp12 = m20 * m31;\n  const tmp13 = m30 * m21;\n  const tmp14 = m10 * m31;\n  const tmp15 = m30 * m11;\n  const tmp16 = m10 * m21;\n  const tmp17 = m20 * m11;\n  const tmp18 = m00 * m31;\n  const tmp19 = m30 * m01;\n  const tmp20 = m00 * m21;\n  const tmp21 = m20 * m01;\n  const tmp22 = m00 * m11;\n  const tmp23 = m10 * m01;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n      (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n      (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n      (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n      (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  const d = 1 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\n\n  dst[ 0] = d * t0;\n  dst[ 1] = d * t1;\n  dst[ 2] = d * t2;\n  dst[ 3] = d * t3;\n  dst[ 4] = d * ((tmp1 * m10 + tmp2 * m20 + tmp5 * m30) -\n          (tmp0 * m10 + tmp3 * m20 + tmp4 * m30));\n  dst[ 5] = d * ((tmp0 * m00 + tmp7 * m20 + tmp8 * m30) -\n          (tmp1 * m00 + tmp6 * m20 + tmp9 * m30));\n  dst[ 6] = d * ((tmp3 * m00 + tmp6 * m10 + tmp11 * m30) -\n          (tmp2 * m00 + tmp7 * m10 + tmp10 * m30));\n  dst[ 7] = d * ((tmp4 * m00 + tmp9 * m10 + tmp10 * m20) -\n          (tmp5 * m00 + tmp8 * m10 + tmp11 * m20));\n  dst[ 8] = d * ((tmp12 * m13 + tmp15 * m23 + tmp16 * m33) -\n          (tmp13 * m13 + tmp14 * m23 + tmp17 * m33));\n  dst[ 9] = d * ((tmp13 * m03 + tmp18 * m23 + tmp21 * m33) -\n          (tmp12 * m03 + tmp19 * m23 + tmp20 * m33));\n  dst[10] = d * ((tmp14 * m03 + tmp19 * m13 + tmp22 * m33) -\n          (tmp15 * m03 + tmp18 * m13 + tmp23 * m33));\n  dst[11] = d * ((tmp17 * m03 + tmp20 * m13 + tmp23 * m23) -\n          (tmp16 * m03 + tmp21 * m13 + tmp22 * m23));\n  dst[12] = d * ((tmp14 * m22 + tmp17 * m32 + tmp13 * m12) -\n          (tmp16 * m32 + tmp12 * m12 + tmp15 * m22));\n  dst[13] = d * ((tmp20 * m32 + tmp12 * m02 + tmp19 * m22) -\n          (tmp18 * m22 + tmp21 * m32 + tmp13 * m02));\n  dst[14] = d * ((tmp18 * m12 + tmp23 * m32 + tmp15 * m02) -\n          (tmp22 * m32 + tmp14 * m02 + tmp19 * m12));\n  dst[15] = d * ((tmp22 * m22 + tmp16 * m02 + tmp21 * m12) -\n          (tmp20 * m12 + tmp23 * m22 + tmp17 * m02));\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat4): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n             (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n             (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n             (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n             (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  return m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat4, b: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a03 = a[3];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a13 = a[ 4 + 3];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const a23 = a[ 8 + 3];\n  const a30 = a[12 + 0];\n  const a31 = a[12 + 1];\n  const a32 = a[12 + 2];\n  const a33 = a[12 + 3];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b03 = b[3];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b13 = b[ 4 + 3];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n  const b23 = b[ 8 + 3];\n  const b30 = b[12 + 0];\n  const b31 = b[12 + 1];\n  const b32 = b[12 + 2];\n  const b33 = b[12 + 3];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02 + a30 * b03;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02 + a31 * b03;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02 + a32 * b03;\n  dst[ 3] = a03 * b00 + a13 * b01 + a23 * b02 + a33 * b03;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12 + a30 * b13;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12 + a31 * b13;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12 + a32 * b13;\n  dst[ 7] = a03 * b10 + a13 * b11 + a23 * b12 + a33 * b13;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22 + a30 * b23;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22 + a31 * b23;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22 + a32 * b23;\n  dst[11] = a03 * b20 + a13 * b21 + a23 * b22 + a33 * b23;\n  dst[12] = a00 * b30 + a10 * b31 + a20 * b32 + a30 * b33;\n  dst[13] = a01 * b30 + a11 * b31 + a21 * b32 + a31 * b33;\n  dst[14] = a02 * b30 + a12 * b31 + a22 * b32 + a32 * b33;\n  dst[15] = a03 * b30 + a13 * b31 + a23 * b32 + a33 * b33;\n\n  return dst;\n}\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 4-by-4 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 3] = a[ 3];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n    dst[ 7] = a[ 7];\n    dst[ 8] = a[ 8];\n    dst[ 9] = a[ 9];\n    dst[10] = a[10];\n    dst[11] = a[11];\n  }\n  dst[12] = v[0];\n  dst[13] = v[1];\n  dst[14] = v[2];\n  dst[15] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 4-by-4 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  dst[0] = m[12];\n  dst[1] = m[13];\n  dst[2] = m[14];\n  return dst;\n}\n\n/**\n * Returns an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y, 2 = z;\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat4, axis: number, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  dst[2] = m[off + 2];\n  return dst;\n}\n\n/**\n * Sets an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y, 2 = z;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(a: Mat4, v: Vec3, axis: number, dst: Mat4): Mat4 {\n  if (dst !== a) {\n    dst = copy(a, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  dst[off + 2] = v[2];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const xz = m[2];\n  const yx = m[4];\n  const yy = m[5];\n  const yz = m[6];\n  const zx = m[8];\n  const zy = m[9];\n  const zz = m[10];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy + xz * xz);\n  dst[1] = Math.sqrt(yx * yx + yy * yy + yz * yz);\n  dst[2] = Math.sqrt(zx * zx + zy * zy + zz * zz);\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the angular height\n * of the frustum, the aspect ratio, and the near and far clipping planes.  The\n * arguments define a frustum extending in the negative z direction.  The given\n * angle is the vertical angle of the frustum, and the horizontal angle is\n * determined to produce the given aspect ratio.  The arguments near and far are\n * the distances to the near and far clipping planes.  Note that near and far\n * are not z coordinates, but rather they are distances along the negative\n * z-axis.  The matrix generated sends the viewing frustum to the unit box.\n * We assume a unit box extending from -1 to 1 in the x and y dimensions and\n * from 0 to 1 in the z dimension.\n *\n * Note: If you pass `Infinity` for zFar then it will produce a projection matrix\n * returns -Infinity for Z when transforming coordinates with Z <= 0 and +Infinity for Z\n * otherwise.\n *\n * @param fieldOfViewYInRadians - The camera angle from top to bottom (in radians).\n * @param aspect - The aspect ratio width / height.\n * @param zNear - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param zFar - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The perspective matrix.\n */\nexport function perspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewYInRadians);\n\n  dst[0]  = f / aspect;\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = f;\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[11] = -1;\n\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[15] = 0;\n\n  if (zFar === Infinity) {\n    dst[10] = -1;\n    dst[14] = -zNear;\n  } else {\n    const rangeInv = 1 / (zNear - zFar);\n    dst[10] = zFar * rangeInv;\n    dst[14] = zFar * zNear * rangeInv;\n  }\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 orthogonal transformation matrix that transforms from\n * the given the left, right, bottom, and top dimensions to -1 +1 in x, and y\n * and 0 to +1 in z.\n * @param left - Left side of the near clipping plane viewport.\n * @param right - Right side of the near clipping plane viewport.\n * @param bottom - Bottom of the near clipping plane viewport.\n * @param top - Top of the near clipping plane viewport.\n * @param near - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param far - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The orthographic projection matrix.\n */\nexport function ortho(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[0]  = 2 / (right - left);\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = 2 / (top - bottom);\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[10] = 1 / (near - far);\n  dst[11] = 0;\n\n  dst[12] = (right + left) / (left - right);\n  dst[13] = (top + bottom) / (bottom - top);\n  dst[14] = near / (near - far);\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the left, right,\n * top, bottom, near and far clipping planes. The arguments define a frustum\n * extending in the negative z direction. The arguments near and far are the\n * distances to the near and far clipping planes. Note that near and far are not\n * z coordinates, but rather they are distances along the negative z-axis. The\n * matrix generated sends the viewing frustum to the unit box. We assume a unit\n * box extending from -1 to 1 in the x and y dimensions and from 0 to 1 in the z\n * dimension.\n * @param left - The x coordinate of the left plane of the box.\n * @param right - The x coordinate of the right plane of the box.\n * @param bottom - The y coordinate of the bottom plane of the box.\n * @param top - The y coordinate of the right plane of the box.\n * @param near - The negative z coordinate of the near plane of the box.\n * @param far - The negative z coordinate of the far plane of the box.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The perspective projection matrix.\n */\nexport function frustum(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const dx = (right - left);\n  const dy = (top - bottom);\n  const dz = (near - far);\n\n  dst[ 0] = 2 * near / dx;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 2 * near / dy;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = (left + right) / dx;\n  dst[ 9] = (top + bottom) / dy;\n  dst[10] = far / dz;\n  dst[11] = -1;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = near * far / dz;\n  dst[15] = 0;\n\n  return dst;\n}\n\nlet xAxis: Vec3;\nlet yAxis: Vec3;\nlet zAxis: Vec3;\n\n/**\n * Computes a 4-by-4 aim transformation.\n *\n * This is a matrix which positions an object aiming down positive Z.\n * toward the target.\n *\n * Note: this is **NOT** the inverse of lookAt as lookAt looks at negative Z.\n *\n * @param position - The position of the object.\n * @param target - The position meant to be aimed at.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The aim matrix.\n */\nexport function aim(position: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(vec3.subtract(target, position, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];     dst[ 1] = xAxis[1];     dst[ 2] = xAxis[2];     dst[ 3] = 0;\n  dst[ 4] = yAxis[0];     dst[ 5] = yAxis[1];     dst[ 6] = yAxis[2];     dst[ 7] = 0;\n  dst[ 8] = zAxis[0];     dst[ 9] = zAxis[1];     dst[10] = zAxis[2];     dst[11] = 0;\n  dst[12] = position[0];  dst[13] = position[1];  dst[14] = position[2];  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 camera aim transformation.\n *\n * This is a matrix which positions an object aiming down negative Z.\n * toward the target.\n *\n * Note: this is the inverse of `lookAt`\n *\n * @param eye - The position of the object.\n * @param target - The position meant to be aimed at.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The aim matrix.\n */\nexport function cameraAim(eye: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(vec3.subtract(eye, target, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];     dst[ 1] = xAxis[1];     dst[ 2] = xAxis[2];     dst[ 3] = 0;\n  dst[ 4] = yAxis[0];     dst[ 5] = yAxis[1];     dst[ 6] = yAxis[2];     dst[ 7] = 0;\n  dst[ 8] = zAxis[0];     dst[ 9] = zAxis[1];     dst[10] = zAxis[2];     dst[11] = 0;\n  dst[12] = eye[0];  dst[13] = eye[1];  dst[14] = eye[2];  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 view transformation.\n *\n * This is a view matrix which transforms all other objects\n * to be in the space of the view defined by the parameters.\n *\n * @param eye - The position of the object.\n * @param target - The position meant to be aimed at.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The look-at matrix.\n */\nexport function lookAt(eye: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(vec3.subtract(eye, target, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];  dst[ 1] = yAxis[0];  dst[ 2] = zAxis[0];  dst[ 3] = 0;\n  dst[ 4] = xAxis[1];  dst[ 5] = yAxis[1];  dst[ 6] = zAxis[1];  dst[ 7] = 0;\n  dst[ 8] = xAxis[2];  dst[ 9] = yAxis[2];  dst[10] = zAxis[2];  dst[11] = 0;\n\n  dst[12] = -(xAxis[0] * eye[0] + xAxis[1] * eye[1] + xAxis[2] * eye[2]);\n  dst[13] = -(yAxis[0] * eye[0] + yAxis[1] * eye[1] + yAxis[2] * eye[2]);\n  dst[14] = -(zAxis[0] * eye[0] + zAxis[1] * eye[1] + zAxis[2] * eye[2]);\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which translates by the given vector v.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;     dst[ 1] = 0;     dst[ 2] = 0;     dst[ 3] = 0;\n  dst[ 4] = 0;     dst[ 5] = 1;     dst[ 6] = 0;     dst[ 7] = 0;\n  dst[ 8] = 0;     dst[ 9] = 0;     dst[10] = 1;     dst[11] = 0;\n  dst[12] = v[0];  dst[13] = v[1];  dst[14] = v[2];  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Translates the given 4-by-4 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 3] = m03;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n    dst[ 7] = m13;\n    dst[ 8] = m20;\n    dst[ 9] = m21;\n    dst[10] = m22;\n    dst[11] = m23;\n  }\n\n  dst[12] = m00 * v0 + m10 * v1 + m20 * v2 + m30;\n  dst[13] = m01 * v0 + m11 * v1 + m21 * v2 + m31;\n  dst[14] = m02 * v0 + m12 * v1 + m22 * v2 + m32;\n  dst[15] = m03 * v0 + m13 * v1 + m23 * v2 + m33;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the x-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationX(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = 1;  dst[ 1] =  0;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] =  c;  dst[ 6] = s;  dst[ 7] = 0;\n  dst[ 8] = 0;  dst[ 9] = -s;  dst[10] = c;  dst[11] = 0;\n  dst[12] = 0;  dst[13] =  0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the x-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateX(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[4]  = c * m10 + s * m20;\n  dst[5]  = c * m11 + s * m21;\n  dst[6]  = c * m12 + s * m22;\n  dst[7]  = c * m13 + s * m23;\n  dst[8]  = c * m20 - s * m10;\n  dst[9]  = c * m21 - s * m11;\n  dst[10] = c * m22 - s * m12;\n  dst[11] = c * m23 - s * m13;\n\n  if (m !== dst) {\n    dst[ 0] = m[ 0];\n    dst[ 1] = m[ 1];\n    dst[ 2] = m[ 2];\n    dst[ 3] = m[ 3];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the y-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationY(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;  dst[ 1] = 0;  dst[ 2] = -s;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] = 1;  dst[ 6] =  0;  dst[ 7] = 0;\n  dst[ 8] = s;  dst[ 9] = 0;  dst[10] =  c;  dst[11] = 0;\n  dst[12] = 0;  dst[13] = 0;  dst[14] =  0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the y-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateY(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 - s * m20;\n  dst[ 1] = c * m01 - s * m21;\n  dst[ 2] = c * m02 - s * m22;\n  dst[ 3] = c * m03 - s * m23;\n  dst[ 8] = c * m20 + s * m00;\n  dst[ 9] = c * m21 + s * m01;\n  dst[10] = c * m22 + s * m02;\n  dst[11] = c * m23 + s * m03;\n\n  if (m !== dst) {\n    dst[ 4] = m[ 4];\n    dst[ 5] = m[ 5];\n    dst[ 6] = m[ 6];\n    dst[ 7] = m[ 7];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the z-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationZ(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] =  c;  dst[ 1] = s;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = -s;  dst[ 5] = c;  dst[ 6] = 0;  dst[ 7] = 0;\n  dst[ 8] =  0;  dst[ 9] = 0;  dst[10] = 1;  dst[11] = 0;\n  dst[12] =  0;  dst[13] = 0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the z-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateZ(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n  dst[ 3] = c * m03 + s * m13;\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n  dst[ 7] = c * m13 - s * m03;\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n    dst[11] = m[11];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport function axisRotation(axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  dst[ 0] = xx + (1 - xx) * c;\n  dst[ 1] = x * y * oneMinusCosine + z * s;\n  dst[ 2] = x * z * oneMinusCosine - y * s;\n  dst[ 3] = 0;\n  dst[ 4] = x * y * oneMinusCosine - z * s;\n  dst[ 5] = yy + (1 - yy) * c;\n  dst[ 6] = y * z * oneMinusCosine + x * s;\n  dst[ 7] = 0;\n  dst[ 8] = x * z * oneMinusCosine + y * s;\n  dst[ 9] = y * z * oneMinusCosine - x * s;\n  dst[10] = zz + (1 - zz) * c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle. (same as axisRotation)\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport const rotation = axisRotation;\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle.\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function axisRotate(m: Mat4, axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  const r00 = xx + (1 - xx) * c;\n  const r01 = x * y * oneMinusCosine + z * s;\n  const r02 = x * z * oneMinusCosine - y * s;\n  const r10 = x * y * oneMinusCosine - z * s;\n  const r11 = yy + (1 - yy) * c;\n  const r12 = y * z * oneMinusCosine + x * s;\n  const r20 = x * z * oneMinusCosine + y * s;\n  const r21 = y * z * oneMinusCosine - x * s;\n  const r22 = zz + (1 - zz) * c;\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n\n  dst[ 0] = r00 * m00 + r01 * m10 + r02 * m20;\n  dst[ 1] = r00 * m01 + r01 * m11 + r02 * m21;\n  dst[ 2] = r00 * m02 + r01 * m12 + r02 * m22;\n  dst[ 3] = r00 * m03 + r01 * m13 + r02 * m23;\n  dst[ 4] = r10 * m00 + r11 * m10 + r12 * m20;\n  dst[ 5] = r10 * m01 + r11 * m11 + r12 * m21;\n  dst[ 6] = r10 * m02 + r11 * m12 + r12 * m22;\n  dst[ 7] = r10 * m03 + r11 * m13 + r12 * m23;\n  dst[ 8] = r20 * m00 + r21 * m10 + r22 * m20;\n  dst[ 9] = r20 * m01 + r21 * m11 + r22 * m21;\n  dst[10] = r20 * m02 + r21 * m12 + r22 * m22;\n  dst[11] = r20 * m03 + r21 * m13 + r22 * m23;\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle. (same as rotate)\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport const rotate = axisRotate;\n\n/**\n * Creates a 4-by-4 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     three entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = v[0];  dst[ 1] = 0;     dst[ 2] = 0;     dst[ 3] = 0;\n  dst[ 4] = 0;     dst[ 5] = v[1];  dst[ 6] = 0;     dst[ 7] = 0;\n  dst[ 8] = 0;     dst[ 9] = 0;     dst[10] = v[2];  dst[11] = 0;\n  dst[12] = 0;     dst[13] = 0;     dst[14] = 0;     dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 4-by-4 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of three entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n  dst[ 3] = v0 * m[0 * 4 + 3];\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n  dst[ 7] = v1 * m[1 * 4 + 3];\n  dst[ 8] = v2 * m[2 * 4 + 0];\n  dst[ 9] = v2 * m[2 * 4 + 1];\n  dst[10] = v2 * m[2 * 4 + 2];\n  dst[11] = v2 * m[2 * 4 + 3];\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which scales a uniform amount in each dimension.\n * @param s - the amount to scale\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function uniformScaling(s: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = s;  dst[ 1] = 0;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] = s;  dst[ 6] = 0;  dst[ 7] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = s;  dst[11] = 0;\n  dst[12] = 0;  dst[13] = 0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 4-by-4 matrix in each dimension by a uniform scale.\n * @param m - The matrix to be modified.\n * @param s - The amount to scale.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function uniformScale(m: Mat4, s: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = s * m[0 * 4 + 0];\n  dst[ 1] = s * m[0 * 4 + 1];\n  dst[ 2] = s * m[0 * 4 + 2];\n  dst[ 3] = s * m[0 * 4 + 3];\n  dst[ 4] = s * m[1 * 4 + 0];\n  dst[ 5] = s * m[1 * 4 + 1];\n  dst[ 6] = s * m[1 * 4 + 2];\n  dst[ 7] = s * m[1 * 4 + 3];\n  dst[ 8] = s * m[2 * 4 + 0];\n  dst[ 9] = s * m[2 * 4 + 1];\n  dst[10] = s * m[2 * 4 + 2];\n  dst[11] = s * m[2 * 4 + 3];\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 4 values, Float32Array with 4 values, or a Float64Array with 4 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link quat.setDefaultType}.\n */\nexport type Quat = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Quat4 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Quat4`. In other words you can do this\n *\n *     const v = quat4.cross(v1, v2);  // Creates a new Quat4 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = quat4.create();\n *     quat4.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     quat4.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let QuatType: new (n: number) => Quat = Float32Array;\n\n/**\n * Sets the type this library creates for a Quat4\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Quat4\n */\nexport function setDefaultType(ctor: new (n: number) => Quat) {\n  const oldType = QuatType;\n  QuatType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a quat4; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param w - Initial w value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number, w?: number): Quat {\n  const dst = new QuatType(4);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n        if (w !== undefined) {\n          dst[3] = w;\n        }\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Quat, create, setDefaultType, QuatType } from './quat';\nimport { Mat3 } from './mat3.js';\nimport { Mat4 } from './mat4.js';\nimport { Vec3 } from './vec3.js';\nimport * as vec3 from './vec3-impl.js';\n\nexport type RotationOrder =  'xyz' |  'xzy' |  'yxz' |  'yzx' |  'zxy' |  'zyx';\n\nexport default Quat;\nexport { create, setDefaultType };\n\n/**\n * Creates a Quat; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param z - Initial w value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Quat\n * Also see {@link quat.create} and {@link quat.copy}\n *\n * @param x first value\n * @param y second value\n * @param z third value\n * @param w fourth value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, z: number, w: number, dst?: Quat) {\n  dst = dst || new QuatType(4);\n\n  dst[0] = x;\n  dst[1] = y;\n  dst[2] = z;\n  dst[3] = w;\n\n  return dst;\n}\n\n/**\n * Sets a quaternion from the given angle and  axis,\n * then returns it.\n *\n * @param axis - the axis to rotate around\n * @param angleInRadians - the angle\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The quaternion that represents the given axis and angle\n **/\nexport function fromAxisAngle(axis: Vec3, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n  const s = Math.sin(halfAngle);\n\n  dst[0] = s * axis[0];\n  dst[1] = s * axis[1];\n  dst[2] = s * axis[2];\n  dst[3] = Math.cos(halfAngle);\n\n  return dst;\n}\n\n/**\n * Gets the rotation axis and angle\n * @param q - quaternion to compute from\n * @param dst - Vec3 to hold result. If not passed in a new one is created.\n * @return angle and axis\n */\nexport function toAxisAngle(q: Quat, dst?: Vec3): { angle: number, axis: Vec3 } {\n  dst = dst || vec3.create(4);\n\n  const angle = Math.acos(q[3]) * 2;\n  const s = Math.sin(angle * 0.5);\n  if (s > utils.EPSILON) {\n    dst[0] = q[0] / s;\n    dst[1] = q[1] / s;\n    dst[2] = q[2] / s;\n  } else {\n    dst[0] = 1;\n    dst[1] = 0;\n    dst[2] = 0;\n  }\n\n  return { angle, axis: dst };\n}\n\n/**\n * Returns the angle in degrees between two rotations a and b.\n * @param a - quaternion a\n * @param b - quaternion b\n * @return angle in radians between the two quaternions\n */\nexport function angle(a: Quat, b: Quat) {\n  const d = dot(a, b);\n  return Math.acos(2 * d * d - 1);\n}\n\n/**\n * Multiplies two quaternions\n *\n * @param a - the first quaternion\n * @param b - the second quaternion\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function multiply(a: Quat, b: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const aw = a[3];\n\n  const bx = b[0];\n  const by = b[1];\n  const bz = b[2];\n  const bw = b[3];\n\n  dst[0] = ax * bw + aw * bx + ay * bz - az * by;\n  dst[1] = ay * bw + aw * by + az * bx - ax * bz;\n  dst[2] = az * bw + aw * bz + ax * by - ay * bx;\n  dst[3] = aw * bw - ax * bx - ay * by - az * bz;\n\n  return dst;\n}\n\n/**\n * Multiplies two quaternions\n *\n * @param a - the first quaternion\n * @param b - the second quaternion\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport const mul = multiply;\n\n/**\n * Rotates the given quaternion around the X axis by the given angle.\n * @param q - quaternion to rotate\n * @param angleInRadians - The angle by which to rotate\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function rotateX(q: Quat, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const qw = q[3];\n\n  const bx = Math.sin(halfAngle);\n  const bw = Math.cos(halfAngle);\n\n  dst[0] = qx * bw + qw * bx;\n  dst[1] = qy * bw + qz * bx;\n  dst[2] = qz * bw - qy * bx;\n  dst[3] = qw * bw - qx * bx;\n\n  return dst;\n}\n\n/**\n * Rotates the given quaternion around the Y axis by the given angle.\n * @param q - quaternion to rotate\n * @param angleInRadians - The angle by which to rotate\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function rotateY(q: Quat, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const qw = q[3];\n\n  const by = Math.sin(halfAngle);\n  const bw = Math.cos(halfAngle);\n\n  dst[0] = qx * bw - qz * by;\n  dst[1] = qy * bw + qw * by;\n  dst[2] = qz * bw + qx * by;\n  dst[3] = qw * bw - qy * by;\n\n  return dst;\n}\n\n/**\n * Rotates the given quaternion around the Z axis by the given angle.\n * @param q - quaternion to rotate\n * @param angleInRadians - The angle by which to rotate\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function rotateZ(q: Quat, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const qw = q[3];\n\n  const bz = Math.sin(halfAngle);\n  const bw = Math.cos(halfAngle);\n\n  dst[0] = qx * bw + qy * bz;\n  dst[1] = qy * bw - qx * bz;\n  dst[2] = qz * bw + qw * bz;\n  dst[3] = qw * bw - qz * bz;\n\n  return dst;\n}\n\n/**\n * Spherically linear interpolate between two quaternions\n *\n * @param a - starting value\n * @param b - ending value\n * @param t - value where 0 = a and 1 = b\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function slerp(a: Quat, b: Quat, t: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const aw = a[3];\n\n  let bx = b[0];\n  let by = b[1];\n  let bz = b[2];\n  let bw = b[3];\n\n  let cosOmega = ax * bx + ay * by + az * bz + aw * bw;\n\n  if (cosOmega < 0) {\n    cosOmega = -cosOmega;\n    bx = -bx;\n    by = -by;\n    bz = -bz;\n    bw = -bw;\n  }\n\n  let scale0;\n  let scale1;\n\n  if (1.0 - cosOmega > utils.EPSILON) {\n    const omega = Math.acos(cosOmega);\n    const sinOmega = Math.sin(omega);\n    scale0 = Math.sin((1 - t) * omega) / sinOmega;\n    scale1 = Math.sin(t * omega) / sinOmega;\n  } else {\n    scale0 = 1.0 - t;\n    scale1 = t;\n  }\n\n  dst[0] = scale0 * ax + scale1 * bx;\n  dst[1] = scale0 * ay + scale1 * by;\n  dst[2] = scale0 * az + scale1 * bz;\n  dst[3] = scale0 * aw + scale1 * bw;\n\n  return dst;\n}\n\n/**\n * Compute the inverse of a quaternion\n *\n * @param q - quaternion to compute the inverse of\n * @returns A quaternion that is the result of a * b\n */\nexport function inverse(q: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const a0 = q[0];\n  const a1 = q[1];\n  const a2 = q[2];\n  const a3 = q[3];\n\n  const dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n  const invDot = dot ? 1 / dot : 0;\n\n  dst[0] = -a0 * invDot;\n  dst[1] = -a1 * invDot;\n  dst[2] = -a2 * invDot;\n  dst[3] =  a3 * invDot;\n\n  return dst;\n}\n\n/**\n * Compute the conjugate of a quaternion\n * For quaternions with a magnitude of 1 (a unit quaternion)\n * this returns the same as the inverse but is faster to calculate.\n *\n * @param q - quaternion to compute the conjugate of.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The conjugate of q\n */\nexport function conjugate(q: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = -q[0];\n  dst[1] = -q[1];\n  dst[2] = -q[2];\n  dst[3] =  q[3];\n\n  return dst;\n}\n\n/**\n * Creates a quaternion from the given rotation matrix.\n *\n * The created quaternion is not normalized.\n *\n * @param m - rotation matrix\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns the result\n */\nexport function fromMat(m: Mat3 | Mat4, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  /*\n  0 1 2\n  3 4 5\n  6 7 8\n\n  0 1 2\n  4 5 6\n  8 9 10\n   */\n\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n  // article \"Quaternion Calculus and Fast Animation\".\n  const trace = m[0] + m[5] + m[10];\n\n  if (trace > 0.0) {\n    // |w| > 1/2, may as well choose w > 1/2\n    const root = Math.sqrt(trace + 1); // 2w\n    dst[3] = 0.5 * root;\n    const invRoot = 0.5 / root; // 1/(4w)\n\n    dst[0] = (m[6] - m[9]) * invRoot;\n    dst[1] = (m[8] - m[2]) * invRoot;\n    dst[2] = (m[1] - m[4]) * invRoot;\n  } else {\n    // |w| <= 1/2\n    let i = 0;\n\n    if (m[5] > m[0]) {\n      i = 1;\n    }\n    if (m[10] > m[i * 4 + i]) {\n      i = 2;\n    }\n\n    const j = (i + 1) % 3;\n    const k = (i + 2) % 3;\n\n    const root = Math.sqrt(m[i * 4 + i] - m[j * 4 + j] - m[k * 4 + k] + 1.0);\n    dst[i] = 0.5 * root;\n\n    const invRoot = 0.5 / root;\n\n    dst[3] = (m[j * 4 + k] - m[k * 4 + j]) * invRoot;\n    dst[j] = (m[j * 4 + i] + m[i * 4 + j]) * invRoot;\n    dst[k] = (m[k * 4 + i] + m[i * 4 + k]) * invRoot;\n  }\n\n  return dst;\n}\n\n/**\n * Creates a quaternion from the given euler angle x, y, z using the provided intrinsic order for the conversion.\n *\n * @param xAngleInRadians - angle to rotate around X axis in radians.\n * @param yAngleInRadians - angle to rotate around Y axis in radians.\n * @param zAngleInRadians - angle to rotate around Z axis in radians.\n * @param order - order to apply euler angles\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion representing the same rotation as the euler angles applied in the given order\n */\nexport function fromEuler(\n    xAngleInRadians: number,\n    yAngleInRadians: number,\n    zAngleInRadians: number,\n    order: RotationOrder,\n    dst?: Quat) {\n  dst = dst || new QuatType(4);\n\n  const xHalfAngle = xAngleInRadians * 0.5;\n  const yHalfAngle = yAngleInRadians * 0.5;\n  const zHalfAngle = zAngleInRadians * 0.5;\n\n  const sx = Math.sin(xHalfAngle);\n  const cx = Math.cos(xHalfAngle);\n  const sy = Math.sin(yHalfAngle);\n  const cy = Math.cos(yHalfAngle);\n  const sz = Math.sin(zHalfAngle);\n  const cz = Math.cos(zHalfAngle);\n\n  switch (order) {\n    case 'xyz':\n      dst[0] = sx * cy * cz + cx * sy * sz;\n      dst[1] = cx * sy * cz - sx * cy * sz;\n      dst[2] = cx * cy * sz + sx * sy * cz;\n      dst[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case 'xzy':\n      dst[0] = sx * cy * cz - cx * sy * sz;\n      dst[1] = cx * sy * cz - sx * cy * sz;\n      dst[2] = cx * cy * sz + sx * sy * cz;\n      dst[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case 'yxz':\n      dst[0] = sx * cy * cz + cx * sy * sz;\n      dst[1] = cx * sy * cz - sx * cy * sz;\n      dst[2] = cx * cy * sz - sx * sy * cz;\n      dst[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case 'yzx':\n      dst[0] = sx * cy * cz + cx * sy * sz;\n      dst[1] = cx * sy * cz + sx * cy * sz;\n      dst[2] = cx * cy * sz - sx * sy * cz;\n      dst[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case 'zxy':\n      dst[0] = sx * cy * cz - cx * sy * sz;\n      dst[1] = cx * sy * cz + sx * cy * sz;\n      dst[2] = cx * cy * sz + sx * sy * cz;\n      dst[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case 'zyx':\n      dst[0] = sx * cy * cz - cx * sy * sz;\n      dst[1] = cx * sy * cz + sx * cy * sz;\n      dst[2] = cx * cy * sz - sx * sy * cz;\n      dst[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    default:\n      throw new Error(`Unknown rotation order: ${order}`);\n  }\n\n  return dst;\n}\n\n/**\n * Copies a quaternion. (same as {@link quat.clone})\n * Also see {@link quat.create} and {@link quat.set}\n * @param q - The quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is a copy of q\n */\nexport function copy(q: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = q[0];\n  dst[1] = q[1];\n  dst[2] = q[2];\n  dst[3] = q[3];\n\n  return dst;\n}\n\n/**\n * Clones a quaternion. (same as {@link quat.copy})\n * Also see {@link quat.create} and {@link quat.set}\n * @param q - The quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A copy of q.\n */\nexport const clone = copy;\n\n/**\n * Adds two quaternions; assumes a and b have the same dimension.\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the sum of a and b.\n */\nexport function add(a: Quat, b: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n  dst[3] = a[3] + b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two quaternions.\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the difference of a and b.\n */\nexport function subtract(a: Quat, b: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n  dst[3] = a[3] - b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two quaternions.\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Multiplies a quaternion by a scalar.\n * @param v - The quaternion.\n * @param k - The scalar.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The scaled quaternion.\n */\nexport function mulScalar(v: Quat, k: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n  dst[3] = v[3] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a quaternion by a scalar. (same as mulScalar)\n * @param v - The quaternion.\n * @param k - The scalar.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The scaled quaternion.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The scaled quaternion.\n */\nexport function divScalar(v: Quat, k: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n  dst[3] = v[3] / k;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two quaternions\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @returns dot product\n */\nexport function dot(a: Quat, b: Quat): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]) + (a[3] * b[3]);\n}\n\n/**\n * Performs linear interpolation on two quaternions.\n * Given quaternions a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param t - Interpolation coefficient.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Quat, b: Quat, t: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n  dst[3] = a[3] + t * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Computes the length of quaternion\n * @param v - quaternion.\n * @returns length of quaternion.\n */\nexport function length(v: Quat): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n}\n\n/**\n * Computes the length of quaternion (same as length)\n * @param v - quaternion.\n * @returns length of quaternion.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of quaternion\n * @param v - quaternion.\n * @returns square of the length of quaternion.\n */\nexport function lengthSq(v: Quat): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3;\n}\n\n/**\n * Computes the square of the length of quaternion (same as lengthSq)\n * @param v - quaternion.\n * @returns square of the length of quaternion.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Divides a quaternion by its Euclidean length and returns the quotient.\n * @param v - The quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The normalized quaternion.\n */\nexport function normalize(v: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n    dst[3] = v3 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Check if 2 quaternions are approximately equal\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @returns true if quaternions are approximately equal\n */\nexport function equalsApproximately(a: Quat, b: Quat): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON &&\n         Math.abs(a[3] - b[3]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 quaternions are exactly equal\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @returns true if quaternions are exactly equal\n */\nexport function equals(a: Quat, b: Quat): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Creates an identity quaternion\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns an identity quaternion\n */\nexport function identity(dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n  dst[3] = 1;\n\n  return dst;\n}\n\nlet tempVec3: Vec3;\nlet xUnitVec3: Vec3;\nlet yUnitVec3: Vec3;\n\n/**\n * Computes a quaternion to represent the shortest rotation from one vector to another.\n *\n * @param aUnit - the start vector\n * @param bUnit - the end vector\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns the result\n */\nexport function rotationTo(aUnit: Vec3, bUnit: Vec3, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  tempVec3 = tempVec3 || vec3.create();\n  xUnitVec3 = xUnitVec3 || vec3.create(1, 0, 0);\n  yUnitVec3 = yUnitVec3 || vec3.create(0, 1, 0);\n\n  const dot = vec3.dot(aUnit, bUnit);\n  if (dot < -0.999999) {\n    vec3.cross(xUnitVec3, aUnit, tempVec3);\n    if (vec3.len(tempVec3) < 0.000001) {\n      vec3.cross(yUnitVec3, aUnit, tempVec3);\n    }\n\n    vec3.normalize(tempVec3, tempVec3);\n    fromAxisAngle(tempVec3, Math.PI, dst);\n\n    return dst;\n  } else if (dot > 0.999999) {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 1;\n\n    return dst;\n  } else {\n    vec3.cross(aUnit, bUnit, tempVec3);\n\n    dst[0] = tempVec3[0];\n    dst[1] = tempVec3[1];\n    dst[2] = tempVec3[2];\n    dst[3] = 1 + dot;\n\n    return normalize(dst, dst);\n  }\n}\n\nlet tempQuat1: Quat;\nlet tempQuat2: Quat;\n\n/**\n * Performs a spherical linear interpolation with two control points\n *\n * @param a - the first quaternion\n * @param b - the second quaternion\n * @param c - the third quaternion\n * @param d - the fourth quaternion\n * @param t - Interpolation coefficient 0 to 1\n * @returns result\n */\nexport function sqlerp(\n    a: Quat,\n    b: Quat,\n    c: Quat,\n    d: Quat,\n    t: number,\n    dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  tempQuat1 = tempQuat1 || new QuatType(4);\n  tempQuat2 = tempQuat2 || new QuatType(4);\n\n  slerp(a, d, t, tempQuat1);\n  slerp(b, c, t, tempQuat2);\n  slerp(tempQuat1, tempQuat2, 2 * t * (1 - t), dst);\n\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 4 values, Float32Array with 4 values, or a Float64Array with 4 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec4.setDefaultType}.\n */\nexport type Vec4 = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Vec4 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec4`. In other words you can do this\n *\n *     const v = vec4.cross(v1, v2);  // Creates a new Vec4 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec4.create();\n *     vec4.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec4.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec4 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec4\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Vec4\n */\nexport function setDefaultType(ctor: new (n: number) => Vec4) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param w - Initial w value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number, w?: number): Vec4 {\n  const dst = new VecType(4);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n        if (w !== undefined) {\n          dst[3] = w;\n        }\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Vec4, create, setDefaultType, VecType } from './vec4';\nimport { Mat4 } from './mat4';\n\nexport default Vec4;\nexport { create, setDefaultType };\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param z - Initial w value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Vec4\n * Also see {@link vec4.create} and {@link vec4.copy}\n *\n * @param x first value\n * @param y second value\n * @param z third value\n * @param w fourth value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, z: number, w: number, dst?: Vec4) {\n  dst = dst || new VecType(4);\n\n  dst[0] = x;\n  dst[1] = y;\n  dst[2] = z;\n  dst[3] = w;\n\n  return dst;\n}\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n  dst[3] = Math.ceil(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n  dst[3] = Math.floor(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n  dst[3] = Math.round(v[3]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec4, min = 0, max = 1, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n  dst[3] = Math.min(max, Math.max(min, v[3]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n  dst[3] = a[3] + b[3];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec4, b: Vec4, scale: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n  dst[3] = a[3] + b[3] * scale;\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n  dst[3] = a[3] - b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec4, b: Vec4): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON &&\n         Math.abs(a[3] - b[3]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec4, b: Vec4): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec4, b: Vec4, t: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n  dst[3] = a[3] + t * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec4, b: Vec4, t: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n  dst[3] = a[3] + t[3] * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n  dst[3] = Math.max(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n  dst[3] = Math.min(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n  dst[3] = v[3] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n  dst[3] = v[3] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n  dst[3] = 1 / v[3];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the dot product of two vectors\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec4, b: Vec4): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]) + (a[3] * b[3]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz + dw * dw);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return dx * dx + dy * dy + dz * dz + dw * dw;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n    dst[3] = v3 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n  dst[3] = -v[3];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as {@link vec4.clone})\n * Also see {@link vec4.create} and {@link vec4.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n  dst[3] = v[3];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as {@link vec4.copy})\n * Also see {@link vec4.create} and {@link vec4.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n  dst[3] = a[3] * b[3];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec4, b: Vec4, dst?: Vec4) {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n  dst[3] = a[3] / b[3];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n  dst[3] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec4 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec4 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec4, m: Mat4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = v[3];\n\n  dst[0] = m[0] * x + m[4] * y + m[ 8] * z + m[12] * w;\n  dst[1] = m[1] * x + m[5] * y + m[ 9] * z + m[13] * w;\n  dst[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  dst[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n\n  return dst;\n}\n", "import Mat3, * as mat3 from './mat3-impl';\nimport Mat4, * as mat4 from './mat4-impl';\nimport Quat, * as quat from './quat-impl';\nimport Vec2, * as vec2 from './vec2-impl';\nimport Vec3, * as vec3 from './vec3-impl';\nimport Vec4, * as vec4 from './vec4-impl';\nimport * as utils from './utils';\n\n/**\n * Sets the type this library creates for all types\n *\n * example:\n *\n * ```\n * setDefaultType(Float64Array);\n * ```\n *\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n */\nexport function setDefaultType(ctor: new (n: number) => Float32Array | Float64Array | number[]) {\n  mat3.setDefaultType(ctor);\n  mat4.setDefaultType(ctor);\n  quat.setDefaultType(ctor);\n  vec2.setDefaultType(ctor);\n  vec3.setDefaultType(ctor);\n  vec4.setDefaultType(ctor);\n}\n\nexport {\n  Mat3,\n  mat3,\n  Mat4,\n  mat4,\n  Quat,\n  quat,\n  utils,\n  Vec2,\n  vec2,\n  Vec3,\n  vec3,\n  Vec4,\n  vec4,\n};", "\r\nexport var supportsTouch = 'ontouchstart' in window || navigator.msMaxTouchPoints;\r\n\r\nexport function isMobile() {\r\n  if(supportsTouch == true) return true;\r\n  const toMatch = [/Android/i, /webOS/i, /iPhone/i, /iPad/i, /iPod/i, /BlackBerry/i, /Windows Phone/i];\r\n  return toMatch.some(toMatchItem => {\r\n    return navigator.userAgent.match(toMatchItem);\r\n  });\r\n};\r\n\r\nexport const vec3 = {\r\n  cross(a, b, dst) {\r\n    dst = dst || new Float32Array(3);\r\n\r\n    const t0 = a[1] * b[2] - a[2] * b[1];\r\n    const t1 = a[2] * b[0] - a[0] * b[2];\r\n    const t2 = a[0] * b[1] - a[1] * b[0];\r\n\r\n    dst[0] = t0;\r\n    dst[1] = t1;\r\n    dst[2] = t2;\r\n\r\n    return dst;\r\n  },\r\n\r\n  subtract(a, b, dst) {\r\n    dst = dst || new Float32Array(3);\r\n\r\n    dst[0] = a[0] - b[0];\r\n    dst[1] = a[1] - b[1];\r\n    dst[2] = a[2] - b[2];\r\n\r\n    return dst;\r\n  },\r\n\r\n  normalize(v, dst) {\r\n    dst = dst || new Float32Array(3);\r\n\r\n    const length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n    // make sure we don't divide by 0.\r\n    if(length > 0.00001) {\r\n      dst[0] = v[0] / length;\r\n      dst[1] = v[1] / length;\r\n      dst[2] = v[2] / length;\r\n    } else {\r\n      dst[0] = 0;\r\n      dst[1] = 0;\r\n      dst[2] = 0;\r\n    }\r\n\r\n    return dst;\r\n  },\r\n};\r\n\r\nexport const mat4 = {\r\n  projection(width, height, depth, dst) {\r\n    // Note: This matrix flips the Y axis so that 0 is at the top.\r\n    return mat4.ortho(0, width, height, 0, depth, -depth, dst);\r\n  },\r\n\r\n  perspective(fieldOfViewYInRadians, aspect, zNear, zFar, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    const f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewYInRadians);\r\n    const rangeInv = 1 / (zNear - zFar);\r\n\r\n    dst[0] = f / aspect;\r\n    dst[1] = 0;\r\n    dst[2] = 0;\r\n    dst[3] = 0;\r\n\r\n    dst[4] = 0;\r\n    dst[5] = f;\r\n    dst[6] = 0;\r\n    dst[7] = 0;\r\n\r\n    dst[8] = 0;\r\n    dst[9] = 0;\r\n    dst[10] = zFar * rangeInv;\r\n    dst[11] = -1;\r\n\r\n    dst[12] = 0;\r\n    dst[13] = 0;\r\n    dst[14] = zNear * zFar * rangeInv;\r\n    dst[15] = 0;\r\n\r\n    return dst;\r\n  },\r\n\r\n  ortho(left, right, bottom, top, near, far, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    dst[0] = 2 / (right - left);\r\n    dst[1] = 0;\r\n    dst[2] = 0;\r\n    dst[3] = 0;\r\n\r\n    dst[4] = 0;\r\n    dst[5] = 2 / (top - bottom);\r\n    dst[6] = 0;\r\n    dst[7] = 0;\r\n\r\n    dst[8] = 0;\r\n    dst[9] = 0;\r\n    dst[10] = 1 / (near - far);\r\n    dst[11] = 0;\r\n\r\n    dst[12] = (right + left) / (left - right);\r\n    dst[13] = (top + bottom) / (bottom - top);\r\n    dst[14] = near / (near - far);\r\n    dst[15] = 1;\r\n\r\n    return dst;\r\n  },\r\n\r\n  identity(dst) {\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = 1; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = 1; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = 1; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  multiply(a, b, dst) {\r\n    dst = dst || new Float32Array(16);\r\n    const b00 = b[0 * 4 + 0];\r\n    const b01 = b[0 * 4 + 1];\r\n    const b02 = b[0 * 4 + 2];\r\n    const b03 = b[0 * 4 + 3];\r\n    const b10 = b[1 * 4 + 0];\r\n    const b11 = b[1 * 4 + 1];\r\n    const b12 = b[1 * 4 + 2];\r\n    const b13 = b[1 * 4 + 3];\r\n    const b20 = b[2 * 4 + 0];\r\n    const b21 = b[2 * 4 + 1];\r\n    const b22 = b[2 * 4 + 2];\r\n    const b23 = b[2 * 4 + 3];\r\n    const b30 = b[3 * 4 + 0];\r\n    const b31 = b[3 * 4 + 1];\r\n    const b32 = b[3 * 4 + 2];\r\n    const b33 = b[3 * 4 + 3];\r\n    const a00 = a[0 * 4 + 0];\r\n    const a01 = a[0 * 4 + 1];\r\n    const a02 = a[0 * 4 + 2];\r\n    const a03 = a[0 * 4 + 3];\r\n    const a10 = a[1 * 4 + 0];\r\n    const a11 = a[1 * 4 + 1];\r\n    const a12 = a[1 * 4 + 2];\r\n    const a13 = a[1 * 4 + 3];\r\n    const a20 = a[2 * 4 + 0];\r\n    const a21 = a[2 * 4 + 1];\r\n    const a22 = a[2 * 4 + 2];\r\n    const a23 = a[2 * 4 + 3];\r\n    const a30 = a[3 * 4 + 0];\r\n    const a31 = a[3 * 4 + 1];\r\n    const a32 = a[3 * 4 + 2];\r\n    const a33 = a[3 * 4 + 3];\r\n\r\n    dst[0] = b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30;\r\n    dst[1] = b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31;\r\n    dst[2] = b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32;\r\n    dst[3] = b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33;\r\n\r\n    dst[4] = b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30;\r\n    dst[5] = b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31;\r\n    dst[6] = b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32;\r\n    dst[7] = b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33;\r\n\r\n    dst[8] = b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30;\r\n    dst[9] = b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31;\r\n    dst[10] = b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32;\r\n    dst[11] = b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33;\r\n\r\n    dst[12] = b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30;\r\n    dst[13] = b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31;\r\n    dst[14] = b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32;\r\n    dst[15] = b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33;\r\n\r\n    return dst;\r\n  },\r\n\r\n  cameraAim(eye, target, up, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    const zAxis = vec3.normalize(vec3.subtract(eye, target));\r\n    const xAxis = vec3.normalize(vec3.cross(up, zAxis));\r\n    const yAxis = vec3.normalize(vec3.cross(zAxis, xAxis));\r\n\r\n    dst[0] = xAxis[0]; dst[1] = xAxis[1]; dst[2] = xAxis[2]; dst[3] = 0;\r\n    dst[4] = yAxis[0]; dst[5] = yAxis[1]; dst[6] = yAxis[2]; dst[7] = 0;\r\n    dst[8] = zAxis[0]; dst[9] = zAxis[1]; dst[10] = zAxis[2]; dst[11] = 0;\r\n    dst[12] = eye[0]; dst[13] = eye[1]; dst[14] = eye[2]; dst[15] = 1;\r\n\r\n    return dst;\r\n  },\r\n\r\n  inverse(m, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    const m00 = m[0 * 4 + 0];\r\n    const m01 = m[0 * 4 + 1];\r\n    const m02 = m[0 * 4 + 2];\r\n    const m03 = m[0 * 4 + 3];\r\n    const m10 = m[1 * 4 + 0];\r\n    const m11 = m[1 * 4 + 1];\r\n    const m12 = m[1 * 4 + 2];\r\n    const m13 = m[1 * 4 + 3];\r\n    const m20 = m[2 * 4 + 0];\r\n    const m21 = m[2 * 4 + 1];\r\n    const m22 = m[2 * 4 + 2];\r\n    const m23 = m[2 * 4 + 3];\r\n    const m30 = m[3 * 4 + 0];\r\n    const m31 = m[3 * 4 + 1];\r\n    const m32 = m[3 * 4 + 2];\r\n    const m33 = m[3 * 4 + 3];\r\n\r\n    const tmp0 = m22 * m33;\r\n    const tmp1 = m32 * m23;\r\n    const tmp2 = m12 * m33;\r\n    const tmp3 = m32 * m13;\r\n    const tmp4 = m12 * m23;\r\n    const tmp5 = m22 * m13;\r\n    const tmp6 = m02 * m33;\r\n    const tmp7 = m32 * m03;\r\n    const tmp8 = m02 * m23;\r\n    const tmp9 = m22 * m03;\r\n    const tmp10 = m02 * m13;\r\n    const tmp11 = m12 * m03;\r\n    const tmp12 = m20 * m31;\r\n    const tmp13 = m30 * m21;\r\n    const tmp14 = m10 * m31;\r\n    const tmp15 = m30 * m11;\r\n    const tmp16 = m10 * m21;\r\n    const tmp17 = m20 * m11;\r\n    const tmp18 = m00 * m31;\r\n    const tmp19 = m30 * m01;\r\n    const tmp20 = m00 * m21;\r\n    const tmp21 = m20 * m01;\r\n    const tmp22 = m00 * m11;\r\n    const tmp23 = m10 * m01;\r\n\r\n    const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\r\n      (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\r\n    const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\r\n      (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\r\n    const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\r\n      (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\r\n    const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\r\n      (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\r\n\r\n    const d = 1 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\r\n\r\n    dst[0] = d * t0;\r\n    dst[1] = d * t1;\r\n    dst[2] = d * t2;\r\n    dst[3] = d * t3;\r\n\r\n    dst[4] = d * ((tmp1 * m10 + tmp2 * m20 + tmp5 * m30) -\r\n      (tmp0 * m10 + tmp3 * m20 + tmp4 * m30));\r\n    dst[5] = d * ((tmp0 * m00 + tmp7 * m20 + tmp8 * m30) -\r\n      (tmp1 * m00 + tmp6 * m20 + tmp9 * m30));\r\n    dst[6] = d * ((tmp3 * m00 + tmp6 * m10 + tmp11 * m30) -\r\n      (tmp2 * m00 + tmp7 * m10 + tmp10 * m30));\r\n    dst[7] = d * ((tmp4 * m00 + tmp9 * m10 + tmp10 * m20) -\r\n      (tmp5 * m00 + tmp8 * m10 + tmp11 * m20));\r\n\r\n    dst[8] = d * ((tmp12 * m13 + tmp15 * m23 + tmp16 * m33) -\r\n      (tmp13 * m13 + tmp14 * m23 + tmp17 * m33));\r\n    dst[9] = d * ((tmp13 * m03 + tmp18 * m23 + tmp21 * m33) -\r\n      (tmp12 * m03 + tmp19 * m23 + tmp20 * m33));\r\n    dst[10] = d * ((tmp14 * m03 + tmp19 * m13 + tmp22 * m33) -\r\n      (tmp15 * m03 + tmp18 * m13 + tmp23 * m33));\r\n    dst[11] = d * ((tmp17 * m03 + tmp20 * m13 + tmp23 * m23) -\r\n      (tmp16 * m03 + tmp21 * m13 + tmp22 * m23));\r\n\r\n    dst[12] = d * ((tmp14 * m22 + tmp17 * m32 + tmp13 * m12) -\r\n      (tmp16 * m32 + tmp12 * m12 + tmp15 * m22));\r\n    dst[13] = d * ((tmp20 * m32 + tmp12 * m02 + tmp19 * m22) -\r\n      (tmp18 * m22 + tmp21 * m32 + tmp13 * m02));\r\n    dst[14] = d * ((tmp18 * m12 + tmp23 * m32 + tmp15 * m02) -\r\n      (tmp22 * m32 + tmp14 * m02 + tmp19 * m12));\r\n    dst[15] = d * ((tmp22 * m22 + tmp16 * m02 + tmp21 * m12) -\r\n      (tmp20 * m12 + tmp23 * m22 + tmp17 * m02));\r\n    return dst;\r\n  },\r\n\r\n  lookAt(eye, target, up, dst) {\r\n    return mat4.inverse(mat4.cameraAim(eye, target, up, dst), dst);\r\n  },\r\n\r\n  translation([tx, ty, tz], dst) {\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = 1; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = 1; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = 1; dst[11] = 0;\r\n    dst[12] = tx; dst[13] = ty; dst[14] = tz; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  rotationX(angleInRadians, dst) {\r\n    const c = Math.cos(angleInRadians);\r\n    const s = Math.sin(angleInRadians);\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = 1; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = c; dst[6] = s; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = -s; dst[10] = c; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  rotationY(angleInRadians, dst) {\r\n    const c = Math.cos(angleInRadians);\r\n    const s = Math.sin(angleInRadians);\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = c; dst[1] = 0; dst[2] = -s; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = 1; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = s; dst[9] = 0; dst[10] = c; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  rotationZ(angleInRadians, dst) {\r\n    const c = Math.cos(angleInRadians);\r\n    const s = Math.sin(angleInRadians);\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = c; dst[1] = s; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = -s; dst[5] = c; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = 1; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  scaling([sx, sy, sz], dst) {\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = sx; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = sy; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = sz; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  translate(m, translation, dst) {\r\n    return mat4.multiply(m, mat4.translation(translation), dst);\r\n  },\r\n\r\n  rotateX(m, angleInRadians, dst) {\r\n    return mat4.multiply(m, mat4.rotationX(angleInRadians), dst);\r\n  },\r\n\r\n  rotateY(m, angleInRadians, dst) {\r\n    return mat4.multiply(m, mat4.rotationY(angleInRadians), dst);\r\n  },\r\n\r\n  rotateZ(m, angleInRadians, dst) {\r\n    return mat4.multiply(m, mat4.rotationZ(angleInRadians), dst);\r\n  },\r\n\r\n  scale(m, scale, dst) {\r\n    return mat4.multiply(m, mat4.scaling(scale), dst);\r\n  },\r\n};\r\n\r\nexport function degToRad(degrees) {return (degrees * Math.PI) / 180};\r\n\r\nexport function radToDeg(r) {var pi = Math.PI; return r * (180 / pi)};\r\n\r\nexport function createAppEvent(name, myDetails) {\r\n  return new CustomEvent(name, {\r\n    detail: {\r\n      eventName: name,\r\n      data: myDetails,\r\n    },\r\n    bubbles: true,\r\n  });\r\n}\r\n\r\n/**\r\n * @description\r\n * Load script in runtime.\r\n */\r\nexport var scriptManager = {\r\n  SCRIPT_ID: 0,\r\n  LOAD: function addScript(src, id, type, parent, callback) {\r\n    var s = document.createElement('script');\r\n    s.onload = function() {\r\n      // console.log('Script id loaded [src]: ' + this.src);\r\n      if(typeof callback != 'undefined') callback();\r\n    };\r\n    if(typeof type !== 'undefined') {\r\n      s.setAttribute('type', type);\r\n      s.innerHTML = src;\r\n    } else {s.setAttribute('src', src)}\r\n    if(typeof id !== 'undefined') {s.setAttribute('id', id)}\r\n    if(typeof parent !== 'undefined') {\r\n      document.getElementById(parent).appendChild(s);\r\n      if(typeof callback != 'undefined') callback();\r\n    } else {\r\n      document.body.appendChild(s);\r\n    }\r\n  },\r\n  loadModule: function addScript(src, id, type, parent) {\r\n    console.log('Script id load called ');\r\n    var s = document.createElement('script');\r\n    s.onload = function() {\r\n      scriptManager.SCRIPT_ID++;\r\n    };\r\n\r\n    if(typeof type === 'undefined') {\r\n      s.setAttribute('type', 'module');\r\n      s.setAttribute('src', src);\r\n    } else {\r\n      s.setAttribute('type', type);\r\n      s.innerHTML = src;\r\n    }\r\n\r\n    s.setAttribute('src', src);\r\n    if(typeof id !== 'undefined') {\r\n      s.setAttribute('id', id);\r\n    }\r\n\r\n    if(typeof parent !== 'undefined') {\r\n      document.getElementById(parent).appendChild(s);\r\n    } else {\r\n      document.body.appendChild(s);\r\n    }\r\n  },\r\n  loadGLSL: function(src) {\r\n    return new Promise((resolve) => {\r\n      fetch(src).then((data) => {\r\n        resolve(data.text())\r\n      })\r\n    })\r\n  }\r\n};\r\n\r\n// GET PULSE VALUES IN REAL TIME\r\nexport function OSCILLATOR(min, max, step, options) {\r\n  if(min == null || max == null || step == null) {\r\n    console.log(\"OSCILLATOR ERROR\");\r\n    return;\r\n  }\r\n\r\n  var ROOT = this;\r\n\r\n  // ---- core values ----\r\n  this.min0 = parseFloat(min);\r\n  this.max0 = parseFloat(max);\r\n  this.min = this.min0;\r\n  this.max = this.max0;\r\n\r\n  this.step = parseFloat(step);\r\n  this.value_ = this.min;\r\n  this.status = 0; // 0 up, 1 down\r\n\r\n  // ---- options ----\r\n  options = options || {};\r\n  this.regime = options.regime || \"pingpong\";\r\n  this.resist = parseFloat(options.resist) || 0;          // 0 = infinite\r\n  this.resistMode = options.resistMode || \"linear\";       // linear | exp\r\n  this.stopEpsilon = options.stopEpsilon || 0;            // 0 = never stop\r\n  this.useDelta = options.useDelta || false;\r\n\r\n  // ---- events ----\r\n  this.on_maximum_value = function() {};\r\n  this.on_minimum_value = function() {};\r\n  this.on_stop = function() {};\r\n\r\n  // ---- helpers ----\r\n  this._applyResist = function() {\r\n    if(this.resist <= 0) return;\r\n\r\n    var range = this.max - this.min;\r\n    if(range <= 0) return;\r\n\r\n    var shrink;\r\n\r\n    if(this.resistMode === \"exp\") {\r\n      shrink = range * this.resist;\r\n    } else {\r\n      shrink = (this.max0 - this.min0) * this.resist;\r\n    }\r\n\r\n    this.min += shrink;\r\n    this.max -= shrink;\r\n\r\n    if(this.min > this.max) {\r\n      var c = (this.min + this.max) * 0.5;\r\n      this.min = this.max = c;\r\n    }\r\n  };\r\n\r\n  // ---- UPDATE ----\r\n  this.UPDATE = function(delta) {\r\n    var s = this.step;\r\n    if(this.useDelta && delta !== undefined) {\r\n      s = s * delta;\r\n    }\r\n    // ---------- REGIMES ----------\r\n    switch(this.regime) {\r\n      // ===== PING-PONG =====\r\n      case \"pingpong\":\r\n        if(this.status === 0) {\r\n          this.value_ += s;\r\n          if(this.value_ >= this.max) {\r\n            this.value_ = this.max;\r\n            this.status = 1;\r\n            ROOT.on_maximum_value();\r\n          }\r\n        } else {\r\n          this.value_ -= s;\r\n          if(this.value_ <= this.min) {\r\n            this.value_ = this.min;\r\n            this.status = 0;\r\n            this._applyResist();\r\n            ROOT.on_minimum_value();\r\n          }\r\n        }\r\n        break;\r\n\r\n      // ===== ONLY MIN \u2192 MAX =====\r\n      case \"onlyFromMinToMax\":\r\n        this.value_ += s;\r\n        if(this.value_ >= this.max) {\r\n          this.value_ = this.min;\r\n          this._applyResist();\r\n          ROOT.on_maximum_value();\r\n        }\r\n        break;\r\n\r\n      // ===== MAX \u2192 MIN =====\r\n      case \"fromMaxToMin\":\r\n        this.value_ -= s;\r\n        if(this.value_ <= this.min) {\r\n          this.value_ = this.max;\r\n          this._applyResist();\r\n          ROOT.on_minimum_value();\r\n        }\r\n        break;\r\n\r\n      // ===== ONE SHOT =====\r\n      case \"oneShot\":\r\n        this.value_ += s;\r\n        if(this.value_ >= this.max) {\r\n          this.value_ = this.max;\r\n          ROOT.on_stop();\r\n        }\r\n        break;\r\n\r\n      // ===== SPRING TO CENTER =====\r\n      case \"springCenter\":\r\n        var center = (this.min + this.max) * 0.5;\r\n        var force = (center - this.value_) * this.resist;\r\n        this.value_ += force + s;\r\n\r\n        if(Math.abs(center - this.value_) < this.stopEpsilon) {\r\n          this.value_ = center;\r\n          ROOT.on_stop();\r\n        }\r\n        break;\r\n    }\r\n\r\n    // ---- AUTO STOP ----\r\n    if(this.stopEpsilon > 0) {\r\n      if((this.max - this.min) < this.stopEpsilon) {\r\n        ROOT.on_stop();\r\n      }\r\n    }\r\n\r\n    return this.value_;\r\n  };\r\n}\r\n\r\n\r\n// this is class not func ecma5\r\nexport function SWITCHER() {\r\n  var ROOT = this;\r\n  ROOT.VALUE = 1;\r\n  ROOT.GET = function() {\r\n    ROOT.VALUE = ROOT.VALUE * -1;\r\n    return ROOT.VALUE;\r\n  };\r\n}\r\n\r\nexport function ORBIT(cx, cy, angle, p) {\r\n  var s = Math.sin(angle);\r\n  var c = Math.cos(angle);\r\n  p.x -= cx;\r\n  p.y -= cy;\r\n  var xnew = p.x * c - p.y * s;\r\n  var ynew = p.x * s + p.y * c;\r\n  p.x = xnew + cx;\r\n  p.y = ynew + cy;\r\n  return p;\r\n}\r\n\r\nexport function ORBIT_FROM_ARRAY(cx, cy, angle, p, byIndexs) {\r\n  var s = Math.sin(angle);\r\n  var c = Math.cos(angle);\r\n  p[byIndexs[0]] -= cx;\r\n  p[byIndexs[1]] -= cy;\r\n  var xnew = p[byIndexs[0]] * c - p[byIndexs[1]] * s;\r\n  var ynew = p[byIndexs[0]] * s + p[byIndexs[1]] * c;\r\n  p[byIndexs[0]] = xnew + cx;\r\n  p[byIndexs[1]] = ynew + cy;\r\n  return p;\r\n}\r\n\r\nexport var byId = function(id) {return document.getElementById(id)};\r\nexport function randomFloatFromTo(min, max) {return Math.random() * (max - min) + min;}\r\n\r\nexport function randomIntFromTo(min, max) {\r\n  if(typeof min === 'object' || typeof max === 'object') {\r\n    console.log(\r\n      \"SYS : warning Desciption : Replace object with string , this >> \" + typeof min + ' and ' + typeof min + ' << must be string or number.'\r\n    );\r\n  } else if(typeof min === 'undefined' || typeof max === 'undefined') {\r\n    console.log(\r\n      \"SYS : warning Desciption : arguments (min, max) cant be undefined , this >> \" + typeof min + ' and ' + typeof min + ' << must be string or number.'\r\n    );\r\n  } else {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n  }\r\n}\r\n\r\nexport var urlQuery = (function() {\r\n  var query_string = {};\r\n  var query = window.location.search.substring(1);\r\n  var vars = query.split('&');\r\n  for(var i = 0;i < vars.length;i++) {\r\n    var pair = vars[i].split('=');\r\n    if(typeof query_string[pair[0]] === 'undefined') {\r\n      query_string[pair[0]] = decodeURIComponent(pair[1]);\r\n    } else if(typeof query_string[pair[0]] === 'string') {\r\n      var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];\r\n      query_string[pair[0]] = arr;\r\n    } else {\r\n      query_string[pair[0]].push(decodeURIComponent(pair[1]));\r\n    }\r\n  }\r\n  return query_string;\r\n})();\r\n\r\n\r\nexport function getAxisRot(q1) {\r\n  var x, y, z;\r\n\r\n  // if w>1 acos and sqrt will produce errors, this cant happen if quaternion is normalised\r\n  if(q1.w > 1) q1.normalise();\r\n  var angle = 2 * Math.acos(q1.w);\r\n  // assuming quaternion normalised then w is less than 1, so term always positive.\r\n  var s = Math.sqrt(1 - q1.w * q1.w);\r\n  // test to avoid divide by zero, s is always positive due to sqrt\r\n  if(s < 0.001) {\r\n    // if s close to zero then direction of axis not important\r\n    // if it is important that axis is normalised then replace with x=1; y=z=0;\r\n\r\n    x = q1.x;\r\n    y = q1.y;\r\n    z = q1.z;\r\n  } else {\r\n    x = q1.x / s; // normalise axis\r\n    y = q1.y / s;\r\n    z = q1.z / s;\r\n  }\r\n  return [radToDeg(x), radToDeg(y), radToDeg(z)]\r\n}\r\n\r\nexport function getAxisRot2(targetAxis, Q) {\r\n  Q.normalize(); // if w>1 acos and sqrt will produce errors, this cant happen if quaternion is normalised\r\n  var angle = 2 * Math.acos(Q.w());\r\n  var s = Math.sqrt(1 - Q.w() * Q.w()); // assuming quaternion normalised then w is less than 1, so term always positive.\r\n  if(s < 0.001) { // test to avoid divide by zero, s is always positive due to sqrt\r\n    // if s close to zero then direction of axis not important\r\n    // if it is important that axis is normalised then replace with x=1; y=z=0;\r\n    // targetAxis.x = 1;\r\n    // targetAxis.y = 0;\r\n    // targetAxis.z = 0;\r\n    targetAxis.x = Q.x();\r\n    targetAxis.y = Q.y();\r\n    targetAxis.z = Q.z();\r\n  } else {\r\n    targetAxis.x = Q.x() / s; // normalise axis\r\n    targetAxis.y = Q.y() / s;\r\n    targetAxis.z = Q.z() / s;\r\n  }\r\n  return [targetAxis, angle];\r\n}\r\n\r\nexport function getAxisRot3(Q) {\r\n\r\n  var angle = Math.acos(Q.w) * 2;\r\n  var axis = {};\r\n\r\n  if(Math.sin(Math.acos(angle)) > 0) {\r\n\r\n    axis.x = Q.x / Math.sin(Math.acos(angle / 2));\r\n    axis.y = Q.y / Math.sin(Math.acos(angle / 2));\r\n    axis.z = Q.z / Math.sin(Math.acos(angle / 2));\r\n\r\n  } else {\r\n    axis.x = 0;\r\n    axis.y = 0;\r\n    axis.z = 0;\r\n  }\r\n\r\n  return axis;\r\n}\r\n\r\n// NTO TESTED\r\nexport function quaternion_rotation_matrix(Q) {\r\n\r\n  // Covert a quaternion into a full three-dimensional rotation matrix.\r\n\r\n  // Input\r\n  // :param Q: A 4 element array representing the quaternion (q0,q1,q2,q3) \r\n\r\n  // Output\r\n  // :return: A 3x3 element matrix representing the full 3D rotation matrix. \r\n  //          This rotation matrix converts a point in the local reference \r\n  //          frame to a point in the global reference frame.\r\n  // \"\"\"\r\n  // # Extract the values from Q\r\n  var q0 = Q[0]\r\n  var q1 = Q[1]\r\n  var q2 = Q[2]\r\n  var q3 = Q[3]\r\n\r\n  // # First row of the rotation matrix\r\n  var r00 = 2 * (q0 * q0 + q1 * q1) - 1\r\n  var r01 = 2 * (q1 * q2 - q0 * q3)\r\n  var r02 = 2 * (q1 * q3 + q0 * q2)\r\n\r\n  // # Second row of the rotation matrix\r\n  var r10 = 2 * (q1 * q2 + q0 * q3)\r\n  var r11 = 2 * (q0 * q0 + q2 * q2) - 1\r\n  var r12 = 2 * (q2 * q3 - q0 * q1)\r\n\r\n  // # Third row of the rotation matrix\r\n  var r20 = 2 * (q1 * q3 - q0 * q2)\r\n  var r21 = 2 * (q2 * q3 + q0 * q1)\r\n  var r22 = 2 * (q0 * q0 + q3 * q3) - 1\r\n\r\n  // # 3x3 rotation matrix\r\n  var rot_matrix = [[r00, r01, r02],\r\n  [r10, r11, r12],\r\n  [r20, r21, r22]]\r\n\r\n  return rot_matrix;\r\n}\r\n\r\n// copnsole log graphics\r\nexport const LOG_WARN = 'background: gray; color: yellow; font-size:10px';\r\nexport const LOG_INFO = 'background: green; color: white; font-size:11px';\r\nexport const LOG_MATRIX = \"font-family: stormfaze;color: #lime; font-size:11px;text-shadow: 2px 2px 4px orangered;background: black;\";\r\nexport const LOG_FUNNY = \"font-family: stormfaze;color: #f1f033; font-size:18px;text-shadow: 2px 2px 4px #f335f4, 4px 4px 4px #d64444, 2px 2px 4px #c160a6, 6px 2px 0px #123de3;background: black;\";\r\nexport const LOG_FUNNY_SMALL = \"font-family: stormfaze;color: #f1f033; font-size:10px;text-shadow: 2px 2px 4px #f335f4, 4px 4px 4px #d64444, 1px 1px 2px #c160a6, 3px 1px 0px #123de3;background: black;\";\r\nexport const LOG_FUNNY_BIG_TERMINAL =\r\n  \"font-family: monospace; font-size:15px; font-weight:bold;\" +\r\n  \"color:#33ff33;\" +\r\n  \"text-shadow: 2px 2px 0 #003300;\" +\r\n  \"background:#000; padding:10px 14px;\";\r\nexport const LOG_FUNNY_ARCADE =\r\n  \"font-family: system-ui; font-size:16px; font-weight:400;\" +\r\n  \"color:#ffffff;\" +\r\n  \"text-shadow: 2px 2px 6px #000;\" +\r\n  \"background:linear-gradient(90deg,#111,#222); padding:12px 18px;\";\r\nexport const LOG_FUNNY_BIG_ARCADE =\r\n  \"font-family: system-ui; font-size:24px; font-weight:600;\" +\r\n  \"color:#ffffff;\" +\r\n  \"text-shadow: 2px 2px 6px #000;\" +\r\n  \"background:linear-gradient(90deg,#111,#222); padding:12px 18px;\";\r\nexport const LOG_FUNNY_BIG_NEON =\r\n  \"font-family: stormfaze; font-size:30px; font-weight:900;\" +\r\n  \"color:#00ffff;\" +\r\n  \"text-shadow: 0 0 5px #01d6d6ff, 0 0 10px #00ffff, 4px 4px 0 #ff00ff;\" +\r\n  \"background:black; padding:14px 18px;\";\r\n\r\nexport const LOG_FUNNY_EXTRABIG =\r\n  \"font-family: stormfaze; font-size:230px; font-weight:900;\" +\r\n  \"color:#00ffff;\" +\r\n  \"text-shadow: 0 0 5px #01d6d6ff, 0 0 10px #00ffff, 4px 4px 0 #ff00ff;\" +\r\n  \"background:black; padding:14px 18px;\";\r\n\r\nexport const LOGO_FRAMES = [\r\n  ` M                 `,\r\n  ` MA                 `,\r\n  ` MAT                `,\r\n  ` MATR               `,\r\n  ` MATRI              `,\r\n  ` MATRIX             `,\r\n  ` MATRIX-E           `,\r\n  ` MATRIX-ENG         `,\r\n  ` MATRIX-ENGI        `,\r\n  ` MATRIX-ENGIN       `,\r\n  ` MATRIX-ENGINE      `,\r\n  ` MATRIX-ENGINE-     `,\r\n  ` MATRIX-ENGINE-W    `,\r\n  ` MATRIX-ENGINE-WG   `,\r\n  ` MATRIX-ENGINE-WGPU `\r\n];\r\n\r\nexport function genName(length) {\r\n  const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  let result = \"\";\r\n  for(let i = 0;i < length;i++) {\r\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return result;\r\n}\r\n\r\nexport let mb = {\r\n  root: () => byId('msgBox'),\r\n  pContent: () => byId('not-content'),\r\n  copy: function() {\r\n    navigator.clipboard.writeText(mb.root().children[0].innerText);\r\n  },\r\n  c: 0, ic: 0, t: {},\r\n  setContent: function(content, t) {\r\n    var iMsg = document.createElement('div');\r\n    iMsg.innerHTML = content;\r\n    iMsg.id = `msgbox-loc-${mb.c}`;\r\n    mb.root().appendChild(iMsg);\r\n    iMsg.classList.add('animate1')\r\n    if(t == 'ok') {\r\n      iMsg.style = 'font-family: stormfaze;color:white;padding:7px;margin:2px';\r\n    } else {\r\n      iMsg.style = 'font-family: stormfaze;color:white;padding:7px;margin:2px';\r\n    }\r\n  },\r\n  kill: function() {\r\n    mb.root().remove();\r\n  },\r\n  show: function(content, t) {\r\n    mb.setContent(content, t);\r\n    mb.root().style.display = \"block\";\r\n    var loc2 = mb.c;\r\n    setTimeout(function() {\r\n      byId(`msgbox-loc-${loc2}`).classList.remove(\"fadeInDown\");\r\n      byId(`msgbox-loc-${loc2}`).classList.add(\"fadeOut\");\r\n      setTimeout(function() {\r\n        byId(`msgbox-loc-${loc2}`).style.display = \"none\";\r\n        byId(`msgbox-loc-${loc2}`).classList.remove(\"fadeOut\");\r\n\r\n        byId(`msgbox-loc-${loc2}`).remove();\r\n        mb.ic++;\r\n        if(mb.c == mb.ic) {\r\n          mb.root().style.display = 'none';\r\n        }\r\n      }, 1000)\r\n    }, 3000);\r\n    mb.c++;\r\n  },\r\n  error: function(content) {\r\n    if(mb.root() == null) return;\r\n    mb.root().classList.remove(\"success\")\r\n    mb.root().classList.add(\"error\")\r\n    mb.root().classList.add(\"fadeInDown\");\r\n    mb.show(content, 'err');\r\n  },\r\n  success: function(content) {\r\n    if(mb.root() == null) return;\r\n    mb.root().classList.remove(\"error\")\r\n    mb.root().classList.add(\"success\")\r\n    mb.root().classList.add(\"fadeInDown\");\r\n    mb.show(content, 'ok');\r\n  }\r\n}\r\n\r\n// Registry to track running animations per element\r\nconst typingStates = new Map();\r\n\r\nexport function typeText(elementId, htmlString, delay = 50) {\r\n  const el = document.getElementById(elementId);\r\n  if(!el) return;\r\n\r\n  // If an existing typing is running for this element, cancel it\r\n  if(typingStates.has(elementId)) {\r\n    clearTimeout(typingStates.get(elementId).timeoutId);\r\n    typingStates.delete(elementId);\r\n  }\r\n\r\n  el.innerHTML = ''; // Clear previous content\r\n\r\n  const tempEl = document.createElement('div');\r\n  tempEl.innerHTML = htmlString;\r\n\r\n  const queue = [];\r\n\r\n  function flatten(node) {\r\n    if(node.nodeType === Node.TEXT_NODE) {\r\n      queue.push({type: 'text', text: node.textContent});\r\n    } else if(node.nodeType === Node.ELEMENT_NODE) {\r\n      if(node.tagName.toLowerCase() === 'img') {\r\n        queue.push({\r\n          type: 'img',\r\n          src: node.getAttribute('src'),\r\n          alt: node.getAttribute('alt') || ''\r\n        });\r\n      } else {\r\n        queue.push({\r\n          type: 'element',\r\n          tag: node.tagName.toLowerCase(),\r\n          attributes: Object.fromEntries([...node.attributes].map(attr => [attr.name, attr.value]))\r\n        });\r\n        for(const child of node.childNodes) flatten(child);\r\n        queue.push({type: 'end'});\r\n      }\r\n    }\r\n  }\r\n\r\n  for(const node of tempEl.childNodes) flatten(node);\r\n\r\n  let stack = [];\r\n  let currentElement = el;\r\n\r\n  function typeNextChar() {\r\n    if(queue.length === 0) {\r\n      typingStates.delete(elementId); // Cleanup after finish\r\n      return;\r\n    }\r\n\r\n    const item = queue[0];\r\n\r\n    if(item.type === 'text') {\r\n      if(!item.index) item.index = 0;\r\n\r\n      const ch = item.text[item.index];\r\n      if(ch === '\\n') {\r\n        currentElement.appendChild(document.createElement('br'));\r\n      } else {\r\n        currentElement.appendChild(document.createTextNode(ch));\r\n      }\r\n\r\n      item.index++;\r\n      if(item.index >= item.text.length) queue.shift();\r\n\r\n    } else if(item.type === 'element') {\r\n      const newEl = document.createElement(item.tag);\r\n      if(item.attributes) {\r\n        for(let [key, val] of Object.entries(item.attributes)) {\r\n          newEl.setAttribute(key, val);\r\n        }\r\n      }\r\n      currentElement.appendChild(newEl);\r\n      stack.push(currentElement);\r\n      currentElement = newEl;\r\n      queue.shift();\r\n\r\n    } else if(item.type === 'end') {\r\n      currentElement = stack.pop();\r\n      queue.shift();\r\n\r\n    } else if(item.type === 'img') {\r\n      const img = document.createElement('img');\r\n      img.src = item.src;\r\n      img.alt = item.alt;\r\n      img.style.maxWidth = '100px';\r\n      img.style.verticalAlign = 'middle';\r\n      currentElement.appendChild(img);\r\n      queue.shift();\r\n    }\r\n\r\n    // Schedule next step and store timeoutId for control\r\n    const timeoutId = setTimeout(typeNextChar, delay);\r\n    typingStates.set(elementId, {timeoutId});\r\n  }\r\n\r\n  typeNextChar();\r\n}\r\n\r\n\r\nexport function setupCanvasFilters(canvasId) {\r\n  let canvas = document.getElementById(canvasId);\r\n  if(canvas == null) {\r\n    canvas = document.getElementsByTagName('canvas')[0];\r\n  }\r\n\r\n  const filterState = {\r\n    blur: \"0px\",\r\n    grayscale: \"0%\",\r\n    brightness: \"100%\",\r\n    contrast: \"100%\",\r\n    saturate: \"100%\",\r\n    sepia: \"0%\",\r\n    invert: \"0%\",\r\n    hueRotate: \"0deg\"\r\n  };\r\n\r\n  function updateFilter() {\r\n    const filterString = `\r\n      blur(${filterState.blur}) \r\n      grayscale(${filterState.grayscale}) \r\n      brightness(${filterState.brightness}) \r\n      contrast(${filterState.contrast}) \r\n      saturate(${filterState.saturate}) \r\n      sepia(${filterState.sepia}) \r\n      invert(${filterState.invert}) \r\n      hue-rotate(${filterState.hueRotate})\r\n    `.trim();\r\n\r\n    canvas.style.filter = filterString;\r\n  }\r\n\r\n  const bindings = {\r\n    blurControl: \"blur\",\r\n    grayscaleControl: \"grayscale\",\r\n    brightnessControl: \"brightness\",\r\n    contrastControl: \"contrast\",\r\n    saturateControl: \"saturate\",\r\n    sepiaControl: \"sepia\",\r\n    invertControl: \"invert\",\r\n    hueControl: \"hueRotate\"\r\n  };\r\n\r\n  Object.entries(bindings).forEach(([selectId, key]) => {\r\n    const el = document.getElementById(selectId);\r\n    el.addEventListener(\"change\", (e) => {\r\n      filterState[key] = e.target.value;\r\n      updateFilter();\r\n    });\r\n  });\r\n\r\n  updateFilter(); // Initial\r\n}\r\n\r\n/**\r\n * @description\r\n * // Save an object\r\n    Storage.set('playerData', { name: 'Slayzer', hp: 120, mana: 80 });\r\n\r\n    // Load it back\r\n    const player = Storage.get('playerData');\r\n    console.log(player.name); // \"Slayzer\"\r\n\r\n    // Check if exists\r\n    if (Storage.has('playerData')) console.log('Found!');\r\n\r\n    // Remove one\r\n    Storage.remove('playerData');\r\n\r\n    // Clear all localStorage\r\n    Storage.clear();\r\n */\r\nexport const LS = {\r\n  set(key, value) {\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  },\r\n\r\n  get(key, defaultValue = null) {\r\n    const item = localStorage.getItem(key);\r\n    try {\r\n      return item ? JSON.parse(item) : defaultValue;\r\n    } catch(e) {\r\n      console.warn(`Error parsing localStorage key \"${key}\"`, e);\r\n      return defaultValue;\r\n    }\r\n  },\r\n\r\n  has(key) {\r\n    return localStorage.getItem(key) !== null;\r\n  },\r\n\r\n  remove(key) {\r\n    localStorage.removeItem(key);\r\n  },\r\n\r\n  clear() {\r\n    localStorage.clear();\r\n  }\r\n};\r\n\r\nexport const SS = {\r\n  set(key, value) {\r\n    sessionStorage.setItem(key, JSON.stringify(value));\r\n  },\r\n\r\n  get(key, defaultValue = null) {\r\n    const item = sessionStorage.getItem(key);\r\n    try {\r\n      return item ? JSON.parse(item) : defaultValue;\r\n    } catch(e) {\r\n      console.warn(`Error parsing sessionStorage key \"${key}\"`, e);\r\n      return defaultValue;\r\n    }\r\n  },\r\n\r\n  has(key) {\r\n    return sessionStorage.getItem(key) !== null;\r\n  },\r\n\r\n  remove(key) {\r\n    sessionStorage.removeItem(key);\r\n  },\r\n\r\n  clear() {\r\n    sessionStorage.clear();\r\n  }\r\n};\r\nexport const jsonHeaders = new Headers({\r\n  \"Content-Type\": \"application/json\",\r\n  \"Accept\": \"application/json\",\r\n});\r\n\r\nexport const htmlHeader = new Headers({\r\n  \"Content-Type\": \"text/html\",\r\n  \"Accept\": \"text/plain\",\r\n});\r\n\r\nexport function isEven(n) {\r\n  return n % 2 === 0;\r\n}\r\n\r\nexport function isOdd(n) {\r\n  return n % 2 !== 0;\r\n}\r\n\r\nexport class FullscreenManagerElement {\r\n  constructor(targetElement = document.documentElement) {\r\n    this.target = targetElement;\r\n  }\r\n\r\n  isFullscreen() {\r\n    return !!(\r\n      document.fullscreenElement ||\r\n      document.webkitFullscreenElement ||\r\n      document.mozFullScreenElement ||\r\n      document.msFullscreenElement\r\n    );\r\n  }\r\n\r\n  request() {\r\n    const el = this.target;\r\n    return (\r\n      el.requestFullscreen?.() ||\r\n      el.webkitRequestFullscreen?.() ||\r\n      el.mozRequestFullScreen?.() ||\r\n      el.msRequestFullscreen?.()\r\n    );\r\n  }\r\n\r\n  exit() {\r\n    return (\r\n      document.exitFullscreen?.() ||\r\n      document.webkitExitFullscreen?.() ||\r\n      document.mozCancelFullScreen?.() ||\r\n      document.msExitFullscreen?.()\r\n    );\r\n  }\r\n\r\n  toggle() {\r\n    if(this.isFullscreen()) return this.exit();\r\n    return this.request();\r\n  }\r\n\r\n  onChange(callback) {\r\n    [\r\n      \"fullscreenchange\",\r\n      \"webkitfullscreenchange\",\r\n      \"mozfullscreenchange\",\r\n      \"MSFullscreenChange\"\r\n    ].forEach(evt =>\r\n      document.addEventListener(evt, () => {\r\n        callback(this.isFullscreen(), this.target);\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nexport class FullscreenManager {\r\n  constructor() {\r\n    this.target = document.documentElement; // fullscreen whole page / window\r\n  }\r\n\r\n  isFullscreen() {\r\n    return !!(\r\n      document.fullscreenElement ||\r\n      document.webkitFullscreenElement ||\r\n      document.mozFullScreenElement ||\r\n      document.msFullscreenElement\r\n    );\r\n  }\r\n\r\n  request() {\r\n    const el = this.target;\r\n    return (\r\n      el.requestFullscreen?.() ||\r\n      el.webkitRequestFullscreen?.() ||\r\n      el.mozRequestFullScreen?.() ||\r\n      el.msRequestFullscreen?.()\r\n    );\r\n  }\r\n\r\n  exit() {\r\n    return (\r\n      document.exitFullscreen?.() ||\r\n      document.webkitExitFullscreen?.() ||\r\n      document.mozCancelFullScreen?.() ||\r\n      document.msExitFullscreen?.()\r\n    );\r\n  }\r\n\r\n  toggle() {\r\n    return this.isFullscreen() ? this.exit() : this.request();\r\n  }\r\n\r\n  onChange(callback) {\r\n    [\r\n      \"fullscreenchange\",\r\n      \"webkitfullscreenchange\",\r\n      \"mozfullscreenchange\",\r\n      \"MSFullscreenChange\"\r\n    ].forEach(evt =>\r\n      document.addEventListener(evt, () => {\r\n        callback(this.isFullscreen());\r\n      })\r\n    );\r\n  }\r\n}\r\n", "// Note: The code in this file does not use the 'dst' output parameter of functions in the\r\n// 'wgpu-matrix' library, so produces many temporary vectors and matrices.\r\n// This is intentional, as this sample prefers readability over performance.\r\nimport {mat4, vec3} from 'wgpu-matrix';\r\nimport {LOG_INFO} from './utils';\r\n\r\n// The common functionality between camera implementations\r\nclass CameraBase {\r\n  // The camera matrix\r\n  matrix_ = new Float32Array([\r\n    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1,\r\n  ]);\r\n\r\n  // The calculated view matrix readonly\r\n  view_ = mat4.create();\r\n\r\n  // Aliases to column vectors of the matrix\r\n  right_ = new Float32Array(this.matrix_.buffer, 4 * 0, 4);\r\n  up_ = new Float32Array(this.matrix_.buffer, 4 * 4, 4);\r\n  back_ = new Float32Array(this.matrix_.buffer, 4 * 8, 4);\r\n  position_ = new Float32Array(this.matrix_.buffer, 4 * 12, 4);\r\n\r\n  // Returns the camera matrix\r\n  get matrix() {\r\n    return this.matrix_;\r\n  }\r\n  // Assigns `mat` to the camera matrix\r\n  set matrix(mat) {\r\n    mat4.copy(mat, this.matrix_);\r\n  }\r\n\r\n  // setProjection(fov = (2*Math.PI) / 5 , aspect = 1, near = 0.5, far = 1000) {\r\n  //   this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  // }\r\n\r\n  // Returns the camera view matrix\r\n  get view() {\r\n    return this.view_;\r\n  }\r\n  // Assigns `mat` to the camera view\r\n  set view(mat) {\r\n    mat4.copy(mat, this.view_);\r\n  }\r\n\r\n  // Returns column vector 0 of the camera matrix\r\n  get right() {\r\n    return this.right_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 0 of the camera matrix\r\n  set right(vec) {\r\n    vec3.copy(vec, this.right_);\r\n  }\r\n\r\n  // Returns column vector 1 of the camera matrix\r\n  get up() {\r\n    return this.up_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 1 of the camera matrix \\ Vec3\r\n  set up(vec) {\r\n    vec3.copy(vec, this.up_);\r\n  }\r\n\r\n  // Returns column vector 2 of the camera matrix\r\n  get back() {\r\n    return this.back_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 2 of the camera matrix\r\n  set back(vec) {\r\n    vec3.copy(vec, this.back_);\r\n  }\r\n\r\n  // Returns column vector 3 of the camera matrix\r\n  get position() {\r\n    return this.position_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 3 of the camera matrix\r\n  set position(vec) {\r\n    vec3.copy(vec, this.position_);\r\n  }\r\n}\r\n\r\n// WASDCamera is a camera implementation that behaves similar to first-person-shooter PC games.\r\nexport class WASDCamera extends CameraBase {\r\n  // The camera absolute pitch angle\r\n  pitch = 0;\r\n  // The camera absolute yaw angle\r\n  yaw = 0;\r\n\r\n  setPitch = (pitch) => {\r\n    this.pitch = pitch;\r\n  }\r\n\r\n  setYaw = (yaw) => {\r\n    this.yaw = yaw;\r\n  }\r\n\r\n  setX = (x) => {\r\n    this.position[0] = x;\r\n  }\r\n\r\n  setY = (y) => {\r\n    this.position[1] = y;\r\n  }\r\n\r\n  setZ = (z) => {\r\n    this.position[2] = z;\r\n  }\r\n\r\n  // The movement veloicty readonly\r\n  velocity_ = vec3.create();\r\n\r\n  // Speed multiplier for camera movement\r\n  movementSpeed = 10;\r\n\r\n  // Speed multiplier for camera rotation\r\n  rotationSpeed = 1;\r\n\r\n  // Movement velocity drag coeffient [0 .. 1]\r\n  // 0: Continues forever\r\n  // 1: Instantly stops moving\r\n  frictionCoefficient = 0.99;\r\n\r\n  // Returns velocity vector\r\n  get velocity() {\r\n    return this.velocity_;\r\n  }\r\n  // Assigns `vec` to the velocity vector\r\n  set velocity(vec) {\r\n    vec3.copy(vec, this.velocity_);\r\n  }\r\n\r\n  setProjection(fov = (2 * Math.PI) / 5, aspect = 1, near = 1, far = 1000) {\r\n    this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  }\r\n\r\n  constructor(options) {\r\n    super();\r\n    if(options && (options.position || options.target)) {\r\n      const position = options.position ?? vec3.create(0, 0, 0);\r\n      const target = options.target ?? vec3.create(0, 0, 0);\r\n      const forward = vec3.normalize(vec3.sub(target, position));\r\n      this.recalculateAngles(forward);\r\n      this.position = position;\r\n      this.canvas = options.canvas;\r\n      this.aspect = options.canvas.width / options.canvas.height;\r\n      this.setProjection((2 * Math.PI) / 5, this.aspect, 1, 2000);\r\n      this.suspendDrag = false;\r\n      if(options.pitch) this.setPitch(options.pitch)\r\n      if(options.yaw) this.setYaw(options.yaw)\r\n      // console.log(`%cCamera constructor : ${position}`, LOG_INFO);\r\n    }\r\n  }\r\n\r\n  // Returns the camera matrix\r\n  get matrix() {\r\n    return super.matrix;\r\n  }\r\n\r\n  // Assigns `mat` to the camera matrix, and recalcuates the camera angles\r\n  set matrix(mat) {\r\n    super.matrix = mat;\r\n    this.recalculateAngles(this.back);\r\n  }\r\n\r\n  update(deltaTime, input) {\r\n    const sign = (positive, negative) =>\r\n      (positive ? 1 : 0) - (negative ? 1 : 0);\r\n\r\n    if(this.suspendDrag == false) {\r\n      // Apply the delta rotation to the pitch and yaw angles\r\n      this.yaw -= input.analog.x * deltaTime * this.rotationSpeed;\r\n      this.pitch -= input.analog.y * deltaTime * this.rotationSpeed;\r\n    }\r\n\r\n    // Wrap yaw between [0\u00B0 .. 360\u00B0], just to prevent large accumulation.\r\n    this.yaw = mod(this.yaw, Math.PI * 2);\r\n    // Clamp pitch between [-90\u00B0 .. +90\u00B0] to prevent somersaults.\r\n    this.pitch = clamp(this.pitch, -Math.PI / 2, Math.PI / 2);\r\n\r\n    // Save the current position, as we're about to rebuild the camera matrix.\r\n    const position = vec3.copy(this.position);\r\n\r\n    // Reconstruct the camera's rotation, and store into the camera matrix.\r\n    super.matrix = mat4.rotateX(mat4.rotationY(this.yaw), this.pitch);\r\n    // super.matrix = mat4.rotateX(mat4.rotationY(this.yaw), -this.pitch);\r\n    // super.matrix = mat4.rotateY(mat4.rotateX(this.pitch), this.yaw);\r\n\r\n    // Calculate the new target velocity\r\n    const digital = input.digital;\r\n    const deltaRight = sign(digital.right, digital.left);\r\n    const deltaUp = sign(digital.up, digital.down);\r\n    const targetVelocity = vec3.create();\r\n    const deltaBack = sign(digital.backward, digital.forward);\r\n    vec3.addScaled(targetVelocity, this.right, deltaRight, targetVelocity);\r\n    vec3.addScaled(targetVelocity, this.up, deltaUp, targetVelocity);\r\n    vec3.addScaled(targetVelocity, this.back, deltaBack, targetVelocity);\r\n    vec3.normalize(targetVelocity, targetVelocity);\r\n    vec3.mulScalar(targetVelocity, this.movementSpeed, targetVelocity);\r\n\r\n    // Mix new target velocity\r\n    this.velocity = lerp(\r\n      targetVelocity,\r\n      this.velocity,\r\n      Math.pow(1 - this.frictionCoefficient, deltaTime)\r\n    );\r\n\r\n    // Integrate velocity to calculate new position\r\n    this.position = vec3.addScaled(position, this.velocity, deltaTime);\r\n\r\n    // Invert the camera matrix to build the view matrix\r\n    this.view = mat4.invert(this.matrix);\r\n    return this.view;\r\n  }\r\n\r\n  // Recalculates the yaw and pitch values from a directional vector\r\n  recalculateAngles(dir) {\r\n    this.yaw = Math.atan2(dir[0], dir[2]);\r\n    this.pitch = -Math.asin(dir[1]);\r\n  }\r\n}\r\n\r\n// ArcballCamera implements a basic orbiting camera around the world origin\r\nexport class ArcballCamera extends CameraBase {\r\n  // The camera distance from the target\r\n  distance = 0;\r\n\r\n  // The current angular velocity\r\n  angularVelocity = 0;\r\n\r\n  // The current rotation axis\r\n  axis_ = vec3.create();\r\n\r\n  // Returns the rotation axis\r\n  get axis() {\r\n    return this.axis_;\r\n  }\r\n  // Assigns `vec` to the rotation axis\r\n  set axis(vec) {\r\n    vec3.copy(vec, this.axis_);\r\n  }\r\n\r\n  // Speed multiplier for camera rotation\r\n  rotationSpeed = 1;\r\n\r\n  // Speed multiplier for camera zoom\r\n  zoomSpeed = 0.1;\r\n\r\n  // Rotation velocity drag coeffient [0 .. 1]\r\n  // 0: Spins forever\r\n  // 1: Instantly stops spinning\r\n  frictionCoefficient = 0.999;\r\n\r\n  setProjection(fov = (2 * Math.PI) / 5, aspect = 1, near = 1, far = 1000) {\r\n    this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  }\r\n  // Construtor\r\n  constructor(options) {\r\n    super();\r\n    if(options && options.position) {\r\n      this.position = options.position;\r\n      this.distance = vec3.len(this.position);\r\n      this.back = vec3.normalize(this.position);\r\n\r\n      this.setProjection((2 * Math.PI) / 5, this.aspect, 1, 2000);\r\n\r\n      this.recalcuateRight();\r\n      this.recalcuateUp();\r\n    }\r\n  }\r\n\r\n  // Returns the camera matrix\r\n  get matrix() {\r\n    return super.matrix;\r\n  }\r\n\r\n  // Assigns `mat` to the camera matrix, and recalcuates the distance\r\n  set matrix(mat) {\r\n    super.matrix = mat;\r\n    this.distance = vec3.len(this.position);\r\n  }\r\n\r\n  update(deltaTime, input) {\r\n    const epsilon = 0.0000001;\r\n\r\n    if(input.analog.touching) {\r\n      // Currently being dragged.\r\n      this.angularVelocity = 0;\r\n    } else {\r\n      // Dampen any existing angular velocity\r\n      this.angularVelocity *= Math.pow(1 - this.frictionCoefficient, deltaTime);\r\n    }\r\n\r\n    // Calculate the movement vector\r\n    const movement = vec3.create();\r\n    vec3.addScaled(movement, this.right, input.analog.x, movement);\r\n    vec3.addScaled(movement, this.up, -input.analog.y, movement);\r\n\r\n    // Cross the movement vector with the view direction to calculate the rotation axis x magnitude\r\n    const crossProduct = vec3.cross(movement, this.back);\r\n\r\n    // Calculate the magnitude of the drag\r\n    const magnitude = vec3.len(crossProduct);\r\n\r\n    if(magnitude > epsilon) {\r\n      // Normalize the crossProduct to get the rotation axis\r\n      this.axis = vec3.scale(crossProduct, 1 / magnitude);\r\n\r\n      // Remember the current angular velocity. This is used when the touch is released for a fling.\r\n      this.angularVelocity = magnitude * this.rotationSpeed;\r\n    }\r\n\r\n    // The rotation around this.axis to apply to the camera matrix this update\r\n    const rotationAngle = this.angularVelocity * deltaTime;\r\n    if(rotationAngle > epsilon) {\r\n      // Rotate the matrix around axis\r\n      // Note: The rotation is not done as a matrix-matrix multiply as the repeated multiplications\r\n      // will quickly introduce substantial error into the matrix.\r\n      this.back = vec3.normalize(rotate(this.back, this.axis, rotationAngle));\r\n      this.recalcuateRight();\r\n      this.recalcuateUp();\r\n    }\r\n\r\n    // recalculate `this.position` from `this.back` considering zoom\r\n    if(input.analog.zoom !== 0) {\r\n      this.distance *= 1 + input.analog.zoom * this.zoomSpeed;\r\n    }\r\n    this.position = vec3.scale(this.back, this.distance);\r\n\r\n    // Invert the camera matrix to build the view matrix\r\n    this.view = mat4.invert(this.matrix);\r\n    return this.view;\r\n  }\r\n\r\n  // Assigns `this.right` with the cross product of `this.up` and `this.back`\r\n  recalcuateRight() {\r\n    this.right = vec3.normalize(vec3.cross(this.up, this.back));\r\n  }\r\n\r\n  // Assigns `this.up` with the cross product of `this.back` and `this.right`\r\n  recalcuateUp() {\r\n    this.up = vec3.normalize(vec3.cross(this.back, this.right));\r\n  }\r\n}\r\n\r\n// Returns `x` clamped between [`min` .. `max`]\r\nfunction clamp(x, min, max) {\r\n  return Math.min(Math.max(x, min), max);\r\n}\r\n\r\n// Returns `x` float-modulo `div`\r\nfunction mod(x, div) {\r\n  return x - Math.floor(Math.abs(x) / div) * div * Math.sign(x);\r\n}\r\n\r\n// Returns `vec` rotated `angle` radians around `axis`\r\nfunction rotate(vec, axis, angle) {\r\n  return vec3.transformMat4Upper3x3(vec, mat4.rotation(axis, angle));\r\n}\r\n\r\n// Returns the linear interpolation between 'a' and 'b' using 's'\r\nfunction lerp(a, b, s) {\r\n  return vec3.addScaled(a, vec3.sub(b, a), s);\r\n}\r\n\r\nexport function createInputHandler(window, canvas) {\r\n  let digital = {\r\n    forward: false,\r\n    backward: false,\r\n    left: false,\r\n    right: false,\r\n    up: false,\r\n    down: false,\r\n  };\r\n  let analog = {\r\n    x: 0,\r\n    y: 0,\r\n    zoom: 0,\r\n  };\r\n  let mouseDown = false;\r\n\r\n  const setDigital = (e, value) => {\r\n    switch(e.code) {\r\n      case 'KeyW': digital.forward = value; break;\r\n      case 'KeyS': digital.backward = value; break;\r\n      case 'KeyA': digital.left = value; break;\r\n      case 'KeyD': digital.right = value; break;\r\n      case 'KeyV': digital.up = value; break;\r\n      case 'KeyC': digital.down = value; break;\r\n    }\r\n    // if you wanna dosavle all keyboard input for some reason...\r\n    // add later like new option feature...\r\n    // e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  window.addEventListener('keydown', (e) => setDigital(e, true));\r\n  window.addEventListener('keyup', (e) => setDigital(e, false));\r\n\r\n  canvas.style.touchAction = 'pinch-zoom';\r\n  canvas.addEventListener('pointerdown', () => {mouseDown = true;});\r\n  canvas.addEventListener('pointerup', () => {mouseDown = false;});\r\n  canvas.addEventListener('pointermove', (e) => {\r\n    mouseDown = e.pointerType === 'mouse' ? (e.buttons & 1) !== 0 : true;\r\n    if(mouseDown) {\r\n      analog.x += e.movementX / 10;\r\n      analog.y += e.movementY / 10;\r\n    }\r\n  });\r\n\r\n  canvas.addEventListener('wheel', (e) => {\r\n    // if((e.buttons & 1) !== 0) {\r\n    //   analog.zoom += Math.sign(e.deltaY);\r\n    //   e.preventDefault();\r\n    //   e.stopPropagation();\r\n    // }\r\n  }, {passive: false});\r\n\r\n  return () => {\r\n    // Guard: prevent zero deltas from breaking camera math\r\n    const safeX = analog.x || 0.0001;\r\n    const safeY = analog.y || 0.0001;\r\n    const out = {\r\n      digital,\r\n      analog: {\r\n        x: safeX,\r\n        y: safeY,\r\n        zoom: analog.zoom,\r\n        touching: mouseDown,\r\n      },\r\n    };\r\n    // Reset only the deltas for next frame\r\n    analog.x = 0;\r\n    analog.y = 0;\r\n    analog.zoom = 0;\r\n    return out;\r\n  };\r\n}\r\n\r\nexport class RPGCamera extends CameraBase {\r\n  followMe = null;\r\n  pitch = 0;\r\n  yaw = 0;\r\n  velocity_ = vec3.create();\r\n  movementSpeed = 10;\r\n  rotationSpeed = 1;\r\n  followMeOffset = 150; // << mobile adaptation needed after all...\r\n  // Movement velocity drag coeffient [0 .. 1]\r\n  // 0: Continues forever\r\n  // 1: Instantly stops moving\r\n  frictionCoefficient = 0.99;\r\n  // Inside your camera control init\r\n  scrollY = 50;\r\n  minY = 50.5;   // minimum camera height\r\n  maxY = 135.0;   // maximum camera height\r\n  scrollSpeed = 1;\r\n\r\n  get velocity() {\r\n    return this.velocity_;\r\n  }\r\n\r\n  set velocity(vec) {\r\n    vec3.copy(vec, this.velocity_);\r\n  }\r\n\r\n  setProjection(fov = (2 * Math.PI) / 5, aspect = 1, near = 1, far = 1000) {\r\n    this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  }\r\n\r\n  constructor(options) {\r\n    super();\r\n    if(options && (options.position || options.target)) {\r\n      const position = options.position ?? vec3.create(0, 0, 0);\r\n      const target = options.target ?? vec3.create(0, 0, 0);\r\n      const forward = vec3.normalize(vec3.sub(target, position));\r\n      this.recalculateAngles(forward);\r\n      this.position = position;\r\n      this.canvas = options.canvas;\r\n      this.aspect = options.canvas.width / options.canvas.height;\r\n      this.setProjection((2 * Math.PI) / 5, this.aspect, 1, 2000);\r\n      // console.log(`%cCamera constructor : ${position}`, LOG_INFO);\r\n\r\n      this.mousRollInAction = false;\r\n      addEventListener('wheel', (e) => {\r\n        // Scroll up = zoom out / higher Y\r\n        this.mousRollInAction = true;\r\n        this.scrollY -= e.deltaY * this.scrollSpeed * 0.01;\r\n        // Clamp to range\r\n        this.scrollY = Math.max(this.minY, Math.min(this.maxY, this.scrollY));\r\n      });\r\n    }\r\n  }\r\n\r\n  get matrix() {\r\n    return super.matrix;\r\n  }\r\n\r\n  // Assigns `mat` to the camera matrix, and recalcuates the camera angles\r\n  set matrix(mat) {\r\n    super.matrix = mat;\r\n    this.recalculateAngles(this.back);\r\n  }\r\n\r\n  update(deltaTime, input) {\r\n    const sign = (positive, negative) =>\r\n      (positive ? 1 : 0) - (negative ? 1 : 0);\r\n    // Apply the delta rotation to the pitch and yaw angles\r\n    this.yaw = 0;//-= input.analog.x * deltaTime * this.rotationSpeed;\r\n    this.pitch = -0.88;//  -= input.analog.y * deltaTime * this.rotationSpeed;\r\n    // // Wrap yaw between [0\u00B0 .. 360\u00B0], just to prevent large accumulation.\r\n    this.yaw = mod(this.yaw, Math.PI * 2);\r\n    // // Clamp pitch between [-90\u00B0 .. +90\u00B0] to prevent somersaults.\r\n    this.pitch = clamp(this.pitch, -Math.PI / 2, Math.PI / 2);\r\n    // Save the current position, as we're about to rebuild the camera matrix.\r\n    if(this.followMe != null && this.followMe.inMove === true ||\r\n      this.mousRollInAction == true\r\n    ) {\r\n      //  console.log(\"  follow : \" + this.followMe.x)\r\n\r\n      this.followMeOffset = this.scrollY;\r\n      // if player not move allow mouse explore map \r\n      this.position[0] = this.followMe.x;\r\n      this.position[2] = this.followMe.z + this.followMeOffset;\r\n      app.lightContainer[0].position[0] = this.followMe.x;\r\n      app.lightContainer[0].position[2] = this.followMe.z;\r\n      app.lightContainer[0].target[0] = this.followMe.x;\r\n      app.lightContainer[0].target[2] = this.followMe.z;\r\n\r\n      this.mousRollInAction = false;\r\n    }\r\n\r\n\r\n    const smoothFactor = 0.1;\r\n    this.position[1] += (this.scrollY - this.position[1]) * smoothFactor;\r\n\r\n    let position = vec3.copy(this.position);\r\n    // Reconstruct the camera's rotation, and store into the camera matrix.\r\n    super.matrix = mat4.rotateX(mat4.rotationY(this.yaw), this.pitch);\r\n    // Calculate the new target velocity\r\n    const digital = input.digital;\r\n    const deltaRight = sign(digital.right, digital.left);\r\n    const deltaUp = sign(digital.up, digital.down);\r\n    const targetVelocity = vec3.create();\r\n    const deltaBack = sign(digital.backward, digital.forward);\r\n    // older then follow\r\n    if(deltaBack == -1) {\r\n      // console.log(deltaBack + \"  deltaBack \")\r\n      position[2] += -10;\r\n    } else if(deltaBack == 1) {\r\n      position[2] += 10;\r\n    }\r\n    position[0] += deltaRight * 10;\r\n    vec3.addScaled(targetVelocity, this.right, deltaRight, targetVelocity);\r\n    vec3.addScaled(targetVelocity, this.up, deltaUp, targetVelocity);\r\n    vec3.normalize(targetVelocity, targetVelocity);\r\n    vec3.mulScalar(targetVelocity, this.movementSpeed, targetVelocity);\r\n    this.velocity = lerp(\r\n      targetVelocity,\r\n      this.velocity,\r\n      Math.pow(1 - this.frictionCoefficient, deltaTime)\r\n    );\r\n    this.position = vec3.addScaled(position, this.velocity, deltaTime);\r\n    this.view = mat4.invert(this.matrix);\r\n    return this.view;\r\n  }\r\n\r\n  recalculateAngles(dir) {\r\n    this.yaw = Math.atan2(dir[0], dir[2]);\r\n    this.pitch = -Math.asin(dir[1]);\r\n  }\r\n}\r\n", "import {degToRad, radToDeg} from \"./utils\";\r\n\r\n/**\r\n * @description \r\n * Sub classes for matrix-wgpu\r\n * Base class\r\n * Position { x, y, z }\r\n */\r\n\r\nexport class Position {\r\n  constructor(x, y, z) {\r\n    // console.log('TEST TYTPOF ', x)\r\n    this.remoteName = null;\r\n    this.netObject = null;\r\n    this.toRemote = [];\r\n    this.teams = [];\r\n\r\n    this.netTolerance = 3;\r\n    this.netTolerance__ = 0;\r\n\r\n    if(typeof x == 'undefined') x = 0;\r\n    if(typeof y == 'undefined') y = 0;\r\n    if(typeof z == 'undefined') z = 0;\r\n\r\n    this.x = parseFloat(x);\r\n    this.y = parseFloat(y);\r\n    this.z = parseFloat(z);\r\n\r\n    this.velY = 0;\r\n    this.velX = 0;\r\n    this.velZ = 0;\r\n    this.inMove = false;\r\n    this.targetX = parseFloat(x);\r\n    this.targetY = parseFloat(y);\r\n    this.targetZ = parseFloat(z);\r\n    this.thrust = 0.01;\r\n\r\n    return this;\r\n  }\r\n\r\n  getSpeed = () => {\r\n    return this.thrust;\r\n  }\r\n\r\n  setSpeed = (n) => {\r\n    if(typeof n === 'number') {\r\n      this.thrust = n;\r\n    } else {\r\n      console.log('Description: arguments (w, h) must be type of number.');\r\n    }\r\n  }\r\n\r\n  translateByX(x) {\r\n    if(parseFloat(x) == this.targetX) return;\r\n    this.inMove = true;\r\n    this.targetX = parseFloat(x);\r\n  };\r\n\r\n  translateByY(y) {\r\n    if(parseFloat(y) == this.targetY) return;\r\n    this.inMove = true;\r\n    this.targetY = parseFloat(y);\r\n  }\r\n\r\n  translateByZ(z) {\r\n    if(parseFloat(z) == this.targetZ) return;\r\n    this.inMove = true;\r\n    this.targetZ = parseFloat(z);\r\n  }\r\n\r\n  translateByXY(x, y) {\r\n    if(parseFloat(y) == this.targetY && parseFloat(x) == this.targetX) return;\r\n    this.inMove = true;\r\n    this.targetX = parseFloat(x);\r\n    this.targetY = parseFloat(y);\r\n  }\r\n\r\n  translateByXZ(x, z) {\r\n    if(parseFloat(z) == this.targetZ && parseFloat(x) == this.targetX) return;\r\n    this.inMove = true;\r\n    this.targetX = parseFloat(x);\r\n    this.targetZ = parseFloat(z);\r\n  }\r\n\r\n  translateByYZ(y, z) {\r\n    if(parseFloat(y) == this.targetY && parseFloat(z) == this.targetZ) return;\r\n    this.inMove = true;\r\n    this.targetY = parseFloat(y);\r\n    this.targetZ = parseFloat(z);\r\n  }\r\n\r\n  onTargetPositionReach() {}\r\n\r\n  update() {\r\n    var tx = parseFloat(this.targetX) - parseFloat(this.x),\r\n      ty = parseFloat(this.targetY) - parseFloat(this.y),\r\n      tz = parseFloat(this.targetZ) - parseFloat(this.z),\r\n      dist = Math.sqrt(tx * tx + ty * ty + tz * tz);\r\n    this.velX = (tx / dist) * this.thrust;\r\n    this.velY = (ty / dist) * this.thrust;\r\n    this.velZ = (tz / dist) * this.thrust;\r\n    if(this.inMove == true) {\r\n      if(dist > this.thrust) {\r\n        this.x += this.velX;\r\n        this.y += this.velY;\r\n        this.z += this.velZ;\r\n        if(this.netObject != null) {\r\n          if(this.netTolerance__ > this.netTolerance) {\r\n\r\n            if(this.teams.length == 0) {\r\n              app.net.send({\r\n                toRemote: this.toRemote, // default null\r\n                remoteName: this.remoteName, // default null\r\n                sceneName: this.netObject,\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            } else {\r\n              // logic is only for two team - index 0 is local !!!\r\n              if(this.teams.length > 0) if(this.teams[0].length > 0) app.net.send({\r\n                toRemote: this.teams[0], // default null remote conns\r\n                sceneName: this.netObject, // origin scene name to receive\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n              // remove if (this.teams[1].length > 0)  after alll this is only for CASE OF SUM PLAYER 3 FOR TEST ONLY\r\n              if(this.teams.length > 0) if(this.teams[1].length > 0) app.net.send({\r\n                toRemote: this.teams[1], // default null remote conns\r\n                remoteName: this.remoteName, // to enemy players\r\n                sceneName: this.netObject, // now not important\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            }\r\n            this.netTolerance__ = 0;\r\n          } else {\r\n            this.netTolerance__++;\r\n          }\r\n        }\r\n      } else {\r\n        this.x = this.targetX;\r\n        this.y = this.targetY;\r\n        this.z = this.targetZ;\r\n        this.inMove = false;\r\n        this.onTargetPositionReach();\r\n        if(this.netObject != null) {\r\n          if(this.netTolerance__ > this.netTolerance) {\r\n\r\n            // \r\n            if(this.teams.length == 0) {\r\n              app.net.send({\r\n                toRemote: this.toRemote, // default null\r\n                remoteName: this.remoteName, // default null\r\n                sceneName: this.netObject,\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            } else {\r\n              // logic is only for two team - index 0 is local !\r\n              if(this.teams[0].length > 0) app.net.send({\r\n                toRemote: this.teams[0],\r\n                sceneName: this.netObject,\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n              if(this.teams[1].length > 0) app.net.send({\r\n                // team: this.teams[1],\r\n                toRemote: this.teams[1], // default null remote conns\r\n                remoteName: this.remoteName, // to enemy players\r\n                sceneName: this.netObject, // now not important\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            }\r\n\r\n            this.netTolerance__ = 0;\r\n          } else {\r\n            this.netTolerance__++;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get worldLocation() {\r\n    return [parseFloat(this.x), parseFloat(this.y), parseFloat(this.z)];\r\n  }\r\n\r\n  SetX(newx, em) {\r\n    this.x = newx;\r\n    this.targetX = newx;\r\n    this.inMove = false;\r\n  }\r\n\r\n  SetY(newy, em) {\r\n    this.y = newy;\r\n    this.targetY = newy;\r\n    this.inMove = false;\r\n  }\r\n\r\n  SetZ(newz, em) {\r\n    this.z = newz;\r\n    this.targetZ = newz;\r\n    this.inMove = false;\r\n  }\r\n\r\n  get X() {\r\n    return parseFloat(this.x)\r\n  }\r\n\r\n  get Y() {\r\n    return parseFloat(this.y)\r\n  }\r\n\r\n  get Z() {\r\n    return parseFloat(this.z)\r\n  }\r\n\r\n  setPosition(newx, newy, newz) {\r\n    this.x = newx;\r\n    this.y = newy;\r\n    this.z = newz;\r\n    this.targetX = newx;\r\n    this.targetY = newy;\r\n    this.targetZ = newz;\r\n    this.inMove = false;\r\n  }\r\n}\r\n\r\nexport class Rotation {\r\n  constructor(x, y, z) {\r\n    this.toRemote = [];\r\n    this.teams = [];\r\n    this.remoteName = null;\r\n    this.emitX = null;\r\n    this.emitY = null;\r\n    this.emitZ = null;\r\n    if(typeof x == 'undefined') x = 0;\r\n    if(typeof y == 'undefined') y = 0;\r\n    if(typeof z == 'undefined') z = 0;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n    this.netx = x;\r\n    this.nety = y;\r\n    this.netz = z;\r\n    this.rotationSpeed = {x: 0, y: 0, z: 0};\r\n    this.angle = 0;\r\n    this.axis = {x: 0, y: 0, z: 0};\r\n    // not in use good for exstend logic\r\n    this.matrixRotation = null;\r\n  }\r\n\r\n  setRotate = (x, y, z) => {\r\n    this.rotationSpeed = {x: x, y: y, z: z};\r\n  }\r\n\r\n  setRotateX = (x) => {\r\n    this.rotationSpeed.x = x;\r\n  }\r\n\r\n  setRotateY = (y) => {\r\n    this.rotationSpeed.y = y;\r\n  }\r\n\r\n  setRotateZ = (z) => {\r\n    this.rotationSpeed.z = z;\r\n  }\r\n\r\n  setRotation = (x, y, z) => {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n  }\r\n\r\n  setRotationX = (x) => {\r\n    this.x = x;\r\n  }\r\n\r\n  setRotationY = (y) => {\r\n    this.y = y;\r\n  }\r\n\r\n  setRotationZ = (z) => {\r\n    this.z = z;\r\n  }\r\n\r\n  toDegree = () => {\r\n    /*\r\n    heading = atan2(y * sin(angle)- x * z * (1 - cos(angle)) , 1 - (y2 + z2 ) * (1 - cos(angle)))\r\n    attitude = asin(x * y * (1 - cos(angle)) + z * sin(angle))\r\n    bank = atan2(x * sin(angle)-y * z * (1 - cos(angle)) , 1 - (x2 + z2) * (1 - cos(angle)))\r\n    */\r\n    return [radToDeg(this.axis.x), radToDeg(this.axis.y), radToDeg(this.axis.z)];\r\n  }\r\n\r\n  toDegreeX = () => {\r\n    return Math.cos(radToDeg(this.axis.x) / 2)\r\n  }\r\n\r\n  toDegreeY = () => {\r\n    return Math.cos(radToDeg(this.axis.z) / 2)\r\n  }\r\n\r\n  toDegreeZ = () => {\r\n    return Math.cos(radToDeg(this.axis.y) / 2)\r\n  }\r\n\r\n  getRotX = () => {\r\n    if(this.rotationSpeed.x == 0) {\r\n      if(this.netx != this.x && this.emitX) {\r\n        app.net.send({\r\n          remoteName: this.remoteName,\r\n          sceneName: this.emitX,\r\n          netRotX: this.x\r\n        })\r\n      }\r\n      this.netx = this.x;\r\n      return degToRad(this.x);\r\n    } else {\r\n      this.x = this.x + this.rotationSpeed.x * 0.001;\r\n      return degToRad(this.x);\r\n    }\r\n  }\r\n\r\n  getRotY = () => {\r\n    if(this.rotationSpeed.y == 0) {\r\n      if(this.nety != this.y && this.emitY) {\r\n        // ---------------------------------------\r\n        if(this.teams.length == 0) {\r\n          app.net.send({\r\n            toRemote: this.toRemote,\r\n            remoteName: this.remoteName,\r\n            sceneName: this.emitY,\r\n            netRotY: this.y\r\n          });\r\n          this.nety = this.y;\r\n        } else {\r\n          if(this.teams[0].length > 0) app.net.send({\r\n            toRemote: this.teams[0],\r\n            sceneName: this.emitY,\r\n            netRotY: this.y\r\n          });\r\n          if(this.teams[1].length > 0) app.net.send({\r\n            toRemote: this.teams[1],\r\n            remoteName: this.remoteName,\r\n            sceneName: this.emitY,\r\n            netRotY: this.y\r\n          });\r\n          this.nety = this.y;\r\n        }\r\n      }\r\n      return degToRad(this.y);\r\n    } else {\r\n      this.y = this.y + this.rotationSpeed.y * 0.001;\r\n      return degToRad(this.y);\r\n    }\r\n  }\r\n\r\n  getRotZ = () => {\r\n    if(this.rotationSpeed.z == 0) {\r\n      if(this.netz != this.z && this.emitZ) {\r\n        app.net.send({\r\n          remoteName: this.remoteName,\r\n          sceneName: this.emitZ,\r\n          netRotZ: this.z\r\n        })\r\n      }\r\n      this.netz = this.z;\r\n      return degToRad(this.z);\r\n    } else {\r\n      this.z = this.z + this.rotationSpeed.z * 0.001;\r\n      return degToRad(this.z);\r\n    }\r\n  }\r\n\r\n}\r\n", "export let vertexWGSL = `const MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n\r\nstruct VertexOutput {\r\n  @location(0) shadowPos: vec4f,\r\n  @location(1) fragPos: vec3f,\r\n  @location(2) fragNorm: vec3f,\r\n  @location(3) uv: vec2f,\r\n  @builtin(position) Position: vec4f,\r\n}\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\n// Add to your uniform structs at the top\r\nstruct VertexAnimParams {\r\n  time: f32,\r\n  flags: f32,\r\n  globalIntensity: f32,\r\n  _pad0: f32,\r\n  \r\n  // Wave [4-7]\r\n  waveSpeed: f32,\r\n  waveAmplitude: f32,\r\n  waveFrequency: f32,\r\n  _pad1: f32,\r\n  \r\n  // Wind [8-11]\r\n  windSpeed: f32,\r\n  windStrength: f32,\r\n  windHeightInfluence: f32,\r\n  windTurbulence: f32,\r\n  \r\n  // Pulse [12-15]\r\n  pulseSpeed: f32,\r\n  pulseAmount: f32,\r\n  pulseCenterX: f32,\r\n  pulseCenterY: f32,\r\n  \r\n  // Twist [16-19]\r\n  twistSpeed: f32,\r\n  twistAmount: f32,\r\n  _pad2: f32,\r\n  _pad3: f32,\r\n  \r\n  // Noise [20-23]\r\n  noiseScale: f32,\r\n  noiseStrength: f32,\r\n  noiseSpeed: f32,\r\n  _pad4: f32,\r\n  \r\n  // Ocean [24-27]\r\n  oceanWaveScale: f32,\r\n  oceanWaveHeight: f32,\r\n  oceanWaveSpeed: f32,\r\n  _pad5: f32,\r\n  \r\n  // Displacement [28-31]\r\n  displacementStrength: f32,\r\n  displacementSpeed: f32,\r\n  _pad6: f32,\r\n  _pad7: f32,\r\n}\r\n\r\n@group(1) @binding(2) var<uniform> vertexAnim : VertexAnimParams;\r\n\r\nconst ANIM_WAVE: u32 = 1u;\r\nconst ANIM_WIND: u32 = 2u;\r\nconst ANIM_PULSE: u32 = 4u;\r\nconst ANIM_TWIST: u32 = 8u;\r\nconst ANIM_NOISE: u32 = 16u;\r\nconst ANIM_OCEAN: u32 = 32u;\r\n\r\n// Basic wave function - good starting point\r\nfn applyWave(pos: vec3f) -> vec3f {\r\n  let wave = sin(pos.x * vertexAnim.waveFrequency + vertexAnim.time * vertexAnim.waveSpeed) * \r\n             cos(pos.z * vertexAnim.waveFrequency + vertexAnim.time * vertexAnim.waveSpeed);\r\n  return vec3f(pos.x, pos.y + wave * vertexAnim.waveAmplitude, pos.z);\r\n}\r\n\r\nfn applyWind(pos: vec3f, normal: vec3f) -> vec3f {\r\n  let heightFactor = max(0.0, pos.y) * vertexAnim.windHeightInfluence;\r\n  \r\n  let windDir = vec2f(\r\n    sin(vertexAnim.time * vertexAnim.windSpeed),\r\n    cos(vertexAnim.time * vertexAnim.windSpeed * 0.7)\r\n  ) * vertexAnim.windStrength;\r\n  \r\n  let turbulence = noise(vec2f(pos.x, pos.z) * 0.5 + vertexAnim.time * 0.3) \r\n                   * vertexAnim.windTurbulence;\r\n  \r\n  return vec3f(\r\n    pos.x + windDir.x * heightFactor * (1.0 + turbulence),\r\n    pos.y,\r\n    pos.z + windDir.y * heightFactor * (1.0 + turbulence)\r\n  );\r\n}\r\n\r\nfn applyPulse(pos: vec3f) -> vec3f {\r\n  let pulse = sin(vertexAnim.time * vertexAnim.pulseSpeed) * vertexAnim.pulseAmount;\r\n  let scale = 1.0 + pulse;\r\n  \r\n  let center = vec3f(vertexAnim.pulseCenterX, 0.0, vertexAnim.pulseCenterY);\r\n  return center + (pos - center) * scale;\r\n}\r\n\r\nfn applyTwist(pos: vec3f) -> vec3f {\r\n  let angle = pos.y * vertexAnim.twistAmount * sin(vertexAnim.time * vertexAnim.twistSpeed);\r\n  \r\n  let cosA = cos(angle);\r\n  let sinA = sin(angle);\r\n  \r\n  return vec3f(\r\n    pos.x * cosA - pos.z * sinA,\r\n    pos.y,\r\n    pos.x * sinA + pos.z * cosA\r\n  );\r\n}\r\n\r\n// Simple noise function (you can replace with texture sampling later)\r\nfn hash(p: vec2f) -> f32 {\r\n  var p3 = fract(vec3f(p.x, p.y, p.x) * 0.13);\r\n  p3 += dot(p3, vec3f(p3.y, p3.z, p3.x) + 3.333);\r\n  return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nfn noise(p: vec2f) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash(i + vec2f(0.0, 0.0)), hash(i + vec2f(1.0, 0.0)), u.x),\r\n    mix(hash(i + vec2f(0.0, 1.0)), hash(i + vec2f(1.0, 1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\nfn applyNoiseDisplacement(pos: vec3f) -> vec3f {\r\n  let noiseVal = noise(vec2f(pos.x, pos.z) * vertexAnim.noiseScale \r\n                      + vertexAnim.time * vertexAnim.noiseSpeed);\r\n  let displacement = (noiseVal - 0.5) * vertexAnim.noiseStrength;\r\n  return vec3f(pos.x, pos.y + displacement, pos.z);\r\n}\r\n\r\nfn applyOcean(pos: vec3f) -> vec3f {\r\n  let t = vertexAnim.time * vertexAnim.oceanWaveSpeed;\r\n  let scale = vertexAnim.oceanWaveScale;\r\n  \r\n  let wave1 = sin(dot(pos.xz, vec2f(1.0, 0.0)) * scale + t) * vertexAnim.oceanWaveHeight;\r\n  let wave2 = sin(dot(pos.xz, vec2f(0.7, 0.7)) * scale * 1.2 + t * 1.3) * vertexAnim.oceanWaveHeight * 0.7;\r\n  let wave3 = sin(dot(pos.xz, vec2f(0.0, 1.0)) * scale * 0.8 + t * 0.9) * vertexAnim.oceanWaveHeight * 0.5;\r\n  \r\n  return vec3f(pos.x, pos.y + wave1 + wave2 + wave3, pos.z);\r\n}\r\n\r\nfn applyVertexAnimation(pos: vec3f, normal: vec3f) -> SkinResult {\r\n  var animatedPos = pos;\r\n  var animatedNorm = normal;\r\n  let flags = u32(vertexAnim.flags);\r\n  // Apply effects in order\r\n  if ((flags & ANIM_WAVE) != 0u) {\r\n    animatedPos = applyWave(animatedPos);\r\n  }\r\n  if ((flags & ANIM_WIND) != 0u) {\r\n    animatedPos = applyWind(animatedPos, animatedNorm);\r\n  }\r\n  if ((flags & ANIM_NOISE) != 0u) {\r\n    animatedPos = applyNoiseDisplacement(animatedPos);\r\n  }\r\n  if ((flags & ANIM_OCEAN) != 0u) {\r\n    animatedPos = applyOcean(animatedPos);\r\n  }\r\n  if ((flags & ANIM_PULSE) != 0u) {\r\n    animatedPos = applyPulse(animatedPos);\r\n  }\r\n  if ((flags & ANIM_TWIST) != 0u) {\r\n    animatedPos = applyTwist(animatedPos);\r\n  }\r\n  // Apply global intensity (master volume control)\r\n  animatedPos = mix(pos, animatedPos, vertexAnim.globalIntensity);\r\n  // Recalculate normal\r\n  if (flags != 0u) {\r\n    let offset = 0.01;\r\n    let posX = applyWave(applyNoiseDisplacement(pos + vec3f(offset, 0.0, 0.0)));\r\n    let posZ = applyWave(applyNoiseDisplacement(pos + vec3f(0.0, 0.0, offset)));\r\n    let tangentX = normalize(posX - animatedPos);\r\n    let tangentZ = normalize(posZ - animatedPos);\r\n    animatedNorm = normalize(cross(tangentZ, tangentX));\r\n  }\r\n  return SkinResult(vec4f(animatedPos, 1.0), animatedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @location(1) normal: vec3f,\r\n  @location(2) uv: vec2f,\r\n  @location(3) joints: vec4<u32>,\r\n  @location(4) weights: vec4<f32>\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  var pos = vec4(position, 1.0);\r\n  var nrm = normal;\r\n  // Apply skinning first\r\n  let skinned = skinVertex(pos, nrm, joints, weights);\r\n  let animated = applyVertexAnimation(skinned.position.xyz, skinned.normal);\r\n  // var finalPos = skinned.position.xyz;\r\n  // var finalNorm = skinned.normal;\r\n  var finalPos = animated.position.xyz;\r\n  var finalNorm = animated.normal;\r\n  // Only apply animation if enabled > 0.5 (simple check)\r\n  // Check if any animation flags are set\r\n  if (u32(vertexAnim.flags) != 0u && vertexAnim.globalIntensity > 0.0) {\r\n    let animated = applyVertexAnimation(finalPos, finalNorm);\r\n    finalPos = animated.position.xyz;\r\n    finalNorm = animated.normal;\r\n  }\r\n  let worldPos = model.modelMatrix * vec4f(finalPos, 1.0);\r\n  let normalMatrix = mat3x3f(\r\n    model.modelMatrix[0].xyz,\r\n    model.modelMatrix[1].xyz,\r\n    model.modelMatrix[2].xyz\r\n  );\r\n  output.Position = scene.cameraViewProjMatrix * worldPos;\r\n  output.fragPos = worldPos.xyz;\r\n  output.shadowPos = scene.lightViewProjMatrix * worldPos;\r\n  output.fragNorm = normalize(normalMatrix * finalNorm);\r\n  output.uv = uv;\r\n  return output;\r\n}`;", "export let fragmentWGSL = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n    alpha     : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\n// RPG or any other usage [selected obj effect]\r\n@group(2) @binding(0) var<uniform> uSelected : f32;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    \r\n    // \u2705 Get alpha from texture and material factor\r\n    // let alpha = texColor.a * material.baseColorFactor.a;\r\n    let alpha = material.baseColorFactor.a;\r\n    \r\n    return PBRMaterialData(baseColor, metallic, roughness, alpha);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n    return material.baseColor * light.color * light.intensity * NdotL;\r\n}\r\n\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 Get material with alpha\r\n    let materialData = getPBRMaterial(input.uv);\r\n    \r\n    // \u2705 Early discard for fully transparent pixels (alpha cutoff)\r\n    if (materialData.alpha < 0.01) {\r\n        discard;\r\n    }\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    var finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    let fresnel = pow(1.0 - max(dot(N, V), 0.0), 3.0);\r\n\r\n    if (uSelected > 0.5) {\r\n        let glowColor = vec3f(0.2, 0.8, 1.0);\r\n        finalColor += glowColor * fresnel * 0.1;\r\n    }\r\n\r\n    let alpha = mix(materialData.alpha, 1.0 , 0.5); \r\n    // \u2705 Return color with alpha from material\r\n    return vec4f(finalColor, alpha);\r\n}`;", "export let fragmentWGSLMetal = `override shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n    alpha     : f32,  // \u2705 Added alpha\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = material.metallicFactor;\r\n    let roughness = material.roughnessFactor;\r\n    // \u2705 Get alpha from texture and material factor\r\n    let alpha = texColor.a * material.baseColorFactor.a;\r\n    return PBRMaterialData(baseColor, metallic, roughness, alpha);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\n// PCF shadow sampling\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(shadowMapArray, shadowSampler, shadowUV + offsets[i] * oneOverSize, layer, depthRef - bias);\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let materialData = getPBRMaterial(input.uv);\r\n    \r\n    // \u2705 Early discard for fully transparent pixels\r\n    if (materialData.alpha < 0.01) {\r\n        discard;\r\n    }\r\n    \r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    var Lo = vec3f(0.0);\r\n    \r\n    for(var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let L = normalize(spotlights[i].position - input.fragPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(spotlights[i].position - input.fragPos);\r\n        let attenuation = clamp(1.0 - (distance / spotlights[i].range), 0.0, 1.0);\r\n\r\n        let NdotL = max(dot(N, L), 0.0);\r\n\r\n        let radiance = spotlights[i].color * spotlights[i].intensity * attenuation;\r\n\r\n        let NDF = distributionGGX(N, H, materialData.roughness);\r\n        let G   = geometrySmith(N, V, L, materialData.roughness);\r\n        let F0 = mix(vec3f(0.04), materialData.baseColor, materialData.metallic);\r\n        let F  = fresnelSchlick(max(dot(H, V), 0.0), F0);\r\n\r\n        let kS = F;\r\n        let kD = (vec3f(1.0) - kS) * (1.0 - materialData.metallic);\r\n\r\n        let diffuse  = kD * materialData.baseColor / PI;\r\n        let specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\r\n\r\n        // Combine diffuse + specular and multiply by NdotL and radiance\r\n        Lo += (diffuse + specular) * radiance * NdotL;\r\n    }\r\n\r\n    let ambient = scene.globalAmbient * materialData.baseColor;\r\n    var color = ambient + Lo;\r\n    \r\n    // \u2705 Return color with alpha from material\r\n    return vec4f(color, materialData.alpha);\r\n}\r\n`;", "export let fragmentWGSLNormalMap = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n// PBR normalmap\r\n@group(0) @binding(9) var normalTex: texture_2d<f32>;\r\n@group(0) @binding(10) var normalSampler: sampler;\r\n\r\nstruct FragmentInput {\r\n  @location(0) shadowPos : vec4f,\r\n  @location(1) fragPos   : vec3f,\r\n  @location(2) fragNorm  : vec3f,\r\n  @location(3) uv        : vec2f,\r\n  @location(4) tangent   : vec4f, // new\r\n};\r\n\r\nfn getNormalMap(uv: vec2f, N: vec3f) -> vec3f {\r\n    // Sample normal map\r\n    let nSample = textureSample(normalTex, normalSampler, uv).rgb;\r\n    // Convert from [0,1] \u2192 [-1,1]\r\n    let nTangent = nSample * 2.0 - vec3f(1.0);\r\n    \r\n    // TODO: if you have TBN matrix, convert tangent-space \u2192 world-space\r\n    // For now, assume fragNorm is already aligned (simple approx)\r\n    return normalize(nTangent);\r\n}\r\n\r\nfn getNormalMap2(uv: vec2f, N: vec3f, T: vec3f, B: vec3f) -> vec3f {\r\n    let nSample = textureSample(normalTex, normalSampler, uv).rgb;\r\n    let nTangent = nSample * 2.0 - vec3f(1.0);\r\n    let worldNormal = normalize(T * nTangent.x + B * nTangent.y + N * nTangent.z);\r\n    return worldNormal;\r\n}\r\n    \r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n    return material.baseColor * light.color * light.intensity * NdotL;\r\n    // return material.baseColor * light.color * light.intensity * NdotL;\r\n}\r\n\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    // coneAtten = 1.0;\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    // return (diffuse + specular) * radiance * NdotL * coneAtten;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    // let norm = normalize(input.fragNorm);\r\n    let N = normalize(input.fragNorm);\r\n    let T = normalize(input.tangent.xyz);\r\n    let B = cross(N, T) * input.tangent.w; // handedness\r\n    let norm = getNormalMap2(input.uv, N, T, B);\r\n\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    let finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n    return vec4f(finalColor, 1.0);\r\n}`;", "export let fragmentWGSLPong = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    let coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n    if (coneAtten <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    // --- diffuse controlled by metallic ---\r\n    let kD = 1.0 - material.metallic;  // 1.0 \u2192 full diffuse, 0.0 \u2192 fully metallic\r\n    let lambert = kD * material.baseColor * light.color * light.intensity * NdotL;\r\n\r\n    // --- simple specular controlled by roughness ---\r\n    let H = normalize(L + V);\r\n    let shininess = mix(2.0, 128.0, 1.0 - material.roughness); // map roughness \u2192 exponent\r\n    let spec = pow(max(dot(N, H), 0.0), shininess);\r\n    let specular = light.color * spec * material.metallic; // only strong if metallic > 0\r\n\r\n    return (lambert + specular) * coneAtten;\r\n}\r\n// Debug hybrid spotlight\r\nfn computeSpotLight3(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    let coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    if (coneAtten <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    // ---- baseline lambert ----\r\n    let lambert = material.baseColor * light.color * light.intensity * NdotL;\r\n\r\n    // ---- add a bit of specular safely ----\r\n    let H = normalize(L + V);\r\n    let spec = pow(max(dot(N, H), 0.0), 32.0); // simple Blinn-Phong\r\n    let specular = light.color * spec * 0.2;   // scaled so it doesn\u2019t kill diffuse\r\n\r\n    // final mix\r\n    return (lambert + specular) * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight2(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    let finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n    return vec4f(finalColor, 1.0);\r\n}`;", "export let fragmentWGSLPower = `override shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\n// PCF shadow sampling\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(shadowMapArray, shadowSampler, shadowUV + offsets[i] * oneOverSize, layer, depthRef - bias);\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let materialData = getPBRMaterial(input.uv);\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    var Lo = vec3f(0.0);\r\n    for(var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let L = normalize(spotlights[i].position - input.fragPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(spotlights[i].position - input.fragPos);\r\n        let attenuation = clamp(1.0 - (distance / spotlights[i].range), 0.0, 1.0);\r\n        let radiance = spotlights[i].color * spotlights[i].intensity * attenuation;\r\n        let NDF = distributionGGX(N, H, materialData.roughness);\r\n        let G   = geometrySmith(N, V, L, materialData.roughness);\r\n        let F0 = mix(vec3f(0.04), materialData.baseColor, materialData.metallic);\r\n        let F  = fresnelSchlick(max(dot(H, V), 0.0), F0);\r\n        let kS = F;\r\n        let kD = (vec3f(1.0) - kS) * (1.0 - materialData.metallic);\r\n        let diffuse  = kD * materialData.baseColor / PI; // Lambertian diffuse // ??\r\n        let NdotL = max(dot(N, L), 0.0);\r\n        let specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\r\n        Lo += NdotL * spotlights[i].color * spotlights[i].intensity;\r\n    }\r\n    let ambient = scene.globalAmbient * materialData.baseColor;\r\n    var color = ambient + Lo;\r\n    return vec4f(color, 1.0);\r\n}\r\n`;\r\n\r\n\r\n// let N = normalize(input.fragNorm);\r\n// let L = normalize(spotlights[0].position - input.fragPos);\r\n// let NdotL = max(dot(N,L),0.0);\r\n// let radiance = spotlights[0].color * 10.0; // test high intensity\r\n// Lo += materialData.baseColor * radiance * NdotL;", "export let fragmentWGSLMix1 = `override shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    effectMix       : f32,\r\n    lightingEnabled : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n@group(0) @binding(9) var normalTexture: texture_2d<f32>;\r\n@group(0) @binding(10) var normalSampler: sampler;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n    @builtin(position) position : vec4f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / max(PI * denom * denom, 0.0001);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / max(NdotV * (1.0 - k) + k, 0.0001);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\n// ===== SIMPLIFIED WORKING EFFECT =====\r\n\r\nfn calculateEffect(fragCoord: vec2f, resolution: vec2f, time: f32) -> vec3f {\r\n    // Normalize coordinates\r\n    let uv = fragCoord.xy / resolution;\r\n    let aspect = resolution.x / resolution.y;\r\n    let p = (uv * 2.0 - 1.0) * vec2f(aspect, 1.0);\r\n    \r\n    var color = vec3f(0.0);\r\n    \r\n    // Simplified version - 5 iterations instead of 9x7\r\n    for(var i: f32 = 0.0; i < 5.0; i = i + 1.0) {\r\n        // Rotating coordinates\r\n        let angle = time * 0.1 + i * 0.5;\r\n        let c = cos(angle);\r\n        let s = sin(angle);\r\n        var pos = vec2f(\r\n            p.x * c - p.y * s,\r\n            p.x * s + p.y * c\r\n        );\r\n        \r\n        // Add some warping\r\n        pos += sin(pos.yx * 3.0 + time * 0.5) * 0.1;\r\n        \r\n        // Distance field\r\n        let dist = length(pos) - 0.5 - i * 0.15;\r\n        let rings = sin(dist * 10.0 - time * 2.0) * 0.5 + 0.5;\r\n        \r\n        // Color based on iteration and distance\r\n        let hue = i / 5.0 + time * 0.1;\r\n        color += vec3f(\r\n            0.5 + 0.5 * sin(hue * 6.28),\r\n            0.5 + 0.5 * sin(hue * 6.28 + 2.09),\r\n            0.5 + 0.5 * sin(hue * 6.28 + 4.18)\r\n        ) * rings * 0.3;\r\n    }\r\n    \r\n    // Add some glow\r\n    let centerDist = length(p);\r\n    color += vec3f(0.1) / (centerDist * centerDist + 0.1);\r\n    \r\n    return clamp(color, vec3f(0.0), vec3f(1.0));\r\n}\r\n\r\n// ===== STANDARD PBR LIGHTING =====\r\n\r\nfn calculatePBRLighting(materialData: PBRMaterialData, N: vec3f, V: vec3f, fragPos: vec3f) -> vec3f {\r\n    var Lo = vec3f(0.0);\r\n    \r\n    for(var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let L = normalize(spotlights[i].position - fragPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(spotlights[i].position - fragPos);\r\n        let attenuation = clamp(1.0 - (distance / max(spotlights[i].range, 0.1)), 0.0, 1.0);\r\n        let radiance = spotlights[i].color * spotlights[i].intensity * attenuation;\r\n        \r\n        let NDF = distributionGGX(N, H, materialData.roughness);\r\n        let G   = geometrySmith(N, V, L, materialData.roughness);\r\n        let F0 = mix(vec3f(0.04), materialData.baseColor, materialData.metallic);\r\n        let F  = fresnelSchlick(max(dot(H, V), 0.0), F0);\r\n        \r\n        let kS = F;\r\n        let kD = (vec3f(1.0) - kS) * (1.0 - materialData.metallic);\r\n        let diffuse  = kD * materialData.baseColor / PI;\r\n        let NdotL = max(dot(N, L), 0.0);\r\n        let specular = (NDF * G * F) / max(4.0 * max(dot(N, V), 0.0) * NdotL + 0.001, 0.001);\r\n        \r\n        Lo += (diffuse + specular) * radiance * NdotL;\r\n    }\r\n    \r\n    return Lo;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let materialData = getPBRMaterial(input.uv);\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    \r\n    let resolution = vec2f(1080.0, 687.0);\r\n    \r\n    var finalColor = vec3f(0.0);\r\n    \r\n    if (material.lightingEnabled > 0.5) {\r\n        // Lighting enabled - calculate PBR\r\n        let Lo = calculatePBRLighting(materialData, N, V, input.fragPos);\r\n        let ambient = scene.globalAmbient * materialData.baseColor;\r\n        let litColor = ambient + Lo;\r\n        \r\n        if (material.effectMix > 0.01) {\r\n            // Blend with effect\r\n            let effectColor = calculateEffect(input.position.xy, resolution, scene.time);\r\n            finalColor = mix(litColor, effectColor, material.effectMix);\r\n        } else {\r\n            // Pure PBR\r\n            finalColor = litColor;\r\n        }\r\n    } else {\r\n        // Pure effect mode\r\n        let effectColor = calculateEffect(input.position.xy, resolution, scene.time);\r\n        // Modulate slightly by material color\r\n        finalColor = effectColor * mix(vec3f(1.0), materialData.baseColor, 0.2);\r\n    }\r\n    \r\n    return vec4f(finalColor, 1.0);\r\n}\r\n`;", "export let fragmentWaterWGSL = `\r\n/* === Engine uniforms === */\r\n\r\n// DINAMIC GLOBALS\r\nconst PI: f32 = 3.141592653589793;\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\n\r\n// DINAMIC STRUCTS\r\n\r\n\r\n// PREDEFINED\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\n// PREDEFINED\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\n// PREDEFINED\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\n// PREDEFINED\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\n// PREDEFINED\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n// PREDEFINED\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\n// \u2705 Graph custom uniforms\r\nstruct WaterParams {\r\n    deepColor     : vec3f,\r\n    waveSpeed     : f32,\r\n    shallowColor  : vec3f,\r\n    waveScale     : f32,\r\n    waveHeight    : f32,\r\n    fresnelPower  : f32,\r\n    specularPower : f32,\r\n    _pad1         : f32,\r\n};\r\n\r\n@group(3) @binding(0) var<uniform> waterParams: WaterParams;\r\n\r\n// \u2705 Graph custom functions\r\n\r\n// Gerstner wave function for realistic water waves\r\nfn gerstnerWave(pos: vec2f, direction: vec2f, steepness: f32, wavelength: f32, time: f32) -> vec3f {\r\n    let k = 2.0 * PI / wavelength;\r\n    let c = sqrt(9.8 / k);\r\n    let d = normalize(direction);\r\n    let f = k * (dot(d, pos) - c * time);\r\n    let a = steepness / k;\r\n    \r\n    return vec3f(\r\n        d.x * a * cos(f),\r\n        a * sin(f),\r\n        d.y * a * cos(f)\r\n    );\r\n}\r\n\r\n// Simpler sine wave for smoother animation\r\nfn sineWave(pos: vec2f, direction: vec2f, amplitude: f32, frequency: f32, time: f32) -> vec3f {\r\n    let d = normalize(direction);\r\n    let phase = dot(d, pos) * frequency - time;\r\n    \r\n    return vec3f(\r\n        d.x * amplitude * cos(phase),\r\n        amplitude * sin(phase),\r\n        d.y * amplitude * cos(phase)\r\n    );\r\n}\r\n\r\n// Calculate water normal from multiple waves\r\nfn calculateWaterNormal(worldPos: vec3f, time: f32) -> vec3f {\r\n    let pos = worldPos.xz * waterParams.waveScale;\r\n    let t = time * waterParams.waveSpeed;\r\n    \r\n    // Use smoother sine waves instead of Gerstner for better animation\r\n    let wave1 = sineWave(pos, vec2f(1.0, 0.0), 0.3, 2.0, t);\r\n    let wave2 = sineWave(pos, vec2f(0.0, 1.0), 0.25, 1.8, t * 1.13);\r\n    let wave3 = sineWave(pos, vec2f(0.707, 0.707), 0.2, 1.5, t * 0.87);\r\n    let wave4 = sineWave(pos, vec2f(-0.5, 0.866), 0.15, 1.2, t * 1.27);\r\n    \r\n    // Sum waves\r\n    let offset = (wave1 + wave2 + wave3 + wave4) * waterParams.waveHeight;\r\n    \r\n    // Calculate tangent vectors using small step size\r\n    let eps = 0.1;\r\n    let posX = worldPos + vec3f(eps, 0.0, 0.0);\r\n    let posZ = worldPos + vec3f(0.0, 0.0, eps);\r\n    \r\n    let offsetX = (\r\n        sineWave(posX.xz * waterParams.waveScale, vec2f(1.0, 0.0), 0.3, 2.0, t) +\r\n        sineWave(posX.xz * waterParams.waveScale, vec2f(0.0, 1.0), 0.25, 1.8, t * 1.13) +\r\n        sineWave(posX.xz * waterParams.waveScale, vec2f(0.707, 0.707), 0.2, 1.5, t * 0.87) +\r\n        sineWave(posX.xz * waterParams.waveScale, vec2f(-0.5, 0.866), 0.15, 1.2, t * 1.27)\r\n    ) * waterParams.waveHeight;\r\n    \r\n    let offsetZ = (\r\n        sineWave(posZ.xz * waterParams.waveScale, vec2f(1.0, 0.0), 0.3, 2.0, t) +\r\n        sineWave(posZ.xz * waterParams.waveScale, vec2f(0.0, 1.0), 0.25, 1.8, t * 1.13) +\r\n        sineWave(posZ.xz * waterParams.waveScale, vec2f(0.707, 0.707), 0.2, 1.5, t * 0.87) +\r\n        sineWave(posZ.xz * waterParams.waveScale, vec2f(-0.5, 0.866), 0.15, 1.2, t * 1.27)\r\n    ) * waterParams.waveHeight;\r\n    \r\n    let tangentX = normalize(vec3f(eps, offsetX.y - offset.y, 0.0));\r\n    let tangentZ = normalize(vec3f(0.0, offsetZ.y - offset.y, eps));\r\n    \r\n    return normalize(cross(tangentZ, tangentX));\r\n}\r\n\r\n// Fresnel effect for water reflections\r\nfn fresnelSchlick(cosTheta: f32, F0: f32) -> f32 {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, waterParams.fresnelPower);\r\n}\r\n\r\n// PREDEFINED Fragment input\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\n// PREDEFINED PBR helpers\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    // Calculate animated water normal\r\n    let waterNormal = calculateWaterNormal(input.fragPos, scene.time);\r\n    \r\n    // View direction\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n    \r\n    // Fresnel effect (0 = looking straight down, 1 = grazing angle)\r\n    let fresnel = fresnelSchlick(max(dot(waterNormal, viewDir), 0.0), 0.02);\r\n    \r\n    // Light direction\r\n    let lightDir = normalize(scene.lightPos - input.fragPos);\r\n    \r\n    // Diffuse lighting\r\n    let diff = max(dot(waterNormal, lightDir), 0.0);\r\n    \r\n    // Specular (sun reflection on water)\r\n    let halfDir = normalize(lightDir + viewDir);\r\n    let spec = pow(max(dot(waterNormal, halfDir), 0.0), waterParams.specularPower);\r\n    \r\n    // Mix deep and shallow water colors based on fresnel\r\n    let waterColor = mix(waterParams.deepColor, waterParams.shallowColor, fresnel * 0.5 + 0.5);\r\n    \r\n    // Enhanced lighting for more visible effect\r\n    let ambient = scene.globalAmbient * waterColor * 0.3;\r\n    let diffuse = diff * waterColor * 1.2;\r\n    let specular = spec * vec3f(1.0, 1.0, 1.0) * fresnel * 2.0;\r\n    \r\n    // Enhanced foam on wave peaks\r\n    let foamAmount = pow(max(waterNormal.y - 0.6, 0.0), 2.0) * 0.8;\r\n    let foam = vec3f(1.0, 1.0, 1.0) * foamAmount;\r\n    \r\n    // Add some caustics-like effect based on waves\r\n    let caustics = sin(input.fragPos.x * 10.0 + scene.time * 2.0) * \r\n                   sin(input.fragPos.z * 10.0 + scene.time * 2.0) * 0.15 + 0.15;\r\n    let causticsColor = waterColor * caustics;\r\n    \r\n    // Final color with enhanced effects\r\n    let finalColor = ambient + diffuse + specular + foam + causticsColor;\r\n    \r\n    // MUCH more transparent - alpha between 0.2 and 0.5\r\n    let alpha = mix(0.2, 0.5, fresnel);\r\n    \r\n    // Make the color more vibrant so it's visible even when transparent\r\n    let vibrantColor = finalColor * 1.5;\r\n    \r\n    return vec4f(vibrantColor, alpha);\r\n}`;", "import {fragmentWGSL} from \"../shaders/fragment.wgsl\";\r\nimport {fragmentWGSLMetal} from \"../shaders/fragment.wgsl.metal\";\r\nimport {fragmentWGSLNormalMap} from \"../shaders/fragment.wgsl.normalmap\";\r\nimport {fragmentWGSLPong} from \"../shaders/fragment.wgsl.pong\";\r\nimport {fragmentWGSLPower} from \"../shaders/fragment.wgsl.power\";\r\nimport {fragmentWGSLMix1} from \"../shaders/mixed/fragmentMix1.wgsl\";\r\nimport {fragmentWaterWGSL} from \"../shaders/water/water-c.wgls\";\r\nimport {byId, LOG_FUNNY_ARCADE} from \"./utils\";\r\n/**\r\n * @description\r\n * Created for matrix-engine-wgpu project. MeshObj class estends Materials.\r\n * @variable material is engine meta data variable not real material object.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n */\r\nexport default class Materials {\r\n  constructor(device, material, glb, textureCache) {\r\n    this.device = device;\r\n    this.textureCache = textureCache;\r\n    this.glb = glb;\r\n    this.material = material;\r\n    this.isVideo = false;\r\n    this.videoIsReady = 'NONE';\r\n    this.compareSampler = this.device.createSampler({\r\n      compare: 'less-equal',           // safer for shadow comparison\r\n      addressModeU: 'clamp-to-edge',   // prevents UV leaking outside\r\n      addressModeV: 'clamp-to-edge',\r\n      magFilter: 'linear',             // smooth PCF\r\n      minFilter: 'linear',\r\n    });\r\n    // For image textures (standard sampler)\r\n    this.imageSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n      addressModeU: \"repeat\",\r\n      addressModeV: \"repeat\",\r\n      addressModeW: \"repeat\",\r\n    });\r\n    // For external video textures (needs to be filtering sampler too!)\r\n    this.videoSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // FX effect\r\n    this.postFXModeBuffer = this.device.createBuffer({\r\n      size: 4, // u32 = 4 bytes\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dymmy buffer\r\n    this.dummySpotlightUniformBuffer = this.device.createBuffer({\r\n      size: 80, // Must match size in shader\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.device.queue.writeBuffer(this.dummySpotlightUniformBuffer, 0, new Float32Array(20));\r\n    // Create a 1x1 RGBA texture filled with white\r\n    const mrDummyTex = this.device.createTexture({\r\n      size: [1, 1, 1],\r\n      format: this.getFormat(),\r\n      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n    });\r\n    // Upload a single pixel\r\n    const pixel = new Uint8Array([255, 255, 255, 255]); // white RGBA\r\n    this.device.queue.writeTexture(\r\n      {texture: mrDummyTex},\r\n      pixel,\r\n      {bytesPerRow: 4},\r\n      [1, 1, 1]\r\n    );\r\n    this.metallicRoughnessTextureView = mrDummyTex.createView();\r\n    this.metallicRoughnessSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // 4 floats for baseColorFactor + 1 metallic + 1 roughness + 2 pad floats = 8 floats\r\n    const materialPBRSize = 8 * 4; // 32 bytes\r\n    this.materialPBRBuffer = this.device.createBuffer({\r\n      size: materialPBRSize,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    const baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    const metallicFactor = 0.1;\r\n    const roughnessFactor = 0.5;\r\n    const effectMix = 0.0;            // NEW: 0.0 = normal PBR, 1.0 = full effect\r\n    const lightingEnabled = 1.0;      // NEW: 1.0 = lighting on, 0.0 = effect only\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      effectMix,\r\n      lightingEnabled\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n\r\n    if(this.material.type == 'normalmap') {\r\n      const normalTexInfo = this.glb.glbJsonData.materials[0].normalTexture;\r\n      if(normalTexInfo) {\r\n        const tex = this.glb.glbJsonData.glbTextures[normalTexInfo.index];\r\n        this.normalTextureView = tex.createView();\r\n        this.normalSampler = this.device.createSampler({\r\n          magFilter: 'linear',\r\n          minFilter: 'linear',\r\n        });\r\n      }\r\n    } else {\r\n      // console.log('>DUMMY>normalTexture>')\r\n      // dummy for normal map 1x1 neutral normal map\r\n      this.normalDummyTex = device.createTexture({\r\n        size: [1, 1, 1],\r\n        format: 'rgba8unorm',\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n      });\r\n      // RGBA value for neutral normal in tangent space\r\n      const neutralNormal = new Uint8Array([128, 128, 255, 255]);\r\n      this.device.queue.writeTexture(\r\n        {texture: this.normalDummyTex},\r\n        neutralNormal,\r\n        {bytesPerRow: 4},\r\n        [1, 1, 1]\r\n      );\r\n      // Create texture view & sampler\r\n      this.normalTextureView = this.normalDummyTex.createView();\r\n      this.normalSampler = this.device.createSampler({\r\n        magFilter: 'linear',\r\n        minFilter: 'linear',\r\n      });\r\n    }\r\n    this.createBufferForWater();\r\n  }\r\n\r\n  createBufferForWater = () => {\r\n    this.waterBindGroupLayout = this.device.createBindGroupLayout({\r\n      label: '[Water]BindGroupLayout',\r\n      entries: [{\r\n        binding: 0,\r\n        visibility: GPUShaderStage.FRAGMENT,\r\n        buffer: {\r\n          type: 'uniform'\r\n        }\r\n      }]\r\n    });\r\n    this.waterParamsBuffer = this.device.createBuffer({\r\n      label: '[WaterParams]Buffer',\r\n      size: 48,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.waterParamsData = new Float32Array([\r\n      0.0, 0.2, 0.4,       // deepColor (vec3f)\r\n      0.5,                 // waveSpeed\r\n      0.0, 0.5, 0.7,       // shallowColor (vec3f)\r\n      4.0,                 // waveScale\r\n      0.15,                // waveHeight\r\n      3.0,                 // fresnelPower\r\n      128.0,               // specularPower\r\n      0.0                  // padding\r\n    ]);\r\n    this.device.queue.writeBuffer(this.waterParamsBuffer, 0, this.waterParamsData);\r\n    this.waterBindGroup = this.device.createBindGroup({\r\n      layout: this.waterBindGroupLayout,\r\n      entries: [{\r\n        binding: 0,\r\n        resource: {buffer: this.waterParamsBuffer}\r\n      }]\r\n    });\r\n\r\n    this.updateWaterParams = (deepColor, shallowColor, waveSpeed, waveScale, waveHeight, fresnelPower, specularPower) => {\r\n      const data = new Float32Array([\r\n        deepColor[0], deepColor[1], deepColor[2],\r\n        waveSpeed,\r\n        shallowColor[0], shallowColor[1], shallowColor[2],\r\n        waveScale,\r\n        waveHeight,\r\n        fresnelPower,\r\n        specularPower,\r\n        0.0  // padding\r\n      ]);\r\n      this.device.queue.writeBuffer(this.waterParamsBuffer, 0, data);\r\n    }\r\n  }\r\n\r\n  createDummyTexture(device, size = 256) {\r\n    const data = new Uint8Array(size * size * 4);\r\n\r\n    for(let i = 0;i < data.length;i += 4) {\r\n      data[i + 0] = 0;\r\n      data[i + 1] = 255;\r\n      data[i + 2] = 255;\r\n      data[i + 3] = 255;\r\n    }\r\n\r\n    const texture = device.createTexture({\r\n      size: [size, size],\r\n      format: \"rgba8unorm\",\r\n      usage:\r\n        GPUTextureUsage.TEXTURE_BINDING |\r\n        GPUTextureUsage.COPY_DST,\r\n    });\r\n\r\n    device.queue.writeTexture(\r\n      {texture},\r\n      data,\r\n      {bytesPerRow: size * 4},\r\n      {width: size, height: size}\r\n    );\r\n\r\n    return texture;\r\n  }\r\n\r\n  /**\r\n   * @description \r\n   * Change ONLY base color texture (binding = 3)\r\n   * Does NOT rebuild pipeline or layout\r\n   **/\r\n  changeTexture(newTexture) {\r\n    // Accept GPUTexture OR GPUTextureView\r\n    if(newTexture instanceof GPUTexture) {\r\n      this.texture0 = newTexture;\r\n    } else {\r\n      this.texture0 = {createView: () => newTexture};\r\n    }\r\n    this.isVideo = false;\r\n    // Recreate bind group only\r\n    this.createBindGroupForRender();\r\n  }\r\n\r\n  changeMaterial(newType = 'graph', graphShader) {\r\n    this.material.fromGraph = graphShader;\r\n    this.material.type = newType;\r\n    this.setupPipeline();\r\n  }\r\n\r\n  setBlend = (alpha) => {\r\n    this.material.useBlend = true;\r\n    this.setupMaterialPBR([1, 1, 1, alpha]);\r\n  }\r\n\r\n  getMaterial() {\r\n    // console.log('Material TYPE:', this.material.type);\r\n    if(this.material.type == 'standard') {\r\n      return fragmentWGSL;\r\n    } else if(this.material.type == 'pong') {\r\n      return fragmentWGSLPong;\r\n    } else if(this.material.type == 'power') {\r\n      return fragmentWGSLPower;\r\n    } else if(this.material.type == 'metal') {\r\n      return fragmentWGSLMetal;\r\n    } else if(this.material.type == 'normalmap') {\r\n      return fragmentWGSLNormalMap;\r\n    } else if(this.material.type == 'water') {\r\n      return fragmentWaterWGSL;\r\n    } else if(this.material.type == 'graph') {\r\n      // console.warn('Unknown material ???????????????:', this.material?.type);\r\n      return this.material.fromGraph;\r\n    } else if(this.material.type == 'mix1') {\r\n      return fragmentWGSLMix1;\r\n    }\r\n    console.warn('Unknown material type:', this.material?.type);\r\n    return fragmentWGSL;\r\n  }\r\n\r\n  getFormat() {\r\n    if(this.material?.format == 'darker') {\r\n      return 'rgba8unorm-srgb';\r\n    } else if(this.material?.format == 'normal') {\r\n      return 'rgba8unorm';\r\n    } else {\r\n      return 'rgba8unorm';\r\n    }\r\n  }\r\n\r\n  setupMaterialPBR(baseColorFactor, metallicFactor, roughnessFactor, effectMix = 0.0, lightingEnabled = 1.0) {\r\n    if(!metallicFactor) metallicFactor = 0.5;\r\n    if(!baseColorFactor) baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    if(!roughnessFactor) roughnessFactor = 0.5;\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      effectMix,\r\n      lightingEnabled\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n  }\r\n\r\n  setMixEffectMode(mode = 'normal') {\r\n    let effectMix = 0.0;\r\n    let lightingEnabled = 1.0;\r\n    switch(mode) {\r\n      case 'normal':\r\n        effectMix = 0.0;\r\n        lightingEnabled = 1.0;\r\n        break;\r\n      case 'subtle':\r\n        effectMix = 0.3;\r\n        lightingEnabled = 1.0;\r\n        break;\r\n      case 'blend':\r\n        effectMix = 0.5;\r\n        lightingEnabled = 1.0;\r\n        break;\r\n      case 'full':\r\n        effectMix = 1.0;\r\n        lightingEnabled = 1.0;\r\n        break;\r\n      case 'pure':\r\n        effectMix = 1.0;\r\n        lightingEnabled = 0.0;\r\n        break;\r\n    }\r\n    const baseColorFactor = this.currentBaseColor || [1.0, 1.0, 1.0, 1.0];\r\n    const metallicFactor = this.currentMetallic || 0.1;\r\n    const roughnessFactor = this.currentRoughness || 0.5;\r\n    this.setupMaterialPBR(baseColorFactor, metallicFactor, roughnessFactor, effectMix, lightingEnabled);\r\n  }\r\n\r\n  updatePostFXMode(mode) {\r\n    const arrayBuffer = new Uint32Array([mode]);\r\n    this.device.queue.writeBuffer(this.postFXModeBuffer, 0, arrayBuffer);\r\n  }\r\n\r\n  async loadTex0(texturesPaths) {\r\n    const path = texturesPaths[0];\r\n    const {texture, sampler} = await this.textureCache.get(path, this.getFormat());\r\n    this.texture0 = texture;\r\n    this.sampler = sampler;\r\n  }\r\n\r\n  async loadVideoTexture(arg) {\r\n    this.videoIsReady = 'MAYBE';\r\n    if(arg.type === 'video') {\r\n      this.video = document.createElement('video');\r\n      this.video.src = arg.src || 'res/videos/tunel.mp4';\r\n      this.video.crossOrigin = 'anonymous';\r\n      this.video.autoplay = true;\r\n      this.video.loop = true;\r\n      document.body.append(this.video);\r\n      this.video.style.display = 'none';\r\n      this.video.style.position = 'absolute';\r\n      this.video.style.top = '750px';\r\n      this.video.style.left = '50px';\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'videoElement') {\r\n      this.video = arg.el;\r\n      await this.video.play();\r\n    } else if(arg.type === 'camera') {\r\n      if(!byId(`core-${this.name}`)) {\r\n        this.video = document.createElement('video');\r\n        this.video.id = `core-${this.name}`;\r\n        this.video.autoplay = true;\r\n        this.video.muted = true;\r\n        this.video.playsInline = true;\r\n        this.video.style.display = 'none';\r\n        document.body.append(this.video);\r\n        try {\r\n          const stream = await (navigator.mediaDevices?.getUserMedia?.({\r\n            video: {\r\n              width: {ideal: 1280},\r\n              height: {ideal: 720},\r\n            },\r\n            audio: false\r\n          }));\r\n          this.video.srcObject = stream;\r\n          await this.video.play();\r\n          this.isVideo = true;\r\n        } catch(err) {\r\n          console.info(\"\u274C Failed to access camera:\", err);\r\n          // return;\r\n        }\r\n      }\r\n    } else if(arg.type === 'canvas2d') {\r\n      // Existing canvas (arg.el) \u2014 assume it's actively drawing\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.crossOrigin = 'anonymous';\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      const stream = arg.el.captureStream?.() || arg.el.mozCaptureStream?.();\r\n      if(!stream) {console.error('\u274C Cannot capture stream from canvas2d'); return;}\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'canvas2d-inline') {\r\n      // console.log('what is arg', arg);\r\n      // Miniature inline-drawn canvas created dynamically\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = arg.width || 256;\r\n      canvas.height = arg.height || 256;\r\n      canvas.style.position = 'absolute';\r\n      canvas.style.left = '-1000px';\r\n      canvas.style.top = '0';\r\n      // canvas.style.zIndex = '10000';\r\n      document.body.appendChild(canvas);\r\n      const ctx = canvas.getContext('2d');\r\n      if(typeof arg.canvaInlineProgram === 'function') {\r\n        const drawLoop = () => {\r\n          ctx.save();\r\n          ctx.translate(canvas.width, 0);\r\n          ctx.scale(-1, 1);\r\n          arg.canvaInlineProgram(ctx, canvas, arg.specialCanvas2dArg);\r\n          ctx.restore();\r\n          requestAnimationFrame(drawLoop);\r\n        };\r\n        drawLoop();\r\n      } else {\r\n        ctx.fillStyle = '#0ce325ff';\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      }\r\n\r\n      this.video = document.createElement('video');\r\n      this.video.style.position = 'absolute';\r\n      // this.video.style.zIndex = '1';\r\n      this.video.style.left = '0px';\r\n      this.video.style.top = '0';\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.srcObject = canvas.captureStream(60);\r\n      document.body.append(this.video);\r\n      await this.video.play();\r\n      await new Promise(resolve => {\r\n        const check = () => {\r\n          if(this.video.readyState >= 2) resolve();\r\n          else requestAnimationFrame(check);\r\n        };\r\n        check();\r\n      });\r\n      // console.log('Canvas video stream READY');\r\n      this.isVideo = true;\r\n    }\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // \u2705 Now - maybe noT\r\n    this.createLayoutForRender();\r\n    this.createBindGroupForRender();\r\n    // dispatchEvent(new CustomEvent('update-pipeine', {detail: {}}))\r\n  }\r\n\r\n  updateVideoTexture() {\r\n    if(!this.video || this.video.readyState < 2) {\r\n      // console.info('this.video.readyState', this.video.readyState)\r\n      return;\r\n    }\r\n    if(!this.externalTexture) {\r\n      // create it once\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n      this.videoIsReady = 'YES';\r\n      console.log(\"%c\u2705video bind.\", LOG_FUNNY_ARCADE);\r\n    } else {\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n    }\r\n  }\r\n\r\n  getMaterialTexture(glb, materialIndex) {\r\n    const matDef = glb.glbJsonData.materials[materialIndex];\r\n\r\n    if(!matDef) {\r\n      console.warn('[engine] no material in glb...');\r\n      return null;\r\n    }\r\n\r\n    if(matDef.pbrMetallicRoughness?.baseColorTexture) {\r\n      const texIndex = matDef.pbrMetallicRoughness.baseColorTexture.index;\r\n      return glb.glbJsonData.glbTextures[texIndex].createView();\r\n    }\r\n\r\n    return null;\r\n  }\r\n  getMaterialTextureFromMaterial(material) {\r\n    if(!material || !material.pbrMetallicRoughness) return this.fallbackTextureView;\r\n\r\n    const texInfo = material.pbrMetallicRoughness.baseColorTexture;\r\n    if(!texInfo) return this.fallbackTextureView;\r\n\r\n    const texIndex = texInfo.index;\r\n    return this.glb.glbTextures[texIndex].createView();\r\n  }\r\n\r\n  createBindGroupForRender() {\r\n    let textureResource = this.isVideo\r\n      ? this.externalTexture\r\n      : this.texture0.createView();\r\n    // console.log('TEST TEX this.texture0 ', this.texture0);\r\n    if(this.material.useTextureFromGlb === true) {\r\n      // 0 probably always for basicColor\r\n      const material = this.skinnedNode.mesh.primitives[0].material;\r\n      const textureView = material.baseColorTexture.imageView;\r\n      // const sampler = material.baseColorTexture.sampler;\r\n      textureResource = textureView;\r\n    }\r\n\r\n    if(!textureResource || !this.sceneUniformBuffer || !this.shadowDepthTextureView) {\r\n      if(!textureResource) console.log(\"%c\u2757Missing res texture \", LOG_FUNNY_ARCADE);\r\n      if(!this.sceneUniformBuffer) console.warn(\"\u2757Missing res: this.sceneUniformBuffer: \", this.sceneUniformBuffer);\r\n      // if(!this.shadowDepthTextureView) // console.warn(\"\u2757Missing res: this.shadowDepthTextureView: \", this.shadowDepthTextureView);\r\n      if(typeof textureResource === 'undefined') {\r\n        this.updateVideoTexture();\r\n      }\r\n      return;\r\n    }\r\n    if(this.isVideo == true) {\r\n      // console.info(\"\u2705 video sceneBindGroupForRender\");\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        label: 'sceneBindGroupForRender [video]',\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.videoSampler, },\r\n          {binding: 5, resource: {buffer: this.postFXModeBuffer}}\r\n        ],\r\n      });\r\n      // Special case for video maybe better solution exist\r\n      if(this.video.paused == true) this.video.play();\r\n    } else {\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        label: 'sceneBindGroupForRender [mesh][materials]',\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.imageSampler, },\r\n          {binding: 5, resource: {buffer: !this.spotlightUniformBuffer ? this.dummySpotlightUniformBuffer : this.spotlightUniformBuffer}, },\r\n          {binding: 6, resource: this.metallicRoughnessTextureView},\r\n          {binding: 7, resource: this.metallicRoughnessSampler},\r\n          {binding: 8, resource: {buffer: this.materialPBRBuffer}},\r\n          // NEW: dummy normal map\r\n          {binding: 9, resource: this.normalTextureView},\r\n          {binding: 10, resource: this.normalSampler},\r\n        ],\r\n      });\r\n    }\r\n  }\r\n\r\n  createLayoutForRender() {\r\n    let e = [\r\n      {\r\n        binding: 0,\r\n        visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\r\n        buffer: {type: 'uniform'},\r\n      },\r\n      ...(this.isVideo == false\r\n        ? [\r\n          {\r\n            binding: 1,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: \"depth\",\r\n              viewDimension: \"2d-array\", // <- must match shadowMapArray\r\n              multisampled: false,\r\n            },\r\n          },\r\n        ] : [{\r\n          binding: 1,\r\n          visibility: GPUShaderStage.FRAGMENT,\r\n          texture: {\r\n            sampleType: \"depth\",\r\n            viewDimension: \"2d\",\r\n          },\r\n        },])\r\n      , {\r\n        binding: 2,\r\n        visibility: GPUShaderStage.FRAGMENT,\r\n        sampler: {type: 'comparison'},\r\n      },\r\n      ...(this.isVideo\r\n        ? [ // VIDEO\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            externalTexture: {},\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}, // for video sampling\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          }\r\n        ]\r\n        : [ // IMAGE\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d',\r\n            },\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'},\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          },\r\n          {\r\n            binding: 6,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d'\r\n            }\r\n          },\r\n          {\r\n            binding: 7,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          },\r\n          {\r\n            binding: 8,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'}\r\n          },\r\n          {\r\n            binding: 9,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {sampleType: 'float', viewDimension: '2d'},\r\n          },\r\n          {\r\n            binding: 10,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          }\r\n        ])\r\n    ];\r\n    // console.log(\"BG E :  is used normal  \", this.material.type)\r\n    this.bglForRender = this.device.createBindGroupLayout({label: 'bglForRender', entries: e, });\r\n  }\r\n}", "export let fragmentVideoWGSL = `override shadowDepthTextureSize: f32 = 1024.0;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix : mat4x4f,\r\n  cameraViewProjMatrix : mat4x4f,\r\n  lightPos : vec3f,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMap: texture_depth_2d;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_external;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> postFXMode: u32;\r\n\r\nstruct FragmentInput {\r\n  @location(0) shadowPos : vec4f,\r\n  @location(1) fragPos : vec3f,\r\n  @location(2) fragNorm : vec3f,\r\n  @location(3) uv : vec2f,\r\n}\r\n\r\nconst albedo = vec3f(0.9);\r\nconst ambientFactor = 0.7;\r\n\r\n@fragment\r\nfn main(input : FragmentInput) -> @location(0) vec4f {\r\n  // Shadow filtering\r\n  var visibility = 0.0;\r\n  let oneOverShadowDepthTextureSize = 1.0 / shadowDepthTextureSize;\r\n  for (var y = -1; y <= 1; y++) {\r\n    for (var x = -1; x <= 1; x++) {\r\n      let offset = vec2f(vec2(x, y)) * oneOverShadowDepthTextureSize;\r\n      visibility += textureSampleCompare(\r\n        shadowMap, shadowSampler,\r\n        input.shadowPos.xy + offset, input.shadowPos.z - 0.007\r\n      );\r\n    }\r\n  }\r\n  visibility /= 9.0;\r\n\r\n  let lambertFactor = max(dot(normalize(scene.lightPos - input.fragPos), normalize(input.fragNorm)), 0.0);\r\n  let lightingFactor = min(ambientFactor + visibility * lambertFactor, 1.0);\r\n\r\n  // \u2705 Sample video texture\r\n  let textureColor = textureSampleBaseClampToEdge(meshTexture, meshSampler, input.uv);\r\n  let color: vec4f = vec4(textureColor.rgb * lightingFactor * albedo, 1.0);\r\n\r\n   switch (postFXMode) {\r\n    case 0: {\r\n      // Default\r\n      return color;\r\n    }\r\n    case 1: {\r\n      // Invert\r\n      return vec4f(1.0 - color.rgb, color.a);\r\n    }\r\n    case 2: {\r\n      // Grayscale\r\n      let gray = dot(color.rgb, vec3f(0.299, 0.587, 0.114));\r\n      return vec4f(vec3f(gray), color.a);\r\n    }\r\n    case 3: {\r\n      // Chroma Key\r\n      let keyColor = vec3f(0.0, 1.0, 0.0);\r\n      let threshold = 0.3;\r\n      let diff = distance(color.rgb, keyColor);\r\n      if (diff < threshold) {\r\n        return vec4f(0.0, 0.0, 0.0, 0.0);\r\n      }\r\n      return color;\r\n    }\r\n    default: {\r\n      return color;\r\n    }\r\n  }\r\n\r\n  // return color;\r\n}\r\n`;", "export let vertexWGSL_NM = `const MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n\r\nstruct VertexOutput {\r\n  @location(0) shadowPos: vec4f,\r\n  @location(1) fragPos: vec3f,\r\n  @location(2) fragNorm: vec3f,\r\n  @location(3) uv: vec2f,\r\n  @location(4) tangent: vec4f,      // NEW\r\n  @builtin(position) Position: vec4f,\r\n}\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @location(1) normal: vec3f,\r\n  @location(2) uv: vec2f,\r\n  @location(3) joints: vec4<u32>,\r\n  @location(4) weights: vec4<f32>,\r\n  @location(5) tangent: vec4f               // NEW\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  \r\n  // Skin positions & normals\r\n  var pos = vec4(position, 1.0);\r\n  var nrm = normal;\r\n  let skinned = skinVertex(pos, nrm, joints, weights);\r\n\r\n  // Skin tangent\r\n  var skinnedTangent = vec3f(tangent.xyz);\r\n  for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n      let jointIndex = joints[i];\r\n      let w = weights[i];\r\n      if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          let boneMat3 = mat3x3f(\r\n              boneMat[0].xyz,\r\n              boneMat[1].xyz,\r\n              boneMat[2].xyz\r\n          );\r\n          skinnedTangent += (boneMat3 * tangent.xyz) * w;\r\n      }\r\n  }\r\n\r\n  // Transform to world space\r\n  let worldPos = model.modelMatrix * skinned.position;\r\n  let normalMatrix = mat3x3f(\r\n      model.modelMatrix[0].xyz,\r\n      model.modelMatrix[1].xyz,\r\n      model.modelMatrix[2].xyz\r\n  );\r\n\r\n  output.Position = scene.cameraViewProjMatrix * worldPos;\r\n  output.fragPos = worldPos.xyz;\r\n  output.shadowPos = scene.lightViewProjMatrix * worldPos;\r\n  output.fragNorm = normalize(normalMatrix * skinned.normal);\r\n  output.uv = uv;\r\n  output.tangent = vec4(normalize(skinnedTangent), tangent.w);  // OUTPUT tangent\r\n\r\n  return output;\r\n}`;", "export const pointEffectShader = `struct Camera {\r\n  viewProj : mat4x4<f32>\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct ModelData {\r\n  model : mat4x4<f32>,  // \u2705 ADD MODEL MATRIX\r\n};\r\n@group(0) @binding(1) var<uniform> modelData : ModelData;\r\n\r\nstruct PointSettings {\r\n  pointSize : f32,\r\n  _padding : vec3<f32>,\r\n};\r\n@group(0) @binding(2) var<uniform> pointSettings : PointSettings;  // \u2705 Move to binding 2\r\n\r\nstruct VSIn {\r\n  @location(0) centerPos : vec3<f32>,\r\n  @location(1) color : vec3<f32>,\r\n  @builtin(vertex_index) vertexIdx : u32,\r\n  @builtin(instance_index) instanceIdx : u32,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) position : vec4<f32>,\r\n  @location(0) color : vec3<f32>,\r\n  @location(1) uv : vec2<f32>\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VSIn) -> VSOut {\r\n  var output : VSOut;\r\n  \r\n  let worldPos = modelData.model * vec4<f32>(input.centerPos, 1.0);\r\n  let clipPos = camera.viewProj * worldPos;\r\n  \r\n  let corners = array<vec2<f32>, 4>(\r\n    vec2(-1.0, -1.0),\r\n    vec2( 1.0, -1.0),\r\n    vec2(-1.0,  1.0),\r\n    vec2( 1.0,  1.0)\r\n  );\r\n  \r\n  // \u2705 Generate UV coordinates (0-1 range)\r\n  let uvs = array<vec2<f32>, 4>(\r\n    vec2(0.0, 0.0),\r\n    vec2(1.0, 0.0),\r\n    vec2(0.0, 1.0),\r\n    vec2(1.0, 1.0)\r\n  );\r\n  \r\n  let offset = corners[input.vertexIdx] * pointSettings.pointSize;\r\n  \r\n  let viewportSize = vec2<f32>(1920.0, 1080.0);\r\n  let ndcOffset = offset / viewportSize * 2.0;\r\n  \r\n  output.position = vec4<f32>(\r\n    clipPos.xy + ndcOffset * clipPos.w,\r\n    clipPos.z,\r\n    clipPos.w\r\n  );\r\n  \r\n  output.color = input.color;\r\n  output.uv = uvs[input.vertexIdx];  // \u2705 Pass UV\r\n  return output;\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  let color = input.color * 0.5 + 0.5;\r\n  \r\n  // \u2705 Circular point using UV\r\n  let center = vec2<f32>(0.5, 0.5);\r\n  let dist = length(input.uv - center);\r\n  let alpha = 1.0 - smoothstep(0.4, 0.5, dist);\r\n  \r\n  // Discard pixels outside circle\r\n  if (alpha < 0.01) {\r\n    discard;\r\n  }\r\n  \r\n  return vec4<f32>(color * alpha, alpha);\r\n}`;", "import {pointEffectShader} from \"../../shaders/topology-point/pointEffect\";\r\n\r\nexport class PointEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n    this.pointSize = 8.0;\r\n    this.enabled = true;\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Camera uniform buffer\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // Model buffer\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64, // mat4x4\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // Point settings buffer\r\n    this.pointSettingsBuffer = this.device.createBuffer({\r\n      size: 32,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n    \r\n    this.device.queue.writeBuffer(\r\n      this.pointSettingsBuffer, \r\n      0, \r\n      new Float32Array([this.pointSize, 0, 0, 0])\r\n    );\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        { binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {} },\r\n        { binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {} },\r\n        { binding: 2, visibility: GPUShaderStage.VERTEX, buffer: {} },\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        { binding: 0, resource: { buffer: this.cameraBuffer } },\r\n        { binding: 1, resource: { buffer: this.modelBuffer } },\r\n        { binding: 2, resource: { buffer: this.pointSettingsBuffer } },\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({ code: pointEffectShader });\r\n    const pipelineLayout = this.device.createPipelineLayout({ \r\n      bindGroupLayouts: [bindGroupLayout] \r\n    });\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          { \r\n            arrayStride: 3 * 4,\r\n            stepMode: 'instance',\r\n            attributes: [{ shaderLocation: 0, offset: 0, format: \"float32x3\" }] \r\n          },\r\n          { \r\n            arrayStride: 3 * 4,\r\n            stepMode: 'instance',\r\n            attributes: [{ shaderLocation: 1, offset: 0, format: \"float32x3\" }] \r\n          }\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{ \r\n          format: this.format,\r\n          blend: {\r\n            color: { srcFactor: \"src-alpha\", dstFactor: \"one-minus-src-alpha\", operation: \"add\" },\r\n            alpha: { srcFactor: \"one\", dstFactor: \"one-minus-src-alpha\", operation: \"add\" }\r\n          }\r\n        }]\r\n      },\r\n      primitive: { topology: \"triangle-strip\" },\r\n      depthStencil: { \r\n        depthWriteEnabled: false, \r\n        depthCompare: \"less-equal\", \r\n        format: \"depth24plus\" \r\n      }\r\n    });\r\n  }\r\n\r\n  // \u2705 THIS MATCHES FlameEffect PATTERN\r\n  updateInstanceData(baseModelMatrix) {\r\n    // You can apply additional transforms here if needed\r\n    // For now, just use the parent's model matrix directly\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, baseModelMatrix);\r\n  }\r\n\r\n  draw(pass, cameraMatrix, vertexBuffer, colorBuffer, vertexCount) {\r\n    if (!this.enabled) return;\r\n    \r\n    if (!vertexCount || typeof vertexCount !== 'number' || vertexCount <= 0) {\r\n      console.warn('PointEffect: invalid vertexCount', vertexCount);\r\n      return;\r\n    }\r\n    \r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, vertexBuffer);\r\n    pass.setVertexBuffer(1, colorBuffer);\r\n    \r\n    pass.draw(4, vertexCount, 0, 0);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix) {\r\n    if (!mesh.vertexBuffer) {\r\n      console.warn('PointEffect: mesh has no vertexBuffer');\r\n      return;\r\n    }\r\n    \r\n    let vertexCount = mesh.vertexCount;\r\n    \r\n    if (!vertexCount && mesh.vertexBuffer.size) {\r\n      vertexCount = mesh.vertexBuffer.size / (3 * 4);\r\n    }\r\n    \r\n    if (!vertexCount && mesh.geometry?.positions) {\r\n      vertexCount = mesh.geometry.positions.length / 3;\r\n    }\r\n    \r\n    if (!vertexCount || vertexCount <= 0) {\r\n      console.warn('PointEffect: could not determine vertexCount', mesh);\r\n      return;\r\n    }\r\n    \r\n    const colorBuffer = mesh.vertexNormalsBuffer;\r\n    \r\n    if (!colorBuffer) {\r\n      console.warn('PointEffect: mesh has no vertexNormalsBuffer');\r\n      return;\r\n    }\r\n    \r\n    this.draw(pass, viewProjMatrix, mesh.vertexBuffer, colorBuffer, vertexCount);\r\n  }\r\n\r\n  setPointSize(size) {\r\n    this.pointSize = size;\r\n    this.device.queue.writeBuffer(\r\n      this.pointSettingsBuffer, \r\n      0, \r\n      new Float32Array([this.pointSize, 0, 0, 0])\r\n    );\r\n  }\r\n\r\n  setEnabled(enabled) {\r\n    this.enabled = enabled;\r\n  }\r\n}", "export const gizmoEffect = `\r\nstruct Camera {\r\n  viewProj : mat4x4<f32>\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct ModelData {\r\n  model : mat4x4<f32>,\r\n};\r\n@group(0) @binding(1) var<uniform> modelData : ModelData;\r\n\r\nstruct GizmoSettings {\r\n  mode : u32,\r\n  size : f32,\r\n  selectedAxis : u32,\r\n  lineThickness : f32,\r\n};\r\n@group(0) @binding(2) var<uniform> gizmoSettings : GizmoSettings;\r\n\r\nstruct VSIn {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) color : vec3<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) position : vec4<f32>,\r\n  @location(0) color : vec3<f32>,\r\n  @location(1) worldPos : vec3<f32>,\r\n  @location(2) axisId : f32,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VSIn) -> VSOut {\r\n  var output : VSOut;\r\n  \r\n  let worldPos = modelData.model * vec4<f32>(input.position * gizmoSettings.size, 1.0);\r\n  output.position = camera.viewProj * worldPos;\r\n  output.worldPos = worldPos.xyz;\r\n  \r\n  // Determine which axis based on color\r\n  var axisId = 0.0;\r\n  if (input.color.r > 0.9) { axisId = 1.0; } // X axis\r\n  else if (input.color.g > 0.9) { axisId = 2.0; } // Y axis\r\n  else if (input.color.b > 0.9) { axisId = 3.0; } // Z axis\r\n  \r\n  output.axisId = axisId;\r\n  \r\n  // Highlight selected axis\r\n  var finalColor = input.color;\r\n  if (gizmoSettings.selectedAxis > 0u && u32(axisId) == gizmoSettings.selectedAxis) {\r\n    finalColor = vec3<f32>(1.0, 1.0, 0.0); // Yellow when selected\r\n  }\r\n  \r\n  output.color = finalColor;\r\n  return output;\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  return vec4<f32>(input.color, 1.0);\r\n}`;", "import {gizmoEffect} from \"../../shaders/gizmo/gimzoShader\";\r\n\r\nexport class GizmoEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n    this.enabled = true;\r\n    // 0=translate, 1=rotate, 2=scale\r\n    this.mode = 0;\r\n    this.size = 3;\r\n    this.selectedAxis = 0;\r\n    this.movementScale = 0.01;\r\n    this.isDragging = false;\r\n    this.dragStartPoint = null;\r\n    this.dragAxis = 0;\r\n    this.parentMesh = null;\r\n    this.initialPosition = null;\r\n    this._initPipeline();\r\n    this._setupEventListeners();\r\n\r\n    addEventListener(\"editor-set-gizmo-mode\", (e) => {\r\n      console.log(\"MODE:\", e.detail.mode)\r\n      this.setMode(e.detail.mode);\r\n    })\r\n  }\r\n\r\n  _initPipeline() {\r\n    this._createTranslateGizmo();\r\n    this.cameraBuffer = this.device.createBuffer({size: 64, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST});\r\n    this.modelBuffer = this.device.createBuffer({size: 64, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST});\r\n    this.gizmoSettingsBuffer = this.device.createBuffer({size: 32, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST});\r\n    this._updateGizmoSettings();\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 2, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}},\r\n      ]\r\n    });\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n        {binding: 2, resource: {buffer: this.gizmoSettingsBuffer}},\r\n      ]\r\n    });\r\n    const shaderModule = this.device.createShaderModule({code: gizmoEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({\r\n      bindGroupLayouts: [bindGroupLayout]\r\n    });\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          {\r\n            arrayStride: 3 * 4,\r\n            attributes: [{shaderLocation: 0, offset: 0, format: \"float32x3\"}]\r\n          },\r\n          {\r\n            arrayStride: 3 * 4,\r\n            attributes: [{shaderLocation: 1, offset: 0, format: \"float32x3\"}]\r\n          }\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {srcFactor: \"src-alpha\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"},\r\n            alpha: {srcFactor: \"one\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"}\r\n          }\r\n        }]\r\n      },\r\n      primitive: {topology: \"line-list\"},\r\n      depthStencil: {\r\n        depthWriteEnabled: false,\r\n        depthCompare: \"always\",\r\n        format: \"depth24plus\"\r\n      }\r\n    });\r\n  }\r\n\r\n  _createTranslateGizmo() {\r\n    const axisLength = 2.0;\r\n    const arrowSize = 0.15;\r\n    const positions = new Float32Array([\r\n      0, 0, 0, axisLength, 0, 0,\r\n      axisLength, 0, 0, axisLength - arrowSize, arrowSize, 0,\r\n      axisLength, 0, 0, axisLength - arrowSize, -arrowSize, 0,\r\n      axisLength, 0, 0, axisLength - arrowSize, 0, arrowSize,\r\n      axisLength, 0, 0, axisLength - arrowSize, 0, -arrowSize,\r\n      0, 0, 0, 0, axisLength, 0,\r\n      0, axisLength, 0, arrowSize, axisLength - arrowSize, 0,\r\n      0, axisLength, 0, -arrowSize, axisLength - arrowSize, 0,\r\n      0, axisLength, 0, 0, axisLength - arrowSize, arrowSize,\r\n      0, axisLength, 0, 0, axisLength - arrowSize, -arrowSize,\r\n      0, 0, 0, 0, 0, axisLength,\r\n      0, 0, axisLength, arrowSize, 0, axisLength - arrowSize,\r\n      0, 0, axisLength, -arrowSize, 0, axisLength - arrowSize,\r\n      0, 0, axisLength, 0, arrowSize, axisLength - arrowSize,\r\n      0, 0, axisLength, 0, -arrowSize, axisLength - arrowSize,\r\n    ]);\r\n\r\n    const colors = new Float32Array([\r\n      1, 0, 0, 1, 0, 0,\r\n      1, 0, 0, 1, 0, 0,\r\n      1, 0, 0, 1, 0, 0,\r\n      1, 0, 0, 1, 0, 0,\r\n      1, 0, 0, 1, 0, 0,\r\n      // Y axis (green)\r\n      0, 1, 0, 0, 1, 0,\r\n      0, 1, 0, 0, 1, 0,\r\n      0, 1, 0, 0, 1, 0,\r\n      0, 1, 0, 0, 1, 0,\r\n      0, 1, 0, 0, 1, 0,\r\n      // Z axis (blue)\r\n      0, 0, 1, 0, 0, 1,\r\n      0, 0, 1, 0, 0, 1,\r\n      0, 0, 1, 0, 0, 1,\r\n      0, 0, 1, 0, 0, 1,\r\n      0, 0, 1, 0, 0, 1,\r\n    ]);\r\n\r\n    this.vertexBuffer = this.device.createBuffer({size: positions.byteLength, usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST});\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, positions);\r\n    this.colorBuffer = this.device.createBuffer({size: colors.byteLength, usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST});\r\n    this.device.queue.writeBuffer(this.colorBuffer, 0, colors);\r\n    this.vertexCount = positions.length / 3;\r\n  }\r\n\r\n  _setupEventListeners() {\r\n    app.canvas.addEventListener(\"ray.hit.mousedown\", (e) => {\r\n      const detail = e.detail;\r\n      if(detail.hitObject === this.parentMesh && detail.hitObject.name === this.parentMesh.name) {\r\n        this._handleRayHit(detail);\r\n      } else {\r\n        e.detail.hitObject.effects.gizmoEffect = this;\r\n        this.parentMesh.effects.gizmoEffect = null;\r\n        this.parentMesh = e.detail.hitObject;\r\n        app.editor.editorHud.updateSceneObjPropertiesFromGizmo(this.parentMesh.name);\r\n        // console.log('Gizmo: ray.hit.mousedown :FINLA   ', this.parentMesh.name);\r\n      }\r\n    });\r\n    app.canvas.addEventListener(\"mousemove\", (e) => {\r\n      if(this.isDragging && e.buttons === 1) {\r\n        this._handleDrag(e);\r\n        if(app.cameras.WASD) app.cameras.WASD.suspendDrag = true;\r\n      } else if(this.isDragging && e.buttons === 0) {\r\n        this.isDragging = false;\r\n        this.selectedAxis = 0;\r\n        this._updateGizmoSettings();\r\n      } else {\r\n        if(app.cameras.WASD) app.cameras.WASD.suspendDrag = false;\r\n      }\r\n    });\r\n    app.canvas.addEventListener(\"mouseup\", () => {\r\n      if(this.isDragging) {\r\n        // console.log('Gizmo: Stopped dragging:', this.parentMesh.name);\r\n        // console.log('What is selectedAxis: ', this.selectedAxis)\r\n        // console.log('What is operation: ', this.mode)\r\n        if (this.parentMesh._GRAPH_CACHE) return;\r\n        if(this.mode == 0) {\r\n          // 1 x  2 y  3 z\r\n          // // inputFor: \"Cube_0\" property: \"x\" propertyId: \"position\" value: \"1\"\r\n          document.dispatchEvent(new CustomEvent('web.editor.update.pos', {\r\n            detail: {\r\n              inputFor: this.parentMesh.name,\r\n              propertyId: \"position\",\r\n              property: this.selectedAxis == 1 ? \"x\" : this.selectedAxis == 2 ?\r\n                \"y\" : \"z\",\r\n              value: this.selectedAxis == 1 ? this.parentMesh.position.x : this.selectedAxis == 2 ?\r\n                this.parentMesh.position.y : this.parentMesh.position.z\r\n            }\r\n          }))\r\n        } else if(this.mode == 1) {\r\n          document.dispatchEvent(new CustomEvent('web.editor.update.rot', {\r\n            detail: {\r\n              inputFor: this.parentMesh.name,\r\n              propertyId: \"rotation\",\r\n              property: this.selectedAxis == 1 ? \"x\" : this.selectedAxis == 2 ?\r\n                \"y\" : \"z\",\r\n              value: this.selectedAxis == 1 ? this.parentMesh.rotation.x : this.selectedAxis == 2 ?\r\n                this.parentMesh.rotation.y : this.parentMesh.rotation.z\r\n            }\r\n          }));\r\n        } else if(this.mode == 2) {\r\n          // if(e.detail.property == '0' || e.detail.property == '1' || e.detail.property == '2') {\r\n            document.dispatchEvent(new CustomEvent('web.editor.update.scale', {\r\n              detail: {\r\n                inputFor: this.parentMesh.name,\r\n                propertyId: \"scale\",\r\n                property: this.selectedAxis == 1 ? \"0\" : this.selectedAxis == 2 ?\r\n                  \"1\" : \"2\",\r\n                value: this.selectedAxis == 1 ? this.parentMesh.rotation.x : this.selectedAxis == 2 ?\r\n                  this.parentMesh.rotation.y : this.parentMesh.rotation.z\r\n              }\r\n            }));\r\n        }\r\n        // finish job\r\n        this.isDragging = false;\r\n        this.selectedAxis = 0;\r\n        this._updateGizmoSettings();\r\n      }\r\n    });\r\n  }\r\n\r\n  _handleRayHit(detail) {\r\n    const {rayOrigin, rayDirection, hitPoint} = detail;\r\n    const axis = this._raycastAxis(rayOrigin, rayDirection, detail.hitObject);\r\n    if(axis > 0) {\r\n      this.selectedAxis = axis;\r\n      this.dragStartPoint = [...hitPoint];\r\n      this.initialPosition = {\r\n        x: this.parentMesh.position.x,\r\n        y: this.parentMesh.position.y,\r\n        z: this.parentMesh.position.z\r\n      };\r\n      this.dragAxis = axis;\r\n      this._updateGizmoSettings();\r\n      this.isDragging = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n * Get the screen-space direction of a world axis\r\n * @param {number} axisIndex - 0=X, 1=Y, 2=Z\r\n * @returns {{x: number, y: number}} - Normalized 2D screen direction\r\n */\r\n  _getAxisScreenDirection(axisIndex) {\r\n    // Get world axis vector\r\n    const worldAxis = [\r\n      [1, 0, 0], // X\r\n      [0, 1, 0], // Y\r\n      [0, 0, 1]  // Z\r\n    ][axisIndex];\r\n    // Transform axis to camera space\r\n    const viewMatrix = app.cameras.WASD.matrix_;\r\n    const projMatrix = app.cameras.WASD.projectionMatrix;\r\n    const p1 = this.parentMesh.position;\r\n    // Point 2: Object position + axis direction\r\n    const p2 = {\r\n      x: p1.x + worldAxis[0],\r\n      y: p1.y + worldAxis[1],\r\n      z: p1.z + worldAxis[2]\r\n    };\r\n\r\n    // Project both points to screen space\r\n    const screen1 = this._worldToScreen(p1, viewMatrix, projMatrix);\r\n    const screen2 = this._worldToScreen(p2, viewMatrix, projMatrix);\r\n\r\n    // Get screen-space direction\r\n    const dx = screen2.x - screen1.x;\r\n    const dy = screen2.y - screen1.y;\r\n    const length = Math.sqrt(dx * dx + dy * dy);\r\n\r\n    // Return normalized direction\r\n    return {\r\n      x: length > 0.001 ? dx / length : 0,\r\n      y: length > 0.001 ? dy / length : 0\r\n    };\r\n  }\r\n\r\n  _worldToScreen(worldPos, viewMatrix, projMatrix) {\r\n    // Transform to clip space\r\n    const clipPos = this._transformPoint(worldPos, viewMatrix, projMatrix);\r\n\r\n    // Perspective divide\r\n    const ndcX = clipPos.x / clipPos.w;\r\n    const ndcY = clipPos.y / clipPos.w;\r\n\r\n    // Convert to screen coordinates (assuming viewport)\r\n    const screenX = (ndcX + 1) * 0.5 * app.canvas.width;\r\n    const screenY = (1 - ndcY) * 0.5 * app.canvas.height; // Flip Y\r\n\r\n    return {x: screenX, y: screenY};\r\n  }\r\n\r\n  _transformPoint(point, viewMatrix, projMatrix) {\r\n    // Combine view * projection\r\n    const vp = this._multiplyMatrices(projMatrix, viewMatrix);\r\n\r\n    // Transform point\r\n    const x = vp[0] * point.x + vp[4] * point.y + vp[8] * point.z + vp[12];\r\n    const y = vp[1] * point.x + vp[5] * point.y + vp[9] * point.z + vp[13];\r\n    const z = vp[2] * point.x + vp[6] * point.y + vp[10] * point.z + vp[14];\r\n    const w = vp[3] * point.x + vp[7] * point.y + vp[11] * point.z + vp[15];\r\n\r\n    return {x, y, z, w};\r\n  }\r\n\r\n  _multiplyMatrices(a, b) {\r\n    const result = new Array(16);\r\n    for(let i = 0;i < 4;i++) {\r\n      for(let j = 0;j < 4;j++) {\r\n        result[i * 4 + j] =\r\n          a[i * 4 + 0] * b[0 * 4 + j] +\r\n          a[i * 4 + 1] * b[1 * 4 + j] +\r\n          a[i * 4 + 2] * b[2 * 4 + j] +\r\n          a[i * 4 + 3] * b[3 * 4 + j];\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  _handleDrag(mouseEvent) {\r\n    if(!this.parentMesh || !this.dragStartPoint || !this.isDragging) return;\r\n    const deltaX = mouseEvent.movementX;\r\n    const deltaY = mouseEvent.movementY;\r\n    const direction = deltaX > Math.abs(deltaY) ? deltaX : -deltaY;\r\n    switch(this.mode) {\r\n      case 0:\r\n        switch(this.dragAxis) {\r\n          case 1: this.parentMesh.position.x += deltaX * this.movementScale; break;\r\n          case 2: this.parentMesh.position.y -= deltaY * this.movementScale; break;\r\n          // case 3: this.parentMesh.position.z -= direction * this.movementScale; break;\r\n          case 3:\r\n            const zAxisScreenDir = this._getAxisScreenDirection(2); // Z = axis index 2\r\n            const mouseDelta = {x: deltaX, y: -deltaY}; // Flip Y for screen coords\r\n            // Dot product: how much does mouse movement align with Z-axis on screen?\r\n            const movement = (mouseDelta.x * zAxisScreenDir.x +\r\n              mouseDelta.y * zAxisScreenDir.y);\r\n            this.parentMesh.position.z += movement * this.movementScale;\r\n        }\r\n        break;\r\n      case 1:\r\n        const rotSpeed = 0.1;\r\n        switch(this.dragAxis) {\r\n          case 1: this.parentMesh.rotation.x += deltaY * rotSpeed; break;\r\n          case 2: this.parentMesh.rotation.y += deltaX * rotSpeed; break;\r\n          case 3: this.parentMesh.rotation.z += direction * rotSpeed; break;\r\n        }\r\n        break;\r\n      case 2:\r\n        const scaleSpeed = 0.01;\r\n        switch(this.dragAxis) {\r\n          case 1: this.parentMesh.scale[0] += deltaX * scaleSpeed; break;\r\n          case 2: this.parentMesh.scale[1] += -deltaY * scaleSpeed; break;\r\n          case 3: this.parentMesh.scale[2] += -direction * scaleSpeed; break;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  _raycastAxis(rayOrigin, rayDirection, mesh) {\r\n    const gizmoPos = [\r\n      mesh.position.x,\r\n      mesh.position.y,\r\n      mesh.position.z\r\n    ];\r\n    const threshold = 0.1 * this.size;\r\n    const xEnd = [gizmoPos[0] + 2 * this.size, gizmoPos[1], gizmoPos[2]];\r\n    const xHit = this._rayIntersectsLine(rayOrigin, rayDirection, gizmoPos, xEnd, threshold);\r\n    if(xHit) return 1;\r\n    const yEnd = [gizmoPos[0], gizmoPos[1] + 2 * this.size, gizmoPos[2]];\r\n    const yHit = this._rayIntersectsLine(rayOrigin, rayDirection, gizmoPos, yEnd, threshold);\r\n    if(yHit) return 2;\r\n    const zEnd = [gizmoPos[0], gizmoPos[1], gizmoPos[2] + 2 * this.size];\r\n    const zHit = this._rayIntersectsLine(rayOrigin, rayDirection, gizmoPos, zEnd, threshold);\r\n    if(zHit) return 3;\r\n    return 0;\r\n  }\r\n\r\n  _rayIntersectsLine(rayOrigin, rayDir, lineStart, lineEnd, threshold) {\r\n    const ro = Array.isArray(rayOrigin) ? rayOrigin : [rayOrigin[0], rayOrigin[1], rayOrigin[2]];\r\n    const rd = [rayDir[0], rayDir[1], rayDir[2]];\r\n    const rdLen = Math.sqrt(rd[0] ** 2 + rd[1] ** 2 + rd[2] ** 2);\r\n    const ray = [rd[0] / rdLen, rd[1] / rdLen, rd[2] / rdLen];\r\n    const line = [\r\n      lineEnd[0] - lineStart[0],\r\n      lineEnd[1] - lineStart[1],\r\n      lineEnd[2] - lineStart[2]\r\n    ];\r\n    const w = [\r\n      ro[0] - lineStart[0],\r\n      ro[1] - lineStart[1],\r\n      ro[2] - lineStart[2]\r\n    ];\r\n    const a = ray[0] ** 2 + ray[1] ** 2 + ray[2] ** 2;\r\n    const b = ray[0] * line[0] + ray[1] * line[1] + ray[2] * line[2];\r\n    const c = line[0] ** 2 + line[1] ** 2 + line[2] ** 2;\r\n    const d = ray[0] * w[0] + ray[1] * w[1] + ray[2] * w[2];\r\n    const e = line[0] * w[0] + line[1] * w[1] + line[2] * w[2];\r\n    const denom = a * c - b * b;\r\n    if(Math.abs(denom) < 0.0001) return false;\r\n    const sc = (b * e - c * d) / denom;\r\n    const tc = (a * e - b * d) / denom;\r\n    if(tc < 0 || tc > 1) return false;\r\n    const closestOnRay = [\r\n      ro[0] + sc * ray[0],\r\n      ro[1] + sc * ray[1],\r\n      ro[2] + sc * ray[2]\r\n    ];\r\n    const closestOnLine = [\r\n      lineStart[0] + tc * line[0],\r\n      lineStart[1] + tc * line[1],\r\n      lineStart[2] + tc * line[2]\r\n    ];\r\n    const dist = Math.sqrt((closestOnRay[0] - closestOnLine[0]) ** 2 + (closestOnRay[1] - closestOnLine[1]) ** 2 + (closestOnRay[2] - closestOnLine[2]) ** 2);\r\n    // console.log('Distance to line:', dist, 'threshold:', threshold);\r\n    return dist < threshold;\r\n  }\r\n\r\n  _updateGizmoSettings() {\r\n    const data = new Float32Array([this.mode, this.size, this.selectedAxis, 1.0]);\r\n    this.device.queue.writeBuffer(this.gizmoSettingsBuffer, 0, data);\r\n  }\r\n\r\n  updateInstanceData(baseModelMatrix) {\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, baseModelMatrix);\r\n  }\r\n\r\n  draw(pass, cameraMatrix) {\r\n    if(!this.enabled) return;\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.colorBuffer);\r\n    pass.draw(this.vertexCount);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix) {\r\n    this.parentMesh = mesh;\r\n    this.draw(pass, viewProjMatrix);\r\n  }\r\n\r\n  setMode(mode) {\r\n    this.mode = mode;\r\n    this._updateGizmoSettings();\r\n  }\r\n\r\n  setSize(size) {\r\n    this.size = size;\r\n    this._updateGizmoSettings();\r\n  }\r\n\r\n  setSelectedAxis(axis) {\r\n    this.selectedAxis = axis;\r\n    this._updateGizmoSettings();\r\n  }\r\n\r\n  setEnabled(enabled) {\r\n    this.enabled = enabled;\r\n  }\r\n}", "/**\r\n * @description\r\n * Dust/Smoke Particle Shader (WGSL)\r\n * For Matrix-Engine-WGPU DestructionEffect\r\n * \r\n * Features:\r\n * - Billboarded quads (always face camera)\r\n * - Soft particles with smooth fade\r\n * - GPU instancing for performance\r\n * - Procedural noise for organic look\r\n */\r\nexport const dustShader = `\r\n\r\n// Uniforms\r\nstruct Camera {\r\n  viewProj: mat4x4<f32>,\r\n};\r\n\r\nstruct Model {\r\n  world: mat4x4<f32>,\r\n  time: f32,\r\n  intensity: f32,\r\n  _padding1: f32,\r\n  _padding2: f32,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> camera: Camera;\r\n@group(0) @binding(1) var<uniform> model: Model;\r\n\r\n// Vertex input (shared quad)\r\nstruct VertexInput {\r\n  @location(0) position: vec3<f32>,      // Quad corner position\r\n  @location(1) uv: vec2<f32>,            // UV coordinates\r\n};\r\n\r\n// Instance input (per-particle data)\r\nstruct InstanceInput {\r\n  @location(2) posSize: vec4<f32>,       // xyz = position, w = size\r\n  @location(3) velLife: vec4<f32>,       // xyz = velocity, w = life\r\n  @location(4) color: vec4<f32>,         // rgba = color\r\n};\r\n\r\n// Vertex output\r\nstruct VertexOutput {\r\n  @builtin(position) position: vec4<f32>,\r\n  @location(0) uv: vec2<f32>,\r\n  @location(1) color: vec4<f32>,\r\n  @location(2) life: f32,\r\n  @location(3) worldPos: vec3<f32>,\r\n};\r\n\r\n// Vertex shader - Billboard particles to face camera\r\n@vertex\r\nfn vsMain(\r\n  input: VertexInput,\r\n  instance: InstanceInput,\r\n  @builtin(instance_index) instanceIdx: u32\r\n) -> VertexOutput {\r\n  var output: VertexOutput;\r\n  \r\n  // Get particle world position\r\n  let particleWorldPos = (model.world * vec4<f32>(instance.posSize.xyz, 1.0)).xyz;\r\n  \r\n  // Extract camera right and up vectors from view matrix\r\n  // Since viewProj = projection * view, we need to extract view\r\n  // For billboarding, we'll use a simplified approach:\r\n  // Right = (1, 0, 0) in view space\r\n  // Up = (0, 1, 0) in view space\r\n  \r\n  // Simple billboarding: offset quad corners in screen space\r\n  let size = instance.posSize.w;\r\n  let quadOffset = input.position.xy * size;\r\n  \r\n  // Billboard quad (face camera)\r\n  // Extract camera right and up from inverse view\r\n  let right = normalize(vec3<f32>(camera.viewProj[0][0], camera.viewProj[1][0], camera.viewProj[2][0]));\r\n  let up = normalize(vec3<f32>(camera.viewProj[0][1], camera.viewProj[1][1], camera.viewProj[2][1]));\r\n  \r\n  // Compute final world position\r\n  let worldPos = particleWorldPos + right * quadOffset.x + up * quadOffset.y;\r\n  \r\n  // Project to clip space\r\n  output.position = camera.viewProj * vec4<f32>(worldPos, 1.0);\r\n  output.uv = input.uv;\r\n  output.color = instance.color;\r\n  output.life = instance.velLife.w;\r\n  output.worldPos = worldPos;\r\n  \r\n  return output;\r\n}\r\n\r\n// Procedural noise function (for organic particle appearance)\r\nfn hash(p: vec2<f32>) -> f32 {\r\n  var p2 = fract(p * vec2<f32>(123.34, 456.21));\r\n  p2 += dot(p2, p2 + 45.32);\r\n  return fract(p2.x * p2.y);\r\n}\r\n\r\nfn noise(p: vec2<f32>) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  \r\n  let a = hash(i);\r\n  let b = hash(i + vec2<f32>(1.0, 0.0));\r\n  let c = hash(i + vec2<f32>(0.0, 1.0));\r\n  let d = hash(i + vec2<f32>(1.0, 1.0));\r\n  \r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  \r\n  return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\r\n}\r\n\r\n// Fractal Brownian Motion (multi-octave noise)\r\nfn fbm(p: vec2<f32>) -> f32 {\r\n  var value = 0.0;\r\n  var amplitude = 0.5;\r\n  var frequency = 1.0;\r\n  var p2 = p;\r\n  \r\n  for (var i = 0; i < 4; i++) {\r\n    value += amplitude * noise(p2 * frequency);\r\n    frequency *= 2.0;\r\n    amplitude *= 0.5;\r\n  }\r\n  \r\n  return value;\r\n}\r\n\r\n// Fragment shader - Soft particle with noise\r\n@fragment\r\nfn fsMain(input: VertexOutput) -> @location(0) vec4<f32> {\r\n  // Distance from center (for radial fade)\r\n  let center = vec2<f32>(0.5, 0.5);\r\n  let dist = length(input.uv - center);\r\n  \r\n  // Radial gradient (soft circular particle)\r\n  var alpha = 1.0 - smoothstep(0.0, 0.5, dist);\r\n  \r\n  // Apply noise for organic look\r\n  let noiseScale = 3.0;\r\n  let noiseUV = input.uv * noiseScale + vec2<f32>(model.time * 0.1);\r\n  let noiseValue = fbm(noiseUV);\r\n  \r\n  // Modulate alpha with noise\r\n  alpha *= noiseValue * 1.5;\r\n  \r\n  // Fade based on particle life\r\n  let lifeFade = clamp(input.life / 0.5, 0.0, 1.0); // Fade in last 0.5s\r\n  alpha *= lifeFade;\r\n  \r\n  // Apply instance color\r\n  var finalColor = input.color;\r\n  finalColor.a *= alpha * model.intensity;\r\n  \r\n  // Discard fully transparent fragments\r\n  if (finalColor.a < 0.01) {\r\n    discard;\r\n  }\r\n  \r\n  return finalColor;\r\n}\r\n`;", "/**\r\n * @class DestructionEffect\r\n * @description Complete destruction effect with particle smoke/dust for MOBA\r\n * Matches Matrix-Engine-WGPU effect interface (like FlameEffect)\r\n * \r\n * Features:\r\n * - Particle-based smoke/dust system\r\n * - GPU instancing for performance\r\n * - Inherits parent transform via baseModelMatrix\r\n * - Own pipeline, shares draw pass\r\n * \r\n * @note Based on Matrix-Engine-WGPU architecture\r\n * but can be isolatted.Effects are standalone sub\r\n * system in matrix-engine-wgpu.\r\n */\r\n\r\nimport {mat4} from \"wgpu-matrix\";\r\nimport {dustShader} from \"../../shaders/desctruction/dust-shader.wgsl.js\";\r\n\r\nexport class DestructionEffect {\r\n  constructor(device, format, config = {}) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    // Configuration\r\n    this.particleCount = config.particleCount || 100;\r\n    this.duration = config.duration || 2.5;\r\n    this.spread = config.spread || 5.0;\r\n\r\n    // State\r\n    this.time = 0;\r\n    this.enabled = false;\r\n    this.particles = [];\r\n\r\n    // Visual properties\r\n    this.color = config.color || [0.6, 0.5, 0.4, 1.0]; // Brownish dust\r\n    this.intensity = 1.0;\r\n\r\n    this._initPipeline();\r\n    this._initParticles();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Single quad for billboarded particles\r\n    const S = 1.0; // Base particle size\r\n    const vertexData = new Float32Array([\r\n      -0.5 * S, 0.5 * S, 0,  // Top-left\r\n      0.5 * S, 0.5 * S, 0,   // Top-right\r\n      -0.5 * S, -0.5 * S, 0, // Bottom-left\r\n      0.5 * S, -0.5 * S, 0,  // Bottom-right\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 0,  // Top-left\r\n      1, 0,  // Top-right\r\n      0, 1,  // Bottom-left\r\n      1, 1   // Bottom-right\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    // Vertex buffer (shared quad geometry)\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    // UV buffer\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    // Index buffer\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // Instance buffer (per-particle data: position, velocity, life, size)\r\n    // Format: vec4(pos.xyz, size) + vec4(vel.xyz, life) + vec4(color.rgba)\r\n    const maxParticles = this.particleCount;\r\n    const instanceDataSize = maxParticles * (4 + 4 + 4) * 4; // 3 vec4s per particle\r\n\r\n    this.instanceBuffer = this.device.createBuffer({\r\n      size: instanceDataSize,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // Uniform buffers\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64, // mat4x4\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64 + 16 + 16, // model matrix + time + intensity (padded)\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // Bind group layout\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}}, // camera\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}}, // model + time\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    // Shader module\r\n    const shaderModule = this.device.createShaderModule({code: dustShader});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    // Render pipeline with alpha blending\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          // Vertex positions (per-vertex, shared quad)\r\n          {\r\n            arrayStride: 3 * 4,\r\n            stepMode: \"vertex\",\r\n            attributes: [{shaderLocation: 0, offset: 0, format: \"float32x3\"}]\r\n          },\r\n          // UVs (per-vertex, shared quad)\r\n          {\r\n            arrayStride: 2 * 4,\r\n            stepMode: \"vertex\",\r\n            attributes: [{shaderLocation: 1, offset: 0, format: \"float32x2\"}]\r\n          },\r\n          // Instance data (per-particle)\r\n          {\r\n            arrayStride: 12 * 4, // 3 vec4s = 12 floats\r\n            stepMode: \"instance\",\r\n            attributes: [\r\n              {shaderLocation: 2, offset: 0, format: \"float32x4\"},      // position + size\r\n              {shaderLocation: 3, offset: 16, format: \"float32x4\"},     // velocity + life\r\n              {shaderLocation: 4, offset: 32, format: \"float32x4\"}      // color\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {srcFactor: \"src-alpha\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"},\r\n            alpha: {srcFactor: \"one\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"}\r\n          }\r\n        }]\r\n      },\r\n      primitive: {topology: \"triangle-list\", cullMode: \"none\"},\r\n      depthStencil: {\r\n        depthWriteEnabled: false, // Particles don't write depth\r\n        depthCompare: \"less\",\r\n        format: \"depth24plus\"\r\n      }\r\n    });\r\n  }\r\n\r\n  _initParticles() {\r\n    // Initialize particle data\r\n    for(let i = 0;i < this.particleCount;i++) {\r\n      this.particles.push({\r\n        // Local position offset from parent\r\n        position: [0, 0, 0],\r\n        velocity: [0, 0, 0],\r\n        life: 0,\r\n        maxLife: 0,\r\n        size: 0,\r\n        color: [...this.color]\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger the destruction effect\r\n   * Spawns all particles with random velocities\r\n   */\r\n  trigger() {\r\n    this.enabled = true;\r\n    this.time = 0;\r\n\r\n    // Spawn particles\r\n    for(let i = 0;i < this.particleCount;i++) {\r\n      const particle = this.particles[i];\r\n\r\n      // Random position in small sphere\r\n      const theta = Math.random() * Math.PI * 2;\r\n      const phi = Math.acos(2 * Math.random() - 1);\r\n      const r = Math.random() * 0.5;\r\n\r\n      particle.position = [\r\n        r * Math.sin(phi) * Math.cos(theta),\r\n        Math.random() * 1.0, // Slightly upward bias\r\n        r * Math.sin(phi) * Math.sin(theta)\r\n      ];\r\n\r\n      // Random velocity (explosion pattern)\r\n      const speed = 2.0 + Math.random() * 3.0;\r\n      const vTheta = Math.random() * Math.PI * 2;\r\n      const vPhi = Math.acos(2 * Math.random() - 1);\r\n\r\n      particle.velocity = [\r\n        speed * Math.sin(vPhi) * Math.cos(vTheta),\r\n        speed * Math.abs(Math.sin(vPhi)) * 2.0, // Upward bias\r\n        speed * Math.sin(vPhi) * Math.sin(vTheta)\r\n      ];\r\n\r\n      // Random lifetime\r\n      particle.maxLife = 1.0 + Math.random() * 1.5;\r\n      particle.life = particle.maxLife;\r\n\r\n      // Random size\r\n      particle.size = 0.5 + Math.random() * 1.5;\r\n\r\n      // Color with slight variation\r\n      particle.color = [\r\n        this.color[0] + (Math.random() - 0.5) * 0.2,\r\n        this.color[1] + (Math.random() - 0.5) * 0.2,\r\n        this.color[2] + (Math.random() - 0.5) * 0.2,\r\n        1.0\r\n      ];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update particle simulation\r\n   */\r\n  update(dt) {\r\n    if(!this.enabled) return;\r\n\r\n    this.time += dt;\r\n\r\n    let aliveCount = 0;\r\n\r\n    // Update each particle\r\n    for(let i = 0;i < this.particleCount;i++) {\r\n      const p = this.particles[i];\r\n\r\n      if(p.life <= 0) continue;\r\n\r\n      // Physics update\r\n      p.velocity[1] -= 2.0 * dt; // Gravity\r\n\r\n      // Damping (air resistance)\r\n      p.velocity[0] *= 0.98;\r\n      p.velocity[1] *= 0.98;\r\n      p.velocity[2] *= 0.98;\r\n\r\n      // Position update\r\n      p.position[0] += p.velocity[0] * dt;\r\n      p.position[1] += p.velocity[1] * dt;\r\n      p.position[2] += p.velocity[2] * dt;\r\n\r\n      // Life update\r\n      p.life -= dt;\r\n\r\n      // Fade out\r\n      const lifeRatio = p.life / p.maxLife;\r\n      p.color[3] = lifeRatio * this.intensity;\r\n\r\n      // Size grows over time (smoke expansion)\r\n      p.size = (0.5 + Math.random() * 1.5) * (1.0 + (1.0 - lifeRatio) * 2.0);\r\n\r\n      aliveCount++;\r\n    }\r\n\r\n    // Disable if all particles dead\r\n    if(aliveCount === 0 && this.time > this.duration) {\r\n      this.enabled = false;\r\n    }\r\n\r\n    // Update instance buffer\r\n    this._updateInstanceBuffer();\r\n  }\r\n\r\n  _updateInstanceBuffer() {\r\n    // Pack particle data into instance buffer\r\n    const instanceData = new Float32Array(this.particleCount * 12);\r\n\r\n    for(let i = 0;i < this.particleCount;i++) {\r\n      const p = this.particles[i];\r\n      const offset = i * 12;\r\n\r\n      // vec4: position + size\r\n      instanceData[offset + 0] = p.position[0];\r\n      instanceData[offset + 1] = p.position[1];\r\n      instanceData[offset + 2] = p.position[2];\r\n      instanceData[offset + 3] = p.size;\r\n\r\n      // vec4: velocity + life\r\n      instanceData[offset + 4] = p.velocity[0];\r\n      instanceData[offset + 5] = p.velocity[1];\r\n      instanceData[offset + 6] = p.velocity[2];\r\n      instanceData[offset + 7] = p.life;\r\n\r\n      // vec4: color\r\n      instanceData[offset + 8] = p.color[0];\r\n      instanceData[offset + 9] = p.color[1];\r\n      instanceData[offset + 10] = p.color[2];\r\n      instanceData[offset + 11] = p.color[3];\r\n    }\r\n\r\n    this.device.queue.writeBuffer(this.instanceBuffer, 0, instanceData);\r\n  }\r\n\r\n  /**\r\n   * Update instance data with parent transform\r\n   * Called by parent object before rendering\r\n   */\r\n  updateInstanceData(baseModelMatrix) {\r\n    const local = mat4.identity();\r\n\r\n    // Local offset (if needed)\r\n    // mat4.translate(local, [0, 2, 0], local); // Offset upward slightly\r\n\r\n    // Multiply with baseModelMatrix to inherit world transform\r\n    const finalMat = mat4.identity();\r\n    mat4.multiply(baseModelMatrix, local, finalMat);\r\n\r\n    // Update GPU buffer\r\n    const timeBuffer = new Float32Array([this.time]);\r\n    const intensityBuffer = new Float32Array([this.intensity]);\r\n\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, finalMat);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, timeBuffer);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 80, intensityBuffer);\r\n  }\r\n\r\n  /**\r\n   * Draw particles\r\n   */\r\n  draw(pass, cameraMatrix) {\r\n    if(!this.enabled) return;\r\n\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setVertexBuffer(2, this.instanceBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, \"uint16\");\r\n\r\n    // Draw instanced (one quad per particle)\r\n    pass.drawIndexed(this.indexCount, this.particleCount);\r\n  }\r\n\r\n  /**\r\n   * Main render method (called by parent)\r\n   */\r\n  render(pass, mesh, viewProjMatrix, dt = 0.016) {\r\n    if(!this.enabled) return;\r\n\r\n    this.update(dt);\r\n    this.draw(pass, viewProjMatrix);\r\n  }\r\n\r\n  /**\r\n   * Set effect intensity\r\n   */\r\n  setIntensity(v) {\r\n    this.intensity = v;\r\n  }\r\n\r\n  /**\r\n   * Check if effect is still active\r\n   */\r\n  isActive() {\r\n    return this.enabled;\r\n  }\r\n\r\n  /**\r\n   * Reset effect\r\n   */\r\n  reset() {\r\n    this.enabled = false;\r\n    this.time = 0;\r\n    for(let p of this.particles) {\r\n      p.life = 0;\r\n    }\r\n  }\r\n}\r\n", "export const flameEffect = /* wgsl */`\r\n\r\nstruct Camera {\r\n  viewProj : mat4x4<f32>\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\n// Uniform buffer layout (112 bytes, all vec4-aligned):\r\n//   offset   0 : model        mat4x4<f32>   (64 bytes)\r\n//   offset  64 : timeSpeed    vec4<f32>     (.x = time, .y = speed)\r\n//   offset  80 : params       vec4<f32>     (.x = intensity, .y = turbulence, .z = stretch)\r\n//   offset  96 : tint         vec4<f32>     (.xyz = rgb tint colour, .w = tint strength 0..1)\r\nstruct ModelData {\r\n  model     : mat4x4<f32>,\r\n  timeSpeed : vec4<f32>,\r\n  params    : vec4<f32>,\r\n  tint      : vec4<f32>,\r\n};\r\n@group(0) @binding(1) var<uniform> modelData : ModelData;\r\n\r\nstruct VSIn {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) position  : vec4<f32>,\r\n  @location(0)       uv        : vec2<f32>,\r\n  // Pack all scalar params into two interpolants to stay within limits\r\n  @location(1)       p0        : vec4<f32>, // .x=time .y=speed .z=intensity .w=turbulence\r\n  @location(2)       p1        : vec4<f32>, // .x=stretch .y=tintStrength\r\n  @location(3)       tintColor : vec3<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VSIn) -> VSOut {\r\n  var output : VSOut;\r\n\r\n  let worldPos     = modelData.model * vec4<f32>(input.position, 1.0);\r\n  output.position  = camera.viewProj * worldPos;\r\n  output.uv        = input.uv;\r\n\r\n  output.p0 = vec4<f32>(\r\n    modelData.timeSpeed.x,  // time\r\n    modelData.timeSpeed.y,  // speed\r\n    modelData.params.x,     // intensity\r\n    modelData.params.y      // turbulence\r\n  );\r\n  output.p1 = vec4<f32>(\r\n    modelData.params.z,     // stretch\r\n    modelData.tint.w,       // tintStrength\r\n    0.0, 0.0\r\n  );\r\n  output.tintColor = modelData.tint.xyz;\r\n\r\n  return output;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Noise helpers\r\n// ---------------------------------------------------------------------------\r\nfn hash2(n : vec2<f32>) -> f32 {\r\n  return fract(sin(dot(n, vec2<f32>(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfn noise(p : vec2<f32>) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash2(i + vec2<f32>(0.0, 0.0)), hash2(i + vec2<f32>(1.0, 0.0)), u.x),\r\n    mix(hash2(i + vec2<f32>(0.0, 1.0)), hash2(i + vec2<f32>(1.0, 1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\n// Two-octave fBm for richer turbulence shape\r\nfn fbm(p : vec2<f32>) -> f32 {\r\n  var v   = 0.0;\r\n  var a   = 0.5;\r\n  var pos = p;\r\n  for (var i = 0; i < 2; i++) {\r\n    v   += a * noise(pos);\r\n    pos  = pos * 2.1 + vec2<f32>(1.7, 9.2);\r\n    a   *= 0.5;\r\n  }\r\n  return v;\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Fragment\r\n// ---------------------------------------------------------------------------\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  // Unpack\r\n  let time       = input.p0.x;\r\n  let speed      = input.p0.y;\r\n  let intensity  = input.p0.z;\r\n  let turbulence = input.p0.w;   // 0 = calm, 1 = chaotic\r\n  let stretch    = input.p1.x;   // 1 = normal, >1 = tall/thin, <1 = short/wide\r\n  let tintStr    = input.p1.y;   // 0 = natural fire colours, 1 = full tint\r\n  let tintColor  = input.tintColor;\r\n\r\n  let t = time * speed * 2.0;\r\n\r\n  // --- UV: apply stretch then turbulence warp ---\r\n  var uv = input.uv;\r\n  // Compress v-range so flame occupies more of the quad when stretch > 1\r\n  uv.y = uv.y / max(stretch, 0.01);\r\n\r\n  let warpAmt = turbulence * 0.18;\r\n  let warpX   = noise(uv * 3.0 + vec2<f32>(0.0, t * 0.6)) - 0.5;\r\n  let warpY   = noise(uv * 3.0 + vec2<f32>(5.2, t * 0.4)) - 0.5;\r\n  var warpedUV = uv + vec2<f32>(warpX, warpY) * warpAmt;\r\n\r\n  // Upward scroll + sideways sway scaled by turbulence\r\n  warpedUV.y += t * 0.4;\r\n  warpedUV.x += sin(t * 0.7) * 0.08 * turbulence;\r\n\r\n  // --- Flame density ---\r\n  var n = fbm(warpedUV * 6.0 + vec2<f32>(0.0, t * 0.8));\r\n  // Higher turbulence softens the exponent \u2192 wilder, fluffier edges\r\n  n = pow(n, 3.0 - turbulence * 1.2);\r\n\r\n  // --- Base flame palette (dark core \u2192 orange \u2192 hot yellow) ---\r\n  let hotColor  = vec3<f32>(1.0,  0.92, 0.35);\r\n  let midColor  = vec3<f32>(1.0,  0.38, 0.04);\r\n  let coolColor = vec3<f32>(0.55, 0.04, 0.0 );\r\n\r\n  let g1 = smoothstep(0.0, 0.5, n);\r\n  let g2 = smoothstep(0.5, 1.0, n);\r\n  var baseColor = mix(mix(coolColor, midColor, g1), hotColor, g2);\r\n\r\n  // --- Tint: blend base palette toward tintColor in the bright parts only ---\r\n  // tintStr = 0 \u2192 pure natural fire;  tintStr = 1 \u2192 fully tinted flame\r\n  let tintMask  = smoothstep(0.0, 0.5, n);\r\n  baseColor = mix(baseColor, baseColor * tintColor * 2.0, tintStr * tintMask);\r\n\r\n  let finalColor = baseColor * n * intensity;\r\n\r\n  // --- Alpha mask: soft edges + top fade that respects stretch ---\r\n  let edgeMask  = smoothstep(0.0, 0.15, input.uv.x)\r\n                * smoothstep(0.0, 0.15, 1.0 - input.uv.x);\r\n  let fadeStart = clamp(0.25 / max(stretch, 0.1), 0.1, 0.6);\r\n  let topFade   = 1.0 - smoothstep(fadeStart, 1.0, input.uv.y);\r\n\r\n  let alpha = smoothstep(0.08, 0.65, n) * edgeMask * topFade;\r\n\r\n  // Premultiplied alpha for additive blending\r\n  return vec4<f32>(finalColor * alpha, alpha);\r\n}\r\n`;", "import {mat4} from \"wgpu-matrix\";\r\nimport {flameEffect} from \"../../shaders/flame-effect/flameEffect\";\r\n\r\n// ---------------------------------------------------------------------------\r\n// Ready-made presets \u2014 pass to FlameEffect.fromPreset() or use as defaults\r\n// ---------------------------------------------------------------------------\r\nexport const FlamePresets = {\r\n  // Natural campfire / torch\r\n  natural: {\r\n    intensity:   12.0,\r\n    speed:        1.0,\r\n    turbulence:   0.5,\r\n    stretch:      1.0,\r\n    tint:        [1.0, 1.0, 1.0],  // neutral \u2192 pure fire palette\r\n    tintStrength: 0.0,\r\n  },\r\n  // Tall torch / pillar of fire\r\n  torch: {\r\n    intensity:   14.0,\r\n    speed:        1.2,\r\n    turbulence:   0.35,\r\n    stretch:      2.0,             // double height\r\n    tint:        [1.0, 1.0, 1.0],\r\n    tintStrength: 0.0,\r\n  },\r\n  // Wide, low bonfire\r\n  bonfire: {\r\n    intensity:   10.0,\r\n    speed:        0.8,\r\n    turbulence:   0.9,\r\n    stretch:      0.5,             // short & wide\r\n    tint:        [1.0, 1.0, 1.0],\r\n    tintStrength: 0.0,\r\n  },\r\n  // Magical blue flame\r\n  magic: {\r\n    intensity:    8.0,\r\n    speed:        1.4,\r\n    turbulence:   0.6,\r\n    stretch:      1.3,\r\n    tint:        [0.1, 0.4, 1.0],  // blue\r\n    tintStrength: 0.85,\r\n  },\r\n  // Hellfire \u2014 dark purple/red\r\n  hell: {\r\n    intensity:   16.0,\r\n    speed:        0.9,\r\n    turbulence:   0.8,\r\n    stretch:      1.6,\r\n    tint:        [0.6, 0.0, 0.8],  // purple\r\n    tintStrength: 0.7,\r\n  },\r\n  // Poison green\r\n  poison: {\r\n    intensity:    9.0,\r\n    speed:        1.1,\r\n    turbulence:   0.7,\r\n    stretch:      1.1,\r\n    tint:        [0.1, 1.0, 0.15], // green\r\n    tintStrength: 0.9,\r\n  },\r\n};\r\n\r\n// ---------------------------------------------------------------------------\r\n// FlameEffect\r\n// ---------------------------------------------------------------------------\r\nexport class FlameEffect {\r\n  /**\r\n   * @param {GPUDevice}  device\r\n   * @param {string}     format       - swap-chain / canvas format (e.g. \"bgra8unorm\")\r\n   * @param {string}     colorFormat  - render-pass color attachment format (e.g. \"rgba16float\")\r\n   * @param {object}     params       - initial flame parameters (see defaults below)\r\n   */\r\n  constructor(device, format, colorFormat, params = {}) {\r\n    this.device      = device;\r\n    this.format      = format;\r\n    this.colorFormat = colorFormat ?? format;\r\n\r\n    // --- All tuneable params with defaults ---\r\n    const defaults = FlamePresets.natural;\r\n    this.intensity   = params.intensity   ?? defaults.intensity;\r\n    this.speed       = params.speed       ?? defaults.speed;\r\n    this.turbulence  = params.turbulence  ?? defaults.turbulence;  // 0 = calm, 1 = chaotic\r\n    this.stretch     = params.stretch     ?? defaults.stretch;     // >1 = tall, <1 = wide\r\n    this.tint        = params.tint        ?? defaults.tint;        // [r, g, b]  0..1 each\r\n    this.tintStrength= params.tintStrength?? defaults.tintStrength;// 0 = natural, 1 = full tint\r\n\r\n    this.time    = 0;\r\n    this.enabled = true;\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  /** Convenience factory: new FlameEffect.fromPreset(device, fmt, hdrFmt, 'magic') */\r\n  static fromPreset(device, format, colorFormat, presetName) {\r\n    const preset = FlamePresets[presetName];\r\n    if (!preset) throw new Error(`Unknown FlamePreset: \"${presetName}\". Available: ${Object.keys(FlamePresets).join(\", \")}`);\r\n    return new FlameEffect(device, format, colorFormat, preset);\r\n  }\r\n\r\n  // -------------------------------------------------------------------------\r\n  // Public setters  (call any time \u2014 written to GPU on next updateInstanceData)\r\n  // -------------------------------------------------------------------------\r\n  setIntensity(v)    { this.intensity    = v; }\r\n  setSpeed(v)        { this.speed        = v; }\r\n  setTurbulence(v)   { this.turbulence   = Math.max(0, Math.min(1, v)); }\r\n  setStretch(v)      { this.stretch      = Math.max(0.05, v); }\r\n  /** @param {[number,number,number]} rgb  e.g. [0.1, 0.4, 1.0] for blue */\r\n  setTint(rgb)       { this.tint         = rgb; }\r\n  /** @param {number} v  0 = natural fire colours, 1 = fully tinted */\r\n  setTintStrength(v) { this.tintStrength = Math.max(0, Math.min(1, v)); }\r\n\r\n  /** Apply a named preset instantly */\r\n  applyPreset(name) {\r\n    const p = FlamePresets[name];\r\n    if (!p) throw new Error(`Unknown FlamePreset: \"${name}\"`);\r\n    Object.assign(this, {\r\n      intensity:    p.intensity,\r\n      speed:        p.speed,\r\n      turbulence:   p.turbulence,\r\n      stretch:      p.stretch,\r\n      tint:         p.tint,\r\n      tintStrength: p.tintStrength,\r\n    });\r\n  }\r\n\r\n  // -------------------------------------------------------------------------\r\n  _initPipeline() {\r\n    const S = 40;\r\n    const vertexData = new Float32Array([\r\n      -0.5 * S,  0.5 * S, 0,\r\n       0.5 * S,  0.5 * S, 0,\r\n      -0.5 * S, -0.5 * S, 0,\r\n       0.5 * S, -0.5 * S, 0,\r\n    ]);\r\n    const uvData    = new Float32Array([0, 1,  1, 1,  0, 0,  1, 0]);\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    this.vertexBuffer = this._uploadVertex(vertexData);\r\n    this.uvBuffer     = this._uploadVertex(uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // Camera uniform: mat4 = 64 bytes\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // ModelData uniform layout:\r\n    //   offset   0 : model        64 bytes  (mat4)\r\n    //   offset  64 : timeSpeed    16 bytes  (vec4)\r\n    //   offset  80 : params       16 bytes  (vec4)\r\n    //   offset  96 : tint         16 bytes  (vec4)\r\n    //   total = 112 bytes\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 112,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        { binding: 0, visibility: GPUShaderStage.VERTEX,                         buffer: { type: \"uniform\" } },\r\n        { binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: { type: \"uniform\" } },\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        { binding: 0, resource: { buffer: this.cameraBuffer } },\r\n        { binding: 1, resource: { buffer: this.modelBuffer  } },\r\n      ]\r\n    });\r\n\r\n    const shaderModule  = this.device.createShaderModule({ code: flameEffect });\r\n    const pipelineLayout = this.device.createPipelineLayout({ bindGroupLayouts: [bindGroupLayout] });\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          { arrayStride: 3 * 4, attributes: [{ shaderLocation: 0, offset: 0, format: \"float32x3\" }] },\r\n          { arrayStride: 2 * 4, attributes: [{ shaderLocation: 1, offset: 0, format: \"float32x2\" }] },\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{\r\n          format: this.colorFormat,\r\n          blend: {\r\n            color: { srcFactor: \"src-alpha\", dstFactor: \"one\",                 operation: \"add\" },\r\n            alpha: { srcFactor: \"one\",       dstFactor: \"one-minus-src-alpha\", operation: \"add\" },\r\n          }\r\n        }]\r\n      },\r\n      primitive:    { topology: \"triangle-list\" },\r\n      depthStencil: { depthWriteEnabled: false, depthCompare: \"always\", format: \"depth24plus\" },\r\n    });\r\n  }\r\n\r\n  _uploadVertex(data) {\r\n    const buf = this.device.createBuffer({\r\n      size: data.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(buf, 0, data);\r\n    return buf;\r\n  }\r\n\r\n  // -------------------------------------------------------------------------\r\n  updateInstanceData(baseModelMatrix) {\r\n    const local = mat4.identity();\r\n    mat4.translate(local, [0, 20, 0], local);\r\n\r\n    const finalMat = mat4.identity();\r\n    mat4.multiply(baseModelMatrix, local, finalMat);\r\n\r\n    // timeSpeed: [time, speed, 0, 0]\r\n    const timeSpeed = new Float32Array([this.time, this.speed, 0, 0]);\r\n\r\n    // params: [intensity, turbulence, stretch, 0]\r\n    const params = new Float32Array([this.intensity, this.turbulence, this.stretch, 0]);\r\n\r\n    // tint: [r, g, b, tintStrength]\r\n    const tint = new Float32Array([...this.tint, this.tintStrength]);\r\n\r\n    this.device.queue.writeBuffer(this.modelBuffer,  0, finalMat);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, timeSpeed);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 80, params);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 96, tint);\r\n  }\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, \"uint16\");\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, dt = 0.01) {\r\n    if (!this.enabled) return;\r\n    this.time += dt;\r\n    this.draw(pass, viewProjMatrix);\r\n  }\r\n}", "export const flameEffectInstance = `struct Camera {\r\n  viewProj : mat4x4<f32>\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\n// Array of particle instances\r\nstruct ModelData {\r\n  model : mat4x4<f32>,\r\n  time : vec4<f32>,       // x = time\r\n  intensity : vec4<f32>,  // x = intensity\r\n  color : vec4<f32>,      // rgba color\r\n};\r\n@group(0) @binding(1) var<storage, read> modelDataArray : array<ModelData>;\r\n\r\nstruct VSIn {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @builtin(instance_index) instanceIdx : u32,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) position : vec4<f32>,\r\n  @location(0) uv : vec2<f32>,\r\n  @location(1) time : f32,\r\n  @location(2) intensity : f32,\r\n  @location(3) @interpolate(flat) instanceIdx : u32,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VSIn) -> VSOut {\r\n  var output : VSOut;\r\n  let modelData = modelDataArray[input.instanceIdx];\r\n  let worldPos = modelData.model * vec4<f32>(input.position, 1.0);\r\n  output.position = camera.viewProj * worldPos;\r\n  output.uv = input.uv;\r\n  output.time = modelData.time.x;\r\n  output.intensity = modelData.intensity.x;\r\n  output.instanceIdx = input.instanceIdx;\r\n  return output;\r\n}\r\n\r\n// Simple procedural flame noise (value in 0..1)\r\nfn hash(n : vec2<f32>) -> f32 {\r\n  return fract(sin(dot(n, vec2<f32>(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfn noise(p : vec2<f32>) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash(i + vec2<f32>(0.0,0.0)), hash(i + vec2<f32>(1.0,0.0)), u.x),\r\n    mix(hash(i + vec2<f32>(0.0,1.0)), hash(i + vec2<f32>(1.0,1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\n// Flame color gradient: black -> red -> orange -> yellow -> white\r\nfn flameColor(n: f32) -> vec3<f32> {\r\n  if (n < 0.3) {\r\n    return vec3<f32>(n * 3.0, 0.0, 0.0);               // dark red\r\n  } else if (n < 0.6) {\r\n    return vec3<f32>(1.0, (n - 0.3) * 3.33, 0.0);      // red -> orange\r\n  } else {\r\n    return vec3<f32>(1.0, 1.0, (n - 0.6) * 2.5);       // orange -> yellow -> white\r\n  }\r\n}\r\n\r\n@fragment\r\nfn fsMain(in : VSOut) -> @location(0) vec4<f32> {\r\n  // Read per-instance data\r\n  let modelData = modelDataArray[in.instanceIdx];\r\n  let baseColor = modelData.color.xyz;\r\n  let instanceAlpha = modelData.color.w;\r\n  let instIntensity = max(0.0, modelData.intensity.x);\r\n\r\n  // time with small instance offset\r\n  let t = in.time * 2.0 + f32(in.instanceIdx) * 0.13;\r\n\r\n  var uv = in.uv;\r\n  uv.y += t * 0.2;\r\n\r\n  // procedural noise\r\n  var n = noise(uv * 5.0 + vec2<f32>(0.0, t * 0.5));\r\n  // keep some brightness: milder sharpening than pow(n,3)\r\n  n = pow(n, 1.5);\r\n\r\n  // base flame color from gradient\r\n  let grad = flameColor(n);\r\n\r\n  let userColor = modelData.color.xyz;\r\n\r\n  // mix ratio (0.0 = pure red, 1.0 = user color)\r\n  let mixFactor = 0.5;\r\n  let mixedColor = mix(grad, userColor, mixFactor);\r\n\r\n  // flicker multipliers (shifted into positive range)\r\n  let flickR = 0.7 + 0.3 * sin(t * 3.0); // 0.4 .. 1.0\r\n  let flickG = 0.6 + 0.4 * cos(t * 2.0); // 0.2 .. 1.0\r\n  let flickB = 0.8 + 0.2 * sin(t * 1.5); // 0.6 .. 1.0\r\n\r\n  // combine gradient with per-instance baseColor and flicker\r\n  // var color = grad * baseColor * vec3<f32>(flickR, flickG, flickB);\r\n  var color = mixedColor * vec3<f32>(flickR, flickG, flickB);\r\n\r\n  // apply instance/global intensity\r\n  color = color * instIntensity;\r\n\r\n  // soft alpha based on noise and instance alpha\r\n  var alpha = smoothstep(0.0, 0.6, n) * instanceAlpha * instIntensity;\r\n\r\n  // final clamp to avoid negative or NaN values\r\n  color = clamp(color, vec3<f32>(0.0), vec3<f32>(10.0)); // allow HDR-like values for additive blending\r\n  alpha = clamp(alpha, 0.0, 1.0);\r\n\r\n  return vec4<f32>(color, alpha);\r\n}\r\n`;\r\n", "import {mat4} from \"wgpu-matrix\";\r\nimport {flameEffectInstance} from \"../../shaders/flame-effect/flame-instanced\";\r\nimport {randomFloatFromTo, randomIntFromTo} from \"../utils\";\r\n\r\nexport class FlameEmitter {\r\n  constructor(device, format, maxParticles = 20) {\r\n    this.device = device;\r\n    this.format = format;\r\n    this.time = 0;\r\n    this.intensity = 3.0;\r\n    this.enabled = true;\r\n    this.maxParticles = maxParticles;\r\n    this.instanceTargets = [];\r\n    this.floatsPerInstance = 28;\r\n    this.instanceData = new Float32Array(maxParticles * this.floatsPerInstance);\r\n    this.smoothFlickeringScale = 0.1;\r\n    this.maxY = 1.9;\r\n    this.minY = 0;\r\n    this.swap0 = 0;\r\n    this.swap1 = 1;\r\n    this.swap2 = 2;\r\n    for(let i = 0;i < maxParticles;i++) {\r\n      this.instanceTargets.push({\r\n        position: [0, 0, 0],\r\n        currentPosition: [0, 0, 0],\r\n        scale: [1, 1, 1],\r\n        currentScale: [1, 1, 1],\r\n        rotation: 0.1,\r\n        color: [1, 0.3, 0, 0.1],\r\n        time: 1,\r\n        intensity: 1,\r\n        riseSpeed: 1\r\n      });\r\n    }\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  recreateVertexData(S) {\r\n    const vertexData = new Float32Array([\r\n      -0.4 * S, 0.5 * S, 0.0 * S,\r\n      0.4 * S, 0.5 * S, 0.0 * S,\r\n      -0.2 * S, -0.5 * S, 0.0 * S,\r\n      0.2 * S, -0.5 * S, 0.0 * S,\r\n    ]);\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n  }\r\n\r\n  recreateVertexDataRND(S) {\r\n    const vertexData = new Float32Array([\r\n      -randomFloatFromTo(0.1, 0.8) * S, randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n      randomFloatFromTo(0.1, 0.8) * S, randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n      -randomFloatFromTo(0.1, 0.4) * S, -randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n      randomFloatFromTo(0.1, 0.4) * S, -randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n    ]);\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n  }\r\n\r\n  _initPipeline() {\r\n    const S = 5;\r\n    const vertexData = new Float32Array([\r\n      -0.2 * S, -0.5 * S, 0.0 * S,\r\n      0.2 * S, -0.5 * S, 0.0 * S,\r\n      -0.4 * S, 0.5 * S, 0.0 * S,\r\n      0.4 * S, 0.5 * S, 0.0 * S,\r\n    ]);\r\n    const uvData = new Float32Array([0, 1, 1, 1, 0, 0, 1, 0]);\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // --- Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({size: 64, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST});\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: this.maxParticles * this.floatsPerInstance * 4,\r\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: flameEffectInstance});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: \"float32x3\"}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: \"float32x2\"}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: \"triangle-list\"},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: \"less\", format: \"depth24plus\"},\r\n      blend: {\r\n        // color: {srcFactor: \"src-alpha\", dstFactor: \"one\", operation: \"add\"},\r\n        // alpha: {srcFactor: \"one\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"}\r\n        color: {\r\n          srcFactor: 'src-alpha',\r\n          dstFactor: 'one-minus-src-alpha',\r\n          operation: 'add',\r\n        },\r\n        alpha: {\r\n          srcFactor: 'one',\r\n          dstFactor: 'one-minus-src-alpha',\r\n          operation: 'add',\r\n        },\r\n      }\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    const count = Math.min(this.instanceTargets.length, this.maxParticles);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // Smooth interpolation\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * 0.12;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * 0.12;\r\n      }\r\n      // Build local matrix: translate \u2192 rotate \u2192 scale\r\n      const local = mat4.identity();\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.rotateY(local, t.rotation, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n\r\n      this.instanceData.set(finalMat, offset);               // 0..15\r\n      this.instanceData.set([t.time, 0, 0, 0], offset + 16); // 16..19\r\n      this.instanceData.set([t.intensity, 0, 0, 0], offset + 20); // 20..23\r\n      this.instanceData.set([t.color[0], t.color[1], t.color[2], t.color[3] ?? 1.0], offset + 24); // 24..27\r\n    }\r\n\r\n    this.device.queue.writeBuffer(\r\n      this.modelBuffer,\r\n      0,\r\n      this.instanceData.subarray(0, count * this.floatsPerInstance)\r\n    );\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, dt = 0.1) {\r\n    // update global time\r\n    this.time += dt;\r\n    for(const p of this.instanceTargets) {\r\n      p.position[this.swap1] += dt * p.riseSpeed;\r\n      // Reset if too high\r\n      if(p.position[this.swap1] > this.maxY) {\r\n        p.position[this.swap1] = this.minY + Math.random() * 0.5;\r\n        p.position[this.swap0] = (Math.random() - 0.5) * 0.2;\r\n        p.position[this.swap2] = (Math.random() - 0.5) * 0.2 + 0.1;\r\n        p.riseSpeed = 0.2 + Math.random() * 1.0;\r\n      }\r\n      p.scale[0] = p.scale[1] = this.smoothFlickeringScale + Math.sin(this.time * 2.0 + p.position[this.swap1]) * 0.1;\r\n      p.rotation += dt * randomIntFromTo(3, 15);\r\n    }\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, viewProjMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, \"uint16\");\r\n    pass.drawIndexed(this.indexCount, this.instanceTargets.length);\r\n  }\r\n\r\n  setIntensity(v) {this.intensity = v;}\r\n}", "import {mat4, vec3} from 'wgpu-matrix';\r\nimport {Position, Rotation} from \"./matrix-class\";\r\nimport {vertexWGSL} from '../shaders/vertex.wgsl';\r\nimport {degToRad, genName, LOG_FUNNY_ARCADE, LOG_FUNNY_SMALL} from './utils';\r\nimport Materials from './materials';\r\nimport {fragmentVideoWGSL} from '../shaders/fragment.video.wgsl';\r\nimport {vertexWGSL_NM} from '../shaders/vertex.wgsl.normalmap';\r\n// import {PointerEffect} from './effects/pointerEffect';\r\nimport {PointEffect} from './effects/topology-point';\r\nimport {GizmoEffect} from './effects/gizmo';\r\nimport {DestructionEffect} from './effects/destruction';\r\nimport {FlameEffect} from './effects/flame';\r\nimport {FlameEmitter} from './effects/flame-emmiter';\r\n\r\nexport default class MEMeshObj extends Materials {\r\n  constructor(canvas, device, context, o, inputHandler, globalAmbient, _glbFile = null, primitiveIndex = null, skinnedNodeIndex = null) {\r\n    super(device, o.material, _glbFile, o.textureCache);\r\n    if(typeof o.name === 'undefined') o.name = genName(3);\r\n    if(typeof o.raycast === 'undefined') {\r\n      this.raycast = {enabled: false, radius: 2};\r\n    } else {\r\n      this.raycast = o.raycast;\r\n    }\r\n\r\n    if(typeof o.pointerEffect === 'undefined') {this.pointerEffect = {enabled: false};}\r\n    this.pointerEffect = o.pointerEffect;\r\n\r\n    this.name = o.name;\r\n    this.done = false;\r\n    this.canvas = canvas;\r\n    this.device = device;\r\n    this.context = context;\r\n    this.entityArgPass = o.entityArgPass;\r\n    this.clearColor = \"red\";\r\n    this.video = null;\r\n    this.FINISH_VIDIO_INIT = false;\r\n    this.globalAmbient = [...globalAmbient];\r\n    if(typeof o.material.useTextureFromGlb === 'undefined' ||\r\n      typeof o.material.useTextureFromGlb !== \"boolean\") {\r\n      o.material.useTextureFromGlb = false;\r\n    }\r\n\r\n    if(typeof o.material.useBlend === 'undefined' ||\r\n      typeof o.material.useBlend !== \"boolean\") {\r\n      o.material.useBlend = false;\r\n    }\r\n\r\n    this.useScale = o.useScale || false;\r\n    this.material = o.material;\r\n\r\n    this.time = 0;\r\n    this.deltaTimeAdapter = 10;\r\n\r\n    addEventListener('update-pipeine', () => {this.setupPipeline()})\r\n    // Mesh stuff - for single mesh or t-posed (fiktive-first in loading order)        \r\n    this.mesh = o.mesh;\r\n    if(_glbFile != null) {\r\n      if(typeof this.mesh == 'undefined') {\r\n        this.mesh = {};\r\n        this.mesh.feedFromRealGlb = true;\r\n      }\r\n      // V\r\n      const verView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].positions.view;\r\n      const byteOffsetV = verView.byteOffset || 0;\r\n      const byteLengthV = verView.buffer.byteLength;\r\n      const vertices = new Float32Array(\r\n        verView.buffer.buffer,\r\n        byteOffsetV,\r\n        byteLengthV / 4\r\n      );\r\n      this.mesh.vertices = vertices;\r\n      //N\r\n      const norView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].normals.view;\r\n      const normalsUint8 = norView.buffer;\r\n      const byteOffsetN = norView.byteOffset || 0; // if your loader provides it\r\n      const byteLengthN = normalsUint8.byteLength;\r\n      const normals = new Float32Array(\r\n        normalsUint8.buffer,\r\n        byteOffsetN,\r\n        byteLengthN / 4\r\n      );\r\n      this.mesh.vertexNormals = normals;\r\n      //UV\r\n      let accessor = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].texcoords[0];\r\n      const bufferView = accessor.view;\r\n      const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n      const count = accessor.count * 2; // VEC2 = 2 floats per vertex\r\n      const uvFloatArray = new Float32Array(bufferView.buffer.buffer, byteOffset, count);\r\n      this.mesh.uvs = uvFloatArray;\r\n      this.mesh.textures = uvFloatArray;\r\n      // I\r\n      let binaryI = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].indices;\r\n      const indicesView = binaryI.view;\r\n      const indicesUint8 = indicesView.buffer;\r\n      const byteOffsetI = indicesView.byteOffset || 0;\r\n      const byteLengthI = indicesUint8.byteLength;\r\n      // Decide on type from accessor.componentType\r\n      // (5121 = UNSIGNED_BYTE, 5123 = UNSIGNED_SHORT, 5125 = UNSIGNED_INT)\r\n      let indicesArray;\r\n      switch(binaryI.componentType) {\r\n        case 5121: // UNSIGNED_BYTE\r\n          indicesArray = new Uint8Array(indicesUint8.buffer, byteOffsetI, byteLengthI);\r\n          break;\r\n        case 5123: // UNSIGNED_SHORT\r\n          indicesArray = new Uint16Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 2);\r\n          break;\r\n        case 5125: // UNSIGNED_INT\r\n          indicesArray = new Uint32Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 4);\r\n          break;\r\n        default:\r\n          throw new Error(\"Unknown index componentType\");\r\n      }\r\n      this.mesh.indices = indicesArray;\r\n      // W\r\n      let weightsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].weights.view;\r\n      this.mesh.weightsView = weightsView;\r\n      let primitive = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex];\r\n      let finalRoundedWeights = this.getAccessorArray(_glbFile, primitive.weights.weightsAccessIndex);\r\n      const weightsArray = finalRoundedWeights;\r\n      // Normalize each group of 4\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const sum = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(sum > 0) {\r\n          const inv = 1 / sum;\r\n          weightsArray[i] *= inv;\r\n          weightsArray[i + 1] *= inv;\r\n          weightsArray[i + 2] *= inv;\r\n          weightsArray[i + 3] *= inv;\r\n        } else {\r\n          weightsArray[i] = 1; weightsArray[i + 1] = 0;\r\n          weightsArray[i + 2] = 0; weightsArray[i + 3] = 0;\r\n        }\r\n      }\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const s = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(Math.abs(s - 1.0) > 0.001) console.warn(\"Weight not normalized!\", i, s);\r\n      }\r\n      this.mesh.weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer real data\",\r\n        size: weightsArray.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(this.mesh.weightsBuffer.getMappedRange()).set(weightsArray);\r\n      this.mesh.weightsBuffer.unmap();\r\n      let jointsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].joints.view;\r\n      this.mesh.jointsView = jointsView;\r\n      // Create typed array from the buffer (Uint16Array or Uint8Array depending on GLB)\r\n      let jointsArray16 = new Uint16Array(\r\n        jointsView.buffer,\r\n        jointsView.byteOffset || 0,\r\n        jointsView.byteLength / 2 // in Uint16 elements\r\n      );\r\n      const jointsArray32 = new Uint32Array(jointsArray16.length);\r\n      for(let i = 0;i < jointsArray16.length;i++) {\r\n        jointsArray32[i] = jointsArray16[i];\r\n      }\r\n      // Create GPU buffer for joints\r\n      this.mesh.jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer[real-data]\",\r\n        size: jointsArray32.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      // Upload the data to GPU\r\n      new Uint32Array(this.mesh.jointsBuffer.getMappedRange()).set(jointsArray32);\r\n      this.mesh.jointsBuffer.unmap();\r\n\r\n      // TANGENTS\r\n      let tangentArray = null;\r\n      if(_glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents) {\r\n        const tangentView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents.view;\r\n        const byteOffsetT = tangentView.byteOffset || 0;\r\n        const byteLengthT = tangentView.buffer.byteLength;\r\n        tangentArray = new Float32Array(\r\n          tangentView.buffer,\r\n          byteOffsetT,\r\n          byteLengthT / 4\r\n        );\r\n        this.mesh.tangents = tangentArray;\r\n\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer[real-data]\",\r\n          size: tangentArray.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(tangentArray);\r\n        this.mesh.tangentsBuffer.unmap();\r\n      } else {\r\n        // \uD83D\uDFE2 dummy fallback\r\n        const dummyTangents = new Float32Array(this.mesh.vertices.length / 3 * 4);\r\n        for(let i = 0;i < dummyTangents.length;i += 4) {\r\n          dummyTangents[i + 0] = 1.0; // T = (1,0,0)\r\n          dummyTangents[i + 1] = 0.0;\r\n          dummyTangents[i + 2] = 0.0;\r\n          dummyTangents[i + 3] = 1.0; // handedness\r\n        }\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer dummy\",\r\n          size: dummyTangents.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(dummyTangents);\r\n        this.mesh.tangentsBuffer.unmap();\r\n        console.warn(\"GLTF primitive has no TANGENT attribute (normal map won\u2019t work properly).\");\r\n      }\r\n\r\n      // if(this.material.useTextureFromGlb == true) {\r\n      //   console.log('get glb images ', _glbFile.glbJsonData.materials);\r\n      //   _glbFile.glbJsonData.materials.forEach(material => {\r\n      //     console.log('get material :', material);\r\n      //   });\r\n\r\n      //   _glbFile.glbJsonData.images.forEach(imgGpuTexture => {\r\n      //     console.log('get images :', imgGpuTexture);\r\n      //   });\r\n\r\n\r\n      //   _glbFile.glbJsonData.glbTextures.forEach(glbTexture => {\r\n      //     console.log('get glbTextures :', glbTexture);\r\n      //   });\r\n      // }\r\n    } else {\r\n      // obj files flow\r\n      this.mesh.uvs = this.mesh.textures;\r\n    }\r\n    console.log(`%cMesh loaded: ${o.name}`, LOG_FUNNY_ARCADE);\r\n    // ObjSequence animation\r\n    if(typeof o.objAnim !== 'undefined' && o.objAnim != null) {\r\n      this.objAnim = o.objAnim;\r\n      for(var key in this.objAnim.animations) {\r\n        if(key != 'active') this.objAnim.animations[key].speedCounter = 0;\r\n      }\r\n      console.log(`%c Mesh objAnim exist: ${o.objAnim}`, LOG_FUNNY_SMALL);\r\n      this.drawElements = this.drawElementsAnim;\r\n    }\r\n    this.inputHandler = inputHandler;\r\n    this.cameras = o.cameras;\r\n    this.mainCameraParams = {\r\n      type: o.mainCameraParams.type,\r\n      responseCoef: o.mainCameraParams.responseCoef\r\n    };\r\n    this.lastFrameMS = 0;\r\n    this.texturesPaths = [];\r\n    o.texturesPaths.forEach((t) => {this.texturesPaths.push(t)})\r\n    this.presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n    this.position = new Position(o.position.x, o.position.y, o.position.z);\r\n    this.rotation = new Rotation(o.rotation.x, o.rotation.y, o.rotation.z);\r\n    this.rotation.rotationSpeed.x = o.rotationSpeed.x;\r\n    this.rotation.rotationSpeed.y = o.rotationSpeed.y;\r\n    this.rotation.rotationSpeed.z = o.rotationSpeed.z;\r\n    this.scale = o.scale;\r\n    // new dummy for skin mesh\r\n    if(!this.joints) {\r\n      const jointsData = new Uint32Array((this.mesh.vertices.length / 3) * 4);\r\n      const jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer\",\r\n        size: jointsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint32Array(jointsBuffer.getMappedRange()).set(jointsData);\r\n      jointsBuffer.unmap();\r\n      this.joints = {\r\n        data: jointsData,\r\n        buffer: jointsBuffer,\r\n        stride: 16, // vec4<u32>\r\n      };\r\n      const numVerts = this.mesh.vertices.length / 3;\r\n      // Weights data (vec4<f32>) \u2013 default all weight to bone 0\r\n      const weightsData = new Float32Array(numVerts * 4);\r\n      for(let i = 0;i < numVerts;i++) {\r\n        weightsData[i * 4 + 0] = 1.0; // 100% influence of bone 0\r\n        weightsData[i * 4 + 1] = 0.0;\r\n        weightsData[i * 4 + 2] = 0.0;\r\n        weightsData[i * 4 + 3] = 0.0;\r\n      }\r\n      // GPU buffer\r\n      const weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer dummy\",\r\n        size: weightsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(weightsBuffer.getMappedRange()).set(weightsData);\r\n      weightsBuffer.unmap();\r\n      this.weights = {\r\n        data: weightsData,\r\n        buffer: weightsBuffer,\r\n        stride: 16, // vec4<f32>\r\n      };\r\n    }\r\n\r\n    this.runProgram = () => {\r\n      return new Promise(async (resolve) => {\r\n        this.shadowDepthTextureSize = 1024;\r\n        this.modelViewProjectionMatrix = mat4.create();\r\n        this.loadTex0(this.texturesPaths).then(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    }\r\n\r\n    this.runProgram().then(() => {\r\n      this.context.configure({\r\n        device: this.device,\r\n        format: this.presentationFormat,\r\n        alphaMode: 'premultiplied',\r\n      });\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexBuffer.getMappedRange()).set(this.mesh.vertices);\r\n        this.vertexBuffer.unmap();\r\n      }\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexNormalsBuffer.getMappedRange()).set(this.mesh.vertexNormals);\r\n        this.vertexNormalsBuffer.unmap();\r\n      }\r\n\r\n      this.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: this.mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexTexCoordsBuffer.getMappedRange()).set(this.mesh.textures);\r\n        this.vertexTexCoordsBuffer.unmap();\r\n      }\r\n\r\n      // Create the model index buffer.\r\n      this.indexCount = this.mesh.indices.length;\r\n      const indexCount = this.mesh.indices.length;\r\n      const size = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n\r\n      this.indexBuffer = this.device.createBuffer({\r\n        size,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true\r\n      });\r\n\r\n      new Uint16Array(this.indexBuffer.getMappedRange()).set(this.mesh.indices);\r\n      this.indexBuffer.unmap();\r\n      this.indexCount = indexCount;\r\n      let glbInfo = {\r\n        arrayStride: 4 * 4, // vec4<f32> = 4 * 4 bytes\r\n        attributes: [{format: 'float32x4', offset: 0, shaderLocation: 4}]\r\n      }\r\n\r\n      this.vertexBuffers = [\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [{shaderLocation: 0, offset: 0, format: \"float32x3\", }],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [{shaderLocation: 1, offset: 0, format: \"float32x3\", },],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 2,\r\n          attributes: [{shaderLocation: 2, offset: 0, format: \"float32x2\", },],\r\n        },\r\n        // joint indices\r\n        {\r\n          arrayStride: 4 * 4, // vec4<u32> = 4 * 4 bytes\r\n          attributes: [{format: 'uint32x4', offset: 0, shaderLocation: 3}]\r\n        },\r\n        // weights\r\n        glbInfo,\r\n      ];\r\n\r\n      if(this.mesh.tangentsBuffer) {\r\n        this.vertexBuffers.push({\r\n          arrayStride: 4 * 4, // vec4<f32> = 16 bytes\r\n          attributes: [\r\n            {shaderLocation: 5, format: \"float32x4\", offset: 0}\r\n          ]\r\n        });\r\n      }\r\n      // Note: The frontFace and cullMode values have no effect on the \r\n      // 'triangle-list'   // standard meshes\r\n      // 'triangle-strip' // terrain, strips\r\n      // 'line-list'      // wireframe (manual index gen)\r\n      // 'line-strip'     // outlines\r\n      // 'point-list'     // particles\r\n      this.topology = 'triangle-list';\r\n      this.setTopology = (t) => {\r\n        const isStrip =\r\n          t === 'triangle-strip' ||\r\n          t === 'line-strip';\r\n        if(isStrip) {\r\n          this.primitive = {\r\n            topology: t,\r\n            stripIndexFormat: 'uint16',\r\n            cullMode: 'none',\r\n            frontFace: 'ccw'\r\n          };\r\n        } else {\r\n          this.primitive = {\r\n            topology: t,\r\n            cullMode: 'none',\r\n            frontFace: 'ccw'\r\n          };\r\n        }\r\n        this.setupPipeline();\r\n      };\r\n\r\n      // 'back' typical for shadow passes\r\n      this.primitive = {\r\n        topology: this.topology,\r\n        cullMode: 'none',\r\n        frontFace: 'ccw'\r\n      }\r\n\r\n      // Selected effect\r\n      this.selectedBuffer = device.createBuffer({size: 4, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST});\r\n      this.selectedBindGroupLayout = device.createBindGroupLayout({\r\n        label: 'selectedBindGroupLayout mesh',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {}},\r\n        ],\r\n      });\r\n\r\n      this.selectedBindGroup = device.createBindGroup({\r\n        label: 'selectedBindGroup mesh',\r\n        layout: this.selectedBindGroupLayout,\r\n        entries: [{binding: 0, resource: {buffer: this.selectedBuffer}}],\r\n      });\r\n\r\n      this.setSelectedEffect = (selected = false) => {\r\n        this.device.queue.writeBuffer(this.selectedBuffer, 0, new Float32Array([selected ? 1.0 : 0.0]));\r\n      };\r\n      // 0 default\r\n      this.setSelectedEffect();\r\n\r\n      // Create a bind group layout which holds the scene uniforms and\r\n      // the texture+sampler for depth. We create it manually because the WebPU\r\n      // implementation doesn't infer this from the shader (yet).\r\n      this.createLayoutForRender();\r\n\r\n      this.modelUniformBuffer = this.device.createBuffer({\r\n        size: 4 * 16, // 4x4 matrix\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.sceneUniformBuffer = this.device.createBuffer({\r\n        label: 'sceneUniformBuffer per mesh',\r\n        size: 192,//192, // \u2B05\uFE0F was 176\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.uniformBufferBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'uniformBufferBindGroupLayout in mesh regular',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}},\r\n          {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}},\r\n          {binding: 2, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}}\r\n        ],\r\n      });\r\n\r\n      function alignTo256(n) {return Math.ceil(n / 256) * 256;}\r\n\r\n      let MAX_BONES = 100;\r\n      this.MAX_BONES = MAX_BONES;\r\n      this.bonesBuffer = device.createBuffer({\r\n        label: \"bonesBuffer\",\r\n        size: alignTo256(64 * MAX_BONES),\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      const bones = new Float32Array(this.MAX_BONES * 16);\r\n      for(let i = 0;i < this.MAX_BONES;i++) {\r\n        bones.set([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], i * 16);\r\n      }\r\n      this.device.queue.writeBuffer(this.bonesBuffer, 0, bones);\r\n      const VERTEX_ANIM_FLAGS = {\r\n        NONE: 0,\r\n        WAVE: 1 << 0,      // 1\r\n        WIND: 1 << 1,      // 2\r\n        PULSE: 1 << 2,     // 4\r\n        TWIST: 1 << 3,     // 8\r\n        NOISE: 1 << 4,     // 16\r\n        OCEAN: 1 << 5,     // 32\r\n        DISPLACEMENT: 1 << 6 // 64\r\n      };\r\n\r\n      // vertex Anim\r\n      this.vertexAnimParams = new Float32Array([\r\n        0.0, 0.0, 0.0, 0.0, 2.0, 0.1, 2.0, 0.0, 1.5, 0.3, 2.0, 0.5, 1.0, 0.1, 0.0, 0.0, 1.0, 0.5, 0.0, 0.0, 1.0, 0.05, 0.5, 0.0, 1.0, 0.05, 2.0, 0.0, 1.0, 0.1, 0.0, 0.0,\r\n      ]);\r\n\r\n      this.vertexAnimBuffer = this.device.createBuffer({\r\n        label: \"Vertex Animation Params\",\r\n        size: this.vertexAnimParams.byteLength, // 128 bytes\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.vertexAnim = {\r\n        enableWave: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.WAVE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableWave: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.WAVE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableWind: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.WIND;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableWind: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.WIND;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enablePulse: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.PULSE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disablePulse: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.PULSE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableTwist: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.TWIST;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableTwist: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.TWIST;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableNoise: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.NOISE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableNoise: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.NOISE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableOcean: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.OCEAN;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableOcean: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.OCEAN;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enable: (...effects) => {\r\n          effects.forEach(effect => {\r\n            this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS[effect.toUpperCase()];\r\n          });\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disable: (...effects) => {\r\n          effects.forEach(effect => {\r\n            this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS[effect.toUpperCase()];\r\n          });\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableAll: () => {\r\n          this.vertexAnimParams[1] = 0;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        isEnabled: (effect) => {return (this.vertexAnimParams[1] & VERTEX_ANIM_FLAGS[effect.toUpperCase()]) !== 0;},\r\n        setWaveParams: (speed, amplitude, frequency) => {\r\n          this.vertexAnimParams[4] = speed;\r\n          this.vertexAnimParams[5] = amplitude;\r\n          this.vertexAnimParams[6] = frequency;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setWindParams: (speed, strength, heightInfluence, turbulence) => {\r\n          this.vertexAnimParams[8] = speed;\r\n          this.vertexAnimParams[9] = strength;\r\n          this.vertexAnimParams[10] = heightInfluence;\r\n          this.vertexAnimParams[11] = turbulence;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setPulseParams: (speed, amount, centerX = 0, centerY = 0) => {\r\n          this.vertexAnimParams[12] = speed;\r\n          this.vertexAnimParams[13] = amount;\r\n          this.vertexAnimParams[14] = centerX;\r\n          this.vertexAnimParams[15] = centerY;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setTwistParams: (speed, amount) => {\r\n          this.vertexAnimParams[16] = speed;\r\n          this.vertexAnimParams[17] = amount;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setNoiseParams: (scale, strength, speed) => {\r\n          this.vertexAnimParams[20] = scale;\r\n          this.vertexAnimParams[21] = strength;\r\n          this.vertexAnimParams[22] = speed;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setOceanParams: (scale, height, speed) => {\r\n          this.vertexAnimParams[24] = scale;\r\n          this.vertexAnimParams[25] = height;\r\n          this.vertexAnimParams[26] = speed;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setIntensity: (value) => {\r\n          this.vertexAnimParams[2] = Math.max(0, Math.min(1, value));\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        getIntensity: () => {return this.vertexAnimParams[2]}\r\n      };\r\n\r\n      this.updateVertexAnimBuffer = () => {\r\n        this.device.queue.writeBuffer(this.vertexAnimBuffer, 0, this.vertexAnimParams);\r\n      };\r\n\r\n      // globalIntensity\r\n      this.vertexAnimParams[2] = 1.0;\r\n      this.updateVertexAnimBuffer();\r\n\r\n      this.updateTime = (time) => {\r\n        this.time += time * this.deltaTimeAdapter;\r\n        this.vertexAnimParams[0] = this.time;\r\n        this.device.queue.writeBuffer(this.vertexAnimBuffer, 0, this.vertexAnimParams);\r\n        const effectMix = 0.5 + 0.5 * Math.sin(this.time * 0.5);\r\n        this.setupMaterialPBR(false, false, false, effectMix, 1.0);\r\n      }\r\n\r\n      this.modelBindGroup = this.device.createBindGroup({\r\n        label: 'modelBindGroup in mesh',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.modelUniformBuffer}},\r\n          {binding: 1, resource: {buffer: this.bonesBuffer}},\r\n          {binding: 2, resource: {buffer: this.vertexAnimBuffer}}\r\n        ],\r\n      });\r\n\r\n      this.mainPassBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: '[mainPass]BindGroupLayout mesh',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'depth'}},\r\n          {binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'comparison'}},\r\n        ],\r\n      });\r\n\r\n      this.effects = {};\r\n      if(this.pointerEffect && this.pointerEffect.enabled === true) {\r\n        let pf = navigator.gpu.getPreferredCanvasFormat();\r\n        if(typeof this.pointerEffect.pointEffect !== 'undefined' && this.pointerEffect.pointEffect == true) {\r\n          this.effects.pointEffect = new PointEffect(device, 'rgba16float');\r\n        }\r\n        if(typeof this.pointerEffect.gizmoEffect !== 'undefined' && this.pointerEffect.gizmoEffect == true) {\r\n          this.effects.gizmoEffect = new GizmoEffect(device, 'rgba16float');\r\n        }\r\n        if(typeof this.pointerEffect.flameEffect !== 'undefined' && this.pointerEffect.flameEffect == true) {\r\n           this.effects.flameEffect = FlameEffect.fromPreset(device, pf, \"rgba16float\", \"torch\");\r\n        }\r\n        if(typeof this.pointerEffect.flameEmitter !== 'undefined' && this.pointerEffect.flameEmitter == true) {\r\n           this.effects.flameEmitter = new FlameEmitter(device, \"rgba16float\");\r\n        }\r\n\r\n        if(typeof this.pointerEffect.destructionEffect !== 'undefined' && this.pointerEffect.destructionEffect == true) {\r\n          this.effects.destructionEffect = new DestructionEffect(device, 'rgba16float', {\r\n            particleCount: 100,\r\n            duration: 2.5,\r\n            color: [0.6, 0.5, 0.4, 1.0]\r\n          });\r\n        }\r\n      }\r\n\r\n      this.getTransformationMatrix = (mainRenderBundle, spotLight, index) => {\r\n        const now = Date.now();\r\n        const dt = (now - this.lastFrameMS) / this.mainCameraParams.responseCoef;\r\n        this.lastFrameMS = now;\r\n        const camera = this.cameras[this.mainCameraParams.type];\r\n        if(index == 0) camera.update(dt, inputHandler());\r\n        const camVP = mat4.multiply(camera.projectionMatrix, camera.view);\r\n        const sceneData = new Float32Array(48);\r\n        sceneData.set(spotLight.viewProjMatrix, 0);\r\n        sceneData.set(camVP, 16);\r\n        sceneData.set([camera.position.x, camera.position.y, camera.position.z, 0.0], 32);\r\n        sceneData.set([spotLight.position[0], spotLight.position[1], spotLight.position[2], 0.0], 36);\r\n        sceneData.set([this.globalAmbient[0], this.globalAmbient[1], this.globalAmbient[2], 0.0], 40);\r\n        sceneData.set([this.time, dt, 0, 0], 44);\r\n        device.queue.writeBuffer(this.sceneUniformBuffer, 0, sceneData.buffer, sceneData.byteOffset, sceneData.byteLength)\r\n      };\r\n\r\n      this.getModelMatrix = (pos, useScale = false) => {\r\n        let modelMatrix = mat4.identity();\r\n        mat4.translate(modelMatrix, [pos.x, pos.y, pos.z], modelMatrix);\r\n        if(this.itIsPhysicsBody) {\r\n          mat4.rotate(modelMatrix,\r\n            [this.rotation.axis.x, this.rotation.axis.y, this.rotation.axis.z],\r\n            degToRad(this.rotation.angle),\r\n            modelMatrix\r\n          );\r\n        } else {\r\n          mat4.rotateX(modelMatrix, this.rotation.getRotX(), modelMatrix);\r\n          mat4.rotateY(modelMatrix, this.rotation.getRotY(), modelMatrix);\r\n          mat4.rotateZ(modelMatrix, this.rotation.getRotZ(), modelMatrix);\r\n        }\r\n        // if(this.glb || this.objAnim) {\r\n        //   // mat4.scale(modelMatrix, [this.scale[0], this.scale[1], this.scale[2]], modelMatrix);\r\n        // }\r\n        if(useScale == true) {\r\n          mat4.scale(modelMatrix, [this.scale[0], this.scale[1], this.scale[2]], modelMatrix);\r\n        }\r\n        return modelMatrix;\r\n      };\r\n\r\n      // looks like affect on transformations for now const 0\r\n      const modelMatrix = mat4.translation([0, 0, 0]);\r\n      const modelData = modelMatrix;\r\n      this.device.queue.writeBuffer(\r\n        this.modelUniformBuffer,\r\n        0,\r\n        modelData.buffer,\r\n        modelData.byteOffset,\r\n        modelData.byteLength\r\n      );\r\n      this.done = true;\r\n      try {\r\n        this.setupPipeline();\r\n      } catch(err) {console.log('Err[create pipeline]:', err)}\r\n    }).then(() => {\r\n      if(typeof this.objAnim !== 'undefined' && this.objAnim !== null) {\r\n        console.log('After all updateMeshListBuffers...');\r\n        this.updateMeshListBuffers();\r\n      }\r\n    })\r\n  }\r\n\r\n  setupPipeline = () => {\r\n    this.createBindGroupForRender();\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      label: 'Main [Mesh] Pipeline \u2705[OPAQUE]',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'PipelineLayout Opaque',\r\n        bindGroupLayouts: [\r\n          this.bglForRender,\r\n          this.uniformBufferBindGroupLayout,\r\n          this.selectedBindGroupLayout,\r\n          this.waterBindGroupLayout,\r\n        ],\r\n      }),\r\n      vertex: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.material.type === 'normalmap') ? vertexWGSL_NM : vertexWGSL,\r\n        }),\r\n        buffers: this.vertexBuffers,\r\n      },\r\n      fragment: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.isVideo === true ? fragmentVideoWGSL : this.getMaterial()),\r\n        }),\r\n        targets: [\r\n          {\r\n            format: 'rgba16float',\r\n            blend: undefined\r\n          },\r\n        ],\r\n        constants: {\r\n          shadowDepthTextureSize: this.shadowDepthTextureSize,\r\n        },\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n    // TRANSPARENT\r\n    this.pipelineTransparent = this.device.createRenderPipeline({\r\n      label: 'Main [Mesh] Pipeline \u2705[Transparent]',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'Main PipelineLayout Transparent',\r\n        bindGroupLayouts: [\r\n          this.bglForRender,\r\n          this.uniformBufferBindGroupLayout,\r\n          this.selectedBindGroupLayout,\r\n          this.waterBindGroupLayout,\r\n        ],\r\n      }),\r\n      vertex: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.material.type === 'normalmap') ? vertexWGSL_NM : vertexWGSL,\r\n        }),\r\n        buffers: this.vertexBuffers,\r\n      },\r\n      fragment: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.isVideo === true ? fragmentVideoWGSL : this.getMaterial()),\r\n        }),\r\n        targets: [\r\n          {\r\n            format: 'rgba16float',\r\n            blend: {\r\n              color: {\r\n                srcFactor: 'src-alpha',\r\n                dstFactor: 'one-minus-src-alpha',\r\n                operation: 'add',\r\n              },\r\n              alpha: {\r\n                srcFactor: 'one',\r\n                dstFactor: 'one-minus-src-alpha',\r\n                operation: 'add',\r\n              },\r\n            },\r\n          },\r\n        ],\r\n        constants: {\r\n          shadowDepthTextureSize: this.shadowDepthTextureSize,\r\n        },\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: false,\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n    // console.log('\u2705Set Pipelines done');\r\n  }\r\n\r\n  getMainPipeline = () => {\r\n    return this.pipeline;\r\n  }\r\n\r\n  updateModelUniformBuffer = () => {\r\n    if(this.done == false) return;\r\n    // Per-object model matrix only\r\n    const modelMatrix = this.getModelMatrix(this.position, this.useScale);\r\n    this.device.queue.writeBuffer(\r\n      this.modelUniformBuffer,\r\n      0,\r\n      modelMatrix.buffer,\r\n      modelMatrix.byteOffset,\r\n      modelMatrix.byteLength\r\n    );\r\n  }\r\n\r\n  createGPUBuffer(dataArray, usage) {\r\n    if(!dataArray || typeof dataArray.length !== 'number') {\r\n      throw new Error('Invalid data array passed to createGPUBuffer');\r\n    }\r\n\r\n    const size = dataArray.length * dataArray.BYTES_PER_ELEMENT;\r\n    if(!Number.isFinite(size) || size <= 0) {\r\n      throw new Error(`Invalid buffer size: ${size}`);\r\n    }\r\n\r\n    const buffer = this.device.createBuffer({\r\n      size,\r\n      usage,\r\n      mappedAtCreation: true,\r\n    });\r\n\r\n    const writeArray = dataArray.constructor === Float32Array\r\n      ? new Float32Array(buffer.getMappedRange())\r\n      : new Uint16Array(buffer.getMappedRange());\r\n    writeArray.set(dataArray);\r\n    buffer.unmap();\r\n    return buffer;\r\n  }\r\n\r\n  updateMeshListBuffers() {\r\n    for(const key in this.objAnim.meshList) {\r\n      const mesh = this.objAnim.meshList[key];\r\n      mesh.vertexBuffer = this.device.createBuffer({\r\n        size: mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexBuffer.getMappedRange()).set(mesh.vertices);\r\n      mesh.vertexBuffer.unmap();\r\n      // Normals\r\n      mesh.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexNormalsBuffer.getMappedRange()).set(mesh.vertexNormals);\r\n      mesh.vertexNormalsBuffer.unmap();\r\n      // UVs\r\n      mesh.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexTexCoordsBuffer.getMappedRange()).set(mesh.textures);\r\n      mesh.vertexTexCoordsBuffer.unmap();\r\n      // Indices\r\n      const indexCount = mesh.indices.length;\r\n      const indexSize = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n      mesh.indexBuffer = this.device.createBuffer({\r\n        size: indexSize,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint16Array(mesh.indexBuffer.getMappedRange()).set(mesh.indices);\r\n      mesh.indexBuffer.unmap();\r\n      mesh.indexCount = indexCount;\r\n    }\r\n  }\r\n\r\n  drawElements = (pass, lightContainer) => {\r\n    if(this.isVideo) {\r\n      this.updateVideoTexture();\r\n    }\r\n    // Bind per-mesh uniforms\r\n    pass.setBindGroup(0, this.sceneBindGroupForRender);\r\n    pass.setBindGroup(1, this.modelBindGroup);\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2;\r\n      for(const light of lightContainer) {\r\n        pass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n    if(this.selectedBindGroup) {pass.setBindGroup(2, this.selectedBindGroup)}\r\n    pass.setBindGroup(3, this.waterBindGroup);\r\n\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    pass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    if(this.joints) {\r\n      if(this.constructor.name === \"BVHPlayer\") {\r\n        pass.setVertexBuffer(3, this.mesh.jointsBuffer);  // real\r\n        pass.setVertexBuffer(4, this.mesh.weightsBuffer); //real\r\n      } else {\r\n        // dummy\r\n        pass.setVertexBuffer(3, this.joints.buffer);  // new dummy\r\n        pass.setVertexBuffer(4, this.weights.buffer); // new dummy\r\n      }\r\n    }\r\n\r\n    if(this.mesh.tangentsBuffer) {\r\n      pass.setVertexBuffer(5, this.mesh.tangentsBuffer);\r\n    }\r\n\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  drawElementsAnim = (renderPass, lightContainer) => {\r\n    if(!this.sceneBindGroupForRender || !this.modelBindGroup) {console.log('NULL1'); return;}\r\n    if(!this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni]) {console.log('NULL2'); return;}\r\n\r\n    renderPass.setBindGroup(0, this.sceneBindGroupForRender);\r\n    renderPass.setBindGroup(1, this.modelBindGroup);\r\n    const mesh = this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni];\r\n\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2;\r\n      for(const light of lightContainer) {\r\n        renderPass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    if(this.selectedBindGroup) {\r\n      renderPass.setBindGroup(2, this.selectedBindGroup);\r\n    }\r\n\r\n    renderPass.setBindGroup(3, this.waterBindGroup);\r\n\r\n    renderPass.setVertexBuffer(0, mesh.vertexBuffer);\r\n    renderPass.setVertexBuffer(1, mesh.vertexNormalsBuffer);\r\n    renderPass.setVertexBuffer(2, mesh.vertexTexCoordsBuffer);\r\n\r\n    if(this.constructor.name === \"BVHPlayer\") {\r\n      // real\r\n      renderPass.setVertexBuffer(3, this.mesh.jointsBuffer);\r\n      renderPass.setVertexBuffer(4, this.mesh.weightsBuffer);\r\n    } else {\r\n      // dummy\r\n      renderPass.setVertexBuffer(3, this.joints.buffer);\r\n      renderPass.setVertexBuffer(4, this.weights.buffer);\r\n    }\r\n\r\n    if(this.mesh.tangentsBuffer) {\r\n      renderPass.setVertexBuffer(5, this.mesh.tangentsBuffer);\r\n    }\r\n\r\n    renderPass.setIndexBuffer(mesh.indexBuffer, 'uint16');\r\n    renderPass.drawIndexed(mesh.indexCount);\r\n\r\n    if(this.objAnim.playing == true) {\r\n      if(this.objAnim.animations[this.objAnim.animations.active].speedCounter >= this.objAnim.animations[this.objAnim.animations.active].speed) {\r\n        this.objAnim.currentAni++;\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter = 0;\r\n      } else {\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter++;\r\n      }\r\n      if(this.objAnim.currentAni >= this.objAnim.animations[this.objAnim.animations.active].to) {\r\n        this.objAnim.currentAni = this.objAnim.animations[this.objAnim.animations.active].from;\r\n      }\r\n    }\r\n  }\r\n\r\n  drawShadows = (shadowPass) => {\r\n    shadowPass.setVertexBuffer(0, this.vertexBuffer);\r\n    shadowPass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    shadowPass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    shadowPass.setVertexBuffer(3, this.joints.buffer);\r\n    shadowPass.setVertexBuffer(4, this.weights.buffer);\r\n    shadowPass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    shadowPass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  destroy = () => {\r\n    if(this._destroyed) return;\r\n    this._destroyed = true;\r\n    // --- GPU Buffers ---\r\n    this.vertexBuffer?.destroy();\r\n    this.vertexNormalsBuffer?.destroy();\r\n    this.vertexTexCoordsBuffer?.destroy();\r\n    this.indexBuffer?.destroy();\r\n\r\n    this.modelUniformBuffer?.destroy();\r\n    this.sceneUniformBuffer?.destroy();\r\n    this.bonesBuffer?.destroy();\r\n    this.selectedBuffer?.destroy();\r\n    // Skinning\r\n    this.mesh?.weightsBuffer?.destroy();\r\n    this.mesh?.jointsBuffer?.destroy();\r\n    this.mesh?.tangentsBuffer?.destroy();\r\n    // Dummy skin buffers\r\n    this.joints?.buffer?.destroy();\r\n    this.weights?.buffer?.destroy();\r\n    // Obj sequence animation buffers\r\n    if(this.objAnim?.meshList) {\r\n      for(const k in this.objAnim.meshList) {\r\n        const m = this.objAnim.meshList[k];\r\n        m.vertexBuffer?.destroy();\r\n        m.vertexNormalsBuffer?.destroy();\r\n        m.vertexTexCoordsBuffer?.destroy();\r\n        m.indexBuffer?.destroy();\r\n      }\r\n    }\r\n\r\n    if(this.effects?.pointer?.destroy) {\r\n      this.effects.pointer.destroy();\r\n    }\r\n\r\n    this.pipeline = null;\r\n    this.modelBindGroup = null;\r\n    this.sceneBindGroupForRender = null;\r\n    this.selectedBindGroup = null;\r\n\r\n    this.material = null;\r\n    this.mesh = null;\r\n    this.objAnim = null;\r\n\r\n    this.drawElements = () => {};\r\n    this.drawElementsAnim = () => {};\r\n    this.drawShadows = () => {};\r\n\r\n    let testPB = app.matrixAmmo.getBodyByName(this.name);\r\n    if(testPB !== null) {\r\n      try {\r\n        app.matrixAmmo.dynamicsWorld.removeRigidBody(testPB);\r\n      } catch(e) {\r\n        console.warn(\"Physics cleanup err:\", e);\r\n      }\r\n    }\r\n    console.info(`\uD83E\uDDF9Destroyed: ${this.name}`);\r\n  }\r\n\r\n}", "import {LOG_FUNNY, LOG_FUNNY_ARCADE, degToRad, quaternion_rotation_matrix, radToDeg, scriptManager} from \"../engine/utils\";\r\n\r\nexport default class MatrixAmmo {\r\n  constructor() {\r\n    // THIS PATH IS PATH FROM PUBLIC FINAL FOLDER\r\n    \r\n    // scriptManager.LOAD(\"https://maximumroulette.com/apps/megpu/ammo.js\", \"ammojs\",\r\n    scriptManager.LOAD(\"ammojs/ammo.js\", \"ammojs\",\r\n      undefined, undefined, this.init,\r\n    );\r\n    this.lastRoll = '';\r\n    this.presentScore = '';\r\n    this.speedUpSimulation = 1;\r\n  }\r\n\r\n  init = () => {\r\n    Ammo().then(Ammo => {\r\n      // Physics variables\r\n      this.dynamicsWorld = null;\r\n      this.rigidBodies = [];\r\n      this.Ammo = Ammo;\r\n      this.lastUpdate = 0\r\n      console.log(\"%c Ammo core loaded.\", LOG_FUNNY_ARCADE);\r\n      this.initPhysics();\r\n      // simulate async\r\n      setTimeout(() => {\r\n        dispatchEvent(new CustomEvent('AmmoReady', {}))\r\n      }, 200)\r\n    });\r\n  };\r\n\r\n  initPhysics() {\r\n    let Ammo = this.Ammo;\r\n    // Physics configuration\r\n    var collisionConfiguration = new Ammo.btDefaultCollisionConfiguration(),\r\n      dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration),\r\n      overlappingPairCache = new Ammo.btDbvtBroadphase(),\r\n      solver = new Ammo.btSequentialImpulseConstraintSolver();\r\n\r\n    this.dynamicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, overlappingPairCache, solver, collisionConfiguration);\r\n    this.dynamicsWorld.setGravity(new Ammo.btVector3(0, -10, 0));\r\n\r\n    var groundShape = new Ammo.btBoxShape(new Ammo.btVector3(70, 1, 70)),\r\n      groundTransform = new Ammo.btTransform();\r\n    groundTransform.setIdentity();\r\n    groundTransform.setOrigin(new Ammo.btVector3(0, -4.45, 0));\r\n    var mass = 0,\r\n      isDynamic = (mass !== 0),\r\n      localInertia = new Ammo.btVector3(0, 0, 0);\r\n\r\n    if(isDynamic) groundShape.calculateLocalInertia(mass, localInertia);\r\n\r\n    var myMotionState = new Ammo.btDefaultMotionState(groundTransform),\r\n      rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, myMotionState, groundShape, localInertia),\r\n      body = new Ammo.btRigidBody(rbInfo);\r\n    body.name = 'ground';\r\n    this.ground = body;\r\n    this.dynamicsWorld.addRigidBody(body);\r\n    this.detectCollision()\r\n  }\r\n\r\n  addPhysics(MEObject, pOptions) {\r\n    if(pOptions.geometry == \"Sphere\") {\r\n      this.addPhysicsSphere(MEObject, pOptions)\r\n    } else if(pOptions.geometry == \"Cube\") {\r\n      this.addPhysicsBox(MEObject, pOptions)\r\n    }\r\n  }\r\n\r\n  addPhysicsSphere(MEObject, pOptions) {\r\n    const FLAGS = {\r\n      TEST_NIDZA: 3,\r\n      CF_KINEMATIC_OBJECT: 2\r\n    }\r\n\r\n    let Ammo = this.Ammo;\r\n    var colShape = new Ammo.btSphereShape(Array.isArray(pOptions.radius) ? pOptions.radius[0] : pOptions.radius),\r\n      startTransform = new Ammo.btTransform();\r\n    startTransform.setIdentity();\r\n    var mass = 1;\r\n    var localInertia = new Ammo.btVector3(0, 0, 0);\r\n    colShape.calculateLocalInertia(mass, localInertia);\r\n    startTransform.setOrigin(new Ammo.btVector3(pOptions.position.x, pOptions.position.y, pOptions.position.z));\r\n\r\n    var myMotionState = new Ammo.btDefaultMotionState(startTransform),\r\n      rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, myMotionState, colShape, localInertia),\r\n      body = new Ammo.btRigidBody(rbInfo);\r\n\r\n    if(pOptions.mass == 0 && typeof pOptions.state == 'undefined' && typeof pOptions.collide == 'undefined') {\r\n      body.setActivationState(2)\r\n      body.setCollisionFlags(FLAGS.CF_KINEMATIC_OBJECT);\r\n      // console.log('what is pOptions.mass and state is 2 ....', pOptions.mass)\r\n    } else if(typeof pOptions.collide != 'undefined' && pOptions.collide == false) {\r\n      // idea not work for now - eliminate collide effect\r\n      body.setActivationState(4)\r\n      body.setCollisionFlags(FLAGS.TEST_NIDZA);\r\n    } else {\r\n      body.setActivationState(4)\r\n    }\r\n\r\n    body.name = pOptions.name;\r\n    MEObject.itIsPhysicsBody = true;\r\n    body.MEObject = MEObject;\r\n    this.dynamicsWorld.addRigidBody(body);\r\n    this.rigidBodies.push(body);\r\n    return body;\r\n  }\r\n\r\n  addPhysicsBox(MEObject, pOptions) {\r\n    const FLAGS = {\r\n      TEST_NIDZA: 3,\r\n      CF_KINEMATIC_OBJECT: 2\r\n    }\r\n\r\n    let Ammo = this.Ammo;\r\n    // improve this - scale by comp\r\n    var colShape = new Ammo.btBoxShape(new Ammo.btVector3(pOptions.scale[0], pOptions.scale[1], pOptions.scale[2])),\r\n      startTransform = new Ammo.btTransform();\r\n    startTransform.setIdentity();\r\n    var mass = pOptions.mass;\r\n    var localInertia = new Ammo.btVector3(0, 0, 0);\r\n    colShape.calculateLocalInertia(mass, localInertia);\r\n    startTransform.setOrigin(new Ammo.btVector3(pOptions.position.x, pOptions.position.y, pOptions.position.z));\r\n    // console.log('startTransform.setRotation', startTransform.setRotation)\r\n    var t = startTransform.getRotation()\r\n    t.setX(degToRad(pOptions.rotation.x))\r\n    t.setY(degToRad(pOptions.rotation.y))\r\n    t.setZ(degToRad(pOptions.rotation.z))\r\n    startTransform.setRotation(t)\r\n\r\n    var myMotionState = new Ammo.btDefaultMotionState(startTransform),\r\n      rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, myMotionState, colShape, localInertia),\r\n      body = new Ammo.btRigidBody(rbInfo);\r\n\r\n    if(pOptions.mass == 0 && typeof pOptions.state == 'undefined' && typeof pOptions.collide == 'undefined') {\r\n      body.setActivationState(2)\r\n      body.setCollisionFlags(FLAGS.CF_KINEMATIC_OBJECT);\r\n      // console.log('what is pOptions.mass and state is 2 ....', pOptions.mass)\r\n    } else if(typeof pOptions.collide != 'undefined' && pOptions.collide == false) {\r\n      // idea not work for now - eliminate collide effect\r\n      body.setActivationState(4)\r\n      body.setCollisionFlags(FLAGS.TEST_NIDZA);\r\n    } else {\r\n      body.setActivationState(4)\r\n    }\r\n    body.name = pOptions.name;\r\n    MEObject.itIsPhysicsBody = true;\r\n    body.MEObject = MEObject;\r\n    this.dynamicsWorld.addRigidBody(body);\r\n    this.rigidBodies.push(body);\r\n    return body;\r\n  }\r\n\r\n  setBodyVelocity = (body, x, y, z) => {\r\n    var tbv30 = new Ammo.btVector3();\r\n    tbv30.setValue(x, y, z);\r\n    body.setLinearVelocity(tbv30);\r\n  }\r\n\r\n  setKinematicTransform = (body, x, y, z, rx, ry, rz) => {\r\n    if(typeof rx == 'undefined') {var rx = 0;}\r\n    if(typeof ry == 'undefined') {var ry = 0;}\r\n    if(typeof rz == 'undefined') {var rz = 0;}\r\n    let pos = new Ammo.btVector3();\r\n    // let quat = new Ammo.btQuaternion();\r\n    pos = body.getWorldTransform().getOrigin();\r\n    let localRot = body.getWorldTransform().getRotation();\r\n    // console.log('pre pos x:', pos.x(), \" y : \", pos.y(), \" z:\", pos.z())\r\n    pos.setX(pos.x() + x)\r\n    pos.setY(pos.y() + y)\r\n    pos.setZ(pos.z() + z)\r\n    localRot.setX(rx)\r\n    localRot.setY(ry)\r\n    localRot.setZ(rz)\r\n    let physicsBody = body;\r\n    let ms = physicsBody.getMotionState();\r\n    if(ms) {\r\n      var tmpTrans = new Ammo.btTransform();\r\n      tmpTrans.setIdentity();\r\n      tmpTrans.setOrigin(pos);\r\n      tmpTrans.setRotation(localRot);\r\n      ms.setWorldTransform(tmpTrans);\r\n    }\r\n  }\r\n\r\n  getBodyByName = (name) => {\r\n    var b = null;\r\n    this.rigidBodies.forEach((item, index, array) => {\r\n      if(item.name == name) {\r\n        b = array[index];\r\n      }\r\n    });\r\n    return b;\r\n  }\r\n\r\n  getNameByBody = (body) => {\r\n    var b = null;\r\n    this.rigidBodies.forEach((item, index, array) => {\r\n      if(item.kB == body.kB) {\r\n        b = array[index].name;\r\n      }\r\n    });\r\n    return b;\r\n  }\r\n\r\n  deactivatePhysics = (body) => {\r\n    const CF_KINEMATIC_OBJECT = 2;\r\n    const DISABLE_DEACTIVATION = 4;\r\n    // 1. Remove from world\r\n    this.dynamicsWorld.removeRigidBody(body);\r\n    // 2. Set body to kinematic\r\n    const flags = body.getCollisionFlags();\r\n    body.setCollisionFlags(flags | CF_KINEMATIC_OBJECT);\r\n    body.setActivationState(DISABLE_DEACTIVATION); // no auto-wakeup\r\n    // 3. Clear motion\r\n    const zero = new Ammo.btVector3(0, 0, 0);\r\n    body.setLinearVelocity(zero);\r\n    body.setAngularVelocity(zero);\r\n    // 4. Reset transform to current position (optional \u2014 preserves pose)\r\n    const currentTransform = body.getWorldTransform();\r\n    body.setWorldTransform(currentTransform);\r\n    body.getMotionState().setWorldTransform(currentTransform);\r\n    // 5. Add back to physics world\r\n    this.matrixAmmo.dynamicsWorld.addRigidBody(body);\r\n    // 6. Mark it manually (logic flag)\r\n    body.isKinematic = true;\r\n  }\r\n\r\n  detectCollision() {\r\n    // console.log('override this')\r\n    return;\r\n    this.lastRoll = '';\r\n    this.presentScore = '';\r\n    let dispatcher = this.dynamicsWorld.getDispatcher();\r\n    let numManifolds = dispatcher.getNumManifolds();\r\n    for(let i = 0;i < numManifolds;i++) {\r\n      let contactManifold = dispatcher.getManifoldByIndexInternal(i);\r\n      // let numContacts = contactManifold.getNumContacts();\r\n      // this.rigidBodies.forEach((item) => {\r\n      //   if(item.kB == contactManifold.getBody0().kB) {\r\n      //     // console.log('Detected body0 =', item.name)\r\n      //   }\r\n      if(this.ground.kB == contactManifold.getBody0().kB &&\r\n        this.getNameByBody(contactManifold.getBody1()) == 'CubePhysics1') {\r\n        // console.log(this.ground ,'GROUND IS IN CONTACT WHO IS BODY1 ', contactManifold.getBody1())\r\n        // console.log('GROUND IS IN CONTACT WHO IS BODY1 getNameByBody  ', this.getNameByBody(contactManifold.getBody1()))\r\n        // CHECK ROTATION\r\n        var testR = contactManifold.getBody1().getWorldTransform().getRotation();\r\n        console.log('this.lastRoll = ', this.lastRoll, ' presentScore = ', this.presentScore)\r\n      }\r\n    }\r\n  }\r\n\r\n  updatePhysics() {\r\n    if(typeof Ammo === 'undefined') return;\r\n    const trans = new Ammo.btTransform();\r\n    const transform = new Ammo.btTransform();\r\n\r\n    this.rigidBodies.forEach(function(body) {\r\n      if(body.isKinematic) {\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(\r\n          body.MEObject.position.x,\r\n          body.MEObject.position.y,\r\n          body.MEObject.position.z\r\n        ));\r\n        const quat = new Ammo.btQuaternion();\r\n        quat.setRotation(\r\n          new Ammo.btVector3(\r\n            body.MEObject.rotation.axis.x,\r\n            body.MEObject.rotation.axis.y,\r\n            body.MEObject.rotation.axis.z\r\n          ),\r\n          degToRad(body.MEObject.rotation.angle)\r\n        );\r\n        transform.setRotation(quat);\r\n\r\n        body.setWorldTransform(transform);\r\n        const ms = body.getMotionState();\r\n        if(ms) ms.setWorldTransform(transform);\r\n      }\r\n    });\r\n\r\n    Ammo.destroy(transform);\r\n\r\n    // Step simulation AFTER setting kinematic transforms\r\n    const timeStep = 1 / 60;\r\n    const maxSubSteps = 10;\r\n\r\n    for(let i = 0;i < this.speedUpSimulation;i++) {\r\n      this.dynamicsWorld.stepSimulation(timeStep, maxSubSteps);\r\n    }\r\n\r\n    this.rigidBodies.forEach(function(body) {\r\n      if(!body.isKinematic && body.getMotionState()) {\r\n        body.getMotionState().getWorldTransform(trans);\r\n\r\n        const _x = +trans.getOrigin().x().toFixed(2);\r\n        const _y = +trans.getOrigin().y().toFixed(2);\r\n        const _z = +trans.getOrigin().z().toFixed(2);\r\n\r\n        body.MEObject.position.setPosition(_x, _y, _z);\r\n\r\n        const rot = trans.getRotation();\r\n        const rotAxis = rot.getAxis();\r\n        rot.normalize();\r\n\r\n        body.MEObject.rotation.axis.x = rotAxis.x();\r\n        body.MEObject.rotation.axis.y = rotAxis.y();\r\n        body.MEObject.rotation.axis.z = rotAxis.z();\r\n        body.MEObject.rotation.matrixRotation = quaternion_rotation_matrix(rot);\r\n        body.MEObject.rotation.angle = radToDeg(parseFloat(rot.getAngle().toFixed(2)));\r\n      }\r\n    });\r\n\r\n    Ammo.destroy(trans);\r\n    this.detectCollision();\r\n  }\r\n}", "export const en = {\r\n  \"play\": \"Play\",\r\n  \"sendmsg\": \"Send message\",\r\n  \"changeTheme\": \"Theme dark/light\",\r\n  \"yes\": \"Yes\",\r\n  \"no\": \"No\",\r\n  \"on\": \"On\",\r\n  \"off\": \"Off\",\r\n  \"startGame\": \"\uD83C\uDFB2Start Game\",\r\n  \"changeLang\": \"Change Lang\",\r\n  \"english\": \"English\",\r\n  \"serbian\": \"Serbian\",\r\n  \"MAX\": \"MAX\",\r\n  \"MIN\": \"MIN\",\r\n  \"straight\": \"Straight\",\r\n  \"threeOf\": \"ThreeOf\",\r\n  \"fullhouse\": \"FULLH\",\r\n  \"help\": \"HELP\",\r\n  \"roll\":\"ROLL DICES\",\r\n  \"settings\": \"Settings\",\r\n  \"hand\": \"Hand\",\r\n  \"up\": \"Up |\",\r\n  \"down\": \"Down\",\r\n  \"free\": \"Free\",\r\n  \"cornerText\": \"\uD83C\uDFB2\",\r\n  \"poker\":\"Poker\",\r\n  \"jamb\":\"Jamb\",\r\n  \"final\":\"Final \u03A3\",\r\n  \"hide\": \"HIDE\",\r\n  \"sounds\": \"Sounds\",\r\n  \"welcomeMsg\": \"Welcome here, <br> open source project \uD83C\uDFB2 Jamb 3d deluxe game <br> download from \",\r\n  \"ready\":\"Ready for play \uD83C\uDFB2!\",\r\n  \"freetoroll\":\"Free for roll \uD83C\uDFB2!\",\r\n  \"pick5\":\"Pick best 5 \uD83C\uDFB2 and choose table field!\",\r\n  \"hand1\":\"First hand in play - please wait...\",\r\n  \"hand2\":\"Secound hand in play - please wait...\",\r\n  \"graphics\":\"Graphics options\",\r\n  \"choosename\":\"Choose nickname:\",\r\n  \"table\":\"Table\",\r\n  \"aboutword\":\"About\",\r\n  \"about\":\"<i>Jamb 3d deluxe</i> is a modern 3D dice game built entirely with MatrixEngineWGPU, a high-performance WebGPU-based rendering engine developed for creating interactive graphics directly in the browser. The game delivers smooth visuals, realistic dice physics, and an engaging user experience \u2014 all without requiring any plugins or installations. \\n This project is powered by open technologies and is designed to be lightweight, fast, and highly customizable. It\u2019s a great example of how WebGPU can be used for real-time interactive content. \\n \uD83D\uDD17 Download / Try it: \\n github.com/zlatnaspirala/matrix-engine-wgpu \\n \uD83D\uDEE0 License: \\n The core engine and the Jamb 3d deluxe project are released under the GPL v3 license, making them free and open-source for both personal and commercial use \u2014 as long as you respect the terms of the license. \\n Whether you're a developer, gamer, or enthusiast, Jamb 3d deluxe is a fun way to experience the potential of modern browser-based 3D technology. <img width='320' height='320' src='https://github.com/zlatnaspirala/matrix-engine-wgpu/blob/main/public/res/icons/512.png?raw=true' />\",\r\n\r\n  \"letthegame\": \"Let the game begin!\",\r\n  \"leaderboard\": \"Leaderboard\",\r\n  \"about_\": \"About\",\r\n  \"next\": \"Next\",\r\n  \"back\": \"Back\",\r\n  \"used\": \"used\",\r\n  \"gameplaychannel\":\"gameplay channel\",\r\n  \"alreadyingame\": \"Already in game:\",\r\n  \"waiting_for_others\": \"Waiting for others...\",\r\n  \"titleBan\":\"\u272DBan \uD83D\uDFE2\uD83D\uDFE2\uD83D\uDFE2\",\r\n  \"aboutRPG\": \"Forest Of Hollow Blood Made in MatrixEngineWGPU webGPU engine. Open source part can be found in engine repo <a href='https://github.com/zlatnaspirala/matrix-engine-wgpu'> @zlatnaspirala Github.com </a>. Music by <a href='https://pixabay.com/users/mfcc-28627740/?utm_source=link-attribution&utm_medium=referral&utm_campaign=music&utm_content=274290'>Mykola Sosin</a> from <a href='https://pixabay.com//?utm_source=link-attribution&utm_medium=referral&utm_campaign=music&utm_content=274290'>Pixabay</a> Characters used from great mixamo.com -\u2705What you can do You can use Mixamo characters and animations royalty-free in commercial, personal, or non\u2011profit projects (games, films, prints, etc.).You own your creations / how you use them.No requirement to credit Adobe / Mixamo (though allowed). -\uD83D\uDEABWhat you cannot do You cannot redistribute or sell the raw Mixamo character or animation files \u201Cas is\u201D (i.e. as standalone assets) to others.You can\u2019t use Mixamo content to create a competing library of characters / animations (i.e. you can\u2019t just package them and sell them to others). You can\u2019t use Mixamo\u2019s content (or outputs) to train AI / machine learning models. Used free assets from great https://craftpix.net Magic icons : https://craftpix.net/freebies/free-rpg-splash-game-512x512-icons/ For background music in rpg template used: Music by Dvir Silverstone from Pixabay Sound Effect by Crunchpix Studio from Pixabay Music by Emmraan from Pixabay . Logo includes the official WebGPU logo. WebGPU logo by W3C Licensed under Creative Commons Attribution 4.0 .   'Ruined rock fence' (https://skfb.ly/6RLwN) by VladNeko is licensed under Creative Commons Attribution (http://creativecommons.org/licenses/by/4.0/).\",\r\n  \"mariasword\": \"Maria Sword, the silver blade of the East, strikes with speed and elegance. Her courage burns quietly but never falters.\",\r\n  \"slayzer\":\"Slayzer \u2014 a dark creation with blades for arms. Silent, swift, and born from shadow.\",\r\n  \"steelborn\":\"Steelborn \u2014 a small yet fearless warrior clad in shining iron armor, wielding his sword with unshakable resolve.\",\r\n  \"warrok\": \"Warrok \u2014 a fierce brute forged in battle, wielding raw strength and unbreakable will.\",\r\n  \"skeletonz\": \"Skeletonz \u2014 a restless warrior of bone and shadow, risen again to fight without fear.\",\r\n  \"erika\": \"Erika moves like a shadow: quiet, precise and watchful. She carries one dark arrow \u2014 simple, deadly and personal.\",\r\n  \"arissa\": \"Arissa hides her power behind calm eyes and empty hands. No blade or staff\u2014only the swirling dark orbs she conjures when the fight begins.\",\r\n\r\n  \"gameplayused\":\"Forest Of Hollow Blood for now have only one channel for gameplay. Please wait for current party end...\",\r\n\r\n\r\n  \"nogold\" : \"Not enough gold!\",\r\n  \"invertorysecret\" : \"Corona Ignifera magic secret Sol Corona,Flamma Crystal\\n  Aqua Sanctum magic secret Mare Pearl,Luna Gemma\\n Umbra Silens magic secret Umbra Vellum,Noctis Band\\n Terra Fortis magic secret Terra Clavis,Ardent Vine,Silva Heart\\n Ventus Aegis magic secret Ventus Pluma,Ignifur Cape\\n Ferrum Lux magic secret Ferrum Anulus,Lux Feather\\n Sanguis Vita magic secret Sanguis Orb,Vita Flos \\n Tenebris Vox magic secret Tenebris Fang,Vox Chime \\n Aether Gladius magic secret Gladius Ignis,Aether Scale \\n Fulgur Mortis magic secret Fulgur Stone,Mortis Bone \\n Corona Umbra magic secret Umbra Silens,Corona Ignifera,Tenebris Vox \\n Terra Sanctum magic secret Terra Fortis,Aqua Sanctum \\n Aether Fortis magic secret Aether Gladius,Ferrum Lux \\n  Vita Mindza magic secret Sanguis Vita,Ventus Aegis \\n Mortis Ultima magic secret Fulgur Mortis,Corona Umbra,Aether Fortis\"\r\n}", "import {en} from \"../../public/res/multilang/en-backup\";\r\nimport {LOG_FUNNY_ARCADE, LOG_MATRIX} from \"../engine/utils\";\r\n\r\nexport class MultiLang {\r\n\r\n  constructor() {\r\n    addEventListener('updateLang', () => {\r\n      console.log('Multilang updated.')\r\n      this.update();\r\n    })\r\n  }\r\n\r\n  update = function() {\r\n    var allTranDoms = document.querySelectorAll('[data-label]');\r\n    allTranDoms.forEach((i) => {\r\n      i.innerHTML = this.get[i.getAttribute('data-label')]\r\n    })\r\n  }\r\n\r\n  loadMultilang = async function(lang = 'en') {\r\n    if (lang == 'rs') lang = 'sr'; // exc\r\n    lang = 'res/multilang/' + lang + '.json';\r\n    console.info(`%cMultilang: ${lang}` , LOG_FUNNY_ARCADE);\r\n    try {\r\n      const r = await fetch(lang, {\r\n        headers: {\r\n          'Accept': 'application/json',\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n      return await r.json();\r\n    } catch(err) {\r\n      console.warn('Not possible to access multilang json asset! Err => ', err, '. Use backup lang predefinited object. Only english avaible.');\r\n      return en;\r\n    }\r\n  }\r\n}", "export class MatrixSounds {\r\n\r\n  constructor() {\r\n    this.volume = 0.5;\r\n    this.audios = {};\r\n    this.enabled = true; // \uD83D\uDD07 global flag to mute/allow audio\r\n  }\r\n\r\n  muteAll() {\r\n    this.enabled = false;\r\n    Object.values(this.audios).forEach(audio => audio.pause());\r\n  }\r\n\r\n  unmuteAll() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  createClones(c, name, path) {\r\n    for(let x = 1;x < c;x++) {\r\n      const a = new Audio(path);\r\n      a.id = name + x;\r\n      a.volume = this.volume;\r\n      this.audios[name + x] = a;\r\n      document.body.append(a);\r\n    }\r\n  }\r\n\r\n  createAudio(name, path, useClones) {\r\n    const a = new Audio(path);\r\n    a.id = name;\r\n    a.volume = this.volume;\r\n    this.audios[name] = a;\r\n    document.body.append(a);\r\n    if(typeof useClones !== 'undefined') {\r\n      this.createClones(useClones, name, path);\r\n    }\r\n  }\r\n\r\n  play(name) {\r\n    if(!this.enabled) return; // \uD83D\uDD07 prevent playing if muted\r\n\r\n    const audio = this.audios[name];\r\n    if(!audio) return;\r\n\r\n    if(audio.paused) {\r\n      audio.play().catch((e) => {\r\n        if(e.name !== 'NotAllowedError') console.warn(\"sounds error:\", e);\r\n      });\r\n    } else {\r\n      this.tryClone(name);\r\n    }\r\n  }\r\n\r\n  tryClone(name) {\r\n    if(!this.enabled) return; // \uD83D\uDD07 prevent playing clones\r\n\r\n    let cc = 1;\r\n    try {\r\n      while(this.audios[name + cc] && this.audios[name + cc].paused === false) {\r\n        cc++;\r\n      }\r\n      if(this.audios[name + cc]) {\r\n        this.audios[name + cc].play();\r\n      }\r\n    } catch(err) {\r\n      console.warn(\"Clone play failed:\", err);\r\n    }\r\n  }\r\n}", "/**\r\n * The main Mesh class. The constructor will parse through the OBJ file data\r\n * and collect the vertex, vertex normal, texture, and face information. This\r\n * information can then be used later on when creating your VBOs. See\r\n * OBJ.initMeshBuffers for an example of how to use the newly created Mesh\r\n *\r\n * Nidza Note:\r\n * There is difference from me source obj loader and me-wgpu obj loader\r\n * Here we need scele in comp x,y,z because we use also primitive [cube, sphere etc...]\r\n * @class Mesh\r\n * @constructor\r\n *\r\n * @param {String} objectData a string representation of an OBJ file with newlines preserved.\r\n */\r\n\r\nexport class constructMesh {\r\n\r\n  constructor (objectData, inputArg) {\r\n    this.inputArg = inputArg;\r\n    this.objectData = objectData;\r\n    this.create(objectData, inputArg);\r\n    this.setScale = (s) => {\r\n      this.inputArg.scale = s;\r\n      this.create(this.objectData, this.inputArg)\r\n    };\r\n    this.updateBuffers = () => {\r\n      this.inputArg.scale = [0.1,0.1,0.1];\r\n      this.create(this.objectData, this.inputArg);\r\n    };\r\n  }\r\n\r\n  create = (objectData, inputArg, callback) => {\r\n\r\n    if (typeof callback === 'undefined') callback = function() {};\r\n\r\n    let initOrientation = [0,1,2];\r\n    /*\r\n      The OBJ file format does a sort of compression when saving a model in a\r\n      program like Blender. There are at least 3 sections (4 including textures)\r\n      within the file. Each line in a section begins with the same string:\r\n        * 'v': indicates vertex section\r\n        * 'vn': indicates vertex normal section\r\n        * 'f': indicates the faces section\r\n        * 'vt': indicates vertex texture section (if textures were used on the model)\r\n      Each of the above sections (except for the faces section) is a list/set of\r\n      unique vertices.\r\n      Each line of the faces section contains a list of\r\n      (vertex, [texture], normal) groups\r\n      Some examples:\r\n          // the texture index is optional, both formats are possible for models\r\n          // without a texture applied\r\n          f 1/25 18/46 12/31\r\n          f 1//25 18//46 12//31\r\n          // A 3 vertex face with texture indices\r\n          f 16/92/11 14/101/22 1/69/1\r\n          // A 4 vertex face\r\n          f 16/92/11 40/109/40 38/114/38 14/101/22\r\n      The first two lines are examples of a 3 vertex face without a texture applied.\r\n      The second is an example of a 3 vertex face with a texture applied.\r\n      The third is an example of a 4 vertex face. Note: a face can contain N\r\n      number of vertices.\r\n      Each number that appears in one of the groups is a 1-based index\r\n      corresponding to an item from the other sections (meaning that indexing\r\n      starts at one and *not* zero).\r\n      For example:\r\n          `f 16/92/11` is saying to\r\n            - take the 16th element from the [v] vertex array\r\n            - take the 92nd element from the [vt] texture array\r\n            - take the 11th element from the [vn] normal array\r\n          and together they make a unique vertex.\r\n      Using all 3+ unique Vertices from the face line will produce a polygon.\r\n      Now, you could just go through the OBJ file and create a new vertex for\r\n      each face line and WebGL will draw what appears to be the same model.\r\n      However, vertices will be overlapped and duplicated all over the place.\r\n      Consider a cube in 3D space centered about the origin and each side is\r\n      2 units long. The front face (with the positive Z-axis pointing towards\r\n      you) would have a Top Right vertex (looking orthogonal to its normal)\r\n      mapped at (1,1,1) The right face would have a Top Left vertex (looking\r\n      orthogonal to its normal) at (1,1,1) and the top face would have a Bottom\r\n      Right vertex (looking orthogonal to its normal) at (1,1,1). Each face\r\n      has a vertex at the same coordinates, however, three distinct vertices\r\n      will be drawn at the same spot.\r\n      To solve the issue of duplicate Vertices (the `(vertex, [texture], normal)`\r\n      groups), while iterating through the face lines, when a group is encountered\r\n      the whole group string ('16/92/11') is checked to see if it exists in the\r\n      packed.hashindices object, and if it doesn't, the indices it specifies\r\n      are used to look up each attribute in the corresponding attribute arrays\r\n      already created. The values are then copied to the corresponding unpacked\r\n      array (flattened to play nice with WebGL's ELEMENT_ARRAY_BUFFER indexing),\r\n      the group string is added to the hashindices set and the current unpacked\r\n      index is used as this hashindices value so that the group of elements can\r\n      be reused. The unpacked index is incremented. If the group string already\r\n      exists in the hashindices object, its corresponding value is the index of\r\n      that group and is appended to the unpacked indices array.\r\n      */\r\n    var verts = [],\r\n      vertNormals = [],\r\n      textures = [],\r\n      unpacked = {};\r\n    // unpacking stuff\r\n    unpacked.verts = [];\r\n    unpacked.norms = [];\r\n    unpacked.textures = [];\r\n    unpacked.hashindices = {};\r\n    unpacked.indices = [];\r\n    unpacked.index = 0;\r\n    // array of lines separated by the newline\r\n    var lines = objectData.split('\\n');\r\n\r\n    // update swap orientation\r\n    if (inputArg.swap[0] !== null) {\r\n      swap(inputArg.swap[0], inputArg.swap[1], initOrientation);\r\n    }\r\n\r\n    var VERTEX_RE = /^v\\s/;\r\n    var NORMAL_RE = /^vn\\s/;\r\n    var TEXTURE_RE = /^vt\\s/;\r\n    var FACE_RE = /^f\\s/;\r\n    var WHITESPACE_RE = /\\s+/;\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n      var line = lines[i].trim();\r\n      var elements = line.split(WHITESPACE_RE);\r\n      elements.shift();\r\n\r\n      if (VERTEX_RE.test(line)) {\r\n        // if this is a vertex\r\n        verts.push.apply(verts, elements);\r\n      } else if (NORMAL_RE.test(line)) {\r\n        // if this is a vertex normal\r\n        vertNormals.push.apply(vertNormals, elements);\r\n      } else if (TEXTURE_RE.test(line)) {\r\n        // if this is a texture\r\n        textures.push.apply(textures, elements);\r\n      } else if (FACE_RE.test(line)) {\r\n        // if this is a face\r\n        /*\r\n          split this face into an array of vertex groups\r\n          for example:\r\n            f 16/92/11 14/101/22 1/69/1\r\n          becomes:\r\n            ['16/92/11', '14/101/22', '1/69/1'];\r\n          */\r\n        var quad = false;\r\n        for (var j = 0, eleLen = elements.length; j < eleLen; j++) {\r\n          // Triangulating quads\r\n          // quad: 'f v0/t0/vn0 v1/t1/vn1 v2/t2/vn2 v3/t3/vn3/'\r\n          // corresponding triangles:\r\n          //      'f v0/t0/vn0 v1/t1/vn1 v2/t2/vn2'\r\n          //      'f v2/t2/vn2 v3/t3/vn3 v0/t0/vn0'\r\n          if (j === 3 && !quad) {\r\n            // add v2/t2/vn2 in again before continuing to 3\r\n            j = 2;\r\n            quad = true;\r\n          }\r\n          if (elements[j] in unpacked.hashindices) {\r\n            unpacked.indices.push(unpacked.hashindices[elements[j]]);\r\n          } else {\r\n            /*\r\n                  Each element of the face line array is a vertex which has its\r\n                  attributes delimited by a forward slash. This will separate\r\n                  each attribute into another array:\r\n                      '19/92/11'\r\n                  becomes:\r\n                      vertex = ['19', '92', '11'];\r\n                  where\r\n                      vertex[0] is the vertex index\r\n                      vertex[1] is the texture index\r\n                      vertex[2] is the normal index\r\n                  Think of faces having Vertices which are comprised of the\r\n                  attributes location (v), texture (vt), and normal (vn).\r\n                  */\r\n            var vertex = elements[j].split('/');\r\n            /*\r\n                  The verts, textures, and vertNormals arrays each contain a\r\n                  flattend array of coordinates.\r\n                  Because it gets confusing by referring to vertex and then\r\n                  vertex (both are different in my descriptions) I will explain\r\n                  what's going on using the vertexNormals array:\r\n                  vertex[2] will contain the one-based index of the vertexNormals\r\n                  section (vn). One is subtracted from this index number to play\r\n                  nice with javascript's zero-based array indexing.\r\n                  Because vertexNormal is a flattened array of x, y, z values,\r\n                  simple pointer arithmetic is used to skip to the start of the\r\n                  vertexNormal, then the offset is added to get the correct\r\n                  component: +0 is x, +1 is y, +2 is z.\r\n                  This same process is repeated for verts and textures.\r\n                  */\r\n            // vertex position\r\n            unpacked.verts.push(+verts[(vertex[0] - 1) * 3 + initOrientation[0]] * inputArg.scale[0]);\r\n            unpacked.verts.push(+verts[(vertex[0] - 1) * 3 + initOrientation[1]] * inputArg.scale[1]);\r\n            unpacked.verts.push(+verts[(vertex[0] - 1) * 3 + initOrientation[2]] * inputArg.scale[2]);\r\n\r\n            // vertex textures\r\n            if (textures.length) {\r\n              unpacked.textures.push(+textures[(vertex[1] - 1) * 2 + 0]);\r\n              unpacked.textures.push(+textures[(vertex[1] - 1) * 2 + 1]);\r\n            }\r\n            // vertex normals\r\n            unpacked.norms.push(+vertNormals[(vertex[2] - 1) * 3 + 0]);\r\n            unpacked.norms.push(+vertNormals[(vertex[2] - 1) * 3 + 1]);\r\n            unpacked.norms.push(+vertNormals[(vertex[2] - 1) * 3 + 2]);\r\n            // add the newly created vertex to the list of indices\r\n            unpacked.hashindices[elements[j]] = unpacked.index;\r\n            unpacked.indices.push(unpacked.index);\r\n            // increment the counter\r\n            unpacked.index += 1;\r\n          }\r\n          if (j === 3 && quad) {\r\n            // add v0/t0/vn0 onto the second triangle\r\n            unpacked.indices.push(unpacked.hashindices[elements[0]]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.vertices = unpacked.verts;\r\n    this.vertexNormals = unpacked.norms;\r\n    this.textures = unpacked.textures;\r\n    this.indices = unpacked.indices;\r\n    callback();\r\n    return this;\r\n  };\r\n\r\n}\r\n\r\nvar Ajax = function () {\r\n  // this is just a helper class to ease ajax calls\r\n  var _this = this;\r\n  this.xmlhttp = new XMLHttpRequest();\r\n\r\n  this.get = function (url, callback) {\r\n    _this.xmlhttp.onreadystatechange = function () {\r\n      if (_this.xmlhttp.readyState === 4) {\r\n        callback(_this.xmlhttp.responseText, _this.xmlhttp.status);\r\n      }\r\n    };\r\n    _this.xmlhttp.open('GET', url, true);\r\n    _this.xmlhttp.send();\r\n  };\r\n};\r\n\r\n/**\r\n * Takes in an object of `mesh_name`, `'/url/to/OBJ/file'` pairs and a callback\r\n * function. Each OBJ file will be ajaxed in and automatically converted to\r\n * an OBJ.Mesh. When all files have successfully downloaded the callback\r\n * function provided will be called and passed in an object containing\r\n * the newly created meshes.\r\n *\r\n * **Note:** In order to use this function as a way to download meshes, a\r\n * webserver of some sort must be used.\r\n *\r\n * @param {Object} nameAndURLs an object where the key is the name of the mesh and the value is the url to that mesh's OBJ file\r\n *\r\n * @param {Function} completionCallback should contain a function that will take one parameter: an object array where the keys will be the unique object name and the value will be a Mesh object\r\n *\r\n * @param {Object} meshes In case other meshes are loaded separately or if a previously declared variable is desired to be used, pass in a (possibly empty) json object of the pattern: { '<mesh_name>': OBJ.Mesh }\r\n *\r\n */\r\nexport var downloadMeshes = function (nameAndURLs, completionCallback, inputArg) {\r\n  // the total number of meshes. this is used to implement \"blocking\"\r\n  var semaphore = Object.keys(nameAndURLs).length;\r\n  // if error is true, an alert will given\r\n  var error = false;\r\n  // this is used to check if all meshes have been downloaded\r\n  // if meshes is supplied, then it will be populated, otherwise\r\n  // a new object is created. this will be passed into the completionCallback\r\n  if (typeof inputArg === 'undefined') {\r\n    var inputArg = {\r\n      scale: [1,1,1],\r\n      swap: [null]\r\n     };\r\n  }\r\n  if (typeof inputArg.scale === 'undefined') inputArg.scale = [1,1,1];\r\n  if (typeof inputArg.swap === 'undefined') inputArg.swap = [null];\r\n\r\n  var meshes = {};\r\n\r\n  // loop over the mesh_name,url key,value pairs\r\n  for (var mesh_name in nameAndURLs) {\r\n    if (nameAndURLs.hasOwnProperty(mesh_name)) {\r\n      new Ajax().get(\r\n        nameAndURLs[mesh_name],\r\n        (function (name) {\r\n          return function (data, status) {\r\n            if (status === 200) {\r\n              meshes[name] = new constructMesh(data, inputArg);\r\n            } else {\r\n              error = true;\r\n              console.error('An error has occurred and the mesh \"' + name + '\" could not be downloaded.');\r\n            }\r\n            // the request has finished, decrement the counter\r\n            semaphore--;\r\n            if (semaphore === 0) {\r\n              if (error) {\r\n                // if an error has occurred, the user is notified here and the\r\n                // callback is not called\r\n                console.error('An error has occurred and one or meshes has not been ' + 'downloaded. The execution of the script has terminated.');\r\n                throw '';\r\n              }\r\n              // there haven't been any errors in retrieving the meshes\r\n              // call the callback\r\n              completionCallback(meshes, inputArg.scale );\r\n            }\r\n          };\r\n        })(mesh_name)\r\n      );\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Takes in the WebGL context and a Mesh, then creates and appends the buffers\r\n * to the mesh object as attributes.\r\n *\r\n * @param {WebGLRenderingContext} gl the `canvas.getContext('webgl')` context instance\r\n * @param {Mesh} mesh a single `OBJ.Mesh` instance\r\n *\r\n * The newly created mesh attributes are:\r\n *\r\n * Attrbute | Description\r\n * :--- | ---\r\n * **normalBuffer**       |contains the model&#39;s Vertex Normals\r\n * normalBuffer.itemSize  |set to 3 items\r\n * normalBuffer.numItems  |the total number of vertex normals\r\n * |\r\n * **textureBuffer**      |contains the model&#39;s Texture Coordinates\r\n * textureBuffer.itemSize |set to 2 items\r\n * textureBuffer.numItems |the number of texture coordinates\r\n * |\r\n * **vertexBuffer**       |contains the model&#39;s Vertex Position Coordinates (does not include w)\r\n * vertexBuffer.itemSize  |set to 3 items\r\n * vertexBuffer.numItems  |the total number of vertices\r\n * |\r\n * **indexBuffer**        |contains the indices of the faces\r\n * indexBuffer.itemSize   |is set to 1\r\n * indexBuffer.numItems   |the total number of indices\r\n *\r\n * A simple example (a lot of steps are missing, so don't copy and paste):\r\n *\r\n *     var gl   = canvas.getContext('webgl'),\r\n *         mesh = OBJ.Mesh(obj_file_data);\r\n *     // compile the shaders and create a shader program\r\n *     var shaderProgram = gl.createProgram();\r\n *     // compilation stuff here\r\n *     ...\r\n *     // make sure you have vertex, vertex normal, and texture coordinate\r\n *     // attributes located in your shaders and attach them to the shader program\r\n *     shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, \"aVertexPosition\");\r\n *     gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);\r\n *\r\n *     shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, \"aVertexNormal\");\r\n *     gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);\r\n *\r\n *     shaderProgram.textureCoordAttribute = gl.getAttribLocation(shaderProgram, \"aTextureCoord\");\r\n *     gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);\r\n *\r\n *     // create and initialize the vertex, vertex normal, and texture coordinate buffers\r\n *     // and save on to the mesh object\r\n *     OBJ.initMeshBuffers(gl, mesh);\r\n *\r\n *     // now to render the mesh\r\n *     gl.bindBuffer(gl.ARRAY_BUFFER, mesh.vertexBuffer);\r\n *     gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, mesh.vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n *     // it's possible that the mesh doesn't contain\r\n *     // any texture coordinates (e.g. suzanne.obj in the development branch).\r\n *     // in this case, the texture vertexAttribArray will need to be disabled\r\n *     // before the call to drawElements\r\n *     if(!mesh.textures.length){\r\n *       gl.disableVertexAttribArray(shaderProgram.textureCoordAttribute);\r\n *     }\r\n *     else{\r\n *       // if the texture vertexAttribArray has been previously\r\n *       // disabled, then it needs to be re-enabled\r\n *       gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);\r\n *       gl.bindBuffer(gl.ARRAY_BUFFER, mesh.textureBuffer);\r\n *       gl.vertexAttribPointer(shaderProgram.textureCoordAttribute, mesh.textureBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n *     }\r\n *\r\n *     gl.bindBuffer(gl.ARRAY_BUFFER, mesh.normalBuffer);\r\n *     gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, mesh.normalBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n *\r\n *     gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, model.mesh.indexBuffer);\r\n *     gl.drawElements(gl.TRIANGLES, model.mesh.indexBuffer.numItems, gl.UNSIGNED_SHORT, 0);\r\n */\r\nexport var initMeshBuffers = function (gl, mesh) {\r\n  // mesh.vertexNormals\r\n  // mesh.textures\r\n  // mesh.vertices\r\n  // mesh.indices\r\n};\r\n\r\n/**\r\n * @description\r\n * Construct sequence list argument for downloadMeshes.\r\n * This is adaptation for blender obj animation export.\r\n * For example:\r\n *    matrixEngine.objLoader.downloadMeshes(\r\n      matrixEngine.objLoader.makeObjSeqArg(\r\n        {\r\n          id: objName,\r\n          joinMultiPahts: [\r\n            {\r\n              path: \"res/bvh-skeletal-base/swat-guy/seq-walk/low/swat\",\r\n              id: objName,\r\n              from: 1, to: 34\r\n            },\r\n            {\r\n              path: \"res/bvh-skeletal-base/swat-guy/seq-walk-pistol/low/swat-walk-pistol\",\r\n              id: objName,\r\n              from: 35, to: 54\r\n            }\r\n          ]\r\n        }),\r\n      onLoadObj\r\n    );\r\n */\r\nexport const makeObjSeqArg = (arg) => {\r\n  // Adaptation for blender (animation) obj exporter.\r\n  var local = {};\r\n\r\n  function localCalc(arg, noInitial = false) {\r\n    var zeros = '00000';\r\n    var l = {};\r\n    var helper = arg.from;\r\n    for (let j = arg.from, z=1; j <= arg.to;j++ ) {\r\n\r\n      if (z > 9 && z < 99) {\r\n        zeros = '0000';\r\n      } else if (z > 99 && z < 999) {\r\n        zeros = '000';\r\n      } // no need more then 999\r\n\r\n      if (helper == arg.from && noInitial === false) {\r\n        l[arg.id] = arg.path + '_' + zeros + z + '.obj';\r\n      } else {\r\n        l[arg.id + (helper-1)] = arg.path + '_' + zeros + z + '.obj';\r\n      }\r\n      helper++;\r\n      z++;\r\n    }\r\n    return l;\r\n  }\r\n\r\n  if (typeof arg.path === 'string' ) {\r\n    local = localCalc(arg);\r\n  } else if (typeof arg.path === 'undefined')  {\r\n    if (typeof arg.joinMultiPahts !== 'undefined')  {\r\n      console.log(\"ITS joinMultiPahts!\");\r\n      var localFinal = {};\r\n      arg.joinMultiPahts.forEach((arg, index)=> {\r\n        if (index === 0) {\r\n          localFinal = Object.assign(local, localCalc(arg));\r\n        } else {\r\n          localFinal = Object.assign(local, localCalc(arg, true));\r\n        }\r\n      });\r\n      console.log(\"joinMultiPahts LOCAL => \", localFinal);\r\n      return localFinal;\r\n    }\r\n  }\r\n\r\n  return local;\r\n}\r\n\r\n/**\r\n * @description\r\n * Switching obj seq animations frames range.\r\n */\r\nexport function play (nameAni) {\r\n  this.animations.active = nameAni;\r\n  this.currentAni = this.animations[this.animations.active].from;\r\n  this.playing = true;\r\n}\r\n", "export let vertexShadowWGSL = `\r\nconst MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct VertexAnimParams {\r\n  time: f32,\r\n  flags: f32,\r\n  globalIntensity: f32,\r\n  _pad0: f32,\r\n  \r\n  // Wave [4-7]\r\n  waveSpeed: f32,\r\n  waveAmplitude: f32,\r\n  waveFrequency: f32,\r\n  _pad1: f32,\r\n  \r\n  // Wind [8-11]\r\n  windSpeed: f32,\r\n  windStrength: f32,\r\n  windHeightInfluence: f32,\r\n  windTurbulence: f32,\r\n  \r\n  // Pulse [12-15]\r\n  pulseSpeed: f32,\r\n  pulseAmount: f32,\r\n  pulseCenterX: f32,\r\n  pulseCenterY: f32,\r\n  \r\n  // Twist [16-19]\r\n  twistSpeed: f32,\r\n  twistAmount: f32,\r\n  _pad2: f32,\r\n  _pad3: f32,\r\n  \r\n  // Noise [20-23]\r\n  noiseScale: f32,\r\n  noiseStrength: f32,\r\n  noiseSpeed: f32,\r\n  _pad4: f32,\r\n  \r\n  // Ocean [24-27]\r\n  oceanWaveScale: f32,\r\n  oceanWaveHeight: f32,\r\n  oceanWaveSpeed: f32,\r\n  _pad5: f32,\r\n  \r\n  // Displacement [28-31]\r\n  displacementStrength: f32,\r\n  displacementSpeed: f32,\r\n  _pad6: f32,\r\n  _pad7: f32,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n@group(1) @binding(2) var<uniform> vertexAnim : VertexAnimParams;\r\n\r\nconst ANIM_WAVE: u32 = 1u;\r\nconst ANIM_WIND: u32 = 2u;\r\nconst ANIM_PULSE: u32 = 4u;\r\nconst ANIM_TWIST: u32 = 8u;\r\nconst ANIM_NOISE: u32 = 16u;\r\nconst ANIM_OCEAN: u32 = 32u;\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    \r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    \r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\n// Hash function for noise\r\nfn hash(p: vec2f) -> f32 {\r\n  var p3 = fract(vec3f(p.x, p.y, p.x) * 0.13);\r\n  p3 += dot(p3, vec3f(p3.y, p3.z, p3.x) + 3.333);\r\n  return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\n// Noise function\r\nfn noise(p: vec2f) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash(i + vec2f(0.0, 0.0)), hash(i + vec2f(1.0, 0.0)), u.x),\r\n    mix(hash(i + vec2f(0.0, 1.0)), hash(i + vec2f(1.0, 1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\n// Wave animation\r\nfn applyWave(pos: vec3f) -> vec3f {\r\n  let wave = sin(pos.x * vertexAnim.waveFrequency + vertexAnim.time * vertexAnim.waveSpeed) * \r\n             cos(pos.z * vertexAnim.waveFrequency + vertexAnim.time * vertexAnim.waveSpeed);\r\n  return vec3f(pos.x, pos.y + wave * vertexAnim.waveAmplitude, pos.z);\r\n}\r\n\r\n// Wind animation\r\nfn applyWind(pos: vec3f, normal: vec3f) -> vec3f {\r\n  let heightFactor = max(0.0, pos.y) * vertexAnim.windHeightInfluence;\r\n  \r\n  let windDir = vec2f(\r\n    sin(vertexAnim.time * vertexAnim.windSpeed),\r\n    cos(vertexAnim.time * vertexAnim.windSpeed * 0.7)\r\n  ) * vertexAnim.windStrength;\r\n  \r\n  let turbulence = noise(vec2f(pos.x, pos.z) * 0.5 + vertexAnim.time * 0.3) \r\n                   * vertexAnim.windTurbulence;\r\n  \r\n  return vec3f(\r\n    pos.x + windDir.x * heightFactor * (1.0 + turbulence),\r\n    pos.y,\r\n    pos.z + windDir.y * heightFactor * (1.0 + turbulence)\r\n  );\r\n}\r\n\r\n// Pulse animation\r\nfn applyPulse(pos: vec3f) -> vec3f {\r\n  let pulse = sin(vertexAnim.time * vertexAnim.pulseSpeed) * vertexAnim.pulseAmount;\r\n  let scale = 1.0 + pulse;\r\n  \r\n  let center = vec3f(vertexAnim.pulseCenterX, 0.0, vertexAnim.pulseCenterY);\r\n  return center + (pos - center) * scale;\r\n}\r\n\r\n// Twist animation\r\nfn applyTwist(pos: vec3f) -> vec3f {\r\n  let angle = pos.y * vertexAnim.twistAmount * sin(vertexAnim.time * vertexAnim.twistSpeed);\r\n  \r\n  let cosA = cos(angle);\r\n  let sinA = sin(angle);\r\n  \r\n  return vec3f(\r\n    pos.x * cosA - pos.z * sinA,\r\n    pos.y,\r\n    pos.x * sinA + pos.z * cosA\r\n  );\r\n}\r\n\r\n// Noise displacement\r\nfn applyNoiseDisplacement(pos: vec3f) -> vec3f {\r\n  let noiseVal = noise(vec2f(pos.x, pos.z) * vertexAnim.noiseScale \r\n                      + vertexAnim.time * vertexAnim.noiseSpeed);\r\n  let displacement = (noiseVal - 0.5) * vertexAnim.noiseStrength;\r\n  return vec3f(pos.x, pos.y + displacement, pos.z);\r\n}\r\n\r\n// Ocean waves\r\nfn applyOcean(pos: vec3f) -> vec3f {\r\n  let t = vertexAnim.time * vertexAnim.oceanWaveSpeed;\r\n  let scale = vertexAnim.oceanWaveScale;\r\n  \r\n  let wave1 = sin(dot(pos.xz, vec2f(1.0, 0.0)) * scale + t) * vertexAnim.oceanWaveHeight;\r\n  let wave2 = sin(dot(pos.xz, vec2f(0.7, 0.7)) * scale * 1.2 + t * 1.3) * vertexAnim.oceanWaveHeight * 0.7;\r\n  let wave3 = sin(dot(pos.xz, vec2f(0.0, 1.0)) * scale * 0.8 + t * 0.9) * vertexAnim.oceanWaveHeight * 0.5;\r\n  \r\n  return vec3f(pos.x, pos.y + wave1 + wave2 + wave3, pos.z);\r\n}\r\n\r\n// Combined vertex animation\r\nfn applyVertexAnimation(pos: vec3f, normal: vec3f) -> SkinResult {\r\n  var animatedPos = pos;\r\n  var animatedNorm = normal;\r\n  \r\n  let flags = u32(vertexAnim.flags);\r\n  \r\n  // Apply effects in order\r\n  if ((flags & ANIM_WAVE) != 0u) {\r\n    animatedPos = applyWave(animatedPos);\r\n  }\r\n  \r\n  if ((flags & ANIM_WIND) != 0u) {\r\n    animatedPos = applyWind(animatedPos, animatedNorm);\r\n  }\r\n  \r\n  if ((flags & ANIM_NOISE) != 0u) {\r\n    animatedPos = applyNoiseDisplacement(animatedPos);\r\n  }\r\n  \r\n  if ((flags & ANIM_OCEAN) != 0u) {\r\n    animatedPos = applyOcean(animatedPos);\r\n  }\r\n  \r\n  if ((flags & ANIM_PULSE) != 0u) {\r\n    animatedPos = applyPulse(animatedPos);\r\n  }\r\n  \r\n  if ((flags & ANIM_TWIST) != 0u) {\r\n    animatedPos = applyTwist(animatedPos);\r\n  }\r\n  \r\n  // Apply global intensity\r\n  animatedPos = mix(pos, animatedPos, vertexAnim.globalIntensity);\r\n  \r\n  // For shadows, we can skip expensive normal recalculation\r\n  // Shadows don't need perfect normals\r\n  \r\n  return SkinResult(vec4f(animatedPos, 1.0), animatedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @location(1) normal: vec3f,\r\n  @location(2) uv: vec2f,\r\n  @location(3) joints: vec4<u32>,\r\n  @location(4) weights: vec4<f32>\r\n) -> @builtin(position) vec4f {\r\n  var pos = vec4(position, 1.0);\r\n  var nrm = normal;\r\n  \r\n  // Apply skinning\r\n  let skinned = skinVertex(pos, nrm, joints, weights);\r\n  var finalPos = skinned.position.xyz;\r\n  \r\n  // Apply vertex animation if any flags are set\r\n  if (u32(vertexAnim.flags) != 0u && vertexAnim.globalIntensity > 0.0) {\r\n    let animated = applyVertexAnimation(finalPos, skinned.normal);\r\n    finalPos = animated.position.xyz;\r\n  }\r\n  \r\n  let worldPos = model.modelMatrix * vec4f(finalPos, 1.0);\r\n  return scene.lightViewProjMatrix * worldPos;\r\n}\r\n`;", "import {OSCILLATOR} from \"./utils\";\r\n\r\n/**\r\n * @description\r\n * Can be reuse for any other tasks.\r\n * @author Nikola Lukic\r\n */\r\n\r\nexport default class Behavior {\r\n\r\n  status = \"Only oscillator\";\r\n\r\n  constructor() {\r\n    this.osc0 = new OSCILLATOR(0, 5, 0.01);\r\n  }\r\n\r\n  setOsc0(min,max, step){\r\n    this.osc0.min =min;\r\n    this.osc0.max =max;\r\n    this.osc0.step =step;\r\n  }\r\n\r\n  // apend - keep init origin\r\n  addPath(NUMBER) {\r\n    let inc = this.osc0.UPDATE();\r\n     console.log('test inc' ,inc)\r\n    console.log('test inc + number' ,(NUMBER + inc))\r\n    return (inc + NUMBER);\r\n  }\r\n\r\n  setPath0() {\r\n    return this.osc0.UPDATE();\r\n  }\r\n\r\n}", "export let vertexShadowWGSLInstanced =  `struct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\n// keep it for switch on end\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct InstanceData {\r\n  model : mat4x4<f32>,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n// @group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(0) var<storage, read> instances : array<InstanceData>;\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @builtin(instance_index) instId: u32\r\n) -> @builtin(position) vec4f {\r\n   let worldPos = instances[instId].model * vec4(position, 1.0);\r\n  return scene.lightViewProjMatrix * worldPos;\r\n  // return scene.lightViewProjMatrix * model.modelMatrix * vec4(position, 1);\r\n}\r\n`;", "import {mat4, vec3} from 'wgpu-matrix';\r\nimport {vertexShadowWGSL} from '../shaders/vertexShadow.wgsl';\r\nimport Behavior from './behavior';\r\nimport {vertexShadowWGSLInstanced} from '../shaders/instanced/vertexShadow.instanced.wgsl';\r\n/**\r\n * @description\r\n * Spot light with shadow cast.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n */\r\nexport class SpotLight {\r\n  name;\r\n  camera;\r\n  inputHandler;\r\n\r\n  position;\r\n  target;\r\n  up;\r\n  direction;\r\n\r\n  viewMatrix;\r\n  projectionMatrix;\r\n  viewProjMatrix;\r\n\r\n  fov;\r\n  aspect;\r\n  near;\r\n  far;\r\n\r\n  innerCutoff;\r\n  outerCutoff;\r\n\r\n  spotlightUniformBuffer;\r\n\r\n  constructor(\r\n    camera,\r\n    inputHandler,\r\n    device,\r\n    indexx,\r\n    position = vec3.create(0, 10, -20),\r\n    target = vec3.create(0, 0, -20),\r\n    fov = 45, aspect = 1.0, near = 0.1, far = 200) {\r\n\r\n    aspect = 1; // hot fix\r\n    this.name = \"light\" + indexx;\r\n    this.getName = () => {return \"light\" + indexx};\r\n    this.fov = fov;\r\n    this.aspect = 1;\r\n    this.near = near;\r\n    this.far = far;\r\n\r\n    this.camera = camera;\r\n    this.inputHandler = inputHandler;\r\n    this.position = position;\r\n    this.target = target;\r\n    this.up = vec3.create(0, 0, -1);\r\n    this.direction = vec3.normalize(vec3.subtract(target, position));\r\n    this.intensity = 1.0;\r\n    this.color = vec3.create(1.0, 1.0, 1.0);\r\n\r\n    this.viewMatrix = mat4.lookAt(position, target, this.up);\r\n    this.projectionMatrix = mat4.perspective(\r\n      (this.fov * Math.PI) / 180,\r\n      this.aspect,\r\n      this.near,\r\n      this.far\r\n    );\r\n\r\n    this.setProjection = function(fov = (2 * Math.PI) / 5, aspect = 1.0, near = 0.1, far = 200) {\r\n      this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n    }\r\n\r\n    this.updateProjection = function() {\r\n      this.projectionMatrix = mat4.perspective(this.fov, this.aspect, this.near, this.far);\r\n    }\r\n\r\n    this.device = device;\r\n    this.viewProjMatrix = mat4.multiply(this.projectionMatrix, this.viewMatrix);\r\n\r\n    this.fov = fov;\r\n    this.aspect = aspect;\r\n    this.near = near;\r\n    this.far = far;\r\n\r\n    this.innerCutoff = Math.cos((Math.PI / 180) * 20.0);\r\n    this.outerCutoff = Math.cos((Math.PI / 180) * 30.0);\r\n\r\n    this.ambientFactor = 0.5;\r\n    this.range = 20.0;\r\n    this.shadowBias = 0.01;\r\n\r\n    this.SHADOW_RES = 1024;\r\n    this.primitive = {\r\n      topology: 'triangle-list',\r\n      cullMode: 'back', // for front interest border drawen shadows !\r\n      frontFace: 'ccw'\r\n    }\r\n\r\n    this.shadowTexture = this.device.createTexture({\r\n      label: 'shadowTexture[light]',\r\n      size: [this.SHADOW_RES, this.SHADOW_RES, 1],\r\n      format: \"depth32float\",\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n\r\n    this.shadowSampler = device.createSampler({\r\n      label: 'shadowSampler[light]',\r\n      compare: 'less',\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n\r\n    this.renderPassDescriptor = {\r\n      label: \"descriptor shadowPass[SpotLigth]\",\r\n      colorAttachments: [],\r\n      depthStencilAttachment: {\r\n        view: this.shadowTexture.createView(),\r\n        depthClearValue: 1.0,\r\n        depthLoadOp: \"clear\",\r\n        depthStoreOp: \"store\",\r\n      },\r\n    }\r\n\r\n    this.uniformBufferBindGroupLayout = this.device.createBindGroupLayout({\r\n      label: 'uniformBufferBindGroupLayout light',\r\n      entries: [\r\n        {\r\n          binding: 0,\r\n          visibility: GPUShaderStage.VERTEX,\r\n          buffer: {\r\n            type: 'uniform',\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    this.shadowBindGroupContainer = [];\r\n    this.shadowBindGroup = [];\r\n\r\n    this.getShadowBindGroup = (mesh, index) => {\r\n\r\n      if(this.shadowBindGroupContainer[index]) {\r\n        return this.shadowBindGroupContainer[index];\r\n      }\r\n\r\n      this.shadowBindGroupContainer[index] = this.device.createBindGroup({\r\n        label: 'sceneBindGroupForShadow light',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            resource: {\r\n              buffer: mesh.sceneUniformBuffer,\r\n            },\r\n          },\r\n        ],\r\n      });\r\n      return this.shadowBindGroupContainer[index];\r\n    }\r\n\r\n    this.getShadowBindGroup_bones = (index) => {\r\n      if(this.shadowBindGroup[index]) return this.shadowBindGroup[index];\r\n\r\n      this.modelUniformBuffer = this.device.createBuffer({\r\n        size: 4 * 16, // 4x4 matrix\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.shadowBindGroup[index] = this.device.createBindGroup({\r\n        label: 'model BindGroupForShadow in light',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            resource: {\r\n              buffer: this.modelUniformBuffer,\r\n            },\r\n          },\r\n        ],\r\n      });\r\n      return this.shadowBindGroup[index];\r\n    }\r\n\r\n    this.modelBindGroupLayout = this.device.createBindGroupLayout({\r\n      label: 'modelBindGroupLayout light [one bindings]',\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}},\r\n        {binding: 2, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}}\r\n      ]\r\n    });\r\n\r\n    this.modelBindGroupLayoutInstanced = this.device.createBindGroupLayout({\r\n      label: 'modelBindGroupLayout light [skinned][instanced]',\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}},\r\n        {binding: 2, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}}\r\n      ],\r\n    });\r\n\r\n    this.shadowPipeline = this.device.createRenderPipeline({\r\n      label: 'shadowPipeline light',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'uniformBufferBindGroupLayout light[regular]',\r\n        bindGroupLayouts: [\r\n          this.uniformBufferBindGroupLayout,\r\n          this.modelBindGroupLayout,\r\n        ],\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({\r\n          code: vertexShadowWGSL,\r\n        }),\r\n        buffers: [\r\n          {\r\n            arrayStride: 12,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 0,\r\n                offset: 0,\r\n                format: \"float32x3\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(1) - normal\r\n          {\r\n            arrayStride: 12,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 1,\r\n                offset: 0,\r\n                format: \"float32x3\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(2) - uv\r\n          {\r\n            arrayStride: 8,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 2,\r\n                offset: 0,\r\n                format: \"float32x2\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(3) - joints\r\n          {\r\n            arrayStride: 16,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 3,\r\n                offset: 0,\r\n                format: \"uint32x4\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(4) - weights\r\n          {\r\n            arrayStride: 16,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 4,\r\n                offset: 0,\r\n                format: \"float32x4\",\r\n              },\r\n            ],\r\n          },\r\n        ]\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth32float',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n\r\n    this.shadowPipelineInstanced = this.device.createRenderPipeline({\r\n      label: 'shadowPipeline [instanced]light',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'uniformBufferBindGroupLayout light[instanced]',\r\n        bindGroupLayouts: [\r\n          this.uniformBufferBindGroupLayout,\r\n          this.modelBindGroupLayoutInstanced,\r\n        ],\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({\r\n          code: vertexShadowWGSLInstanced,\r\n        }),\r\n        buffers: [\r\n          {\r\n            arrayStride: 12, // 3 * 4 bytes (vec3f)\r\n            attributes: [\r\n              {\r\n                shaderLocation: 0, // must match @location(0) in vertex shader\r\n                offset: 0,\r\n                format: \"float32x3\",\r\n              },\r\n            ],\r\n          },\r\n           // \u2705 ADD @location(1) - normal\r\n          {\r\n            arrayStride: 12,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 1,\r\n                offset: 0,\r\n                format: \"float32x3\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(2) - uv\r\n          {\r\n            arrayStride: 8,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 2,\r\n                offset: 0,\r\n                format: \"float32x2\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(3) - joints\r\n          {\r\n            arrayStride: 16,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 3,\r\n                offset: 0,\r\n                format: \"uint32x4\",\r\n              },\r\n            ],\r\n          },\r\n          // \u2705 ADD @location(4) - weights\r\n          {\r\n            arrayStride: 16,\r\n            attributes: [\r\n              {\r\n                shaderLocation: 4,\r\n                offset: 0,\r\n                format: \"float32x4\",\r\n              },\r\n            ],\r\n          },\r\n        ]\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        depthBias: 2,              // Constant bias (try 1-4)\r\n        depthBiasSlopeScale: 2.0,\r\n        format: 'depth32float',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n\r\n    this.getMainPassBindGroup = function(mesh) {\r\n      // You can cache it per mesh to avoid recreating each frame\r\n      if(!this.mainPassBindGroupContainer) this.mainPassBindGroupContainer = [];\r\n      const index = mesh._lightBindGroupIndex || 0;\r\n      if(this.mainPassBindGroupContainer[index]) {\r\n        return this.mainPassBindGroupContainer[index];\r\n      }\r\n      this.mainPassBindGroupContainer[index] = this.device.createBindGroup({\r\n        label: `mainPassBindGroup for mesh`,\r\n        layout: mesh.mainPassBindGroupLayout,\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            resource: this.shadowTexture.createView(),\r\n          },\r\n          {\r\n            binding: 1,\r\n            resource: this.shadowSampler,\r\n          },\r\n        ],\r\n      });\r\n      return this.mainPassBindGroupContainer[index];\r\n    }\r\n\r\n    // Only osc values +-\r\n    this.behavior = new Behavior();\r\n\r\n    // put here only func\r\n    this.updater = [];\r\n  }\r\n\r\n  update() {\r\n    this.updater.forEach((update) => {update(this)})\r\n    this.direction = vec3.normalize(vec3.subtract(this.target, this.position));\r\n    const target = vec3.add(this.position, this.direction);\r\n    this.viewMatrix = mat4.lookAt(this.position, target, this.up);\r\n    this.viewProjMatrix = mat4.multiply(this.projectionMatrix, this.viewMatrix);\r\n  }\r\n\r\n  getLightDataBuffer() {\r\n    const m = this.viewProjMatrix;\r\n    return new Float32Array([\r\n      ...this.position, 0.0,\r\n      ...this.direction, 0.0,\r\n      this.innerCutoff,\r\n      this.outerCutoff,\r\n      this.intensity,\r\n      0.0,\r\n      ...this.color,\r\n      0.0,\r\n      this.range,\r\n      this.ambientFactor,\r\n      this.shadowBias,\r\n      0.0,\r\n      ...m\r\n    ]);\r\n  }\r\n\r\n  // Setters\r\n  setPosX = (x) => {\r\n    this.position[0] = x;\r\n  }\r\n  setPosY = (y) => {\r\n    this.position[1] = y;\r\n  }\r\n  setPosZ = (z) => {\r\n    this.position[2] = z;\r\n  }\r\n  setInnerCutoff = (innerCutoff) => {\r\n    this.innerCutoff = innerCutoff;\r\n  }\r\n  setOuterCutoff = (outerCutoff) => {\r\n    this.outerCutoff = outerCutoff;\r\n  }\r\n  setIntensity = (intensity) => {\r\n    this.intensity = intensity;\r\n  }\r\n  setColor = (color) => {\r\n    this.color = color;\r\n  }\r\n  setColorR = (colorR) => {\r\n    this.color[0] = colorR;\r\n  }\r\n  setColorB = (colorB) => {\r\n    this.color[1] = colorB;\r\n  }\r\n  setColorG = (colorG) => {\r\n    this.color[2] = colorG;\r\n  }\r\n  setRange = (range) => {\r\n    this.range = range;\r\n  }\r\n  setAmbientFactor = (ambientFactor) => {\r\n    this.ambientFactor = ambientFactor;\r\n  }\r\n  setShadowBias = (shadowBias) => {\r\n    this.shadowBias = shadowBias;\r\n  }\r\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nexport let EPSILON = 0.000001;\n\n/**\n * Set the value for EPSILON for various checks\n * @param v - Value to use for EPSILON.\n * @returns previous value of EPSILON;\n */\nexport function setEpsilon(v: number): number {\n  const old = EPSILON;\n  EPSILON = v;\n  return old;\n}\n\n/**\n * Convert degrees to radians\n * @param degrees - Angle in degrees\n * @returns angle converted to radians\n */\nexport function degToRad(degrees: number): number {\n  return degrees * Math.PI / 180;\n}\n\n/**\n * Convert radians to degrees\n * @param radians - Angle in radians\n * @returns angle converted to degrees\n */\nexport function radToDeg(radians: number): number {\n  return radians * 180 / Math.PI;\n}\n\n/**\n * Lerps between a and b via t\n * @param a - starting value\n * @param b - ending value\n * @param t - value where 0 = a and 1 = b\n * @returns a + (b - a) * t\n */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/**\n * Compute the opposite of lerp. Given a and b and a value between\n * a and b returns a value between 0 and 1. 0 if a, 1 if b.\n * Note: no clamping is done.\n * @param a - start value\n * @param b - end value\n * @param v - value between a and b\n * @returns (v - a) / (b - a)\n */\nexport function inverseLerp(a: number, b: number, v: number): number {\n  const d = b - a;\n  return (Math.abs(b - a) < EPSILON)\n     ? a\n     : (v - a) / d;\n}\n\n/**\n * Compute the euclidean modulo\n *\n * ```\n * // table for n / 3\n * -5, -4, -3, -2, -1,  0,  1,  2,  3,  4,  5   <- n\n * ------------------------------------\n * -2  -1  -0  -2  -1   0,  1,  2,  0,  1,  2   <- n % 3\n *  1   2   0   1   2   0,  1,  2,  0,  1,  2   <- euclideanModule(n, 3)\n * ```\n *\n * @param n - dividend\n * @param m - divisor\n * @returns the euclidean modulo of n / m\n */\nexport function euclideanModulo(n: number, m: number) {\n  return ((n % m) + m) % m;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport { ArrayLike } from './array-like';\n\n/**\n * A JavaScript array with 2 values, Float32Array with 2 values, or a Float64Array with 2 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec2.setDefaultType}.\n */\nexport type Vec2 = ArrayLike;\n\n/**\n *\n * Vec2 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new Vec2. In other words you can do this\n *\n *     const v = vec2.cross(v1, v2);  // Creates a new Vec2 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec2.create();\n *     vec2.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec2.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec2 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec2\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Vec2\n */\nexport function setDefaultType(ctor: new (n: number) => Vec2) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values.\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Vec2's specified type\n * it would be faster to use\n *\n * ```\n * const v = vec2.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Vec2Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `vec2.create` is usually used\n * to create a Vec2 to be filled out as in\n *\n * ```\n * const sum = vec2.create();\n * vec2.add(v1, v2, sum);\n * ```\n *\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport function create(x = 0, y = 0): Vec2 {\n  const dst = new VecType(2);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n    }\n  }\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Vec2, create, setDefaultType, VecType } from './vec2';\n\nexport default Vec2;\nexport { create, setDefaultType };\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec2, min = 0, max = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec2, b: Vec2, scale: number, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec2, b: Vec2): number {\n  const ax = a[0];\n  const ay = a[1];\n  const bx = a[0];\n  const by = a[1];\n  const mag1 = Math.sqrt(ax * ax + ay * ay);\n  const mag2 = Math.sqrt(bx * bx + by * by);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec2, b: Vec2): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec2, b: Vec2): boolean {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec2, b: Vec2, t: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec2, b: Vec2, t: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(3);\n  const z = a[0] * b[1] - a[1] * b[0];\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = z;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec2, b: Vec2): number {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return Math.sqrt(v0 * v0 + v1 * v1);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return v0 * v0 + v1 * v1;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return dx * dx + dy * dy;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const len = Math.sqrt(v0 * v0 + v1 * v1);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as clone)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as copy)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec2, b: Vec2, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random unit vector * scale\n * @param scale - Default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const angle = Math.random() * 2 * Math.PI;\n  dst[0] = Math.cos(angle) * scale;\n  dst[1] = Math.sin(angle) * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 0;\n  dst[1] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform Vec2 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec2, m: Mat4, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = x * m[0] + y * m[4] + m[12];\n  dst[1] = x * m[1] + y * m[5] + m[13];\n\n  return dst;\n}\n\n/**\n * Transforms vec4 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec2, m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = m[0] * x + m[4] * y + m[8];\n  dst[1] = m[1] * x + m[5] * y + m[9];\n\n  return dst;\n}\n\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport { ArrayLikeCtor } from './array-like';\nimport * as utils from './utils.js';\nimport { Mat3 } from './mat3';\nimport Vec2, * as vec2 from './vec2-impl';\n\nexport default Mat3;\n\n/**\n * 3x3 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat3.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat3.create();\n *     mat3.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat3.identity();\n *     const trans = mat3.translation([1, 2, 3]);\n *     mat3.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: ArrayLikeCtor = Float32Array;\n\n// This mess is because with Mat3 we have 3 unused elements.\n// For Float32Array and Float64Array that's not an issue\n// but for Array it's troublesome\nconst ctorMap = new Map<ArrayLikeCtor,() => Mat3>([\n  [Float32Array, () => new Float32Array(12)],\n  [Float64Array, () => new Float64Array(12)],\n  [Array, () => new Array(12).fill(0)],\n]);\nlet newMat3: () => Mat3 = ctorMap.get(Float32Array)!;\n\n/**\n * Sets the type this library creates for a Mat3\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Mat3\n */\nexport function setDefaultType(ctor: new (n: number) => Mat3) {\n  const oldType = MatType;\n  MatType = ctor;\n  newMat3 = ctorMap.get(ctor)!;\n  return oldType;\n}\n\n/**\n * Create a Mat3 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat3's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat3.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat3Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat3.create` is usually used\n * to create a Mat3 to be filled out as in\n *\n * ```\n * const m = mat3.create();\n * mat3.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @returns matrix created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number,\n    v3?: number, v4?: number, v5?: number,\n    v6?: number, v7?: number, v8?: number): Mat3 {\n  const dst = newMat3();\n  // to make the array homogenous\n  dst[3] = 0;\n  dst[7] = 0;\n  dst[11] = 0;\n\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[4] = v3;\n          if (v4 !== undefined) {\n            dst[5] = v4;\n            if (v5 !== undefined) {\n              dst[6] = v5;\n              if (v6 !== undefined) {\n                dst[8] = v6;\n                if (v7 !== undefined) {\n                  dst[9] = v7;\n                  if (v8 !== undefined) {\n                    dst[10] = v8;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = -m[ 0];\n  dst[ 1] = -m[ 1];\n  dst[ 2] = -m[ 2];\n  dst[ 4] = -m[ 4];\n  dst[ 5] = -m[ 5];\n  dst[ 6] = -m[ 6];\n  dst[ 8] = -m[ 8];\n  dst[ 9] = -m[ 9];\n  dst[10] = -m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix.\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = m[ 0];\n  dst[ 1] = m[ 1];\n  dst[ 2] = m[ 2];\n\n  dst[ 4] = m[ 4];\n  dst[ 5] = m[ 5];\n  dst[ 6] = m[ 6];\n\n  dst[ 8] = m[ 8];\n  dst[ 9] = m[ 9];\n  dst[10] = m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as copy)\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat3, b: Mat3): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat3, b: Mat3): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10];\n}\n\n/**\n * Creates a 3-by-3 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 3-by-3 identity matrix.\n */\nexport function identity(dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n  if (dst === m) {\n    let t: number;\n\n    // 0 1 2\n    // 4 5 6\n    // 8 9 10\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  dst[ 0] = m00;\n  dst[ 1] = m10;\n  dst[ 2] = m20;\n  dst[ 4] = m01;\n  dst[ 5] = m11;\n  dst[ 6] = m21;\n  dst[ 8] = m02;\n  dst[ 9] = m12;\n  dst[10] = m22;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  const m11_x_m22 = m11 * m22;\n  const m21_x_m12 = m21 * m12;\n  const m01_x_m22 = m01 * m22;\n  const m21_x_m02 = m21 * m02;\n  const m01_x_m12 = m01 * m12;\n  const m11_x_m02 = m11 * m02;\n\n  const invDet = 1 / (\n      m00 * (m11_x_m22 - m21_x_m12) -\n      m10 * (m01_x_m22 - m21_x_m02) +\n      m20 * (m01_x_m12 - m11_x_m02));\n\n  dst[ 0] = +(m11_x_m22 - m21_x_m12) * invDet;\n  dst[ 1] = -(m10 * m22 - m20 * m12) * invDet;\n  dst[ 2] = +(m10 * m21 - m20 * m11) * invDet;\n  dst[ 4] = -(m01_x_m22 - m21_x_m02) * invDet;\n  dst[ 5] = +(m00 * m22 - m20 * m02) * invDet;\n  dst[ 6] = -(m00 * m21 - m20 * m01) * invDet;\n  dst[ 8] = +(m01_x_m12 - m11_x_m02) * invDet;\n  dst[ 9] = -(m00 * m12 - m10 * m02) * invDet;\n  dst[10] = +(m00 * m11 - m10 * m01) * invDet;\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat3): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  return m00 * (m11 * m22 - m21 * m12) -\n         m10 * (m01 * m22 - m21 * m02) +\n         m20 * (m01 * m12 - m11 * m02);\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat3, b: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22;\n\n  return dst;\n}\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 3-by-3 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n  }\n  dst[ 8] = v[0];\n  dst[ 9] = v[1];\n  dst[10] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 3-by-3 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  dst[0] = m[8];\n  dst[1] = m[9];\n  return dst;\n}\n\n/**\n * Returns an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y,\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat3, axis: number, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  return dst;\n}\n\n/**\n * Sets an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(m: Mat3, v: Vec2, axis: number, dst?: Mat3): Mat3 {\n  if (dst !== m) {\n    dst = copy(m, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const yx = m[4];\n  const yy = m[5];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy);\n  dst[1] = Math.sqrt(yx * yx + yy * yy);\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which translates by the given vector v.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 8] = v[0];\n  dst[ 9] = v[1];\n  dst[10] = 1;\n  return dst;\n}\n\n/**\n * Translates the given 3-by-3 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n  }\n\n  dst[ 8] = m00 * v0 + m10 * v1 + m20;\n  dst[ 9] = m01 * v0 + m11 * v1 + m21;\n  dst[10] = m02 * v0 + m12 * v1 + m22;\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which rotates  by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotation(angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;\n  dst[ 1] = s;\n  dst[ 2] = 0;\n  dst[ 4] = -s;\n  dst[ 5] = c;\n  dst[ 6] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 3-by-3 matrix  by the given angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotate(m: Mat3, angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     2 entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = v[0];\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = v[1];\n  dst[ 6] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 3-by-3 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of 2 entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport { ArrayLike } from './array-like';\n\n/**\n * A JavaScript array with 3 values, Float32Array with 3 values, or a Float64Array with 3 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec3.setDefaultType}.\n */\nexport type Vec3 = ArrayLike;\n\n/**\n *\n * Vec3 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec3`. In other words you can do this\n *\n *     const v = vec3.cross(v1, v2);  // Creates a new Vec3 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec3.create();\n *     vec3.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec3.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec3 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec3\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Vec3\n */\nexport function setDefaultType(ctor: new (n: number) => Vec3) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number) {\n  const dst = new VecType(3);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Vec3, create, setDefaultType, VecType } from './vec3';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\n\nexport default Vec3;\nexport { create, setDefaultType };\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec3, min = 0, max = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec3, b: Vec3, scale: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec3, b: Vec3): number {\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const bx = a[0];\n  const by = a[1];\n  const bz = a[2];\n  const mag1 = Math.sqrt(ax * ax + ay * ay + az * az);\n  const mag2 = Math.sqrt(bx * bx + by * by + bz * bz);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec3, b: Vec3): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec3, b: Vec3): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec3, b: Vec3, t: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec3, b: Vec3, t: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const t1 = a[2] * b[0] - a[0] * b[2];\n  const t2 = a[0] * b[1] - a[1] * b[0];\n  dst[0] = a[1] * b[2] - a[2] * b[1];\n  dst[1] = t1;\n  dst[2] = t2;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec3, b: Vec3): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return v0 * v0 + v1 * v1 + v2 * v2;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return dx * dx + dy * dy + dz * dz;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n  }\n\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as clone)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as copy)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random vector\n * @param scale - Default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const angle = Math.random() * 2 * Math.PI;\n  const z = Math.random() * 2 - 1;\n  const zScale = Math.sqrt(1 - z * z) * scale;\n  dst[0] = Math.cos(angle) * zScale;\n  dst[1] = Math.sin(angle) * zScale;\n  dst[2] = z * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec3 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = (m[3] * x + m[7] * y + m[11] * z + m[15]) || 1;\n\n  dst[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  dst[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  dst[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n\n  return dst;\n}\n\n/**\n * Transform vec4 by upper 3x3 matrix inside 4x4 matrix.\n * @param v - The direction.\n * @param m - The matrix.\n * @param dst - optional Vec3 to store result. If not passed a new one is created.\n * @returns The transformed vector.\n */\nexport function transformMat4Upper3x3(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[0] = v0 * m[0 * 4 + 0] + v1 * m[1 * 4 + 0] + v2 * m[2 * 4 + 0];\n  dst[1] = v0 * m[0 * 4 + 1] + v1 * m[1 * 4 + 1] + v2 * m[2 * 4 + 1];\n  dst[2] = v0 * m[0 * 4 + 2] + v1 * m[1 * 4 + 2] + v2 * m[2 * 4 + 2];\n\n  return dst;\n}\n\n/**\n * Transforms vec4 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec3, m: Mat3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n\n  dst[0] = x * m[0] + y * m[4] + z * m[8];\n  dst[1] = x * m[1] + y * m[5] + z * m[9];\n  dst[2] = x * m[2] + y * m[6] + z * m[10];\n\n  return dst;\n}\n\n", "\nimport { ArrayLikeCtor } from './array-like';\nimport { Mat4 } from './mat4';\nimport Vec3, * as vec3 from './vec3-impl';\nimport * as utils from './utils';\n\nexport default Mat4;\n\n/**\n * 4x4 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat4.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat4.create();\n *     mat4.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat4.identity();\n *     const trans = mat4.translation([1, 2, 3]);\n *     mat4.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: ArrayLikeCtor = Float32Array;\n\n/**\n * Sets the type this library creates for a Mat4\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Mat4\n */\nexport function setDefaultType(ctor: new (n: number) => Mat4) {\n  const oldType = MatType;\n  MatType = ctor;\n  return oldType;\n}\n\n/**\n * Create a Mat4 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat4's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat4.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat4Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat4.create` is usually used\n * to create a Mat4 to be filled out as in\n *\n * ```\n * const m = mat4.create();\n * mat4.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param v9 - value for element 9\n * @param v10 - value for element 10\n * @param v11 - value for element 11\n * @param v12 - value for element 12\n * @param v13 - value for element 13\n * @param v14 - value for element 14\n * @param v15 - value for element 15\n * @returns created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number, v3?: number,\n    v4?: number, v5?: number, v6?: number, v7?: number,\n    v8?: number, v9?: number, v10?: number, v11?: number,\n    v12?: number, v13?: number, v14?: number, v15?: number): Mat4 {\n  const dst = new MatType(16);\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[3] = v3;\n          if (v4 !== undefined) {\n            dst[4] = v4;\n            if (v5 !== undefined) {\n              dst[5] = v5;\n              if (v6 !== undefined) {\n                dst[6] = v6;\n                if (v7 !== undefined) {\n                  dst[7] = v7;\n                  if (v8 !== undefined) {\n                    dst[8] = v8;\n                    if (v9 !== undefined) {\n                      dst[9] = v9;\n                      if (v10 !== undefined) {\n                        dst[10] = v10;\n                        if (v11 !== undefined) {\n                          dst[11] = v11;\n                          if (v12 !== undefined) {\n                            dst[12] = v12;\n                            if (v13 !== undefined) {\n                              dst[13] = v13;\n                              if (v14 !== undefined) {\n                                dst[14] = v14;\n                                if (v15 !== undefined) {\n                                  dst[15] = v15;\n                                }\n                              }\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = -m[ 0];\n  dst[ 1] = -m[ 1];\n  dst[ 2] = -m[ 2];\n  dst[ 3] = -m[ 3];\n  dst[ 4] = -m[ 4];\n  dst[ 5] = -m[ 5];\n  dst[ 6] = -m[ 6];\n  dst[ 7] = -m[ 7];\n  dst[ 8] = -m[ 8];\n  dst[ 9] = -m[ 9];\n  dst[10] = -m[10];\n  dst[11] = -m[11];\n  dst[12] = -m[12];\n  dst[13] = -m[13];\n  dst[14] = -m[14];\n  dst[15] = -m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix.\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = m[ 0];\n  dst[ 1] = m[ 1];\n  dst[ 2] = m[ 2];\n  dst[ 3] = m[ 3];\n  dst[ 4] = m[ 4];\n  dst[ 5] = m[ 5];\n  dst[ 6] = m[ 6];\n  dst[ 7] = m[ 7];\n  dst[ 8] = m[ 8];\n  dst[ 9] = m[ 9];\n  dst[10] = m[10];\n  dst[11] = m[11];\n  dst[12] = m[12];\n  dst[13] = m[13];\n  dst[14] = m[14];\n  dst[15] = m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as copy)\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat4, b: Mat4): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 3] - b[ 3]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 7] - b[ 7]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON &&\n         Math.abs(a[11] - b[11]) < utils.EPSILON &&\n         Math.abs(a[12] - b[12]) < utils.EPSILON &&\n         Math.abs(a[13] - b[13]) < utils.EPSILON &&\n         Math.abs(a[14] - b[14]) < utils.EPSILON &&\n         Math.abs(a[15] - b[15]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat4, b: Mat4): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 3] === b[ 3] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 7] === b[ 7] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10] &&\n         a[11] === b[11] &&\n         a[12] === b[12] &&\n         a[13] === b[13] &&\n         a[14] === b[14] &&\n         a[15] === b[15];\n}\n\n/**\n * Creates a 4-by-4 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 4-by-4 identity matrix.\n */\nexport function identity(dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n  if (dst === m) {\n    let t;\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[3];\n    m[3] = m[12];\n    m[12] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    t = m[7];\n    m[7] = m[13];\n    m[13] = t;\n\n    t = m[11];\n    m[11] = m[14];\n    m[14] = t;\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  dst[ 0] = m00;\n  dst[ 1] = m10;\n  dst[ 2] = m20;\n  dst[ 3] = m30;\n  dst[ 4] = m01;\n  dst[ 5] = m11;\n  dst[ 6] = m21;\n  dst[ 7] = m31;\n  dst[ 8] = m02;\n  dst[ 9] = m12;\n  dst[10] = m22;\n  dst[11] = m32;\n  dst[12] = m03;\n  dst[13] = m13;\n  dst[14] = m23;\n  dst[15] = m33;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n  const tmp12 = m20 * m31;\n  const tmp13 = m30 * m21;\n  const tmp14 = m10 * m31;\n  const tmp15 = m30 * m11;\n  const tmp16 = m10 * m21;\n  const tmp17 = m20 * m11;\n  const tmp18 = m00 * m31;\n  const tmp19 = m30 * m01;\n  const tmp20 = m00 * m21;\n  const tmp21 = m20 * m01;\n  const tmp22 = m00 * m11;\n  const tmp23 = m10 * m01;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n      (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n      (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n      (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n      (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  const d = 1 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\n\n  dst[ 0] = d * t0;\n  dst[ 1] = d * t1;\n  dst[ 2] = d * t2;\n  dst[ 3] = d * t3;\n  dst[ 4] = d * ((tmp1 * m10 + tmp2 * m20 + tmp5 * m30) -\n          (tmp0 * m10 + tmp3 * m20 + tmp4 * m30));\n  dst[ 5] = d * ((tmp0 * m00 + tmp7 * m20 + tmp8 * m30) -\n          (tmp1 * m00 + tmp6 * m20 + tmp9 * m30));\n  dst[ 6] = d * ((tmp3 * m00 + tmp6 * m10 + tmp11 * m30) -\n          (tmp2 * m00 + tmp7 * m10 + tmp10 * m30));\n  dst[ 7] = d * ((tmp4 * m00 + tmp9 * m10 + tmp10 * m20) -\n          (tmp5 * m00 + tmp8 * m10 + tmp11 * m20));\n  dst[ 8] = d * ((tmp12 * m13 + tmp15 * m23 + tmp16 * m33) -\n          (tmp13 * m13 + tmp14 * m23 + tmp17 * m33));\n  dst[ 9] = d * ((tmp13 * m03 + tmp18 * m23 + tmp21 * m33) -\n          (tmp12 * m03 + tmp19 * m23 + tmp20 * m33));\n  dst[10] = d * ((tmp14 * m03 + tmp19 * m13 + tmp22 * m33) -\n          (tmp15 * m03 + tmp18 * m13 + tmp23 * m33));\n  dst[11] = d * ((tmp17 * m03 + tmp20 * m13 + tmp23 * m23) -\n          (tmp16 * m03 + tmp21 * m13 + tmp22 * m23));\n  dst[12] = d * ((tmp14 * m22 + tmp17 * m32 + tmp13 * m12) -\n          (tmp16 * m32 + tmp12 * m12 + tmp15 * m22));\n  dst[13] = d * ((tmp20 * m32 + tmp12 * m02 + tmp19 * m22) -\n          (tmp18 * m22 + tmp21 * m32 + tmp13 * m02));\n  dst[14] = d * ((tmp18 * m12 + tmp23 * m32 + tmp15 * m02) -\n          (tmp22 * m32 + tmp14 * m02 + tmp19 * m12));\n  dst[15] = d * ((tmp22 * m22 + tmp16 * m02 + tmp21 * m12) -\n          (tmp20 * m12 + tmp23 * m22 + tmp17 * m02));\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat4): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n             (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n             (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n             (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n             (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  return m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat4, b: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a03 = a[3];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a13 = a[ 4 + 3];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const a23 = a[ 8 + 3];\n  const a30 = a[12 + 0];\n  const a31 = a[12 + 1];\n  const a32 = a[12 + 2];\n  const a33 = a[12 + 3];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b03 = b[3];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b13 = b[ 4 + 3];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n  const b23 = b[ 8 + 3];\n  const b30 = b[12 + 0];\n  const b31 = b[12 + 1];\n  const b32 = b[12 + 2];\n  const b33 = b[12 + 3];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02 + a30 * b03;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02 + a31 * b03;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02 + a32 * b03;\n  dst[ 3] = a03 * b00 + a13 * b01 + a23 * b02 + a33 * b03;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12 + a30 * b13;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12 + a31 * b13;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12 + a32 * b13;\n  dst[ 7] = a03 * b10 + a13 * b11 + a23 * b12 + a33 * b13;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22 + a30 * b23;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22 + a31 * b23;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22 + a32 * b23;\n  dst[11] = a03 * b20 + a13 * b21 + a23 * b22 + a33 * b23;\n  dst[12] = a00 * b30 + a10 * b31 + a20 * b32 + a30 * b33;\n  dst[13] = a01 * b30 + a11 * b31 + a21 * b32 + a31 * b33;\n  dst[14] = a02 * b30 + a12 * b31 + a22 * b32 + a32 * b33;\n  dst[15] = a03 * b30 + a13 * b31 + a23 * b32 + a33 * b33;\n\n  return dst;\n}\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 4-by-4 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 3] = a[ 3];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n    dst[ 7] = a[ 7];\n    dst[ 8] = a[ 8];\n    dst[ 9] = a[ 9];\n    dst[10] = a[10];\n    dst[11] = a[11];\n  }\n  dst[12] = v[0];\n  dst[13] = v[1];\n  dst[14] = v[2];\n  dst[15] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 4-by-4 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  dst[0] = m[12];\n  dst[1] = m[13];\n  dst[2] = m[14];\n  return dst;\n}\n\n/**\n * Returns an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y, 2 = z;\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat4, axis: number, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  dst[2] = m[off + 2];\n  return dst;\n}\n\n/**\n * Sets an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y, 2 = z;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(a: Mat4, v: Vec3, axis: number, dst: Mat4): Mat4 {\n  if (dst !== a) {\n    dst = copy(a, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  dst[off + 2] = v[2];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const xz = m[2];\n  const yx = m[4];\n  const yy = m[5];\n  const yz = m[6];\n  const zx = m[8];\n  const zy = m[9];\n  const zz = m[10];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy + xz * xz);\n  dst[1] = Math.sqrt(yx * yx + yy * yy + yz * yz);\n  dst[2] = Math.sqrt(zx * zx + zy * zy + zz * zz);\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the angular height\n * of the frustum, the aspect ratio, and the near and far clipping planes.  The\n * arguments define a frustum extending in the negative z direction.  The given\n * angle is the vertical angle of the frustum, and the horizontal angle is\n * determined to produce the given aspect ratio.  The arguments near and far are\n * the distances to the near and far clipping planes.  Note that near and far\n * are not z coordinates, but rather they are distances along the negative\n * z-axis.  The matrix generated sends the viewing frustum to the unit box.\n * We assume a unit box extending from -1 to 1 in the x and y dimensions and\n * from 0 to 1 in the z dimension.\n * @param fieldOfViewYInRadians - The camera angle from top to bottom (in radians).\n * @param aspect - The aspect ratio width / height.\n * @param zNear - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param zFar - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The perspective matrix.\n */\nexport function perspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewYInRadians);\n  const rangeInv = 1 / (zNear - zFar);\n\n  dst[0]  = f / aspect;\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = f;\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[10] = zFar * rangeInv;\n  dst[11] = -1;\n\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = zNear * zFar * rangeInv;\n  dst[15] = 0;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 orthogonal transformation matrix that transforms from\n * the given the left, right, bottom, and top dimensions to -1 +1 in x, and y\n * and 0 to +1 in z.\n * @param left - Left side of the near clipping plane viewport.\n * @param right - Right side of the near clipping plane viewport.\n * @param bottom - Bottom of the near clipping plane viewport.\n * @param top - Top of the near clipping plane viewport.\n * @param near - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param far - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The perspective matrix.\n */\nexport function ortho(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[0]  = 2 / (right - left);\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = 2 / (top - bottom);\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[10] = 1 / (near - far);\n  dst[11] = 0;\n\n  dst[12] = (right + left) / (left - right);\n  dst[13] = (top + bottom) / (bottom - top);\n  dst[14] = near / (near - far);\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the left, right,\n * top, bottom, near and far clipping planes. The arguments define a frustum\n * extending in the negative z direction. The arguments near and far are the\n * distances to the near and far clipping planes. Note that near and far are not\n * z coordinates, but rather they are distances along the negative z-axis. The\n * matrix generated sends the viewing frustum to the unit box. We assume a unit\n * box extending from -1 to 1 in the x and y dimensions and from 0 to 1 in the z\n * dimension.\n * @param left - The x coordinate of the left plane of the box.\n * @param right - The x coordinate of the right plane of the box.\n * @param bottom - The y coordinate of the bottom plane of the box.\n * @param top - The y coordinate of the right plane of the box.\n * @param near - The negative z coordinate of the near plane of the box.\n * @param far - The negative z coordinate of the far plane of the box.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The perspective projection matrix.\n */\nexport function frustum(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const dx = (right - left);\n  const dy = (top - bottom);\n  const dz = (near - far);\n\n  dst[ 0] = 2 * near / dx;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 2 * near / dy;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = (left + right) / dx;\n  dst[ 9] = (top + bottom) / dy;\n  dst[10] = far / dz;\n  dst[11] = -1;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = near * far / dz;\n  dst[15] = 0;\n\n  return dst;\n}\n\nlet xAxis: Vec3;\nlet yAxis: Vec3;\nlet zAxis: Vec3;\n\n/**\n * Computes a 4-by-4 look-at transformation.\n *\n * This is a matrix which positions the camera itself. If you want\n * a view matrix (a matrix which moves things in front of the camera)\n * take the inverse of this.\n *\n * @param eye - The position of the eye.\n * @param target - The position meant to be viewed.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The look-at matrix.\n */\nexport function lookAt(eye: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(\n      vec3.subtract(eye, target, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];\n  dst[ 1] = xAxis[1];\n  dst[ 2] = xAxis[2];\n  dst[ 3] = 0;\n  dst[ 4] = yAxis[0];\n  dst[ 5] = yAxis[1];\n  dst[ 6] = yAxis[2];\n  dst[ 7] = 0;\n  dst[ 8] = zAxis[0];\n  dst[ 9] = zAxis[1];\n  dst[10] = zAxis[2];\n  dst[11] = 0;\n  dst[12] = eye[0];\n  dst[13] = eye[1];\n  dst[14] = eye[2];\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which translates by the given vector v.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n  dst[11] = 0;\n  dst[12] = v[0];\n  dst[13] = v[1];\n  dst[14] = v[2];\n  dst[15] = 1;\n  return dst;\n}\n\n/**\n * Translates the given 4-by-4 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 3] = m03;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n    dst[ 7] = m13;\n    dst[ 8] = m20;\n    dst[ 9] = m21;\n    dst[10] = m22;\n    dst[11] = m23;\n  }\n\n  dst[12] = m00 * v0 + m10 * v1 + m20 * v2 + m30;\n  dst[13] = m01 * v0 + m11 * v1 + m21 * v2 + m31;\n  dst[14] = m02 * v0 + m12 * v1 + m22 * v2 + m32;\n  dst[15] = m03 * v0 + m13 * v1 + m23 * v2 + m33;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the x-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationX(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = c;\n  dst[ 6] = s;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = -s;\n  dst[10] = c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the x-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateX(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[4]  = c * m10 + s * m20;\n  dst[5]  = c * m11 + s * m21;\n  dst[6]  = c * m12 + s * m22;\n  dst[7]  = c * m13 + s * m23;\n  dst[8]  = c * m20 - s * m10;\n  dst[9]  = c * m21 - s * m11;\n  dst[10] = c * m22 - s * m12;\n  dst[11] = c * m23 - s * m13;\n\n  if (m !== dst) {\n    dst[ 0] = m[ 0];\n    dst[ 1] = m[ 1];\n    dst[ 2] = m[ 2];\n    dst[ 3] = m[ 3];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the y-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationY(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;\n  dst[ 1] = 0;\n  dst[ 2] = -s;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = s;\n  dst[ 9] = 0;\n  dst[10] = c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the y-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateY(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 - s * m20;\n  dst[ 1] = c * m01 - s * m21;\n  dst[ 2] = c * m02 - s * m22;\n  dst[ 3] = c * m03 - s * m23;\n  dst[ 8] = c * m20 + s * m00;\n  dst[ 9] = c * m21 + s * m01;\n  dst[10] = c * m22 + s * m02;\n  dst[11] = c * m23 + s * m03;\n\n  if (m !== dst) {\n    dst[ 4] = m[ 4];\n    dst[ 5] = m[ 5];\n    dst[ 6] = m[ 6];\n    dst[ 7] = m[ 7];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the z-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationZ(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;\n  dst[ 1] = s;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = -s;\n  dst[ 5] = c;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the z-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateZ(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n  dst[ 3] = c * m03 + s * m13;\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n  dst[ 7] = c * m13 - s * m03;\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n    dst[11] = m[11];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport function axisRotation(axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  dst[ 0] = xx + (1 - xx) * c;\n  dst[ 1] = x * y * oneMinusCosine + z * s;\n  dst[ 2] = x * z * oneMinusCosine - y * s;\n  dst[ 3] = 0;\n  dst[ 4] = x * y * oneMinusCosine - z * s;\n  dst[ 5] = yy + (1 - yy) * c;\n  dst[ 6] = y * z * oneMinusCosine + x * s;\n  dst[ 7] = 0;\n  dst[ 8] = x * z * oneMinusCosine + y * s;\n  dst[ 9] = y * z * oneMinusCosine - x * s;\n  dst[10] = zz + (1 - zz) * c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle. (same as axisRotation)\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport const rotation = axisRotation;\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle.\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function axisRotate(m: Mat4, axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  const r00 = xx + (1 - xx) * c;\n  const r01 = x * y * oneMinusCosine + z * s;\n  const r02 = x * z * oneMinusCosine - y * s;\n  const r10 = x * y * oneMinusCosine - z * s;\n  const r11 = yy + (1 - yy) * c;\n  const r12 = y * z * oneMinusCosine + x * s;\n  const r20 = x * z * oneMinusCosine + y * s;\n  const r21 = y * z * oneMinusCosine - x * s;\n  const r22 = zz + (1 - zz) * c;\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n\n  dst[ 0] = r00 * m00 + r01 * m10 + r02 * m20;\n  dst[ 1] = r00 * m01 + r01 * m11 + r02 * m21;\n  dst[ 2] = r00 * m02 + r01 * m12 + r02 * m22;\n  dst[ 3] = r00 * m03 + r01 * m13 + r02 * m23;\n  dst[ 4] = r10 * m00 + r11 * m10 + r12 * m20;\n  dst[ 5] = r10 * m01 + r11 * m11 + r12 * m21;\n  dst[ 6] = r10 * m02 + r11 * m12 + r12 * m22;\n  dst[ 7] = r10 * m03 + r11 * m13 + r12 * m23;\n  dst[ 8] = r20 * m00 + r21 * m10 + r22 * m20;\n  dst[ 9] = r20 * m01 + r21 * m11 + r22 * m21;\n  dst[10] = r20 * m02 + r21 * m12 + r22 * m22;\n  dst[11] = r20 * m03 + r21 * m13 + r22 * m23;\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle. (same as rotate)\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport const rotate = axisRotate;\n\n/**\n * Creates a 4-by-4 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     three entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = v[0];\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = v[1];\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = v[2];\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 4-by-4 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of three entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n  dst[ 3] = v0 * m[0 * 4 + 3];\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n  dst[ 7] = v1 * m[1 * 4 + 3];\n  dst[ 8] = v2 * m[2 * 4 + 0];\n  dst[ 9] = v2 * m[2 * 4 + 1];\n  dst[10] = v2 * m[2 * 4 + 2];\n  dst[11] = v2 * m[2 * 4 + 3];\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport { ArrayLikeCtor } from './array-like';\nimport * as utils from './utils.js';\nimport { Mat4 } from './mat4';\nimport { Vec4 } from './vec4';\n\nexport default Vec4;\n\n/**\n *\n * Vec4 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec4`. In other words you can do this\n *\n *     const v = vec4.cross(v1, v2);  // Creates a new Vec4 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec4.create();\n *     vec4.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec4.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nlet VecType: ArrayLikeCtor = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec4\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Vec4\n */\nexport function setDefaultType(ctor: new (n: number) => Vec4) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param w - Initial w value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number, w?: number): Vec4 {\n  const dst = new VecType(4);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n        if (w !== undefined) {\n          dst[3] = w;\n        }\n      }\n    }\n  }\n  return dst;\n}\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param z - Initial w value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n  dst[3] = Math.ceil(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n  dst[3] = Math.floor(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n  dst[3] = Math.round(v[3]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec4, min = 0, max = 1, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n  dst[3] = Math.min(max, Math.max(min, v[3]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n  dst[3] = a[3] + b[3];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec4, b: Vec4, scale: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n  dst[3] = a[3] + b[3] * scale;\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n  dst[3] = a[3] - b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec4, b: Vec4): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON &&\n         Math.abs(a[3] - b[3]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec4, b: Vec4): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec4, b: Vec4, t: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n  dst[3] = a[3] + t * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec4, b: Vec4, t: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n  dst[3] = a[3] + t[3] * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n  dst[3] = Math.max(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n  dst[3] = Math.min(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n  dst[3] = v[3] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n  dst[3] = v[3] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n  dst[3] = 1 / v[3];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec4, b: Vec4): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]) + (a[3] * b[3]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz + dw * dw);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return dx * dx + dy * dy + dz * dz + dw * dw;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n    dst[3] = v3 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n  dst[3] = -v[3];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as clone)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n  dst[3] = v[3];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as copy)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n  dst[3] = a[3] * b[3];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec4, b: Vec4, dst?: Vec4) {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n  dst[3] = a[3] / b[3];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n  dst[3] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec4 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec4 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec4, m: Mat4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = v[3];\n\n  dst[0] = m[0] * x + m[4] * y + m[ 8] * z + m[12] * w;\n  dst[1] = m[1] * x + m[5] * y + m[ 9] * z + m[13] * w;\n  dst[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  dst[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n\n  return dst;\n}\n", "import * as types from './array-like';\nimport * as mat3 from './mat3-impl';\nimport * as mat4 from './mat4-impl';\nimport * as vec2 from './vec2-impl';\nimport * as vec3 from './vec3-impl';\nimport * as vec4 from './vec4-impl';\nimport * as utils from './utils';\n\n/**\n * Sets the type this library creates for all types\n * @remarks\n *\n * example:\n *\n * ```\n * setDefaultType(Float64Array);\n * ```\n *\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n */\nexport function setDefaultType(ctor: new (n: number) => Float32Array | Float64Array | number[]) {\n  mat3.setDefaultType(ctor);\n  mat4.setDefaultType(ctor);\n  vec2.setDefaultType(ctor);\n  vec3.setDefaultType(ctor);\n  vec4.setDefaultType(ctor);\n}\n\nexport {\n  mat3,\n  mat4,\n  types,  // for docs\n  utils,\n  vec2,\n  vec3,\n  vec4,\n};", "import {mat4} from 'webgpu-matrix';\r\n/**\r\n * @description Manual convert python script BVH\r\n * from https://github.com/dabeschte/npybvh to the JS.\r\n * @author Nikola Lukic\r\n * @license GPL-V3\r\n */\r\n\r\nexport function degToRad(degrees) {return (degrees * Math.PI) / 180};\r\n\r\nfunction arraySum3(a, b) {\r\n  var rez1 = a[0] + b[0];\r\n  var rez2 = a[1] + b[1];\r\n  var rez3 = a[2] + b[2];\r\n  return [rez1, rez2, rez3];\r\n}\r\n\r\nfunction deg2rad(degrees) {\r\n  return degrees * (Math.PI / 180);\r\n}\r\n\r\nfunction npdeg2rad(degrees) {\r\n  return [degrees[0] * (Math.PI / 180),\r\n  degrees[1] * (Math.PI / 180),\r\n  degrees[2] * (Math.PI / 180)];\r\n}\r\n\r\nfunction rad2deg(radians) {\r\n  return radians * (180 / Math.PI);\r\n}\r\n\r\nfunction byId(id) {\r\n  return document.getElementById(id);\r\n}\r\n\r\n// fix for .dot N-dim vs 1D-dim Array\r\nexport function dot3vs1(a, b) {\r\n  var aNumRows = a.length, aNumCols = a[0].length,\r\n    bNumRows = b.length;\r\n  var REZ1 = 0, REZ2 = 0, REZ3 = 0;\r\n  if(aNumRows == 3 && aNumCols == 3 &&\r\n    bNumRows == 3) {\r\n    for(var j = 0;j < a.length;j++) {\r\n      // First root of 3x3 a.\r\n      REZ1 += a[0][j] * b[j];\r\n      REZ2 += a[1][j] * b[j];\r\n      REZ3 += a[2][j] * b[j];\r\n    }\r\n    var finalRez = [REZ1, REZ2, REZ3];\r\n    return finalRez;\r\n  } else {\r\n    console.error(\"Bad arguments for dot3vs1\");\r\n  }\r\n}\r\n\r\nexport function multiply(a, b) {\r\n  var aNumRows = a.length, aNumCols = a[0].length,\r\n    bNumRows = b.length, bNumCols = b[0].length,\r\n    m = new Array(aNumRows);\r\n  for(var r = 0;r < aNumRows;++r) {\r\n    m[r] = new Array(bNumCols);\r\n    for(var c = 0;c < bNumCols;++c) {\r\n      m[r][c] = 0;\r\n      for(var i = 0;i < aNumCols;++i) {\r\n        m[r][c] += a[r][i] * b[i][c];\r\n      }\r\n    }\r\n  }\r\n  return m;\r\n}\r\n\r\n/**\r\n * @description\r\n * Euler's rotation theorem tells us that any rotation in 3D can be described by 3\r\n * angles.  Let's call the 3 angles the *Euler angle vector* and call the angles\r\n * in the vector :Math:`alpha`, :Math:`beta` and :Math:`gamma`.  The vector is [\r\n * :Math:`alpha`, :Math:`beta`. :Math:`gamma` ] and, in this description, the\r\n * order of the parameters specifies the order in which the rotations occur (so\r\n * the rotation corresponding to :Math:`alpha` is applied first).\r\n * @source https://github.com/matthew-brett/transforms3d/blob/master/transforms3d/euler.py\r\n */\r\n\r\n// map axes strings to/from tuples of inner axis, parity, repetition, frame\r\nvar _AXES2TUPLE = {\r\n  'sxyz': [0, 0, 0, 0], 'sxyx': [0, 0, 1, 0], 'sxzy': [0, 1, 0, 0],\r\n  'sxzx': [0, 1, 1, 0], 'syzx': [1, 0, 0, 0], 'syzy': [1, 0, 1, 0],\r\n  'syxz': [1, 1, 0, 0], 'syxy': [1, 1, 1, 0], 'szxy': [2, 0, 0, 0],\r\n  'szxz': [2, 0, 1, 0], 'szyx': [2, 1, 0, 0], 'szyz': [2, 1, 1, 0],\r\n  'rzyx': [0, 0, 0, 1], 'rxyx': [0, 0, 1, 1], 'ryzx': [0, 1, 0, 1],\r\n  'rxzx': [0, 1, 1, 1], 'rxzy': [1, 0, 0, 1], 'ryzy': [1, 0, 1, 1],\r\n  'rzxy': [1, 1, 0, 1], 'ryxy': [1, 1, 1, 1], 'ryxz': [2, 0, 0, 1],\r\n  'rzxz': [2, 0, 1, 1], 'rxyz': [2, 1, 0, 1], 'rzyz': [2, 1, 1, 1]\r\n};\r\n\r\n// axis sequences for Euler angles\r\nvar _NEXT_AXIS = [1, 2, 0, 1];\r\n\r\nexport function euler2mat(ai, aj, ak, axes) {\r\n  if(typeof axes === 'undefined') var axes = 'sxyz';\r\n  // Return rotation matrix from Euler angles and axis sequence.\r\n  // Parameters\r\n  /*\r\n  ai : float\r\n      First rotation angle (according to `axes`).\r\n  aj : float\r\n      Second rotation angle (according to `axes`).\r\n  ak : float\r\n      Third rotation angle (according to `axes`).\r\n  axes : str, optional\r\n      Axis specification; one of 24 axis sequences as string or encoded\r\n      tuple - e.g. ``sxyz`` (the default).\r\n  Returns\r\n  -------\r\n  mat : array (3, 3)\r\n      Rotation matrix or affine.\r\n  Examples\r\n  --------\r\n  >>> R = euler2mat(1, 2, 3, 'syxz')\r\n  >>> np.allclose(np.sum(R[0]), -1.34786452)\r\n  True\r\n  >>> R = euler2mat(1, 2, 3, (0, 1, 0, 1))\r\n  >>> np.allclose(np.sum(R[0]), -0.383436184)\r\n  True */\r\n  try {\r\n    var firstaxis = _AXES2TUPLE[axes][0],\r\n      parity = _AXES2TUPLE[axes][1],\r\n      repetition = _AXES2TUPLE[axes][2],\r\n      frame = _AXES2TUPLE[axes][3];\r\n  }\r\n  catch(AttributeError) {\r\n    // _TUPLE2AXES[axes]  # validation\r\n    // firstaxis, parity, repetition, frame = axes\r\n    console.error(\"AttributeError: \", AttributeError);\r\n  }\r\n\r\n  var i = firstaxis;\r\n  var j = _NEXT_AXIS[i + parity];\r\n  var k = _NEXT_AXIS[i - parity + 1];\r\n\r\n  if(frame) {\r\n    ai = ak;\r\n    ak = ai;\r\n  }\r\n  if(parity) {\r\n    ai = -ai;\r\n    aj = -aj;\r\n    ak = -ak;\r\n  }\r\n\r\n  var si = Math.sin(ai);\r\n  var sj = Math.sin(aj);\r\n  var sk = Math.sin(ak);\r\n  var ci = Math.cos(ai);\r\n  var cj = Math.cos(aj);\r\n  var ck = Math.cos(ak);\r\n  var cc = ci * ck;\r\n  var cs = ci * sk;\r\n  var sc = si * ck;\r\n  var ss = si * sk;\r\n\r\n  // M = np.eye(3)\r\n  var M = [\r\n    [1., 0., 0],\r\n    [0., 1., 0],\r\n    [0., 0., 1]\r\n  ];\r\n\r\n  if(repetition) {\r\n    M[i][i] = cj;\r\n    M[i][j] = sj * si;\r\n    M[i][k] = sj * ci;\r\n    M[j][i] = sj * sk;\r\n    M[j][j] = -cj * ss + cc;\r\n    M[j][k] = -cj * cs - sc;\r\n    M[k][i] = -sj * ck;\r\n    M[k][j] = cj * sc + cs;\r\n    M[k][k] = cj * cc - ss;\r\n  } else {\r\n    M[i][i] = cj * ck;\r\n    M[i][j] = sj * sc - cs;\r\n    M[i][k] = sj * cc + ss;\r\n    M[j][i] = cj * sk;\r\n    M[j][j] = sj * ss + cc;\r\n    M[j][k] = sj * cs - sc;\r\n    M[k][i] = -sj;\r\n    M[k][j] = cj * si;\r\n    M[k][k] = cj * ci;\r\n  }\r\n  return M;\r\n}\r\n\r\n/**\r\n * @description\r\n * How to calculate the angle from rotation matrix.\r\n */\r\nexport function mat2euler(M, rad2deg_flag) {\r\n  var pitch_1, pitch_2,\r\n    roll_1, roll_2,\r\n    yaw_1, yaw_2,\r\n    pitch, roll, yaw;\r\n\r\n  if(M[2][0] != 1 & M[2][0] != -1) {\r\n    pitch_1 = -1 * Math.asin(M[2][0]);\r\n    pitch_2 = Math.PI - pitch_1;\r\n    roll_1 = Math.atan2(M[2][1] / Math.cos(pitch_1), M[2][2] / Math.cos(pitch_1));\r\n    roll_2 = Math.atan2(M[2][1] / Math.cos(pitch_2), M[2][2] / Math.cos(pitch_2));\r\n    yaw_1 = Math.atan2(M[1][0] / Math.cos(pitch_1), M[0][0] / Math.cos(pitch_1));\r\n    yaw_2 = Math.atan2(M[1][0] / Math.cos(pitch_2), M[0][0] / Math.cos(pitch_2));\r\n    pitch = pitch_1;\r\n    roll = roll_1;\r\n    yaw = yaw_1;\r\n  } else {\r\n    yaw = 0;\r\n    if(M[2][0] == -1) {\r\n      pitch = Math.PI / 2;\r\n      roll = yaw + Math.atan2(M[0][1], M[0][2]);\r\n    } else {\r\n      pitch = -Math.PI / 2;\r\n      roll = -1 * yaw + Math.atan2(-1 * M[0][1], -1 * M[0][2]);\r\n    }\r\n  }\r\n\r\n  if(typeof rad2deg_flag !== \"undefined\") {\r\n    // convert from radians to degrees\r\n    roll = (roll * 180) / Math.PI;\r\n    pitch = (pitch * 180) / Math.PI;\r\n    yaw = (yaw * 180) / Math.PI;\r\n  }\r\n\r\n  return [roll, pitch, yaw];\r\n}\r\n\r\nexport class MEBvhJoint {\r\n\r\n  constructor(name, parent) {\r\n    this.name = name;\r\n    this.parent = parent;\r\n\r\n    this.offset = [\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n    ];\r\n\r\n    this.channels = [];\r\n    this.children = [];\r\n\r\n    // New: where in the frame array this joint\u2019s channels start ???\r\n    this.channelOffset = 0;\r\n  }\r\n\r\n  add_child(child) {\r\n    this.children.push(child);\r\n  }\r\n\r\n  __repr__() {\r\n    return this.name;\r\n  }\r\n\r\n  position_animated() {\r\n    var detFlag = false;\r\n    for(const item in this.channels) {\r\n      if(this.channels[item].endsWith(\"position\") == true) {\r\n        detFlag = true;\r\n      }\r\n    }\r\n    return detFlag;\r\n  }\r\n\r\n  rotation_animated() {\r\n    var detFlag = false;\r\n    for(const item in this.channels) {\r\n      if(this.channels[item].endsWith(\"rotation\") == true) {\r\n        detFlag = true;\r\n      }\r\n    }\r\n    return detFlag;\r\n  }\r\n\r\n  createIdentityMatrix() {\r\n    // Returns a flat Float32Array of length 16 (column-major)\r\n    return new Float32Array([\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n    ]);\r\n  }\r\n\r\n  matrixFromKeyframe(frameData) {\r\n    const m = this.createIdentityMatrix();\r\n    let t = [0, 0, 0];\r\n    let r = [0, 0, 0];\r\n\r\n    for(let i = 0;i < this.channels.length;i++) {\r\n      const channel = this.channels[i];\r\n      const value = frameData[this.channelOffset + i];\r\n      // channelOffset = index into frameData where this joint\u2019s values start\r\n\r\n      switch(channel) {\r\n        case 'Xposition': t[0] = value; break;\r\n        case 'Yposition': t[1] = value; break;\r\n        case 'Zposition': t[2] = value; break;\r\n        case 'Xrotation': r[0] = degToRad(value); break;\r\n        case 'Yrotation': r[1] = degToRad(value); break;\r\n        case 'Zrotation': r[2] = degToRad(value); break;\r\n      }\r\n    }\r\n\r\n    // Apply translation\r\n    mat4.translate(m, t, m);\r\n    // Apply rotations in BVH order (important!)\r\n    mat4.rotateX(m, r[0], m);\r\n    mat4.rotateY(m, r[1], m);\r\n    mat4.rotateZ(m, r[2], m);\r\n\r\n    return m;\r\n  }\r\n}\r\n\r\nexport class MEBvh {\r\n  constructor() {\r\n    this.joints = {};\r\n    this.root = null;\r\n    this.keyframes = null;\r\n    this.frames = 0;\r\n    this.fps = 0;\r\n    this.myName = \"MATRIX-ENGINE-BVH\";\r\n    // new\r\n    this.jointOrder = []; // array to store joints in order\r\n  }\r\n\r\n  computeJointOrder() {\r\n    this.jointOrder = [];\r\n    const traverse = joint => {\r\n      this.jointOrder.push(joint.name);\r\n      for(const child of joint.children) {\r\n        traverse(child);\r\n      }\r\n    };\r\n    traverse(this.root); // root is your MEBvhJoint\r\n  }\r\n\r\n  computeChannelOffsets() {\r\n    let offset = 0;\r\n    const walk = (joint) => {\r\n      joint.channelOffset = offset;        // assign\r\n      offset += joint.channels.length;     // advance\r\n      for(const child of joint.children) {\r\n        walk(child);\r\n      }\r\n    };\r\n    if(this.root) walk(this.root);\r\n    this.totalChannels = offset; // store total for frame allocation\r\n  }\r\n\r\n  async parse_file(link) {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(link).then(event => {\r\n        event.text().then(text => {\r\n\r\n          var hierarchy = text.split(\"MOTION\")[0];\r\n          var motion = text.split(\"MOTION\")[1];\r\n\r\n          var newLog = document.createElement(\"div\");\r\n          newLog.innerHTML += '<h2>Hierarchy</h2>';\r\n          newLog.innerHTML += '<p>' + hierarchy + '</p>';\r\n          var newLog2 = document.createElement(\"span\");\r\n          newLog2.innerHTML += '<h2>Motion</h2>';\r\n          newLog2.innerHTML += '<p class=\"paragraf fixHeight\" >' + motion + '</p>';\r\n\r\n          if(byId && byId('log') !== null) {\r\n            byId('log').appendChild(newLog2);\r\n            byId('log').appendChild(newLog);\r\n          }\r\n\r\n          this._parse_hierarchy(hierarchy);\r\n\r\n          this.computeJointOrder()\r\n\r\n          this.computeChannelOffsets(); // <\u2014 must do this here NEW\r\n          this.parse_motion(motion);\r\n\r\n          resolve();\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  _parse_hierarchy(text) {\r\n    var lines = text.split(/\\s*\\n+\\s*/);\r\n    var joint_stack = [];\r\n\r\n    for(var key in lines) {\r\n      var line = lines[key];\r\n      var words = line.split(/\\s+/);\r\n      var instruction = words[0];\r\n      var parent = null;\r\n\r\n      if(instruction == \"JOINT\" || instruction == \"ROOT\") {\r\n        if(instruction == \"JOINT\") {\r\n          // -1 py -> last item\r\n          parent = joint_stack[joint_stack.length - 1];\r\n        } else {\r\n          parent = null;\r\n        }\r\n\r\n        var joint = new MEBvhJoint(words[1], parent);\r\n\r\n        this.joints[joint.name] = joint;\r\n        if(parent != null) {\r\n          parent.add_child(joint);\r\n        }\r\n        joint_stack.push(joint);\r\n        if(instruction == \"ROOT\") {\r\n          this.root = joint;\r\n        }\r\n      } else if(instruction == \"CHANNELS\") {\r\n        for(var j = 2;j < words.length;j++) {\r\n          joint_stack[joint_stack.length - 1].channels.push(words[j]);\r\n        }\r\n      } else if(instruction == \"OFFSET\") {\r\n        for(var j = 1;j < words.length;j++) {\r\n          joint_stack[joint_stack.length - 1].offset[j - 1] = parseFloat(\r\n            words[j]\r\n          );\r\n        }\r\n      } else if(instruction == \"End\") {\r\n        var joint = new MEBvhJoint(\r\n          joint_stack[joint_stack.length - 1].name + \"_end\",\r\n          joint_stack[joint_stack.length - 1]\r\n        );\r\n        joint_stack[joint_stack.length - 1].add_child(joint);\r\n        joint_stack.push(joint);\r\n        this.joints[joint.name] = joint;\r\n      } else if(instruction == \"}\") {\r\n        joint_stack.pop();\r\n      }\r\n    }\r\n  }\r\n\r\n  _add_pose_recursive(joint, offset, poses) {\r\n\r\n    var newLog1 = document.createElement(\"span\");\r\n    newLog1.innerHTML += '<h2>add_pose_recursive</h2>';\r\n    newLog1.innerHTML += '<p class=\"paragraf\" >Joint Name: ' + joint.name + '</p>';\r\n    newLog1.innerHTML += '<p>joint.parent    : ' + (joint.parent != null ? joint.parent.name : 'null') + '</p>';\r\n    newLog1.innerHTML += '<p>joint.offset    : ' + joint.offset + '</p>';\r\n    newLog1.innerHTML += '<p>joint.children.length  : ' + joint.children.length + '</p>';\r\n\r\n    (joint.children.length != 0 ? newLog1.innerHTML += '<p> Childrens: ' : newLog1.innerHTML += 'No Childrens ');\r\n    joint.children.forEach(iJoint => {\r\n      newLog1.innerHTML += ' ' + iJoint['name'] + ' , ';\r\n    });\r\n    newLog1.innerHTML += '</p>';\r\n\r\n    newLog1.innerHTML += '<p>Argument offset : ' + offset + '</p>';\r\n    byId('log').appendChild(newLog1);\r\n\r\n    var pose = arraySum3(joint.offset, offset);\r\n    poses.push(pose);\r\n\r\n    for(var c in joint.children) {\r\n      this._add_pose_recursive(joint.children[c], pose, poses);\r\n    }\r\n  }\r\n\r\n  plot_hierarchy() {\r\n    // import matplotlib.pyplot as plt\r\n    // from mpl_toolkits.mplot3d import axes3d, Axes3D\r\n\r\n    var poses = [];\r\n    this._add_pose_recursive(this.root, [0, 0, 0], poses);\r\n\r\n    // pos = np.array(poses);\r\n\r\n    /* Draw staff DISABLED\r\n        fig = plt.figure()\r\n        ax = fig.add_subplot(111, projection='3d')\r\n        ax.scatter(pos[:, 0], pos[:, 2], pos[:, 1])\r\n        ax.set_xlim(-30, 30)\r\n        ax.set_ylim(-30, 30)\r\n        ax.set_zlim(-30, 30)\r\n        plt.show() */\r\n  }\r\n\r\n  parse_motion(text) {\r\n\r\n    var lines = text.split(/\\s*\\n+\\s*/);\r\n    var frame = 0;\r\n    for(var key in lines) {\r\n      var line = lines[key];\r\n      if(line == \"\") {continue;}\r\n      var words = line.split(/\\s+/);\r\n      if(line.startsWith(\"Frame Time:\")) {\r\n        this.fps = Math.round(1 / parseFloat(words[2]));\r\n        continue;\r\n      }\r\n      if(line.startsWith(\"Frames:\")) {\r\n        this.frames = parseInt(words[1]);\r\n        continue;\r\n      }\r\n      if(this.keyframes == null) {\r\n        // OK this is just costruction (define) with random values.\r\n        var localArr = Array.from(Array(this.frames), () => new Array(words.length));\r\n        this.keyframes = localArr;\r\n      }\r\n\r\n      for(var angle_index = 0;angle_index < words.length;angle_index++) {\r\n        this.keyframes[frame][angle_index] = parseFloat(words[angle_index]);\r\n      }\r\n\r\n      frame += 1;\r\n    }\r\n  }\r\n\r\n  _extract_rotation(frame_pose, index_offset, joint) {\r\n    var local_rotation = [0, 0, 0],\r\n      M_rotation;\r\n\r\n    for(var key in joint.channels) {\r\n      var channel = joint.channels[key];\r\n\r\n      if(channel.endsWith(\"position\")) {\r\n        continue;\r\n      }\r\n      if(channel == \"Xrotation\") {\r\n        local_rotation[0] = frame_pose[index_offset];\r\n      } else if(channel == \"Yrotation\") {\r\n        local_rotation[1] = frame_pose[index_offset];\r\n      } else if(channel == \"Zrotation\") {\r\n        local_rotation[2] = frame_pose[index_offset];\r\n      } else {\r\n        console.warn(\"Unknown channel {channel}\");\r\n        // raise Exception(f\"Unknown channel {channel}\");\r\n      }\r\n      index_offset += 1;\r\n    }\r\n\r\n    local_rotation = npdeg2rad(local_rotation);\r\n\r\n    M_rotation = [\r\n      [1, 0, 0],\r\n      [0, 1, 0],\r\n      [0, 0, 1],\r\n    ];\r\n\r\n    for(key in joint.channels) {\r\n\r\n      var channel = joint.channels[key];\r\n      if(channel.endsWith(\"position\")) {\r\n        continue;\r\n      }\r\n\r\n      var euler_rot;\r\n      if(channel == \"Xrotation\") {\r\n        // console.warn(\"local_rotation \" + local_rotation);\r\n        euler_rot = [local_rotation[0], 0., 0.];\r\n      } else if(channel == \"Yrotation\") {\r\n        euler_rot = [0., local_rotation[1], 0.];\r\n      } else if(channel == \"Zrotation\") {\r\n        euler_rot = [0., 0., local_rotation[2]];\r\n      } else {\r\n        console.warn(\"Unknown channel {channel}\");\r\n      }\r\n\r\n      var M_channel = euler2mat(euler_rot[0], euler_rot[1], euler_rot[2], euler_rot[3])\r\n      var M_rotation = multiply(M_rotation, M_channel);\r\n\r\n    }\r\n    return [M_rotation, index_offset];\r\n  }\r\n\r\n  _extract_position(joint, frame_pose, index_offset) {\r\n    var offset_position = [0, 0, 0];\r\n    for(var key in joint.channels) {\r\n      var channel = joint.channels[key];\r\n\r\n      if(channel.endsWith(\"rotation\")) {\r\n        continue;\r\n      }\r\n\r\n      if(channel == \"Xposition\") {\r\n        offset_position[0] = frame_pose[index_offset];\r\n      } else if(channel == \"Yposition\") {\r\n        offset_position[1] = frame_pose[index_offset];\r\n      } else if(channel == \"Zposition\") {\r\n        offset_position[2] = frame_pose[index_offset];\r\n      } else {\r\n        console.warn(\"Unknown channel {channel}\");\r\n        // raise Exception(f\"Unknown channel {channel}\")\r\n      }\r\n      index_offset += 1;\r\n    }\r\n    return [offset_position, index_offset];\r\n  }\r\n\r\n  _recursive_apply_frame(\r\n    joint,\r\n    frame_pose,\r\n    index_offset,\r\n    p,\r\n    r,\r\n    M_parent,\r\n    p_parent\r\n  ) {\r\n    var joint_index;\r\n    if(joint.position_animated()) {\r\n      var local = this._extract_position(joint, frame_pose, index_offset);\r\n      var offset_position = local[0],\r\n        index_offset = local[1];\r\n\r\n    } else {\r\n      var offset_position = [0, 0, 0];\r\n    }\r\n\r\n    if(joint.channels.length == 0) {\r\n\r\n      var local2 = 0;\r\n      for(var item in this.joints) {\r\n\r\n        if(joint.name == item) {\r\n          joint_index = local2;\r\n        }\r\n        local2++;\r\n      }\r\n\r\n      p[joint_index] = arraySum3(p_parent, dot3vs1(M_parent, joint.offset));\r\n      r[joint_index] = mat2euler(M_parent);\r\n      return index_offset;\r\n    }\r\n\r\n    if(joint.rotation_animated()) {\r\n      var local2 = this._extract_rotation(frame_pose, index_offset, joint);\r\n      var M_rotation = local2[0];\r\n      index_offset = local2[1];\r\n    } else {\r\n      var M_rotation = [\r\n        [1, 0, 0],\r\n        [0, 1, 0],\r\n        [0, 0, 1],\r\n      ];\r\n    }\r\n\r\n    var M = multiply(M_parent, M_rotation);\r\n    // https://www.khanacademy.org/math/precalculus/x9e81a4f98389efdf:matrices/x9e81a4f98389efdf:adding-and-subtracting-matrices/e/matrix_addition_and_subtraction\r\n\r\n    var position = arraySum3(p_parent, dot3vs1(M_parent, joint.offset));\r\n    position = arraySum3(position, offset_position);\r\n    var rotation = mat2euler(M, \"rad2deg\");\r\n\r\n    // just find by id\r\n    var local = 0;\r\n    for(const item in this.joints) {\r\n      if(joint.name == item) {\r\n        joint_index = local;\r\n      }\r\n      local++;\r\n    }\r\n\r\n    p[joint_index] = position;\r\n    r[joint_index] = rotation;\r\n\r\n    for(var c in joint.children) {\r\n      index_offset = this._recursive_apply_frame(\r\n        joint.children[c],\r\n        frame_pose,\r\n        index_offset,\r\n        p,\r\n        r,\r\n        M,\r\n        position\r\n      );\r\n    }\r\n\r\n    return index_offset;\r\n  }\r\n\r\n  frame_pose(frame) {\r\n    var jointLength = 0;\r\n    for(var x in this.joints) {jointLength++}\r\n    var p = Array.from(Array(jointLength), () => [0, 0, 0]);\r\n    var r = Array.from(Array(jointLength), () => [0, 0, 0]);\r\n    var frame_pose = this.keyframes[frame];\r\n    var M_parent = [\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n    ];\r\n\r\n    M_parent[0][0] = 1;\r\n    M_parent[1][1] = 1;\r\n    M_parent[2][2] = 1;\r\n\r\n    this._recursive_apply_frame(\r\n      this.root,\r\n      frame_pose,\r\n      0,\r\n      p,\r\n      r,\r\n      M_parent,\r\n      [0, 0, 0]\r\n    );\r\n\r\n    return [p, r];\r\n  }\r\n\r\n  all_frame_poses() {\r\n\r\n    var jointLength = 0;\r\n    for(var x in this.joints) {jointLength++}\r\n    var p = Array.from({length: this.frames}, () => Array.from({length: jointLength}, () => [0, 0, 0]));\r\n    var r = Array.from({length: this.frames}, () => Array.from({length: jointLength}, () => [0, 0, 0]));\r\n\r\n    for(var frame = 0;frame < this.keyframes.length;frame++) {\r\n      var local3 = this.frame_pose(frame);\r\n      p[frame] = local3[0];\r\n      r[frame] = local3[1];\r\n    }\r\n\r\n    return [p, r];\r\n  }\r\n\r\n  _plot_pose(p, r, fig, ax) {\r\n    /* \r\n      _plot_pose(p, r, fig=None, ax=None) {\r\n        import matplotlib.pyplot as plt\r\n        from mpl_toolkits.mplot3d import axes3d, Axes3D\r\n      if fig is None:\r\n          fig = plt.figure()\r\n      if ax is None:\r\n          ax = fig.add_subplot(111, projection='3d')\r\n      ax.cla()\r\n      ax.scatter(p[:, 0], p[:, 2], p[:, 1])\r\n      ax.set_xlim(-30, 30)\r\n      ax.set_ylim(-30, 30)\r\n      ax.set_zlim(-1, 59)\r\n      plt.draw()\r\n      plt.pause(0.001)\r\n    */\r\n  }\r\n\r\n  // Meybe helps for draw\r\n  // plot_frame(frame, fig=None, ax=None) {\r\n  plot_frame(frame, fig, ax) {\r\n    // ????\r\n    // p, (r = this.frame_pose(frame));\r\n    // this._plot_pose(p, r, fig, ax);\r\n  }\r\n\r\n  joint_names() {\r\n    var keys = [];\r\n    for(var key in this.joints) {\r\n      keys.push(key);\r\n    }\r\n    return keys;\r\n  }\r\n\r\n  plot_all_frames() {\r\n    /*\r\n      import matplotlib.pyplot as plt\r\n      from mpl_toolkits.mplot3d import axes3d, Axes3D\r\n      fig = plt.figure()\r\n      ax = fig.add_subplot(111, projection='3d')\r\n      for i in range(self.frames) {\r\n          self.plot_frame(i, fig, ax);\r\n      } \r\n    */\r\n  }\r\n\r\n  __repr__() {\r\n    return `BVH.JS ${this.joints.keys().length} joints, ${this.frames} frames`;\r\n  }\r\n}\r\n", "\r\nimport { MEBvh } from \"./module/bvh-loader\";\r\n\r\nexport default MEBvh;\r\n", "/**\n * Common utilities\n * @module glMatrix\n */\n\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n\n/**\n * Symmetric round\n * see https://www.npmjs.com/package/round-half-up-symmetric#user-content-detailed-background\n *\n * @param {Number} a value to round\n */\nexport function round(a) {\n  if (a >= 0) return Math.round(a);\n  return a % 0.5 === 0 ? Math.floor(a) : Math.round(a);\n}\n\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\nvar radian = 180 / Math.PI;\n\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian(a) {\n  return a * degree;\n}\n\n/**\n * Convert Radian To Degree\n *\n * @param {Number} a Angle in Radians\n */\nexport function toDegree(a) {\n  return a * radian;\n}\n\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a          The first number to test.\n * @param {Number} b          The second number to test.\n * @param {Number} tolerance  Absolute or relative tolerance (default glMatrix.EPSILON)\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\nexport function equals(a, b) {\n  var tolerance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : EPSILON;\n  return Math.abs(a - b) <= tolerance * Math.max(1, Math.abs(a), Math.abs(b));\n}", "import * as glMatrix from \"./common.js\";\n\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n    var a12 = a[6],\n      a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4 | null} out, or null if source matrix is not invertible\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function adjoint(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n  out[0] = a11 * b11 - a12 * b10 + a13 * b09;\n  out[1] = a02 * b10 - a01 * b11 - a03 * b09;\n  out[2] = a31 * b05 - a32 * b04 + a33 * b03;\n  out[3] = a22 * b04 - a21 * b05 - a23 * b03;\n  out[4] = a12 * b08 - a10 * b11 - a13 * b07;\n  out[5] = a00 * b11 - a02 * b08 + a03 * b07;\n  out[6] = a32 * b02 - a30 * b05 - a33 * b01;\n  out[7] = a20 * b05 - a22 * b02 + a23 * b01;\n  out[8] = a10 * b10 - a11 * b08 + a13 * b06;\n  out[9] = a01 * b08 - a00 * b10 - a03 * b06;\n  out[10] = a30 * b04 - a31 * b02 + a33 * b00;\n  out[11] = a21 * b02 - a20 * b04 - a23 * b00;\n  out[12] = a11 * b07 - a10 * b09 - a12 * b06;\n  out[13] = a00 * b09 - a01 * b07 + a02 * b06;\n  out[14] = a31 * b01 - a30 * b03 - a32 * b00;\n  out[15] = a20 * b03 - a21 * b01 + a22 * b00;\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b0 = a00 * a11 - a01 * a10;\n  var b1 = a00 * a12 - a02 * a10;\n  var b2 = a01 * a12 - a02 * a11;\n  var b3 = a20 * a31 - a21 * a30;\n  var b4 = a20 * a32 - a22 * a30;\n  var b5 = a21 * a32 - a22 * a31;\n  var b6 = a00 * b5 - a01 * b4 + a02 * b3;\n  var b7 = a10 * b5 - a11 * b4 + a12 * b3;\n  var b8 = a20 * b2 - a21 * b1 + a22 * b0;\n  var b9 = a30 * b2 - a31 * b1 + a32 * b0;\n\n  // Calculate the determinant\n  return a13 * b6 - a03 * b7 + a33 * b8 - a23 * b9;\n}\n\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n\n  // Cache only the current line of the second matrix\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\nexport function translate(out, a, v) {\n  var x = v[0],\n    y = v[1],\n    z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n  return out;\n}\n\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\nexport function scale(out, a, v) {\n  var x = v[0],\n    y = v[1],\n    z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n    y = axis[1],\n    z = axis[2];\n  var len = Math.sqrt(x * x + y * y + z * z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11];\n\n  // Construct the elements of the rotation matrix\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n    y = axis[1],\n    z = axis[2];\n  var len = Math.sqrt(x * x + y * y + z * z);\n  var s, c, t;\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n    by = -a[1],\n    bz = -a[2],\n    bw = a[3],\n    ax = a[4],\n    ay = a[5],\n    az = a[6],\n    aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw;\n  //Only scale if it makes sense\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion parameter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n  return out;\n}\n\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n  return out;\n}\n\n/**\n * Decomposes a transformation matrix into its rotation, translation\n * and scale components. Returns only the rotation component\n * @param  {quat} out_r Quaternion to receive the rotation component\n * @param  {vec3} out_t Vector to receive the translation vector\n * @param  {vec3} out_s Vector to receive the scaling factor\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @returns {quat} out_r\n */\nexport function decompose(out_r, out_t, out_s, mat) {\n  out_t[0] = mat[12];\n  out_t[1] = mat[13];\n  out_t[2] = mat[14];\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out_s[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out_s[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out_s[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n  var is1 = 1 / out_s[0];\n  var is2 = 1 / out_s[1];\n  var is3 = 1 / out_s[2];\n  var sm11 = m11 * is1;\n  var sm12 = m12 * is2;\n  var sm13 = m13 * is3;\n  var sm21 = m21 * is1;\n  var sm22 = m22 * is2;\n  var sm23 = m23 * is3;\n  var sm31 = m31 * is1;\n  var sm32 = m32 * is2;\n  var sm33 = m33 * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out_r[3] = 0.25 * S;\n    out_r[0] = (sm23 - sm32) / S;\n    out_r[1] = (sm31 - sm13) / S;\n    out_r[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out_r[3] = (sm23 - sm32) / S;\n    out_r[0] = 0.25 * S;\n    out_r[1] = (sm12 + sm21) / S;\n    out_r[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out_r[3] = (sm31 - sm13) / S;\n    out_r[0] = (sm12 + sm21) / S;\n    out_r[1] = 0.25 * S;\n    out_r[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out_r[3] = (sm12 - sm21) / S;\n    out_r[0] = (sm31 + sm13) / S;\n    out_r[1] = (sm23 + sm32) / S;\n    out_r[2] = 0.25 * S;\n  }\n  return out_r;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *     mat4.scale(dest, dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     mat4.translate(dest, dest, origin);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *     mat4.scale(dest, dest, scale)\n *     mat4.translate(dest, dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\nexport function fromQuat(out, q) {\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2);\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    var nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n  return out;\n}\n\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\nexport var perspective = perspectiveNO;\n\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2);\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    var nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\nexport var ortho = orthoNO;\n\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} target Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n    eyey = eye[1],\n    eyez = eye[2],\n    upx = up[0],\n    upy = up[1],\n    upz = up[2];\n  var z0 = eyex - target[0],\n    z1 = eyey - target[1],\n    z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n  var x0 = upy * z2 - upz * z1,\n    x1 = upz * z0 - upx * z2,\n    x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8] + a[9] * a[9] + a[10] * a[10] + a[11] * a[11] + a[12] * a[12] + a[13] * a[13] + a[14] * a[14] + a[15] * a[15]);\n}\n\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3];\n  var a4 = a[4],\n    a5 = a[5],\n    a6 = a[6],\n    a7 = a[7];\n  var a8 = a[8],\n    a9 = a[9],\n    a10 = a[10],\n    a11 = a[11];\n  var a12 = a[12],\n    a13 = a[13],\n    a14 = a[14],\n    a15 = a[15];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  var b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7];\n  var b8 = b[8],\n    b9 = b[9],\n    b10 = b[10],\n    b11 = b[11];\n  var b12 = b[12],\n    b13 = b[13],\n    b14 = b[14],\n    b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\nexport var sub = subtract;", "/**\r\n * @author Nikola Lukic zlatnaspirala\r\n * @description\r\n * Importer is adapted for matrix-engine-wgpu.\r\n * Improved - Fix children empty array.\r\n * Access to json raw data.\r\n * @source\r\n * https://github.com/Twinklebear/webgpu-gltf/blob/main/src/glb_import.js\r\n */\r\nimport {mat4} from \"gl-matrix\";\r\n\r\nconst GLTFRenderMode = {\r\n  POINTS: 0,\r\n  LINE: 1,\r\n  LINE_LOOP: 2,\r\n  LINE_STRIP: 3,\r\n  TRIANGLES: 4,\r\n  TRIANGLE_STRIP: 5,\r\n  // Note: fans are not supported in WebGPU, use should be\r\n  // an error or converted into a list/strip\r\n  TRIANGLE_FAN: 6,\r\n};\r\n\r\nconst GLTFComponentType = {\r\n  BYTE: 5120,\r\n  UNSIGNED_BYTE: 5121,\r\n  SHORT: 5122,\r\n  UNSIGNED_SHORT: 5123,\r\n  INT: 5124,\r\n  UNSIGNED_INT: 5125,\r\n  FLOAT: 5126,\r\n  DOUBLE: 5130,\r\n};\r\n\r\nconst GLTFTextureFilter = {\r\n  NEAREST: 9728,\r\n  LINEAR: 9729,\r\n  NEAREST_MIPMAP_NEAREST: 9984,\r\n  LINEAR_MIPMAP_NEAREST: 9985,\r\n  NEAREST_MIPMAP_LINEAR: 9986,\r\n  LINEAR_MIPMAP_LINEAR: 9987,\r\n};\r\n\r\nconst GLTFTextureWrap = {\r\n  REPEAT: 10497,\r\n  CLAMP_TO_EDGE: 33071,\r\n  MIRRORED_REPEAT: 33648,\r\n};\r\n\r\nfunction alignTo(val, align) {\r\n  return Math.floor((val + align - 1) / align) * align;\r\n}\r\n\r\nfunction gltfTypeNumComponents(type) {\r\n  switch(type) {\r\n    case 'SCALAR':\r\n      return 1;\r\n    case 'VEC2':\r\n      return 2;\r\n    case 'VEC3':\r\n      return 3;\r\n    case 'VEC4':\r\n      return 4;\r\n    default:\r\n      alert('Unhandled glTF Type ' + type);\r\n      return null;\r\n  }\r\n}\r\n\r\nfunction gltfTypeSize(componentType, type) {\r\n  var typeSize = 0;\r\n  switch(componentType) {\r\n    case GLTFComponentType.BYTE:\r\n      typeSize = 1;\r\n      break;\r\n    case GLTFComponentType.UNSIGNED_BYTE:\r\n      typeSize = 1;\r\n      break;\r\n    case GLTFComponentType.SHORT:\r\n      typeSize = 2;\r\n      break;\r\n    case GLTFComponentType.UNSIGNED_SHORT:\r\n      typeSize = 2;\r\n      break;\r\n    case GLTFComponentType.INT:\r\n      typeSize = 4;\r\n      break;\r\n    case GLTFComponentType.UNSIGNED_INT:\r\n      typeSize = 4;\r\n      break;\r\n    case GLTFComponentType.FLOAT:\r\n      typeSize = 4;\r\n      break;\r\n    case GLTFComponentType.DOUBLE:\r\n      typeSize = 4;\r\n      break;\r\n    default:\r\n      alert('Unrecognized GLTF Component Type?');\r\n  }\r\n  return gltfTypeNumComponents(type) * typeSize;\r\n}\r\n\r\nexport class GLTFBuffer {\r\n  constructor(buffer, size, offset) {\r\n    this.arrayBuffer = buffer;\r\n    this.size = size;\r\n    this.byteOffset = offset;\r\n  }\r\n}\r\n\r\nexport class GLTFBufferView {\r\n  constructor(buffer, view) {\r\n    this.length = view['byteLength'];\r\n    this.byteOffset = buffer.byteOffset;\r\n    if(view['byteOffset'] !== undefined) {\r\n      this.byteOffset += view['byteOffset'];\r\n    }\r\n    this.byteStride = 0;\r\n    if(view['byteStride'] !== undefined) {\r\n      this.byteStride = view['byteStride'];\r\n    }\r\n    this.buffer = new Uint8Array(buffer.arrayBuffer, this.byteOffset, this.length);\r\n\r\n    this.needsUpload = false;\r\n    this.gpuBuffer = null;\r\n    this.usage = 0;\r\n  }\r\n\r\n  addUsage(usage) {\r\n    this.usage = this.usage | usage;\r\n  }\r\n\r\n  upload(device) {\r\n    // Note: must align to 4 byte size when mapped at creation is true\r\n    var buf = device.createBuffer({\r\n      size: alignTo(this.buffer.byteLength, 4),\r\n      usage: this.usage,\r\n      mappedAtCreation: true\r\n    });\r\n    new (this.buffer.constructor)(buf.getMappedRange()).set(this.buffer);\r\n    buf.unmap();\r\n    this.gpuBuffer = buf;\r\n    this.needsUpload = false;\r\n  }\r\n}\r\n\r\nexport class GLTFAccessor {\r\n  constructor(view, accessor, weightsAccessIndex) {\r\n    this.count = accessor['count'];\r\n    this.componentType = accessor['componentType'];\r\n    this.gltfType = accessor['type'];\r\n    this.numComponents = gltfTypeNumComponents(accessor['type']);\r\n    this.numScalars = this.count * this.numComponents;\r\n    this.view = view;\r\n    this.byteOffset = 0;\r\n    if(accessor['byteOffset'] !== undefined) {\r\n      this.byteOffset = accessor['byteOffset'];\r\n    }\r\n    if(weightsAccessIndex) this.weightsAccessIndex = weightsAccessIndex;\r\n  }\r\n\r\n  get byteStride() {\r\n    var elementSize = gltfTypeSize(this.componentType, this.gltfType);\r\n    return Math.max(elementSize, this.view.byteStride);\r\n  }\r\n}\r\n\r\nexport class GLTFPrimitive {\r\n  constructor(indices, positions, normals, texcoords, material, topology, weights, joints, tangents) {\r\n    this.indices = indices;\r\n    this.positions = positions;\r\n    this.normals = normals;\r\n    this.texcoords = texcoords;\r\n    this.material = material;\r\n    this.topology = topology;\r\n    this.weights = weights;\r\n    this.joints = joints;\r\n    this.tangents = tangents;\r\n  }\r\n}\r\n\r\nexport class GLTFMesh {\r\n  constructor(name, primitives) {\r\n    this.name = name;\r\n    this.primitives = primitives;\r\n  }\r\n}\r\n\r\nexport class GLTFNode {\r\n  constructor(name, mesh, transform, n) {\r\n    this.name = name;\r\n    this.mesh = mesh;\r\n    this.transform = transform;\r\n\r\n    this.gpuUniforms = null;\r\n    this.bindGroup = null;\r\n\r\n    this.children = n.children || [];\r\n  }\r\n\r\n  upload(device) {\r\n    var buf = device.createBuffer(\r\n      {size: 4 * 4 * 4, usage: GPUBufferUsage.UNIFORM, mappedAtCreation: true});\r\n    new Float32Array(buf.getMappedRange()).set(this.transform);\r\n    buf.unmap();\r\n    this.gpuUniforms = buf;\r\n  }\r\n}\r\n\r\nfunction readNodeTransform(node) {\r\n  if(node['matrix']) {\r\n    var m = node['matrix'];\r\n    // Both glTF and gl matrix are column major\r\n    return mat4.fromValues(m[0],\r\n      m[1],\r\n      m[2],\r\n      m[3],\r\n      m[4],\r\n      m[5],\r\n      m[6],\r\n      m[7],\r\n      m[8],\r\n      m[9],\r\n      m[10],\r\n      m[11],\r\n      m[12],\r\n      m[13],\r\n      m[14],\r\n      m[15]);\r\n  } else {\r\n    var scale = [1, 1, 1];\r\n    var rotation = [0, 0, 0, 1];\r\n    var translation = [0, 0, 0];\r\n    if(node['scale']) {\r\n      scale = node['scale'];\r\n    }\r\n    if(node['rotation']) {\r\n      rotation = node['rotation'];\r\n    }\r\n    if(node['translation']) {\r\n      translation = node['translation'];\r\n    }\r\n    var m = mat4.create();\r\n    return mat4.fromRotationTranslationScale(m, rotation, translation, scale);\r\n  }\r\n}\r\n\r\n// function flattenGLTFChildren(nodes, node, parent_transform) {\r\n//   var tfm = readNodeTransform(node);\r\n//   var tfm = mat4.mul(tfm, parent_transform, tfm);\r\n//   node['matrix'] = tfm;\r\n//   node['scale'] = undefined;\r\n//   node['rotation'] = undefined;\r\n//   node['translation'] = undefined;\r\n//   if(node['children']) {\r\n//     for(var i = 0;i < node['children'].length;++i) {\r\n//       flattenGLTFChildren(nodes, nodes[node['children'][i]], tfm);\r\n//     }\r\n//     node['children'] = [];\r\n//   }\r\n// }\r\n\r\nfunction flattenGLTFChildren(nodes, node, parent_transform) {\r\n  var tfm = readNodeTransform(node);\r\n  var tfm = mat4.mul(tfm, parent_transform, tfm);\r\n  node['matrix'] = tfm;\r\n  node['scale'] = undefined;\r\n  node['rotation'] = undefined;\r\n  node['translation'] = undefined;\r\n\r\n  if(node['children']) {\r\n    for(var i = 0;i < node['children'].length;++i) {\r\n      flattenGLTFChildren(nodes, nodes[node['children'][i]], tfm);\r\n    }\r\n    // node['children'] = []; // REMOVE THIS LINE\r\n  }\r\n}\r\n\r\n\r\nfunction makeGLTFSingleLevel(nodes) {\r\n  var rootTfm = mat4.create();\r\n  for(var i = 0;i < nodes.length;++i) {\r\n    flattenGLTFChildren(nodes, nodes[i], rootTfm);\r\n  }\r\n  return nodes;\r\n}\r\n\r\nexport class GLTFMaterial {\r\n  constructor(material, textures) {\r\n    this.baseColorFactor = [1, 1, 1, 1];\r\n    this.baseColorTexture = null;\r\n    // padded to float4\r\n    this.emissiveFactor = [0, 0, 0, 1];\r\n    this.metallicFactor = 1.0;\r\n    this.roughnessFactor = 1.0;\r\n\r\n    if(material['pbrMetallicRoughness'] !== undefined) {\r\n      var pbr = material['pbrMetallicRoughness'];\r\n      if(pbr['baseColorFactor'] !== undefined) {\r\n        this.baseColorFactor = pbr['baseColorFactor'];\r\n      }\r\n      if(pbr['baseColorTexture'] !== undefined) {\r\n        // TODO multiple texcoords\r\n        this.baseColorTexture = textures[pbr['baseColorTexture']['index']];\r\n      }\r\n      if(pbr['metallicFactor'] !== undefined) {\r\n        this.metallicFactor = pbr['metallicFactor'];\r\n      }\r\n      if(pbr['roughnessFactor'] !== undefined) {\r\n        this.roughnessFactor = pbr['roughnessFactor'];\r\n      }\r\n    }\r\n    if(material['emissiveFactor'] !== undefined) {\r\n      this.emissiveFactor[0] = material['emissiveFactor'][0];\r\n      this.emissiveFactor[1] = material['emissiveFactor'][1];\r\n      this.emissiveFactor[2] = material['emissiveFactor'][2];\r\n    }\r\n\r\n    this.gpuBuffer = null;\r\n    this.bindGroupLayout = null;\r\n    this.bindGroup = null;\r\n  }\r\n\r\n  upload(device) {\r\n    var buf = device.createBuffer(\r\n      {size: 3 * 4 * 4, usage: GPUBufferUsage.UNIFORM, mappedAtCreation: true});\r\n    var mappingView = new Float32Array(buf.getMappedRange());\r\n    mappingView.set(this.baseColorFactor);\r\n    mappingView.set(this.emissiveFactor, 4);\r\n    mappingView.set([this.metallicFactor, this.roughnessFactor], 8);\r\n    buf.unmap();\r\n    this.gpuBuffer = buf;\r\n\r\n    var layoutEntries =\r\n      [{binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {type: 'uniform'}}];\r\n    var bindGroupEntries = [{\r\n      binding: 0,\r\n      resource: {\r\n        buffer: this.gpuBuffer,\r\n      }\r\n    }];\r\n\r\n    if(this.baseColorTexture) {\r\n      // Defaults for sampler and texture are fine, just make the objects\r\n      // exist to pick them up\r\n      layoutEntries.push({binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {}});\r\n      layoutEntries.push({binding: 2, visibility: GPUShaderStage.FRAGMENT, texture: {}});\r\n\r\n      bindGroupEntries.push({\r\n        binding: 1,\r\n        resource: this.baseColorTexture.sampler,\r\n      });\r\n      bindGroupEntries.push({\r\n        binding: 2,\r\n        resource: this.baseColorTexture.imageView,\r\n      });\r\n    }\r\n\r\n    this.bindGroupLayout = device.createBindGroupLayout({entries: layoutEntries});\r\n\r\n    this.bindGroup = device.createBindGroup({\r\n      layout: this.bindGroupLayout,\r\n      entries: bindGroupEntries,\r\n    });\r\n  }\r\n}\r\n\r\nexport class GLTFSampler {\r\n  constructor(sampler, device) {\r\n    var magFilter = sampler['magFilter'] === undefined ||\r\n      sampler['magFilter'] == GLTFTextureFilter.LINEAR\r\n      ? 'linear'\r\n      : 'nearest';\r\n    var minFilter = sampler['minFilter'] === undefined ||\r\n      sampler['minFilter'] == GLTFTextureFilter.LINEAR\r\n      ? 'linear'\r\n      : 'nearest';\r\n\r\n    var wrapS = 'repeat';\r\n    if(sampler['wrapS'] !== undefined) {\r\n      if(sampler['wrapS'] == GLTFTextureFilter.REPEAT) {\r\n        wrapS = 'repeat';\r\n      } else if(sampler['wrapS'] == GLTFTextureFilter.CLAMP_TO_EDGE) {\r\n        wrapS = 'clamp-to-edge';\r\n      } else {\r\n        wrapS = 'mirror-repeat';\r\n      }\r\n    }\r\n\r\n    var wrapT = 'repeat';\r\n    if(sampler['wrapT'] !== undefined) {\r\n      if(sampler['wrapT'] == GLTFTextureFilter.REPEAT) {\r\n        wrapT = 'repeat';\r\n      } else if(sampler['wrapT'] == GLTFTextureFilter.CLAMP_TO_EDGE) {\r\n        wrapT = 'clamp-to-edge';\r\n      } else {\r\n        wrapT = 'mirror-repeat';\r\n      }\r\n    }\r\n\r\n    this.sampler = device.createSampler({\r\n      magFilter: magFilter,\r\n      minFilter: minFilter,\r\n      addressModeU: wrapS,\r\n      addressModeV: wrapT,\r\n    });\r\n  }\r\n}\r\n\r\nexport class GLTFTexture {\r\n  constructor(sampler, image) {\r\n    this.gltfsampler = sampler;\r\n    this.sampler = sampler.sampler;\r\n    this.image = image;\r\n    this.imageView = image.createView();\r\n  }\r\n}\r\n\r\nexport class GLBModel {\r\n  constructor(nodes, skins, skinnedMeshNodes, glbJsonData, glbBinaryBuffer,noSkinMeshNodes) {\r\n    this.noSkinMeshNodes = noSkinMeshNodes;\r\n    this.nodes = nodes;\r\n    this.skins = skins;\r\n    this.skinnedMeshNodes = skinnedMeshNodes;\r\n    this.bvhToGLBMap = null;\r\n    this.glbJsonData = glbJsonData;\r\n    this.glbBinaryBuffer = glbBinaryBuffer;\r\n  }\r\n};\r\n\r\n// function getComponentSize(componentType) {\r\n//   switch(componentType) {\r\n//     case 5126: return 4; // float32\r\n//     case 5123: return 2; // uint16\r\n//     case 5121: return 1; // uint8\r\n//     default: throw new Error(\"Unknown componentType: \" + componentType);\r\n//   }\r\n// }\r\n\r\n// Upload a GLB model and return it\r\nexport async function uploadGLBModel(buffer, device) {\r\n  // 1\uFE0F\u20E3 Validate header\r\n  const header = new Uint32Array(buffer, 0, 5);\r\n  if(header[0] !== 0x46546C67) {\r\n    alert('This does not appear to be a glb file?');\r\n    return;\r\n  }\r\n\r\n  // 2\uFE0F\u20E3 JSON chunk\r\n  const glbJsonData = JSON.parse(\r\n    new TextDecoder('utf-8').decode(new Uint8Array(buffer, 20, header[3]))\r\n  );\r\n\r\n  // 3\uFE0F\u20E3 Binary chunk header + buffer\r\n  const binaryHeader = new Uint32Array(buffer, 20 + header[3], 2);\r\n  const glbBuffer = new GLTFBuffer(buffer, binaryHeader[0], 28 + header[3]);\r\n\r\n  // 4\uFE0F\u20E3 BufferViews\r\n  const bufferViews = glbJsonData.bufferViews.map(\r\n    v => new GLTFBufferView(glbBuffer, v)\r\n  );\r\n\r\n  const binaryOffset = 28 + header[3];\r\n  const binaryLength = binaryHeader[0];\r\n\r\n  // \u2705 raw ArrayBuffer slice of the binary chunk:\r\n  const glbBinaryBuffer = buffer.slice(binaryOffset, binaryOffset + binaryLength);\r\n\r\n  // 5\uFE0F\u20E3 Load images\r\n  const images = [];\r\n  if(glbJsonData.images) {\r\n    for(const imgJson of glbJsonData.images) {\r\n      const view = new GLTFBufferView(\r\n        glbBuffer,\r\n        glbJsonData.bufferViews[imgJson.bufferView]\r\n      );\r\n      const blob = new Blob([view.buffer], {type: imgJson['mime/type']});\r\n      const img = await createImageBitmap(blob);\r\n      const gpuImg = device.createTexture({\r\n        size: [img.width, img.height, 1],\r\n        format: 'rgba8unorm-srgb',\r\n        usage:\r\n          GPUTextureUsage.TEXTURE_BINDING |\r\n          GPUTextureUsage.COPY_DST |\r\n          GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n      device.queue.copyExternalImageToTexture(\r\n        {source: img},\r\n        {texture: gpuImg},\r\n        [img.width, img.height, 1]\r\n      );\r\n      images.push(gpuImg);\r\n    }\r\n  }\r\n\r\n  glbJsonData.glbTextures = images;\r\n  // console.log('IMAGES FROM GLB: ', images)\r\n  // 6\uFE0F\u20E3 Samplers, Textures, Materials\r\n  const defaultSampler = new GLTFSampler({}, device);\r\n  const samplers = (glbJsonData.samplers || []).map(\r\n    s => new GLTFSampler(s, device)\r\n  );\r\n  const textures = (glbJsonData.textures || []).map(tex => {\r\n    const sampler =\r\n      tex.sampler !== undefined ? samplers[tex.sampler] : defaultSampler;\r\n    return new GLTFTexture(sampler, images[tex.source]);\r\n  });\r\n\r\n  const defaultMaterial = new GLTFMaterial({});\r\n  const materials = (glbJsonData.materials || []).map(\r\n    m => new GLTFMaterial(m, textures)\r\n  );\r\n\r\n  // 7\uFE0F\u20E3 Meshes\r\n  const meshes = (glbJsonData.meshes || []).map(mesh => {\r\n    const primitives = mesh.primitives.map(prim => {\r\n      const topology = prim.mode ?? GLTFRenderMode.TRIANGLES;\r\n      // console.log('topology ', topology)\r\n      // Indices\r\n      let indices = null;\r\n      if(prim.indices !== undefined) {\r\n        const accessor = glbJsonData.accessors[prim.indices];\r\n        const viewID = accessor.bufferView;\r\n        bufferViews[viewID].needsUpload = true;\r\n        bufferViews[viewID].addUsage(GPUBufferUsage.INDEX);\r\n        indices = new GLTFAccessor(bufferViews[viewID], accessor);\r\n      }\r\n      // Vertex attributes\r\n      let positions = null,\r\n        normals = null,\r\n        tangents = null,\r\n        texcoords = [];\r\n      let weights = null;\r\n      let joints = null;\r\n      for(const attr in prim.attributes) {\r\n        const accessor = glbJsonData.accessors[prim.attributes[attr]];\r\n        const viewID = accessor.bufferView;\r\n        bufferViews[viewID].needsUpload = true;\r\n        bufferViews[viewID].addUsage(GPUBufferUsage.VERTEX);\r\n        if(attr === 'POSITION') {\r\n          positions = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else if(attr === 'NORMAL') {\r\n          normals = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else if(attr.startsWith('TEXCOORD')) {\r\n          texcoords.push(new GLTFAccessor(bufferViews[viewID], accessor));\r\n        } else if(attr === 'WEIGHTS_0') {\r\n          weights = new GLTFAccessor(bufferViews[viewID], accessor, prim.attributes['WEIGHTS_0']);\r\n        } else if(attr.startsWith('JOINTS')) {\r\n          joints = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else if(attr === 'TANGENT') {\r\n          tangents = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else {\r\n          console.log('unknow-attr:', attr)\r\n        }\r\n      }\r\n\r\n      const material = prim.material !== undefined ? materials[prim.material] : defaultMaterial;\r\n      return new GLTFPrimitive(\r\n        indices,\r\n        positions,\r\n        normals,\r\n        texcoords,\r\n        material,\r\n        topology,\r\n        weights,\r\n        joints,\r\n        tangents\r\n      );\r\n    });\r\n    return new GLTFMesh(mesh.name, primitives);\r\n  });\r\n\r\n  // Upload buffers & materials\r\n  for(const bv of bufferViews) if(bv.needsUpload) bv.upload(device);\r\n  defaultMaterial.upload(device);\r\n  for(const m of materials) m.upload(device);\r\n  // 8\uFE0F\u20E3 Skins (we only store the index of inverseBindMatrices here)\r\n  const skins = (glbJsonData.skins || []).map(skin => ({\r\n    name: skin.name,\r\n    joints: skin.joints,\r\n    inverseBindMatrices: skin.inverseBindMatrices, // accessor index\r\n  }));\r\n  // 9\uFE0F\u20E3 Nodes\r\n  const nodes = [];\r\n  const gltfNodes = makeGLTFSingleLevel(glbJsonData.nodes);\r\n  for(let i = 0;i < gltfNodes.length;i++) {\r\n    const n = gltfNodes[i];\r\n    const meshObj = n.mesh !== undefined ? meshes[n.mesh] : null;\r\n    const node = new GLTFNode(n.name, meshObj, readNodeTransform(n), n);\r\n\r\n    if(n.skin !== undefined) node.skin = n.skin; // skin index\r\n    node.upload(device);\r\n    nodes.push(node);\r\n  }\r\n\r\n  // \uD83D\uDFE9 Build parent references:\r\n  for(let i = 0;i < gltfNodes.length;i++) {\r\n    const srcNode = gltfNodes[i];\r\n    // srcNode.children is an array of indices\r\n    if(srcNode.children) {\r\n      for(const childIndex of srcNode.children) {\r\n        nodes[childIndex].parent = i;   // add .parent to the child node\r\n      }\r\n    }\r\n  }\r\n  // Ensure nodes without parent are root nodes\r\n  for(const node of nodes) {\r\n    if(node.parent === undefined) node.parent = null;\r\n  }\r\n  const skinnedMeshNodes = nodes.filter(\r\n    n => n.mesh && n.skin !== undefined\r\n  );\r\n  let noSkinMeshNodes = null;\r\n\r\n  if(skinnedMeshNodes.length === 0) {\r\n    console.warn('No skins found \u2014 mesh not bound to skeleton');\r\n    noSkinMeshNodes = nodes.filter(n => n.mesh);\r\n  } else {\r\n    skinnedMeshNodes.forEach(n => {\r\n      // console.log('Mesh', n.mesh.name, 'uses skin index', n.skin);\r\n      // Per-mesh uniform buffer (example)\r\n      n.sceneUniformBuffer = device.createBuffer({\r\n        size: 44 * 4,\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n    });\r\n  }\r\n  let R = new GLBModel(nodes, skins, skinnedMeshNodes, glbJsonData, glbBinaryBuffer, noSkinMeshNodes)\r\n  return R;\r\n}\r\n", "import MEBvh from \"bvh-loader\";\r\nimport MEMeshObj from \"../mesh-obj\";\r\nimport {mat4, vec3, quat} from \"wgpu-matrix\";\r\n// import {degToRad} from \"../utils.js\";\r\nimport {GLTFBuffer} from \"./webgpu-gltf.js\";\r\n\r\nexport var animBVH = new MEBvh();\r\n\r\nexport let loadBVH = (path) => {\r\n  return new Promise((resolve, reject) => {\r\n    animBVH.parse_file(path).then(() => {\r\n      console.info(\"plot_hierarchy no function\")\r\n      animBVH.plot_hierarchy();\r\n      var r = animBVH.frame_pose(0);\r\n      // Not in use at the moment next feature - change skeletal or indipended new class.\r\n      // console.log(\"FINAL P => \", r[0].length)\r\n      // console.log(\"FINAL R => \", r[1].length)\r\n      var KEYS = animBVH.joint_names();\r\n      for(var x = 0;x < r[0].length;x++) {\r\n        // console.log(\"->\" + KEYS[x] + \"-> position: \" + r[0][x] + \" rotation: \" + r[1][x]);\r\n      }\r\n      var all = animBVH.all_frame_poses();\r\n      // console.log(\"Final All -> \", all);\r\n      resolve(animBVH);\r\n    }).catch((err) => {reject(err)});\r\n  })\r\n}\r\n\r\n/**\r\n * @description\r\n * Skinning basic done animation can be changed with animation index.\r\n * Holder for GLB model with skinning.\r\n * @param {GLBModel} glb - Your loaded GLB\r\n * @param {Object} bvhBones - Mapping of boneName \u2192 BVH bone data\r\n * @param {GPUDevice} device - WebGPU device\r\n * @credits Chatgpt assist here.\r\n */\r\nexport class BVHPlayer extends MEMeshObj {\r\n  constructor(o, bvh, glb, primitiveIndex, skinnedNodeIndex, canvas, device, context, inputHandler, globalAmbient) {\r\n    super(canvas, device, context, o, inputHandler, globalAmbient, glb, primitiveIndex, skinnedNodeIndex);\r\n    // bvh arg not actula at the moment\r\n    this.bvh = {};\r\n    this.glb = glb;\r\n    this.currentFrame = 0;\r\n    this.fps = 30;\r\n    this.timeAccumulator = 0;\r\n    // debug\r\n    this.scaleBoneTest = 1;\r\n    this.primitiveIndex = primitiveIndex;\r\n    if(!this.bvh.sharedState) {this.bvh.sharedState = {currentFrame: 0, timeAccumulator: 0};}\r\n    this.sharedState = this.bvh.sharedState;\r\n    // Reference to the skinned node containing all bones\r\n    this.skinnedNode = this.glb.skinnedMeshNodes[skinnedNodeIndex];\r\n    // console.log('this.skinnedNode', this.skinnedNode)\r\n    this.nodeWorldMatrices = Array.from(\r\n      {length: this.glb.nodes.length},\r\n      () => mat4.identity()\r\n    );\r\n    this.startTime = performance.now() / 1000; // seconds - anim speed control\r\n    this.MAX_BONES = 100; // predefined\r\n    this.skeleton = []; // array of joint node indices\r\n    this.animationSpeed = 1000;\r\n    this.inverseBindMatrices = []; // Float32Array for each joint\r\n    this.initInverseBindMatrices();\r\n    this.makeSkeletal();\r\n  }\r\n\r\n  makeSkeletal() {\r\n    let skin = this.glb.skins[0];\r\n    const accessorIndex = skin.inverseBindMatrices;\r\n    if(accessorIndex == null) {\r\n      console.warn(\"No inverseBindMatrices, using identity matrices\");\r\n    }\r\n    // 1. Load all inverse bind matrices once\r\n    const invBindArray = this.inverseBindMatrices; // set earlier by initInverseBindMatrices()\r\n    // 2. Build skeleton array from skin.joints only\r\n    this.skeleton = skin.joints.slice(); // direct copy of indices\r\n    // 3. Assign inverseBindMatrix to each joint node correctly\r\n    for(let i = 0;i < skin.joints.length;i++) {\r\n      const jointIndex = skin.joints[i];\r\n      const jointNode = this.glb.nodes[jointIndex];\r\n      // assign only to bone nodes\r\n      jointNode.inverseBindMatrix = invBindArray.slice(i * 16, (i + 1) * 16);\r\n      // decompose node\u2019s transform once (if not already)\r\n      if(!jointNode.transform) {\r\n        jointNode.transform = new Float32Array([\r\n          1, 0, 0, 0,\r\n          0, 1, 0, 0,\r\n          0, 0, 1, 0,\r\n          0, 0, 0, 1\r\n        ]);\r\n      }\r\n      if(!jointNode.translation || !jointNode.rotation || !jointNode.scale) {\r\n        const {translation, rotation, scale} = this.decomposeMatrix(jointNode.transform);\r\n        jointNode.translation = translation;\r\n        jointNode.rotation = rotation;\r\n        jointNode.scale = scale;\r\n      }\r\n    }\r\n    // 4. For mesh nodes or armature parent nodes, leave them alone\r\n    // what is animation , check is it more - we look for Armature by defoult \r\n    // friendly blender\r\n    this.glb.animationIndex = 0;\r\n    for(let j = 0;j < this.glb.glbJsonData.animations.length;j++) {\r\n      if(this.glb.glbJsonData.animations[j].name.indexOf('Armature') !== -1) {\r\n        this.glb.animationIndex = j;\r\n      }\r\n    }\r\n  }\r\n\r\n  initInverseBindMatrices(skinIndex = 0) {\r\n    const skin = this.glb.skins[skinIndex];\r\n    const invBindAccessorIndex = skin.inverseBindMatrices; // number\r\n    if(invBindAccessorIndex === undefined || invBindAccessorIndex === null) {\r\n      console.warn('No inverseBindMatrices accessor for skin', skinIndex);\r\n      return;\r\n    }\r\n    const invBindArray = this.getAccessorArray(this.glb, invBindAccessorIndex);\r\n    // \u2705 store directly as typed array (one big contiguous Float32Array)\r\n    this.inverseBindMatrices = invBindArray;\r\n  }\r\n\r\n  playAnimationByIndex = (animationIndex) => {\r\n    this.glb.animationIndex = animationIndex;\r\n  }\r\n\r\n  playAnimationByName = (animationName) => {\r\n    const animations = this.glb.glbJsonData.animations;\r\n    const index = animations.findIndex(\r\n      anim => anim.name === animationName\r\n    );\r\n    if(index === -1) {\r\n      console.warn(`Animation '${animationName}' not found`);\r\n      return;\r\n    }\r\n    this.glb.animationIndex = index;\r\n  };\r\n\r\n  getNumberOfFramesCurAni() {\r\n    let anim = this.glb.glbJsonData.animations[this.glb.animationIndex]\r\n    const sampler = anim.samplers[0];\r\n    const inputAccessor = this.glb.glbJsonData.accessors[sampler.input];\r\n    const numFrames = inputAccessor.count;\r\n    return numFrames;\r\n  }\r\n\r\n  update(deltaTime) {\r\n    const frameTime = 1 / this.fps;\r\n    this.sharedState.timeAccumulator += deltaTime;\r\n    while(this.sharedState.timeAccumulator >= frameTime) {\r\n      this.sharedState.currentFrame = (this.sharedState.currentFrame + 1) % this.getNumberOfFramesCurAni();\r\n      this.sharedState.timeAccumulator -= frameTime;\r\n    }\r\n    // const frame = this.sharedState.currentFrame;\r\n    const currentTime = performance.now() / this.animationSpeed - this.startTime;\r\n    const boneMatrices = new Float32Array(this.MAX_BONES * 16);\r\n    if(this.glb.glbJsonData.animations && this.glb.glbJsonData.animations.length > 0) {\r\n      this.updateSingleBoneCubeAnimation(this.glb.glbJsonData.animations[this.glb.animationIndex], this.glb.nodes, currentTime, boneMatrices)\r\n    }\r\n  }\r\n\r\n  getAccessorArray(glb, accessorIndex) {\r\n    const accessor = glb.glbJsonData.accessors[accessorIndex];\r\n    const bufferView = glb.glbJsonData.bufferViews[accessor.bufferView];\r\n    const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n    const byteLength =\r\n      accessor.count *\r\n      this.getNumComponents(accessor.type) *\r\n      (accessor.componentType === 5126 ? 4 : 2); // adjust per type\r\n    const bufferDef = glb.glbBinaryBuffer;\r\n    // \u2705 now just slice:\r\n    const slice = this.getBufferSlice(bufferDef, byteOffset, byteLength);\r\n    switch(accessor.componentType) {\r\n      case 5126: // FLOAT\r\n        return new Float32Array(slice);\r\n      case 5123: // UNSIGNED_SHORT\r\n        return new Uint16Array(slice);\r\n      case 5121: // UNSIGNED_BYTE\r\n        return new Uint8Array(slice);\r\n      default:\r\n        throw new Error(\"Unsupported componentType: \" + accessor.componentType);\r\n    }\r\n  }\r\n\r\n  getAccessorTypeForChannel(path) {\r\n    switch(path) {\r\n      case \"translation\": return \"VEC3\";\r\n      case \"rotation\": return \"VEC4\";\r\n      case \"scale\": return \"VEC3\";\r\n      case \"weights\": return \"VECN\"; // if needed\r\n      default: throw new Error(\"Unknown channel path: \" + path);\r\n    }\r\n  }\r\n\r\n  getNumComponents(type) {\r\n    switch(type) {\r\n      case \"SCALAR\": return 1;\r\n      case \"VEC2\": return 2;\r\n      case \"VEC3\": return 3;\r\n      case \"VEC4\": return 4;\r\n      case \"MAT4\": return 16;\r\n      default: throw new Error(\"Unknown type: \" + type);\r\n    }\r\n  }\r\n\r\n  getComponentSize(componentType) {\r\n    switch(componentType) {\r\n      case 5126: return 4; // float32\r\n      case 5123: return 2; // uint16\r\n      case 5121: return 1; // uint8\r\n      default: throw new Error(\"Unknown componentType: \" + componentType);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  @description\r\n   *  Get a typed slice of the raw binary buffer from glTF buffer definitions.\r\n   * @param {Object} bufferDef - the glTF buffer definition (usually gltfJson.buffers[0])\r\n   * @param {Number} byteOffset - byte offset into the buffer\r\n   * @param {Number} byteLength - byte length to slice\r\n   * @returns {ArrayBuffer} sliced array buffer\r\n   **/\r\n  getBufferSlice(bufferDef, byteOffset, byteLength) {\r\n    // GLTFBuffer instance:\r\n    if(bufferDef instanceof GLTFBuffer) {\r\n      // Use .arrayBuffer + .byteOffset:\r\n      return bufferDef.arrayBuffer.slice(\r\n        bufferDef.byteOffset + (byteOffset || 0),\r\n        bufferDef.byteOffset + (byteOffset || 0) + byteLength\r\n      );\r\n    }\r\n\r\n    // Already have a raw ArrayBuffer:\r\n    if(bufferDef instanceof ArrayBuffer) {\r\n      return bufferDef.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n\r\n    // Some loaders store it as .data or ._data:\r\n    if(bufferDef && bufferDef.data instanceof ArrayBuffer) {\r\n      return bufferDef.data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n    if(bufferDef && bufferDef._data instanceof ArrayBuffer) {\r\n      return bufferDef._data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n\r\n    throw new Error(\"No binary data found in GLB buffer[0]\");\r\n  }\r\n\r\n  // --- helpers\r\n  lerpVec(a, b, t) {\r\n    return a.map((v, i) => v * (1 - t) + b[i] * t);\r\n  }\r\n\r\n  // Example quaternion slerp (a,b = [x,y,z,w])\r\n  quatSlerp(a, b, t) {\r\n    // naive slerp for small demo, normalize result\r\n    let dot = a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n    if(dot < 0) {b = b.map(v => -v); dot = -dot;}\r\n    if(dot > 0.9995) return lerpVec(a, b, t);\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n    return a.map((v, i) => s0 * v + s1 * b[i]);\r\n  }\r\n\r\n  // naive quaternion to 4x4 matrix\r\n  quatToMat4(q) {\r\n    const [x, y, z, w] = q;\r\n    const xx = x * x, yy = y * y, zz = z * z;\r\n    const xy = x * y, xz = x * z, yz = y * z, wx = w * x, wy = w * y, wz = w * z;\r\n    return new Float32Array([\r\n      1 - 2 * (yy + zz), 2 * (xy + wz), 2 * (xz - wy), 0,\r\n      2 * (xy - wz), 1 - 2 * (xx + zz), 2 * (yz + wx), 0,\r\n      2 * (xz + wy), 2 * (yz - wx), 1 - 2 * (xx + yy), 0,\r\n      0, 0, 0, 1\r\n    ]);\r\n  }\r\n\r\n  // Compose TRS to a 4\u00D74\r\n  composeMatrix(translation, rotationQuat, scale) {\r\n    const m = mat4.identity();\r\n    mat4.translate(m, translation, m);\r\n    const rot = mat4.fromQuat(rotationQuat);\r\n    mat4.multiply(m, rot, m);\r\n    mat4.scale(m, scale, m);\r\n    return m;\r\n\r\n    // const m = mat4.identity();\r\n    // mat4.translate(m, translation, m);\r\n    // const rot = mat4.fromQuat(rotationQuat);\r\n    // mat4.multiply(m, rot, m);\r\n    // mat4.scale(m, scale, m);\r\n\r\n    // // Flip Y globally\r\n    // const flipY = mat4.identity();\r\n    // mat4.scale(flipY, [1, 1, -1], flipY);\r\n    // mat4.multiply(m, flipY, m);\r\n\r\n    // return m;\r\n\r\n  }\r\n\r\n  decomposeMatrix(m) {\r\n    // m is column-major: indices:\r\n    // [ m0 m4 m8  m12\r\n    //   m1 m5 m9  m13\r\n    //   m2 m6 m10 m14\r\n    //   m3 m7 m11 m15 ]\r\n    const t = new Float32Array([m[12], m[13], m[14]]);\r\n\r\n    // Extract the 3 column vectors (upper-left 3x3)\r\n    const cx = [m[0], m[1], m[2]];\r\n    const cy = [m[4], m[5], m[6]];\r\n    const cz = [m[8], m[9], m[10]];\r\n\r\n    // Lengths = scales\r\n    const len = v => Math.hypot(v[0], v[1], v[2]);\r\n    let sx = len(cx), sy = len(cy), sz = len(cz);\r\n\r\n    // If any scale nearly zero, avoid divide-by-zero\r\n    if(sx === 0) sx = 1.0;\r\n    if(sy === 0) sy = 1.0;\r\n    if(sz === 0) sz = 1.0;\r\n\r\n    // Normalize columns to produce a pure rotation matrix\r\n    const r00 = m[0] / sx, r01 = m[4] / sy, r02 = m[8] / sz;\r\n    const r10 = m[1] / sx, r11 = m[5] / sy, r12 = m[9] / sz;\r\n    const r20 = m[2] / sx, r21 = m[6] / sy, r22 = m[10] / sz;\r\n\r\n    // Fix negative-scale (reflection) case: if determinant < 0, flip sign of one scale and corresponding column\r\n    const det3 = r00 * (r11 * r22 - r12 * r21) - r01 * (r10 * r22 - r12 * r20) + r02 * (r10 * r21 - r11 * r20);\r\n    if(det3 < 0) {\r\n      // flip Z\r\n      sz = -sz;\r\n      // flip third column sign\r\n      // multiply cz by -1 => r02,r12,r22 *= -1\r\n      // recompute normalized r* accordingly:\r\n      // since we only need a valid rotation matrix for quaternion conversion,\r\n      // just invert the third column\r\n      // (alternatively flip sx or sy\u2014this is a convention choice)\r\n      // Here we flip the third column:\r\n      // r02 = -r02; r12 = -r12; r22 = -r22;\r\n    }\r\n\r\n    // Build quaternion from rotation matrix (r00..r22)\r\n    // Using standard conversion (column-major rotation)\r\n    const trace = r00 + r11 + r22;\r\n    let qx, qy, qz, qw;\r\n    if(trace > 0.00001) {\r\n      const s = Math.sqrt(trace + 1.0) * 2; // s=4*qw\r\n      qw = 0.25 * s;\r\n      qx = (r21 - r12) / s;\r\n      qy = (r02 - r20) / s;\r\n      qz = (r10 - r01) / s;\r\n    } else if(r00 > r11 && r00 > r22) {\r\n      const s = Math.sqrt(1.0 + r00 - r11 - r22) * 2; // s=4*qx\r\n      qw = (r21 - r12) / s;\r\n      qx = 0.25 * s;\r\n      qy = (r01 + r10) / s;\r\n      qz = (r02 + r20) / s;\r\n    } else if(r11 > r22) {\r\n      const s = Math.sqrt(1.0 + r11 - r00 - r22) * 2; // s=4*qy\r\n      qw = (r02 - r20) / s;\r\n      qx = (r01 + r10) / s;\r\n      qy = 0.25 * s;\r\n      qz = (r12 + r21) / s;\r\n    } else {\r\n      const s = Math.sqrt(1.0 + r22 - r00 - r11) * 2; // s=4*qz\r\n      qw = (r10 - r01) / s;\r\n      qx = (r02 + r20) / s;\r\n      qy = (r12 + r21) / s;\r\n      qz = 0.25 * s;\r\n    }\r\n\r\n    const rot = new Float32Array([qx, qy, qz, qw]);\r\n    const scale = new Float32Array([sx, sy, sz]);\r\n    return {translation: t, rotation: rot, scale: scale};\r\n  }\r\n\r\n  slerp(q0, q1, t, out) {\r\n    let dot = q0[0] * q1[0] + q0[1] * q1[1] + q0[2] * q1[2] + q0[3] * q1[3];\r\n    if(dot < 0) {dot = -dot; q1 = [-q1[0], -q1[1], -q1[2], -q1[3]];}\r\n\r\n    if(dot > 0.9995) {\r\n      // linear\r\n      for(let i = 0;i < 4;i++) out[i] = q0[i] + t * (q1[i] - q0[i]);\r\n      // normalize\r\n      const len = Math.hypot(...out);\r\n      for(let i = 0;i < 4;i++) out[i] /= len;\r\n      return;\r\n    }\r\n\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n\r\n    for(let i = 0;i < 4;i++) {\r\n      out[i] = s0 * q0[i] + s1 * q1[i];\r\n    }\r\n  }\r\n\r\n  updateSingleBoneCubeAnimation(glbAnimation, nodes, time, boneMatrices) {\r\n    const channels = glbAnimation.channels;\r\n    const samplers = glbAnimation.samplers;\r\n    // --- Map channels per node for faster lookup\r\n    const nodeChannels = new Map();\r\n    for(const channel of channels) {\r\n      if(!nodeChannels.has(channel.target.node)) nodeChannels.set(channel.target.node, []);\r\n      nodeChannels.get(channel.target.node).push(channel);\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const nodeIndex = this.skeleton[j];\r\n      const node = nodes[nodeIndex];\r\n\r\n      // --- Initialize node TRS if needed\r\n      if(!node.translation) node.translation = new Float32Array([0, 0, 0]);\r\n      if(!node.rotation) node.rotation = quat.create();\r\n      if(!node.scale) node.scale = new Float32Array([1, 1, 1]);\r\n\r\n      // --- Keep original TRS for additive animation\r\n      if(!node.originalTranslation) node.originalTranslation = node.translation.slice();\r\n      if(!node.originalRotation) node.originalRotation = node.rotation.slice();\r\n      if(!node.originalScale) node.originalScale = node.scale.slice();\r\n\r\n      const channelsForNode = nodeChannels.get(nodeIndex) || [];\r\n\r\n      for(const channel of channelsForNode) {\r\n        const path = channel.target.path; // \"translation\" | \"rotation\" | \"scale\"\r\n        const sampler = samplers[channel.sampler];\r\n        // --- Get input/output arrays\r\n        const inputTimes = this.getAccessorArray(this.glb, sampler.input);\r\n        const outputArray = this.getAccessorArray(this.glb, sampler.output);\r\n        const numComponents = path === \"rotation\" ? 4 : 3;\r\n        // --- Find keyframe interval\r\n        const animTime = time % inputTimes[inputTimes.length - 1];\r\n        let i = 0;\r\n        while(i < inputTimes.length - 1 && inputTimes[i + 1] <= animTime) i++;\r\n        const t0 = inputTimes[i];\r\n        const t1 = inputTimes[Math.min(i + 1, inputTimes.length - 1)];\r\n        const factor = t1 !== t0 ? (animTime - t0) / (t1 - t0) : 0;\r\n        // --- Interpolated keyframe values\r\n        const v0 = outputArray.subarray(i * numComponents, (i + 1) * numComponents);\r\n        const v1 = outputArray.subarray(\r\n          Math.min(i + 1, inputTimes.length - 1) * numComponents,\r\n          Math.min(i + 2, inputTimes.length) * numComponents\r\n        );\r\n        // --- Apply animation\r\n        if(path === \"translation\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.translation[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"scale\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.scale[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"rotation\") {\r\n          this.slerp(v0, v1, factor, node.rotation);\r\n        }\r\n      }\r\n      // --- Recompose local transform\r\n      node.transform = this.composeMatrix(node.translation, node.rotation, node.scale);\r\n    }\r\n    const computeWorld = (nodeIndex) => {\r\n      const node = nodes[nodeIndex];\r\n      if(!node.worldMatrix) node.worldMatrix = mat4.create();\r\n      let parentWorld = node.parent !== null ? nodes[node.parent].worldMatrix : null;\r\n      if(parentWorld) {\r\n        // multiply parent * local\r\n        mat4.multiply(parentWorld, node.transform, node.worldMatrix);\r\n      } else {\r\n        mat4.copy(node.transform, node.worldMatrix);\r\n      }\r\n\r\n      // maybe no need to exist...\r\n      mat4.scale(node.worldMatrix, [this.scaleBoneTest, this.scaleBoneTest, this.scaleBoneTest], node.worldMatrix);\r\n\r\n      if(node.children) {\r\n        for(const childIndex of node.children) computeWorld(childIndex);\r\n      }\r\n    };\r\n    for(let i = 0;i < nodes.length;i++) {\r\n      if(nodes[i].parent === null || nodes[i].parent === undefined) {\r\n        computeWorld(i);\r\n      }\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const jointNode = nodes[this.skeleton[j]];\r\n      const finalMat = mat4.create();\r\n      mat4.multiply(jointNode.worldMatrix, jointNode.inverseBindMatrix, finalMat);\r\n      boneMatrices.set(finalMat, j * 16);\r\n    }\r\n    // --- Upload to GPU\r\n    this.device.queue.writeBuffer(this.bonesBuffer, 0, boneMatrices);\r\n    return boneMatrices;\r\n  }\r\n}", "export const pointerEffect = `\r\nstruct Camera {\r\n  viewProjMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct Model {\r\n  modelMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(1) var<uniform> model : Model;\r\n\r\nstruct VertexInput {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) v_uv : vec2<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VertexInput) -> VSOut {\r\n  var out : VSOut;\r\n  let worldPos = model.modelMatrix * vec4<f32>(input.position,1.0);\r\n  out.Position = camera.viewProjMatrix * worldPos;\r\n  out.v_uv = input.uv;\r\n  return out;\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  // Center the UVs (0.0\u20131.0 \u2192 -1.0\u20131.0)\r\n  let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n\r\n  // Distance from center\r\n  let dist = length(uv);\r\n\r\n  // Glow falloff\r\n  let glow = exp(-dist * 1.0); // try values 3.0\u20136.0 for tighter glow\r\n\r\n  // Gradient color (inner bright \u2192 outer dim)\r\n  let baseColor = vec3<f32>(0.2, 0.7, 1.0);\r\n  let glowColor = vec3<f32>(0.7, 0.9, 1.0);\r\n\r\n  // Blend based on glow strength\r\n  let color = mix(baseColor, glowColor, glow) * glow;\r\n\r\n  return vec4<f32>(color, 1.0);\r\n}`;", "import {mat4} from \"wgpu-matrix\";\r\nimport {pointerEffect} from \"../../shaders/standalone/pointer.effect.js\";\r\n\r\nexport class PointerEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    // fiktive \r\n    this.enabled = true;\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Vertex data: simple quad\r\n    let S = 10;\r\n    const vertexData = new Float32Array([\r\n      -0.5 * S, 0.5 * S, 0.0 * S,  // top-left\r\n      0.5 * S, 0.5 * S, 0.0 * S,  // top-right\r\n      -0.1 * S, -0.1 * S, 0.0 * S,  // bottom-left\r\n      0.1 * S, -0.1 * S, 0.0 * S,  // bottom-right\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 0, 1, 0, 0, 1, 1, 1\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([\r\n      0, 2, 1,\r\n      1, 2, 3\r\n    ]);\r\n\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: pointerEffect});\r\n\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: true, depthCompare: 'always', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  draw(pass, cameraMatrix, modelMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, modelMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n      const objPos = mesh.position;\r\n      const modelMatrix = mat4.identity();\r\n      mat4.translate(modelMatrix, [objPos.x, objPos.y + 60, objPos.z], modelMatrix);\r\n      this.draw(transPass, viewProjMatrix, modelMatrix);\r\n  }\r\n}", "export let fragmentWGSLInstanced = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n    alpha     : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\n// RPG or any other usage [selected obj effect]\r\n@group(2) @binding(0) var<uniform> uSelected : f32;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n    @location(4) colorMult : vec4f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    \r\n    // \u2705 Get alpha from texture and material factor\r\n    // let alpha = texColor.a * material.baseColorFactor.a;\r\n    let alpha = material.baseColorFactor.a;\r\n    \r\n    return PBRMaterialData(baseColor, metallic, roughness, alpha);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n    return material.baseColor * light.color * light.intensity * NdotL;\r\n    // return material.baseColor * light.color * light.intensity * NdotL;\r\n}\r\n\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    // coneAtten = 1.0;\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    // return (diffuse + specular) * radiance * NdotL * coneAtten;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    // \u2705 Early discard for fully transparent pixels (alpha cutoff)\r\n    if (materialData.alpha < 0.01) {\r\n        discard;\r\n    }\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    var finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n\r\n    // Apply per-instance tint\r\n    finalColor *= input.colorMult.rgb;\r\n\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    let fresnel = pow(1.0 - max(dot(N, V), 0.0), 3.0);\r\n\r\n    if (uSelected > 0.5) {\r\n        let glowColor = vec3f(0.2, 0.8, 1.0);\r\n        finalColor += glowColor * fresnel * 0.1;\r\n    }\r\n\r\n    // let alpha = input.colorMult.a; // use alpha for blending\r\n    // return vec4f(finalColor, alpha);\r\n\r\n    let alpha = mix(materialData.alpha, 1.0 , 0.5); \r\n    // \u2705 Return color with alpha from material\r\n    return vec4f(finalColor, alpha);\r\n}`;", "import {fragmentWGSL} from \"../../shaders/fragment.wgsl\";\r\nimport {fragmentWGSLMetal} from \"../../shaders/fragment.wgsl.metal\";\r\nimport {fragmentWGSLNormalMap} from \"../../shaders/fragment.wgsl.normalmap\";\r\nimport {fragmentWGSLPong} from \"../../shaders/fragment.wgsl.pong\";\r\nimport {fragmentWGSLPower} from \"../../shaders/fragment.wgsl.power\";\r\nimport {fragmentWGSLInstanced} from \"../../shaders/instanced/fragment.instanced.wgsl\";\r\nimport {fragmentWaterWGSL} from \"../../shaders/water/water-c.wgls\";\r\n\r\n/**\r\n * @description\r\n * Created for matrix-engine-wgpu project.\r\n * MeshObj class estends Materials.\r\n * @var material is engine meta data variable not real material object.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n */\r\nexport default class MaterialsInstanced {\r\n  constructor(device, material, glb) {\r\n    this.device = device;\r\n    this.glb = glb;\r\n    this.material = material;\r\n    this.isVideo = false;\r\n    this.videoIsReady = 'NONE';\r\n    this.compareSampler = this.device.createSampler({\r\n      compare: 'less-equal',           // safer for shadow comparison\r\n      addressModeU: 'clamp-to-edge',   // prevents UV leaking outside\r\n      addressModeV: 'clamp-to-edge',\r\n      magFilter: 'linear',             // smooth PCF\r\n      minFilter: 'linear',\r\n    });\r\n    // For image textures (standard sampler)\r\n    this.imageSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // For external video textures (needs to be filtering sampler too!)\r\n    this.videoSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // FX effect\r\n    this.postFXModeBuffer = this.device.createBuffer({\r\n      size: 4, // u32 = 4 bytes\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dymmy buffer\r\n    this.dummySpotlightUniformBuffer = this.device.createBuffer({\r\n      size: 80, // Must match size in shader\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.device.queue.writeBuffer(this.dummySpotlightUniformBuffer, 0, new Float32Array(20));\r\n    // Create a 1x1 RGBA texture filled with white\r\n    const mrDummyTex = this.device.createTexture({\r\n      size: [1, 1, 1],\r\n      format: this.getFormat(),\r\n      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n    });\r\n    // Upload a single pixel\r\n    const pixel = new Uint8Array([255, 255, 255, 255]); // white RGBA\r\n    this.device.queue.writeTexture(\r\n      {texture: mrDummyTex},\r\n      pixel,\r\n      {bytesPerRow: 4},\r\n      [1, 1, 1]\r\n    );\r\n    this.metallicRoughnessTextureView = mrDummyTex.createView();\r\n    this.metallicRoughnessSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // 4 floats for baseColorFactor + 1 metallic + 1 roughness + 2 pad floats = 8 floats\r\n    const materialPBRSize = 8 * 4; // 32 bytes\r\n    this.materialPBRBuffer = this.device.createBuffer({\r\n      size: materialPBRSize,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dummy values\r\n    const baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    const metallicFactor = 0.1;    // diffuse like plastic\r\n    const roughnessFactor = 0.5;   // some gloss\r\n    const pad = [0.0, 0.0];\r\n    // Pack into Float32Array\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      ...pad\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n\r\n    if(this.material.type == 'normalmap') {\r\n      const normalTexInfo = this.glb.glbJsonData.materials[0].normalTexture;\r\n      if(normalTexInfo) {\r\n        const tex = this.glb.glbJsonData.glbTextures[normalTexInfo.index];\r\n        this.normalTextureView = tex.createView();\r\n        this.normalSampler = this.device.createSampler({\r\n          magFilter: 'linear',\r\n          minFilter: 'linear',\r\n        });\r\n      } else {\r\n        // console.log('>>>ERRR >>>normalTexture>>')\r\n      }\r\n    } else {\r\n      // console.log('>DUMMY>normalTexture>')\r\n      // dummy for normal map 1x1 neutral normal map\r\n      this.normalDummyTex = device.createTexture({\r\n        size: [1, 1, 1],\r\n        format: 'rgba8unorm',\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n      });\r\n      // RGBA value for neutral normal in tangent space\r\n      const neutralNormal = new Uint8Array([128, 128, 255, 255]);\r\n      this.device.queue.writeTexture(\r\n        {texture: this.normalDummyTex},\r\n        neutralNormal,\r\n        {bytesPerRow: 4},\r\n        [1, 1, 1]\r\n      );\r\n      // Create texture view & sampler\r\n      this.normalTextureView = this.normalDummyTex.createView();\r\n      this.normalSampler = this.device.createSampler({\r\n        magFilter: 'linear',\r\n        minFilter: 'linear',\r\n      });\r\n    }\r\n\r\n    this.createBufferForWater();\r\n  }\r\n\r\n  createBufferForWater = () => {\r\n    // new water test\r\n    this.waterBindGroupLayout = this.device.createBindGroupLayout({\r\n      label: 'Water MAT Bind Group Layout for main pass',\r\n      entries: [{\r\n        binding: 0,\r\n        visibility: GPUShaderStage.FRAGMENT,\r\n        buffer: {\r\n          type: 'uniform'\r\n        }\r\n      }]\r\n    });\r\n    this.waterParamsBuffer = this.device.createBuffer({\r\n      size: 48,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.waterParamsData = new Float32Array([\r\n      0.0, 0.2, 0.4,       // deepColor (vec3f)\r\n      0.5,                 // waveSpeed\r\n      0.0, 0.5, 0.7,       // shallowColor (vec3f)\r\n      4.0,                 // waveScale\r\n      0.15,                // waveHeight\r\n      3.0,                 // fresnelPower\r\n      128.0,               // specularPower\r\n      0.0                  // padding\r\n    ]);\r\n    this.device.queue.writeBuffer(this.waterParamsBuffer, 0, this.waterParamsData);\r\n    this.waterBindGroup = this.device.createBindGroup({\r\n      layout: this.waterBindGroupLayout,\r\n      entries: [{\r\n        binding: 0,\r\n        resource: {buffer: this.waterParamsBuffer}\r\n      }]\r\n    });\r\n    // To update values at runtime:\r\n    this.updateWaterParams = (deepColor, shallowColor, waveSpeed, waveScale, waveHeight, fresnelPower, specularPower) => {\r\n      const data = new Float32Array([\r\n        deepColor[0], deepColor[1], deepColor[2],\r\n        waveSpeed,\r\n        shallowColor[0], shallowColor[1], shallowColor[2],\r\n        waveScale,\r\n        waveHeight,\r\n        fresnelPower,\r\n        specularPower,\r\n        0.0  // padding\r\n      ]);\r\n      device.queue.writeBuffer(waterParamsBuffer, 0, data);\r\n    }\r\n  }\r\n\r\n  changeTexture(newTexture) {\r\n    // Accept GPUTexture OR GPUTextureView\r\n    if(newTexture instanceof GPUTexture) {\r\n      this.texture0 = newTexture;\r\n    } else {\r\n      this.texture0 = {createView: () => newTexture};\r\n    }\r\n    this.isVideo = false;\r\n    // Recreate bind group only\r\n    this.createBindGroupForRender();\r\n  }\r\n\r\n  changeMaterial(newType = 'graph', graphShader) {\r\n    this.material.fromGraph = graphShader;\r\n    this.material.type = newType;\r\n    this.setupPipeline();\r\n  }\r\n\r\n  setBlend = (alpha) => {\r\n    this.material.useBlend = true;\r\n    this.setupMaterialPBR([1, 1, 1, alpha]);\r\n  }\r\n\r\n  getMaterial() {\r\n    // make it for all after all....\r\n    if(this.material.type == 'standard') {\r\n      return fragmentWGSLInstanced;\r\n    } else if(this.material.type == 'pong') {\r\n      return fragmentWGSLPong;\r\n    } else if(this.material.type == 'power') {\r\n      return fragmentWGSLPower;\r\n    } else if(this.material.type == 'metal') {\r\n      return fragmentWGSLMetal;\r\n    } else if(this.material.type == 'normalmap') {\r\n      return fragmentWGSLNormalMap;\r\n    } else if(this.material.type == 'water') {\r\n      return fragmentWaterWGSL;\r\n    } else if(this.material.type == 'graph') {\r\n      return this.material.fromGraph;\r\n    }\r\n    //  else if(this.material.type == 'mix1') {\r\n    //   return fragmentWGSLMix1;\r\n    // }\r\n    console.warn('Unknown material type use standard:', this.material?.type);\r\n    return fragmentWGSL;\r\n  }\r\n\r\n  getFormat() {\r\n    if(this.material?.format == 'darker') {\r\n      return 'rgba8unorm-srgb';\r\n    } else if(this.material?.format == 'normal') {\r\n      return 'rgba8unorm';\r\n    } else {\r\n      return 'rgba8unorm';\r\n    }\r\n  }\r\n\r\n  setupMaterialPBR(baseColorFactor, metallicFactor, roughnessFactor) {\r\n    if(!metallicFactor) metallicFactor = [0.5, 0.5, 0.5];\r\n    if(!baseColorFactor) baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    if(!roughnessFactor) roughnessFactor = 0.5;\r\n    const pad = [0.0];\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      0.5,\r\n      ...pad\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n  }\r\n\r\n  updatePostFXMode(mode) {\r\n    const arrayBuffer = new Uint32Array([mode]);\r\n    this.device.queue.writeBuffer(this.postFXModeBuffer, 0, arrayBuffer);\r\n  }\r\n\r\n  async loadTex0(texturesPaths) {\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    return new Promise(async (resolve) => {\r\n      const response = await fetch(texturesPaths[0]);\r\n      const imageBitmap = await createImageBitmap(await response.blob());\r\n      this.texture0 = this.device.createTexture({\r\n        size: [imageBitmap.width, imageBitmap.height, 1], // REMOVED 1\r\n        format: this.getFormat(),\r\n        usage:\r\n          GPUTextureUsage.TEXTURE_BINDING |\r\n          GPUTextureUsage.COPY_DST |\r\n          GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: imageBitmap},\r\n        {texture: this.texture0},\r\n        [imageBitmap.width, imageBitmap.height]\r\n      );\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  async loadVideoTexture(arg) {\r\n    this.videoIsReady = 'MAYBE';\r\n    if(arg.type === 'video') {\r\n      this.video = document.createElement('video');\r\n      this.video.src = arg.src || 'res/videos/tunel.mp4';\r\n      this.video.crossOrigin = 'anonymous';\r\n      this.video.autoplay = true;\r\n      this.video.loop = true;\r\n      document.body.append(this.video);\r\n      this.video.style.display = 'none';\r\n      this.video.style.position = 'absolute';\r\n      this.video.style.top = '750px';\r\n      this.video.style.left = '50px';\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'videoElement') {\r\n      this.video = arg.el;\r\n      await this.video.play();\r\n    } else if(arg.type === 'camera') {\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      try {\r\n        const stream = await (navigator.mediaDevices?.getUserMedia?.({\r\n          video: {\r\n            width: {ideal: 1280},\r\n            height: {ideal: 720},\r\n          },\r\n          audio: false\r\n        }));\r\n        this.video.srcObject = stream;\r\n        await this.video.play();\r\n        this.isVideo = true;\r\n      } catch(err) {\r\n        console.error(\"\u274C Failed to access camera:\", err);\r\n        return;\r\n      }\r\n    } else if(arg.type === 'canvas2d') {\r\n      // Existing canvas (arg.el) \u2014 assume it's actively drawing\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      const stream = arg.el.captureStream?.() || arg.el.mozCaptureStream?.();\r\n      if(!stream) {console.error('\u274C Cannot capture stream from canvas2d'); return;}\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'canvas2d-inline') {\r\n      // Miniature inline-drawn canvas created dynamically\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = arg.width || 256;\r\n      canvas.height = arg.height || 256;\r\n      const ctx = canvas.getContext('2d');\r\n      if(typeof arg.canvaInlineProgram === 'function') {\r\n        // Start drawing loop\r\n        const drawLoop = () => {\r\n          arg.canvaInlineProgram(ctx, canvas);\r\n          requestAnimationFrame(drawLoop);\r\n        };\r\n        drawLoop();\r\n      }\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      this.isVideo = true;\r\n      const stream = canvas.captureStream?.() || canvas.mozCaptureStream?.();\r\n      if(!stream) {\r\n        console.error('\u274C Cannot capture stream from inline canvas');\r\n        return;\r\n      }\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n    }\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // \u2705 Now - maybe noT\r\n    this.createLayoutForRender();\r\n  }\r\n\r\n  updateVideoTexture() {\r\n    if(!this.video || this.video.readyState < 2) return;\r\n    if(!this.externalTexture) {\r\n      // create it once\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n      this.videoIsReady = 'YES';\r\n      console.log(\"%c\u2705video bind.\", LOG_FUNNY_ARCADE);\r\n    } else {\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n    }\r\n  }\r\n\r\n  getMaterialTexture(glb, materialIndex) {\r\n    const matDef = glb.glbJsonData.materials[materialIndex];\r\n\r\n    if(!matDef) {\r\n      console.warn('[engine] no material in glb...');\r\n      return null;\r\n    }\r\n\r\n    if(matDef.pbrMetallicRoughness?.baseColorTexture) {\r\n      const texIndex = matDef.pbrMetallicRoughness.baseColorTexture.index;\r\n      return glb.glbJsonData.glbTextures[texIndex].createView();\r\n    }\r\n\r\n    return null;\r\n  }\r\n  getMaterialTextureFromMaterial(material) {\r\n    if(!material || !material.pbrMetallicRoughness) return this.fallbackTextureView;\r\n\r\n    const texInfo = material.pbrMetallicRoughness.baseColorTexture;\r\n    if(!texInfo) return this.fallbackTextureView;\r\n\r\n    const texIndex = texInfo.index;\r\n    return this.glb.glbTextures[texIndex].createView();\r\n  }\r\n\r\n  createBindGroupForRender() {\r\n    let textureResource = this.isVideo\r\n      ? this.externalTexture\r\n      : this.texture0.createView();\r\n    // console.log('TEST TEX this.texture0 ', this.texture0);\r\n    if(this.material.useTextureFromGlb === true) {\r\n      // console.log('TEST TEX material use from file ', this.name);\r\n      // 0 probably always for basicColor\r\n      const material = this.skinnedNode.mesh.primitives[0].material;\r\n      const textureView = material.baseColorTexture.imageView;\r\n      // const sampler = material.baseColorTexture.sampler;\r\n      textureResource = textureView;\r\n    }\r\n\r\n    if(!textureResource || !this.sceneUniformBuffer || !this.shadowDepthTextureView) {\r\n      if(!textureResource) console.warn(\"\u2757Missing res texture: \", textureResource);\r\n      if(!this.sceneUniformBuffer) console.warn(\"\u2757Missing res: this.sceneUniformBuffer: \", this.sceneUniformBuffer);\r\n      if(!this.shadowDepthTextureView) console.warn(\"\u2757Missing res: this.shadowDepthTextureView: \", this.shadowDepthTextureView);\r\n      if(typeof textureResource === 'undefined') {\r\n        this.updateVideoTexture();\r\n      }\r\n      return;\r\n    }\r\n    if(this.isVideo == true) {\r\n      // console.info(\"\u2705 video sceneBindGroupForRender\");\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.videoSampler, },\r\n          {binding: 5, resource: {buffer: this.postFXModeBuffer}}\r\n        ],\r\n      });\r\n      // Special case for video maybe better solution exist\r\n      if(this.video.paused == true) this.video.play();\r\n    } else {\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.imageSampler, },\r\n          {binding: 5, resource: {buffer: !this.spotlightUniformBuffer ? this.dummySpotlightUniformBuffer : this.spotlightUniformBuffer}, },\r\n          {binding: 6, resource: this.metallicRoughnessTextureView},\r\n          {binding: 7, resource: this.metallicRoughnessSampler},\r\n          {binding: 8, resource: {buffer: this.materialPBRBuffer}},\r\n          // NEW: dummy normal map\r\n          {binding: 9, resource: this.normalTextureView},\r\n          {binding: 10, resource: this.normalSampler},\r\n        ],\r\n      });\r\n    }\r\n  }\r\n\r\n  createLayoutForRender() {\r\n    let e = [\r\n      {\r\n        binding: 0,\r\n        visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\r\n        buffer: {type: 'uniform'},\r\n      },\r\n      ...(this.isVideo == false\r\n        ? [\r\n          {\r\n            binding: 1,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: \"depth\",\r\n              viewDimension: \"2d-array\", // <- must match shadowMapArray\r\n              multisampled: false,\r\n            },\r\n          },\r\n        ] : [{\r\n          binding: 1,\r\n          visibility: GPUShaderStage.FRAGMENT,\r\n          texture: {\r\n            sampleType: \"depth\",\r\n            viewDimension: \"2d\",\r\n          },\r\n        },])\r\n      , {\r\n        binding: 2,\r\n        visibility: GPUShaderStage.FRAGMENT,\r\n        sampler: {type: 'comparison'},\r\n      },\r\n      ...(this.isVideo\r\n        ? [ // VIDEO\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            externalTexture: {},\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}, // for video sampling\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          }\r\n        ]\r\n        : [ // IMAGE\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d',\r\n            },\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'},\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          },\r\n          {\r\n            binding: 6,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d'\r\n            }\r\n          },\r\n          {\r\n            binding: 7,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          },\r\n          {\r\n            binding: 8,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'}\r\n          },\r\n          {\r\n            binding: 9,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {sampleType: 'float', viewDimension: '2d'},\r\n          },\r\n          {\r\n            binding: 10,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          }\r\n        ])\r\n    ];\r\n    // console.log(\"BG E :  is used normal  \", this.material.type)\r\n    this.bglForRender = this.device.createBindGroupLayout({label: 'bglForRender', entries: e, });\r\n  }\r\n}", "export let vertexWGSLInstanced = `const MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\nstruct InstanceData {\r\n    model     : mat4x4<f32>,\r\n    colorMult : vec4<f32>,\r\n};\r\n\r\nstruct VertexAnimParams {\r\n  time: f32,\r\n  flags: f32,\r\n  globalIntensity: f32,\r\n  _pad0: f32,\r\n  waveSpeed: f32,\r\n  waveAmplitude: f32,\r\n  waveFrequency: f32,\r\n  _pad1: f32,\r\n  windSpeed: f32,\r\n  windStrength: f32,\r\n  windHeightInfluence: f32,\r\n  windTurbulence: f32,\r\n  pulseSpeed: f32,\r\n  pulseAmount: f32,\r\n  pulseCenterX: f32,\r\n  pulseCenterY: f32,\r\n  twistSpeed: f32,\r\n  twistAmount: f32,\r\n  _pad2: f32,\r\n  _pad3: f32,\r\n  noiseScale: f32,\r\n  noiseStrength: f32,\r\n  noiseSpeed: f32,\r\n  _pad4: f32,\r\n  oceanWaveScale: f32,\r\n  oceanWaveHeight: f32,\r\n  oceanWaveSpeed: f32,\r\n  _pad5: f32,\r\n  displacementStrength: f32,\r\n  displacementSpeed: f32,\r\n  _pad6: f32,\r\n  _pad7: f32,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<storage, read> instances : array<InstanceData>;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n@group(1) @binding(2) var<uniform> vertexAnim : VertexAnimParams;\r\n\r\nconst ANIM_WAVE: u32  = 1u;\r\nconst ANIM_WIND: u32  = 2u;\r\nconst ANIM_PULSE: u32 = 4u;\r\nconst ANIM_TWIST: u32 = 8u;\r\nconst ANIM_NOISE: u32 = 16u;\r\nconst ANIM_OCEAN: u32 = 32u;\r\n\r\nstruct VertexOutput {\r\n  @location(0) shadowPos: vec4f,\r\n  @location(1) fragPos: vec3f,\r\n  @location(2) fragNorm: vec3f,\r\n  @location(3) uv: vec2f,\r\n  @location(4) colorMult: vec4f,\r\n  @builtin(position) Position: vec4f,\r\n}\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos  = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat  = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\nfn hash(p: vec2f) -> f32 {\r\n  var p3 = fract(vec3f(p.x, p.y, p.x) * 0.13);\r\n  p3 += dot(p3, vec3f(p3.y, p3.z, p3.x) + 3.333);\r\n  return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nfn noise(p: vec2f) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash(i + vec2f(0.0, 0.0)), hash(i + vec2f(1.0, 0.0)), u.x),\r\n    mix(hash(i + vec2f(0.0, 1.0)), hash(i + vec2f(1.0, 1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\nfn applyWave(pos: vec3f) -> vec3f {\r\n  let wave = sin(pos.x * vertexAnim.waveFrequency + vertexAnim.time * vertexAnim.waveSpeed) *\r\n             cos(pos.z * vertexAnim.waveFrequency + vertexAnim.time * vertexAnim.waveSpeed);\r\n  return vec3f(pos.x, pos.y + wave * vertexAnim.waveAmplitude, pos.z);\r\n}\r\n\r\nfn applyWind(pos: vec3f, normal: vec3f) -> vec3f {\r\n  let heightFactor = max(0.0, pos.y) * vertexAnim.windHeightInfluence;\r\n  let windDir = vec2f(\r\n    sin(vertexAnim.time * vertexAnim.windSpeed),\r\n    cos(vertexAnim.time * vertexAnim.windSpeed * 0.7)\r\n  ) * vertexAnim.windStrength;\r\n  let turbulence = noise(vec2f(pos.x, pos.z) * 0.5 + vertexAnim.time * 0.3)\r\n                   * vertexAnim.windTurbulence;\r\n  return vec3f(\r\n    pos.x + windDir.x * heightFactor * (1.0 + turbulence),\r\n    pos.y,\r\n    pos.z + windDir.y * heightFactor * (1.0 + turbulence)\r\n  );\r\n}\r\n\r\nfn applyPulse(pos: vec3f) -> vec3f {\r\n  let pulse = sin(vertexAnim.time * vertexAnim.pulseSpeed) * vertexAnim.pulseAmount;\r\n  let scale  = 1.0 + pulse;\r\n  let center = vec3f(vertexAnim.pulseCenterX, 0.0, vertexAnim.pulseCenterY);\r\n  return center + (pos - center) * scale;\r\n}\r\n\r\nfn applyTwist(pos: vec3f) -> vec3f {\r\n  let angle = pos.y * vertexAnim.twistAmount * sin(vertexAnim.time * vertexAnim.twistSpeed);\r\n  let cosA  = cos(angle);\r\n  let sinA  = sin(angle);\r\n  return vec3f(\r\n    pos.x * cosA - pos.z * sinA,\r\n    pos.y,\r\n    pos.x * sinA + pos.z * cosA\r\n  );\r\n}\r\n\r\nfn applyNoiseDisplacement(pos: vec3f) -> vec3f {\r\n  let noiseVal    = noise(vec2f(pos.x, pos.z) * vertexAnim.noiseScale\r\n                         + vertexAnim.time * vertexAnim.noiseSpeed);\r\n  let displacement = (noiseVal - 0.5) * vertexAnim.noiseStrength;\r\n  return vec3f(pos.x, pos.y + displacement, pos.z);\r\n}\r\n\r\nfn applyOcean(pos: vec3f) -> vec3f {\r\n  let t     = vertexAnim.time * vertexAnim.oceanWaveSpeed;\r\n  let scale = vertexAnim.oceanWaveScale;\r\n  let wave1 = sin(dot(pos.xz, vec2f(1.0, 0.0)) * scale + t)             * vertexAnim.oceanWaveHeight;\r\n  let wave2 = sin(dot(pos.xz, vec2f(0.7, 0.7)) * scale * 1.2 + t * 1.3) * vertexAnim.oceanWaveHeight * 0.7;\r\n  let wave3 = sin(dot(pos.xz, vec2f(0.0, 1.0)) * scale * 0.8 + t * 0.9) * vertexAnim.oceanWaveHeight * 0.5;\r\n  return vec3f(pos.x, pos.y + wave1 + wave2 + wave3, pos.z);\r\n}\r\n\r\nfn applyVertexAnimation(pos: vec3f, normal: vec3f) -> SkinResult {\r\n  var animatedPos  = pos;\r\n  var animatedNorm = normal;\r\n  let flags = u32(vertexAnim.flags);\r\n\r\n  if ((flags & ANIM_WAVE)  != 0u) { animatedPos = applyWave(animatedPos); }\r\n  if ((flags & ANIM_WIND)  != 0u) { animatedPos = applyWind(animatedPos, animatedNorm); }\r\n  if ((flags & ANIM_NOISE) != 0u) { animatedPos = applyNoiseDisplacement(animatedPos); }\r\n  if ((flags & ANIM_OCEAN) != 0u) { animatedPos = applyOcean(animatedPos); }\r\n  if ((flags & ANIM_PULSE) != 0u) { animatedPos = applyPulse(animatedPos); }\r\n  if ((flags & ANIM_TWIST) != 0u) { animatedPos = applyTwist(animatedPos); }\r\n\r\n  animatedPos = mix(pos, animatedPos, vertexAnim.globalIntensity);\r\n\r\n  if (flags != 0u) {\r\n    let offset  = 0.01;\r\n    let posX    = applyWave(applyNoiseDisplacement(pos + vec3f(offset, 0.0, 0.0)));\r\n    let posZ    = applyWave(applyNoiseDisplacement(pos + vec3f(0.0, 0.0, offset)));\r\n    let tangentX = normalize(posX - animatedPos);\r\n    let tangentZ = normalize(posZ - animatedPos);\r\n    animatedNorm = normalize(cross(tangentZ, tangentX));\r\n  }\r\n\r\n  return SkinResult(vec4f(animatedPos, 1.0), animatedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3f,\r\n  @location(1) normal   : vec3f,\r\n  @location(2) uv       : vec2f,\r\n  @location(3) joints   : vec4<u32>,\r\n  @location(4) weights  : vec4<f32>,\r\n  @builtin(instance_index) instId: u32\r\n) -> VertexOutput {\r\n\r\n  let inst = instances[instId];\r\n\r\n  var output : VertexOutput;\r\n  let skinned  = skinVertex(vec4(position, 1.0), normal, joints, weights);\r\n  let animated = applyVertexAnimation(skinned.position.xyz, skinned.normal);\r\n\r\n  let worldPos = inst.model * animated.position;\r\n\r\n  let normalMatrix = mat3x3f(\r\n    inst.model[0].xyz,\r\n    inst.model[1].xyz,\r\n    inst.model[2].xyz\r\n  );\r\n\r\n  output.Position  = scene.cameraViewProjMatrix * worldPos;\r\n  output.fragPos   = worldPos.xyz;\r\n  output.shadowPos = scene.lightViewProjMatrix * worldPos;\r\n  output.fragNorm  = normalize(normalMatrix * animated.normal);\r\n  output.uv        = uv;\r\n  output.colorMult = inst.colorMult;\r\n  return output;\r\n}`;", "\r\nexport class GeometryFactory {\r\n  static create(type, size = 1, segments = 16, options = {}) {\r\n    switch(type) {\r\n      case \"quad\": return GeometryFactory.quad(size);\r\n      case \"cube\": return GeometryFactory.cube(size);\r\n      case \"sphere\": return GeometryFactory.sphere(size, segments);\r\n      case \"pyramid\": return GeometryFactory.pyramid(size);\r\n      case \"star\": return GeometryFactory.star(size);\r\n      case \"circle\": return GeometryFactory.circle(size, segments);\r\n      case \"circle2\": return GeometryFactory.circle2(size, segments);\r\n      case \"diamond\": return GeometryFactory.diamond(size);\r\n      case \"rock\": return GeometryFactory.rock(size, options.detail || 3);\r\n      case \"meteor\": return GeometryFactory.meteor(size, options.detail || 6);\r\n      case \"thunder\": return GeometryFactory.thunder(size);\r\n      case \"shard\": return GeometryFactory.shard(size);\r\n      case \"circlePlane\": return GeometryFactory.circlePlane(size, segments);\r\n      case \"ring\": return GeometryFactory.ring(size, options.innerRatio || 0.7, segments, options.height || 0.05);\r\n      default: throw new Error(`Unknown geometry: ${type}`);\r\n    }\r\n  }\r\n\r\n  // --- BASIC SHAPES ---------------------------------------------------------\r\n  static quad(S = 1) {\r\n    const positions = new Float32Array([\r\n      -S, S, 0, S, S, 0, -S, -S, 0, S, -S, 0\r\n    ]);\r\n    const uvs = new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]);\r\n    const indices = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n    return {positions, uvs, indices};\r\n  }\r\n\r\n  static cube(S = 1) {\r\n    const p = S / 2;\r\n    const positions = new Float32Array([\r\n      -p, -p, p, p, -p, p, p, p, p, -p, p, p,\r\n      -p, -p, -p, -p, p, -p, p, p, -p, p, -p, -p,\r\n      -p, p, -p, -p, p, p, p, p, p, p, p, -p,\r\n      -p, -p, -p, p, -p, -p, p, -p, p, -p, -p, p,\r\n      p, -p, -p, p, p, -p, p, p, p, p, -p, p,\r\n      -p, -p, -p, -p, -p, p, -p, p, p, -p, p, -p\r\n    ]);\r\n    const uvs = new Float32Array(6 * 8).fill(0);\r\n    const indices = [];\r\n    for(let i = 0;i < 6;i++) {\r\n      const o = i * 4; indices.push(o, o + 1, o + 2, o, o + 2, o + 3);\r\n    }\r\n    let i = new Uint16Array(i);\r\n    return {positions, uvs, i};\r\n  }\r\n\r\n  static sphere(R = 0.1, seg = 16) {\r\n    const p = [], uv = [], ind = [];\r\n    for(let y = 0;y <= seg;y++) {\r\n      const v = y / seg, \u03B8 = v * Math.PI;\r\n      for(let x = 0;x <= seg;x++) {\r\n        const u = x / seg, \u03C6 = u * Math.PI * 2;\r\n        p.push(R * Math.sin(\u03B8) * Math.cos(\u03C6), R * Math.cos(\u03B8), R * Math.sin(\u03B8) * Math.sin(\u03C6));\r\n        uv.push(u, v);\r\n      }\r\n    }\r\n    for(let y = 0;y < seg;y++) {\r\n      for(let x = 0;x < seg;x++) {\r\n        const i = y * (seg + 1) + x;\r\n        ind.push(i, i + seg + 1, i + 1, i + 1, i + seg + 1, i + seg + 2);\r\n      }\r\n    }\r\n    return {positions: new Float32Array(p), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static pyramid(S = 1) {\r\n    const h = S, p = S / 2;\r\n    const pos = new Float32Array([\r\n      -p, 0, -p, p, 0, -p, p, 0, p, -p, 0, p, 0, h, 0\r\n    ]);\r\n    const uv = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1, 0.5, 0]);\r\n    const idx = new Uint16Array([0, 1, 2, 0, 2, 3, 0, 1, 4, 1, 2, 4, 2, 3, 4, 3, 0, 4]);\r\n    return {positions: pos, uvs: uv, indices: idx};\r\n  }\r\n\r\n  static star(S = 1) {\r\n    const R = S, r = S * 0.4, v = [], uv = [], ind = [];\r\n    for(let i = 0;i < 10;i++) {\r\n      const a = i / 10 * Math.PI * 2;\r\n      const rr = i % 2 ? r : R;\r\n      v.push(Math.cos(a) * rr, Math.sin(a) * rr, 0);\r\n      uv.push((Math.cos(a) + 1) / 2, (Math.sin(a) + 1) / 2);\r\n    }\r\n    for(let i = 1;i < 9;i++) ind.push(0, i, i + 1);\r\n    ind.push(0, 9, 1);\r\n    return {positions: new Float32Array(v), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static circle(R = 1, seg = 32) {\r\n    const p = [0, 0, 0], uv = [0.5, 0.5], ind = [];\r\n    for(let i = 0;i <= seg;i++) {\r\n      const a = i / seg * Math.PI * 2;\r\n      p.push(Math.cos(a) * R, Math.sin(a) * R, 0);\r\n      uv.push((Math.cos(a) + 1) / 2, (Math.sin(a) + 1) / 2);\r\n      if(i > 1) ind.push(0, i - 1, i);\r\n    }\r\n    return {positions: new Float32Array(p), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static circle2(radius = 1, segments = 64) {\r\n    const positions = [0, 0, 0]; // center\r\n    const uvs = [0.5, 0.5];      // center UV\r\n    const indices = [];\r\n\r\n    // create outer vertices\r\n    for(let i = 0;i <= segments;i++) {\r\n      const angle = (i / segments) * Math.PI * 2;\r\n      const x = Math.cos(angle) * radius;\r\n      const y = Math.sin(angle) * radius;\r\n      positions.push(x, y, 0);\r\n      // map to circular UV range [0,1]\r\n      uvs.push((x / radius + 1) / 2, (y / radius + 1) / 2);\r\n\r\n      if(i > 0) {\r\n        // center = 0, connect previous outer vertex with current outer vertex\r\n        indices.push(0, i, i + 1);\r\n      }\r\n    }\r\n\r\n    // close the circle (last triangle connects to first outer vertex)\r\n    // we already pushed (segments + 1) outer vertices, so last index = segments + 1\r\n    // but first outer vertex is index 1\r\n    indices.push(0, segments + 1, 1);\r\n\r\n    return {\r\n      positions: new Float32Array(positions),\r\n      uvs: new Float32Array(uvs),\r\n      indices: new Uint16Array(indices)\r\n    };\r\n  }\r\n\r\n  static diamond(S = 1) {\r\n    const h = S, p = S / 2;\r\n    const pos = new Float32Array([\r\n      0, h, 0,\r\n      -p, 0, -p, p, 0, -p, p, 0, p, -p, 0, p,\r\n      0, -h, 0\r\n    ]);\r\n    const uv = new Float32Array(6 * 2).fill(0);\r\n    const idx = new Uint16Array([\r\n      0, 1, 2, 0, 2, 3, 0, 3, 4, 0, 4, 1,\r\n      5, 2, 1, 5, 3, 2, 5, 4, 3, 5, 1, 4\r\n    ]);\r\n    return {positions: pos, uvs: uv, indices: idx};\r\n  }\r\n\r\n  // --- FANTASY & EFFECT GEOMETRIES -----------------------------------------\r\n  static thunder(S = 1) {\r\n    // jagged lightning bolt made of zig-zag quads\r\n    const pts = [0, 0, 0];\r\n    for(let i = 1;i < 8;i++) {\r\n      const x = (Math.random() - 0.5) * 0.2 * S;\r\n      const y = i * (S / 7);\r\n      const z = (Math.random() - 0.5) * 0.1 * S;\r\n      pts.push(x, y, z);\r\n    }\r\n    const p = [], uv = [], ind = [];\r\n    for(let i = 0;i < pts.length / 3 - 1;i++) {\r\n      const x1 = pts[i * 3], y1 = pts[i * 3 + 1], z1 = pts[i * 3 + 2];\r\n      const x2 = pts[(i + 1) * 3], y2 = pts[(i + 1) * 3 + 1], z2 = pts[(i + 1) * 3 + 2];\r\n      const w = 0.03 * S;\r\n      p.push(x1 - w, y1, z1, x1 + w, y1, z1, x2 - w, y2, z2, x2 + w, y2, z2);\r\n      uv.push(0, 0, 1, 0, 0, 1, 1, 1);\r\n      const o = i * 4;\r\n      ind.push(o, o + 1, o + 2, o + 1, o + 3, o + 2);\r\n    }\r\n    return {positions: new Float32Array(p), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static rock(S = 1, detail = 4) {\r\n    // randomly perturbed sphere for organic shape\r\n    const base = GeometryFactory.sphere(S, detail);\r\n    const p = base.positions;\r\n    for(let i = 0;i < p.length;i += 3) {\r\n      const n = (Math.random() * 0.3 + 0.85);\r\n      p[i] *= n; p[i + 1] *= n; p[i + 2] *= n;\r\n    }\r\n    return base;\r\n  }\r\n\r\n  static meteor(S = 1, detail = 6) {\r\n    const base = GeometryFactory.rock(S, detail);\r\n    const p = base.positions;\r\n    // stretch and skew\r\n    for(let i = 0;i < p.length;i += 3) {\r\n      p[i + 1] *= (1.4 + Math.random() * 0.5);\r\n      p[i] *= (0.8 + Math.random() * 0.3);\r\n    }\r\n    return base;\r\n  }\r\n\r\n  static shard(S = 1) {\r\n    const positions = new Float32Array([\r\n      0, 0, 0, S * 0.3, 0, S * 0.2, -S * 0.2, 0, S * 0.3, 0, S * 1.2, 0\r\n    ]);\r\n    const uvs = new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]);\r\n    const indices = new Uint16Array([0, 1, 2, 1, 2, 3, 0, 2, 3, 0, 1, 3]);\r\n    return {positions, uvs, indices};\r\n  }\r\n\r\n  static circlePlane(radius = 1, segments = 32) {\r\n    const positions = [];\r\n    const uvs = [];\r\n    const indices = [];\r\n\r\n    // Center vertex\r\n    positions.push(0, 0, 0);\r\n    uvs.push(0.5, 0.5);\r\n\r\n    // Outer ring vertices\r\n    for(let i = 0;i <= segments;i++) {\r\n      const angle = (i / segments) * Math.PI * 2;\r\n      const x = Math.cos(angle) * radius;\r\n      const y = 0;\r\n      const z = Math.sin(angle) * radius;\r\n      positions.push(x, y, z);\r\n      uvs.push((x / radius + 1) / 2, (z / radius + 1) / 2);\r\n    }\r\n\r\n    // Triangles (fan)\r\n    for(let i = 1;i <= segments;i++) {\r\n      indices.push(0, i, i + 1);\r\n    }\r\n\r\n    return {\r\n      positions: new Float32Array(positions),\r\n      uvs: new Float32Array(uvs),\r\n      indices: new Uint16Array(indices)\r\n    };\r\n  }\r\n\r\n\r\n  static ring(outerRadius = 4, innerRadiusRatio = 0.7, segments = 48, height = 0.05) {\r\n    const innerRadius = outerRadius * innerRadiusRatio;\r\n    const positions = [];\r\n    const uvs = [];\r\n    const indices = [];\r\n\r\n    for(let i = 0;i <= segments;i++) {\r\n      const angle = (i / segments) * Math.PI * 2;\r\n      const cos = Math.cos(angle);\r\n      const sin = Math.sin(angle);\r\n\r\n      // outer edge\r\n      positions.push(cos * outerRadius, 0, sin * outerRadius);\r\n      uvs.push((cos + 1) / 2, (sin + 1) / 2);\r\n\r\n      // inner edge (slightly higher if you want a bit of volume)\r\n      positions.push(cos * innerRadius, height, sin * innerRadius);\r\n      uvs.push((cos * innerRadius / outerRadius + 1) / 2, (sin * innerRadius / outerRadius + 1) / 2);\r\n    }\r\n\r\n    // Triangles\r\n    for(let i = 0;i < segments * 2;i += 2) {\r\n      indices.push(i, i + 1, i + 2);\r\n      indices.push(i + 1, i + 3, i + 2);\r\n    }\r\n\r\n    return {\r\n      positions: new Float32Array(positions),\r\n      uvs: new Float32Array(uvs),\r\n      indices: new Uint16Array(indices)\r\n    };\r\n  }\r\n}", "export const geoInstancedEffect = `struct Camera {\r\n  viewProjMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\n// --- INSTANCE STORAGE BUFFER ----------------------------------------------\r\nstruct InstanceData {\r\n  model : mat4x4<f32>,\r\n  color : vec4<f32>,\r\n};\r\n@group(0) @binding(1) var<storage, read> instances : array<InstanceData>;\r\n\r\nstruct VertexInput {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) v_uv : vec2<f32>,\r\n  @location(1) v_color : vec4<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VertexInput, @builtin(instance_index) instanceIndex: u32) -> VSOut {\r\n  var out : VSOut;\r\n\r\n  // Use per-instance model matrix & color\r\n  let modelMatrix = instances[instanceIndex].model;\r\n  let color = instances[instanceIndex].color;\r\n\r\n  let worldPos = modelMatrix * vec4<f32>(input.position,1.0);\r\n  out.Position = camera.viewProjMatrix * worldPos;\r\n  out.v_uv = input.uv;\r\n  out.v_color = color;\r\n  return out;\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n  let dist = length(uv);\r\n  let glow = exp(-dist * 1.0);\r\n  let baseColor = vec3<f32>(0.2, 0.7, 1.0);\r\n  let glowColor = vec3<f32>(0.7, 0.9, 1.0);\r\n  let color = mix(baseColor, glowColor, glow) * glow * input.v_color.rgb;\r\n  let alpha = input.v_color.a;\r\n  return vec4<f32>(color, alpha);\r\n}\r\n`;", "import {GeometryFactory} from \"../geometry-factory.js\";\r\nimport {mat4} from \"wgpu-matrix\";\r\nimport {geoInstancedEffect} from \"../../shaders/standalone/geo.instanced.js\";\r\n\r\nexport class GenGeo {\r\n  constructor(device, format, type = \"sphere\", scale = 1) {\r\n    this.device = device;\r\n    this.format = format;\r\n    const geom = GeometryFactory.create(type, scale);\r\n    this.vertexData = geom.positions;\r\n    this.uvData = geom.uvs;\r\n    this.indexData = geom.indices;\r\n    this.enabled = true;\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    const {vertexData, uvData, indexData} = this;\r\n    // GPU buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.instanceTargets = [];\r\n    this.lerpSpeed = 0.05;\r\n    this.maxInstances = 5;\r\n    this.instanceCount = 2;\r\n    this.floatsPerInstance = 16 + 4;\r\n\r\n    for(let x = 0;x < this.maxInstances;x++) {\r\n      this.instanceTargets.push({\r\n        index: x,\r\n        position: [0, 0, 0],\r\n        currentPosition: [0, 0, 0],\r\n        scale: [1, 1, 1],\r\n        currentScale: [1, 1, 1],\r\n        color: [0.6, 0.8, 1.0, 0.4],\r\n      });\r\n    }\r\n    this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: this.instanceData.byteLength,\r\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: geoInstancedEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'less-equal', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    const count = Math.min(this.instanceCount, this.maxInstances);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // smooth interpolation of position & scale\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n      }\r\n      const local = mat4.identity();\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n      this.instanceData.set(finalMat, offset);\r\n      this.instanceData.set(t.color, offset + 16);\r\n    }\r\n    // IMPORTANT: upload ONLY the active range of floats to GPU to avoid leftover instances\r\n    const activeFloatCount = count * this.floatsPerInstance;\r\n    const activeBytes = activeFloatCount * 4;\r\n    // .subarray(0, activeFloatCount) ensures we don't upload garbage beyond instanceCount\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, this.instanceData.subarray(0, activeFloatCount));\r\n  };\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount, this.instanceCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n    this.draw(transPass, viewProjMatrix);\r\n  }\r\n}", "export const hpBarEffectShaders = `\r\nstruct Camera {\r\n  viewProj : mat4x4f\r\n};\r\nstruct Model {\r\n  model : mat4x4f,\r\n  color : vec4f,\r\n  progress : f32,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n@group(0) @binding(1) var<uniform> model : Model;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) position : vec4f,\r\n  @location(0) uv : vec2f,\r\n};\r\n\r\n@vertex\r\nfn vsMain(\r\n  @location(0) position : vec3f,\r\n  @location(1) uv : vec2f\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  output.position = camera.viewProj * model.model * vec4f(position, 1.0);\r\n  output.uv = uv;\r\n  return output;\r\n}\r\n\r\n@fragment\r\nfn fsMain(in : VertexOutput) -> @location(0) vec4f {\r\n  // simple left-to-right fill based on progress\r\n  if (in.uv.x > model.progress) {\r\n    return vec4f(0.1, 0.1, 0.1, 0.3); // empty (transparent gray)\r\n  }\r\n  return model.color; // filled\r\n}\r\n`;", "import {mat4} from \"wgpu-matrix\";\r\nimport {hpBarEffectShaders} from \"../../shaders/energy-bars/energy-bar-shader.js\";\r\n\r\nexport class HPBarEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    this.progress = 1.0;\r\n    this.color = [0.1, 0.9, 0.1, 1.0];\r\n    this.offsetY = 48;\r\n    this.enabled = true;\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Simple flat bar (width 100, height 10)\r\n    const W = 40;\r\n    const H = 3;\r\n\r\n    const vertexData = new Float32Array([\r\n      -0.5 * W, 0.5 * H, 0.0,\r\n      0.5 * W, 0.5 * H, 0.0,\r\n      -0.5 * W, -0.5 * H, 0.0,\r\n      0.5 * W, -0.5 * H, 0.0,\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 1,\r\n      1, 1,\r\n      0, 0,\r\n      1, 0\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    // Buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // model + color + progress (64 + 16 + 4)\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64 + 16 + 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // BindGroup\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}}\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}}\r\n      ]\r\n    });\r\n\r\n    // Pipeline\r\n    const shaderModule = this.device.createShaderModule({code: hpBarEffectShaders});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'always', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  setProgress(value) {\r\n    this.progress = Math.max(0.0, Math.min(1.0, value));\r\n  }\r\n\r\n  setColor(r, g, b, a = 1.0) {\r\n    this.color = [r, g, b, a];\r\n  }\r\n\r\n  draw(pass, cameraMatrix, modelMatrix) {\r\n    const color = new Float32Array(this.color);\r\n    const progressData = new Float32Array([this.progress]);\r\n\r\n    // Pack uniforms manually\r\n    const buffer = new ArrayBuffer(64 + 16 + 4);\r\n    const f32 = new Float32Array(buffer);\r\n    f32.set(cameraMatrix, 0); // not needed here\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, modelMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, color);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64 + 16, progressData);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, ) {\r\n    const pos = mesh.position;\r\n    const modelMatrix = mat4.identity();\r\n    mat4.translate(modelMatrix, [pos.x, pos.y + this.offsetY, pos.z], modelMatrix);\r\n    this.draw(pass, viewProjMatrix, modelMatrix);\r\n  }\r\n}", "import {mat4} from \"wgpu-matrix\";\r\nimport {hpBarEffectShaders} from \"../../shaders/energy-bars/energy-bar-shader.js\";\r\n\r\nexport class MANABarEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    this.progress = 1.0;\r\n    this.color = [0.1, 0.1, 0.9, 1.0];\r\n    this.offsetY = 45;\r\n    this.enabled = true;\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Simple flat bar (width 100, height 10)\r\n    const W = 40;\r\n    const H = 3;\r\n\r\n    const vertexData = new Float32Array([\r\n      -0.5 * W, 0.5 * H, 0.0,\r\n      0.5 * W, 0.5 * H, 0.0,\r\n      -0.5 * W, -0.5 * H, 0.0,\r\n      0.5 * W, -0.5 * H, 0.0,\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 1,\r\n      1, 1,\r\n      0, 0,\r\n      1, 0\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    // Buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // model + color + progress (64 + 16 + 4)\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64 + 16 + 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // BindGroup\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}}\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}}\r\n      ]\r\n    });\r\n\r\n    // Pipeline\r\n    const shaderModule = this.device.createShaderModule({code: hpBarEffectShaders});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'always', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  setProgress(value) {\r\n    this.progress = Math.max(0.0, Math.min(1.0, value));\r\n  }\r\n\r\n  setColor(r, g, b, a = 1.0) {\r\n    this.color = [r, g, b, a];\r\n  }\r\n\r\n  draw(pass, cameraMatrix, modelMatrix) {\r\n    const color = new Float32Array(this.color);\r\n    const progressData = new Float32Array([this.progress]);\r\n\r\n    // Pack uniforms manually\r\n    const buffer = new ArrayBuffer(64 + 16 + 4);\r\n    const f32 = new Float32Array(buffer);\r\n    f32.set(cameraMatrix, 0); // not needed here\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, modelMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, color);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64 + 16, progressData);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, ) {\r\n    const pos = mesh.position;\r\n    const modelMatrix = mat4.identity();\r\n    mat4.translate(modelMatrix, [pos.x, pos.y + this.offsetY, pos.z], modelMatrix);\r\n    this.draw(pass, viewProjMatrix, modelMatrix);\r\n  }\r\n}", "export const geoInstancedTexEffect = `\r\n// === CAMERA & INSTANCE BUFFERS ============================================\r\nstruct Camera {\r\n  viewProjMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct InstanceData {\r\n  model : mat4x4<f32>,\r\n  color : vec4<f32>,\r\n};\r\n@group(0) @binding(1) var<storage, read> instances : array<InstanceData>;\r\n\r\n// === TEXTURE & SAMPLER ====================================================\r\n@group(0) @binding(2) var mySampler : sampler;\r\n@group(0) @binding(3) var myTexture : texture_2d<f32>;\r\n\r\n// === VERTEX STAGE =========================================================\r\nstruct VertexInput {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) v_uv : vec2<f32>,\r\n  @location(1) v_color : vec4<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VertexInput, @builtin(instance_index) instanceIndex : u32) -> VSOut {\r\n  var out : VSOut;\r\n  let inst = instances[instanceIndex];\r\n\r\n  let worldPos = inst.model * vec4<f32>(input.position, 1.0);\r\n  out.Position = camera.viewProjMatrix * worldPos;\r\n  out.v_uv = input.uv;\r\n  out.v_color = inst.color;\r\n  return out;\r\n}\r\n\r\n// === FRAGMENT STAGE =======================================================\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n\r\n // Adjust UV scaling and offset here\r\n  let uvScale = vec2<f32>(1.3, 1.3);   // < 1.0 = zoom out (more texture visible)\r\n  let uvOffset = vec2<f32>(0.01, 0.01); // move the texture slightly\r\n  \r\n  let adjustedUV = input.v_uv; // * uvScale + uvOffset; // make it like ring !\r\n\r\n  let texColor = textureSample(myTexture, mySampler, adjustedUV);\r\n\r\n  let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n  let dist = length(uv);\r\n  let glow = exp(-dist * 1.2);\r\n  let glowColor = mix(vec3<f32>(0.2, 0.7, 1.0), vec3<f32>(0.8, 0.95, 1.0), glow);\r\n\r\n  let baseRGB = texColor.rgb * glowColor;\r\n  let tintedRGB = mix(baseRGB, input.v_color.rgb, 0.8);\r\n  let finalAlpha = texColor.a * input.v_color.a * glow;\r\n\r\n  return vec4<f32>(tintedRGB, finalAlpha);\r\n\r\n  // let texColor = textureSample(myTexture, mySampler, input.v_uv);\r\n\r\n  // let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n  // let dist = length(uv);\r\n  // let glow = exp(-dist * 1.2);\r\n  // let glowColor = mix(vec3<f32>(0.2, 0.7, 1.0), vec3<f32>(0.8, 0.95, 1.0), glow);\r\n\r\n  // // More balanced color blending:\r\n  // let baseRGB = texColor.rgb * glowColor;\r\n  // let tintedRGB = mix(baseRGB, input.v_color.rgb, 0.8); // 0.8 gives strong tint influence\r\n  // let finalAlpha = texColor.a * input.v_color.a * glow;\r\n\r\n  // return vec4<f32>(tintedRGB, finalAlpha);\r\n}\r\n`;\r\n", "import {geoInstancedTexEffect} from \"../../shaders/standalone/geo.tex.js\";\r\nimport {GeometryFactory} from \"../geometry-factory.js\";\r\nimport {mat4} from \"wgpu-matrix\";\r\n\r\nexport class GenGeoTexture {\r\n  constructor(device, format, type = \"sphere\", path, scale = 1) {\r\n    this.device = device;\r\n    this.format = format;\r\n    const geom = GeometryFactory.create(type, scale);\r\n    this.vertexData = geom.positions;\r\n    this.uvData = geom.uvs;\r\n    this.indexData = geom.indices;\r\n    this.enabled = true;\r\n\r\n    this.rotateEffect = true;\r\n    this.rotateEffectSpeed = 10;\r\n    this.rotateAngle = 0;\r\n    this.loadTexture(path).then(() => {\r\n      this._initPipeline();\r\n    })\r\n  }\r\n\r\n  async loadTexture(url) {\r\n    return new Promise(async (resolve, reject) => {\r\n      const img = await fetch(url).then(r => r.blob()).then(createImageBitmap);\r\n      const texture = this.device.createTexture({\r\n        size: [img.width, img.height, 1],\r\n        format: \"rgba8unorm\",\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: img},\r\n        {texture},\r\n        [img.width, img.height]\r\n      );\r\n\r\n      const sampler = this.device.createSampler({\r\n        magFilter: \"linear\",\r\n        minFilter: \"linear\",\r\n        addressModeU: \"repeat\",\r\n        addressModeV: \"repeat\"\r\n      });\r\n\r\n      this.texture = texture;\r\n      this.sampler = sampler;\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  _initPipeline() {\r\n    const {vertexData, uvData, indexData} = this;\r\n    // GPU buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.instanceTargets = [];\r\n    this.lerpSpeed = 0.05;\r\n    this.maxInstances = 5;\r\n    this.instanceCount = 2;\r\n    this.floatsPerInstance = 16 + 4;\r\n\r\n    for(let x = 0;x < this.maxInstances;x++) {\r\n      this.instanceTargets.push({\r\n        index: x,\r\n        position: [0, 0, 0],\r\n        currentPosition: [0, 0, 0],\r\n        scale: [1, 1, 1],\r\n        currentScale: [1, 1, 1],\r\n        color: [0.6, 0.8, 1.0, 0.4],\r\n      });\r\n    }\r\n    this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: this.instanceData.byteLength,\r\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n        {binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: {}},\r\n        {binding: 3, visibility: GPUShaderStage.FRAGMENT, texture: {}},\r\n      ],\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n        {binding: 2, resource: this.sampler},\r\n        {binding: 3, resource: this.texture.createView()},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: geoInstancedTexEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'less-equal', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    if(this.rotateEffect) {\r\n      this.rotateAngle = (this.rotateAngle ?? 0) + this.rotateEffectSpeed; // accumulate rotation\r\n      if (this.rotateAngle >= 360) {\r\n        this.rotateAngle = 0;\r\n      }\r\n    }\r\n    const count = Math.min(this.instanceCount, this.maxInstances);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // smooth interpolation of position & scale\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n      }\r\n      const local = mat4.identity();\r\n      if(this.rotateEffect == true) {\r\n        mat4.rotateY(local, this.rotateAngle, local);\r\n      }\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n      this.instanceData.set(finalMat, offset);\r\n      this.instanceData.set(t.color, offset + 16);\r\n    }\r\n    // IMPORTANT: upload ONLY the active range of floats to GPU to avoid leftover instances\r\n    const activeFloatCount = count * this.floatsPerInstance;\r\n    const activeBytes = activeFloatCount * 4;\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, this.instanceData.subarray(0, activeFloatCount));\r\n  };\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount, this.instanceCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n    this.draw(transPass, viewProjMatrix);\r\n  }\r\n}", "import {geoInstancedTexEffect} from \"../../shaders/standalone/geo.tex.js\";\r\nimport {GeometryFactory} from \"../geometry-factory.js\";\r\nimport {mat4} from \"wgpu-matrix\";\r\n\r\nexport class GenGeoTexture2 {\r\n  constructor(device, format, type = \"sphere\", path, scale = 1) {\r\n    this.device = device;\r\n    this.format = format;\r\n    const geom = GeometryFactory.create(type, scale);\r\n    this.vertexData = geom.positions;\r\n    this.uvData = geom.uvs;\r\n    this.indexData = geom.indices;\r\n    this.enabled = true;\r\n\r\n    this.rotateEffect = true;\r\n    this.rotateEffectSpeed = 10;\r\n    this.rotateAngle = 0;\r\n    this.loadTexture(path).then(() => {\r\n      this._initPipeline();\r\n    })\r\n  }\r\n\r\n  async loadTexture(url) {\r\n    return new Promise(async (resolve, reject) => {\r\n      const img = await fetch(url).then(r => r.blob()).then(createImageBitmap);\r\n      const texture = this.device.createTexture({\r\n        size: [img.width, img.height, 1],\r\n        format: \"rgba8unorm\",\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: img},\r\n        {texture},\r\n        [img.width, img.height]\r\n      );\r\n\r\n      const sampler = this.device.createSampler({\r\n        magFilter: \"linear\",\r\n        minFilter: \"linear\",\r\n        addressModeU: \"repeat\",\r\n        addressModeV: \"repeat\"\r\n      });\r\n\r\n      this.texture = texture;\r\n      this.sampler = sampler;\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  _initPipeline() {\r\n    const {vertexData, uvData, indexData} = this;\r\n\r\n  // --- POSITION BUFFER (aligned)\r\n  this.vertexBuffer = this.device.createBuffer({\r\n    size: Math.ceil(vertexData.byteLength / 4) * 4,\r\n    usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n  });\r\n  this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n  // --- UV BUFFER (aligned)\r\n  this.uvBuffer = this.device.createBuffer({\r\n    size: Math.ceil(uvData.byteLength / 4) * 4,\r\n    usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n  });\r\n  this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n  // --- INDEX BUFFER (aligned)\r\n  const alignedIndexSize = Math.ceil(indexData.byteLength / 4) * 4;\r\n  this.indexBuffer = this.device.createBuffer({\r\n    size: alignedIndexSize,\r\n    usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n  });\r\n\r\n  // Create a temporary padded buffer if necessary\r\n  if (indexData.byteLength !== alignedIndexSize) {\r\n    const tmp = new Uint8Array(alignedIndexSize);\r\n    tmp.set(new Uint8Array(indexData.buffer));\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, tmp);\r\n  } else {\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n  }\r\n\r\n  this.indexCount = indexData.length;\r\n\r\n  // --- rest of your setup (no change)\r\n  this.cameraBuffer = this.device.createBuffer({\r\n    size: 64,\r\n    usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n  });\r\n\r\n  this.instanceTargets = [];\r\n  this.lerpSpeed = 0.05;\r\n  this.maxInstances = 5;\r\n  this.instanceCount = 2;\r\n  this.floatsPerInstance = 16 + 4;\r\n\r\n  for (let x = 0; x < this.maxInstances; x++) {\r\n    this.instanceTargets.push({\r\n      index: x,\r\n      position: [0, 0, 0],\r\n      currentPosition: [0, 0, 0],\r\n      scale: [1, 1, 1],\r\n      currentScale: [1, 1, 1],\r\n      color: [0.6, 0.8, 1.0, 0.4],\r\n    });\r\n  }\r\n\r\n  this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n  this.modelBuffer = this.device.createBuffer({\r\n    size: Math.ceil(this.instanceData.byteLength / 4) * 4,\r\n    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n  });\r\n\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n        {binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: {}},\r\n        {binding: 3, visibility: GPUShaderStage.FRAGMENT, texture: {}},\r\n      ],\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n        {binding: 2, resource: this.sampler},\r\n        {binding: 3, resource: this.texture.createView()},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: geoInstancedTexEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'less-equal', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    if(this.rotateEffect) {\r\n      this.rotateAngle = (this.rotateAngle ?? 0) + this.rotateEffectSpeed; // accumulate rotation\r\n      if (this.rotateAngle >= 360) {\r\n        this.rotateAngle = 0;\r\n      }\r\n    }\r\n    const count = Math.min(this.instanceCount, this.maxInstances);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // smooth interpolation of position & scale\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n      }\r\n      const local = mat4.identity();\r\n      if(this.rotateEffect == true) {\r\n        mat4.rotateY(local, this.rotateAngle, local);\r\n      }\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n      this.instanceData.set(finalMat, offset);\r\n      this.instanceData.set(t.color, offset + 16);\r\n    }\r\n    // IMPORTANT: upload ONLY the active range of floats to GPU to avoid leftover instances\r\n    const activeFloatCount = count * this.floatsPerInstance;\r\n    const activeBytes = activeFloatCount * 4;\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, this.instanceData.subarray(0, activeFloatCount));\r\n  };\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount, this.instanceCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n    this.draw(transPass, viewProjMatrix);\r\n  }\r\n}", "import {mat4} from 'wgpu-matrix';\r\nimport {Position, Rotation} from \"../matrix-class\";\r\nimport {degToRad, genName, LOG_FUNNY_SMALL} from '../utils';\r\nimport {fragmentVideoWGSL} from '../../shaders/fragment.video.wgsl';\r\nimport {PointerEffect} from '../effects/pointerEffect';\r\nimport MaterialsInstanced from './materials-instanced';\r\nimport {vertexWGSLInstanced} from '../../shaders/instanced/vertex.instanced.wgsl';\r\nimport {BVHPlayerInstances} from '../loaders/bvh-instaced';\r\nimport {GenGeo} from '../effects/gen';\r\nimport {HPBarEffect} from '../effects/energy-bar';\r\nimport {MANABarEffect} from '../effects/mana-bar';\r\nimport {FlameEffect} from '../effects/flame';\r\nimport {FlameEmitter} from '../effects/flame-emmiter';\r\nimport {GenGeoTexture} from '../effects/gen-tex';\r\nimport {GenGeoTexture2} from '../effects/gen-tex2';\r\n\r\nexport default class MEMeshObjInstances extends MaterialsInstanced {\r\n  constructor(canvas, device, context, o, inputHandler, globalAmbient, _glbFile = null, primitiveIndex = null, skinnedNodeIndex = null) {\r\n    super(device, o.material, _glbFile);\r\n    if(typeof o.name === 'undefined') o.name = genName(3);\r\n    if(typeof o.raycast === 'undefined') {this.raycast = {enabled: false, radius: 2}} else {\r\n      this.raycast = o.raycast;\r\n    }\r\n\r\n    this.pointerEffect = o.pointerEffect;\r\n    this.name = o.name;\r\n    this.done = false;\r\n    this.canvas = canvas;\r\n    this.device = device;\r\n    this.context = context;\r\n    this.entityArgPass = o.entityArgPass;\r\n    this.clearColor = \"red\";\r\n    this.video = null;\r\n    this.FINISH_VIDIO_INIT = false;\r\n    this.globalAmbient = [...globalAmbient];\r\n    this.blendInstanced = false;\r\n\r\n    this.useScale = o.useScale || false;\r\n\r\n    if(typeof o.material.useTextureFromGlb === 'undefined' || typeof o.material.useTextureFromGlb !== \"boolean\") {\r\n      o.material.useTextureFromGlb = false;\r\n    }\r\n\r\n    if(typeof o.material.useBlend === 'undefined' || typeof o.material.useBlend !== \"boolean\") {\r\n      o.material.useBlend = false;\r\n    }\r\n\r\n    this.material = o.material;\r\n\r\n    // Mesh stuff - for single mesh or t-posed (fiktive-first in loading order)\r\n    this.mesh = o.mesh;\r\n    if(_glbFile != null) {\r\n      if(typeof this.mesh == 'undefined') {\r\n        this.mesh = {};\r\n        this.mesh.feedFromRealGlb = true;\r\n      }\r\n      // V\r\n      const verView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].positions.view;\r\n      const byteOffsetV = verView.byteOffset || 0;\r\n      const byteLengthV = verView.buffer.byteLength;\r\n      const vertices = new Float32Array(\r\n        verView.buffer.buffer,\r\n        byteOffsetV,\r\n        byteLengthV / 4\r\n      );\r\n      this.mesh.vertices = vertices;\r\n      //N\r\n      const norView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].normals.view;\r\n      const normalsUint8 = norView.buffer;\r\n      const byteOffsetN = norView.byteOffset || 0;\r\n      const byteLengthN = normalsUint8.byteLength;\r\n      const normals = new Float32Array(\r\n        normalsUint8.buffer,\r\n        byteOffsetN,\r\n        byteLengthN / 4\r\n      );\r\n      this.mesh.vertexNormals = normals;\r\n      //UV\r\n      let accessor = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].texcoords[0];\r\n      const bufferView = accessor.view;\r\n      const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n      const count = accessor.count * 2;\r\n      const uvFloatArray = new Float32Array(bufferView.buffer.buffer, byteOffset, count);\r\n      this.mesh.uvs = uvFloatArray;\r\n      this.mesh.textures = uvFloatArray;\r\n      // I\r\n      let binaryI = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].indices;\r\n      const indicesView = binaryI.view;\r\n      const indicesUint8 = indicesView.buffer;\r\n      const byteOffsetI = indicesView.byteOffset || 0;\r\n      const byteLengthI = indicesUint8.byteLength;\r\n      // Decide on type from accessor.componentType\r\n      // (5121 = UNSIGNED_BYTE, 5123 = UNSIGNED_SHORT, 5125 = UNSIGNED_INT)\r\n      let indicesArray;\r\n      switch(binaryI.componentType) {\r\n        case 5121: // UNSIGNED_BYTE\r\n          indicesArray = new Uint8Array(indicesUint8.buffer, byteOffsetI, byteLengthI);\r\n          break;\r\n        case 5123: // UNSIGNED_SHORT\r\n          indicesArray = new Uint16Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 2);\r\n          break;\r\n        case 5125: // UNSIGNED_INT\r\n          indicesArray = new Uint32Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 4);\r\n          break;\r\n        default:\r\n          throw new Error(\"Unknown index componentType\");\r\n      }\r\n      this.mesh.indices = indicesArray;\r\n      // W\r\n      let weightsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].weights.view;\r\n      this.mesh.weightsView = weightsView;\r\n      let primitive = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex];\r\n      let finalRoundedWeights = this.getAccessorArray(_glbFile, primitive.weights.weightsAccessIndex);\r\n      const weightsArray = finalRoundedWeights;\r\n      // Normalize each group of 4\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const sum = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(sum > 0) {\r\n          const inv = 1 / sum;\r\n          weightsArray[i] *= inv;\r\n          weightsArray[i + 1] *= inv;\r\n          weightsArray[i + 2] *= inv;\r\n          weightsArray[i + 3] *= inv;\r\n        } else {\r\n          weightsArray[i] = 1; weightsArray[i + 1] = 0;\r\n          weightsArray[i + 2] = 0; weightsArray[i + 3] = 0;\r\n        }\r\n      }\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const s = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(Math.abs(s - 1.0) > 0.001) console.warn(\"Weight not normalized!\", i, s);\r\n      }\r\n      this.mesh.weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer real data\",\r\n        size: weightsArray.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(this.mesh.weightsBuffer.getMappedRange()).set(weightsArray);\r\n      this.mesh.weightsBuffer.unmap();\r\n      let jointsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].joints.view;\r\n      this.mesh.jointsView = jointsView;\r\n      // Create typed array from the buffer (Uint16Array or Uint8Array depending on GLB)\r\n      let jointsArray16 = new Uint16Array(\r\n        jointsView.buffer,\r\n        jointsView.byteOffset || 0,\r\n        jointsView.byteLength / 2 // in Uint16 elements\r\n      );\r\n      const jointsArray32 = new Uint32Array(jointsArray16.length);\r\n      for(let i = 0;i < jointsArray16.length;i++) {\r\n        jointsArray32[i] = jointsArray16[i];\r\n      }\r\n      // Create GPU buffer for joints\r\n      this.mesh.jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer[real-data]\",\r\n        size: jointsArray32.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      // Upload the data to GPU\r\n      new Uint32Array(this.mesh.jointsBuffer.getMappedRange()).set(jointsArray32);\r\n      this.mesh.jointsBuffer.unmap();\r\n\r\n      // TANGENTS\r\n      let tangentArray = null;\r\n      if(_glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents) {\r\n        const tangentView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents.view;\r\n        const byteOffsetT = tangentView.byteOffset || 0;\r\n        const byteLengthT = tangentView.buffer.byteLength;\r\n        tangentArray = new Float32Array(\r\n          tangentView.buffer,\r\n          byteOffsetT,\r\n          byteLengthT / 4\r\n        );\r\n        this.mesh.tangents = tangentArray;\r\n\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer[real-data]\",\r\n          size: tangentArray.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(tangentArray);\r\n        this.mesh.tangentsBuffer.unmap();\r\n      } else {\r\n        // Dummy\r\n        const dummyTangents = new Float32Array(this.mesh.vertices.length / 3 * 4);\r\n        for(let i = 0;i < dummyTangents.length;i += 4) {\r\n          dummyTangents[i + 0] = 1.0; // T = (1,0,0)\r\n          dummyTangents[i + 1] = 0.0;\r\n          dummyTangents[i + 2] = 0.0;\r\n          dummyTangents[i + 3] = 1.0; // handedness\r\n        }\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer dummy\",\r\n          size: dummyTangents.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(dummyTangents);\r\n        this.mesh.tangentsBuffer.unmap();\r\n        console.warn(\"GLTF primitive has no TANGENT attribute (normal map won\u2019t work properly).\");\r\n      }\r\n    } else {\r\n      this.mesh.uvs = this.mesh.textures;\r\n    }\r\n    // ObjSequence animation\r\n    if(typeof o.objAnim !== 'undefined' && o.objAnim != null) {\r\n      this.objAnim = o.objAnim;\r\n      for(var key in this.objAnim.animations) {\r\n        if(key != 'active') this.objAnim.animations[key].speedCounter = 0;\r\n      }\r\n      console.log(`%c Mesh objAnim exist: ${o.objAnim}`, LOG_FUNNY_SMALL);\r\n      this.drawElements = this.drawElementsAnim;\r\n    }\r\n    this.inputHandler = inputHandler;\r\n    this.cameras = o.cameras;\r\n    this.mainCameraParams = {\r\n      type: o.mainCameraParams.type,\r\n      responseCoef: o.mainCameraParams.responseCoef\r\n    };\r\n    this.lastFrameMS = 0;\r\n    this.texturesPaths = [];\r\n    o.texturesPaths.forEach((t) => {this.texturesPaths.push(t)})\r\n    this.presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n    this.position = new Position(o.position.x, o.position.y, o.position.z);\r\n    this.rotation = new Rotation(o.rotation.x, o.rotation.y, o.rotation.z);\r\n    this.rotation.rotationSpeed.x = o.rotationSpeed.x;\r\n    this.rotation.rotationSpeed.y = o.rotationSpeed.y;\r\n    this.rotation.rotationSpeed.z = o.rotationSpeed.z;\r\n    this.scale = o.scale;\r\n    // new dummy for skin mesh\r\n    if(!this.joints) {\r\n      const jointsData = new Uint32Array((this.mesh.vertices.length / 3) * 4);\r\n      const jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer\",\r\n        size: jointsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint32Array(jointsBuffer.getMappedRange()).set(jointsData);\r\n      jointsBuffer.unmap();\r\n      this.joints = {\r\n        data: jointsData,\r\n        buffer: jointsBuffer,\r\n        stride: 16, // vec4<u32>\r\n      };\r\n      const numVerts = this.mesh.vertices.length / 3;\r\n      // Weights data (vec4<f32>) \u2013 default all weight to bone 0\r\n      const weightsData = new Float32Array(numVerts * 4);\r\n      for(let i = 0;i < numVerts;i++) {\r\n        weightsData[i * 4 + 0] = 1.0; // 100% influence of bone 0\r\n        weightsData[i * 4 + 1] = 0.0;\r\n        weightsData[i * 4 + 2] = 0.0;\r\n        weightsData[i * 4 + 3] = 0.0;\r\n      }\r\n      // GPU buffer\r\n      const weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer dummy\",\r\n        size: weightsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(weightsBuffer.getMappedRange()).set(weightsData);\r\n      weightsBuffer.unmap();\r\n      this.weights = {\r\n        data: weightsData,\r\n        buffer: weightsBuffer,\r\n        stride: 16, // vec4<f32>\r\n      };\r\n    }\r\n\r\n    this.runProgram = () => {\r\n      return new Promise(async (resolve) => {\r\n        this.shadowDepthTextureSize = 1024;\r\n        this.modelViewProjectionMatrix = mat4.create();\r\n        this.loadTex0(this.texturesPaths).then(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    }\r\n\r\n    this.runProgram().then(() => {\r\n      this.context.configure({\r\n        device: this.device,\r\n        format: this.presentationFormat,\r\n        alphaMode: 'premultiplied',\r\n      });\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexBuffer.getMappedRange()).set(this.mesh.vertices);\r\n        this.vertexBuffer.unmap();\r\n      }\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexNormalsBuffer.getMappedRange()).set(this.mesh.vertexNormals);\r\n        this.vertexNormalsBuffer.unmap();\r\n      }\r\n\r\n      this.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: this.mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexTexCoordsBuffer.getMappedRange()).set(this.mesh.textures);\r\n        this.vertexTexCoordsBuffer.unmap();\r\n      }\r\n\r\n      // Create the model index buffer.\r\n      this.indexCount = this.mesh.indices.length;\r\n      const indexCount = this.mesh.indices.length;\r\n      const size = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n\r\n      this.indexBuffer = this.device.createBuffer({\r\n        size,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true\r\n      });\r\n\r\n      new Uint16Array(this.indexBuffer.getMappedRange()).set(this.mesh.indices);\r\n      this.indexBuffer.unmap();\r\n      this.indexCount = indexCount;\r\n      let glbInfo = {\r\n        arrayStride: 4 * 4, // vec4<f32> = 4 * 4 bytes\r\n        attributes: [{format: 'float32x4', offset: 0, shaderLocation: 4}]\r\n      }\r\n\r\n      this.vertexBuffers = [\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [\r\n            {\r\n              // position\r\n              shaderLocation: 0,\r\n              offset: 0,\r\n              format: \"float32x3\",\r\n            }\r\n          ],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [\r\n            {\r\n              // normal\r\n              shaderLocation: 1,\r\n              offset: 0,\r\n              format: \"float32x3\",\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 2,\r\n          attributes: [\r\n            {\r\n              // uvs\r\n              shaderLocation: 2,\r\n              offset: 0,\r\n              format: \"float32x2\",\r\n            },\r\n          ],\r\n        },\r\n        // joint indices\r\n        {\r\n          arrayStride: 4 * 4,\r\n          attributes: [{format: 'uint32x4', offset: 0, shaderLocation: 3}]\r\n        },\r\n        // weights\r\n        glbInfo,\r\n      ];\r\n\r\n      if(this.mesh.tangentsBuffer) {\r\n        this.vertexBuffers.push({\r\n          arrayStride: 4 * 4,\r\n          attributes: [\r\n            {shaderLocation: 5, format: \"float32x4\", offset: 0}\r\n          ]\r\n        });\r\n      }\r\n\r\n      // Note: The frontFace and cullMode values have no effect on the \r\n      // \"point-list\", \"line-list\", or \"line-strip\" topologies.\r\n      this.primitive = {\r\n        topology: 'triangle-list',\r\n        cullMode: 'back', // typical for shadow passes\r\n        frontFace: 'ccw'\r\n      }\r\n\r\n      // Selected effect\r\n      this.selectedBuffer = device.createBuffer({\r\n        size: 4, // just one float\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.selectedBindGroupLayout = device.createBindGroupLayout({\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {}},\r\n        ],\r\n      });\r\n\r\n      this.selectedBindGroup = device.createBindGroup({\r\n        layout: this.selectedBindGroupLayout,\r\n        entries: [{binding: 0, resource: {buffer: this.selectedBuffer}}],\r\n      });\r\n\r\n      this.setSelectedEffect = (selected = false) => {\r\n        this.device.queue.writeBuffer(this.selectedBuffer, 0, new Float32Array([selected ? 1.0 : 0.0]));\r\n      };\r\n      // 0 default\r\n      this.setSelectedEffect();\r\n\r\n      // Create a bind group layout which holds the scene uniforms and\r\n      // the texture+sampler for depth. We create it manually because the WebPU\r\n      // implementation doesn't infer this from the shader (yet).\r\n      this.createLayoutForRender();\r\n\r\n      // EDIT INSTANCED PART\r\n      this.instanceTargets = [];\r\n      this.lerpSpeed = 0.05;\r\n      this.lerpSpeedAlpha = 0.05;\r\n      this.maxInstances = 5;\r\n      this.instanceCount = 2;\r\n      this.floatsPerInstance = 16 + 4;\r\n\r\n      for(let x = 0;x < this.maxInstances;x++) {\r\n        this.instanceTargets.push({\r\n          index: x,\r\n          position: [0, 0, 0],\r\n          currentPosition: [0, 0, 0],\r\n          scale: [1, 1, 1],\r\n          currentScale: [1, 1, 1],\r\n          color: [0.6, 0.8, 1.0, 0.4],\r\n          currentColor: [0.6, 0.8, 1.0, 0.4],\r\n        });\r\n      }\r\n\r\n      this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n      this.instanceBuffer = device.createBuffer({\r\n        size: this.instanceData.byteLength,\r\n        usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.updateInstanceData = (modelMatrix) => {\r\n        // original (base instance)\r\n        this.instanceData.set(modelMatrix, 0);\r\n        this.instanceData.set([1, 1, 1, 1], 16);\r\n\r\n        // instanced clones\r\n        for(let i = 1;i < this.instanceCount;i++) {\r\n          const t = this.instanceTargets[i];\r\n          const ghost = new Float32Array(modelMatrix);\r\n          // --- Smooth interpolate position\r\n          for(let j = 0;j < 3;j++) {\r\n            t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n            t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n            t.currentColor[j] += (t.color[j] - t.currentColor[j]) * this.lerpSpeed;\r\n            if(j == 2) {\r\n              t.currentColor[j + 1] += (t.color[j + 1] - t.currentColor[j + 1]) * this.lerpSpeedAlpha;\r\n            }\r\n          }\r\n          // Apply smoothed transforms\r\n          ghost[0] *= t.currentScale[0];\r\n          ghost[5] *= t.currentScale[1];\r\n          ghost[10] *= t.currentScale[2];\r\n          // pos\r\n          ghost[12] += t.currentPosition[0]; // X\r\n          ghost[13] += t.currentPosition[1]; // Y\r\n          ghost[14] += t.currentPosition[2]; // Z\r\n\r\n          // t.color[0] += t.currentColor[0]//r;\r\n          // t.color[1] += t.currentColor[1]//r;\r\n          // t.color[2] += t.currentColor[2]//r;\r\n          // t.color[3] += t.currentColor[3]//r;\r\n          // Write instance matrix + color\r\n          const offset = 20 * i;\r\n          this.instanceData.set(ghost, offset);\r\n          this.instanceData.set(t.currentColor, offset + 16);\r\n        }\r\n        device.queue.writeBuffer(this.instanceBuffer, 0, this.instanceData);\r\n      };\r\n\r\n      this.updateInstances = (newCount) => {\r\n        if(newCount > this.maxInstances) {\r\n          console.error(`Instance count ${newCount} exceeds buffer max ${this.maxInstances}`);\r\n          return;\r\n        }\r\n        this.instanceCount = newCount;\r\n        this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n        this.instanceBuffer = device.createBuffer({\r\n          size: this.instanceData.byteLength,\r\n          usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n        });\r\n        let m = this.getModelMatrix(this.position, this.useScale);\r\n        this.updateInstanceData(m);\r\n\r\n        this.modelBindGroupInstanced = this.device.createBindGroup({\r\n          label: 'modelBindGroup in mesh [instanced]',\r\n          layout: this.uniformBufferBindGroupLayoutInstanced,\r\n          entries: [ //\r\n            {binding: 0, resource: {buffer: this.instanceBuffer, }},\r\n            {binding: 1, resource: {buffer: this.bonesBuffer}},\r\n            {binding: 2, resource: {buffer: this.vertexAnimBuffer}}\r\n          ],\r\n        });\r\n      };\r\n\r\n      this.updateMaxInstances = (newMax) => {\r\n        this.maxInstances = newMax;\r\n        for(let x = 0;x < this.maxInstances;x++) {\r\n          this.instanceTargets.push({\r\n            index: x,\r\n            position: [0, 0, 0],\r\n            currentPosition: [0, 0, 0],\r\n            scale: [1, 1, 1],\r\n            currentScale: [1, 1, 1],\r\n            color: [0.6, 0.8, 1.0, 0.4],\r\n            currentColor: [0.6, 0.8, 1.0, 0.4],\r\n          });\r\n        }\r\n      }\r\n      // end of instanced\r\n\r\n      this.modelUniformBuffer = this.device.createBuffer({\r\n        size: 4 * 16, // 4x4 matrix\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.sceneUniformBuffer = this.device.createBuffer({\r\n        label: 'sceneUniformBuffer per mesh',\r\n        size: 192, //176,\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      // test MUST BE IF\r\n      this.uniformBufferBindGroupLayoutInstanced = this.device.createBindGroupLayout({\r\n        label: 'uniformBufferBindGroupLayout in mesh [instanced]',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n          {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}, },\r\n          {binding: 2, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}}\r\n        ],\r\n      });\r\n\r\n      this.uniformBufferBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'uniformBufferBindGroupLayout in mesh [regular]',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform', }, },\r\n          {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform', }, },\r\n          {binding: 2, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}}\r\n        ],\r\n      });\r\n\r\n      // dummy for non skin mesh like this class\r\n      function alignTo256(n) {\r\n        return Math.ceil(n / 256) * 256;\r\n      }\r\n\r\n      let MAX_BONES = 100;\r\n      this.MAX_BONES = MAX_BONES;\r\n      this.bonesBuffer = device.createBuffer({\r\n        label: \"bonesBuffer\",\r\n        size: alignTo256(64 * MAX_BONES),\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      const bones = new Float32Array(this.MAX_BONES * 16);\r\n      for(let i = 0;i < this.MAX_BONES;i++) {\r\n        // identity matrices\r\n        bones.set([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], i * 16);\r\n      }\r\n      this.device.queue.writeBuffer(this.bonesBuffer, 0, bones);\r\n\r\n\r\n      //\r\n      // vertex Anim\r\n      this.vertexAnimParams = new Float32Array([\r\n        0.0, 0.0, 0.0, 0.0, 2.0, 0.1, 2.0, 0.0, 1.5, 0.3, 2.0, 0.5, 1.0, 0.1, 0.0, 0.0, 1.0, 0.5, 0.0, 0.0, 1.0, 0.05, 0.5, 0.0, 1.0, 0.05, 2.0, 0.0, 1.0, 0.1, 0.0, 0.0,\r\n      ]);\r\n\r\n      this.vertexAnimBuffer = this.device.createBuffer({\r\n        label: \"Vertex Animation Params\",\r\n        size: this.vertexAnimParams.byteLength, // 128 bytes\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.vertexAnim = {\r\n        enableWave: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.WAVE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableWave: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.WAVE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableWind: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.WIND;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableWind: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.WIND;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enablePulse: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.PULSE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disablePulse: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.PULSE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableTwist: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.TWIST;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableTwist: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.TWIST;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableNoise: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.NOISE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableNoise: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.NOISE;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enableOcean: () => {\r\n          this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS.OCEAN;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableOcean: () => {\r\n          this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS.OCEAN;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        enable: (...effects) => {\r\n          effects.forEach(effect => {\r\n            this.vertexAnimParams[1] |= VERTEX_ANIM_FLAGS[effect.toUpperCase()];\r\n          });\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disable: (...effects) => {\r\n          effects.forEach(effect => {\r\n            this.vertexAnimParams[1] &= ~VERTEX_ANIM_FLAGS[effect.toUpperCase()];\r\n          });\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        disableAll: () => {\r\n          this.vertexAnimParams[1] = 0;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        isEnabled: (effect) => {return (this.vertexAnimParams[1] & VERTEX_ANIM_FLAGS[effect.toUpperCase()]) !== 0;},\r\n        setWaveParams: (speed, amplitude, frequency) => {\r\n          this.vertexAnimParams[4] = speed;\r\n          this.vertexAnimParams[5] = amplitude;\r\n          this.vertexAnimParams[6] = frequency;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setWindParams: (speed, strength, heightInfluence, turbulence) => {\r\n          this.vertexAnimParams[8] = speed;\r\n          this.vertexAnimParams[9] = strength;\r\n          this.vertexAnimParams[10] = heightInfluence;\r\n          this.vertexAnimParams[11] = turbulence;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setPulseParams: (speed, amount, centerX = 0, centerY = 0) => {\r\n          this.vertexAnimParams[12] = speed;\r\n          this.vertexAnimParams[13] = amount;\r\n          this.vertexAnimParams[14] = centerX;\r\n          this.vertexAnimParams[15] = centerY;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setTwistParams: (speed, amount) => {\r\n          this.vertexAnimParams[16] = speed;\r\n          this.vertexAnimParams[17] = amount;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setNoiseParams: (scale, strength, speed) => {\r\n          this.vertexAnimParams[20] = scale;\r\n          this.vertexAnimParams[21] = strength;\r\n          this.vertexAnimParams[22] = speed;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setOceanParams: (scale, height, speed) => {\r\n          this.vertexAnimParams[24] = scale;\r\n          this.vertexAnimParams[25] = height;\r\n          this.vertexAnimParams[26] = speed;\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        setIntensity: (value) => {\r\n          this.vertexAnimParams[2] = Math.max(0, Math.min(1, value));\r\n          this.updateVertexAnimBuffer();\r\n        },\r\n        getIntensity: () => {return this.vertexAnimParams[2]}\r\n      };\r\n\r\n      this.updateVertexAnimBuffer = () => {\r\n        this.device.queue.writeBuffer(this.vertexAnimBuffer, 0, this.vertexAnimParams);\r\n      };\r\n\r\n      // globalIntensity\r\n      this.vertexAnimParams[2] = 1.0;\r\n      this.updateVertexAnimBuffer();\r\n      //\r\n      this.modelBindGroup = this.device.createBindGroup({\r\n        label: 'modelBindGroup in mesh',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.modelUniformBuffer}},\r\n          {binding: 1, resource: {buffer: this.bonesBuffer}},\r\n          {binding: 2, resource: {buffer: this.vertexAnimBuffer}}\r\n        ],\r\n      });\r\n\r\n      this.modelBindGroupInstanced = this.device.createBindGroup({\r\n        label: 'modelBindGroup in mesh [instanced]',\r\n        layout: this.uniformBufferBindGroupLayoutInstanced,\r\n        entries: [ //\r\n          {binding: 0, resource: {buffer: this.instanceBuffer, }},\r\n          {binding: 1, resource: {buffer: this.bonesBuffer}},\r\n\r\n          {binding: 2, resource: {buffer: this.vertexAnimBuffer}}\r\n        ],\r\n      });\r\n\r\n      this.mainPassBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'mainPassBindGroupLayout mesh [instaced]',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'depth'}},\r\n          {binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'comparison'}},\r\n        ],\r\n      });\r\n\r\n      this.effects = {};\r\n      console.log('>>>>>>>>>>>>>EFFECTS>>>>>>>>>>>>>>>>>>>>>>>')\r\n      if(this.pointerEffect && this.pointerEffect.enabled === true) {\r\n        let pf = navigator.gpu.getPreferredCanvasFormat();\r\n        pf = 'rgba16float';\r\n        if(typeof this.pointerEffect.pointer !== 'undefined' && this.pointerEffect.pointer == true) {\r\n          this.effects.pointer = new PointerEffect(device, pf, this, true);\r\n        }\r\n        if(typeof this.pointerEffect.ballEffect !== 'undefined' && this.pointerEffect.ballEffect == true) {\r\n          this.effects.ballEffect = new GenGeo(device, pf, 'sphere');\r\n        }\r\n        if(typeof this.pointerEffect.energyBar !== 'undefined' && this.pointerEffect.energyBar == true) {\r\n          this.effects.energyBar = new HPBarEffect(device, pf);\r\n          this.effects.manaBar = new MANABarEffect(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.flameEffect !== 'undefined' && this.pointerEffect.flameEffect == true) {\r\n          this.effects.flameEffect = new FlameEffect(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.pointEffect !== 'undefined' && this.pointerEffect.pointEffect == true) {\r\n          this.effects.pointEffect = new PointEffect(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.flameEmitter !== 'undefined' && this.pointerEffect.flameEmitter == true) {\r\n          this.effects.flameEmitter = new FlameEmitter(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.circlePlane !== 'undefined' && this.pointerEffect.circlePlane == true) {\r\n          this.effects.circlePlane = new GenGeo(device, pf, 'circlePlane');\r\n        }\r\n        if(typeof this.pointerEffect.circlePlaneTex !== 'undefined' && this.pointerEffect.circlePlaneTex == true) {\r\n          this.effects.circlePlaneTex = new GenGeoTexture(device, pf, 'ring', this.pointerEffect.circlePlaneTexPath);\r\n        }\r\n        if(typeof this.pointerEffect.circle !== 'undefined' && this.pointerEffect.circlePlaneTexPath !== 'undefined') {\r\n          this.effects.circle = new GenGeoTexture2(device, pf, 'circle2', this.pointerEffect.circlePlaneTexPath);\r\n        }\r\n      }\r\n\r\n      // Rotates the camera around the origin based on time.\r\n      this.getTransformationMatrix = (mainRenderBundle, spotLight, index) => {\r\n        const now = Date.now();\r\n        const dt = (now - this.lastFrameMS) / this.mainCameraParams.responseCoef;\r\n        this.lastFrameMS = now;\r\n        const camera = this.cameras[this.mainCameraParams.type];\r\n        if(index == 0) camera.update(dt, inputHandler());\r\n        const camVP = mat4.multiply(camera.projectionMatrix, camera.view);\r\n        const sceneData = new Float32Array(48);\r\n        // Light VP\r\n        sceneData.set(spotLight.viewProjMatrix, 0);\r\n        // Camera VP\r\n        sceneData.set(camVP, 16);\r\n        // Camera position + padding\r\n        sceneData.set([camera.position.x, camera.position.y, camera.position.z, 0.0], 32);\r\n        // Light position + padding\r\n        sceneData.set([spotLight.position[0], spotLight.position[1], spotLight.position[2], 0.0], 36);\r\n        sceneData.set([this.globalAmbient[0], this.globalAmbient[1], this.globalAmbient[2], 0.0], 40);\r\n        sceneData.set([this.time, dt, 0, 0], 44);\r\n        device.queue.writeBuffer(\r\n          this.sceneUniformBuffer,\r\n          0,\r\n          sceneData.buffer,\r\n          sceneData.byteOffset,\r\n          sceneData.byteLength\r\n        );\r\n      };\r\n\r\n      this.getModelMatrix = (pos, useScale = false) => {\r\n        let modelMatrix = mat4.identity();\r\n        mat4.translate(modelMatrix, [pos.x, pos.y, pos.z], modelMatrix);\r\n        if(this.itIsPhysicsBody) {\r\n          mat4.rotate(modelMatrix,\r\n            [this.rotation.axis.x, this.rotation.axis.y, this.rotation.axis.z],\r\n            degToRad(this.rotation.angle),\r\n            modelMatrix\r\n          );\r\n        } else {\r\n          mat4.rotateX(modelMatrix, this.rotation.getRotX(), modelMatrix);\r\n          mat4.rotateY(modelMatrix, this.rotation.getRotY(), modelMatrix);\r\n          mat4.rotateZ(modelMatrix, this.rotation.getRotZ(), modelMatrix);\r\n        }\r\n        if((this.glb || this.objAnim) && useScale == true) {\r\n          mat4.scale(modelMatrix, [this.scale[0], this.scale[1], this.scale[2]], modelMatrix);\r\n        }\r\n        return modelMatrix;\r\n      };\r\n\r\n      this.done = true;\r\n      try {\r\n        this.setupPipeline();\r\n      } catch(err) {console.log('err in create pipeline in init ', err)}\r\n    }).then(() => {\r\n      if(typeof this.objAnim !== 'undefined' && this.objAnim !== null) {\r\n        console.log('after all updateMeshListBuffers...')\r\n        this.updateMeshListBuffers();\r\n      }\r\n    })\r\n  }\r\n\r\n  setupPipeline = () => {\r\n    this.createBindGroupForRender();\r\n\r\n    const baseDesc = {\r\n      label: 'Mesh Pipeline Base',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'createPipelineLayout Mesh',\r\n        bindGroupLayouts: [\r\n          this.bglForRender,\r\n          this.uniformBufferBindGroupLayoutInstanced,\r\n          this.selectedBindGroupLayout\r\n        ],\r\n      }),\r\n      vertex: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: vertexWGSLInstanced,\r\n        }),\r\n        buffers: this.vertexBuffers,\r\n      },\r\n      fragment: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.isVideo == true ? fragmentVideoWGSL : this.getMaterial()),\r\n        }),\r\n        constants: {\r\n          shadowDepthTextureSize: this.shadowDepthTextureSize,\r\n        },\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n      primitive: this.primitive,\r\n    };\r\n\r\n    // --- Normal (no blending)\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      ...baseDesc,\r\n      label: 'Mesh Pipeline Opaque \u2705',\r\n      fragment: {\r\n        ...baseDesc.fragment,\r\n        targets: [{\r\n          format: 'rgba16float', //this.presentationFormat,\r\n          blend: undefined,\r\n        }],\r\n      },\r\n    });\r\n\r\n    // --- Blended (alpha)\r\n    this.pipelineBlended = this.device.createRenderPipeline({\r\n      ...baseDesc,\r\n      label: 'Mesh Pipeline Blended \u2705',\r\n      fragment: {\r\n        ...baseDesc.fragment,\r\n        targets: [{\r\n          format: this.presentationFormat,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }],\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: false, // <<< disable depth write for transparency\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n    });\r\n\r\n    // console.log('\u2705Pipelines done');\r\n  };\r\n\r\n  updateModelUniformBuffer = () => {\r\n\r\n    // // JUST TEST ORI EMPTY s\r\n    //     if(this.done == false) return;\r\n    // // Per-object model matrix only\r\n    // const modelMatrix = this.getModelMatrix(this.position, this.useScale);\r\n    // this.device.queue.writeBuffer(\r\n    //   this.modelUniformBuffer,\r\n    //   0,\r\n    //   modelMatrix.buffer,\r\n    //   modelMatrix.byteOffset,\r\n    //   modelMatrix.byteLength\r\n    // );\r\n\r\n  }\r\n\r\n  createGPUBuffer(dataArray, usage) {\r\n    if(!dataArray || typeof dataArray.length !== 'number') {throw new Error('Invalid array passed to createGPUBuffer')}\r\n    const size = dataArray.length * dataArray.BYTES_PER_ELEMENT;\r\n    if(!Number.isFinite(size) || size <= 0) {throw new Error(`Invalid buffer size: ${size}`)}\r\n    const buffer = this.device.createBuffer({size, usage, mappedAtCreation: true});\r\n    const writeArray = dataArray.constructor === Float32Array\r\n      ? new Float32Array(buffer.getMappedRange())\r\n      : new Uint16Array(buffer.getMappedRange());\r\n    writeArray.set(dataArray);\r\n    buffer.unmap();\r\n    return buffer;\r\n  }\r\n\r\n  updateMeshListBuffers() {\r\n    for(const key in this.objAnim.meshList) {\r\n      const mesh = this.objAnim.meshList[key];\r\n      mesh.vertexBuffer = this.device.createBuffer({\r\n        size: mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexBuffer.getMappedRange()).set(mesh.vertices);\r\n      mesh.vertexBuffer.unmap();\r\n      // Normals\r\n      mesh.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexNormalsBuffer.getMappedRange()).set(mesh.vertexNormals);\r\n      mesh.vertexNormalsBuffer.unmap();\r\n      // UVs\r\n      mesh.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexTexCoordsBuffer.getMappedRange()).set(mesh.textures);\r\n      mesh.vertexTexCoordsBuffer.unmap();\r\n      // Indices\r\n      const indexCount = mesh.indices.length;\r\n      const indexSize = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n      mesh.indexBuffer = this.device.createBuffer({\r\n        size: indexSize,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint16Array(mesh.indexBuffer.getMappedRange()).set(mesh.indices);\r\n      mesh.indexBuffer.unmap();\r\n      mesh.indexCount = indexCount;\r\n    }\r\n  }\r\n\r\n  drawElements = (pass, lightContainer) => {\r\n    if(this.isVideo) {this.updateVideoTexture()}\r\n    pass.setBindGroup(0, this.sceneBindGroupForRender);\r\n\r\n    if(this instanceof BVHPlayerInstances) {\r\n      pass.setBindGroup(1, this.modelBindGroupInstanced);\r\n    } else {\r\n      pass.setBindGroup(1, this.modelBindGroup);\r\n    }\r\n\r\n    // Bind each light\u2019s shadow texture & sampler\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2;\r\n      for(const light of lightContainer) {\r\n        pass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    if(this.selectedBindGroup) {\r\n      pass.setBindGroup(2, this.selectedBindGroup);\r\n    }\r\n\r\n    pass.setBindGroup(3, this.waterBindGroup);\r\n\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    pass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    if(this.joints) {\r\n      if(this.constructor.name === \"BVHPlayer\" || this.constructor.name === \"BVHPlayerInstances\") {\r\n        pass.setVertexBuffer(3, this.mesh.jointsBuffer);  // real\r\n        pass.setVertexBuffer(4, this.mesh.weightsBuffer); //real\r\n      } else {\r\n        pass.setVertexBuffer(3, this.joints.buffer);  // new dummy\r\n        pass.setVertexBuffer(4, this.weights.buffer); // new dummy\r\n      }\r\n    }\r\n\r\n    if(this.mesh.tangentsBuffer) {\r\n      pass.setVertexBuffer(5, this.mesh.tangentsBuffer);\r\n    }\r\n\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    // pass.drawIndexed(this.indexCount, this.instanceCount, 0, 0, 0);\r\n    pass.drawIndexed(this.indexCount, 1, 0, 0, 0);\r\n\r\n    // pipelineBlended\r\n    if(this.blendInstanced == true) pass.setPipeline(this.pipelineBlended)\r\n    else pass.setPipeline(this.pipeline);\r\n\r\n    for(var ins = 1;ins < this.instanceCount;ins++) {\r\n      pass.drawIndexed(this.indexCount, 1, 0, 0, ins);\r\n    }\r\n  }\r\n\r\n  drawElementsAnim = (renderPass, lightContainer) => {\r\n    if(!this.sceneBindGroupForRender || !this.modelBindGroup) {console.log(' NULL 1'); return;}\r\n    if(!this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni]) {console.log(' NULL 2'); return;}\r\n\r\n    renderPass.setBindGroup(0, this.sceneBindGroupForRender);\r\n    renderPass.setBindGroup(1, this.modelBindGroup);\r\n    const mesh = this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni];\r\n\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2; // start after UBO & model\r\n      for(const light of lightContainer) {\r\n        renderPass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    pass.setBindGroup(3, this.waterBindGroup);\r\n\r\n    renderPass.setVertexBuffer(0, mesh.vertexBuffer);\r\n    renderPass.setVertexBuffer(1, mesh.vertexNormalsBuffer);\r\n    renderPass.setVertexBuffer(2, mesh.vertexTexCoordsBuffer);\r\n\r\n    if(this.constructor.name === \"BVHPlayer\") {\r\n      renderPass.setVertexBuffer(3, this.mesh.jointsBuffer); // real\r\n      renderPass.setVertexBuffer(4, this.mesh.weightsBuffer);// real\r\n    } else {\r\n      // dummy\r\n      renderPass.setVertexBuffer(3, this.joints.buffer);  // dummy\r\n      renderPass.setVertexBuffer(4, this.weights.buffer); // dummy\r\n    }\r\n\r\n    renderPass.setIndexBuffer(mesh.indexBuffer, 'uint16');\r\n    renderPass.drawIndexed(mesh.indexCount);\r\n\r\n    if(this.objAnim.playing == true) {\r\n      if(this.objAnim.animations[this.objAnim.animations.active].speedCounter >= this.objAnim.animations[this.objAnim.animations.active].speed) {\r\n        this.objAnim.currentAni++;\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter = 0;\r\n      } else {\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter++;\r\n      }\r\n      if(this.objAnim.currentAni >= this.objAnim.animations[this.objAnim.animations.active].to) {\r\n        this.objAnim.currentAni = this.objAnim.animations[this.objAnim.animations.active].from;\r\n      }\r\n    }\r\n  }\r\n\r\n  drawShadows = (shadowPass) => {\r\n    shadowPass.setVertexBuffer(0, this.vertexBuffer);\r\n    shadowPass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    shadowPass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    if(this.joints) {\r\n      if(this.constructor.name === \"BVHPlayer\" || this.constructor.name === \"BVHPlayerInstances\") {\r\n        shadowPass.setVertexBuffer(3, this.mesh.jointsBuffer);  // real\r\n        shadowPass.setVertexBuffer(4, this.mesh.weightsBuffer); // real\r\n      } else {\r\n        shadowPass.setVertexBuffer(3, this.joints.buffer);  // dummy\r\n        shadowPass.setVertexBuffer(4, this.weights.buffer); // dummy\r\n      }\r\n    }\r\n    shadowPass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    if(this instanceof BVHPlayerInstances) {\r\n      shadowPass.drawIndexed(this.indexCount, this.instanceCount, 0, 0, 0);\r\n    } else {\r\n      shadowPass.drawIndexed(this.indexCount);\r\n    }\r\n  }\r\n}", "// import MEBvh from \"bvh-loader\";\r\nimport {mat4, quat} from \"wgpu-matrix\";\r\nimport {GLTFBuffer} from \"./webgpu-gltf.js\";\r\nimport MEMeshObjInstances from \"../instanced/mesh-obj-instances.js\";\r\n\r\n// export var animBVH = new MEBvh();\r\n// export let loadBVH = (path) => {\r\n//   return new Promise((resolve, reject) => {\r\n//     animBVH.parse_file(path).then(() => {\r\n//       console.info(\"plot_hierarchy no function\")\r\n//       animBVH.plot_hierarchy();\r\n//       var r = animBVH.frame_pose(0);\r\n//       // Not in use at the moment next feature - change skeletal or indipended new class.\r\n//       // console.log(\"FINAL P => \", r[0].length)\r\n//       // console.log(\"FINAL R => \", r[1].length)\r\n//       var KEYS = animBVH.joint_names();\r\n//       for(var x = 0;x < r[0].length;x++) {\r\n//         // console.log(\"->\" + KEYS[x] + \"-> position: \" + r[0][x] + \" rotation: \" + r[1][x]);\r\n//       }\r\n//       var all = animBVH.all_frame_poses();\r\n//       // console.log(\"Final All -> \", all);\r\n//       resolve(animBVH);\r\n//     }).catch((err) => {reject(err)});\r\n//   })\r\n// }\r\n\r\n/**\r\n * @description\r\n * Skinning basic done animation can be changed with animation index.\r\n * Holder for GLB model with skinning.\r\n * @param {GLBModel} glb - Your loaded GLB\r\n * @param {Object} bvhBones - Mapping of boneName \u2192 BVH bone data\r\n * @param {GPUDevice} device - WebGPU device\r\n * @credits Chatgpt assist here.\r\n */\r\nexport class BVHPlayerInstances extends MEMeshObjInstances {\r\n  constructor(o, bvh, glb, primitiveIndex, skinnedNodeIndex, canvas, device, context, inputHandler, globalAmbient) {\r\n    super(canvas, device, context, o, inputHandler, globalAmbient, glb, primitiveIndex, skinnedNodeIndex);\r\n    // bvh arg not actual at the moment\r\n    this.bvh = {};\r\n    this.glb = glb;\r\n    this.currentFrame = 0;\r\n    this.fps = 30;\r\n    this.timeAccumulator = 0;\r\n    // debug\r\n    this.scaleBoneTest = 1;\r\n    this.primitiveIndex = primitiveIndex;\r\n    if(!this.bvh.sharedState) {\r\n      this.bvh.sharedState = {\r\n        emitAnimationEvent: false,\r\n        animationStarted: false,\r\n        currentFrame: 0,\r\n        timeAccumulator: 0,\r\n        animationFinished: false\r\n      };\r\n    }\r\n    this.sharedState = this.bvh.sharedState;\r\n    // Reference to the skinned node containing all bones\r\n    this.skinnedNode = this.glb.skinnedMeshNodes[skinnedNodeIndex];\r\n    // console.log('this.skinnedNode', this.skinnedNode)\r\n    this.nodeWorldMatrices = Array.from(\r\n      {length: this.glb.nodes.length},\r\n      () => mat4.identity()\r\n    );\r\n    this.startTime = performance.now() / 1000; // seconds - anim speed control\r\n    this.MAX_BONES = 100; // predefined\r\n    this.skeleton = []; // array of joint node indices\r\n    this.animationSpeed = 1000;\r\n    this.inverseBindMatrices = []; // Float32Array for each joint\r\n    this.initInverseBindMatrices();\r\n    this.makeSkeletal();\r\n  }\r\n\r\n  makeSkeletal() {\r\n    let skin = this.glb.skins[0];\r\n    const accessorIndex = skin.inverseBindMatrices;\r\n    if(accessorIndex == null) {\r\n      console.warn(\"No inverseBindMatrices, using identity matrices\");\r\n    }\r\n    // 1. Load all inverse bind matrices once\r\n    const invBindArray = this.inverseBindMatrices; // set earlier by initInverseBindMatrices()\r\n    // 2. Build skeleton array from skin.joints only\r\n    this.skeleton = skin.joints.slice(); // direct copy of indices\r\n    // 3. Assign inverseBindMatrix to each joint node correctly\r\n    for(let i = 0;i < skin.joints.length;i++) {\r\n      const jointIndex = skin.joints[i];\r\n      const jointNode = this.glb.nodes[jointIndex];\r\n      // assign only to bone nodes\r\n      jointNode.inverseBindMatrix = invBindArray.slice(i * 16, (i + 1) * 16);\r\n      // decompose node\u2019s transform once (if not already)\r\n      if(!jointNode.transform) {\r\n        jointNode.transform = new Float32Array([\r\n          1, 0, 0, 0,\r\n          0, 1, 0, 0,\r\n          0, 0, 1, 0,\r\n          0, 0, 0, 1\r\n        ]);\r\n      }\r\n      if(!jointNode.translation || !jointNode.rotation || !jointNode.scale) {\r\n        const {translation, rotation, scale} = this.decomposeMatrix(jointNode.transform);\r\n        jointNode.translation = translation;\r\n        jointNode.rotation = rotation;\r\n        jointNode.scale = scale;\r\n      }\r\n    }\r\n    // 4. For mesh nodes or armature parent nodes, leave them alone\r\n    // what is animation , check is it more - we look for Armature by defoult \r\n    // friendly blender\r\n    this.glb.animationIndex = 0;\r\n    for(let j = 0;j < this.glb.glbJsonData.animations.length;j++) {\r\n      if(this.glb.glbJsonData.animations[j].name.indexOf('Armature') !== -1) {\r\n        this.glb.animationIndex = j;\r\n      }\r\n    }\r\n  }\r\n\r\n  initInverseBindMatrices(skinIndex = 0) {\r\n    const skin = this.glb.skins[skinIndex];\r\n    const invBindAccessorIndex = skin.inverseBindMatrices; // number\r\n    if(invBindAccessorIndex === undefined || invBindAccessorIndex === null) {\r\n      console.warn('No inverseBindMatrices accessor for skin', skinIndex);\r\n      return;\r\n    }\r\n    const invBindArray = this.getAccessorArray(this.glb, invBindAccessorIndex);\r\n    this.inverseBindMatrices = invBindArray;\r\n  }\r\n\r\n  getNumberOfFramesCurAni() {\r\n    const anim = this.glb.glbJsonData.animations[this.glb.animationIndex];\r\n    let maxFrames = 0;\r\n    if (typeof anim == 'undefined') {\r\n      console.log('[anim undefined]', this.name)\r\n      return 1;\r\n    }\r\n    for(const sampler of anim.samplers) {\r\n      const inputAccessor = this.glb.glbJsonData.accessors[sampler.input];\r\n      if(inputAccessor.count > maxFrames) maxFrames = inputAccessor.count;\r\n    }\r\n    return maxFrames;\r\n  }\r\n\r\n  getAnimationLength(animation) {\r\n    let maxTime = 0;\r\n    for(const channel of animation.channels) {\r\n      const sampler = animation.samplers[channel.sampler];\r\n      const inputTimes = this.getAccessorArray(this.glb, sampler.input);\r\n      const lastTime = inputTimes[inputTimes.length - 1];\r\n      if(lastTime > maxTime) maxTime = lastTime;\r\n    }\r\n    return maxTime;\r\n  }\r\n\r\n  update(deltaTime) {\r\n    const frameTime = 1 / this.fps;\r\n    this.sharedState.timeAccumulator += deltaTime;\r\n    while(this.sharedState.timeAccumulator >= frameTime) {\r\n      this.sharedState.currentFrame = (this.sharedState.currentFrame + 1) % this.getNumberOfFramesCurAni();\r\n      this.sharedState.timeAccumulator -= frameTime;\r\n    }\r\n    // const test = this.getNumberOfFramesCurAni();\r\n    var inTime = this.getAnimationLength(this.glb.glbJsonData.animations[this.glb.animationIndex])\r\n    if(this.sharedState.animationStarted == false && this.sharedState.emitAnimationEvent == true) {\r\n      this.sharedState.animationStarted = true;\r\n      setTimeout(() => {\r\n        this.sharedState.animationStarted = false;\r\n        // specific rule for naming (some from blender source)\r\n        // let n = this.name;\r\n        // if(this.name.indexOf('_') != -1) {\r\n        //   n = this.name.split('_')[0];\r\n        // }\r\n        dispatchEvent(new CustomEvent(`animationEnd-${this.name}`, {\r\n          detail: {\r\n            animationName: this.glb.glbJsonData.animations[this.glb.animationIndex].name\r\n          }\r\n        }))\r\n      }, inTime * 1000)\r\n    }\r\n    const currentTime = performance.now() / this.animationSpeed - this.startTime;\r\n    const boneMatrices = new Float32Array(this.MAX_BONES * 16);\r\n    if(this.glb.glbJsonData.animations && this.glb.glbJsonData.animations.length > 0) {\r\n      this.updateSingleBoneCubeAnimation(this.glb.glbJsonData.animations[this.glb.animationIndex], this.glb.nodes, currentTime, boneMatrices)\r\n    }\r\n  }\r\n\r\n  getAccessorArray(glb, accessorIndex) {\r\n    const accessor = glb.glbJsonData.accessors[accessorIndex];\r\n    const bufferView = glb.glbJsonData.bufferViews[accessor.bufferView];\r\n    const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n    const byteLength =\r\n      accessor.count *\r\n      this.getNumComponents(accessor.type) *\r\n      (accessor.componentType === 5126 ? 4 : 2);\r\n    const bufferDef = glb.glbBinaryBuffer;\r\n    const slice = this.getBufferSlice(bufferDef, byteOffset, byteLength);\r\n    switch(accessor.componentType) {\r\n      case 5126: // FLOAT\r\n        return new Float32Array(slice);\r\n      case 5123: // UNSIGNED_SHORT\r\n        return new Uint16Array(slice);\r\n      case 5121: // UNSIGNED_BYTE\r\n        return new Uint8Array(slice);\r\n      default:\r\n        throw new Error(\"Unsupported componentType: \" + accessor.componentType);\r\n    }\r\n  }\r\n\r\n  getAccessorTypeForChannel(path) {\r\n    switch(path) {\r\n      case \"translation\": return \"VEC3\";\r\n      case \"rotation\": return \"VEC4\";\r\n      case \"scale\": return \"VEC3\";\r\n      case \"weights\": return \"VECN\";\r\n      default: throw new Error(\"Unknown channel path: \" + path);\r\n    }\r\n  }\r\n\r\n  getNumComponents(type) {\r\n    switch(type) {\r\n      case \"SCALAR\": return 1;\r\n      case \"VEC2\": return 2;\r\n      case \"VEC3\": return 3;\r\n      case \"VEC4\": return 4;\r\n      case \"MAT4\": return 16;\r\n      default: throw new Error(\"Unknown type: \" + type);\r\n    }\r\n  }\r\n\r\n  getComponentSize(componentType) {\r\n    switch(componentType) {\r\n      case 5126: return 4; // float32\r\n      case 5123: return 2; // uint16\r\n      case 5121: return 1; // uint8\r\n      default: throw new Error(\"Unknown componentType: \" + componentType);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  @description\r\n   *  Get a typed slice of the raw binary buffer from glTF buffer definitions.\r\n   * @param {Object} bufferDef - the glTF buffer definition (usually gltfJson.buffers[0])\r\n   * @param {Number} byteOffset - byte offset into the buffer\r\n   * @param {Number} byteLength - byte length to slice\r\n   * @returns {ArrayBuffer} sliced array buffer\r\n   **/\r\n  getBufferSlice(bufferDef, byteOffset, byteLength) {\r\n    // GLTFBuffer instance:\r\n    if(bufferDef instanceof GLTFBuffer) {\r\n      // Use .arrayBuffer + .byteOffset:\r\n      return bufferDef.arrayBuffer.slice(\r\n        bufferDef.byteOffset + (byteOffset || 0),\r\n        bufferDef.byteOffset + (byteOffset || 0) + byteLength\r\n      );\r\n    }\r\n    // Already have a raw ArrayBuffer:\r\n    if(bufferDef instanceof ArrayBuffer) {\r\n      return bufferDef.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n    // Some loaders store it as .data or ._data:\r\n    if(bufferDef && bufferDef.data instanceof ArrayBuffer) {\r\n      return bufferDef.data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n    if(bufferDef && bufferDef._data instanceof ArrayBuffer) {\r\n      return bufferDef._data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n    throw new Error(\"No binary data found in GLB buffer[0]\");\r\n  }\r\n\r\n  // --- helpers\r\n  lerpVec(a, b, t) {\r\n    return a.map((v, i) => v * (1 - t) + b[i] * t);\r\n  }\r\n\r\n  // Example quaternion slerp (a,b = [x,y,z,w])\r\n  quatSlerp(a, b, t) {\r\n    // naive slerp for small demo, normalize result\r\n    let dot = a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n    if(dot < 0) {b = b.map(v => -v); dot = -dot;}\r\n    if(dot > 0.9995) return lerpVec(a, b, t);\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n    return a.map((v, i) => s0 * v + s1 * b[i]);\r\n  }\r\n\r\n  // naive quaternion to 4x4 matrix\r\n  quatToMat4(q) {\r\n    const [x, y, z, w] = q;\r\n    const xx = x * x, yy = y * y, zz = z * z;\r\n    const xy = x * y, xz = x * z, yz = y * z, wx = w * x, wy = w * y, wz = w * z;\r\n    return new Float32Array([\r\n      1 - 2 * (yy + zz), 2 * (xy + wz), 2 * (xz - wy), 0,\r\n      2 * (xy - wz), 1 - 2 * (xx + zz), 2 * (yz + wx), 0,\r\n      2 * (xz + wy), 2 * (yz - wx), 1 - 2 * (xx + yy), 0,\r\n      0, 0, 0, 1\r\n    ]);\r\n  }\r\n\r\n  // Compose TRS to a 4\u00D74\r\n  composeMatrix(translation, rotationQuat, scale) {\r\n    const m = mat4.identity();\r\n    mat4.translate(m, translation, m);\r\n    const rot = mat4.fromQuat(rotationQuat);\r\n    mat4.multiply(m, rot, m);\r\n    mat4.scale(m, scale, m);\r\n    return m;\r\n    // const m = mat4.identity();\r\n    // mat4.translate(m, translation, m);\r\n    // const rot = mat4.fromQuat(rotationQuat);\r\n    // mat4.multiply(m, rot, m);\r\n    // mat4.scale(m, scale, m);\r\n    // // Flip Y globally\r\n    // const flipY = mat4.identity();\r\n    // mat4.scale(flipY, [1, 1, -1], flipY);\r\n    // mat4.multiply(m, flipY, m);\r\n    // return m;\r\n  }\r\n\r\n  decomposeMatrix(m) {\r\n    // m is column-major: indices:\r\n    // [ m0 m4 m8  m12\r\n    //   m1 m5 m9  m13\r\n    //   m2 m6 m10 m14\r\n    //   m3 m7 m11 m15 ]\r\n    const t = new Float32Array([m[12], m[13], m[14]]);\r\n    // Extract the 3 column vectors (upper-left 3x3)\r\n    const cx = [m[0], m[1], m[2]];\r\n    const cy = [m[4], m[5], m[6]];\r\n    const cz = [m[8], m[9], m[10]];\r\n    // Lengths = scales\r\n    const len = v => Math.hypot(v[0], v[1], v[2]);\r\n    let sx = len(cx), sy = len(cy), sz = len(cz);\r\n    // If any scale nearly zero, avoid divide-by-zero\r\n    if(sx === 0) sx = 1.0;\r\n    if(sy === 0) sy = 1.0;\r\n    if(sz === 0) sz = 1.0;\r\n    // Normalize columns to produce a pure rotation matrix\r\n    const r00 = m[0] / sx, r01 = m[4] / sy, r02 = m[8] / sz;\r\n    const r10 = m[1] / sx, r11 = m[5] / sy, r12 = m[9] / sz;\r\n    const r20 = m[2] / sx, r21 = m[6] / sy, r22 = m[10] / sz;\r\n    // Fix negative-scale (reflection) case: if determinant < 0, flip sign of one scale and corresponding column\r\n    const det3 = r00 * (r11 * r22 - r12 * r21) - r01 * (r10 * r22 - r12 * r20) + r02 * (r10 * r21 - r11 * r20);\r\n    if(det3 < 0) {\r\n      // flip Z\r\n      sz = -sz;\r\n      // flip third column sign\r\n      // multiply cz by -1 => r02,r12,r22 *= -1\r\n      // recompute normalized r* accordingly:\r\n      // since we only need a valid rotation matrix for quaternion conversion,\r\n      // just invert the third column\r\n      // (alternatively flip sx or sy\u2014this is a convention choice)\r\n      // Here we flip the third column:\r\n      // r02 = -r02; r12 = -r12; r22 = -r22;\r\n    }\r\n    // Build quaternion from rotation matrix (r00..r22)\r\n    // Using standard conversion (column-major rotation)\r\n    const trace = r00 + r11 + r22;\r\n    let qx, qy, qz, qw;\r\n    if(trace > 0.00001) {\r\n      const s = Math.sqrt(trace + 1.0) * 2; // s=4*qw\r\n      qw = 0.25 * s;\r\n      qx = (r21 - r12) / s;\r\n      qy = (r02 - r20) / s;\r\n      qz = (r10 - r01) / s;\r\n    } else if(r00 > r11 && r00 > r22) {\r\n      const s = Math.sqrt(1.0 + r00 - r11 - r22) * 2; // s=4*qx\r\n      qw = (r21 - r12) / s;\r\n      qx = 0.25 * s;\r\n      qy = (r01 + r10) / s;\r\n      qz = (r02 + r20) / s;\r\n    } else if(r11 > r22) {\r\n      const s = Math.sqrt(1.0 + r11 - r00 - r22) * 2; // s=4*qy\r\n      qw = (r02 - r20) / s;\r\n      qx = (r01 + r10) / s;\r\n      qy = 0.25 * s;\r\n      qz = (r12 + r21) / s;\r\n    } else {\r\n      const s = Math.sqrt(1.0 + r22 - r00 - r11) * 2; // s=4*qz\r\n      qw = (r10 - r01) / s;\r\n      qx = (r02 + r20) / s;\r\n      qy = (r12 + r21) / s;\r\n      qz = 0.25 * s;\r\n    }\r\n\r\n    const rot = new Float32Array([qx, qy, qz, qw]);\r\n    const scale = new Float32Array([sx, sy, sz]);\r\n    return {translation: t, rotation: rot, scale: scale};\r\n  }\r\n\r\n  slerp(q0, q1, t, out) {\r\n    let dot = q0[0] * q1[0] + q0[1] * q1[1] + q0[2] * q1[2] + q0[3] * q1[3];\r\n    if(dot < 0) {dot = -dot; q1 = [-q1[0], -q1[1], -q1[2], -q1[3]];}\r\n    if(dot > 0.9995) {\r\n      // linear\r\n      for(let i = 0;i < 4;i++) out[i] = q0[i] + t * (q1[i] - q0[i]);\r\n      // normalize\r\n      const len = Math.hypot(...out);\r\n      for(let i = 0;i < 4;i++) out[i] /= len;\r\n      return;\r\n    }\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n    for(let i = 0;i < 4;i++) {\r\n      out[i] = s0 * q0[i] + s1 * q1[i];\r\n    }\r\n  }\r\n\r\n  updateSingleBoneCubeAnimation(glbAnimation, nodes, time, boneMatrices) {\r\n    const channels = glbAnimation.channels;\r\n    const samplers = glbAnimation.samplers;\r\n    // --- Map channels per node for faster lookup\r\n    const nodeChannels = new Map();\r\n    for(const channel of channels) {\r\n      if(!nodeChannels.has(channel.target.node)) nodeChannels.set(channel.target.node, []);\r\n      nodeChannels.get(channel.target.node).push(channel);\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const nodeIndex = this.skeleton[j];\r\n      const node = nodes[nodeIndex];\r\n      // --- Initialize node TRS if needed\r\n      if(!node.translation) node.translation = new Float32Array([0, 0, 0]);\r\n      if(!node.rotation) node.rotation = quat.create();\r\n      if(!node.scale) node.scale = new Float32Array([1, 1, 1]);\r\n      // --- Keep original TRS for additive animation\r\n      if(!node.originalTranslation) node.originalTranslation = node.translation.slice();\r\n      if(!node.originalRotation) node.originalRotation = node.rotation.slice();\r\n      if(!node.originalScale) node.originalScale = node.scale.slice();\r\n      const channelsForNode = nodeChannels.get(nodeIndex) || [];\r\n      for(const channel of channelsForNode) {\r\n        const path = channel.target.path; // \"translation\" | \"rotation\" | \"scale\"\r\n        const sampler = samplers[channel.sampler];\r\n        // --- Get input/output arrays\r\n        const inputTimes = this.getAccessorArray(this.glb, sampler.input);\r\n        const outputArray = this.getAccessorArray(this.glb, sampler.output);\r\n        const numComponents = path === \"rotation\" ? 4 : 3;\r\n        // --- Find keyframe interval\r\n        const animTime = time % inputTimes[inputTimes.length - 1];\r\n        let i = 0;\r\n        while(i < inputTimes.length - 1 && inputTimes[i + 1] <= animTime) i++;\r\n        const t0 = inputTimes[i];\r\n        const t1 = inputTimes[Math.min(i + 1, inputTimes.length - 1)];\r\n        const factor = t1 !== t0 ? (animTime - t0) / (t1 - t0) : 0;\r\n        // --- Interpolated keyframe values\r\n        const v0 = outputArray.subarray(i * numComponents, (i + 1) * numComponents);\r\n        const v1 = outputArray.subarray(\r\n          Math.min(i + 1, inputTimes.length - 1) * numComponents,\r\n          Math.min(i + 2, inputTimes.length) * numComponents\r\n        );\r\n        // --- Apply animation\r\n        if(path === \"translation\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.translation[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"scale\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.scale[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"rotation\") {\r\n          this.slerp(v0, v1, factor, node.rotation);\r\n        }\r\n      }\r\n      // --- Recompose local transform\r\n      node.transform = this.composeMatrix(node.translation, node.rotation, node.scale);\r\n    }\r\n    const computeWorld = (nodeIndex) => {\r\n      const node = nodes[nodeIndex];\r\n      if(!node.worldMatrix) node.worldMatrix = mat4.create();\r\n      let parentWorld = node.parent !== null ? nodes[node.parent].worldMatrix : null;\r\n      if(parentWorld) {\r\n        // multiply parent * local\r\n        mat4.multiply(parentWorld, node.transform, node.worldMatrix);\r\n      } else {\r\n        mat4.copy(node.transform, node.worldMatrix);\r\n      }\r\n\r\n      mat4.scale(node.worldMatrix, [this.scaleBoneTest, this.scaleBoneTest, this.scaleBoneTest], node.worldMatrix);\r\n      if(node.children) {\r\n        for(const childIndex of node.children) computeWorld(childIndex);\r\n      }\r\n    };\r\n    for(let i = 0;i < nodes.length;i++) {\r\n      if(nodes[i].parent === null || nodes[i].parent === undefined) {\r\n        computeWorld(i);\r\n      }\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const jointNode = nodes[this.skeleton[j]];\r\n      const finalMat = mat4.create();\r\n      mat4.multiply(jointNode.worldMatrix, jointNode.inverseBindMatrix, finalMat);\r\n      boneMatrices.set(finalMat, j * 16);\r\n    }\r\n    // --- Upload to GPU\r\n    this.device.queue.writeBuffer(this.bonesBuffer, 0, boneMatrices);\r\n    return boneMatrices;\r\n  }\r\n}", "export class METoolTip {\r\n\r\n  constructor() {\r\n    // --- Tooltip system ---\r\n    const tooltip = document.createElement('div');\r\n    tooltip.style.position = 'fixed';\r\n    tooltip.style.padding = '6px 10px';\r\n    tooltip.style.background = 'rgba(0,0,0,0.8)';\r\n    tooltip.style.color = '#fff';\r\n    tooltip.style.borderRadius = '6px';\r\n    tooltip.style.fontFamily = 'Arial';\r\n    tooltip.style.fontSize = '12px';\r\n    tooltip.style.pointerEvents = 'none';\r\n    tooltip.style.opacity = '0';\r\n    tooltip.style.transition = 'opacity 0.2s ease';\r\n    tooltip.style.zIndex = '9999';\r\n    tooltip.style.whiteSpace = 'pre-line';\r\n    document.body.appendChild(tooltip);\r\n    this.tooltip = tooltip;\r\n  }\r\n  attachTooltip(element, text) {\r\n    element.addEventListener('mouseenter', (e) => {\r\n      this.tooltip.textContent = text;\r\n      this.tooltip.style.opacity = '1';\r\n    });\r\n    element.addEventListener('mousemove', (e) => {\r\n      this.tooltip.style.left = e.clientX + 12 + 'px';\r\n      this.tooltip.style.top = e.clientY + 12 + 'px';\r\n    });\r\n    element.addEventListener('mouseleave', () => {\r\n      this.tooltip.style.opacity = '0';\r\n    });\r\n  }\r\n}", "import {LOG_FUNNY_ARCADE, LOG_FUNNY_BIG_TERMINAL, mb} from \"../../engine/utils\";\r\n\r\nexport class MEEditorClient {\r\n  ws = null;\r\n  constructor(typeOfRun, name) {\r\n    this.ws = new WebSocket(\"ws://localhost:1243\");\r\n\r\n    this.ws.onopen = () => {\r\n      if(typeOfRun == 'created from editor') {\r\n        console.log(`%cCreated from editor. Watch <signal> ${name}`, LOG_FUNNY_ARCADE);\r\n        let o = {\r\n          action: \"watch\",\r\n          name: name\r\n        };\r\n        o = JSON.stringify(o);\r\n        this.ws.send(o);\r\n        o = {\r\n          action: \"list\",\r\n          path: name\r\n        };\r\n        o = JSON.stringify(o);\r\n        this.ws.send(o);\r\n      }\r\n      console.log(\"%c[EDITOR][WS OPEN]\", LOG_FUNNY_ARCADE);\r\n      document.dispatchEvent(new CustomEvent(\"editorx-ws-ready\", {}));\r\n    };\r\n\r\n    this.ws.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        console.log(\"%c[EDITOR][WS MESSAGE]\", LOG_FUNNY_ARCADE, data);\r\n        if(data && data.ok == true && data.payload && data.payload.redirect == true) {\r\n          setTimeout(() => location.assign(data.name + \".html\"), 2000);\r\n        } else if(data.payload && data.payload == \"stop-watch done\") {\r\n          mb.show(\"watch-stoped\");\r\n        } else if(data.listAssetsForGraph) {\r\n          // later in graphs ... \r\n          document.dispatchEvent(new CustomEvent('editorx-update-assets-list', {\r\n            detail: data\r\n          }))\r\n        } else if(data.listAssets) {\r\n          document.dispatchEvent(new CustomEvent('la', {\r\n            detail: data\r\n          }))\r\n        } else if(data.projects) {\r\n          const projects = data.payload\r\n            .filter(item => item.name !== 'readme.md')\r\n            .map(item => item.name.trim());\r\n          if(projects.length === 0) {\r\n            console.warn('No projects found');\r\n            return;\r\n          }\r\n          const txt = \"Project list: \\n\" +\r\n            projects.map(p => `- ${p}`).join(\"\\n\") + \"\\n\" +\r\n            \"  Choose project name:\";\r\n          const projectName = prompt(txt);\r\n          if(projectName) {\r\n            console.log(\"Project name:\", projectName);\r\n            location.assign(projectName + \".html\");\r\n          } else {\r\n            console.error('Project loading cancelled');\r\n          }\r\n        } else if(data.details) {\r\n          document.dispatchEvent(new CustomEvent('file-detail-data', {\r\n            detail: data\r\n          }))\r\n        } else if(data.refresh == 'refresh') {\r\n          // setTimeout(() => location.reload(true) , 1500);\r\n          setTimeout(() => document.dispatchEvent(new CustomEvent('updateSceneContainer', {detail: {}})), 1000)\r\n        } else {\r\n          if(data.methodSaves && data.ok == true) {\r\n            mb.show(\"Graph saved \u2705\");\r\n            // console.log('Graph saved \u2705 test ', data.graphName);\r\n            if (typeof data.graphName === \"string\") document.dispatchEvent(new CustomEvent('get-shader-graphs', {}));\r\n          }\r\n          if(data.methodLoads && data.ok == true && data.shaderGraphs) {\r\n            mb.show(\"Graphs list \u2705\" + data.shaderGraphs);\r\n            document.dispatchEvent(new CustomEvent('on-shader-graphs-list', {detail: data.shaderGraphs}));\r\n          } else if(data.methodLoads && data.ok == true) {\r\n            mb.show(\"Graph loads \u2705\", data);\r\n            document.dispatchEvent(new CustomEvent('on-graph-load', {detail: data.graph}));\r\n          } else if(data.aiGenGraph && data.ok == true) {\r\n            mb.show(\"AIGraph Generator response graph part \u2705\", data.aiGenNodes);\r\n            document.dispatchEvent(new CustomEvent('on-ai-graph-response', {detail: data.aiGenNodes}));\r\n          }\r\n          else {\r\n            mb.show(\"From editorX:\" + data.ok);\r\n          }\r\n        }\r\n      } catch(e) {\r\n        console.error(\"[WS ERROR PARSE]\", e);\r\n      }\r\n    };\r\n\r\n    this.ws.onerror = (err) => {\r\n      console.error(\"%c[WS ERROR]\", \"color: red\", err);\r\n      document.dispatchEvent(new CustomEvent(\"editor-not-running\", {detail: {}}));\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      console.log(\"%c[WS CLOSED]\", \"color: gray\");\r\n    }\r\n\r\n    this.attachEvents();\r\n  }\r\n\r\n  attachEvents() {\r\n\r\n    document.addEventListener('lp', (e) => {\r\n      console.info('Load project <signal>');\r\n      let o = {\r\n        action: \"lp\"\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('cnp', (e) => {\r\n      console.info('Create new project <signal>');\r\n      let o = {\r\n        action: \"cnp\",\r\n        name: e.detail.name,\r\n        features: e.detail.features\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('stop-watch', (e) => {\r\n      console.info('stop-watch <signal>');\r\n      let o = {\r\n        action: \"stop-watch\",\r\n        name: e.detail.name\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('start-watch', (e) => {\r\n      console.info('start-watch <signal>');\r\n      let o = {\r\n        action: \"watch\",\r\n        name: e.detail.name\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('nav-folder', (e) => {\r\n      console.info('nav-folder <signal>');\r\n      let o = {\r\n        action: \"nav-folder\",\r\n        name: e.detail.name,\r\n        rootFolder: e.detail.rootFolder\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('file-detail', (e) => {\r\n      console.info('%c[file-detail <signal>]', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"file-detail\",\r\n        name: e.detail.name,\r\n        rootFolder: e.detail.rootFolder\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addCube', (e) => {\r\n      console.info('%c[web.editor.addCube]', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"addCube\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        options: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addSphere', (e) => {\r\n      console.info('%c[web.editor.addSphere]', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"addSphere\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        options: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('save-methods', (e) => {\r\n      console.info('%cSave methods <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"save-methods\",\r\n        methodsContainer: e.detail.methodsContainer\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('save-graph', (e) => {\r\n      console.info('%cSave graph <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"save-graph\",\r\n        graphData: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('save-shader-graph', (e) => {\r\n      console.info('%cSave shader-graph <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"save-shader-graph\",\r\n        graphData: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('aiGenGraphCall', (e) => {\r\n      console.info('%caiGenGraphCall fluxCodexVertex <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"aiGenGraphCall\",\r\n        prompt: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('load-shader-graph', (e) => {\r\n      console.info('%cLoad shader-graph <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"load-shader-graph\",\r\n        name: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('delete-shader-graph', (e) => {\r\n      console.info('%cDelete shader-graph <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"delete-shader-graph\",\r\n        name: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('get-shader-graphs', () => {\r\n      console.info('%cget-shader-graphs <signal>', LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"get-shader-graphs\"\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addGlb', (e) => {\r\n      console.log(\"%c[web.editor.addGlb]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"addGlb\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        options: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addObj', (e) => {\r\n      console.log(\"%c[web.editor.addObj]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"addObj\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        options: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addMp3', (e) => {\r\n      // console.log(\"[web.editor.addMp3]: \", e.detail);\r\n      // console.info('addMp3 <signal>');\r\n      // let o = {\r\n      //   action: \"addMp3\",\r\n      //   projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n      //   options: e.detail\r\n      // };\r\n      // o = JSON.stringify(o);\r\n      // this.ws.send(o);\r\n    });\r\n\r\n    // delete obj\r\n    document.addEventListener('web.editor.delete', (e) => {\r\n      console.log(\"%c[web.editor.delete]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"delete-obj\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        name: e.detail.prefix\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.update.pos', (e) => {\r\n      console.log(\"%c[web.editor.update.pos]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"updatePos\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        data: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.update.rot', (e) => {\r\n      console.log(\"%c[web.editor.update.rot]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"updateRot\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        data: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.update.scale', (e) => {\r\n      console.log(\"%c[web.editor.update.scale]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"updateScale\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        data: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.update.useScale', (e) => {\r\n      console.log(\"%c[web.editor.update.useScale]: \" + e.detail, LOG_FUNNY_ARCADE);\r\n      let o = {\r\n        action: \"useScale\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0],\r\n        data: e.detail\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n  }\r\n}\r\n", "import {downloadMeshes} from \"../../engine/loader-obj\";\r\nimport {uploadGLBModel} from \"../../engine/loaders/webgpu-gltf\";\r\n\r\n/**\r\n * @description\r\n * For now it is posible for editor to work on fly\r\n * with no memory/saves.\r\n */\r\n\r\nexport default class EditorProvider {\r\n  constructor(core) {\r\n    this.core = core;\r\n    this.addEditorEvents();\r\n  }\r\n\r\n  getNameFromPath(p) {\r\n    return p.split(/[/\\\\]/).pop().replace(/\\.[^/.]+$/, \"\"); // + (this.core.mainRenderBundle.length);\r\n  }\r\n\r\n  addEditorEvents() {\r\n    document.addEventListener('web.editor.input', (e) => {\r\n      console.log(\"[EDITOR-input]: \", e.detail);\r\n      // Saves methods\r\n      switch(e.detail.propertyId) {\r\n        case 'position':\r\n          {\r\n            console.log('change signal for pos', e.detail);\r\n            if(e.detail.property == 'x' ||\r\n              e.detail.property == 'y' ||\r\n              e.detail.property == 'z'\r\n            ) document.dispatchEvent(new CustomEvent('web.editor.update.pos', {\r\n              detail: e.detail\r\n            }));\r\n            break;\r\n          }\r\n        case 'rotation':\r\n          {\r\n            console.log('[signal][rot]');\r\n            if(e.detail.property == 'x' ||\r\n              e.detail.property == 'y' ||\r\n              e.detail.property == 'z'\r\n            ) document.dispatchEvent(new CustomEvent('web.editor.update.rot', {\r\n              detail: e.detail\r\n            }));\r\n            break;\r\n          }\r\n        case 'scale':\r\n          {\r\n            console.log('[signal][scale]');\r\n            if(e.detail.property == '0' || e.detail.property == '1' || e.detail.property == '2') {\r\n              document.dispatchEvent(new CustomEvent('web.editor.update.scale', {\r\n                detail: e.detail\r\n              }));\r\n            }\r\n            break;\r\n          }\r\n        default:\r\n          console.log('changes not saved.')\r\n      }\r\n      // inputFor: \"Cube_0\" property: \"x\" propertyId: \"position\" value: \"1\"\r\n      // InFly Method\r\n      let sceneObj = this.core.getSceneObjectByName(e.detail.inputFor);\r\n\r\n      if(e.detail.property == \"no info\") {\r\n        // console.warn(\"What is useScale !!! \", e.detail.value);\r\n        sceneObj[e.detail.propertyId] = e.detail.value;\r\n\r\n        if(e.detail.propertyId === \"useScale\") document.dispatchEvent(new CustomEvent('web.editor.update.useScale', {detail: e.detail}));\r\n        return;\r\n      }\r\n\r\n      if(sceneObj) {\r\n        sceneObj[e.detail.propertyId][e.detail.property] = parseFloat(e.detail.value);\r\n      } else {\r\n        console.warn(\"EditorProvider input error\");\r\n        return;\r\n      }\r\n    });\r\n\r\n    document.addEventListener('web.editor.addCube', (e) => {\r\n      // console.log(\"[web.editor.addCube]: \", e.detail);\r\n      // THIS MUST BE SAME LIKE SERVER VERSION OF ADD CUBE\r\n      downloadMeshes({cube: \"./res/meshes/blender/cube.obj\"}, (m) => {\r\n        const texturesPaths = './res/meshes/blender/cube.png';\r\n        this.core.addMeshObj({\r\n          position: {x: 0, y: 0, z: -20},\r\n          rotation: {x: 0, y: 0, z: 0},\r\n          rotationSpeed: {x: 0, y: 0, z: 0},\r\n          texturesPaths: [texturesPaths],\r\n          // useUVShema4x2: true,\r\n          name: \"\" + e.detail.index,\r\n          mesh: m.cube,\r\n          raycast: {enabled: true, radius: 2},\r\n          physics: {\r\n            enabled: e.detail.physics,\r\n            geometry: \"Cube\"\r\n          }\r\n        })\r\n      }, {scale: [1, 1, 1]});\r\n    });\r\n\r\n    document.addEventListener('web.editor.addSphere', (e) => {\r\n      // console.log(\"[web.editor.addCube]: \", e.detail);\r\n      downloadMeshes({mesh: \"./res/meshes/shapes/sphere.obj\"}, (m) => {\r\n        const texturesPaths = './res/meshes/blender/cube.png';\r\n        this.core.addMeshObj({\r\n          position: {x: 0, y: 0, z: -20},\r\n          rotation: {x: 0, y: 0, z: 0},\r\n          rotationSpeed: {x: 0, y: 0, z: 0},\r\n          texturesPaths: [texturesPaths],\r\n          // useUVShema4x2: true,\r\n          name: e.detail.index,\r\n          mesh: m.mesh,\r\n          raycast: {enabled: true, radius: 2},\r\n          physics: {\r\n            enabled: e.detail.physics,\r\n            geometry: \"Sphere\"\r\n          }\r\n        })\r\n      }, {scale: [1, 1, 1]});\r\n    });\r\n\r\n    document.addEventListener('web.editor.addGlb', async (e) => {\r\n      console.log(\"[web.editor.addGlb]: \", e.detail.path);\r\n      e.detail.path = e.detail.path.replace('\\\\res', 'res');\r\n      // THIS MUST BE SAME LIKE SERVER VERSION OF ADD GLB\r\n      var glbFile01 = await fetch(e.detail.path).then(res => res.arrayBuffer().then(buf => uploadGLBModel(buf, this.core.device)));\r\n      this.core.addGlbObj({\r\n        material: {type: 'power', useTextureFromGlb: true},\r\n        scale: [2, 2, 2],\r\n        position: {x: 0, y: 0, z: -20},\r\n        name: this.getNameFromPath(e.detail.path),\r\n        texturesPaths: ['./res/meshes/glb/textures/mutant_origin.png'],\r\n      }, null, glbFile01);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addObj', (e) => {\r\n      console.log(\"[web.editor.addObj]: \", e.detail);\r\n      e.detail.path = e.detail.path.replace('\\\\res', 'res');\r\n      e.detail.path = e.detail.path.replace(/\\\\/g, '/');\r\n      // THIS MUST BE SAME LIKE SERVER VERSION OF ADD CUBE\r\n      downloadMeshes({objMesh: `${e.detail.path}`}, (m) => {\r\n        const texturesPaths = './res/meshes/blender/cube.png';\r\n        this.core.addMeshObj({\r\n          position: {x: 0, y: 0, z: -20},\r\n          rotation: {x: 0, y: 0, z: 0},\r\n          rotationSpeed: {x: 0, y: 0, z: 0},\r\n          texturesPaths: [texturesPaths],\r\n          // useUVShema4x2: true,\r\n          name: e.detail.index,\r\n          mesh: m.objMesh,\r\n          raycast: {enabled: true, radius: 2},\r\n          physics: {\r\n            enabled: e.detail.physics,\r\n            geometry: \"Cube\"\r\n          }\r\n        })\r\n      }, {scale: [1, 1, 1]});\r\n    });\r\n\r\n    // delete\r\n    document.addEventListener('web.editor.delete', (e) => {\r\n      console.log(\"[web.editor.delete]: \", e.detail.fullName);\r\n\r\n      this.core.removeSceneObjectByName(e.detail.fullName);\r\n    });\r\n\r\n    // update procedure\r\n\r\n  }\r\n}", "export function graphAdapter(compilerResult, nodes) {\r\n  const {structs, uniforms, functions, locals, outputs, mainLines} = compilerResult;\r\n\r\n  // console.log(\"what os node in adapter\", nodes);\r\n\r\n  const globals = new Set();\r\n  globals.add(\"const PI: f32 = 3.141592653589793;\");\r\n  globals.add(\"override shadowDepthTextureSize: f32 = 1024.0;\");\r\n\r\n  // 3\uFE0F\u20E3 Prepare final color outputs\r\n  const baseColor = outputs.baseColor || \"vec3f(1.0)\";\r\n  const alpha = outputs.alpha || \"1.0\";\r\n  const normal = outputs.normal || \"normalize(input.fragNorm)\";\r\n  const emissive = outputs.emissive || \"vec3f(0.0)\";\r\n\r\n  /////////////////////////\r\n  // --- Iterate nodes in topological order ---\r\n  for(const node of nodes) {\r\n    if(node.type === \"LightShadowNode\") {\r\n      functions.push(`\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    // coneAtten = 1.0;\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    // return (diffuse + specular) * radiance * NdotL * coneAtten;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n`);\r\n      // Inject compute function (inline or multi-line)\r\n      // mainLines.push(`finalColor *= vec4(scene.globalAmbient + lightContribution, 1);`);\r\n\r\n    }\r\n  }\r\n  return `\r\n/* === Engine uniforms === */\r\n\r\n// DINAMIC GLOBALS\r\n${[...globals].join(\"\\n\")}\r\n\r\n// DINAMIC STRUCTS\r\n${[...structs].join(\"\\n\")}\r\n\r\n// PREDEFINED\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n    time                 : f32,\r\n    deltaTime            : f32,\r\n    padding4             : vec2f,\r\n};\r\n\r\n// PREDEFINED\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\n// PREDEFINED\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\n// PREDEFINED\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n    alpha     : f32\r\n};\r\n\r\n// PREDEFINED\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n// PREDEFINED\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\n// \u2705 Graph custom uniforms\r\n${[...uniforms].join(\"\\n\")}\r\n\r\n// \u2705 Graph custom functions\r\n${functions.join(\"\\n\\n\")}\r\n\r\n// PREDEFINED Fragment input\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\n// PREDEFINED PBR helpers\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    \r\n    // \u2705 Get alpha from texture and material factor\r\n    // let alpha = texColor.a * material.baseColorFactor.a;\r\n    let alpha = material.baseColorFactor.a;\r\n    \r\n    return PBRMaterialData(baseColor, metallic, roughness, alpha);\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n  // Locals\r\n  ${locals.join(\"\\n  \")}\r\n  ${mainLines.join(\"\\n  \")}\r\n  return ${outputs.outColor};\r\n}\r\n`;\r\n}\r\n", "/**\r\n * @description\r\n * Flux Codex Vertex use visual scripting model.\r\n *\r\n * @filename\r\n * fluxCodexVertex.js\r\n *\r\n * @Licence\r\n * This Source Code Form is subject to the terms of the\r\n * Mozilla Public License, v. 2.0.\r\n * If a copy of the MPL was not distributed with this file,\r\n * You can obtain one at https://mozilla.org/MPL/2.0/.\r\n *\r\n * Copyright (c) 2025 Nikola Luki\u0107 zlatnaspirala@gmail.com\r\n *\r\n * @Note\r\n * License summary for fluxCodexVertex.js (MPL 2.0):\r\n *\r\n * \u2714 You MAY:\r\n * - Use this file in commercial and proprietary software\r\n * - Modify and redistribute this file\r\n * - Combine it with closed-source code\r\n * - Sell software that includes this file\r\n *\r\n * \u2718 You MUST:\r\n * - Publish the source code of this file if you modify it\r\n * - Keep this file under MPL 2.0\r\n * - Provide a link to the MPL 2.0 license\r\n * - Preserve copyright notices\r\n *\r\n * \u2714 You do NOT have to:\r\n * - Open-source your entire project\r\n * - Publish files that merely import or use this file\r\n * - Release unrelated source code\r\n *\r\n * - MPL applies ONLY to this file\r\n */\r\nimport {byId, LOG_FUNNY_ARCADE} from \"../../engine/utils.js\";\r\nimport {graphAdapter} from \"./flexCodexShaderAdapter.js\";\r\n\r\nexport const FragmentShaderRegistry = {};\r\n\r\nexport class FragmentShaderGraph {\r\n  constructor(id) {\r\n    this.id = id;\r\n    this.nodes = [];\r\n    this.connections = [];\r\n    this.spawnX = 80;\r\n    this.spawnY = 80;\r\n    this.spawnStepX = 220;\r\n    this.spawnStepY = 140;\r\n    this.spawnCol = 0;\r\n    this.runtimeList = [];\r\n    this.runtime_memory = {};\r\n    this.onGraphLoadAttached = false;\r\n  }\r\n\r\n  addNode(node) {\r\n    if(node.type === \"FragmentOutput\") {\r\n      const exists = this.nodes.some(n => n.type === \"FragmentOutput\");\r\n      if(exists) {\r\n        console.warn(\"FragmentOutput already exists\");\r\n        return null;\r\n      }\r\n    }\r\n    this.nodes.push(node); return node;\r\n  }\r\n\r\n  connect(fromNode, fromPin, toNode, toPin) {\r\n    this.connections = this.connections.filter(c => !(c.toNode === toNode && c.toPin === toPin));\r\n    this.connections.push({fromNode, fromPin, toNode, toPin});\r\n  }\r\n\r\n  getInput(node, pin) {\r\n    return this.connections.find(c => c.toNode === node && c.toPin === pin);\r\n  }\r\n\r\n  compile() {\r\n    const wgsl = FragmentCompiler.compile(this);\r\n    FragmentShaderRegistry[this.id] = wgsl;\r\n    return wgsl;\r\n  }\r\n\r\n  nextSpawn() {\r\n    const x = this.spawnX + this.spawnCol * this.spawnStepX;\r\n    const y = this.spawnY;\r\n    this.spawnCol++;\r\n    if(this.spawnCol >= 3) {\r\n      this.spawnCol = 0;\r\n      this.spawnY += this.spawnStepY;\r\n    }\r\n    return {x, y};\r\n  }\r\n\r\n  makeDraggable(el, node, connectionLayer) {\r\n    let ox = 0, oy = 0, drag = false;\r\n    el.addEventListener(\"pointerdown\", e => {\r\n      drag = true;\r\n      ox = e.clientX - el.offsetLeft;\r\n      oy = e.clientY - el.offsetTop;\r\n      el.setPointerCapture(e.pointerId);\r\n    });\r\n    el.addEventListener(\"pointermove\", e => {\r\n      if(!drag) return;\r\n      el.style.left = (e.clientX - ox) + \"px\";\r\n      el.style.top = (e.clientY - oy) + \"px\";\r\n      node.x = (e.clientX - ox);\r\n      node.y = (e.clientY - oy);\r\n      connectionLayer.redrawAll();\r\n    });\r\n    el.addEventListener(\"pointerup\", () => drag = false);\r\n  }\r\n\r\n  clear() {\r\n    this.nodes = [];\r\n    this.connections = [];\r\n    this.spawnX = 80;\r\n    this.spawnY = 80;\r\n    this.spawnCol = 0;\r\n    if(this.connectionLayer) {\r\n      this.connectionLayer.svg.innerHTML = '';\r\n    }\r\n    const container = document.getElementsByClassName(\"fancy-grid-bg dark\");\r\n    if(container) {\r\n      const nodeElements = container[0].querySelectorAll('.nodeShader');\r\n      nodeElements.forEach(el => el.remove());\r\n    }\r\n    this.connectionLayer.redrawAll();\r\n  }\r\n}\r\n\r\nclass CompileContext {\r\n  constructor(shaderGraph) {\r\n    this.shaderGraph = shaderGraph;\r\n    this.cache = new Map();\r\n\r\n    this.structs = [];\r\n    this.uniforms = [];\r\n    this.functions = new Map();\r\n    this.locals = [];\r\n    this.mainLines = [];\r\n\r\n    this.tmpIndex = 0;\r\n    this.outputs = {\r\n      outColor: null\r\n    };\r\n  }\r\n\r\n  temp(type, expr) {\r\n    const name = `t${this.tmpIndex++}`;\r\n    this.locals.push(`let ${name}: ${type} = ${expr};`);\r\n    return name;\r\n  }\r\n\r\n  registerFunction(name, code) {\r\n    if(!this.functions.has(name)) {\r\n      this.functions.set(name, code);\r\n    }\r\n  }\r\n\r\n  resolve(node, pin) {\r\n    const key = `${node.id}:${pin}`;\r\n    if(this.cache.has(key)) return this.cache.get(key);\r\n\r\n    if(!this.resolving) this.resolving = new Set();\r\n    if(this.resolving.has(key)) {\r\n      console.warn(\"Cyclic dependency detected:\", key);\r\n      return node.default?.(pin) ?? \"0.0\";\r\n    }\r\n    this.resolving.add(key);\r\n\r\n    const conn = this.shaderGraph.getInput(node, pin);\r\n\r\n    let value;\r\n\r\n    if(conn) {\r\n      value = this.resolve(conn.fromNode, conn.fromPin);\r\n      // console.log('value = this.resolve(conn.fromNode, conn.fromPin); ', value)\r\n    } else {\r\n      // \u2705 ONLY inputs have defaults\r\n      if(node.inputs && pin in node.inputs) {\r\n        value = node.inputs[pin].default;\r\n      } else {\r\n        // \uD83D\uDD25 OUTPUT PIN \u2192 no default\r\n        value = undefined;\r\n      }\r\n    }\r\n\r\n    const result = node.build(pin, value, this);\r\n\r\n    if(result?.out !== undefined) {\r\n      this.cache.set(key, result.out);\r\n    }\r\n\r\n    this.resolving.delete(key);\r\n    return result.out;\r\n  }\r\n}\r\n\r\nclass FragmentCompiler {\r\n  static compile(shaderGraph) {\r\n    const ctx = new CompileContext(shaderGraph);\r\n    shaderGraph.nodes.forEach(n => {\r\n      if(n.type.endsWith(\"Output\")) {\r\n        ctx.resolve(n, Object.keys(n.inputs)[0]);\r\n      }\r\n    });\r\n    if(!ctx.outputs.outColor) {\r\n      throw new Error(\"ShaderGraph: No visual output\");\r\n    }\r\n    return {\r\n      structs: ctx.structs,\r\n      uniforms: ctx.uniforms,\r\n      functions: [...ctx.functions.values()],\r\n      locals: ctx.locals,\r\n      outputs: ctx.outputs,\r\n      mainLines: ctx.mainLines\r\n    };\r\n  }\r\n}\r\n\r\nlet NODE_ID = 0;\r\nexport class ShaderNode {\r\n  constructor(type) {\r\n    this.id = \"N\" + NODE_ID++;\r\n    this.type = type;\r\n    this.inputs = {};\r\n  }\r\n  default(pin) {\r\n    return this.inputs[pin]?.default ?? \"0.0\";\r\n  }\r\n  build(_, value, ctx) {\r\n    return {\r\n      out: value,\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class FragmentOutputNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"FragmentOutput\");\r\n    this.inputs = {color: {default: \"vec4f(1.0)\"}};\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"color\");\r\n    let value;\r\n    if(conn) {\r\n      // Resolve the node connected to this input\r\n      value = ctx.resolve(conn.fromNode, conn.fromPin);\r\n    } else {\r\n      // No connection \u2192 use default\r\n      value = this.inputs.color.default;\r\n    }\r\n    ctx.outputs.outColor = value;\r\n    // console.log('From FragmentOutputNode ctx.outputs.outColor', ctx.outputs.outColor);\r\n    return {out: ctx.outputs.outColor, type: \"vec4f\"};\r\n  }\r\n}\r\n\r\nexport class AlphaOutput extends ShaderNode {\r\n  constructor() {\r\n    super(\"AlphaOutput\");\r\n    this.inputs = {alpha: {default: \"1.0\"}};\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    ctx.outputs.alpha = ctx.resolve(this, \"alpha\");\r\n    return {out: ctx.outputs.alpha};\r\n  }\r\n}\r\n\r\nexport class NormalOutput extends ShaderNode {\r\n  constructor() {\r\n    super(\"NormalOutput\");\r\n    this.inputs = {normal: {default: \"input.normal\"}};\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    ctx.outputs.normal = ctx.resolve(this, \"normal\");\r\n    return {out: ctx.outputs.normal};\r\n  }\r\n}\r\n\r\n// STANDARD SOME STUFF ARE PREDEFINED ALREADY IN ADAPTER\r\nexport class LightShadowNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"LightShadowNode\");\r\n    this.inputs = {intensity: {default: \"1\"}};\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    // Generate the light calculation code as a string\r\n    const lightCalcCode = `\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n    let materialData = getPBRMaterial(input.uv);\r\n    var lightContribution = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }`;\r\n\r\n    ctx.locals.push(lightCalcCode);\r\n\r\n    // Return the variable name that downstream nodes can use\r\n    return {\r\n      out: \"lightContribution\",\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class LightToColorNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"LightToColor\");\r\n    this.inputs = {\r\n      light: {default: \"vec3f(1.0)\"}\r\n    };\r\n  }\r\n\r\n  build(pin, value, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"light\");\r\n    let l;\r\n    if(conn) {\r\n      l = ctx.resolve(conn.fromNode, conn.fromPin);\r\n    } else {\r\n      l = this.inputs.light.default;\r\n    }\r\n    const result = ctx.temp(\"vec4f\", `vec4f(${l}, 1.0)`);\r\n    return {\r\n      out: result,\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class UVNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"UV\");\r\n  }\r\n\r\n  build() {\r\n    return {\r\n      out: \"input.uv\",\r\n      type: \"vec2f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class AddVec2Node extends ShaderNode {\r\n  constructor() {\r\n    super(\"AddVec2\");\r\n    this.inputs = {\r\n      a: {default: \"vec2f(0.0)\"},\r\n      b: {default: \"vec2f(0.0)\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec2f\", `${a} + ${b}`),\r\n      type: \"vec2f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class CameraPosNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"CameraPos\");\r\n  }\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: \"scene.cameraPos\",\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class MultiplyVec2Node extends ShaderNode {\r\n  constructor() {\r\n    super(\"MultiplyVec2\");\r\n    this.inputs = {\r\n      a: {default: \"vec2f(1.0)\"},\r\n      b: {default: \"1.0\"}  // Can be scalar or vec2\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec2f\", `${a} * ${b}`),\r\n      type: \"vec2f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class TimeNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Time\");\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: \"scene.time\",\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class InlineFunctionNode extends ShaderNode {\r\n  constructor(name = \"customFn\", code = \"\") {\r\n    super(\"InlineFunction\");\r\n    this.fnName = name;\r\n    this.code = code;\r\n    this.inputs = {\r\n      a: {default: \"input.uv\"},\r\n      b: {default: \"globals.time\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    ctx.registerFunction(this.fnName, this.code);\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n    return {\r\n      out: ctx.temp(\"vec4f\", `${this.fnName}(${a}, ${b})`),\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class TextureSamplerNode extends ShaderNode {\r\n  constructor(name = \"tex0\") {\r\n    super(\"TextureSampler\");\r\n    this.name = name;\r\n    this.inputs = {uv: {default: \"input.uv\"}};\r\n  }\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"uv\");\r\n    let uv;\r\n    if(conn) {\r\n      uv = ctx.resolve(conn.fromNode, conn.fromPin);\r\n    } else {\r\n      uv = this.inputs.uv.default;\r\n    }\r\n\r\n    return {\r\n      out: ctx.temp(\"vec4f\", `textureSample(meshTexture, meshSampler, ${uv})`),\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class MultiplyColorNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"MultiplyColor\");\r\n    this.inputs = {\r\n      a: {default: \"vec4(1.0)\"},\r\n      b: {default: \"vec4(1.0)\"}\r\n    };\r\n  }\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n    let a, b;\r\n    if(connA) {\r\n      a = ctx.resolve(connA.fromNode, connA.fromPin);\r\n    } else {\r\n      a = this.inputs.a.default;\r\n    }\r\n    if(connB) {\r\n      b = ctx.resolve(connB.fromNode, connB.fromPin);\r\n    } else {\r\n      b = this.inputs.b.default;\r\n    }\r\n    const t = ctx.temp(\"vec4f\", `${a} * ${b}`);\r\n    return {out: t, type: \"vec4f\"};\r\n  }\r\n}\r\n\r\nexport class ClampNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Clamp\");\r\n    this.inputs = {\r\n      x: {default: \"0.0\"},\r\n      min: {default: \"0.0\"},\r\n      max: {default: \"1.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connX = ctx.shaderGraph.getInput(this, \"x\");\r\n    const connMin = ctx.shaderGraph.getInput(this, \"min\");\r\n    const connMax = ctx.shaderGraph.getInput(this, \"max\");\r\n\r\n    const x = connX ? ctx.resolve(connX.fromNode, connX.fromPin) : this.inputs.x.default;\r\n    const min = connMin ? ctx.resolve(connMin.fromNode, connMin.fromPin) : this.inputs.min.default;\r\n    const max = connMax ? ctx.resolve(connMax.fromNode, connMax.fromPin) : this.inputs.max.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `clamp(${x}, ${min}, ${max})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class GrayscaleNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Grayscale\");\r\n    this.inputs = {color: {default: \"vec4(1.0)\"}};\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"color\");\r\n    const c = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.color.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec4f\", `vec4(vec3(dot(${c}.rgb,vec3(0.299,0.587,0.114))),${c}.a)`),\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class ContrastNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Contrast\");\r\n    this.inputs = {\r\n      color: {default: \"vec4(1.0)\"},\r\n      contrast: {default: \"1.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connColor = ctx.shaderGraph.getInput(this, \"color\");\r\n    const connContrast = ctx.shaderGraph.getInput(this, \"contrast\");\r\n\r\n    const c = connColor ? ctx.resolve(connColor.fromNode, connColor.fromPin) : this.inputs.color.default;\r\n    const k = connContrast ? ctx.resolve(connContrast.fromNode, connContrast.fromPin) : this.inputs.contrast.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec4f\", `vec4(((${c}.rgb-0.5)*${k}+0.5),${c}.a)`),\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\n// CONSTANT/LITERAL NODES\r\nexport class FloatNode extends ShaderNode {\r\n  constructor(value = 1.0) {\r\n    super(\"Float\");\r\n    this.value = value;\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: `${this.value}`,\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class Vec2Node extends ShaderNode {\r\n  constructor(vx = 0.0, vy = 0.0) {\r\n    super(\"Vec2\");\r\n    this.valueX = vx;  // \u2705 Store vector X value\r\n    this.valueY = vy;  // \u2705 Store vector Y value\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: `vec2f(${this.valueX}, ${this.valueY})`,  // \u2705 Use valueX, valueY\r\n      type: \"vec2f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class Vec3Node extends ShaderNode {\r\n  constructor(vx = 0.0, vy = 0.0, vz = 0.0) {\r\n    super(\"Vec3\");\r\n    this.valueX = vx;\r\n    this.valueY = vy;\r\n    this.valueZ = vz;\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: `vec3f(${this.valueX}, ${this.valueY}, ${this.valueZ})`,\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class Vec4Node extends ShaderNode {\r\n  constructor(vx = 0.0, vy = 0.0, vz = 0.0, vw = 1.0) {\r\n    super(\"Vec4\");\r\n    this.valueX = vx;\r\n    this.valueY = vy;\r\n    this.valueZ = vz;\r\n    this.valueW = vw;\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: `vec4f(${this.valueX}, ${this.valueY}, ${this.valueZ}, ${this.valueW})`,\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class ColorNode extends ShaderNode {\r\n  constructor(r = 1.0, g = 1.0, b = 1.0, a = 1.0) {\r\n    super(\"Color\");\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a;\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: `vec4f(${this.r}, ${this.g}, ${this.b}, ${this.a})`,\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\n// MATH NODES\r\nexport class AddNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Add\");\r\n    this.inputs = {\r\n      a: {default: \"0.0\"},\r\n      b: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `${a} + ${b}`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class SubtractNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Subtract\");\r\n    this.inputs = {\r\n      a: {default: \"0.0\"},\r\n      b: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `${a} - ${b}`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class MultiplyNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Multiply\");\r\n    this.inputs = {\r\n      a: {default: \"1.0\"},\r\n      b: {default: \"1.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `${a} * ${b}`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class DivideNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Divide\");\r\n    this.inputs = {\r\n      a: {default: \"1.0\"},\r\n      b: {default: \"1.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `${a} / ${b}`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class PowerNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Power\");\r\n    this.inputs = {\r\n      base: {default: \"1.0\"},\r\n      exponent: {default: \"2.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connBase = ctx.shaderGraph.getInput(this, \"base\");\r\n    const connExp = ctx.shaderGraph.getInput(this, \"exponent\");\r\n\r\n    const base = connBase ? ctx.resolve(connBase.fromNode, connBase.fromPin) : this.inputs.base.default;\r\n    const exp = connExp ? ctx.resolve(connExp.fromNode, connExp.fromPin) : this.inputs.exponent.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `pow(${base}, ${exp})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class SqrtNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Sqrt\");\r\n    this.inputs = {\r\n      value: {default: \"1.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `sqrt(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class AbsNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Abs\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `abs(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class MinNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Min\");\r\n    this.inputs = {\r\n      a: {default: \"0.0\"},\r\n      b: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `min(${a}, ${b})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class MaxNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Max\");\r\n    this.inputs = {\r\n      a: {default: \"0.0\"},\r\n      b: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `max(${a}, ${b})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class LerpNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Lerp\");\r\n    this.inputs = {\r\n      a: {default: \"0.0\"},\r\n      b: {default: \"1.0\"},\r\n      t: {default: \"0.5\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n    const connT = ctx.shaderGraph.getInput(this, \"t\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n    const t = connT ? ctx.resolve(connT.fromNode, connT.fromPin) : this.inputs.t.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `mix(${a}, ${b}, ${t})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class SinNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Sin\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `sin(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class CosNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Cos\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `cos(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class TanNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Tan\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `tan(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\n// VECTOR OPERATIONS\r\nexport class DotProductNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"DotProduct\");\r\n    this.inputs = {\r\n      a: {default: \"vec3f(0.0)\"},\r\n      b: {default: \"vec3f(0.0)\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `dot(${a}, ${b})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class CrossProductNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"CrossProduct\");\r\n    this.inputs = {\r\n      a: {default: \"vec3f(0.0)\"},\r\n      b: {default: \"vec3f(0.0)\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connA = ctx.shaderGraph.getInput(this, \"a\");\r\n    const connB = ctx.shaderGraph.getInput(this, \"b\");\r\n\r\n    const a = connA ? ctx.resolve(connA.fromNode, connA.fromPin) : this.inputs.a.default;\r\n    const b = connB ? ctx.resolve(connB.fromNode, connB.fromPin) : this.inputs.b.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec3f\", `cross(${a}, ${b})`),\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class NormalizeNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Normalize\");\r\n    this.inputs = {\r\n      vector: {default: \"vec3f(1.0)\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"vector\");\r\n    const vec = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.vector.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec3f\", `normalize(${vec})`),\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class LengthNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Length\");\r\n    this.inputs = {\r\n      vector: {default: \"vec3f(0.0)\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"vector\");\r\n    const vec = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.vector.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `length(${vec})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\n// CHANNEL/SWIZZLE NODES\r\nexport class SplitVec4Node extends ShaderNode {\r\n  constructor() {\r\n    super(\"SplitVec4\");\r\n    this.inputs = {\r\n      vector: {default: \"vec4f(0.0)\"}\r\n    };\r\n    // This node has multiple outputs!\r\n  }\r\n\r\n  build(pin, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"vector\");\r\n    const vec = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.vector.default;\r\n\r\n    // Store the temp once\r\n    if(!this._temp) {\r\n      this._temp = ctx.temp(\"vec4f\", vec);\r\n    }\r\n\r\n    // Return different components based on which output pin is being resolved\r\n    switch(pin) {\r\n      case \"x\": return {out: `${this._temp}.x`, type: \"f32\"};\r\n      case \"y\": return {out: `${this._temp}.y`, type: \"f32\"};\r\n      case \"z\": return {out: `${this._temp}.z`, type: \"f32\"};\r\n      case \"w\": return {out: `${this._temp}.w`, type: \"f32\"};\r\n      default: return {out: this._temp, type: \"vec4f\"};\r\n    }\r\n  }\r\n}\r\n\r\nexport class CombineVec4Node extends ShaderNode {\r\n  constructor() {\r\n    super(\"CombineVec4\");\r\n    this.inputs = {\r\n      x: {default: \"0.0\"},\r\n      y: {default: \"0.0\"},\r\n      z: {default: \"0.0\"},\r\n      w: {default: \"1.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connX = ctx.shaderGraph.getInput(this, \"x\");\r\n    const connY = ctx.shaderGraph.getInput(this, \"y\");\r\n    const connZ = ctx.shaderGraph.getInput(this, \"z\");\r\n    const connW = ctx.shaderGraph.getInput(this, \"w\");\r\n\r\n    const x = connX ? ctx.resolve(connX.fromNode, connX.fromPin) : this.inputs.x.default;\r\n    const y = connY ? ctx.resolve(connY.fromNode, connY.fromPin) : this.inputs.y.default;\r\n    const z = connZ ? ctx.resolve(connZ.fromNode, connZ.fromPin) : this.inputs.z.default;\r\n    const w = connW ? ctx.resolve(connW.fromNode, connW.fromPin) : this.inputs.w.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"vec4f\", `vec4f(${x}, ${y}, ${z}, ${w})`),\r\n      type: \"vec4f\"\r\n    };\r\n  }\r\n}\r\n\r\n// UTILITY NODES\r\nexport class FracNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Frac\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `fract(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class FloorNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Floor\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `floor(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class CeilNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Ceil\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `ceil(${val})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class SmoothstepNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"Smoothstep\");\r\n    this.inputs = {\r\n      edge0: {default: \"0.0\"},\r\n      edge1: {default: \"1.0\"},\r\n      x: {default: \"0.5\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const connEdge0 = ctx.shaderGraph.getInput(this, \"edge0\");\r\n    const connEdge1 = ctx.shaderGraph.getInput(this, \"edge1\");\r\n    const connX = ctx.shaderGraph.getInput(this, \"x\");\r\n\r\n    const edge0 = connEdge0 ? ctx.resolve(connEdge0.fromNode, connEdge0.fromPin) : this.inputs.edge0.default;\r\n    const edge1 = connEdge1 ? ctx.resolve(connEdge1.fromNode, connEdge1.fromPin) : this.inputs.edge1.default;\r\n    const x = connX ? ctx.resolve(connX.fromNode, connX.fromPin) : this.inputs.x.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `smoothstep(${edge0}, ${edge1}, ${x})`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class OneMinusNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"OneMinus\");\r\n    this.inputs = {\r\n      value: {default: \"0.0\"}\r\n    };\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    const conn = ctx.shaderGraph.getInput(this, \"value\");\r\n    const val = conn ? ctx.resolve(conn.fromNode, conn.fromPin) : this.inputs.value.default;\r\n\r\n    return {\r\n      out: ctx.temp(\"f32\", `1.0 - ${val}`),\r\n      type: \"f32\"\r\n    };\r\n  }\r\n}\r\n\r\n// INPUT NODES\r\nexport class FragmentPositionNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"FragmentPosition\");\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: \"input.fragPos\",\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class FragmentNormalNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"FragmentNormal\");\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: \"input.fragNorm\",\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class ViewDirectionNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"ViewDirection\");\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: ctx.temp(\"vec3f\", \"normalize(scene.cameraPos - input.fragPos)\"),\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\nexport class GlobalAmbientNode extends ShaderNode {\r\n  constructor() {\r\n    super(\"GlobalAmbient\");\r\n  }\r\n\r\n  build(_, __, ctx) {\r\n    return {\r\n      out: \"scene.globalAmbient\",\r\n      type: \"vec3f\"\r\n    };\r\n  }\r\n}\r\n\r\n// export class InlineWGSLNode {\r\n//   constructor(code = \"return vec4f(1.0, 0.0, 0.0, 1.0);\") {\r\n//     this.id = nodeId++;\r\n//     this.type = \"InlineWGSL\";\r\n//     this.code = code;\r\n//     this.label = \"Inline WGSL\";\r\n\r\n//     this.inputs = {};\r\n//     this.outputs = {\r\n//       result: {type: \"vec4f\"}\r\n//     };\r\n//   }\r\n\r\n//   build(pin, value, ctx) {\r\n//     if(pin === \"result\") {\r\n//       const fnName = `inlineWGSL_${this.id}`;\r\n\r\n//       const fnCode = `\r\n// fn ${fnName}() -> vec4f {\r\n//   ${this.code}\r\n// }`;\r\n\r\n//       ctx.registerFunction(fnName, fnCode);\r\n//       const out = ctx.temp(\"vec4f\", `${fnName}()`);\r\n\r\n//       return {out};\r\n//     }\r\n//   }\r\n// }\r\nclass ConnectionLayer {\r\n  constructor(svg, shaderGraph) {\r\n    this.svg = svg;\r\n    this.shaderGraph = shaderGraph;\r\n    this.temp = null;\r\n    this.from = null;\r\n    document.addEventListener(\"pointermove\", e => this.move(e));\r\n    document.addEventListener(\"pointerup\", e => this.up(e));\r\n  }\r\n  attach(pin) {\r\n    pin.onpointerdown = e => {\r\n      e.stopPropagation();\r\n      if(pin.dataset.type !== \"output\") return;\r\n      this.from = pin;\r\n      this.temp = this.path();\r\n      this.svg.appendChild(this.temp);\r\n    };\r\n  }\r\n\r\n  move(e) {\r\n    if(!this.temp || !this.from) return;\r\n    this.draw(this.temp, this.center(this.from), {x: e.clientX, y: e.clientY});\r\n  }\r\n\r\n  up(e) {\r\n    if(!this.temp || !this.from) return;\r\n    const t = document.elementFromPoint(e.clientX, e.clientY);\r\n    if(t?.classList.contains(\"pinShader\") && t.dataset.type === \"input\") {\r\n      this.finalize(this.from, t);\r\n    }\r\n    this.temp.remove();\r\n    this.temp = this.from = null;\r\n  }\r\n  finalize(outPin, inPin) {\r\n    const fromNode = this.shaderGraph.nodes.find(n => n.id === outPin.dataset.node);\r\n    const toNode = this.shaderGraph.nodes.find(n => n.id === inPin.dataset.node);\r\n    const fromPin = outPin.dataset.pin;\r\n    const toPin = inPin.dataset.pin;\r\n    this.shaderGraph.connect(fromNode, fromPin, toNode, toPin);\r\n    this.redrawAll();\r\n  }\r\n\r\n  redrawAll() {\r\n    [...this.svg.children].forEach(p => p.remove()); // remove old paths\r\n    this.shaderGraph.connections.forEach(c => this.redrawConnection(c));\r\n  }\r\n\r\n  redrawConnection(conn) {\r\n    const path = this.path();\r\n    path.dataset.from = `${conn.fromNode.id}:${conn.fromPin}`;\r\n    path.dataset.to = `${conn.toNode.id}:${conn.toPin}`;\r\n    this.svg.appendChild(path);\r\n\r\n    const a = document.querySelector(`.pinShader.output[data-node=\"${conn.fromNode.id}\"][data-pin=\"${conn.fromPin}\"]`);\r\n    const b = document.querySelector(`.pinShader.input[data-node=\"${conn.toNode.id}\"][data-pin=\"${conn.toPin}\"]`);\r\n    if(a && b) this.draw(path, this.center(a), this.center(b));\r\n  }\r\n\r\n  path() {\r\n    const p = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\r\n    p.setAttribute(\"stroke\", \"#6aa9ff\");\r\n    p.setAttribute(\"stroke-width\", \"2\");\r\n    p.setAttribute(\"fill\", \"none\");\r\n    return p;\r\n  }\r\n\r\n  draw(p, a, b) {\r\n    const dx = Math.abs(b.x - a.x) * 0.5;\r\n    p.setAttribute(\"d\", `M${a.x},${a.y} C${a.x + dx},${a.y} ${b.x - dx},${b.y} ${b.x},${b.y}`);\r\n  }\r\n\r\n  center(el) {\r\n    const r = el.getBoundingClientRect();\r\n    const svgRect = this.svg.getBoundingClientRect();\r\n    return {\r\n      x: r.left + r.width / 2 - svgRect.left,\r\n      y: r.top + r.height / 2 - svgRect.top\r\n    };\r\n  }\r\n}\r\n\r\nexport async function openFragmentShaderEditor(id = \"fragShader\") {\r\n  return new Promise((resolve, reject) => {\r\n    const shaderGraph = new FragmentShaderGraph(id);\r\n    const root = document.createElement(\"div\");\r\n    root.id = \"shaderDOM\";\r\n    root.style.cssText = `\r\n    position:fixed; left: 17.5%; top:4%;\r\n    background:#0b0e14; color:#eee;\r\n    display:flex; font-family:system-ui;\r\n    width:300%;height:90%\r\n  `;\r\n    root.style.display = 'none';\r\n    /* LEFT MENU */\r\n    const menu = document.createElement(\"div\");\r\n    menu.style.cssText = `\r\n    width:200px; border-right:1px solid #222;\r\n    padding:8px; background:#0f1320; height: 77vh; overflow: scroll;\r\n  `;\r\n    const btn = (txt, fn) => {\r\n      const b = document.createElement(\"button\");\r\n      b.textContent = txt;\r\n      b.style.cssText = \"width:100%;margin:4px 0;\";\r\n      if(txt == \"Compile All\" || txt == \"Compile\" || txt == \"Save Graph\" || txt == \"Load Graph\") b.style.cssText += \"color: orange;\";\r\n      if(txt == \"Create New\") b.style.cssText += \"color: lime;\";\r\n      if(txt == \"Delete\") b.style.cssText += \"color: red;\";\r\n      b.classList.add(\"btn\");\r\n      b.classList.add(\"btnLeftBox\");\r\n      b.onclick = fn;\r\n      menu.appendChild(b);\r\n    };\r\n    /* GRAPH AREA */\r\n    const area = document.createElement(\"div\");\r\n    area.style.cssText = \"flex:1;position:relative\";\r\n    area.classList.add('fancy-grid-bg');\r\n    area.classList.add('dark');\r\n    let pan = {active: false, ox: 0, oy: 0};\r\n    area.addEventListener(\"pointerdown\", e => {\r\n      if(e.target !== area) return;\r\n      pan.active = true;\r\n      pan.ox = e.clientX;\r\n      pan.oy = e.clientY;\r\n      area.setPointerCapture(e.pointerId);\r\n    });\r\n    area.addEventListener(\"pointermove\", e => {\r\n      if(!pan.active) return;\r\n      const dx = e.clientX - pan.ox;\r\n      const dy = e.clientY - pan.oy;\r\n      pan.ox = e.clientX;\r\n      pan.oy = e.clientY;\r\n      shaderGraph.nodes.forEach(n => {\r\n        n.x += dx;\r\n        n.y += dy;\r\n        const el = document.querySelector(`.nodeShader[data-node-id=\"${n.id}\"]`);\r\n        if(el) {\r\n          el.style.left = n.x + \"px\";\r\n          el.style.top = n.y + \"px\";\r\n        }\r\n      });\r\n      connectionLayer.redrawAll();\r\n    });\r\n    area.addEventListener(\"pointerup\", e => {\r\n      pan.active = false;\r\n      area.releasePointerCapture(e.pointerId);\r\n    });\r\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    svg.style.position = \"absolute\";\r\n    svg.style.left = \"0\";\r\n    svg.style.top = \"0\";\r\n    svg.style.width = \"100%\";\r\n    svg.style.height = \"100%\";\r\n    svg.style.pointerEvents = \"none\";\r\n    area.appendChild(svg);\r\n    root.appendChild(menu);\r\n    root.appendChild(area);\r\n    document.body.appendChild(root);\r\n    const style = document.createElement(\"style\");\r\n    style.textContent = `\r\n#shaderDOM { z-index:2 }\r\n\r\n.nodeShader {\r\n  position:absolute;\r\n  min-width:140px;\r\n  background:#151a2a;\r\n  border:1px solid #222;\r\n  border-radius:6px;\r\n  padding:0;\r\n  color:#eee;\r\n  cursor:move;\r\n}\r\n\r\n.nodeShader.selected {\r\n  border-color: #ff8800;\r\n  box-shadow: 0 0 8px #ff8800;\r\n}\r\n\r\n.nodeShader .node-title {\r\n  -webkit-text-stroke-width: 0.2px;\r\n  display: block;\r\n  padding: 6px 8px;\r\n  font-size: 13px;\r\n  line-height: 1.2;\r\n  color: #ffffff;\r\n  background: #1f2937;\r\n  white-space: nowrap;\r\n  position: relative;\r\n  z-index: 10;\r\n  user-select: none;\r\n  border-radius: 6px 6px 0 0;\r\n  border-bottom: 1px solid #333;\r\n}\r\n\r\n.node-properties {\r\n  padding: 6px 8px;\r\n  background: #1a1f2e;\r\n  border-bottom: 1px solid #333;\r\n}\r\n\r\n.node-properties input,\r\n.node-properties textarea {\r\n  font-family: monospace;\r\n}\r\n\r\n.node-properties input:focus,\r\n.node-properties textarea:focus {\r\n  outline: none;\r\n  border-color: #6aa9ff;\r\n}\r\n\r\n.nodeShader-body {\r\n  display:flex;\r\n  gap:8px;\r\n  justify-content: space-between;\r\n  padding: 6px 8px;\r\n}\r\n\r\n.nodeShader-inputs {\r\n  display:flex;\r\n  flex-direction:column;\r\n}\r\n\r\n.pinShader-row {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 18px;\r\n  display: flex;\r\n  align-items: center;\r\n  font-family: monospace;\r\n  font-size: 12px;\r\n  color: #ddd;\r\n}\r\n\r\n.pinShader {\r\n  width: 12px;\r\n  height: 12px;\r\n  border-radius: 50%;\r\n  background: #0f0;\r\n  border: 2px solid #000;\r\n  z-index: 5;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.pinShader.input {  margin-left: -6px; background: #ff6a6a; }\r\n.pinShader.output { margin-right: -6px; background: #6aa9ff; }\r\n\r\n.pinShader-label {\r\n  margin-left: 6px;\r\n  white-space: nowrap;\r\n  pointer-events: none;\r\n  user-select: none;\r\n  z-index: 6;\r\n}\r\n\r\nsvg path {\r\n  pointer-events:none;\r\n}\r\n`;\r\n    document.head.appendChild(style);\r\n    const connectionLayer = new ConnectionLayer(svg, shaderGraph);\r\n\r\n    function addNode(node, x, y) {\r\n      const test = shaderGraph.addNode(node);\r\n      if(test == null) return;\r\n      if(x == null || y == null) {\r\n        const p = shaderGraph.nextSpawn();\r\n        x = p.x;\r\n        y = p.y;\r\n      }\r\n      node.x = x;\r\n      node.y = y;\r\n      const el = document.createElement(\"div\");\r\n      el.className = \"nodeShader\";\r\n      el.style.left = x + \"px\";\r\n      el.style.top = y + \"px\";\r\n      area.appendChild(el);\r\n      el.tabIndex = 0;\r\n      el.addEventListener(\"click\", e => {\r\n        e.stopPropagation();\r\n        document.querySelectorAll(\".nodeShader.selected\").forEach(n => n.classList.remove(\"selected\"));\r\n        el.classList.add(\"selected\");\r\n      });\r\n      el.dataset.nodeId = node.id;\r\n\r\n      const title = document.createElement(\"div\");\r\n      title.className = \"node-title\";\r\n      title.textContent = node.type;\r\n      el.appendChild(title);\r\n\r\n      // \u2705 ADD INPUT FIELDS FOR NODE PROPERTIES\r\n      const propsContainer = document.createElement(\"div\");\r\n      propsContainer.className = \"node-properties\";\r\n      propsContainer.style.cssText = \"padding: 4px 8px; background: #1a1f2e;\";\r\n\r\n      // Helper to create labeled input\r\n      function addPropertyInput(label, propName, value, type = \"number\", step = \"0.01\") {\r\n        const row = document.createElement(\"div\");\r\n        row.style.cssText = \"display: flex; align-items: center; gap: 6px; margin: 2px 0;\";\r\n\r\n        const labelEl = document.createElement(\"label\");\r\n        labelEl.textContent = label + \":\";\r\n        labelEl.style.cssText = \"font-size: 11px; color: #aaa; min-width: 30px;\";\r\n\r\n        const input = document.createElement(\"input\");\r\n        input.type = type;\r\n        input.value = value;\r\n        input.step = step;\r\n        input.style.cssText = \"flex: 1; background: #0a0d14; border: 1px solid #333; color: #fff; padding: 2px 4px; font-size: 11px; border-radius: 3px;\";\r\n\r\n        input.addEventListener(\"input\", () => {\r\n          const val = type === \"number\" ? parseFloat(input.value) : input.value;\r\n          node[propName] = val;\r\n        });\r\n\r\n        input.addEventListener(\"pointerdown\", e => e.stopPropagation());\r\n\r\n        row.appendChild(labelEl);\r\n        row.appendChild(input);\r\n        propsContainer.appendChild(row);\r\n      }\r\n\r\n      // \u2705 ADD PROPERTIES BASED ON NODE TYPE\r\n      if(node.type === \"Float\") {\r\n        addPropertyInput(\"Value\", \"value\", node.value);\r\n      }\r\n      else if(node.type === \"Vec2\") {\r\n        addPropertyInput(\"X\", \"valueX\", node.valueX || 0);\r\n        addPropertyInput(\"Y\", \"valueY\", node.valueY || 0);\r\n      }\r\n      else if(node.type === \"Vec3\") {\r\n        addPropertyInput(\"X\", \"valueX\", node.valueX || 0);\r\n        addPropertyInput(\"Y\", \"valueY\", node.valueY || 0);\r\n        addPropertyInput(\"Z\", \"valueZ\", node.valueZ || 0);\r\n      }\r\n      else if(node.type === \"Vec4\") {\r\n        addPropertyInput(\"X\", \"valueX\", node.valueX || 0);\r\n        addPropertyInput(\"Y\", \"valueY\", node.valueY || 0);\r\n        addPropertyInput(\"Z\", \"valueZ\", node.valueZ || 0);\r\n        addPropertyInput(\"W\", \"valueW\", node.valueW || 1);\r\n      }\r\n      else if(node.type === \"Color\") {\r\n        addPropertyInput(\"R\", \"r\", node.r);\r\n        addPropertyInput(\"G\", \"g\", node.g);\r\n        addPropertyInput(\"B\", \"b\", node.b);\r\n        addPropertyInput(\"A\", \"a\", node.a);\r\n      } else if(node.type === \"AddVec2\") {\r\n        // This node has vec2 inputs, but users typically connect nodes\r\n        // If you want to show defaults:\r\n        addPropertyInput(\"Default A\", \"defaultA\", node.inputs.a.default);\r\n        addPropertyInput(\"Default B\", \"defaultB\", node.inputs.b.default);\r\n      }\r\n\r\n      else if(node.type === \"InlineFunction\") {\r\n        addPropertyInput(\"Name\", \"fnName\", node.fnName, \"text\");\r\n\r\n        const ta = document.createElement(\"textarea\");\r\n        ta.value = node.code;\r\n        ta.style.cssText = \"width: 100%; height: 80px; background: #0a0d14; border: 1px solid #333; color: #fff; padding: 4px; font-family: monospace; font-size: 11px; resize: vertical;\";\r\n        ta.oninput = () => (node.code = ta.value);\r\n        ta.onpointerdown = e => e.stopPropagation();\r\n        propsContainer.appendChild(ta);\r\n      }\r\n\r\n      if(propsContainer.children.length > 0) {\r\n        el.appendChild(propsContainer);\r\n      }\r\n\r\n      const body = document.createElement(\"div\");\r\n      body.className = \"nodeShader-body\";\r\n      el.appendChild(body);\r\n\r\n      function createPinRow(pinName, type = \"input\") {\r\n        const row = document.createElement(\"div\");\r\n        row.className = \"pinShader-row\";\r\n\r\n        const pin = document.createElement(\"div\");\r\n        pin.className = \"pinShader \" + (type === \"input\" ? \"input\" : \"output\");\r\n        pin.dataset.node = node.id;\r\n        pin.dataset.pin = pinName;\r\n        pin.dataset.type = type;\r\n\r\n        const label = document.createElement(\"div\");\r\n        label.className = \"pinShader-label\";\r\n        label.textContent = pinName;\r\n\r\n        if(type === \"input\") row.append(pin, label);\r\n        else {\r\n          row.style.justifyContent = \"flex-end\";\r\n          row.append(label, pin);\r\n        }\r\n\r\n        return {row, pin};\r\n      }\r\n\r\n      const inputsContainer = document.createElement(\"div\");\r\n      inputsContainer.className = \"nodeShader-inputs\";\r\n      body.appendChild(inputsContainer);\r\n\r\n      Object.keys(node.inputs || {}).forEach(pinName => {\r\n        const {row, pin} = createPinRow(pinName, \"input\");\r\n        inputsContainer.appendChild(row);\r\n      });\r\n\r\n      const outputContainer = document.createElement(\"div\");\r\n      outputContainer.style.width = '100%';\r\n      body.appendChild(outputContainer);\r\n      const {row: outRow, pin: outPin} = createPinRow(\"out\", \"output\");\r\n      outputContainer.appendChild(outRow);\r\n      connectionLayer.attach(outPin);\r\n\r\n      shaderGraph.connectionLayer = connectionLayer;\r\n      shaderGraph.makeDraggable(el, node, connectionLayer);\r\n    }\r\n\r\n    document.addEventListener(\"keydown\", e => {\r\n      if(e.key === \"Delete\") {\r\n        const sel = document.querySelector(\".nodeShader.selected\");\r\n        if(!sel) return;\r\n        const nodeId = sel.dataset.nodeId;\r\n        const node = shaderGraph.nodes.find(n => n.id === nodeId);\r\n        if(!node) return;\r\n        // remove connections involving this node\r\n        shaderGraph.connections = shaderGraph.connections.filter(\r\n          c => c.fromNode !== node && c.toNode !== node\r\n        );\r\n        // remove SVG paths\r\n        [...svg.querySelectorAll(\"path\")].forEach(p => {\r\n          if(p.dataset.from?.startsWith(nodeId + \":\") || p.dataset.to?.startsWith(nodeId + \":\")) {\r\n            p.remove();\r\n          }\r\n        });\r\n        sel.remove();\r\n        shaderGraph.nodes = shaderGraph.nodes.filter(n => n !== node);\r\n        // ?\r\n        shaderGraph.connectionLayer.redrawConnection();\r\n      }\r\n    });\r\n\r\n    btn(\"outColor\", () => addNode(new FragmentOutputNode(), 500, 200));\r\n    btn(\"CameraPos\", () => addNode(new CameraPosNode()));\r\n    btn(\"MultiplyVec2\", () => addNode(new MultiplyVec2Node()));\r\n    btn(\"Time\", () => addNode(new TimeNode()));\r\n    btn(\"AddVec2\", () => addNode(new AddVec2Node()));\r\n    btn(\"GlobalAmbient\", () => addNode(new GlobalAmbientNode()));\r\n    btn(\"TextureSampler\", () => addNode(new TextureSamplerNode()));\r\n    btn(\"MultiplyColor\", () => addNode(new MultiplyColorNode()));\r\n    btn(\"Grayscale\", () => addNode(new GrayscaleNode()));\r\n    btn(\"Contrast\", () => addNode(new ContrastNode()));\r\n    // btn(\"Inline WGSL\", () => addNode(new InlineWGSLNode(prompt(\"WGSL code\"))));\r\n    btn(\"Inline Function\", () => addNode(new InlineFunctionNode(\"customFn\", \"\")));\r\n    // btn(\"BaseColorOutputNode\", () => addNode(new BaseColorOutputNode()));\r\n    // btn(\"EmissiveOutputNode\", () => addNode(new EmissiveOutputNode()));\r\n    btn(\"LightShadowNode\", () => addNode(new LightShadowNode()));\r\n    btn(\"LightToColorNode\", () => addNode(new LightToColorNode()));\r\n    btn(\"AlphaOutput\", () => addNode(new AlphaOutput()));\r\n    btn(\"NormalOutput\", () => addNode(new NormalOutput()));\r\n    // Constants\r\n    btn(\"Float\", () => {\r\n      const val = prompt(\"Enter float value:\", \"1.0\");\r\n      addNode(new FloatNode(parseFloat(val) || 1.0));\r\n    });\r\n    btn(\"UV\", () => addNode(new UVNode(1, 0)));\r\n    btn(\"Vec3\", () => addNode(new Vec3Node(1, 0, 0)));\r\n    btn(\"Vec2\", () => addNode(new Vec2Node(1, 0)));\r\n    btn(\"Color\", () => addNode(new ColorNode(1, 1, 1, 1)));\r\n    // Math\r\n    btn(\"Add\", () => addNode(new AddNode()));\r\n    btn(\"Multiply\", () => addNode(new MultiplyNode()));\r\n    btn(\"Power\", () => addNode(new PowerNode()));\r\n    btn(\"Lerp\", () => addNode(new LerpNode()));\r\n    // Trig\r\n    btn(\"Sin\", () => addNode(new SinNode()));\r\n    btn(\"Cos\", () => addNode(new CosNode()));\r\n    // Vector\r\n    btn(\"Normalize\", () => addNode(new NormalizeNode()));\r\n    btn(\"DotProduct\", () => addNode(new DotProductNode()));\r\n    btn(\"Length\", () => addNode(new LengthNode()));\r\n    // Utility\r\n    btn(\"Frac\", () => addNode(new FracNode()));\r\n    btn(\"OneMinus\", () => addNode(new OneMinusNode()));\r\n    btn(\"Smoothstep\", () => addNode(new SmoothstepNode()));\r\n    // Inputs\r\n    btn(\"FragPosition\", () => addNode(new FragmentPositionNode()));\r\n    btn(\"FragNormal\", () => addNode(new FragmentNormalNode()));\r\n    btn(\"ViewDirection\", () => addNode(new ViewDirectionNode()));\r\n    // Channel ops\r\n    btn(\"SplitVec4\", () => addNode(new SplitVec4Node()));\r\n    btn(\"CombineVec4\", () => addNode(new CombineVec4Node()));\r\n\r\n    btn(\"Create New\", async () => {\r\n      shaderGraph.clear();\r\n      let nameOfGraphMaterital = prompt(\"You must define a name for shader graph:\", \"MyShader1\");\r\n      if(nameOfGraphMaterital && nameOfGraphMaterital !== \"\") {\r\n        const exist = await loadGraph(nameOfGraphMaterital, shaderGraph, addNode);\r\n        if(exist === true) {\r\n          console.info(\"ALREADY EXIST SHADER, please use diff name\" + exist);\r\n        } else {\r\n          shaderGraph.id = nameOfGraphMaterital;\r\n          saveGraph(shaderGraph, nameOfGraphMaterital);\r\n        }\r\n      }\r\n    });\r\n\r\n    btn(\"Compile\", () => {\r\n      let r = shaderGraph.compile();\r\n      const graphGenShaderWGSL = graphAdapter(r, shaderGraph.nodes);\r\n      // console.log(\"test compile \", graphGenShaderWGSL);\r\n      shaderGraph.runtime_memory[shaderGraph.id] = graphGenShaderWGSL;\r\n    });\r\n\r\n    btn(\"Compile All\", () => {\r\n      for(let x = 0;x < shaderGraph.runtimeList.length;x++) {\r\n        setTimeout(() => {\r\n          byId('shader-graphs-list').selectedIndex = x + 1;\r\n          const event = new Event('change', {bubbles: true});\r\n          byId('shader-graphs-list').dispatchEvent(event);\r\n          if(shaderGraph.runtimeList.length == x) {\r\n            console.log('LAST');\r\n          }\r\n        }, 500 * x);\r\n      }\r\n    });\r\n\r\n    btn(\"Save Graph\", () => {\r\n      saveGraph(shaderGraph, shaderGraph.id);\r\n    });\r\n\r\n    btn(\"Load Graph\", async () => {\r\n      shaderGraph.clear();\r\n      let nameOfGraphMaterital = prompt(\"Choose Name:\", \"MyShader1\");\r\n      const exist = await loadGraph(nameOfGraphMaterital, shaderGraph, addNode);\r\n      if(exist === false) {\r\n        alert(\"\u26A0\uFE0FGraph no exist!\u26A0\uFE0F\");\r\n      }\r\n    });\r\n\r\n    btn(\"Delete\", () => {\r\n      console.log(\"[DELETE]\", shaderGraph.id);\r\n      document.dispatchEvent(new CustomEvent('delete-shader-graph', {detail: shaderGraph.id}));\r\n    });\r\n\r\n    btn(\"Import JSON\", async (e) => {\r\n      shaderGraph.clear();\r\n      let nameOfGraphMaterital = prompt(\"You must define a name for shader graph:\", \"MyShader1\");\r\n      if(nameOfGraphMaterital && nameOfGraphMaterital !== \"\") {\r\n        const exist = await loadGraph(nameOfGraphMaterital, shaderGraph, addNode);\r\n        if(exist === true) {\r\n          console.info(\"ALREADY EXIST SHADER, please use diff name\" + exist);\r\n        } else {\r\n          shaderGraph.id = nameOfGraphMaterital;\r\n          const input = document.createElement(\"input\");\r\n          input.type = \"file\";\r\n          input.accept = \".json\";\r\n          input.style.display = \"none\";\r\n          input.onchange = e => {\r\n            const file = e.target.files[0];\r\n            if(!file) return;\r\n            const reader = new FileReader();\r\n            reader.onload = () => {\r\n              try {\r\n                let data = JSON.parse(reader.result);\r\n                data.id = shaderGraph.id;\r\n                document.dispatchEvent(new CustomEvent('on-graph-load', {detail: {name: data.id, content: data}}));\r\n                // input.remove(); ?\r\n              } catch(err) {\r\n                console.error(\"Invalid JSON file\", err);\r\n              }\r\n            };\r\n            reader.readAsText(file);\r\n          };\r\n          document.body.appendChild(input);\r\n          input.click();\r\n        }\r\n      }\r\n    });\r\n\r\n    const titleb = document.createElement(\"p\");\r\n    titleb.style.cssText = \"width:100%;margin:4px 0;\";\r\n    titleb.classList.add(\"btn3\");\r\n    titleb.classList.add(\"btnLeftBox\");\r\n    titleb.innerHTML = `Current shader:`;\r\n    titleb.style.webkitTextStrokeWidth = 0;\r\n    menu.appendChild(titleb);\r\n\r\n    const b = document.createElement(\"select\");\r\n    b.id = \"shader-graphs-list\";\r\n    b.style.cssText = \"width:100%;margin:4px 0;\";\r\n    b.classList.add(\"btn\");\r\n    b.classList.add(\"btnLeftBox\");\r\n    b.style.webkitTextStrokeWidth = 0;\r\n    menu.appendChild(b);\r\n\r\n    document.addEventListener(\"on-shader-graphs-list\", (e) => {\r\n      // console.log(\"on-shader-graphs-list :\", e.detail);\r\n      const shaders = e.detail;\r\n      b.innerHTML = \"\";\r\n      var __ = 0;\r\n      if(!byId(\"shader-graphs-list-dom\")) {\r\n        __ = 1;\r\n        const placeholder = document.createElement(\"option\");\r\n        placeholder.id = \"shader-graphs-list-dom\";\r\n        placeholder.textContent = \"Select shader\";\r\n        placeholder.value = \"\";\r\n        placeholder.disabled = true;\r\n        placeholder.selected = true;\r\n        b.appendChild(placeholder);\r\n      }\r\n\r\n      shaderGraph.runtimeList = [];\r\n      shaders.forEach((shader, index) => {\r\n        const opt = document.createElement(\"option\");\r\n        opt.value = index;\r\n        opt.textContent = shader.name;\r\n        shaderGraph.runtimeList.push(shader.name);\r\n        let test = JSON.parse(shader.content);\r\n        // console.log(\"Graph content shader:\", test.final);\r\n        shaderGraph.runtime_memory[shader.name] = test.final;\r\n        b.appendChild(opt);\r\n      });\r\n\r\n      if(__ == 1) {\r\n        b.onchange = (event) => {\r\n          shaderGraph.clear();\r\n          const selectedIndex = event.target.value;\r\n          const selectedShader = shaders[selectedIndex];\r\n          console.log(\"Selected shader:\", selectedShader.name);\r\n          // console.log(\"Graph content:\", selectedShader.content);\r\n          // There is a other way - compile and assign - no cache policy\r\n          // const exist = loadGraph(selectedShader.name, shaderGraph, addNode);\r\n          document.dispatchEvent(new CustomEvent('load-shader-graph', {detail: selectedShader.name}));\r\n          console.log(\"Lets load selectedShader.name \", selectedShader.name);\r\n        };\r\n      }\r\n      document.dispatchEvent(new CustomEvent(\"sgraphs-ready\", {}));\r\n    });\r\n\r\n    document.dispatchEvent(new CustomEvent('get-shader-graphs', {}));\r\n    // Init\r\n    document.addEventListener(\"sgraphs-ready\", async () => {\r\n      if(shaderGraph.runtimeList.length > 0) {\r\n        // load first\r\n        shaderGraph.id = shaderGraph.runtimeList[0];\r\n        const exist = await loadGraph(shaderGraph.id, shaderGraph, addNode);\r\n        if(exist == false) {\r\n          saveGraph(shaderGraph, shaderGraph.id);\r\n          console.log(\"NEW SHADER:[SAVED]\" + exist);\r\n        }\r\n      } else {\r\n        console.log('no saved graphs');\r\n      }\r\n      resolve(shaderGraph);\r\n    });\r\n    // if(shaderGraph.nodes.length == 0) addNode(new FragmentOutputNode(), 500, 200);\r\n  })\r\n}\r\n\r\nfunction serializeGraph(shaderGraph) {\r\n  return JSON.stringify({\r\n    nodes: shaderGraph.nodes.map(n => ({\r\n      id: n.id,\r\n      type: n.type,\r\n      x: n.x ?? 100,\r\n      y: n.y ?? 100,\r\n      fnName: n.fnName,\r\n      code: n.code,\r\n      name: n.name,\r\n      value: n.value,\r\n      r: n.r, g: n.g, b: n.b, a: n.a,\r\n      inputs: Object.fromEntries(Object.entries(n.inputs || {}).map(([k, v]) => [k, {default: v.default}])),\r\n\r\n      valueX: n.valueX,\r\n      valueY: n.valueY,\r\n      valueZ: n.valueZ,\r\n      valueW: n.valueW,\r\n    })),\r\n    connections: shaderGraph.connections.map(c => ({\r\n      from: c.fromNode.id,\r\n      fromPin: c.fromPin,\r\n      to: c.toNode.id,\r\n      toPin: c.toPin\r\n    })),\r\n    final: shaderGraph.runtime_memory[shaderGraph.id] ? shaderGraph.runtime_memory[shaderGraph.id] : null\r\n  });\r\n}\r\n\r\nfunction saveGraph(shaderGraph, key = \"fragShaderGraph\") {\r\n  let content = serializeGraph(shaderGraph);\r\n  localStorage.setItem(key, content);\r\n  console.log('test compile content', shaderGraph.runtime_memory[key]);\r\n  console.log('test compile content', content);\r\n  if(shaderGraph.runtime_memory[key]) {\r\n    // content.runtime_memory = shaderGraph.runtime_memory[key];\r\n  } else {\r\n    console.warn(\"GraphShader is saved for src but with no compile final data for prod build.\");\r\n  }\r\n  document.dispatchEvent(new CustomEvent('save-shader-graph', {\r\n    detail: {\r\n      name: key,\r\n      content: content\r\n    }\r\n  }));\r\n  console.log(\"%cShader shaderGraph saved\", LOG_FUNNY_ARCADE);\r\n}\r\n\r\nasync function loadGraph(key, shaderGraph, addNodeUI) {\r\n  // shaderGraph.clear();\r\n  // Editor is not aware where is project file \r\n  // It is in generated file&folder event projectName is defined\r\n  // Its not good to write import for project file here in middle of engine core...\r\n  if(shaderGraph.onGraphLoadAttached === false) {\r\n    shaderGraph.onGraphLoadAttached = true;\r\n    document.addEventListener('on-graph-load', (e) => {\r\n      if(e.detail == null) {return;}\r\n      shaderGraph.nodes.length = 0;\r\n      shaderGraph.connections.length = 0;\r\n      shaderGraph.id = e.detail.name;\r\n      let data;\r\n      if(typeof e.detail.content === 'object') {\r\n        data = e.detail.content;\r\n      } else {\r\n        data = JSON.parse(e.detail.content);\r\n      }\r\n      if(!data) return false;\r\n      const map = {};\r\n      data.nodes.forEach(node => {\r\n        const saveId = node.id;\r\n        const saveX = node.x;\r\n        const saveY = node.y;\r\n        switch(node.type) {\r\n          case \"FragmentOutput\": node = new FragmentOutputNode(); break;\r\n          case \"CameraPos\": node = new CameraPosNode(); break;\r\n          case \"MultiplyVec2\": node = new MultiplyVec2Node(); break;\r\n          case \"AddVec2\": node = new AddVec2Node; break;\r\n          case \"Time\": node = new TimeNode(); break;\r\n          case \"InlineFunction\": node = new InlineFunctionNode(node.fnName, node.code); break;\r\n          case \"TextureSampler\": node = new TextureSamplerNode(node.name); break;\r\n          case \"MultiplyColor\": node = new MultiplyColorNode(); break;\r\n          case \"Grayscale\": node = new GrayscaleNode(); break;\r\n          case \"Contrast\": node = new ContrastNode(); break;\r\n          case \"AlphaOutput\": node = new AlphaOutput(); break;\r\n          case \"NormalOutput\": node = new NormalOutput(); break;\r\n          case \"LightShadowNode\": node = new LightShadowNode(); break;\r\n          case \"LightToColor\": node = new LightToColorNode(); break;\r\n          case \"UV\": node = new UVNode(); break;\r\n          case \"Float\": node = new FloatNode(node.value ?? 1.0); break;\r\n          case \"Vec2\": node = new Vec2Node(node.valueX ?? 0, node.valueY ?? 0); break;\r\n          case \"Vec3\": node = new Vec3Node(node.valueX ?? 0, node.valueY ?? 0, node.valueZ ?? 0); break;\r\n          case \"Vec4\": node = new Vec4Node(node.valueX ?? 0, node.valueY ?? 0, node.valueZ ?? 0, node.valueW ?? 1); break;\r\n          case \"Color\": node = new ColorNode(node.r ?? 1, node.g ?? 1, node.b ?? 1, node.a ?? 1); break;\r\n          case \"Add\": node = new AddNode(); break;\r\n          case \"Subtract\": node = new SubtractNode(); break;\r\n          case \"Multiply\": node = new MultiplyNode(); break;\r\n          case \"Divide\": node = new DivideNode(); break;\r\n          case \"Power\": node = new PowerNode(); break;\r\n          case \"Sin\": node = new SinNode(); break;\r\n          case \"Cos\": node = new CosNode(); break;\r\n          case \"Normalize\": node = new NormalizeNode(); break;\r\n          case \"DotProduct\": node = new DotProductNode(); break;\r\n          case \"Lerp\": node = new LerpNode(); break;\r\n          case \"Frac\": node = new FracNode(); break;\r\n          case \"OneMinus\": node = new OneMinusNode(); break;\r\n          case \"Smoothstep\": node = new SmoothstepNode(); break;\r\n          case \"FragmentPosition\": node = new FragmentPositionNode(); break;\r\n          case \"ViewDirection\": node = new ViewDirectionNode(); break;\r\n          case \"SplitVec4\": node = new SplitVec4Node(); break;\r\n          case \"CombineVec4\": node = new CombineVec4Node(); break;\r\n          case \"GlobalAmbient\": node = new GlobalAmbientNode(); break;\r\n        }\r\n        node.id = saveId;\r\n        node.x = saveX;\r\n        node.y = saveY;\r\n        // console.log(\"Loaded:\" + node)\r\n        map[node.id] = node;\r\n        addNodeUI(node, node.x, node.y);\r\n      });\r\n      setTimeout(() => data.connections.forEach(c => {\r\n        const fromNode = map[c.from];\r\n        const toNode = map[c.to];\r\n        const fromPin = c.fromPin;\r\n        const toPin = c.toPin;\r\n        if(!fromNode || !toNode) {\r\n          console.warn(\"Skipping connection due to missing node\", c);\r\n          return;\r\n        }\r\n        shaderGraph.connect(fromNode, fromPin, toNode, toPin);\r\n        const path = shaderGraph.connectionLayer.path();\r\n        path.dataset.from = `${fromNode.id}:${fromPin}`;\r\n        path.dataset.to = `${toNode.id}:${toPin}`;\r\n        shaderGraph.connectionLayer.svg.appendChild(path);\r\n        shaderGraph.connectionLayer.redrawAll(path);\r\n      }), 50);\r\n\r\n      // compile every loaded\r\n      // let r = shaderGraph.compile();\r\n      // const graphGenShaderWGSL = graphAdapter(r, shaderGraph.nodes);\r\n      // console.log(\"test compile shaderGraph.final \", shaderGraph.final);\r\n      // shaderGraph.runtime_memory[shaderGraph.id] = graphGenShaderWGSL;\r\n      return true;\r\n    });\r\n  }\r\n  document.dispatchEvent(new CustomEvent('load-shader-graph', {detail: key}));\r\n}", "/**\r\n * @description\r\n * Matrix-Engine-Wgpu Curve Editor\r\n */\r\n\r\nimport {byId, LOG_FUNNY_ARCADE} from \"../../engine/utils\";\r\n\r\nexport class CurveEditor {\r\n  constructor({width = 651, height = 300, samples = 128} = {}) {\r\n    this.curveStore = new CurveStore();\r\n    this.width = width;\r\n    this.height = height;\r\n    this.samples = samples;\r\n    this.keys = [\r\n      {time: 0, value: 0, inTangent: 0, outTangent: 0},\r\n      {time: 1, value: 0, inTangent: 0, outTangent: 0},\r\n    ];\r\n    this.valueMin = -1;\r\n    this.valueMax = 1;\r\n    this.padLeft = 32;\r\n    this.padBottom = 18;\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.ctx = this.canvas.getContext(\"2d\");\r\n\r\n    this.zeroY = Math.round(this.height * 0.5) + 0.5;\r\n    this.graphHeight = this.height - this.padBottom;\r\n\r\n    this.snapEnabled = true;\r\n    this.snapSteps = 20;\r\n    this.snapValueSteps = 20;\r\n\r\n    this.name = \"Curve\";\r\n    this.currentValue = 0;\r\n    // fix\r\n    this.value = 0;\r\n\r\n    this.activeKey = null;\r\n    this.dragMode = null;\r\n    this._grabDX = 0;\r\n    this._grabDY = 0;\r\n\r\n    this.time = 0;\r\n    this.loop = true;\r\n    this.speed = 1;\r\n    this.isGraphRunning = false;\r\n\r\n    this._editorOpen = false;\r\n    this._createPopup();\r\n    this._bindMouse();\r\n    this._buildToolbar();\r\n    this._enableDrag();\r\n\r\n    this.length = 1.0;\r\n    this._lastTime = performance.now();\r\n    this._runner = null;\r\n    this.baked = this.bake(samples);\r\n\r\n    setTimeout(() => this.draw(), 100);\r\n  }\r\n\r\n  _valueToY(v) {\r\n    const n = (v - this.valueMin) / (this.valueMax - this.valueMin);\r\n    return (1 - n) * this.graphHeight;\r\n  }\r\n\r\n  _yToValue(y) {\r\n    const n = 1 - (y / this.height);\r\n    return this.valueMin + n * (this.valueMax - this.valueMin);\r\n  }\r\n\r\n  _snap(value, steps) {\r\n    if(!this.snapEnabled) return value;\r\n    const range = this.valueMax - this.valueMin;\r\n    return Math.round((value - this.valueMin) / range * steps) / steps * range + this.valueMin;\r\n  }\r\n\r\n  // VALUE EVALUATION (HERMITE)\r\n  getValue(t) {\r\n    t = Math.max(0, Math.min(1, t));\r\n\r\n    for(let i = 0;i < this.keys.length - 1;i++) {\r\n      const k0 = this.keys[i];\r\n      const k1 = this.keys[i + 1];\r\n      if(t >= k0.time && t <= k1.time) {\r\n        const dt = k1.time - k0.time;\r\n        const u = (t - k0.time) / dt;\r\n        const u2 = u * u;\r\n        const u3 = u2 * u;\r\n        const m0 = k0.outTangent * dt;\r\n        const m1 = k1.inTangent * dt;\r\n        return (\r\n          (2 * u3 - 3 * u2 + 1) * k0.value +\r\n          (u3 - 2 * u2 + u) * m0 +\r\n          (-2 * u3 + 3 * u2) * k1.value +\r\n          (u3 - u2) * m1\r\n        );\r\n      }\r\n    }\r\n    return this.keys.at(-1).value;\r\n  }\r\n\r\n  // DRAW\r\n  draw() {\r\n\r\n    const padLeft = 32;\r\n    const padBottom = 18;\r\n\r\n    const ctx = this.ctx;\r\n    const w = this.width - padLeft;\r\n    const h = this.height - padBottom;\r\n\r\n    ctx.save();\r\n    ctx.translate(padLeft, 0);\r\n\r\n    ctx.clearRect(-50, -50, w + padLeft + 50, h + padBottom + 50);\r\n    ctx.fillStyle = \"#0b0f14\";\r\n    ctx.fillRect(0, 0, w, h);\r\n\r\n    // grid\r\n    ctx.strokeStyle = \"#1c2533\";\r\n    for(let i = 0;i <= 10;i++) {\r\n      const x = (i / 10) * w;\r\n      const y = (i / 10) * h;\r\n      ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke();\r\n      ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();\r\n    }\r\n\r\n    // ===== Y AXIS LABELS =====\r\n    ctx.fillStyle = \"#9aa7b2\";\r\n    ctx.font = \"11px monospace\";\r\n    ctx.textAlign = \"right\";\r\n    ctx.textBaseline = \"middle\";\r\n\r\n    ctx.fillText(\"+1\", -6, this._valueToY(0.9));\r\n    ctx.fillText(\"0\", -6, this._valueToY(0));\r\n    ctx.fillText(\"-1\", -6, this._valueToY(-0.9));\r\n\r\n    const zeroY = this._valueToY(0);\r\n    ctx.strokeStyle = \"#2e3b4e\";\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, zeroY);\r\n    ctx.lineTo(w, zeroY);\r\n    ctx.stroke();\r\n    ctx.lineWidth = 1;\r\n\r\n    // curve\r\n    ctx.strokeStyle = \"#4fc3f7\";\r\n    ctx.beginPath();\r\n    for(let i = 0;i <= 100;i++) {\r\n      const t = i / 100;\r\n      // const x = t * w;\r\n      const x = t * w;\r\n      const y = this._valueToY(this.getValue(t));\r\n      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);\r\n    }\r\n    ctx.stroke();\r\n\r\n    // keys + tangents\r\n    this.keys.forEach(k => {\r\n      const x = this._timeToX(k.time);\r\n      const y = this._valueToY(k.value);\r\n\r\n      // tangents\r\n      ctx.strokeStyle = \"#888\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, y);\r\n      ctx.lineTo(x + 30, y - k.outTangent * 30);\r\n      ctx.stroke();\r\n\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, y);\r\n      ctx.lineTo(x - 30, y + k.inTangent * 30);\r\n      ctx.stroke();\r\n\r\n      // key circle\r\n      ctx.fillStyle = \"#ffcc00\";\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, 4, 0, Math.PI * 2);\r\n      ctx.fill();\r\n    });\r\n    // PLAYHEAD\r\n    const playX = this._timeToX(this.time);\r\n    const playY = this._valueToY(this.getValueNow());\r\n    // vertical line\r\n    ctx.strokeStyle = \"#ff5555\";\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(playX, 0);\r\n    ctx.lineTo(playX, h);\r\n    ctx.stroke();\r\n\r\n    // dot\r\n    ctx.fillStyle = \"#ff5555\";\r\n    ctx.beginPath();\r\n    ctx.arc(playX, playY, 5, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.lineWidth = 1;\r\n\r\n    ctx.restore();\r\n\r\n    // ===== X AXIS LABELS =====\r\n    ctx.fillStyle = \"#ffffffff\";\r\n    ctx.font = \"13px monospace\";\r\n    ctx.textAlign = \"center\";\r\n    ctx.textBaseline = \"top\";\r\n\r\n    const y = this.height - padBottom + 2;\r\n\r\n    ctx.fillText(\"0s\", padLeft, y);\r\n    ctx.fillText(\r\n      (this.length * 0.5).toFixed(2) + \"s\",\r\n      padLeft + w * 0.5,\r\n      y\r\n    );\r\n    ctx.fillText(\r\n      this.length.toFixed(2) + \"s\",\r\n      padLeft + w,\r\n      y\r\n    );\r\n\r\n    this._updateToolbar();\r\n  }\r\n\r\n  _getMouse(e) {\r\n    const r = this.canvas.getBoundingClientRect();\r\n    return {\r\n      x: e.clientX - r.left - this.padLeft,\r\n      y: e.clientY - r.top\r\n    };\r\n  }\r\n\r\n  _bindMouse() {\r\n    const hitKey = (mx, my) => {\r\n      return this.keys.find(k => {\r\n        const x = this._timeToX(k.time);\r\n        const y = this._valueToY(k.value);\r\n        const HIT_RADIUS = 20;\r\n        return Math.hypot(mx - x, my - y) <= HIT_RADIUS;\r\n      });\r\n    };\r\n\r\n    const hitPlayhead = (mx, my) => {\r\n      if(this.isGraphRunning) return false;\r\n      const w = this.width - this.padLeft;\r\n      const playX = this._timeToX(this.time);\r\n      const playY = this._valueToY(this.getValueNow());\r\n      return Math.hypot(mx - playX, my - playY) < 8;\r\n    };\r\n\r\n    this.canvas.addEventListener(\"mousedown\", e => {\r\n      const {x: mx, y: my} = this._getMouse(e);\r\n      if(hitPlayhead(mx, my)) {\r\n        this.activeKey = 'playhead';\r\n        this.dragMode = 'playhead';\r\n        return;\r\n      }\r\n      const k = hitKey(mx, my);\r\n      if(k) {\r\n        const w = this.width - this.padLeft;\r\n        const kx = k.time * w;\r\n        const ky = this._valueToY(k.value);\r\n\r\n        this._grabDX = mx - kx;\r\n        this._grabDY = my - ky;\r\n\r\n        this.activeKey = k;\r\n        this.dragMode = e.shiftKey ? \"tangent\" : \"key\";\r\n      }\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", e => {\r\n      if(!this.activeKey) return;\r\n      const {x: mx, y: my} = this._getMouse(e);\r\n      if(this.dragMode === 'playhead' && this.activeKey === 'playhead') {\r\n        const w = this.width - this.padLeft;\r\n        let t = Math.max(0, Math.min(1, mx / w));\r\n        t = this._snap(t, this.snapSteps);\r\n        this.time = t;\r\n        this.draw();\r\n        return;\r\n      }\r\n      if(this.dragMode === \"key\") {\r\n        const w = this.width - this.padLeft;\r\n        // let t = (mx - this._grabDX) / w;\r\n        let t = (mx - this._grabDX) / w;\r\n        t = Math.max(0, Math.min(1 - 1e-6, t));\r\n        let v = this._yToValue(my - this._grabDY);\r\n        v = Math.max(this.valueMin, Math.min(this.valueMax, v));\r\n        v = this._snap(v, this.snapValueSteps);\r\n        t = this._snap(t, this.snapSteps);\r\n        v = this._snap(v, this.snapValueSteps);\r\n        this.activeKey.time = t;\r\n        this.activeKey.value = v;\r\n        this.keys.sort((a, b) => a.time - b.time);\r\n      }\r\n      if(this.dragMode === \"tangent\") {\r\n        const dx = (mx / r.width) - this.activeKey.time;\r\n        const dy = (1 - my / r.height) - this.activeKey.value;\r\n        this.activeKey.outTangent = dy / dx || 0;\r\n        this.activeKey.inTangent = this.activeKey.outTangent;\r\n      }\r\n\r\n      this.draw();\r\n      this._reBake();\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", () => {\r\n      this.activeKey = null;\r\n      this.dragMode = null;\r\n    });\r\n\r\n    this.canvas.addEventListener(\"dblclick\", e => {\r\n      const {x, y} = this._getMouse(e);\r\n      const w = this.width - this.padLeft;\r\n\r\n      const t = Math.max(0, Math.min(1, x / w));\r\n      const v = this._yToValue(y);\r\n\r\n      this.keys.push({\r\n        time: t,\r\n        value: v,\r\n        inTangent: 0,\r\n        outTangent: 0\r\n      });\r\n\r\n      this.keys.sort((a, b) => a.time - b.time);\r\n      this._reBake();\r\n      this.draw();\r\n    });\r\n\r\n    // delete key\r\n    this.canvas.addEventListener(\"contextmenu\", e => {\r\n      e.preventDefault();\r\n      const {x: mx, y: my} = this._getMouse(e);\r\n      const k = hitKey(mx, my);\r\n      if(k && this.keys.length > 2) {\r\n        this.keys = this.keys.filter(x => x !== k);\r\n        this.draw();\r\n        this._reBake();\r\n      }\r\n    });\r\n  }\r\n\r\n  _timeToX(t) {\r\n    const w = this.width - this.padLeft;\r\n    const R = 4;\r\n    let x = t * w;\r\n\r\n    // clamp so circle is fully inside canvas\r\n    return Math.min(Math.max(x, R), w - R);\r\n  }\r\n\r\n  // BAKING\r\n  bake(samples = this.samples) {\r\n    const data = new Float32Array(samples);\r\n    for(let i = 0;i < samples;i++) {\r\n      const t = i / (samples - 1);\r\n      data[i] = this.getValue(t);\r\n    }\r\n    return data;\r\n  }\r\n\r\n  _reBake() {this.baked = this.bake(this.samples);}\r\n\r\n  exec(delta) {\r\n    if(!this.isGraphRunning) return this.value;\r\n    this.time += (delta / this.length) * this.speed;\r\n    if(this.loop && this.time > 1) this.time = 0;\r\n    if(!this.loop && this.time > 1) {\r\n      this.time = 1;\r\n      this.stop();\r\n    }\r\n    const idx = Math.floor(this.time * (this.samples - 1));\r\n    this.value = this.baked[idx];\r\n    this.draw();\r\n    return this.value;\r\n  }\r\n\r\n  // SYNTETIC FOR NOW \r\n  play() {\r\n    if(this.isGraphRunning) return;\r\n    this.isGraphRunning = true;\r\n    this._lastTime = performance.now();\r\n    this._runner = setInterval(() => {\r\n      const now = performance.now();\r\n      const delta = (now - this._lastTime) / 1000;\r\n      this._lastTime = now;\r\n      this.exec(delta);\r\n    }, 16); // ~60fps\r\n  }\r\n\r\n  stop() {\r\n    this.isGraphRunning = false;\r\n    if(this._runner) {\r\n      clearInterval(this._runner);\r\n      this._runner = null;\r\n    }\r\n    this.draw();\r\n  }\r\n\r\n  getValueNow() {return this.value;}\r\n\r\n  _createPopup() {\r\n    this.popup = document.createElement(\"div\");\r\n    this.popup.id = \"curve-editor\";\r\n    Object.assign(this.popup.style, {\r\n      position: \"fixed\",\r\n      top: \"20%\",\r\n      left: \"20%\",\r\n      transform: \"translate(-50%,-50%)\",\r\n      background: \"#111\",\r\n      border: \"1px solid #333\",\r\n      padding: \"5px\",\r\n      display: \"none\",\r\n      zIndex: 999,\r\n      width: '650px',\r\n      height: '409px',\r\n      paddingLeft: '2px',\r\n      paddingRight: '2px'\r\n    });\r\n\r\n\r\n    this.toolbarTitle = document.createElement(\"div\");\r\n    this.toolbarTitle.style.cssText = `\r\n      display:flex;\r\n      align-items:center;\r\n      gap:10px;\r\n      padding:4px 6px;\r\n      background:#121822;\r\n      border-bottom:1px solid #1c2533;\r\n      font-size:12px;\r\n      margin-bottom: 5px;\r\n    `;\r\n\r\n    this.toolbarTitle.innerHTML = `<h3>Curve Editor</h3>`\r\n\r\n    this.popup.appendChild(this.toolbarTitle);\r\n    this.popup.appendChild(this.canvas);\r\n    document.body.appendChild(this.popup);\r\n  }\r\n\r\n  toggleEditor() {\r\n    // console.log('_editorOpen')\r\n    this._editorOpen = !this._editorOpen;\r\n    this.popup.style.display = this._editorOpen ? \"block\" : \"none\";\r\n    this.draw();\r\n  }\r\n\r\n  _buildToolbar() {\r\n    this.root = document.createElement(\"div\");\r\n    this.root.style.cssText = `\r\n    background:#0b0f14;\r\n    border:1px solid #1c2533;\r\n    font-family:monospace;\r\n    color:#cfd8dc;\r\n    width:${this.width}px;\r\n  `;\r\n\r\n    // Toolbar\r\n    this.toolbar = document.createElement(\"div\");\r\n    this.toolbar.style.cssText = `\r\n    display:flex;\r\n    align-items:center;\r\n    gap:10px;\r\n    padding:4px 6px;\r\n    background:#121822;\r\n    border-bottom:1px solid #1c2533;\r\n    font-size:12px;\r\n  `;\r\n\r\n    this.nameInput = document.createElement(\"input\");\r\n    // console.log(this.name)\r\n    this.nameInput.value = this.name;\r\n    this.nameInput.disabled = true;\r\n    this.nameInput.style.cssText = `\r\n    width:80px;\r\n    background:#0b0f14;\r\n    border:1px solid #1c2533;\r\n    color:#fff;\r\n    padding:2px 4px;\r\n  `;\r\n    this.nameInput.onchange = () => this.name = this.nameInput.value;\r\n\r\n    this.playBtn = document.createElement(\"button\");\r\n    this.playBtn.textContent = \"\u25B6\";\r\n    this.playBtn.style.cssText = `\r\n      background:#1c2533;\r\n      color:#fff;\r\n      border:none;\r\n      padding:2px 8px;\r\n      cursor:pointer;\r\n    `;\r\n    this.playBtn.onclick = () => {\r\n      this.isGraphRunning ? this.stop() : this.play();\r\n    };\r\n\r\n    this.lengthInput = document.createElement(\"input\");\r\n    this.lengthInput.type = \"number\";\r\n    this.lengthInput.value = this.length;\r\n    this.lengthInput.step = \"0.1\";\r\n    this.lengthInput.style.cssText = `\r\n      width:60px;\r\n      background:#0b0f14;\r\n      border:1px solid #1c2533;\r\n      color:#fff;\r\n      padding:2px 4px;\r\n    `;\r\n    this.lengthInput.onchange = () => {\r\n      this.length = Math.max(0.01, parseFloat(this.lengthInput.value));\r\n    };\r\n\r\n    // Time label\r\n    this.timeLabel = document.createElement(\"span\");\r\n\r\n    // Value label\r\n    this.valueLabel = document.createElement(\"span\");\r\n\r\n    // Running indicator\r\n    this.runLabel = document.createElement(\"span\");\r\n\r\n    // Snap toggle\r\n    this.snapBtn = document.createElement(\"button\");\r\n    this.snapBtn.textContent = \"Snap\";\r\n    this.snapBtn.style.cssText = `\r\n    background:#1c2533;\r\n    color:#fff;\r\n    border:none;\r\n    padding:2px 6px;\r\n    cursor:pointer;\r\n  `;\r\n    this.snapBtn.onclick = () => {\r\n      this.snapEnabled = !this.snapEnabled;\r\n      this.snapBtn.style.opacity = this.snapEnabled ? \"1\" : \"0.4\";\r\n    };\r\n\r\n    const lenLabel = document.createElement(\"span\");\r\n    lenLabel.textContent = \"Len\";\r\n\r\n    // Reset button\r\n    this.resetBtn = document.createElement(\"button\");\r\n    this.resetBtn.textContent = \"Reset\";\r\n    this.resetBtn.style.cssText = this.snapBtn.style.cssText;\r\n    this.resetBtn.onclick = () => {\r\n      this.time = 0;\r\n      this.draw();\r\n    };\r\n\r\n    this.saveBtn = document.createElement(\"button\");\r\n    this.saveBtn.textContent = \"\uD83D\uDCBE Save\";\r\n    this.saveBtn.style.cssText = `\r\n      background:#1c2533;\r\n      color:#fff;\r\n      border:none;\r\n      padding:2px 6px;\r\n      cursor:pointer;\r\n    `;\r\n    this.saveBtn.onclick = () => {\r\n      let curve = this.curveStore.getByName(this.name);\r\n      if(!curve) {\r\n        curve = new CurveData(this.name);\r\n        this.curveStore.curves.push(curve);\r\n      }\r\n      curve.keys = this.keys.map(k => ({...k}));\r\n      curve.length = this.length;\r\n      curve.loop = this.loop;\r\n      curve.bake(this.samples);\r\n      this.curveStore.save(curve);\r\n      byId('saveMainGraphDOM').click();\r\n      console.log(`%c Curve [${this.name}] saved`, \"color:#4caf50;font-weight:bold\");\r\n    };\r\n\r\n    this.hideBtn = document.createElement(\"button\");\r\n    this.hideBtn.textContent = \"Hide\";\r\n    this.hideBtn.style.cssText = `\r\n      background:#1c2533;\r\n      color:#fff;\r\n      border:none;\r\n      padding:2px 6px;\r\n      cursor:pointer;\r\n    `;\r\n    this.hideBtn.onclick = () => {\r\n      this.toggleEditor();\r\n      console.log(`%c Curve [${this.name}] saved!`, LOG_FUNNY_ARCADE);\r\n    };\r\n\r\n    this.toolbar.append(\r\n      this.nameInput,\r\n      this.playBtn,\r\n      lenLabel,\r\n      this.lengthInput,\r\n      this.timeLabel,\r\n      this.valueLabel,\r\n      this.runLabel,\r\n      this.snapBtn,\r\n      this.resetBtn,\r\n      this.saveBtn,\r\n      this.hideBtn\r\n    );\r\n\r\n    this.root.append(this.toolbar);\r\n    this.popup.appendChild(this.root);\r\n  }\r\n\r\n  _updateToolbar = () => {\r\n    this.currentValue = this.getValueNow();\r\n    const timeSec = this.time * this.length;\r\n\r\n    this.timeLabel.textContent =\r\n      `T: ${timeSec.toFixed(2)}s`;\r\n\r\n    this.valueLabel.textContent =\r\n      `V: ${this.currentValue.toFixed(3)}`;\r\n\r\n    this.runLabel.textContent =\r\n      this.isGraphRunning ? \"ACTIVE\" : \"STOPED\";\r\n\r\n    this.runLabel.style.color =\r\n      this.isGraphRunning ? \"#4caf50\" : \"#ff9800\";\r\n\r\n    this.playBtn.textContent =\r\n      this.isGraphRunning ? \"\u23F8\" : \"\u25B6\";\r\n  };\r\n\r\n  _enableDrag() {\r\n    const el = this.popup;\r\n    const handle = this.toolbar;\r\n    const handle2 = this.toolbarTitle;\r\n\r\n    let isDown = false;\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let startLeft = 0;\r\n    let startTop = 0;\r\n\r\n    handle.style.cursor = \"move\";\r\n    handle2.style.cursor = \"move\";\r\n\r\n    handle.addEventListener(\"mousedown\", (e) => {\r\n      isDown = true;\r\n      startX = e.clientX;\r\n      startY = e.clientY;\r\n\r\n      const rect = el.getBoundingClientRect();\r\n      startLeft = rect.left;\r\n      startTop = rect.top;\r\n\r\n      document.body.style.userSelect = \"none\";\r\n    });\r\n\r\n    handle2.addEventListener(\"mousedown\", (e) => {\r\n      isDown = true;\r\n      startX = e.clientX;\r\n      startY = e.clientY;\r\n\r\n      const rect = el.getBoundingClientRect();\r\n      startLeft = rect.left;\r\n      startTop = rect.top;\r\n\r\n      document.body.style.userSelect = \"none\";\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if(!isDown) return;\r\n\r\n      const dx = e.clientX - startX;\r\n      const dy = e.clientY - startY;\r\n\r\n      el.style.left = startLeft + dx + \"px\";\r\n      el.style.top = startTop + dy + \"px\";\r\n      el.style.transform = \"none\";\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", () => {\r\n      isDown = false;\r\n      document.body.style.userSelect = \"\";\r\n    });\r\n  }\r\n\r\n  bindCurve(curve, meta = {}) {\r\n    // console.log(\"BIND curve\", curve, meta);\r\n    this.curve = curve;\r\n    this.keys = curve.keys;\r\n    this.length = curve.length;\r\n    this.loop = curve.loop;\r\n    this.name = meta.idNode;\r\n    this.nameInput.value = this.name;\r\n    this.lengthInput.value = this.length;\r\n    this.idNode = meta.idNode ?? null;\r\n\r\n    this.time = 0;\r\n    this._reBake();\r\n    this.draw();\r\n  }\r\n}\r\n\r\n/**\r\n * @description\r\n * Data class\r\n **/\r\n\r\nexport class CurveData {\r\n  constructor(name) {\r\n    this.name = name;\r\n    this.keys = [\r\n      {time: 0, value: 0, inTangent: 0, outTangent: 0},\r\n      {time: 1, value: 1, inTangent: 0, outTangent: 0}\r\n    ];\r\n    this.length = 1;\r\n    this.loop = true;\r\n    this.samples = 128;\r\n    this.baked = null;\r\n  }\r\n\r\n  getValue(t) {\r\n    t = Math.max(0, Math.min(1, t));\r\n\r\n    for(let i = 0;i < this.keys.length - 1;i++) {\r\n      const k0 = this.keys[i];\r\n      const k1 = this.keys[i + 1];\r\n      if(t >= k0.time && t <= k1.time) {\r\n        const dt = k1.time - k0.time;\r\n        const u = (t - k0.time) / dt;\r\n        const u2 = u * u;\r\n        const u3 = u2 * u;\r\n        const m0 = k0.outTangent * dt;\r\n        const m1 = k1.inTangent * dt;\r\n        return (\r\n          (2 * u3 - 3 * u2 + 1) * k0.value +\r\n          (u3 - 2 * u2 + u) * m0 +\r\n          (-2 * u3 + 3 * u2) * k1.value +\r\n          (u3 - u2) * m1\r\n        );\r\n      }\r\n    }\r\n    return this.keys.at(-1).value;\r\n  }\r\n\r\n  // bake real values, not normalized 0-1\r\n  bake(samples = this.samples) {\r\n    this.baked = new Float32Array(samples);\r\n    for(let i = 0;i < samples;i++) {\r\n      const t = i / (samples - 1);\r\n      this.baked[i] = this.getValue(t);\r\n    }\r\n  }\r\n\r\n  evaluate(time01) {\r\n    if(!this.baked) {\r\n      console.warn(\"Curve not baked!\");\r\n      return 0;\r\n    }\r\n\r\n    let t = time01;\r\n    if(this.loop) t = t % 1;\r\n    else t = Math.min(1, Math.max(0, t));\r\n\r\n    const idx = Math.floor(t * (this.baked.length - 1));\r\n    return this.baked[idx];\r\n  }\r\n}\r\n\r\nclass CurveStore {\r\n  constructor() {\r\n    this.CURVE_STORAGE_KEY = \"PROJECT_NAME\";\r\n    this.curves = [];\r\n    this.load();\r\n  }\r\n\r\n  has(name) {\r\n    return this.curves.some(c => c.name === name);\r\n  }\r\n\r\n  getOrCreate(curveArg) {\r\n    let curve = this.curves.find(c => c.name === curveArg.name);\r\n    if(curve) return curve;\r\n    // console.log(\"PUSH in getOrCreate\")\r\n    curve = new CurveData(curveArg.name);\r\n    this.curves.push(curve);\r\n    return curve;\r\n  }\r\n\r\n  getByName(name) {\r\n    return this.curves.find(c => c.name === name) || null;\r\n  }\r\n\r\n  add(curve) {\r\n    this.curves.push(curve);\r\n    this.save();\r\n  }\r\n\r\n  removeByName(name) {\r\n    this.curves = this.curves.filter(c => c.name !== name);\r\n    this.save();\r\n  }\r\n\r\n  getAll() {\r\n    return this.curves;\r\n  }\r\n\r\n  // SAVE / LOAD\r\n  save() {\r\n    console.log('TEST SAVE', this.curves);\r\n    const data = {\r\n      version: 1,\r\n      curves: this.curves\r\n    };\r\n    localStorage.setItem(this.CURVE_STORAGE_KEY, JSON.stringify(data));\r\n  }\r\n\r\n  // saveCurve(curveData) {\r\n  //   const idx = this.curves.findIndex(c => c.name === curveData.name);\r\n  //   if(idx >= 0) {\r\n  //     this.curves[idx] = curveData;\r\n  //   } else {\r\n  //     this.curves.push(curveData);\r\n  //   }\r\n  //   this.save();\r\n  // }\r\n\r\n  load() {\r\n    const raw = localStorage.getItem(this.CURVE_STORAGE_KEY);\r\n    if(!raw) return;\r\n\r\n    try {\r\n      const data = JSON.parse(raw);\r\n      if(!data.curves) return;\r\n\r\n      this.curves = data.curves.map(c => this._fromJSON(c));\r\n    } catch(e) {\r\n      console.warn(\"CurveStore load failed\", e);\r\n      this.curves = [];\r\n    }\r\n  }\r\n\r\n  _fromJSON(obj) {\r\n    const c = new CurveData(obj.name);\r\n    c.keys = obj.keys || [];\r\n    c.length = obj.length ?? 1;\r\n    c.loop = !!obj.loop;\r\n    return c;\r\n  }\r\n}\r\n", "export function generateAISchema(nodeFactories) {\r\n  const schema = {nodes: {}, links: [], nodeCounter: 1, linkCounter: 1, pan: [0, 0], variables: {number: {}, boolean: {}, string: {}, object: {}}};\r\n\r\n  for(const type in nodeFactories) {\r\n    let spec = null;\r\n\r\n    // Simulate your post-factory options handling\r\n    if(type === 'dynamicFunction') {\r\n      spec = {...nodeFactories[type](\"node_\" + schema.nodeCounter, 0, 0, {accessObject: \"USER_INPUT\"})};\r\n      if(spec.fields) spec.fields.forEach(f => f.value = f.value ?? \"USER_INPUT\");\r\n    } else if(type === 'audioMP3') {\r\n      spec = nodeFactories[type](\"node_\" + schema.nodeCounter, 0, 0, {name: \"audioName\", path: \"audioPath.mp3\"});\r\n      if(spec.fields) spec.fields.forEach(f => {\r\n        if(f.key === 'key') f.value = \"audioName\";\r\n        if(f.key === 'src') f.value = \"audioPath.mp3\";\r\n      });\r\n    } else {\r\n      spec = nodeFactories[type](\"node_\" + schema.nodeCounter, 0, 0);\r\n      if(spec.fields) spec.fields.forEach(f => f.value = f.value ?? null);\r\n    }\r\n\r\n    // Save-ready format\r\n    schema.nodes[\"node_\" + schema.nodeCounter] = {\r\n      id: \"node_\" + schema.nodeCounter,\r\n      title: spec.title,\r\n      x: spec.x,\r\n      y: spec.y,\r\n      category: spec.category,\r\n      inputs: spec.inputs ?? [],\r\n      outputs: spec.outputs ?? [],\r\n      fields: spec.fields?.map(f => ({key: f.key, value: f.value})) ?? [],\r\n      builtIn: spec.builtIn ?? false,\r\n      noselfExec: spec.noselfExec ?? false,\r\n      displayEl: {}\r\n    };\r\n\r\n    schema.nodeCounter++;\r\n  }\r\n\r\n  return schema;\r\n}\r\n\r\nexport function generateAICatalog(factoryNodes) {\r\n  const catalog = {};\r\n\r\n  for(const [type, factory] of Object.entries(factoryNodes)) {\r\n    let spec;\r\n\r\n    try {\r\n      // Call factory in a SAFE dummy way\r\n      spec = factory(\"__ai__\", 0, 0, {});\r\n    } catch(e) {\r\n      console.warn(`Factory ${type} skipped (needs special args)`);\r\n      continue;\r\n    }\r\n\r\n    catalog[type] = {\r\n      title: spec.title,\r\n      category: spec.category,\r\n      inputs: (spec.inputs || []).map(i => ({\r\n        name: i.name,\r\n        type: i.type\r\n      })),\r\n      outputs: (spec.outputs || []).map(o => ({\r\n        name: o.name,\r\n        type: o.type\r\n      })),\r\n      fields: (spec.fields || []).map(f => ({\r\n        key: f.key,\r\n        type: typeof f.value\r\n      })),\r\n      noselfExec: !!spec.noselfExec,\r\n      builtIn: !!spec.builtIn\r\n    };\r\n  }\r\n\r\n  return catalog;\r\n}\r\n\r\nexport function catalogToText(catalog) {\r\n  let out = \"NODE CATALOG:\\n\\n\";\r\n\r\n  for(const [name, n] of Object.entries(catalog)) {\r\n    out += `Node: ${name}\\n`;\r\n    out += `Category: ${n.category}\\n`;\r\n\r\n    if(n.inputs.length) {\r\n      out += \"Inputs:\\n\";\r\n      for(const i of n.inputs) out += `- ${i.name} : ${i.type}\\n`;\r\n    }\r\n\r\n    if(n.outputs.length) {\r\n      out += \"Outputs:\\n\";\r\n      for(const o of n.outputs) out += `- ${o.name} : ${o.type}\\n`;\r\n    }\r\n\r\n    if(n.fields.length) {\r\n      out += \"Fields:\\n\";\r\n      for(const f of n.fields) out += `- ${f.key} : ${f.type}\\n`;\r\n    }\r\n\r\n    if(n.noselfExec) out += \"noselfExec: true\\n\";\r\n    out += \"\\n\";\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport let tasks = [\r\n  \"On load print hello world\",\r\n  \"On load create a cube named box1 at position 0 0 0\",\r\n  \"Create a the labyrinth using generatorWall\",\r\n  \"Set texture for floor object\",\r\n  \"Create a cube and enable raycast\",\r\n  \"Create 5 cubes in a row with spacing\",\r\n  \"Create a pyramid of cubes with 4 levels\",\r\n  \"Play mp3 audio on load\",\r\n  \"Create audio reactive node from music\",\r\n  \"Print beat value when detected\",\r\n  \"Rotate box1 slowly on Y axis every frame\",\r\n  \"Move box1 forward on Z axis over time\",\r\n  \"Oscillate box1 Y position between 0 and 2\",\r\n  \"Change box1 rotation using sine wave\",\r\n  \"On ray hit print hit object name\",\r\n  \"Apply force to hit object in ray direction\",\r\n  \"Change texture of object when clicked new texture rust metal\",\r\n  \"Generate random number and print it\",\r\n  \"Set variable score to 0\",\r\n  \"Increase score by 1 on object hit, Print score value\",\r\n  \"Dispatch custom event named GAME_START\",\r\n  \"After 2 seconds create a new cube\",\r\n  \"Animate cube position using curve timeline\",\r\n  \"Enable vertex wave animation on floor\"];\r\n\r\nexport let providers = [\r\n  \"ollama\",\r\n  \"groq\"\r\n];", "/**\r\n * @description\r\n * Flux Codex Vertex use visual scripting model.\r\n *\r\n * @filename\r\n * fluxCodexVertex.js\r\n *\r\n * @Licence\r\n * This Source Code Form is subject to the terms of the\r\n * Mozilla Public License, v. 2.0.\r\n * If a copy of the MPL was not distributed with this file,\r\n * You can obtain one at https://mozilla.org/MPL/2.0/.\r\n *\r\n * Copyright (c) 2025 Nikola Luki\u0107 zlatnaspirala@gmail.com\r\n *\r\n * @Note\r\n * License summary for fluxCodexVertex.js (MPL 2.0):\r\n *\r\n * \u2714 You MAY:\r\n * - Use this file in commercial and proprietary software\r\n * - Modify and redistribute this file\r\n * - Combine it with closed-source code\r\n * - Sell software that includes this file\r\n *\r\n * \u2718 You MUST:\r\n * - Publish the source code of this file if you modify it\r\n * - Keep this file under MPL 2.0\r\n * - Provide a link to the MPL 2.0 license\r\n * - Preserve copyright notices\r\n *\r\n * \u2714 You do NOT have to:\r\n * - Open-source your entire project\r\n * - Publish files that merely import or use this file\r\n * - Release unrelated source code\r\n *\r\n * - MPL applies ONLY to this file\r\n */\r\nimport {byId, LOG_FUNNY_ARCADE, mb, OSCILLATOR} from \"../../engine/utils\";\r\n// import {MatrixMusicAsset} from \"../../sounds/audioAsset\";\r\nimport {CurveData, CurveEditor} from \"./curve-editor\";\r\n// import {graphAdapter} from \"./flexCodexShaderAdapter\";\r\nimport {catalogToText, generateAICatalog, providers, tasks} from \"./generateAISchema.js\"\r\n// Engine agnostic\r\nexport let runtimeCacheObjs = [];\r\n\r\nexport default class FluxCodexVertex {\r\n  constructor(boardId, boardWrapId, logId, methodsManager, projName, toolTip) {\r\n    this.debugMode = true;\r\n    this.toolTip = toolTip;\r\n    this.curveEditor = new CurveEditor();\r\n    this.SAVE_KEY = \"fluxCodexVertex\" + projName;\r\n    this.methodsManager = methodsManager;\r\n    this.variables = {\r\n      number: {},\r\n      boolean: {},\r\n      string: {},\r\n      object: {},\r\n    };\r\n    // DOM Elements\r\n    this.board = document.getElementById(boardId);\r\n    this.boardWrap = document.getElementById(boardWrapId);\r\n    this.svg = this.board.querySelector(\"svg.connections\");\r\n    this.logEl = document.getElementById(logId);\r\n\r\n    // Data Model\r\n    this.nodes = {};\r\n    this.links = [];\r\n    this.nodeCounter = 1;\r\n    this.linkCounter = 1;\r\n\r\n    this._execContext = null;\r\n\r\n    // State Management\r\n    this.state = {\r\n      draggingNode: null,\r\n      dragOffset: [0, 0],\r\n      connecting: null,\r\n      selectedNode: null,\r\n      pan: [0, 0],\r\n      panning: false,\r\n      panStart: [0, 0],\r\n      zoom: 1\r\n    };\r\n\r\n    this.clearRuntime = () => {\r\n      app.graphUpdate = () => {};\r\n      // stop sepcial onDraw node\r\n      console.info(\"%cDestroy runtime objects.\" + Object.values(this.nodes).filter((n) => n.title == \"On Draw\"), LOG_FUNNY_ARCADE);\r\n      let allOnDraws = Object.values(this.nodes).filter((n) => n.title == \"On Draw\");\r\n      for(var x = 0;x < allOnDraws.length;x++) {\r\n        allOnDraws[x]._listenerAttached = false;\r\n      }\r\n      let getCurrentGIzmoObj = app.mainRenderBundle.filter((o) => o.effects.gizmoEffect && o.effects.gizmoEffect.enabled == false)\r\n      if (getCurrentGIzmoObj.length>0) getCurrentGIzmoObj[0].effects.gizmoEffect.enabled = true;\r\n      // stop vertext anims\r\n      // let allVertexAnims = Object.values(this.nodes).filter((n) =>\r\n      //   n.title == \"Set Vertex Wave\" || n.title == \"Set Vertex Wind\" || n.title == \"Set Vertex Pulse\" ||\r\n      //   n.title == \"Set Vertex Twist\" || n.title == \"Set Vertex Ocean\" || n.title == \"Set Vertex Noise\");\r\n      app.mainRenderBundle.forEach((o) => {o.vertexAnim.disableAll()});\r\n      for(let x = 0;x < runtimeCacheObjs.length;x++) {\r\n        // runtimeCacheObjs[x].destroy(); BUGGY - no sync with render loop logic!\r\n        app.removeSceneObjectByName(runtimeCacheObjs[x].name);\r\n      }\r\n      document.dispatchEvent(new CustomEvent('updateSceneContainer', {detail: {}}))\r\n      byId(\"graph-status\").innerHTML = '\u26AB';\r\n    };\r\n\r\n    this.setZoom = (z) => {\r\n      this.state.zoom = Math.max(0.2, Math.min(2.5, z));\r\n      this.board.style.transform = `scale(${this.state.zoom})`;\r\n    }\r\n\r\n    this.onWheel = (e) => {\r\n      e.preventDefault();\r\n      const delta = e.deltaY > 0 ? -0.1 : 0.1;\r\n      this.setZoom(this.state.zoom + delta);\r\n    }\r\n\r\n    this.boardWrap.addEventListener(\"wheel\", this.onWheel.bind(this), {\r\n      passive: false // IMPORTANT\r\n    });\r\n\r\n    // Bind event listeners\r\n    this.createVariablesPopup();\r\n    this.createAIToolPopup();\r\n    this._createImportInput();\r\n    this.bindGlobalListeners();\r\n    this._varInputs = {};\r\n    // global events\r\n    document.addEventListener(\"on-ai-graph-response\", e => {\r\n      console.info(\"%c<AI RESPONSE>\", LOG_FUNNY_ARCADE);\r\n      byId(\"graphGenJSON\").value = e.detail;\r\n      byId('ai-status').removeAttribute('data-ai-status')\r\n    });\r\n    document.addEventListener(\"keydown\", e => {\r\n      const target = (e.composedPath && e.composedPath()[0]) || e.target || document.activeElement;\r\n      function isEditableElement(el) {\r\n        if(!el) return false;\r\n        if(el instanceof HTMLInputElement ||\r\n          el instanceof HTMLTextAreaElement ||\r\n          el instanceof HTMLSelectElement) return true;\r\n        if(el.isContentEditable) return true;\r\n        if(el.getAttribute && el.getAttribute('role') === 'textbox') return true;\r\n        return false;\r\n      }\r\n      if(isEditableElement(target)) return;\r\n\r\n      if(e.key == \"F6\") {\r\n        e.preventDefault();\r\n        this.runGraph();\r\n      } else if(e.key === \"Delete\") {\r\n        if(this.state.selectedNode) {\r\n          this.deleteNode(this.state.selectedNode);\r\n          this.state.selectedNode = null;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.createContextMenu();\r\n    // not in use ? - alternative for refresh getters/ no exec nodes\r\n    document.addEventListener(\"fluxcodex.input.change\", e => {\r\n      console.log('fluxcodex.input.change')\r\n      const {nodeId, field, value} = e.detail;\r\n      const node = this.nodes.find(n => n.id === nodeId);\r\n      if(!node) return;\r\n      if(node.type !== \"getSubObject\") return;\r\n      this.handleGetSubObject(node, value);\r\n      if(field !== \"path\") return;\r\n    });\r\n\r\n    // only node no need to write intro files\r\n    document.addEventListener('web.editor.addMp3', (e) => {\r\n      console.log(\"[web.editor.addMp3]: \", e.detail);\r\n      e.detail.path = e.detail.path.replace('\\\\res', 'res');\r\n      e.detail.path = e.detail.path.replace(/\\\\/g, '/');\r\n      this.addNode('audioMP3', e.detail);\r\n    });\r\n\r\n    // curve editor stuff\r\n    document.addEventListener('show-curve-editor', (e) => {\r\n      // console.log('show-showCurveEditorBtn editor ', e);\r\n      this.curveEditor.toggleEditor();\r\n    });\r\n\r\n    // EXTRA TIME\r\n    setTimeout(() => this.init(), 3300);\r\n  }\r\n\r\n  createContextMenu() {\r\n    let CMenu = document.createElement(\"div\");\r\n    CMenu.id = \"fc-context-menu\";\r\n    CMenu.classList.add(\"fc-context-menu\");\r\n    CMenu.classList.add(\"hidden\");\r\n\r\n    const board = document.getElementById(\"board\");\r\n\r\n    board.addEventListener(\"contextmenu\", e => {\r\n      e.preventDefault();\r\n\r\n      CMenu.innerHTML = this.getFluxCodexMenuHTML();\r\n\r\n      const menuRect = CMenu.getBoundingClientRect();\r\n      const vw = window.innerWidth;\r\n      const vh = window.innerHeight;\r\n\r\n      let x = e.clientX;\r\n      let y = e.clientY;\r\n\r\n      if(x + menuRect.width > vw) {x = vw - menuRect.width - 5;}\r\n      if(y > vh * 0.5) {y = y - menuRect.height;}\r\n      if(y < 5) y = 5;\r\n\r\n      CMenu.style.left = x + \"px\";\r\n      CMenu.style.top = y + \"px\";\r\n      CMenu.classList.remove(\"hidden\");\r\n    });\r\n\r\n    document.addEventListener(\"click\", () => {\r\n      CMenu.classList.add(\"hidden\");\r\n    });\r\n\r\n    byId(\"app\").appendChild(CMenu);\r\n  }\r\n\r\n  getFluxCodexMenuHTML() {\r\n    return `\r\n    <h3>Events / Func</h3>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('event')\">Event: onLoad</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('function')\">Function</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('if')\">If Branch</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('genrand')\">GenRandInt</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('print')\">Print</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('timeout')\">SetTimeout</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('getArray')\">getArray</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('forEach')\">forEach</button>\r\n    <hr>\r\n    <span>Networking</span>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('fetch')\">Fetch</button>\r\n    <hr>\r\n    <span>Scene</span>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('getSceneObject')\">Get Scene Object</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('getSceneLight')\">Get Scene Light</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('getObjectAnimation')\">Get Object Animation</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setPosition')\">Set Position</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setMaterial')\">Set Material</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setWaterParams')\">Set Water Material Params</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('translateByX')\">Translate by X</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('translateByY')\">Translate by Y</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('translateByZ')\">Translate by Z</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setSpeed')\">Set Speed</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('getSpeed')\">Get Speed</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setRotation')\">Set Rotation</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setRotate')\">Set Rotate</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setRotateX')\">Set RotateX</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setRotateY')\">Set RotateY</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setRotateZ')\">Set RotateZ</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('setTexture')\">Set Texture</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('onTargetPositionReach')\">onTargetPositionReach</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('dynamicFunction')\">Function Dinamic</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('refFunction')\">Function by Ref</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('getSubObject')\">Get Sub Object</button>\r\n    <hr>\r\n    <span>Comment</span>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('comment')\">Comment</button>\r\n    <hr>\r\n    <span>Math</span>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('add')\">Add (+)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('sub')\">Sub (-)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('mul')\">Mul (*)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('div')\">Div (/)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('sin')\">Sin</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('cos')\">Cos</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('pi')\">Pi</button>\r\n    <hr>\r\n    <span>Comparison</span>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('equal')\">Equal (==)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('notequal')\">Not Equal (!=)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('greater')\">Greater (>)</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.addNode('less')\">Less (<)</button>\r\n    <hr>\r\n    <span>Compile</span>\r\n    <button onclick=\"app.editor.fluxCodexVertex.compileGraph()\">Save</button>\r\n    <button onclick=\"app.editor.fluxCodexVertex.runGraph()\">Run (F6)</button>\r\n  `;\r\n  }\r\n\r\n  log(...args) {this.logEl.textContent = args.join(\" \")}\r\n\r\n  createGetNumberNode(varName) {\r\n    return this.addNode(\"getNumber\", {var: varName});\r\n  }\r\n\r\n  createGetBooleanNode(varName) {\r\n    return this.addNode(\"getBoolean\", {var: varName});\r\n  }\r\n\r\n  createGetStringNode(varName) {\r\n    return this.addNode(\"getString\", {var: varName});\r\n  }\r\n\r\n  createGetObjectNode(varName) {\r\n    return this.addNode(\"getObject\", {var: varName});\r\n  }\r\n\r\n  createSetNumberNode(varName) {\r\n    return this.addNode(\"setNumber\", {var: varName});\r\n  }\r\n\r\n  createSetBooleanNode(varName) {\r\n    return this.addNode(\"setBoolean\", {var: varName});\r\n  }\r\n\r\n  createSetStringNode(varName) {\r\n    return this.addNode(\"setString\", {var: varName});\r\n  }\r\n\r\n  createSetObjectNode(varName) {\r\n    return this.addNode(\"setObject\", {var: varName});\r\n  }\r\n\r\n  evaluateGetterNode(n) {\r\n    const key = n.fields?.find(f => f.key === \"var\")?.value;\r\n    if(!key) return;\r\n    const type = n.title.replace(\"Get \", \"\").toLowerCase();\r\n    const entry = this.variables[type]?.[key];\r\n    n._returnCache = entry ? entry.value : type === \"number\" ? 0\r\n      : type === \"boolean\" ? false : type === \"string\" ? \"\" : type === \"object\"\r\n        ? {} : undefined;\r\n  }\r\n\r\n  notifyVariableChanged(type, key) {\r\n    for(const id in this.nodes) {\r\n      const n = this.nodes[id];\r\n      // Update getter nodes\r\n      if(n.isGetterNode) {\r\n        const varField = n.fields?.find(f => f.key === \"var\");\r\n        if(\r\n          varField?.value === key &&\r\n          n.title.replace(\"Get \", \"\").toLowerCase() === type\r\n        ) {\r\n          this.evaluateGetterNode(n);\r\n          if(n.displayEl) {\r\n            const val = n._returnCache;\r\n            if(type === \"object\")\r\n              n.displayEl.textContent = JSON.stringify(val, null, 2);\r\n            else if(type === \"number\")\r\n              n.displayEl.textContent = val.toFixed(3);\r\n            else n.displayEl.textContent = String(val);\r\n          }\r\n        }\r\n      }\r\n      // Update sub-object nodes connected to this getter\r\n      n.inputs?.forEach(pin => {\r\n        const link = this.getConnectedSource(n.id, pin.name);\r\n        if(link?.node?.isGetterNode) {\r\n          const srcNode = link.node;\r\n          const srcPin = link.pin;\r\n          if(srcNode.fields?.find(f => f.key === \"var\")?.value === key) {\r\n            this._adaptGetSubObjectOnConnect(n, srcNode, srcPin);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    // Update variable input UI if exists\r\n    const input = this._varInputs?.[`${type}.${key}`];\r\n    if(input) {\r\n      const storedValue = this.variables?.[type]?.[key];\r\n      if(type === \"object\")\r\n        input.value = JSON.stringify(storedValue ?? {}, null, 2);\r\n      else input.value = storedValue ?? \"\";\r\n    }\r\n  }\r\n\r\n  createVariablesPopup() {\r\n    if(this._varsPopup) return;\r\n    const popup = document.createElement(\"div\");\r\n    popup.id = \"varsPopup\";\r\n    this._varsPopup = popup;\r\n    Object.assign(popup.style, {\r\n      display: \"none\",\r\n      flexDirection: \"column\",\r\n      position: \"absolute\",\r\n      top: \"10%\",\r\n      left: \"0\",\r\n      width: \"60%\",\r\n      height: \"60%\",\r\n      overflow: \"scroll\",\r\n      background:\r\n        \"linear-gradient(135deg, #1a1a1a 0%, #2b2b2b 100%), /* subtle dark gradient */ repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 20px), repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 20px)\",\r\n      backgroundBlendMode: \"overlay\",\r\n      backgroundSize: \"auto, 20px 20px, 20px 20px\",\r\n      border: \"1px solid #444\",\r\n      borderRadius: \"8px\",\r\n      padding: \"10px\",\r\n      zIndex: 99,\r\n      color: \"#eee\",\r\n      overflowX: \"hidden\",\r\n    });\r\n    // HEADER\r\n    const title = document.createElement(\"div\");\r\n    title.innerHTML = `Variables`;\r\n    title.style.marginBottom = \"8px\";\r\n    title.style.fontWeight = \"bold\";\r\n    popup.appendChild(title);\r\n    const list = document.createElement(\"div\");\r\n    list.id = \"varslist\";\r\n    popup.appendChild(list);\r\n    // CREATE BUTTONS\r\n    const btns = document.createElement(\"div\");\r\n    btns.style.marginTop = \"10px\";\r\n    btns.style.display = \"flex\";\r\n    btns.style.gap = \"6px\";\r\n    btns.append(\r\n      this._createVarBtn(\"Number\", \"number\"),\r\n      this._createVarBtn(\"Boolean\", \"boolean\"),\r\n      this._createVarBtn(\"String\", \"string\"),\r\n      this._createVarBtn(\"Object\", \"object\")\r\n    );\r\n\r\n    popup.appendChild(btns);\r\n    const hideVPopup = document.createElement(\"button\");\r\n    hideVPopup.innerText = `Hide`;\r\n    hideVPopup.classList.add(\"btn4\");\r\n    hideVPopup.style.margin = \"8px 8px 8px 8px\";\r\n    hideVPopup.style.width = \"200px\";\r\n    hideVPopup.style.fontWeight = \"bold\";\r\n    hideVPopup.style.webkitTextStrokeWidth = \"0px\";\r\n    hideVPopup.addEventListener(\"click\", () => {byId(\"varsPopup\").style.display = \"none\";});\r\n    popup.appendChild(hideVPopup);\r\n\r\n    const saveVPopup = document.createElement(\"button\");\r\n    saveVPopup.innerText = `Save`;\r\n    saveVPopup.classList.add(\"btn4\");\r\n    saveVPopup.style.margin = \"8px 8px 8px 8px\";\r\n    saveVPopup.style.width = \"200px\";\r\n    saveVPopup.style.height = \"70px\";\r\n    saveVPopup.style.fontWeight = \"bold\";\r\n    saveVPopup.style.webkitTextStrokeWidth = \"0px\";\r\n    saveVPopup.addEventListener(\"click\", () => {this.compileGraph()});\r\n    popup.appendChild(saveVPopup);\r\n\r\n    document.body.appendChild(popup);\r\n    this.makePopupDraggable(popup);\r\n    this._refreshVarsList(list);\r\n  }\r\n\r\n  createAIToolPopup() {\r\n    if(this._aiPopup) return;\r\n    const popup = document.createElement(\"div\");\r\n    popup.id = \"aiPopup\";\r\n    this._aiPopup = popup;\r\n    Object.assign(popup.style, {\r\n      display: \"none\",\r\n      flexDirection: \"column\",\r\n      alignItems: \"flex-start\",\r\n      position: \"absolute\",\r\n      top: \"10%\",\r\n      left: \"5%\",\r\n      width: \"50%\",\r\n      height: \"70%\",\r\n      background: `\r\n    linear-gradient(145deg, #141414 0%, #1e1e1e 60%, #252525 100%),\r\n    repeating-linear-gradient(\r\n      0deg,\r\n      rgba(255,255,255,0.04),\r\n      rgba(255,255,255,0.04) 1px,\r\n      transparent 1px,\r\n      transparent 22px\r\n    ),\r\n    repeating-linear-gradient(\r\n      90deg,\r\n      rgba(255,255,255,0.04),\r\n      rgba(255,255,255,0.04) 1px,\r\n      transparent 1px,\r\n      transparent 22px\r\n    )\r\n  `,\r\n      backgroundBlendMode: \"overlay\",\r\n      backgroundSize: \"auto, 22px 22px, 22px 22px\",\r\n      border: \"1px solid rgba(255,255,255,0.15)\",\r\n      borderRadius: \"10px\",\r\n      boxShadow: `\r\n    0 20px 40px rgba(0,0,0,0.65),\r\n    inset 0 1px 0 rgba(255,255,255,0.05)\r\n  `,\r\n      padding: \"12px 14px\",\r\n      zIndex: 99,\r\n      color: \"#e6e6e6\",\r\n      overflowY: \"auto\",\r\n      overflowX: \"hidden\",\r\n      fontFamily: \"Orbitron, monospace\",\r\n      fontSize: \"13px\",\r\n    });\r\n    const title = document.createElement(\"div\");\r\n    title.innerHTML = `FluxCodexVertex AI generator [Experimental]`;\r\n    title.style.marginBottom = \"18px\";\r\n    title.style.fontWeight = \"bold\";\r\n    title.style.fontSize = \"20px\";\r\n    popup.appendChild(title);\r\n    const label1 = document.createElement(\"span\");\r\n    label1.innerText = `Select task for ai`;\r\n    popup.appendChild(label1);\r\n    const selectPrompt = document.createElement(\"select\");\r\n    selectPrompt.style.width = '400px';\r\n    const placeholder = document.createElement(\"option\");\r\n    placeholder.textContent = \"Select task\";\r\n    placeholder.value = \"\";\r\n    placeholder.disabled = true;\r\n    placeholder.selected = true;\r\n    selectPrompt.appendChild(placeholder);\r\n    tasks.forEach((t, i) => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = i;\r\n      opt.textContent = t;\r\n      selectPrompt.appendChild(opt);\r\n    });\r\n    popup.appendChild(selectPrompt)\r\n    const label2 = document.createElement(\"span\");\r\n    label2.innerText = `Select provider [Only OLLAMA for now]`;\r\n    popup.appendChild(label2);\r\n    const selectPromptProvider = document.createElement(\"select\");\r\n    selectPromptProvider.style.width = '400px';\r\n    providers.forEach((p, i) => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = i;\r\n      opt.textContent = p;\r\n      selectPromptProvider.appendChild(opt);\r\n    });\r\n    popup.appendChild(selectPromptProvider);\r\n\r\n    const call = document.createElement(\"button\");\r\n    call.id = \"ai-status\";\r\n    call.innerText = `Generate`;\r\n    call.classList.add(\"btnLeftBox\");\r\n    call.classList.add(\"btn4\");\r\n    call.style.margin = \"8px 8px 8px 8px\";\r\n    call.style.width = \"200px\";\r\n    call.style.fontWeight = \"bold\";\r\n    call.style.webkitTextStrokeWidth = \"0px\";\r\n    call.addEventListener(\"click\", (e) => {\r\n      if(selectPrompt.selectedIndex > 0) {\r\n        // use select task...\r\n      }\r\n      if(e.target.getAttribute(\"data-ai-status\") == null) {\r\n        e.target.setAttribute(\"data-ai-status\", \"wip\");\r\n      } else {\r\n        if(e.target.getAttribute(\"data-ai-status\") == \"wip\") {\r\n          console.info('gen ai tool call PREVENT ')\r\n          return;\r\n        } else {\r\n          console.info('gen ai tool call !!!!!!!!!!!!!!!! else ')\r\n        }\r\n      }\r\n      console.log(`%cAI TASK:${selectPrompt.selectedOptions[0].innerText}`, LOG_FUNNY_ARCADE);\r\n      document.dispatchEvent(new CustomEvent('aiGenGraphCall', {\r\n        detail: {\r\n          provider: providers[0], // hardcode\r\n          task: selectPrompt.selectedOptions[0].innerText\r\n        }\r\n      }));\r\n    });\r\n    popup.appendChild(call);\r\n    this.toolTip.attachTooltip(call, \"AI will try to generate graph. It is not guaranteed to work \u26A0\uFE0F\");\r\n    const list = document.createElement(\"textarea\");\r\n    list.style.height = '500px';\r\n    list.id = \"graphGenJSON\";\r\n    list.disabled = true;\r\n    Object.assign(list.style, {\r\n      height: \"100%\",\r\n      minHeight: \"420px\",\r\n      resize: \"none\",\r\n      background: \"#0f0f0f\",\r\n      color: \"#d0f0ff\",\r\n      border: \"1px solid #333\",\r\n      borderRadius: \"6px\",\r\n      padding: \"10px\",\r\n      marginBottom: \"10px\",\r\n      fontFamily: \"JetBrains Mono, monospace\",\r\n      fontSize: \"12px\",\r\n      lineHeight: \"1.4\",\r\n      width: \"98%\",\r\n      outline: \"none\",\r\n      boxShadow: \"inset 0 0 8px rgba(0,0,0,0.6)\"\r\n    });\r\n    popup.appendChild(list);\r\n    this.toolTip.attachTooltip(list, \"If the exported graph is not valid, in the last case you can manually try to fix it, but it is best to make a new query \u26A0\uFE0F\");\r\n    // popup.appendChild(btns);\r\n\r\n    const wrap1 = document.createElement(\"div\");\r\n    wrap1.style.display = 'flex';\r\n    wrap1.style.height = '50px';\r\n    popup.appendChild(wrap1);\r\n\r\n    const hideAIGen = document.createElement(\"button\");\r\n    hideAIGen.innerText = `Hide`;\r\n    hideAIGen.classList.add(\"btn4\");\r\n    hideAIGen.classList.add(\"btnLeftBox\");\r\n    hideAIGen.style.margin = \"8px 8px 8px 8px\";\r\n    hideAIGen.style.width = \"100px\";\r\n    hideAIGen.style.fontWeight = \"bold\";\r\n    hideAIGen.style.webkitTextStrokeWidth = \"0px\";\r\n    hideAIGen.addEventListener(\"click\", () => {byId(\"aiPopup\").style.display = \"none\";});\r\n    wrap1.appendChild(hideAIGen);\r\n\r\n    const copy = document.createElement(\"button\");\r\n    copy.innerText = `Copy`;\r\n    copy.classList.add(\"btnLeftBox\");\r\n    copy.classList.add(\"btn4\");\r\n    copy.style.margin = \"8px 8px 8px 8px\";\r\n    copy.style.width = \"100px\";\r\n    copy.style.fontWeight = \"bold\";\r\n    copy.style.color = \"lime\";\r\n    copy.style.webkitTextStrokeWidth = \"0px\";\r\n    copy.addEventListener(\"click\", async () => {\r\n      if(navigator.clipboard) {\r\n        await navigator.clipboard.writeText(list.value);\r\n      } else {\r\n        list.select();\r\n        document.execCommand(\"copy\");\r\n      }\r\n    });\r\n    wrap1.appendChild(copy);\r\n\r\n    const exportJSON = document.createElement(\"button\");\r\n    exportJSON.innerText = `Export JSON`;\r\n    exportJSON.classList.add(\"btnLeftBox\");\r\n    exportJSON.classList.add(\"btn4\");\r\n    exportJSON.style.margin = \"8px 8px 8px 8px\";\r\n    exportJSON.style.width = \"100px\";\r\n    exportJSON.style.fontWeight = \"bold\";\r\n    exportJSON.style.color = \"lime\";\r\n    exportJSON.style.webkitTextStrokeWidth = \"0px\";\r\n    exportJSON.addEventListener(\"click\", async () => {\r\n      this.exportAIGenJson(byId(\"graphGenJSON\").value);\r\n    });\r\n    wrap1.appendChild(exportJSON);\r\n\r\n    const insertGraph = document.createElement(\"button\");\r\n    insertGraph.innerText = `Insert graph`;\r\n    insertGraph.classList.add(\"btnLeftBox\");\r\n    insertGraph.classList.add(\"btn4\");\r\n    insertGraph.style.margin = \"8px 8px 8px 8px\";\r\n    insertGraph.style.width = \"100px\";\r\n    insertGraph.style.fontWeight = \"bold\";\r\n    insertGraph.style.color = \"lime\";\r\n    insertGraph.style.webkitTextStrokeWidth = \"0px\";\r\n    insertGraph.addEventListener(\"click\", async () => {\r\n      console.log(\"TEST OVERRIDE\", list.value);\r\n      let test = JSON.parse(list.value)\r\n      this.mergeGraphBundle(test)\r\n    });\r\n    wrap1.appendChild(insertGraph);\r\n\r\n    document.body.appendChild(popup);\r\n    this.makePopupDraggable(popup);\r\n  }\r\n\r\n  exportAIGenJson(graphData, fileName = 'ai-gen-fcv-graph.json') {\r\n    try {\r\n      // const jsonString = JSON.stringify(graphData, null, 2);\r\n      const blob = new Blob([graphData], {type: 'application/json'});\r\n      const url = URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = fileName;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n      console.log(\"Graph exported successfully.\");\r\n    } catch(error) {\r\n      console.error(\"Failed to export graph:\", error);\r\n    }\r\n  }\r\n\r\n  _refreshVarsList(container) {\r\n    container.innerHTML = \"\";\r\n\r\n    const colors = {\r\n      number: \"#4fc3f7\",\r\n      boolean: \"#aed581\",\r\n      string: \"#ffb74d\",\r\n      object: \"#ce93d8\",\r\n    };\r\n\r\n    for(const type in this.variables) {\r\n      for(const name in this.variables[type]) {\r\n        const row = document.createElement(\"div\");\r\n        Object.assign(row.style, {\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          gap: \"6px\",\r\n          padding: \"4px\",\r\n          cursor: \"pointer\",\r\n          borderBottom: \"1px solid #222\",\r\n          color: colors[type] || \"#fff\",\r\n          placeContent: \"space-around\"\r\n        });\r\n\r\n        const label = document.createElement(\"span\");\r\n        label.textContent = `${name} (${type})`;\r\n        label.style.width = \"20%\";\r\n\r\n        let input;\r\n        if(type === \"object\") {\r\n          input = document.createElement(\"textarea\");\r\n          input.value = JSON.stringify(this.variables[type][name] ?? {}, null, 2);\r\n          input.style.height = \"40px\";\r\n          input.style.webkitTextStrokeWidth = \"0px\";\r\n        } else {\r\n          input = document.createElement(\"input\");\r\n          input.value = this.variables[type][name] ?? \"\";\r\n        }\r\n        input.style.width = \"30%\";\r\n\r\n        this._varInputs[`${type}.${name}`] = input;\r\n        Object.assign(input.style, {\r\n          background: \"#000\",\r\n          color: \"#fff\",\r\n          border: \"1px solid #333\",\r\n        });\r\n\r\n        input.oninput = () => {\r\n          if(type === \"object\") {\r\n            try {\r\n              this.variables.object[name] = JSON.parse(input.value);\r\n            } catch {\r\n              return;\r\n            }\r\n          } else if(type === \"number\") {\r\n            this.variables.number[name] = parseFloat(input.value);\r\n          } else if(type === \"boolean\") {\r\n            this.variables.boolean[name] = input.value === \"true\";\r\n          } else {\r\n            this.variables.string[name] = input.value;\r\n          }\r\n        };\r\n\r\n        const btnGet = document.createElement(\"button\");\r\n        btnGet.innerText = \"Get\";\r\n        btnGet.classList.add(\"btnGetter\");\r\n        btnGet.onclick = () => {\r\n          if(type === \"number\") this.createGetNumberNode(name);\r\n          else if(type === \"boolean\") this.createGetBooleanNode(name);\r\n          else if(type === \"string\") this.createGetStringNode(name);\r\n          else if(type === \"object\") this.createGetObjectNode(name);\r\n        };\r\n\r\n        const btnSet = document.createElement(\"button\");\r\n        btnSet.innerText = \"Set\";\r\n        btnSet.classList.add(\"btnGetter\");\r\n        btnSet.onclick = () => {\r\n          if(type === \"number\") this.createSetNumberNode(name);\r\n          else if(type === \"boolean\") this.createSetBooleanNode(name);\r\n          else if(type === \"string\") this.createSetStringNode(name);\r\n          else if(type === \"object\") this.createSetObjectNode(name);\r\n        };\r\n\r\n        const btnDel = document.createElement(\"button\");\r\n        btnDel.innerText = \"Del\";\r\n        btnDel.classList.add(\"btnGetter\");\r\n        btnDel.style.color = \"#ff5252\";\r\n\r\n        btnDel.onclick = () => {\r\n          if(!confirm(`Delete variable \"${name}\" (${type}) ?`)) return;\r\n          delete this.variables[type][name];\r\n          delete this._varInputs[`${type}.${name}`];\r\n          this._refreshVarsList(container);\r\n        };\r\n\r\n        row.append(label, input, btnGet, btnSet, btnDel);\r\n        container.appendChild(row);\r\n      }\r\n    }\r\n  }\r\n\r\n  makePopupDraggable(popup, handle = popup) {\r\n    let isDragging = false;\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let startLeft = 0;\r\n    let startTop = 0;\r\n\r\n    handle.style.cursor = \"move\";\r\n\r\n    handle.addEventListener(\"mousedown\", e => {\r\n      isDragging = true;\r\n      startX = e.clientX;\r\n      startY = e.clientY;\r\n      const rect = popup.getBoundingClientRect();\r\n      startLeft = rect.left;\r\n      startTop = rect.top;\r\n      popup.style.left = startLeft + \"px\";\r\n      popup.style.top = startTop + \"px\";\r\n      popup.style.transform = \"none\";\r\n      document.addEventListener(\"mousemove\", onMove);\r\n      document.addEventListener(\"mouseup\", onUp);\r\n    });\r\n\r\n    const onMove = e => {\r\n      if(!isDragging) return;\r\n      popup.style.left = startLeft + (e.clientX - startX) + \"px\";\r\n      popup.style.top = startTop + (e.clientY - startY) + \"px\";\r\n    };\r\n\r\n    const onUp = () => {\r\n      isDragging = false;\r\n      document.removeEventListener(\"mousemove\", onMove);\r\n      document.removeEventListener(\"mouseup\", onUp);\r\n    };\r\n  }\r\n\r\n  _createVarBtn(label, type) {\r\n    const btn = document.createElement(\"button\");\r\n    btn.textContent = label;\r\n    btn.style.flex = \"1\";\r\n    btn.style.cursor = \"pointer\";\r\n    btn.classList.add(\"btn4\");\r\n\r\n    btn.onclick = () => {\r\n      const name = prompt(`New ${type} variable name`);\r\n      if(!name) return;\r\n      if(!this.variables[type]) this.variables[type] = {};\r\n      if(this.variables[type][name]) {\r\n        alert(\"Variable exists\");\r\n        return;\r\n      }\r\n      // Create variable\r\n      this.variables[type][name] =\r\n        type === \"object\" ? {} : type === \"number\" ? 0 : type === \"boolean\" ? false : type === \"string\" ? \"\" : null;\r\n      this._refreshVarsList(this._varsPopup.children[1]);\r\n      // console.log(\"[NEW VARIABLE]\", type, name, this.variables[type][name]);\r\n    };\r\n\r\n    return btn;\r\n  }\r\n\r\n  _getPinDot(nodeId, pinName, isOutput) {\r\n    const nodeEl = document.querySelector(`.node[data-id=\"${nodeId}\"]`);\r\n    if(!nodeEl) return null;\r\n    const io = isOutput ? \"out\" : \"in\";\r\n    return nodeEl.querySelector(`.pin[data-pin=\"${pinName}\"][data-io=\"${io}\"] .dot`);\r\n  }\r\n\r\n  populateVariableSelect(select, type) {\r\n    select.innerHTML = \"\";\r\n\r\n    const vars = this.variables[type];\r\n    if(!vars.length) {\r\n      const opt = document.createElement(\"option\");\r\n      opt.textContent = \"(no variables)\";\r\n      opt.disabled = true;\r\n      select.appendChild(opt);\r\n      return;\r\n    }\r\n\r\n    vars.forEach(v => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = v.name;\r\n      opt.textContent = v.name;\r\n      select.appendChild(opt);\r\n    });\r\n  }\r\n  // Dynamic Method Helpers\r\n  getArgNames(fn) {\r\n    const src = fn.toString().trim();\r\n    // Case 1: arrow function with no parentheses:  a => ...\r\n    const arrowNoParen = src.match(/^([a-zA-Z0-9_$]+)\\s*=>/);\r\n    if(arrowNoParen) {\r\n      return [arrowNoParen[1].trim()];\r\n    }\r\n    // Case 2: normal (a,b) => ...  OR function(a,b) { ... }\r\n    const argsMatch = src.match(/\\(([^)]*)\\)/);\r\n    if(argsMatch && argsMatch[1].trim().length > 0) {\r\n      return argsMatch[1]\r\n        .split(\",\")\r\n        .map(a => a.trim())\r\n        .filter(a => a.length > 0);\r\n    }\r\n    // Default: no args\r\n    return [];\r\n  }\r\n\r\n  hasReturn(fn) {\r\n    const src = fn.toString().trim();\r\n    // Case 1: implicit return in arrow: (a)=>a+2  OR  a=>a*2\r\n    // Detect arrow \"=>\" followed by an expression, not \"{\"\r\n    if(/=>\\s*[^({]/.test(src)) {\r\n      return true;\r\n    }\r\n    // Case 2: normal \"return\" inside function body\r\n    if(/return\\s+/.test(src)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  adaptNodeToMethod(node, methodItem) {\r\n    const fn = this.methodsManager.compileFunction(methodItem.code);\r\n    // Reset pins except execution pins\r\n    node.inputs = [{name: \"exec\", type: \"action\"}];\r\n    node.outputs = [{name: \"execOut\", type: \"action\"}];\r\n    // Dynamic input pins\r\n    const args = this.getArgNames(fn);\r\n    args.forEach(arg => node.inputs.push({name: arg, type: \"value\"}));\r\n    // Dynamic return pin\r\n    if(this.hasReturn(fn)) node.outputs.push({name: \"return\", type: \"value\"});\r\n\r\n    // test \r\n    node.outputs.push({name: \"reference\", type: \"function\"});\r\n\r\n    node.attachedMethod = methodItem.name;\r\n    node.fn = fn;\r\n    this.updateNodeDOM(node.id);\r\n  }\r\n\r\n  adaptNodeToMethod2(node, methodItem) {\r\n    const fn = this.methodsManager.compileFunction(methodItem.code);\r\n    const args = this.getArgNames(fn);\r\n\r\n    // Preserve action + reference pins\r\n    const preservedInputs = node.inputs.filter(\r\n      p => p.type === \"action\" || p.name === \"reference\"\r\n    );\r\n\r\n    const preservedOutputs = node.outputs.filter(\r\n      p => p.type === \"action\"\r\n    );\r\n\r\n    node.inputs = [...preservedInputs];\r\n    node.outputs = [...preservedOutputs];\r\n\r\n    // Add argument pins (reuse if exists)\r\n    args.forEach(arg => {\r\n      if(!node.inputs.some(p => p.name === arg)) {\r\n        node.inputs.push({name: arg, type: \"value\"});\r\n      }\r\n    });\r\n\r\n    // Return value\r\n    if(this.hasReturn(fn)) {\r\n      if(!node.outputs.some(p => p.name === \"return\")) {\r\n        node.outputs.push({name: \"return\", type: \"value\"});\r\n      }\r\n    }\r\n\r\n    node.attachedMethod = methodItem.name;\r\n    node.fn = fn;\r\n    this.updateNodeDOM(node.id);\r\n  }\r\n\r\n  adaptRefFunctionNode(node, fnRef) {\r\n    const args = this.getArgNames(fnRef);\r\n    const hasReturn = this.hasReturn(fnRef);\r\n    // Preserve exec + reference pins\r\n    const preservedInputs = node.inputs.filter(\r\n      p => p.type === \"action\" || p.name === \"reference\"\r\n    );\r\n\r\n    const preservedOutputs = node.outputs.filter(\r\n      p => p.type === \"action\"\r\n    );\r\n\r\n    node.inputs = [...preservedInputs];\r\n    node.outputs = [...preservedOutputs];\r\n    // \uD83D\uDD39 Real argument pins\r\n    args.forEach(arg => {\r\n      if(!node.inputs.some(p => p.name === arg)) {\r\n        node.inputs.push({\r\n          name: arg,\r\n          type: \"value\"\r\n        });\r\n      }\r\n    });\r\n    // \uD83D\uDD39 Real return\r\n    if(hasReturn) {\r\n      if(!node.outputs.some(p => p.name === \"return\")) {\r\n        node.outputs.push({\r\n          name: \"return\",\r\n          type: \"value\"\r\n        });\r\n      }\r\n    }\r\n    // Execution logic\r\n    node.fn = (...callArgs) => fnRef(...callArgs);\r\n    this.updateNodeDOM(node.id);\r\n  }\r\n\r\n  populateMethodsSelect(selectEl) {\r\n    selectEl.innerHTML = \"\";\r\n    const placeholder = document.createElement(\"option\");\r\n    placeholder.value = \"\";\r\n    placeholder.textContent = \"-- Select Method --\";\r\n    selectEl.appendChild(placeholder);\r\n    this.methodsManager.methodsContainer.forEach(method => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = method.name;\r\n      opt.textContent = method.name;\r\n      selectEl.appendChild(opt);\r\n    });\r\n  }\r\n\r\n  _getSceneSelectedName(node) {\r\n    return node.fields?.find(\r\n      f => f.key === \"selectedObject\" || f.key === \"object\"\r\n    )?.value;\r\n  }\r\n\r\n  updateNodeDOM(nodeId) {\r\n    const node = this.nodes[nodeId];\r\n    const el = document.querySelector(`.node[data-id=\"${nodeId}\"]`);\r\n    if(!el) return;\r\n\r\n    const left = el.querySelector(\".pins-left\");\r\n    const right = el.querySelector(\".pins-right\");\r\n    if(!left || !right) return;\r\n    // Clear only **non-exec pins**\r\n    left.innerHTML = \"\";\r\n    right.innerHTML = \"\";\r\n\r\n    const inputs = node.inputs || [];\r\n    const outputs = node.outputs || [];\r\n\r\n    inputs.forEach(pin => left.appendChild(this._pinElement(pin, false, nodeId)));\r\n    outputs.forEach(pin => right.appendChild(this._pinElement(pin, true, nodeId)));\r\n\r\n    if(node.title === \"Get Scene Object\" || node.title === \"Get Scene Light\" || node.title === \"Get Scene Animation\") {\r\n      const select = el.querySelector(\"select.scene-select\");\r\n      // console.log('!TEST! ??? BEFORE')\r\n      if(select) {\r\n        console.log('!TEST! ???')\r\n        // const objects = spec.accessObject || [];\r\n        // objects.forEach(obj => {\r\n        //   const opt = document.createElement(\"option\");\r\n        //   opt.value = obj.name;\r\n        //   opt.textContent = obj.name;\r\n        //   select.appendChild(opt);\r\n        // });\r\n        // const selected = this._getSceneSelectedName(node);\r\n        // if(selected) {\r\n        //   select.value = selected;\r\n        // }\r\n      }\r\n    } else if(node.category === \"action\" && node.title === \"Function\") {\r\n      let select = el.querySelector(\"select.method-select\");\r\n      if(!select) {\r\n        select = document.createElement(\"select\");\r\n        select.className = \"method-select\";\r\n        select.style.cssText = \"width:100%; margin-top:6px;\";\r\n        el.querySelector(\".body\").appendChild(select);\r\n      }\r\n      this.populateMethodsSelect(select);\r\n\r\n      if(node.attachedMethod) select.value = node.attachedMethod;\r\n\r\n      select.onchange = e => {\r\n        const selected = this.methodsManager.methodsContainer.find(m => m.name === e.target.value);\r\n        console.log('test reference::::', selected)\r\n        if(selected) this.adaptNodeToMethod(node, selected);\r\n      };\r\n    } else if(node.category === \"functions\") {\r\n      const dom = document.querySelector(`.node[data-id=\"${nodeId}\"]`);\r\n      this.restoreDynamicFunctionNode(node, dom);\r\n    } else if(node.category === \"reffunctions\") {\r\n      const dom = document.querySelector(`.node[data-id=\"${nodeId}\"]`);\r\n      this.restoreDynamicFunctionNode(node, dom);\r\n    }\r\n  }\r\n\r\n  restoreDynamicFunctionNode(node, dom) {\r\n    // Restore accessObject reference from literal\r\n    if(!node.accessObject && node.accessObjectLiteral) {\r\n      try {\r\n        node.accessObject = eval(node.accessObjectLiteral);\r\n      } catch(e) {\r\n        console.warn(\"Failed to eval accessObjectLiteral:\", node.accessObjectLiteral, e);\r\n        node.accessObject = [];\r\n      }\r\n    }\r\n\r\n    // Ensure fields exist\r\n    if(!node.fields) node.fields = [];\r\n    if(!node.fields.find(f => f.key === \"selectedObject\")) {\r\n      node.fields.push({key: \"selectedObject\", value: \"\"});\r\n    }\r\n\r\n    // Ensure pins exist\r\n    if(!node.inputs || node.inputs.length === 0) {\r\n      node.inputs = [{name: \"exec\", type: \"action\"}];\r\n    }\r\n    if(!node.outputs || node.outputs.length === 0) {\r\n      node.outputs = [{name: \"execOut\", type: \"action\"}];\r\n    }\r\n\r\n    // Rebuild DOM select for this node\r\n    let select = dom.querySelector(\"select\");\r\n\r\n    if(select == null) {\r\n      select = document.createElement(\"select\");\r\n      select.id = node.id;\r\n      select.className = \"method-select\";\r\n      select.style.cssText = \"width:100%; margin-top:6px;\";\r\n      dom.appendChild(select);\r\n    }\r\n\r\n    if(select && node.accessObject) {\r\n      const numOptions = select.options.length;\r\n      const newLength = Object.keys(node.accessObject)\r\n        .filter(key => typeof node.accessObject[key] === \"function\")\r\n\r\n      // Only repopulate if length differs // +1 for placeholder\r\n      if(numOptions !== newLength.length + 1) {\r\n        select.innerHTML = \"\";\r\n        const placeholder = document.createElement(\"option\");\r\n        placeholder.value = \"\";\r\n        placeholder.textContent = \"-- Select Function --\";\r\n        select.appendChild(placeholder);\r\n\r\n        Object.keys(node.accessObject)\r\n          .filter(key => typeof node.accessObject[key] === \"function\")\r\n          .forEach(fnName => {\r\n            const opt = document.createElement(\"option\");\r\n            opt.value = fnName;\r\n            opt.textContent = fnName;\r\n            select.appendChild(opt);\r\n          });\r\n\r\n\r\n        // restore previously selected\r\n        const selected = node.fields.find(f => f.key === \"selectedObject\")?.value;\r\n        if(selected) select.value = selected;\r\n      }\r\n\r\n      // Attach onchange\r\n      select.onchange = e => {\r\n        const val = e.target.value;\r\n        node.fields.find(f => f.key === \"selectedObject\").value = val;\r\n      };\r\n    }\r\n  }\r\n\r\n  // NODE/PIN\r\n  startConnect(nodeId, pinName, type, isOut) {\r\n    this.state.connecting = {\r\n      node: nodeId,\r\n      pin: pinName,\r\n      type: type,\r\n      out: isOut,\r\n    };\r\n  }\r\n\r\n  _applyConnectionRuntime(from, to, type) {\r\n    const toNode = this.nodes[to.node];\r\n    const fromNode = this.nodes[from.node];\r\n    if(!toNode || !fromNode) return;\r\n\r\n    // RefFunction special case\r\n    if(toNode.title === \"reffunctions\" && to.pin === \"reference\") {\r\n      const fnRef = this.getPinValue(fromNode, from.pin);\r\n      if(typeof fnRef === \"function\") {\r\n        toNode._fnRef = fnRef;\r\n        this.adaptRefFunctionNode(toNode, fnRef);\r\n      }\r\n    }\r\n    // generic hook\r\n    this.onPinsConnected(fromNode, from.pin, toNode, to.pin);\r\n  }\r\n\r\n  restoreConnectionsRuntime() {\r\n    for(const link of this.links) {\r\n      this._applyConnectionRuntime(link.from, link.to, link.type);\r\n    }\r\n  }\r\n\r\n  finishConnect(nodeId, pinName, type) {\r\n    if(!this.state.connecting || this.state.connecting.node === nodeId) {\r\n      this.state.connecting = null;\r\n      return;\r\n    }\r\n    const from = this.state.connecting.out\r\n      ? this.state.connecting\r\n      : {node: nodeId, pin: pinName};\r\n    const to = this.state.connecting.out\r\n      ? {node: nodeId, pin: pinName}\r\n      : this.state.connecting;\r\n    // Prevent duplicate links and type mismatch\r\n    if(from.pin && to.pin && this.isTypeCompatible(this.state.connecting.type, type)) {\r\n      const exists = this.links.find(l =>\r\n        l.from.node === from.node &&\r\n        l.from.pin === from.pin &&\r\n        l.to.node === to.node &&\r\n        l.to.pin === to.pin\r\n      );\r\n      if(!exists) {\r\n        this.links.push({id: \"link_\" + this.linkCounter++, from, to, type});\r\n        this.updateLinks();\r\n        if(type === \"value\") setTimeout(() => this.updateValueDisplays(), 0);\r\n      }\r\n    }\r\n    this.state.connecting = null;\r\n\r\n    let toNode = this.nodes[to.node];\r\n    let fromNode = this.nodes[from.node];\r\n\r\n    if(toNode && toNode.title === \"reffunctions\" && to.pin === \"reference\") {\r\n      console.log('sss ')\r\n      const fnRef = this.getPinValue(fromNode, from.pin);\r\n      if(typeof fnRef !== \"function\") return;\r\n      toNode._fnRef = fnRef;\r\n      this.adaptRefFunctionNode(toNode, fnRef);\r\n    }\r\n    // Get Sub Object \u2013 adapt pins on connect\r\n    toNode = this.nodes[to.node];\r\n    fromNode = this.nodes[from.node];\r\n    this.onPinsConnected(fromNode, from.pin, toNode, to.pin);\r\n  }\r\n\r\n  _adaptGetSubObjectOnConnect(getSubNode, sourceNode) {\r\n    // alert('adapt')\r\n    const obj = sourceNode._returnCache;\r\n    if(!obj || typeof obj !== \"object\") return;\r\n    const varField = sourceNode.fields?.find(f => f.key === \"var\");\r\n    const previewField = getSubNode.fields?.find(f => f.key === \"objectPreview\");\r\n    if(previewField) {\r\n      previewField.value = varField?.value || \"[object]\";\r\n      if(getSubNode.objectPreviewEl)\r\n        getSubNode.objectPreviewEl.value = previewField.value;\r\n    }\r\n    const path = getSubNode.fields?.find(f => f.key === \"path\")?.value;\r\n    const target = this.resolvePath(obj, path);\r\n    this.adaptSubObjectPins(getSubNode, target);\r\n    getSubNode._subCache = {};\r\n    if(target && typeof target === \"object\") {\r\n      for(const k in target) getSubNode._subCache[k] = target[k];\r\n    }\r\n    getSubNode._needsRebuild = false;\r\n    getSubNode._pinsBuilt = true;\r\n    // console.log(\"[ADAPT SUB OBJECT]\", getSubNode.id, \"path:\", path, \"target:\", target);\r\n    this.updateNodeDOM(getSubNode.id);\r\n  }\r\n\r\n  onPinsConnected(sourceNode, sourcePin, targetNode) {\r\n    if(targetNode.title === \"Get Scene Object\" || targetNode.title === \"Get Sub Object\" ||\r\n      targetNode.title === \"Get Scene Light\"\r\n    ) {\r\n      this._adaptGetSubObjectOnConnect(targetNode, sourceNode, sourcePin);\r\n    }\r\n  }\r\n\r\n  // get func for ref pin\r\n  getPinValue(node, pinName) {\r\n    const out = node.outputs?.find(p => p.name === pinName);\r\n    let getName = node.fields.find(item => item.key == \"selectedObject\").value;\r\n    // little hard code - fix in future\r\n    // By current light rule of given names.\r\n    if(node.title == \"Get Scene Object\") {\r\n      return app.getSceneObjectByName(getName)[out.name];\r\n    } else if(node.title == \"Get Scene Animation\") {\r\n      return app.getSceneObjectByName(getName)[out.name];\r\n    } else {\r\n      // light for now\r\n      getName = parseInt(getName.replace(\"light\", \"\"));\r\n      return node.accessObject[getName][pinName];\r\n    }\r\n  }\r\n\r\n  normalizePinType(type) {\r\n    if(!type) return \"any\";\r\n    if(type === \"number\") return \"value\";\r\n    return type;\r\n  }\r\n\r\n  updateSceneObjectPins(node, objectName) {\r\n    const obj = (node.accessObject || []).find(o => o.name === objectName);\r\n    if(!obj) return;\r\n    // clear\r\n    node.outputs = [];\r\n    node.exposeProps.forEach(p => {\r\n      const value = this.getByPath(obj, p);\r\n      if(value !== undefined) {\r\n        const type = typeof value === \"number\" ? \"number\"\r\n          : typeof value === \"string\" ? \"string\" : \"object\";\r\n        node.outputs.push({name: p, type});\r\n      }\r\n    });\r\n    this.updateNodeDOM(node.id);\r\n  }\r\n\r\n  _pinElement(pinSpec, isOutput, nodeId) {\r\n    const pin = document.createElement(\"div\");\r\n    if(pinSpec.name == \"position\") {\r\n      pin.className = `pin pin-${pinSpec.name}`;\r\n    } else {\r\n      pin.className = `pin pin-${pinSpec.type}`;\r\n    }\r\n    pin.dataset.pin = pinSpec.name;\r\n    pin.dataset.type = pinSpec.type;\r\n    pin.dataset.io = isOutput ? \"out\" : \"in\";\r\n    pin.dataset.node = nodeId;\r\n    // Dot (connect point)\r\n    const dot = document.createElement(\"div\");\r\n    dot.className = \"dot\";\r\n    pin.appendChild(dot);\r\n    // Pin Label\r\n    const label = document.createElement(\"span\");\r\n    label.className = \"pin-label\";\r\n    label.textContent = pinSpec.name;\r\n    pin.appendChild(label);\r\n    // Connect events\r\n    pin.addEventListener(\"mousedown\", () =>\r\n      this.startConnect(nodeId, pinSpec.name, pinSpec.type, isOutput)\r\n    );\r\n\r\n    pin.addEventListener(\"mouseup\", () =>\r\n      this.finishConnect(nodeId, pinSpec.name, pinSpec.type, isOutput)\r\n    );\r\n\r\n    return pin;\r\n  }\r\n\r\n  createNodeDOM(spec) {\r\n    const el = document.createElement(\"div\");\r\n\r\n    if(spec.title == \"Fetch\") {\r\n      el.className = \"node \" + (spec.title.toLowerCase() || \"\");\r\n    } else if(spec.title == \"Play MP3\") {\r\n      el.className = \"node \" + \"audios\";\r\n    } else if(spec.title == \"Curve\") {\r\n      el.className = \"node \" + \"curve\";\r\n    } else if(spec.title == \"Set Shader Graph\") {\r\n      el.className = \"node \" + \"shader\";\r\n    } else {\r\n      el.className = \"node \" + (spec.category || \"\");\r\n    }\r\n\r\n    el.style.left = spec.x + \"px\";\r\n    el.style.top = spec.y + \"px\";\r\n    el.dataset.id = spec.id;\r\n\r\n    // --- Header ---\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"header\";\r\n    header.textContent = spec.title;\r\n    el.appendChild(header);\r\n\r\n    // --- Body ---\r\n    const body = document.createElement(\"div\");\r\n    body.className = \"body\";\r\n\r\n    // --- Pin row ---\r\n    const row = document.createElement(\"div\");\r\n    if(spec.title == \"Comment\") {\r\n      row.classList.add('pin-row');\r\n      row.classList.add('comment');\r\n    } else {\r\n      row.className = \"pin-row\";\r\n    }\r\n\r\n    const left = document.createElement(\"div\");\r\n    left.className = \"pins-left\";\r\n\r\n    const right = document.createElement(\"div\");\r\n    right.className = \"pins-right\";\r\n\r\n    // Normalize pins before building DOM\r\n    (spec.inputs || []).forEach(pin => {\r\n      pin.type = this.normalizePinType(pin.type);\r\n      left.appendChild(this._pinElement(pin, false, spec.id));\r\n    });\r\n\r\n    (spec.outputs || []).forEach(pin => {\r\n      pin.type = this.normalizePinType(pin.type);\r\n      right.appendChild(this._pinElement(pin, true, spec.id));\r\n    });\r\n\r\n    row.appendChild(left);\r\n    row.appendChild(right);\r\n    body.appendChild(row);\r\n\r\n    if(spec.title == \"Curve\") {\r\n\r\n      const c = new CurveData(spec.id);\r\n      let curve = this.curveEditor.curveStore.getOrCreate(c);\r\n      spec.curve = curve;\r\n\r\n      console.log(`%c Create DOM corotine Node [CURVE] ${spec.curve}`, LOG_FUNNY_ARCADE);\r\n\r\n      this.curveEditor.bindCurve(spec.curve, {\r\n        name: spec.id,\r\n        idNode: spec.id\r\n      });\r\n    }\r\n\r\n    if(spec.comment) {\r\n      const textarea = document.createElement(\"textarea\");\r\n      // textarea.style\r\n      textarea.style.webkitBoxShadow = \"inset 0px 0px 1px 4px #9E9E9E\";\r\n      textarea.style.boxShadow =\r\n        \"inset 0px 0px 22px 1px rgba(118, 118, 118, 1)\";\r\n      textarea.style.backgroundColor = \"gray\";\r\n      textarea.style.color = \"black\";\r\n\r\n      textarea.value = spec.fields.find(f => f.key === \"text\").value;\r\n\r\n      textarea.oninput = () => {\r\n        spec.fields.find(f => f.key === \"text\").value = textarea.value;\r\n        row.textContent = textarea.value || \"Comment\";\r\n      };\r\n\r\n      body.appendChild(textarea);\r\n    }\r\n    // \uD83D\uDD34 FIELD INPUTS\r\n    if(spec.fields?.length && !spec.comment && spec.title != \"GenRandInt\") {\r\n      const fieldsWrap = document.createElement(\"div\");\r\n      fieldsWrap.className = \"node-fields\";\r\n      spec.fields.forEach(field => {\r\n        // skip special cases handled elsewhere\r\n        if(field.key === \"var\") return;\r\n        const input = this.createFieldInput(spec, field);\r\n        if(field.key === \"objectPreview\") {\r\n          spec.objectPreviewEl = input;\r\n        }\r\n        fieldsWrap.appendChild(input);\r\n      });\r\n      body.appendChild(fieldsWrap);\r\n    }\r\n\r\n    // Value display\r\n    if(spec.fields && spec.title === \"GenRandInt\") {\r\n      const container = document.createElement(\"div\");\r\n      container.className = \"genrand-inputs\";\r\n\r\n      spec.fields.forEach(f => {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"number\";\r\n        input.value = f.value;\r\n        input.style.width = \"40px\";\r\n        input.style.marginRight = \"4px\";\r\n        input.addEventListener(\"input\", e => (f.value = e.target.value));\r\n        container.appendChild(input);\r\n\r\n        const label = document.createElement(\"span\");\r\n        label.textContent = f.key;\r\n        label.className = \"field-label\";\r\n        container.appendChild(label);\r\n      });\r\n\r\n      body.appendChild(container);\r\n    } else if(spec.category === \"math\" || spec.category === \"value\" || spec.title === \"Print\") {\r\n      const display = document.createElement(\"div\");\r\n      display.className = \"value-display\";\r\n      display.textContent = \"?\";\r\n      spec.displayEl = display;\r\n      body.appendChild(display);\r\n    }\r\n\r\n    // Function Method Selector\r\n    if(spec.title === \"Function\" && spec.category === \"action\" && !spec.builtIn && !spec.isVariableNode) {\r\n      const select = document.createElement(\"select\");\r\n      select.id = spec.id;\r\n      select.className = \"method-select\";\r\n      select.style.cssText = \"width:100%; margin-top:6px;\";\r\n\r\n      body.appendChild(select);\r\n\r\n      this.populateMethodsSelect(select);\r\n      if(spec.attachedMethod) {\r\n        select.value = spec.attachedMethod;\r\n      }\r\n\r\n      select.addEventListener(\"change\", e => {\r\n        const selected = this.methodsManager.methodsContainer.find(\r\n          m => m.name === e.target.value\r\n        );\r\n        if(selected) {\r\n          console.log('test reference', selected)\r\n          this.adaptNodeToMethod(spec, selected);\r\n        }\r\n      });\r\n    }\r\n    // Variable name input (temporary until popup)\r\n    if(spec.fields?.some(f => f.key === \"var\") && !spec.comment) {\r\n\r\n      const input = document.createElement(\"input\");\r\n      input.type = \"text\";\r\n      input.value = spec.fields.find(f => f.key === \"var\")?.value ?? \"\";\r\n      input.readOnly = true;\r\n\r\n      input.style.width = \"100%\";\r\n      input.style.marginTop = \"6px\";\r\n      input.style.opacity = \"0.7\";\r\n      input.style.cursor = \"default\";\r\n\r\n      body.appendChild(input);\r\n    }\r\n\r\n    if(spec.title === \"functions\") {\r\n      const select = document.createElement(\"select\");\r\n      select.style.width = \"100%\";\r\n      select.style.marginTop = \"6px\";\r\n\r\n      if(spec.accessObject === undefined) {\r\n        spec.accessObject = eval(spec.accessObjectLiteral);\r\n      }\r\n      this.populateDynamicFunctionSelect(select, spec);\r\n\r\n      select.addEventListener(\"change\", e => {\r\n        const fnName = e.target.value;\r\n        if(fnName) {\r\n          this.adaptDynamicFunction(spec, fnName);\r\n        }\r\n      });\r\n\r\n      body.appendChild(select);\r\n    }\r\n\r\n    if(spec.title === \"Get Scene Object\" || spec.title === \"Get Scene Animation\" || spec.title === \"Get Scene Light\") {\r\n      const select = document.createElement(\"select\");\r\n      select.id = spec._id ? spec._id : spec.id;\r\n      select.style.width = \"100%\";\r\n      select.style.marginTop = \"6px\";\r\n\r\n      // Populate scene objects\r\n      if(spec.accessObject === undefined) spec.accessObject = eval(spec.accessObjectLiteral);\r\n      const objects = spec.accessObject || []; // window.app?.mainRenderBundle || [];\r\n\r\n      const placeholder = document.createElement(\"option\");\r\n      placeholder.textContent = \"-- Select Object --\";\r\n      placeholder.value = \"\";\r\n      select.appendChild(placeholder);\r\n      // console.log('WORKS objects', spec.accessObject.length);\r\n      spec.accessObject.forEach(obj => {\r\n        const opt = document.createElement(\"option\");\r\n        opt.value = obj.name;\r\n        opt.textContent = obj.name;\r\n        select.appendChild(opt);\r\n      });\r\n\r\n      if(spec.fields[0].value) select.value = spec.fields[0].value;\r\n\r\n      select.addEventListener(\"change\", e => {\r\n        const name = e.target.value;\r\n        spec.fields[0].value = name;\r\n        this.updateSceneObjectPins(spec, name);\r\n      });\r\n      el.appendChild(select);\r\n    } else if(spec.title === \"Set Shader Graph\") {\r\n      const select = document.createElement(\"select\");\r\n      select.id = spec._id ? spec._id : spec.id;\r\n      select.style.width = \"100%\";\r\n      select.style.marginTop = \"6px\";\r\n      // Populate shader objects\r\n      if(spec.accessObject === undefined) spec.accessObject = eval(spec.accessObjectLiteral);\r\n      const placeholder = document.createElement(\"option\");\r\n      placeholder.textContent = \"-- Select Shader --\";\r\n      placeholder.value = \"\";\r\n      select.appendChild(placeholder);\r\n\r\n      spec.accessObject.runtimeList.forEach(name => {\r\n        const opt = document.createElement(\"option\");\r\n        opt.value = name;\r\n        opt.textContent = name;\r\n        select.appendChild(opt);\r\n      });\r\n      select.addEventListener(\"change\", e => {\r\n        const name = e.target.value;\r\n        spec.fields[0].value = name;\r\n        const dom = document.querySelector(`.node[data-id=\"${spec.id}\"]`);\r\n        let fields = dom.querySelectorAll(\".node-fields\");\r\n        // console.log('WORKS objects', fields);\r\n        fields[0].children[0].value = name;\r\n      });\r\n      el.appendChild(select);\r\n      select.value = spec.fields[0].value;\r\n      setTimeout(() => select.dispatchEvent(new Event('change', {bubbles: true})), 100);\r\n    }\r\n\r\n    el.appendChild(body);\r\n    // --- Dragging ---\r\n    header.addEventListener(\"mousedown\", e => {\r\n      e.preventDefault();\r\n      this.state.draggingNode = el;\r\n      const rect = el.getBoundingClientRect();\r\n      const bx = this.board.getBoundingClientRect();\r\n      this.state.dragOffset = [\r\n        e.clientX - rect.left + bx.left,\r\n        e.clientY - rect.top + bx.top,\r\n      ];\r\n      document.body.style.cursor = \"grabbing\";\r\n    });\r\n    // --- Selecting ---\r\n    el.addEventListener(\"click\", e => {\r\n      e.stopPropagation();\r\n      this.selectNode(spec.id);\r\n\r\n      this.updateNodeDOM(spec.id)\r\n    });\r\n\r\n    el.addEventListener(\"dblclick\", e => {\r\n      e.stopPropagation();\r\n      console.log('DBL ' + spec.id);\r\n      this.onNodeDoubleClick(spec);\r\n\r\n    });\r\n\r\n    return el;\r\n  }\r\n\r\n  selectNode(id) {\r\n    if(this.state.selectedNode) {\r\n      document\r\n        .querySelector(`.node[data-id=\"${this.state.selectedNode}\"]`)\r\n        ?.classList.remove(\"selected\");\r\n    }\r\n    this.state.selectedNode = id;\r\n    document.querySelector(`.node[data-id=\"${id}\"]`)?.classList.add(\"selected\");\r\n  }\r\n\r\n  populateDynamicFunctionSelect(select, spec) {\r\n    select.innerHTML = \"\";\r\n\r\n    const placeholder = document.createElement(\"option\");\r\n    placeholder.value = \"\";\r\n    placeholder.textContent = \"-- Select Function --\";\r\n    select.appendChild(placeholder);\r\n\r\n    if(!spec.accessObject || typeof spec.accessObject !== \"object\") return;\r\n\r\n    for(const key in spec.accessObject) {\r\n      if(typeof spec.accessObject[key] === \"function\") {\r\n        const opt = document.createElement(\"option\");\r\n        opt.value = key;\r\n        opt.textContent = key;\r\n        select.appendChild(opt);\r\n      }\r\n    }\r\n    // console.log(spec.fields.find(item => item.key == \"selectedObject\").value)\r\n    let current = spec.fields.find(item => item.key == \"selectedObject\").value;\r\n    for(const opt of select.options) {\r\n      if(opt.text === current) {\r\n        opt.selected = true;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  isTypeCompatible(fromType, toType) {\r\n    if(fromType === \"action\" || toType === \"action\") {\r\n      return fromType === toType;\r\n    }\r\n    if(fromType === toType) return true;\r\n    if(fromType === \"any\" || toType === \"any\") return true;\r\n    return false;\r\n  }\r\n\r\n  addNode(type, options = {}) {\r\n    const id = \"node_\" + this.nodeCounter++;\r\n    const x = Math.abs(this.state.pan[0]) + 100 + Math.random() * 200;\r\n    const y = Math.abs(this.state.pan[1]) + 100 + Math.random() * 200;\r\n\r\n    // Node factory map\r\n    const nodeFactories = {\r\n      event: (id, x, y) => ({\r\n        id, title: \"onLoad\", x, y,\r\n        category: \"event\",\r\n        inputs: [],\r\n        outputs: [{name: \"exec\", type: \"action\"}],\r\n      }),\r\n\r\n      audioMP3: (id, x, y, options) => ({\r\n        id, x, y, title: \"Play MP3\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"key\", type: \"string\", default: \"audio\"},\r\n          {name: \"src\", type: \"string\", default: \"\"},\r\n          {name: \"clones\", type: \"number\", default: 1}\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"created\", value: false},\r\n          {key: \"key\", value: options?.name},\r\n          {key: \"src\", value: options?.path},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      generator: (id, x, y) => ({\r\n        id, x, y, title: \"Generator\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"material\", type: \"string\"},\r\n          {name: \"pos\", type: \"object\"},\r\n          {name: \"rot\", type: \"object\"},\r\n          {name: \"texturePath\", type: \"string\"},\r\n          {name: \"name\", type: \"string\"},\r\n          {name: \"geometry\", type: \"string\"},\r\n          {name: \"raycast\", type: \"boolean\"},\r\n          {name: \"scale\", type: \"object\"},\r\n          {name: \"sum\", type: \"number\"},\r\n          {name: \"delay\", type: \"number\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"material\", value: \"standard\"},\r\n          {key: \"pos\", value: '{x:0, y:0, z:-20}'},\r\n          {key: \"rot\", value: '{x:0, y:0, z:0}'},\r\n          {key: \"texturePath\", value: \"res/textures/star1.png\"},\r\n          {key: \"name\", value: \"TEST\"},\r\n          {key: \"geometry\", value: \"Cube\"},\r\n          {key: \"raycast\", value: true},\r\n          {key: \"scale\", value: [1, 1, 1]},\r\n          {key: \"sum\", value: 10},\r\n          {key: \"delay\", value: 500},\r\n          {key: \"created\", value: false},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      generatorWall: (id, x, y) => ({\r\n        id, x, y, title: \"Generator Wall\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"material\", type: \"string\"},\r\n          {name: \"pos\", type: \"object\"},\r\n          {name: \"rot\", type: \"object\"},\r\n          {name: \"texturePath\", type: \"string\"},\r\n          {name: \"name\", type: \"string\"},\r\n          {name: \"size\", type: \"string\"},\r\n          {name: \"raycast\", type: \"boolean\"},\r\n          {name: \"scale\", type: \"object\"},\r\n          {name: \"spacing\", type: \"number\"},\r\n          {name: \"delay\", type: \"number\"}\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"material\", value: \"standard\"},\r\n          {key: \"pos\", value: '{x:0, y:0, z:-20}'},\r\n          {key: \"rot\", value: '{x:0, y:0, z:0}'},\r\n          {key: \"texturePath\", value: \"res/textures/star1.png\"},\r\n          {key: \"name\", value: \"TEST\"},\r\n          {key: \"size\", value: \"10x3\"},\r\n          {key: \"raycast\", value: true},\r\n          {key: \"scale\", value: [1, 1, 1]},\r\n          {key: \"spacing\", value: 10},\r\n          {key: \"delay\", value: 500},\r\n          {key: \"created\", value: false},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      generatorPyramid: (id, x, y) => ({\r\n        id, x, y, title: \"Generator Pyramid\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"material\", type: \"string\"},\r\n          {name: \"pos\", type: \"object\"},\r\n          {name: \"rot\", type: \"object\"},\r\n          {name: \"texturePath\", type: \"string\"},\r\n          {name: \"name\", type: \"string\"},\r\n          {name: \"levels\", type: \"number\"},\r\n          {name: \"raycast\", type: \"boolean\"},\r\n          {name: \"scale\", type: \"object\"},\r\n          {name: \"spacing\", type: \"number\"},\r\n          {name: \"delay\", type: \"number\"}\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"complete\", type: \"action\"},\r\n          {name: \"objectNames\", type: \"object\"}\r\n        ],\r\n        fields: [\r\n          {key: \"material\", value: \"standard\"},\r\n          {key: \"pos\", value: '{x:0, y:0, z:-20}'},\r\n          {key: \"rot\", value: '{x:0, y:0, z:0}'},\r\n          {key: \"texturePath\", value: \"res/textures/star1.png\"},\r\n          {key: \"name\", value: \"TEST\"},\r\n          {key: \"levels\", value: \"5\"},\r\n          {key: \"raycast\", value: true},\r\n          {key: \"scale\", value: [1, 1, 1]},\r\n          {key: \"spacing\", value: 10},\r\n          {key: \"delay\", value: 500},\r\n          {key: \"created\", value: false},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      addObj: (id, x, y) => ({\r\n        id, x, y, title: \"Add OBJ\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"path\", type: \"string\"},\r\n          {name: \"material\", type: \"string\"},\r\n          {name: \"pos\", type: \"object\"},\r\n          {name: \"rot\", type: \"object\"},\r\n          {name: \"texturePath\", type: \"string\"},\r\n          {name: \"name\", type: \"string\"},\r\n          {name: \"raycast\", type: \"boolean\"},\r\n          {name: \"scale\", type: \"object\"},\r\n          {name: \"isPhysicsBody\", type: \"boolean\"},\r\n          {name: \"isInstancedObj\", type: \"boolean\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"complete\", type: \"action\"},\r\n          {name: \"error\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"path\", value: \"res/meshes/blender/cube.obj\"},\r\n          {key: \"material\", value: \"standard\"},\r\n          {key: \"pos\", value: '{x:0, y:0, z:-20}'},\r\n          {key: \"rot\", value: '{x:0, y:0, z:0}'},\r\n          {key: \"texturePath\", value: \"res/textures/star1.png\"},\r\n          {key: \"name\", value: \"TEST\"},\r\n          {key: \"raycast\", value: true},\r\n          {key: \"scale\", value: [1, 1, 1]},\r\n          {key: \"isPhysicsBody\", type: false},\r\n          {key: \"isInstancedObj\", type: false},\r\n          {key: \"created\", value: false},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      setForceOnHit: (id, x, y) => ({\r\n        id, x, y, title: \"Set Force On Hit\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"objectName\", type: \"string\"},\r\n          {name: \"rayDirection\", type: \"object\"},\r\n          {name: \"strength\", type: \"number\"},\r\n\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        fields: [],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      setVideoTexture: (id, x, y) => ({\r\n        id, x, y, title: \"Set Video Texture\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"objectName\", type: \"string\"},\r\n          {name: \"VideoTextureArg\", type: \"object\"},\r\n          {name: \"muteAudio\", type: \"boolean\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"objectName\", value: \"standard\"},\r\n          {key: \"VideoTextureArg\", value: \"{type: 'video', src: 'res/videos/tunel.mp4'}\"},\r\n          {key: \"muteAudio\", value: true},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      setCanvasInlineTexture: (id, x, y) => ({\r\n        id, x, y, title: \"Set CanvasInline\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"objectName\", type: \"string\"},\r\n          {name: \"canvaInlineProgram\", type: \"function\"},\r\n          {name: \"specialCanvas2dArg\", type: \"object\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"objectName\", value: \"standard\"},\r\n          {key: \"canvaInlineProgram\", value: \"function (ctx, canvas) {}\"},\r\n          {key: \"specialCanvas2dArg\", value: \"{ hue: 200, glow: 10, text: 'Hello programmer', fontSize: 60, flicker: 0.05, }\"},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      audioReactiveNode: (id, x, y) => ({\r\n        id, x, y, title: \"Audio Reactive Node\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"audioSrc\", type: \"string\"},\r\n          {name: \"loop\", type: \"boolean\"},\r\n          {name: \"thresholdBeat\", type: \"number\"},\r\n\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"low\", type: \"number\"},\r\n          {name: \"mid\", type: \"number\"},\r\n          {name: \"high\", type: \"number\"},\r\n          {name: \"energy\", type: \"number\"},\r\n          {name: \"beat\", type: \"boolean\"}\r\n        ],\r\n        fields: [\r\n          {key: \"audioSrc\", value: \"audionautix-black-fly.mp3\"},\r\n          {key: \"loop\", value: true},\r\n          {key: \"thresholdBeat\", value: 0.7},\r\n          {key: \"created\", value: false}\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      oscillator: (id, x, y) => ({\r\n        id, x, y, title: \"Oscillator\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"min\", type: \"number\"},\r\n          {name: \"max\", type: \"number\"},\r\n          {name: \"step\", type: \"number\"},\r\n          {name: \"regime\", type: \"string\"},\r\n          {name: \"resist\", type: \"number\"},\r\n          {name: \"resistMode\", type: \"number\"}\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"value\", type: \"number\"}\r\n        ],\r\n        fields: [\r\n          {key: \"min\", value: 0},\r\n          {key: \"max\", value: 10},\r\n          {key: \"step\", value: 0.2},\r\n          {key: \"regime\", value: 'pingpong'},\r\n          {key: \"resist\", value: 0.02},\r\n          {key: \"resistMode\", value: 'linear'},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      curveTimeline: (id, x, y) => ({\r\n        id, x, y, title: \"Curve\",\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"name\", type: \"string\"},\r\n          {name: \"delta\", type: \"number\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"value\", type: \"number\"}\r\n        ],\r\n        fields: [\r\n          {key: \"name\", value: \"Curve1\"}\r\n        ],\r\n        curve: {},\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      eventCustom: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Custom Event\",\r\n        category: \"event\",\r\n        fields: [\r\n          {key: \"name\", value: \"myEvent\"}\r\n        ],\r\n        inputs: [],\r\n        outputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"detail\", type: \"object\"}\r\n        ],\r\n        _listenerAttached: false,\r\n        _returnCache: null,\r\n        noselfExec: 'true'\r\n      }),\r\n\r\n      dispatchEvent: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Dispatch Event\",\r\n        category: \"event\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"eventName\", type: \"string\", default: \"myEvent\"},\r\n          {name: \"detail\", type: \"object\", default: {}}\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"}\r\n        ],\r\n        noselfExec: 'true'\r\n      }),\r\n\r\n      rayHitEvent: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"On Ray Hit\",\r\n        category: \"event\",\r\n        inputs: [],\r\n        outputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"hitObjectName\", type: \"string\"},\r\n          {name: \"screenCoords\", type: \"object\"},\r\n          {name: \"rayOrigin\", type: \"object\"},\r\n          {name: \"rayDirection\", type: \"object\"},\r\n          {name: \"hitObject\", type: \"object\"},\r\n          {name: \"hitNormal\", type: \"object\"},\r\n          {name: \"hitDistance\", type: \"object\"},\r\n          {name: \"eventName\", type: \"object\"},\r\n          {name: \"button\", type: \"number\"},\r\n          {name: \"timestamp\", type: \"number\"}\r\n        ],\r\n        noselfExec: 'true',\r\n        _listenerAttached: false,\r\n      }),\r\n\r\n      onDraw: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"On Draw\",\r\n        category: \"event\",\r\n        inputs: [],\r\n        outputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"delta\", type: \"number\"},\r\n          {name: \"skip\", type: \"number\"}\r\n        ],\r\n        fields: [\r\n          {key: \"skip\", value: 5}\r\n        ],\r\n        noselfExec: 'true',\r\n        _listenerAttached: false,\r\n      }),\r\n\r\n      onKey: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"On Key\",\r\n        category: \"event\",\r\n        inputs: [],\r\n        outputs: [\r\n          {name: \"keyDown\", type: \"action\"},\r\n          {name: \"keyUp\", type: \"action\"},\r\n          {name: \"isHeld\", type: \"boolean\"},\r\n          {name: \"anyKeyDown\", type: \"action\"},\r\n          {name: \"keyCode\", type: \"string\"},\r\n          {name: \"shift\", type: \"action\"},\r\n          {name: \"ctrl\", type: \"action\"},\r\n          {name: \"alt\", type: \"action\"}\r\n        ],\r\n        fields: [\r\n          {key: \"key\", value: \"W\"},\r\n        ],\r\n        noselfExec: 'true',\r\n        _listenerAttached: false,\r\n      }),\r\n\r\n      function: (id, x, y) => ({\r\n        id, title: \"Function\", x, y,\r\n        category: \"action\",\r\n        inputs: [{name: \"exec\", type: \"action\"}],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      if: (id, x, y) => ({\r\n        id, title: \"if\", x, y,\r\n        category: \"logic\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"condition\", type: \"boolean\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"true\", type: \"action\"},\r\n          {name: \"false\", type: \"action\"},\r\n        ],\r\n        fields: [\r\n          {key: \"condition\", value: true},\r\n        ],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      genrand: (id, x, y) => ({\r\n        id, title: \"GenRandInt\", x, y,\r\n        category: \"value\",\r\n        inputs: [],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n        fields: [\r\n          {key: \"min\", value: \"0\"},\r\n          {key: \"max\", value: \"10\"},\r\n        ],\r\n      }),\r\n\r\n      print: (id, x, y) => ({\r\n        id, title: \"Print\", x, y,\r\n        category: \"actionprint\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"value\", type: \"any\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [{key: \"label\", value: \"Result\"}],\r\n        builtIn: true,\r\n        noselfExec: 'true'\r\n      }),\r\n\r\n      timeout: (id, x, y) => ({\r\n        id, title: \"SetTimeout\", x, y,\r\n        category: \"timer\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"delay\", type: \"value\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [{key: \"delay\", value: \"1000\"}],\r\n        builtIn: true,\r\n      }),\r\n\r\n      // string operation\r\n      startsWith: (id, x, y) => ({\r\n        id, title: \"Starts With [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"input\", type: \"string\"},\r\n          {name: \"prefix\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"boolean\"}],\r\n      }),\r\n\r\n      endsWith: (id, x, y) => ({\r\n        id, title: \"Ends With [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"input\", type: \"string\"},\r\n          {name: \"suffix\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"boolean\"}]\r\n      }),\r\n\r\n      includes: (id, x, y) => ({\r\n        id, title: \"Includes [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"input\", type: \"string\"},\r\n          {name: \"search\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"boolean\"}]\r\n      }),\r\n      toUpperCase: (id, x, y) => ({\r\n        id, title: \"To Upper Case [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [{name: \"input\", type: \"string\"}],\r\n        outputs: [{name: \"return\", type: \"string\"}]\r\n      }),\r\n      toLowerCase: (id, x, y) => ({\r\n        id, title: \"To Lower Case [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [{name: \"input\", type: \"string\"}],\r\n        outputs: [{name: \"return\", type: \"string\"}]\r\n      }),\r\n      trim: (id, x, y) => ({\r\n        id, title: \"Trim [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [{name: \"input\", type: \"string\"}],\r\n        outputs: [{name: \"return\", type: \"string\"}]\r\n      }),\r\n      length: (id, x, y) => ({\r\n        id, title: \"String Length\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [{name: \"input\", type: \"string\"}],\r\n        outputs: [{name: \"return\", type: \"number\"}]\r\n      }),\r\n      substring: (id, x, y) => ({\r\n        id, title: \"Substring [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"input\", type: \"string\"},\r\n          {name: \"start\", type: \"number\"},\r\n          {name: \"end\", type: \"number\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"string\"}]\r\n      }),\r\n      replace: (id, x, y) => ({\r\n        id, title: \"Replace [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"input\", type: \"string\"},\r\n          {name: \"search\", type: \"string\"},\r\n          {name: \"replace\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"string\"}]\r\n      }),\r\n      split: (id, x, y) => ({\r\n        id, title: \"Split [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"input\", type: \"string\"},\r\n          {name: \"separator\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"array\"}]\r\n      }),\r\n\r\n      concat: (id, x, y) => ({\r\n        id, title: \"Concat [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [\r\n          {name: \"a\", type: \"string\"},\r\n          {name: \"b\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"return\", type: \"string\"}]\r\n      }),\r\n\r\n      isEmpty: (id, x, y) => ({\r\n        id, title: \"Is Empty [string]\", x, y,\r\n        category: \"stringOperation\",\r\n        inputs: [{name: \"input\", type: \"string\"}],\r\n        outputs: [{name: \"return\", type: \"boolean\"}]\r\n      }),\r\n\r\n      // Math\r\n      add: (id, x, y) => ({\r\n        id, title: \"Add\", x, y,\r\n        category: \"math\",\r\n        inputs: [\r\n          {name: \"a\", type: \"value\"},\r\n          {name: \"b\", type: \"value\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n\r\n      sub: (id, x, y) => ({\r\n        id, title: \"Sub\", x, y,\r\n        category: \"math\",\r\n        inputs: [\r\n          {name: \"a\", type: \"value\"},\r\n          {name: \"b\", type: \"value\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n\r\n      mul: (id, x, y) => ({\r\n        id, title: \"Mul\", x, y,\r\n        category: \"math\",\r\n        inputs: [\r\n          {name: \"a\", type: \"value\"},\r\n          {name: \"b\", type: \"value\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n\r\n      div: (id, x, y) => ({\r\n        id, title: \"Div\", x, y,\r\n        category: \"math\",\r\n        inputs: [\r\n          {name: \"a\", type: \"value\"},\r\n          {name: \"b\", type: \"value\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n\r\n      sin: (id, x, y) => ({\r\n        id, title: \"Sin\", x, y,\r\n        category: \"math\",\r\n        inputs: [{name: \"a\", type: \"value\"}],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n\r\n      cos: (id, x, y) => ({\r\n        id, title: \"Cos\", x, y,\r\n        category: \"math\",\r\n        inputs: [{name: \"a\", type: \"value\"}],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n\r\n      pi: (id, x, y) => ({\r\n        id,\r\n        title: \"Pi\",\r\n        x,\r\n        y,\r\n        category: \"math\",\r\n        inputs: [],\r\n        outputs: [{name: \"result\", type: \"value\"}],\r\n      }),\r\n      // comparation nodes\r\n      greater: (id, x, y) => ({\r\n        id,\r\n        title: \"A > B\",\r\n        x,\r\n        y,\r\n        category: \"compare\",\r\n        inputs: [\r\n          {name: \"A\", type: \"number\"},\r\n          {name: \"B\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n      }),\r\n\r\n      less: (id, x, y) => ({\r\n        id,\r\n        title: \"A < B\",\r\n        x,\r\n        y,\r\n        category: \"compare\",\r\n        inputs: [\r\n          {name: \"A\", type: \"number\"},\r\n          {name: \"B\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n      }),\r\n\r\n      equal: (id, x, y) => ({\r\n        id, title: \"A == B\", x, y,\r\n        category: \"compare\",\r\n        inputs: [\r\n          {name: \"A\", type: \"any\"},\r\n          {name: \"B\", type: \"any\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n      }),\r\n\r\n      notequal: (id, x, y) => ({\r\n        id, title: \"A != B\", x, y,\r\n        category: \"compare\",\r\n        inputs: [\r\n          {name: \"A\", type: \"any\"},\r\n          {name: \"B\", type: \"any\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n      }),\r\n\r\n      greaterEqual: (id, x, y) => ({\r\n        id, title: \"A >= B\", x, y,\r\n        category: \"compare\",\r\n        inputs: [\r\n          {name: \"A\", type: \"number\"},\r\n          {name: \"B\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n      }),\r\n\r\n      lessEqual: (id, x, y) => ({\r\n        id, title: \"A <= B\", x, y,\r\n        category: \"compare\",\r\n        inputs: [\r\n          {name: \"A\", type: \"number\"},\r\n          {name: \"B\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n      }),\r\n\r\n      getNumber: (id, x, y) => ({\r\n        id, title: \"Get Number\", x, y,\r\n        category: \"value\",\r\n        outputs: [{name: \"result\", type: \"number\"}],\r\n        fields: [{key: \"var\", value: \"\"}],\r\n        isGetterNode: true\r\n      }),\r\n\r\n      getBoolean: (id, x, y) => ({\r\n        id, title: \"Get Boolean\", x, y,\r\n        category: \"value\",\r\n        outputs: [{name: \"result\", type: \"boolean\"}],\r\n        fields: [{key: \"var\", value: \"\"}],\r\n        isGetterNode: true\r\n      }),\r\n\r\n      getString: (id, x, y) => ({\r\n        id, title: \"Get String\", x, y,\r\n        category: \"value\",\r\n        outputs: [{name: \"result\", type: \"string\"}],\r\n        fields: [{key: \"var\", value: \"\"}],\r\n        isGetterNode: true,\r\n      }),\r\n\r\n      getObject: (id, x, y) => ({\r\n        id, title: \"Get Object\", x, y,\r\n        category: \"value\",\r\n        outputs: [{name: \"result\", type: \"object\"}],\r\n        fields: [{key: \"var\", value: \"\"}],\r\n        isGetterNode: true,\r\n      }),\r\n\r\n      setObject: (id, x, y) => ({\r\n        id, title: \"Set Object\", x, y,\r\n        category: \"action\",\r\n        isVariableNode: true,\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"value\", type: \"object\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"var\", value: \"\"},\r\n          {key: \"literal\", value: {}},\r\n        ],\r\n      }),\r\n\r\n      setNumber: (id, x, y) => ({\r\n        id, title: \"Set Number\", x, y,\r\n        category: \"action\",\r\n        isVariableNode: true,\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"value\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"var\", value: \"\"},\r\n          {key: \"literal\", value: 0},\r\n        ],\r\n      }),\r\n\r\n      setBoolean: (id, x, y) => ({\r\n        id, title: \"Set Boolean\", x, y,\r\n        category: \"action\",\r\n        isVariableNode: true,\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"value\", type: \"boolean\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"var\", value: \"\"},\r\n          {key: \"literal\", value: false},\r\n        ],\r\n      }),\r\n\r\n      setString: (id, x, y) => ({\r\n        id, title: \"Set String\", x, y,\r\n        category: \"action\",\r\n        isVariableNode: true,\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"value\", type: \"string\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"var\", value: \"\"},\r\n          {key: \"literal\", value: \"\"},\r\n        ],\r\n      }),\r\n\r\n\r\n      getNumberLiteral: (id, x, y) => ({\r\n        id, title: \"getNumberLiteral\", x, y,\r\n        category: \"action\",\r\n        inputs: [{name: \"exec\", type: \"action\"}],\r\n        outputs: [{name: \"execOut\", type: \"action\"}, {name: \"value\", type: \"number\"}],\r\n        fields: [{key: \"value\", value: 1}],\r\n        noselfExec: \"true\"\r\n      }),\r\n\r\n      comment: (id, x, y) => ({\r\n        id, title: \"Comment\", x, y,\r\n        category: \"meta\",\r\n        inputs: [],\r\n        outputs: [],\r\n        comment: true,\r\n        noExec: true,\r\n        fields: [{key: \"text\", value: \"Add comment\"}],\r\n      }),\r\n\r\n      dynamicFunction: (id, x, y, accessObject) => ({\r\n        id, title: \"functions\", x, y,\r\n        category: \"action\",\r\n        inputs: [{name: \"exec\", type: \"action\"}],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [{key: \"selectedObject\", value: \"\"}],\r\n        accessObject: (accessObject ? accessObject : window.app),\r\n        accessObjectLiteral: \"window.app\",\r\n      }),\r\n\r\n      refFunction: (id, x, y) => ({\r\n        id, title: \"reffunctions\", x, y,\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"reference\", type: \"any\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      getSceneObject: (id, x, y) => ({\r\n        noExec: true, id,\r\n        title: \"Get Scene Object\", x, y,\r\n        category: \"scene\",\r\n        inputs: [],\r\n        outputs: [],\r\n        fields: [{key: \"selectedObject\", value: \"\"}],\r\n        builtIn: true,\r\n        accessObject: window.app?.mainRenderBundle,\r\n        accessObjectLiteral: \"window.app?.mainRenderBundle\",\r\n        exposeProps: [\"name\", \"position\", \"rotation\", \"scale\"],\r\n      }),\r\n\r\n      getShaderGraph: (id, x, y) => ({\r\n        noExec: true, id,\r\n        title: \"Set Shader Graph\", x, y,\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {objectName: \"objectName\", type: \"string\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"selectedShader\", value: \"\"},\r\n          {key: \"objectName\", value: \"FLOOR\"}\r\n        ],\r\n        builtIn: true,\r\n        accessObject: window.app?.shaderGraph,\r\n        accessObjectLiteral: \"window.app?.shaderGraph\"\r\n      }),\r\n\r\n      getSceneLight: (id, x, y) => ({\r\n        noExec: true, id,\r\n        title: \"Get Scene Light\", x, y,\r\n        category: \"scene\",\r\n        inputs: [],\r\n        outputs: [],\r\n        fields: [{key: \"selectedObject\", value: \"\"}],\r\n        builtIn: true,\r\n        accessObject: window.app?.lightContainer,\r\n        accessObjectLiteral: \"window.app?.lightContainer\",\r\n        exposeProps: [\"ambientFactor\", \"setPosX\", \"setPosY\", \"setPosZ\", \"setIntensity\",\r\n          \"setInnerCutoff\", \"setOuterCutoff\", \"setColor\", \"setColorR\",\r\n          \"setColorB\", \"setColorG\", \"setRange\", \"setAmbientFactor\", \"setShadowBias\"],\r\n      }),\r\n\r\n      getObjectAnimation: (id, x, y) => ({\r\n        noExec: true, id, title: \"Get Scene Animation\", x, y,\r\n        category: \"scene\",\r\n        inputs: [],\r\n        outputs: [],\r\n        fields: [{key: \"selectedObject\", value: \"\"}],\r\n        builtIn: true,\r\n        accessObject: window.app?.mainRenderBundle,\r\n        accessObjectLiteral: \"window.app?.mainRenderBundle\",\r\n        exposeProps: [\r\n          \"name\",\r\n          \"glb.glbJsonData.animations\",\r\n          \"glb.animationIndex\",\r\n          \"playAnimationByName\",\r\n          \"playAnimationByIndex\"\r\n        ],\r\n      }),\r\n\r\n      getPosition: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Get Position\",\r\n        category: \"scene\",\r\n        inputs: [{name: \"position\", semantic: \"position\"}],\r\n        outputs: [\r\n          {name: \"x\", semantic: \"number\"},\r\n          {name: \"y\", semantic: \"number\"},\r\n          {name: \"z\", semantic: \"number\"},\r\n        ],\r\n        noExec: true,\r\n      }),\r\n\r\n      setPosition: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Position\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"position\", semantic: \"position\"},\r\n          {name: \"x\", semantic: \"number\"},\r\n          {name: \"y\", semantic: \"number\"},\r\n          {name: \"z\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setSpeed: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Speed\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"position\", semantic: \"position\"},\r\n          {name: \"thrust\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setTexture: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Texture\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"texturePath\", semantic: \"texturePath\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setProductionMode: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Production Mode\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"disableLoopWarns\", type: \"boolean\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"disableLoopWarns\", value: \"true\"},\r\n        ],\r\n      }),\r\n\r\n      setMaterial: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Material\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"materialType\", semantic: \"string\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"materialType\", value: \"standard\", placeholder: \"standard|power|water\"},\r\n        ],\r\n      }),\r\n\r\n      setWaterParams: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Water Material Params\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"deepColor(vec3f)\", semantic: \"object\"},\r\n          {name: \"waveSpeed\", semantic: \"number\"},\r\n          {name: \"shallowColor(vec3f)\", semantic: \"object\"},\r\n          {name: \"waveScale\", semantic: \"number\"},\r\n          {name: \"waveHeight\", semantic: \"number\"},\r\n          {name: \"fresnelPower\", semantic: \"number\"},\r\n          {name: \"specularPower\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"deepColor(vec3f)\", value: \"[0.0, 0.2, 0.4]\"},\r\n          {key: \"waveSpeed\", value: \"0.5\"},\r\n          {key: \"shallowColor(vec3f)\", value: \"[0.0, 0.5, 0.7]\"},\r\n          {key: \"waveScale\", value: \"4.0\"},\r\n          {key: \"waveHeight\", value: \"0.15\"},\r\n          {key: \"fresnelPower\", value: \"3.0\"},\r\n          {key: \"specularPower\", value: \"128\"},\r\n        ],\r\n      }),\r\n\r\n      setVertexWave: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Vertex Wave\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"intensity\", type: \"number\"},\r\n          {name: \"enableWave\", type: \"boolean\"},\r\n          {name: \"Wave Speed\", type: \"number\"},\r\n          {name: \"Wave Amplitude\", type: \"number\"},\r\n          {name: \"Wave Frequency\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"enableWave\", value: false},\r\n          {key: \"Wave Speed\", value: 3.0},\r\n          {key: \"Wave Amplitude\", value: 0.2},\r\n          {key: \"Wave Frequency\", value: 1.5},\r\n        ],\r\n      }),\r\n\r\n      setVertexWind: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Vertex Wind\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"enableWind\", type: \"boolean\"},\r\n          {name: \"Wind Speed\", type: \"number\"},\r\n          {name: \"Wind Strength\", type: \"number\"},\r\n          {name: \"Wind HeightInfluence\", type: \"number\"},\r\n          {name: \"Wind Turbulence\", type: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"enableWind\", value: false},\r\n          {key: \"Wind Speed\", value: 2.0},\r\n          {key: \"Wind Strength\", value: 0.4},\r\n          {key: \"Wind HeightInfluence\", value: 2.0},\r\n          {key: \"Wind Turbulence\", value: 0.4}\r\n        ],\r\n      }),\r\n\r\n      setVertexPulse: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Vertex Pulse\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"enablePulse\", type: \"boolean\"},\r\n          {name: \"Pulse speed\", type: \"number\"},\r\n          {name: \"Pulse amount\", type: \"number\"},\r\n          {name: \"Pulse centerX\", type: \"number\"},\r\n          {name: \"Pulse centerY\", type: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"enablePulse\", value: false},\r\n          {key: \"Pulse speed\", value: 1},\r\n          {key: \"Pulse amount\", value: 2},\r\n          {key: \"Pulse centerX\", value: 0},\r\n          {key: \"Pulse centerY\", value: 0}\r\n        ]\r\n      }),\r\n\r\n      setVertexTwist: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Vertex Twist\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"enableTwist\", type: \"boolean\"},\r\n          {name: \"Twist speed\", type: \"number\"},\r\n          {name: \"Twist amount\", type: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"enableTwist\", value: false},\r\n          {key: \"Twist speed\", value: 1},\r\n          {key: \"Twist amount\", value: 1},\r\n        ],\r\n      }),\r\n\r\n      setVertexNoise: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Vertex Noise\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"enableNoise\", type: \"boolean\"},\r\n          {name: \"Noise Scale\", type: \"number\"},\r\n          {name: \"Noise Strength\", type: \"number\"},\r\n          {name: \"Noise Speed\", type: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"enableNoise\", value: false},\r\n          {key: \"Noise Scale\", value: 0.5},\r\n          {key: \"Noise Strength\", value: 0.02},\r\n          {key: \"Noise Speed\", value: 0.3}\r\n        ],\r\n      }),\r\n\r\n      setVertexOcean: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Vertex Ocean\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"sceneObjectName\", semantic: \"string\"},\r\n          {name: \"enableOcean\", type: \"boolean\"},\r\n          {name: \"Ocean Scale\", type: \"number\"},\r\n          {name: \"Ocean Height\", type: \"number\"},\r\n          {name: \"Ocean speed\", type: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"sceneObjectName\", value: \"FLOOR\"},\r\n          {key: \"enableOcean\", value: false},\r\n          {key: \"Ocean Scale\", value: 2.0},\r\n          {key: \"Ocean Height\", value: 0.08},\r\n          {key: \"Ocean speed\", value: 1.5}\r\n        ],\r\n      }),\r\n\r\n      getSpeed: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Get Speed\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"position\", semantic: \"position\"}\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"thrust\", semantic: \"number\"},\r\n        ],\r\n      }),\r\n\r\n      setRotate: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Rotate\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"rotation\", semantic: \"rotation\"},\r\n          {name: \"x\", semantic: \"number\"},\r\n          {name: \"y\", semantic: \"number\"},\r\n          {name: \"z\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setRotateX: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set RotateX\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"rotation\", semantic: \"rotation\"},\r\n          {name: \"x\", semantic: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setRotateY: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set RotateY\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"rotation\", semantic: \"rotation\"},\r\n          {name: \"y\", semantic: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setRotateZ: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set RotateZ\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"rotation\", semantic: \"rotation\"},\r\n          {name: \"z\", semantic: \"number\"}\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      setRotation: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"Set Rotation\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"rotation\", semantic: \"rotation\"},\r\n          {name: \"x\", semantic: \"number\"},\r\n          {name: \"y\", semantic: \"number\"},\r\n          {name: \"z\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      translateByX: (id, x, y) => ({\r\n        id, x, y, title: \"Translate By X\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"position\", semantic: \"position\"},\r\n          {name: \"x\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        builtIn: true,\r\n      }),\r\n\r\n      translateByY: (id, x, y) => ({\r\n        id, x, y, title: \"Translate By Y\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"position\", semantic: \"position\"},\r\n          {name: \"y\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      translateByZ: (id, x, y) => ({\r\n        id, x, y, title: \"Translate By Z\",\r\n        category: \"scene\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"position\", semantic: \"position\"},\r\n          {name: \"z\", semantic: \"number\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n      }),\r\n\r\n      onTargetPositionReach: (id, x, y) => ({\r\n        id, x, y,\r\n        title: \"On Target Position Reach\",\r\n        category: \"event\",\r\n        noExec: true,\r\n        inputs: [{name: \"position\", type: \"object\"}],\r\n        outputs: [{name: \"exec\", type: \"action\"}],\r\n        _listenerAttached: false,\r\n      }),\r\n\r\n      fetch: (id, x, y) => ({\r\n        id, title: \"Fetch\", x, y,\r\n        category: \"action\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"url\", type: \"string\"},\r\n          {name: \"method\", type: \"string\", default: \"GET\"},\r\n          {name: \"body\", type: \"object\"},\r\n          {name: \"headers\", type: \"object\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"error\", type: \"action\"},\r\n          {name: \"response\", type: \"object\"},\r\n          {name: \"status\", type: \"number\"},\r\n        ],\r\n      }),\r\n\r\n      getSubObject: (id, x, y) => ({\r\n        id, title: \"Get Sub Object\", x, y,\r\n        category: \"value\",\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"object\", type: \"object\"},\r\n        ],\r\n        outputs: [{name: \"execOut\", type: \"action\"}],\r\n        fields: [\r\n          {key: \"objectPreview\", value: \"\", readonly: true},\r\n          {key: \"path\", value: \"\", placeholder: \"SomeProperty\"},\r\n        ],\r\n        isDynamicNode: true,\r\n        _needsRebuild: true,\r\n        _pinsBuilt: false,\r\n      }),\r\n\r\n      forEach: (id, x, y) => ({\r\n        id,\r\n        title: \"For Each\",\r\n        type: \"forEach\",\r\n        x,\r\n        y,\r\n        state: {item: null, index: 0},\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"array\", type: \"any\"},  // semantic array pin\r\n        ],\r\n        outputs: [\r\n          {name: \"loop\", type: \"action\"},\r\n          {name: \"completed\", type: \"action\"},\r\n          {name: \"item\", type: \"any\"},\r\n          {name: \"index\", type: \"number\"},\r\n        ],\r\n      }),\r\n\r\n      getArray: (id, x, y, initialArray = []) => ({\r\n        id, type: \"getArray\",\r\n        title: \"Get Array\",\r\n        x, y,\r\n        fields: [\r\n          {key: \"array\", value: initialArray.slice()},\r\n        ],\r\n        inputs: [\r\n          {name: \"exec\", type: \"action\"},\r\n          {name: \"array\", type: \"any\"},\r\n        ],\r\n        outputs: [\r\n          {name: \"execOut\", type: \"action\"},\r\n          {name: \"array\", type: \"any\"}\r\n        ],\r\n        _returnCache: initialArray.slice(),\r\n      }),\r\n    };\r\n\r\n    // Generate node spec\r\n    let spec = null;\r\n\r\n    if(type === 'dynamicFunction') {\r\n      // Exception for dynamic access\r\n      let AO = prompt(`Add global access object !`);\r\n      if(AO) {\r\n        console.warn(\"Adding AO \", eval(AO));\r\n        options.accessObject = eval(AO);\r\n      } else {\r\n        console.warn(\"Adding global access object failed...\");\r\n        options.accessObject = window.app;\r\n        return;\r\n      };\r\n      if(nodeFactories[type]) spec = nodeFactories[type](id, x, y, options.accessObject);\r\n      spec.accessObjectLiteral = AO;\r\n\r\n    } else if(type === 'audioMP3' && options?.path && options?.name) {\r\n      if(nodeFactories[type]) spec = nodeFactories[type](id, x, y, options);\r\n    } else {\r\n      if(nodeFactories[type]) spec = nodeFactories[type](id, x, y);\r\n    }\r\n\r\n    if(spec && spec.fields && options) {\r\n      for(const f of spec.fields) {\r\n        if(options[f.key] !== undefined) {\r\n          f.value = options[f.key];\r\n        }\r\n      }\r\n    }\r\n\r\n    // TEST\r\n    // const catalog = generateAICatalog(nodeFactories);\r\n    // const systemCatalogText = catalogToText(catalog);\r\n    // console.log(systemCatalogText);\r\n    // localStorage.setItem('systemCatalogText', systemCatalogText);\r\n    // TEST\r\n\r\n    if(spec) {\r\n      const dom = this.createNodeDOM(spec);\r\n      this.board.appendChild(dom);\r\n      this.nodes[id] = spec;\r\n      return id;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  setVariable(type, key, value) {\r\n    if(!this.variables[type][key]) return;\r\n\r\n    this.variables[type][key].value = value;\r\n    this.notifyVariableChanged(type, key);\r\n  }\r\n\r\n  updateArrayNode(node, newValue) {\r\n    if(!Array.isArray(newValue)) {\r\n      console.warn(\"Value must be an array\");\r\n      return;\r\n    }\r\n\r\n    const field = node.fields.find(f => f.key === \"array\");\r\n    if(field) {\r\n      field.value = newValue;\r\n      node._returnCache = newValue;\r\n    }\r\n  }\r\n\r\n  initEventNodes() {\r\n    for(const nodeId in this.nodes) {\r\n      const n = this.nodes[nodeId];\r\n      if(n.category === \"event\") {\r\n        // console.log('ACTIVATRE NODE ', n.title)\r\n        this.activateEventNode(nodeId);\r\n      }\r\n    }\r\n  }\r\n\r\n  adaptSubObjectPins(node, obj) {\r\n    // \uD83D\uDEAB DO NOTHING if no valid object\r\n    if(!obj || typeof obj !== \"object\") return;\r\n    node.outputs = node.outputs.filter(p => p.type === \"action\");\r\n    if(obj && typeof obj === \"object\") {\r\n      for(const key of Object.keys(obj)) {\r\n        node.outputs.push({\r\n          name: key,\r\n          type: this.detectType(obj[key]),\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  detectType(val) {\r\n    if(typeof val === \"number\") return \"number\";\r\n    if(typeof val === \"boolean\") return \"boolean\";\r\n    if(typeof val === \"string\") return \"string\";\r\n    if(typeof val === \"object\") return \"object\";\r\n    return \"any\";\r\n  }\r\n\r\n  createFieldInput(node, field) {\r\n    const input = document.createElement(\"input\");\r\n    input.type = \"text\";\r\n    input.value = field.value ?? \"\";\r\n    input.placeholder = field.placeholder ?? \"\";\r\n    input.disabled = field.readonly === true;\r\n\r\n    if(field.readonly) {\r\n      input.style.opacity = \"0.7\";\r\n      input.style.cursor = \"default\";\r\n    }\r\n\r\n    const saveInputValue = () => {\r\n      let val;\r\n      if(field.type === \"object\") {\r\n        try {\r\n          val = JSON.parse(input.value);\r\n        } catch {\r\n          return;\r\n        }\r\n      } else {\r\n        val = input.value;\r\n      }\r\n\r\n      field.value = val;\r\n\r\n      // existing logic stays\r\n      if(node.isGetterNode && field.key === \"var\") {\r\n        this.notifyVariableChanged(\"object\", val);\r\n      }\r\n\r\n      // ? not tested in last ver\r\n      document.dispatchEvent(\r\n        new CustomEvent(\"fluxcodex.field.change\", {\r\n          detail: {\r\n            nodeId: node.id,\r\n            nodeType: node.type,\r\n            fieldKey: field.key,\r\n            fieldType: field.type,\r\n            value: field.value,\r\n          },\r\n        })\r\n      );\r\n    };\r\n\r\n    input.onkeydown = e => {\r\n      if(e.key === \"Enter\") {\r\n        e.preventDefault();\r\n        saveInputValue();\r\n      }\r\n    };\r\n\r\n    input.onblur = () => saveInputValue();\r\n\r\n    if(node.title === \"Get Sub Object\" && field.key === \"path\") {\r\n      input.oninput = () => {\r\n        const link = this.getConnectedSource(node.id, \"object\");\r\n        if(!link?.node?.isGetterNode) {\r\n\r\n\r\n          if(link.node.title == \"Get Sub Object\") {\r\n            console.log('special sub sub test ', link.node.title)\r\n            let target = this.resolvePath(link.node._returnCache, link.pin);\r\n            node.outputs = node.outputs.filter(p => p.type === \"action\"); // clear old object pins\r\n            if(target && typeof target === \"object\") {\r\n              for(const k in target) {\r\n                node.outputs.push({\r\n                  name: k,\r\n                  type: this.detectType(target[k]),\r\n                });\r\n              }\r\n            }\r\n          }\r\n          if(link.node.title == \"Get Scene Animation\") {\r\n            console.log('special test ', link.node.title)\r\n\r\n            const varField = link.node.fields?.find(f => f.key === \"selectedObject\");\r\n            console.log('special test ', varField)\r\n\r\n            // pin: \"glb.glbJsonData.animations\"\r\n\r\n            if(link.pin.indexOf('.') != -1) {\r\n              let target = this.resolvePath(app.getSceneObjectByName(varField.value), link.pin);\r\n              console.log('special test target ', target)\r\n              link.node._subCache = target;\r\n\r\n              node.outputs = node.outputs.filter(p => p.type === \"action\"); // clear old object pins\r\n              if(target && typeof target === \"object\") {\r\n                for(const k in target) {\r\n                  node.outputs.push({\r\n                    name: k,\r\n                    type: this.detectType(target[k]),\r\n                  });\r\n                }\r\n              }\r\n\r\n              node._needsRebuild = false;\r\n              node._pinsBuilt = true;\r\n              this.updateNodeDOM(node.id);\r\n            }\r\n            console.log('special test :::: ', link.node.accessObject[varField.value])\r\n            // this.getValue(link.node.id, \"\")\r\n          }\r\n          return;\r\n\r\n        }\r\n\r\n        const varField = link.node.fields?.find(f => f.key === \"var\");\r\n        const varName = varField?.value;\r\n        const rootObj = this.variables?.object?.[varName];\r\n\r\n        const path = input.value;\r\n        const target = this.resolvePath(rootObj, path);\r\n        node._subCache = {};\r\n        node._subCache = target;\r\n        node.outputs = node.outputs.filter(p => p.type === \"action\"); // clear old object pins\r\n        if(target && typeof target === \"object\") {\r\n          for(const k in target) {\r\n            node.outputs.push({\r\n              name: k,\r\n              type: this.detectType(target[k]),\r\n            });\r\n          }\r\n        }\r\n\r\n        node._needsRebuild = false;\r\n        node._pinsBuilt = true;\r\n        this.updateNodeDOM(node.id);\r\n      };\r\n    }\r\n\r\n    return input;\r\n  }\r\n\r\n  resolvePath(obj, path) {\r\n    if(!obj || !path) return obj;\r\n    const parts = path.split(\".\").filter(p => p.length);\r\n    let current = obj;\r\n    for(const part of parts) {\r\n      if(current && typeof current === \"object\" && part in current) {\r\n        current = current[part];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n    return current;\r\n  }\r\n\r\n  resolveAccessObject(accessObject, objectName) {\r\n    if(!accessObject) return null;\r\n    if(Array.isArray(accessObject)) {\r\n      return accessObject.find(o => o.name === objectName) || null;\r\n    }\r\n    if(typeof accessObject === \"object\") {\r\n      return accessObject[objectName] || null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  adaptNodeToAccessMethod(node, objectName, methodName) {\r\n    const obj = this.accessObject.find(o => o.name === objectName);\r\n    if(!obj) return;\r\n\r\n    const method = obj[methodName];\r\n    if(typeof method !== \"function\") return;\r\n\r\n    const args = this.getArgNames(method);\r\n\r\n    node.inputs = [{name: \"exec\", type: \"action\"}];\r\n    node.outputs = [{name: \"execOut\", type: \"action\"}];\r\n\r\n    args.forEach(arg => node.inputs.push({name: arg, type: \"value\"}));\r\n\r\n    if(this.hasReturn(method)) {\r\n      node.outputs.push({name: \"return\", type: \"value\"});\r\n    }\r\n\r\n    node._access = {objectName, methodName};\r\n    this.updateNodeDOM(node.id);\r\n  }\r\n\r\n  activateEventNode(nodeId) {\r\n    const n = this.nodes[nodeId];\r\n    if(n.title === \"On Target Position Reach\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(!pos) return;\r\n      pos.onTargetPositionReach = () => {\r\n        this.enqueueOutputs(n, \"exec\");\r\n      };\r\n      n._listenerAttached = true;\r\n    } else if(n.title == \"On Ray Hit\") {\r\n      // console.log('ON RAY HIT INIT ONLE !!!!!!!!!!!!!!!!!')\r\n      if(n._listenerAttached) return;\r\n      app.reference.addRaycastsListener();\r\n      const handler = (e) => {\r\n        n._returnCache = e.detail;\r\n        this.enqueueOutputs(n, \"exec\");\r\n      };\r\n      app.canvas.addEventListener(\"ray.hit.event\", handler);\r\n      n._eventHandler = handler;\r\n      n._listenerAttached = true;\r\n      return;\r\n    } else if(n.title == \"On Draw\") {\r\n      // console.log('ON DRAW INIT ONLE !!!!!', n.fields.find(f => f.key === \"skip\")?.value);\r\n      if(n._listenerAttached) return;\r\n      let skip = n.fields.find(f => f.key === \"skip\")?.value;\r\n      if(typeof n._frameCounter === \"undefined\") {n._frameCounter = 0;}\r\n      const graph = this;\r\n      app.graphUpdate = function(delta) {\r\n        n._frameCounter++;\r\n        if(skip > 0 && n._frameCounter < skip) return;\r\n        n._frameCounter = 0;\r\n        // console.info('.....', delta)\r\n        n._returnCache = delta;\r\n        graph.enqueueOutputs(n, \"exec\");\r\n      };\r\n      n._listenerAttached = true;\r\n      return;\r\n    } else if(n.title == \"On Key\") {\r\n      if(n._listenerAttached) return;\r\n      const graph = this;\r\n      n._isHeld = false;\r\n      window.addEventListener(\"keydown\", (e) => {\r\n        n.lastKey = e.key;\r\n        graph.enqueueOutputs(n, \"anyKeyDown\");\r\n        if(e.ctrlKey == true) graph.enqueueOutputs(n, \"ctrl\");\r\n        if(e.altKey == true) graph.enqueueOutputs(n, \"alt\");\r\n        if(e.shiftKey == true) graph.enqueueOutputs(n, \"shift\");\r\n        const keyValue = n.fields.find(f => f.key === \"key\")?.value;\r\n        if(!keyValue) return;\r\n        if(e.key.toLowerCase() === keyValue.toLowerCase()) {\r\n          // node._pressed = true;\r\n          n._isHeld = true;\r\n          graph.enqueueOutputs(n, \"keyDown\");\r\n        }\r\n      });\r\n      window.addEventListener(\"keyup\", (e) => {\r\n\r\n        console.log('ON e.shiftKey !!!!!', e.shiftKey);\r\n        console.log('ON e.altKey !!!!!', e.altKey);\r\n        console.log('ON e.ctrltKey !!!!!', e.ctrlKey);\r\n\r\n        const keyValue = n.fields.find(f => f.key === \"key\")?.value;\r\n        if(!keyValue) return;\r\n        if(e.key.toLowerCase() === keyValue.toLowerCase()) {\r\n          // node._pressed = true;\r\n          n._isHeld = false;\r\n          graph.enqueueOutputs(n, \"keyUp\");\r\n        }\r\n      });\r\n      window.addEventListener(\"blur\", () => {\r\n        if(n._isHeld) {\r\n          n._isHeld = false;\r\n          graph.enqueueOutputs(n, \"keyUp\");\r\n        }\r\n      });\r\n      n._listenerAttached = true;\r\n    }\r\n  }\r\n\r\n  _executeAttachedMethod(n) {\r\n    if(n.attachedMethod) {\r\n      const method = this.methodsManager.methodsContainer.find(\r\n        m => m.name === n.attachedMethod\r\n      );\r\n      if(method) {\r\n        const fn = this.methodsManager.compileFunction(method.code);\r\n        const args = this.getArgNames(fn).map(argName =>\r\n          this.getValue(n.id, argName)\r\n        );\r\n        let result;\r\n        try {\r\n          result = fn(...args);\r\n        } catch(err) {\r\n          console.error(\"User method error:\", err);\r\n        }\r\n        if(this.hasReturn(fn)) n._returnCache = result;\r\n      }\r\n    }\r\n  }\r\n\r\n  getValue(nodeId, pinName, visited = new Set()) {\r\n    const node = this.nodes[nodeId];\r\n    if(visited.has(nodeId + \":\" + pinName)) {\r\n      return undefined;\r\n    }\r\n    if(!node || visited.has(nodeId)) return undefined;\r\n    visited.add(nodeId);\r\n\r\n    if(node.title === \"Function\" && pinName === \"reference\") {\r\n      if(typeof node.fn === 'undefined') {\r\n        const selected = this.methodsManager.methodsContainer.find(m => m.name === node.attachedMethod);\r\n        if(selected) {\r\n          node.fn = this.methodsManager.compileFunction(selected.code);\r\n        } else {\r\n          console.warn('Node: Function PinName: reference [reference not found at methodsContainer]')\r\n        }\r\n      }\r\n      return node.fn;\r\n    }\r\n\r\n    if(node.title === \"On Draw\") if(pinName == \"delta\") return node._returnCache;\r\n    if(node.title === \"On Key\" && pinName == \"isHeld\") return node._isHeld;\r\n    if(node.title === \"On Key\" && pinName == \"keyCode\") return node.lastKey;\r\n    if(node.title === \"Generator Pyramid\" && pinName == \"objectNames\") return node._returnCache;\r\n\r\n    if(node.title === \"Audio Reactive Node\") {\r\n      if(pinName === \"low\") {\r\n        return node._returnCache[0]\r\n      } else if(pinName === \"mid\") {\r\n        return node._returnCache[1]\r\n      } else if(pinName === \"high\") {\r\n        return node._returnCache[2]\r\n      } else if(pinName === \"energy\") {\r\n        return node._returnCache[3]\r\n      } else if(pinName === \"beat\") {\r\n        return node._returnCache[4]\r\n      }\r\n    }\r\n\r\n    if(node.title === \"Oscillator\" && pinName == \"value\") {\r\n      return node._returnCache;\r\n    }\r\n\r\n    if(node.title === \"On Ray Hit\") {\r\n      if(pinName === \"hitObjectName\") {\r\n        return node._returnCache['hitObject']['name'];\r\n      } else {\r\n        return node._returnCache[pinName];\r\n      }\r\n    }\r\n\r\n    if(node.title === \"if\" && pinName === \"condition\") {\r\n      let testLink = this.links.find(l => l.to.node === nodeId && l.to.pin === pinName);\r\n      let t;\r\n      try {\r\n        t = this.getValue(testLink.from.node, testLink.from.pin);\r\n      } catch(err) {\r\n        console.log(`IF NODE ${node.id} have no conditional pin connected - default is false... fix this in FluxCodexVertex graph editor.`)\r\n        return false;\r\n      }\r\n      if(typeof t !== 'undefined') {\r\n        return t;\r\n      }\r\n      if(this._execContext !== nodeId) {\r\n        console.warn(\"[IF] condition read outside exec ignored\");\r\n        return node.fields?.find(f => f.key === \"condition\")?.value;\r\n      }\r\n      // ?\r\n    }\r\n\r\n    if(node.title === \"Custom Event\" && pinName === \"detail\") {\r\n      console.warn(\"[Custom Event]  getvalue\");\r\n      return node._returnCache;\r\n    }\r\n    if(node.title === \"Dispatch Event\" && (pinName === 'eventName' || pinName === 'detail')) {\r\n      let testLink = this.links.find(l => l.to.node === nodeId && l.to.pin === pinName);\r\n      return this.getValue(testLink.from.node, testLink.from.pin);\r\n    }\r\n\r\n    if(node.isGetterNode) {\r\n      if(node._returnCache === undefined) {\r\n        this.triggerNode(node.id);\r\n      }\r\n      let value = node._returnCache;\r\n      // Optional: parse string to array\r\n      if(typeof value === \"string\") {\r\n        try {\r\n          if(node.title == \"Get String\") {\r\n            // value = JSON.parse(value);\r\n          } else {\r\n            value = JSON.parse(value);\r\n          }\r\n        } catch(e) {\r\n          console.warn('[getValue][json parse err]:', e);\r\n        }\r\n      }\r\n      return value;\r\n    }\r\n\r\n    const link = this.links.find(l => l.to.node === nodeId && l.to.pin === pinName);\r\n    if(link) return this.getValue(link.from.node, link.from.pin, visited);\r\n\r\n    const field = node.fields?.find(f => f.key === pinName);\r\n    if(field) return field.value;\r\n\r\n    const inputPin = node.inputs?.find(p => p.name === pinName);\r\n    if(inputPin) return inputPin.default ?? 0;\r\n\r\n    if(node.title === \"Get Scene Object\" || node.title === \"Get Scene Animation\" || node.title === \"Get Scene Light\") {\r\n      const objName = this._getSceneSelectedName(node);\r\n      if(!objName) return undefined;\r\n      //repopulate\r\n      const dom = this.board.querySelector(`[data-id=\"${nodeId}\"]`);\r\n      const selects = dom.querySelectorAll(\"select\"); // returns NodeList\r\n      let select = selects[0];\r\n      select.innerHTML = ``;\r\n      if(select) {\r\n        node.accessObject.forEach(obj => {\r\n          const opt = document.createElement(\"option\");\r\n          opt.value = obj.name;\r\n          opt.textContent = obj.name;\r\n          select.appendChild(opt);\r\n        });\r\n      }\r\n      if(node.fields[0].value) select.value = node.fields[0].value;\r\n      const obj = (node.accessObject || []).find(o => o.name === objName);\r\n      if(!obj) return undefined;\r\n      const out = node.outputs.find(o => o.name === pinName);\r\n      if(!out) return undefined;\r\n      if(pinName.indexOf('.') != -1) {\r\n        return this.resolvePath(obj, pinName);\r\n      }\r\n      return obj[pinName];\r\n    } else if(node.title === \"Get Position\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(!pos) return undefined;\r\n      node._returnCache = {\r\n        x: pos.x,\r\n        y: pos.y,\r\n        z: pos.z,\r\n      };\r\n      return node._returnCache[pinName];\r\n    } else if(node.title === \"Get Sub Object\") {\r\n\r\n      let varField = node.outputs?.find(f => f.name === \"0\");\r\n      let isName = node.outputs?.find(f => f.name === \"name\");\r\n      // console.log('test1 :::', varField)\r\n      if(varField) if(varField.type == 'object') {\r\n        return node._subCache[parseInt(varField.name)]\r\n      }\r\n      // console.log('test2 :::', isName);\r\n      return node._subCache;\r\n    } else if(node.type === \"forEach\") {\r\n      if(pinName === \"item\") return node.state?.item;\r\n      if(pinName === \"index\") return node.state?.index;\r\n    }\r\n\r\n    // console.log(\"GETVALUE COMPARE!\")\r\n    if([\"math\", \"value\", \"compare\", \"stringOperation\"].includes(node.category)) {\r\n      let result;\r\n      switch(node.title) {\r\n        case \"Starts With [string]\":\r\n          console.log('test startsWith');\r\n          result = this.getValue(nodeId, \"input\").startsWith(this.getValue(nodeId, \"prefix\"));\r\n          break;\r\n        case \"Ends With [string]\":\r\n          result = this.getValue(nodeId, \"input\")\r\n            ?.endsWith(this.getValue(nodeId, \"suffix\"));\r\n          break;\r\n        case \"Includes [string]\":\r\n          result = this.getValue(nodeId, \"input\")\r\n            ?.includes(this.getValue(nodeId, \"search\"));\r\n          break;\r\n        case \"Equals [string]\":\r\n          result = this.getValue(nodeId, \"a\") === this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Not Equals [string]\":\r\n          result = this.getValue(nodeId, \"a\") !== this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"To Upper Case [string]\":\r\n          result = this.getValue(nodeId, \"input\")?.toUpperCase();\r\n          break;\r\n        case \"To Lower Case [string]\":\r\n          result = this.getValue(nodeId, \"input\")?.toLowerCase();\r\n          break;\r\n        case \"Trim [string]\":\r\n          result = this.getValue(nodeId, \"input\")?.trim();\r\n          break;\r\n        case \"String Length\":\r\n          result = this.getValue(nodeId, \"input\")?.length ?? 0;\r\n          break;\r\n        case \"Substring [string]\":\r\n          result = this.getValue(nodeId, \"input\")\r\n            ?.substring(\r\n              this.getValue(nodeId, \"start\"),\r\n              this.getValue(nodeId, \"end\")\r\n            );\r\n          break;\r\n        case \"Replace [string]\":\r\n          result = this.getValue(nodeId, \"input\")\r\n            ?.replace(\r\n              this.getValue(nodeId, \"search\"),\r\n              this.getValue(nodeId, \"replace\")\r\n            );\r\n          break;\r\n        case \"Split [string]\":\r\n          result = this.getValue(nodeId, \"input\")\r\n            ?.split(this.getValue(nodeId, \"separator\"));\r\n          break;\r\n        case \"Concat [string]\":\r\n          result =\r\n            (this.getValue(nodeId, \"a\") ?? \"\") +\r\n            (this.getValue(nodeId, \"b\") ?? \"\");\r\n          break;\r\n        case \"Is Empty [string]\":\r\n          result = !this.getValue(nodeId, \"input\") ||\r\n            this.getValue(nodeId, \"input\").length === 0;\r\n          break;\r\n\r\n        case \"Add\":\r\n          result = this.getValue(nodeId, \"a\") + this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Sub\":\r\n          result = this.getValue(nodeId, \"a\") - this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Mul\":\r\n          result = this.getValue(nodeId, \"a\") * this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Div\":\r\n          result = this.getValue(nodeId, \"a\") / this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Sin\":\r\n          result = Math.sin(this.getValue(nodeId, \"a\"));\r\n          break;\r\n        case \"Cos\":\r\n          result = Math.cos(this.getValue(nodeId, \"a\"));\r\n          break;\r\n        case \"Pi\":\r\n          result = Math.PI;\r\n          break;\r\n        case \"A > B\":\r\n          result = this.getValue(nodeId, \"A\") > this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"A < B\":\r\n          result = this.getValue(nodeId, \"A\") < this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"A == B\":\r\n          let varA = this.getValue(nodeId, \"A\");\r\n          let varB = this.getValue(nodeId, \"B\");\r\n          if(typeof varA == \"object\") {\r\n            const r = this.deepEqual(varA, varB);\r\n            result = r;\r\n          } else {\r\n            result = this.getValue(nodeId, \"A\") != this.getValue(nodeId, \"B\");\r\n          }\r\n          break;\r\n        case \"A != B\":\r\n          let varAN = this.getValue(nodeId, \"A\");\r\n          let varBN = this.getValue(nodeId, \"B\");\r\n          if(typeof varAN == \"object\") {\r\n            const r = this.deepEqual(varAN, varBN);\r\n            result = !r;\r\n          } else {\r\n            result = this.getValue(nodeId, \"A\") != this.getValue(nodeId, \"B\");\r\n          }\r\n          break;\r\n        case \"A >= B\":\r\n          result = this.getValue(nodeId, \"A\") >= this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"A <= B\":\r\n          result = this.getValue(nodeId, \"A\") <= this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"GenRandInt\":\r\n          const min = + node.fields?.find(f => f.key === \"min\")?.value || 0;\r\n          const max = + node.fields?.find(f => f.key === \"max\")?.value || 10;\r\n          result = Math.floor(Math.random() * (max - min + 1)) + min;\r\n          break;\r\n        default:\r\n          result = undefined;\r\n      }\r\n\r\n      node._returnCache = result;\r\n      if(node.displayEl) node.displayEl.textContent = typeof result === \"number\" ? result.toFixed(3) : String(result);\r\n      return result;\r\n    }\r\n\r\n    if(node.outputs?.some(o => o.name === pinName)) {\r\n      const dynamicNodes = [\"GenRandInt\", \"RandomFloat\"];\r\n      if((node._returnCache === undefined || dynamicNodes.includes(node.title)) && !node.noselfExec) {\r\n        this._execContext = nodeId;\r\n        this.triggerNode(nodeId);\r\n        this._execContext = null;\r\n      }\r\n      return node._returnCache;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  updateValueDisplays() {\r\n    for(const id in this.nodes) {\r\n      const node = this.nodes[id];\r\n      if(!node.displayEl) continue;\r\n      if(node.title === \"Print\") {\r\n        const pin = node.inputs?.[0];\r\n        if(!pin) continue;\r\n        const val = this.getValue(node.id, pin.name);\r\n        if(val === undefined) {\r\n          node.displayEl.textContent = \"undefined\";\r\n        } else if(typeof val === \"object\") {\r\n          node.displayEl.textContent = JSON.stringify(val, null, 2);\r\n        } else if(typeof val === \"number\") {\r\n          node.displayEl.textContent = val.toFixed(3);\r\n        } else {\r\n          node.displayEl.textContent = String(val);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  extractArgs(code) {\r\n    const match = code.match(/function\\s+[^(]*\\(([^)]*)\\)/);\r\n    if(!match) return [];\r\n    return match[1].split(\",\").map(a => a.trim()).filter(Boolean);\r\n  }\r\n\r\n  adaptDynamicFunction(node, fnName) {\r\n    console.log('adaptDynamicFunction(node, fnName) ')\r\n    const fn = node.accessObject?.[fnName];\r\n    if(typeof fn !== \"function\") return;\r\n    node.inputs = [{name: \"exec\", type: \"action\"}];\r\n    node.outputs = [{name: \"execOut\", type: \"action\"}];\r\n    // args \u2192 inputs read\r\n    const args = this.getArgNames(fn);\r\n    args.forEach(arg => {\r\n      node.inputs.push({name: arg, type: \"any\"});\r\n    });\r\n    if(this.hasReturn(fn)) {\r\n      node.outputs.push({name: \"return\", type: \"value\"});\r\n    }\r\n    node.category = \"functions\";\r\n    node.fn = fn; // REAL FUNCTION\r\n    node.fnName = fnName;\r\n    node.descFunc = fnName;\r\n    // node.title = fnName;\r\n    this.updateNodeDOM(node.id);\r\n  }\r\n\r\n  invalidateVariableGetters(type, varName) {\r\n    for(const id in this.nodes) {\r\n      const n = this.nodes[id];\r\n      if(n.category === \"value\" &&\r\n        n.fields?.some(f => f.key === \"var\" && f.value === varName) &&\r\n        n.title === `Get ${type[0].toUpperCase() + type.slice(1)}`) {\r\n        delete n._returnCache;\r\n      }\r\n    }\r\n  }\r\n\r\n  deepEqual(a, b) {\r\n    if(a === b) return true;\r\n    if(typeof a !== \"object\" || typeof b !== \"object\" || a == null || b == null)\r\n      return false;\r\n    const keysA = Object.keys(a);\r\n    const keysB = Object.keys(b);\r\n    if(keysA.length !== keysB.length) return false;\r\n    for(const key of keysA) {\r\n      if(!keysB.includes(key)) return false;\r\n      if(!this.deepEqual(a[key], b[key])) return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  triggerNode(nodeId) {\r\n    const n = this.nodes[nodeId];\r\n    if(!n) return;\r\n    this._execContext = nodeId;\r\n    // Highlight node header\r\n    const highlight = document.querySelector(`.node[data-id=\"${nodeId}\"] .header`);\r\n    if(highlight) {\r\n      highlight.style.filter = \"brightness(1.5)\";\r\n      setTimeout(() => (highlight.style.filter = \"none\"), 200);\r\n    }\r\n\r\n    if(n.title === \"Get Sub Object\") {\r\n      const obj = this.getValue(n.id, \"object\");\r\n      let path = n.fields.find(f => f.key === \"path\")?.value;\r\n      let target = this.resolvePath(obj, path);\r\n\r\n      if(target === undefined) {\r\n        // probably no prefix .value \r\n        path = path.replace('value.', '');\r\n        target = this.resolvePath(obj, path);\r\n      }\r\n      console.warn('SET CACHE target is ', target)\r\n      // n.outputs = n.outputs.filter(p => p.type === \"action\");\r\n      n._subCache = target;\r\n      n._returnCache = target;\r\n      n._needsRebuild = false;\r\n      n._pinsBuilt = true;\r\n\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.type === \"forEach\") {\r\n      let arr;\r\n      const link = this.links.find(l => l.to.node === n.id);\r\n      if(link) arr = this.getValue(link.from.node, link.from.pin);\r\n      // Fallback to literal\r\n      if(arr === undefined) {\r\n        const inputPin = n.inputs?.find(p => p.name === \"array\");\r\n        arr = inputPin?.default;\r\n      }\r\n\r\n      if(typeof arr === \"string\") {\r\n        try {\r\n          arr = JSON.parse(arr);\r\n        } catch(e) {\r\n          console.warn(\"Failed to parse array string\", arr);\r\n          arr = [];\r\n        }\r\n      }\r\n      if(!Array.isArray(arr)) return;\r\n      arr.forEach((item, index) => {\r\n        // update node runtime state!\r\n        n.state = {item, index};\r\n        this.links.filter(l => l.type === \"action\" && l.from.node === n.id && l.from.pin === \"loop\").forEach(l => {\r\n          this.triggerNode(l.to.node);\r\n        });\r\n      });\r\n      // completed pin (once)\r\n      this.links.filter(l => l.type === \"action\" && l.from.node === n.id && l.from.pin === \"completed\")\r\n        .forEach(l => {this.triggerNode(l.to.node)});\r\n    } else if(n.title === \"Get Array\") {\r\n      let arr;\r\n      // Find input link BAd but ok for now\r\n      const link = this.links.find(l =>\r\n        l.to.node === n.id && (l.to.pin === \"array\" ||\r\n          l.to.pin === \"result\" || l.to.pin === \"value\")\r\n      );\r\n\r\n      if(link) {\r\n        const fromNode = this.nodes[link.from.node];\r\n        if(fromNode._returnCache === undefined && fromNode._subCache === undefined) {\r\n          // this.triggerNode(fromNode.id);\r\n        }\r\n        if(fromNode._returnCache) arr = fromNode._returnCache;\r\n        if(fromNode._subCache) arr = fromNode._subCache;\r\n\r\n      } else {\r\n        // fallback to default literal\r\n        arr = n.inputs?.find(p => p.name === \"array\")?.default ?? [];\r\n      }\r\n      // make it fluid \r\n      n._returnCache = Array.isArray(arr) ? arr : arr ? arr[link.from.pin] :\r\n        this.getValue(link.from.node, link.from.pin);\r\n\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"reffunctions\") {\r\n      const fn = n._fnRef;\r\n      if(typeof fn !== \"function\") {\r\n        console.warn(\"[reffunctions] No function reference\");\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      }\r\n\r\n      // Collect REAL args (exclude exec + reference)\r\n      const args = n.inputs\r\n        .filter(p => p.type !== \"action\" && p.name !== \"reference\")\r\n        .map(p => this.getValue(n.id, p.name));\r\n\r\n      const result = fn(...args);\r\n\r\n      if(this.hasReturn(fn)) {\r\n        n._returnCache = result;\r\n      }\r\n\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Custom Event\") {\r\n      console.log('********************************')\r\n      // if(n._listenerAttached === true) return;\r\n\r\n      const eventName = n.fields?.find(f => f.key === \"name\")?.value;\r\n      if(!eventName) return;\r\n      const handler = (e) => {\r\n        console.log('**TRUE** HANDLER**');\r\n        n._returnCache = e.detail;\r\n        this.enqueueOutputs(n, \"exec\");\r\n      };\r\n      console.log('**eventName**', eventName)\r\n      window.removeEventListener(eventName, handler);\r\n      window.addEventListener(eventName, handler);\r\n      n._eventHandler = handler;\r\n      n._listenerAttached = true;\r\n      return;\r\n    } else if(n.title === \"Dispatch Event\") {\r\n      const name = this.getValue(nodeId, \"eventName\");\r\n      if(!name) {\r\n        console.warn(\"[Dispatch] missing eventName\");\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      }\r\n      const detail = this.getValue(nodeId, \"detail\");\r\n      console.log('*************window.dispatchEvent****************', name)\r\n      window.dispatchEvent(\r\n        new CustomEvent(name, {\r\n          detail: detail ?? {}\r\n        })\r\n      );\r\n\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"On Ray Hit\") {\r\n      console.log('On Ray Hit =NOTHING NOW', n._listenerAttached)\r\n    }\r\n\r\n    if(n.isGetterNode) {\r\n      const varField = n.fields?.find(f => f.key === \"var\");\r\n      if(varField && varField.value) {\r\n        const type = n.title.replace(\"Get \", \"\").toLowerCase();\r\n        const value = this.getVariable(type, varField.value);\r\n        n._returnCache = value;\r\n        // Update visual label if exists\r\n        if(n.displayEl) {\r\n          if(type === \"object\") {\r\n            n.displayEl.textContent =\r\n              value !== undefined ? JSON.stringify(value) : \"{}\";\r\n          } else if(typeof value === \"number\") {\r\n            n.displayEl.textContent = value.toFixed(3);\r\n          } else {\r\n            n.displayEl.textContent = String(value);\r\n          }\r\n        }\r\n      }\r\n      n.finished = true;\r\n      return;\r\n    }\r\n\r\n    if(n.title === \"On Target Position Reach\") {\r\n\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      console.info(\"On Target Position Reach \", pos);\r\n      if(!pos) return;\r\n      // Attach listener (engine-agnostic)\r\n      pos.onTargetPositionReach = () => {\r\n        this.triggerNode(n);\r\n        this.enqueueOutputs(n, \"exec\");\r\n      };\r\n      n._listenerAttached = true;\r\n      return;\r\n    }\r\n\r\n    // functionDinamic execution\r\n    if(n.category === \"functions\") {\r\n      // bloomPass is created in post time - make always update\r\n      n.accessObject = eval(n.accessObjectLiteral);\r\n      if(n.fn === undefined) {\r\n        n.fn = n.accessObject[n.fnName]\r\n      }\r\n\r\n      const args = n.inputs\r\n        .filter(p => p.type !== \"action\")\r\n        .map(p => this.getValue(n.id, p.name));\r\n      const result = n.fn(...args);\r\n      if(this.hasReturn(n.fn)) {\r\n        n._returnCache = result;\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    }\r\n\r\n    if(n.category === \"event\" && typeof n.noselfExec === 'undefined') {\r\n      console.info(`%c<EMPTY EXEC>: ${n.title}`, LOG_FUNNY_ARCADE);\r\n      this.enqueueOutputs(n, \"exec\");\r\n      return;\r\n    }\r\n\r\n    if(n.category === \"event\" && typeof n.noselfExec != 'undefined') {\r\n      console.log('<PREVENT SELF EXEC>')\r\n      return;\r\n    }\r\n\r\n    if(n.isVariableNode) {\r\n      const type = n.title.replace(\"Set \", \"\").toLowerCase();\r\n      const varField = n.fields?.find(f => f.key === \"var\");\r\n\r\n      if(varField && varField.value) {\r\n\r\n        let value = this.getValue(nodeId, \"value\");\r\n        // if 0 probably no pin connection\r\n        if(n.title == \"Set Object\") {\r\n          if(value == 0) {\r\n            let varliteral = n.fields?.find(f => f.key === \"literal\");\r\n            // console.log(\"set object  varliteral.value \", varliteral.value);\r\n            this.variables[type][varField.value] = JSON.parse(varliteral.value);\r\n            // ??\r\n          }\r\n        } else {\r\n          if(value == 0) {\r\n            let varliteral = n.fields?.find(f => f.key === \"literal\");\r\n            // console.log(\"set object  varliteral.value \", varliteral.value);\r\n            this.variables[type][varField.value] = JSON.parse(varliteral.value);\r\n            value = JSON.parse(varliteral.value);\r\n          } else {\r\n            console.log(\"set object \", value);\r\n            this.variables[type][varField.value] = {value};\r\n          }\r\n\r\n        }\r\n\r\n        this.notifyVariableChanged(type, varField.value);\r\n        // Update matching getter nodes instantly\r\n        for(const nodeId2 in this.nodes) {\r\n          const node2 = this.nodes[nodeId2];\r\n          if(node2.isGetterNode) {\r\n            const vf2 = node2.fields?.find(f => f.key === \"var\");\r\n            if(vf2 && vf2.value === varField.value && node2.displayEl) {\r\n              if(type === \"object\") {\r\n                node2.displayEl.textContent = JSON.stringify(value);\r\n              } else {\r\n                node2.displayEl.textContent =\r\n                  typeof value === \"number\" ? value.toFixed(3) : String(value);\r\n              }\r\n              node2._returnCache = value;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      n.finished = true;\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    }\r\n\r\n    if(n.title === \"Fetch\") {\r\n      const url = this.getValue(nodeId, \"url\");\r\n      if(!url) {\r\n        console.warn(\"[Fetch] URL missing\");\r\n        this.enqueueOutputs(n, \"error\");\r\n        return;\r\n      }\r\n\r\n      const method = this.getValue(nodeId, \"method\") || \"GET\";\r\n      const body = this.getValue(nodeId, \"body\");\r\n      const headers = this.getValue(nodeId, \"headers\") || {};\r\n      const options = {method, headers};\r\n\r\n      if(body && method !== \"GET\") {\r\n        options.body = typeof body === \"string\" ? body : JSON.stringify(body);\r\n\r\n        if(!headers[\"Content-Type\"]) {\r\n          headers[\"Content-Type\"] = \"application/json\";\r\n        }\r\n      }\r\n\r\n      fetch(url, options)\r\n        .then(async res => {\r\n          n._returnCache = {\r\n            response: await res.json().catch(() => null),\r\n            status: res.status,\r\n          };\r\n          this.enqueueOutputs(n, \"execOut\");\r\n        })\r\n        .catch(err => {\r\n          console.error(\"[Fetch]\", err);\r\n          this.enqueueOutputs(n, \"error\");\r\n        });\r\n      return;\r\n    }\r\n\r\n    // Action / Print / Timer Nodes\r\n    if([\"action\", \"actionprint\", \"timer\"].includes(n.category)) {\r\n      // only for custom functions from managerfunction\r\n      if(n.attachedMethod) this._executeAttachedMethod(n);\r\n\r\n      if(n.title === \"Print\") {\r\n        const label = n.fields?.find(f => f.key === \"label\")?.value || \"Print:\";\r\n        let val;\r\n\r\n        const link = this.getConnectedSource(nodeId, \"value\");\r\n        if(link) {\r\n          const fromNode = link.node;\r\n          const fromPin = link.pin;\r\n          if(\r\n            fromNode._subCache &&\r\n            typeof fromNode._subCache === \"object\" &&\r\n            fromPin in fromNode._subCache\r\n          ) {\r\n            val = fromNode._subCache[fromPin];\r\n          } else {\r\n            val = this.getValue(fromNode.id, fromPin);\r\n          }\r\n        } else {\r\n          val = this.getValue(nodeId, \"value\");\r\n        }\r\n\r\n        if(n.displayEl) {\r\n          if(typeof val === \"object\") {\r\n            n.displayEl.textContent = JSON.stringify(val);\r\n          } else if(typeof val === \"number\") {\r\n            n.displayEl.textContent = val.toFixed(3);\r\n          } else {\r\n            n.displayEl.textContent = String(val);\r\n          }\r\n        }\r\n\r\n        console.info(`%c[Print] ${label}` + val, LOG_FUNNY_ARCADE);\r\n      } else if(n.title === \"SetTimeout\") {\r\n        const delay = +n.fields?.find(f => f.key === \"delay\")?.value || 1000;\r\n        setTimeout(() => this.enqueueOutputs(n, \"execOut\"), delay);\r\n        return;\r\n      } else if(n.title === \"Play MP3\") {\r\n        const key = this.getValue(nodeId, \"key\");\r\n        const src = this.getValue(nodeId, \"src\");\r\n        const clones = Number(this.getValue(nodeId, \"clones\")) || 1;\r\n\r\n        if(!key || !src) {\r\n          console.info(`%c[Play MP3] Missing key or src...`, LOG_FUNNY_ARCADE);\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n\r\n        const createdField = n.fields.find(f => f.key === \"created\");\r\n\r\n        if(!createdField.value) {\r\n          createdField.disabled = true;\r\n          app.matrixSounds.createAudio(key, src, clones);\r\n          createdField.value = true;\r\n        }\r\n\r\n        app.matrixSounds.play(key);\r\n\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Generator\") {\r\n        const texturePath = this.getValue(nodeId, \"texturePath\");\r\n        const mat = this.getValue(nodeId, \"material\");\r\n        let pos = this.getValue(nodeId, \"pos\");\r\n        const geo = this.getValue(nodeId, \"geometry\");\r\n        let rot = this.getValue(nodeId, \"rot\");\r\n        let delay = this.getValue(nodeId, \"delay\");\r\n        let sum = this.getValue(nodeId, \"sum\");\r\n        let raycast = this.getValue(nodeId, \"raycast\");\r\n        let scale = this.getValue(nodeId, \"scale\");\r\n        let name = this.getValue(nodeId, \"name\");\r\n        // spec adaptation\r\n        if(raycast == \"true\") {raycast = true} else {raycast = false;}\r\n        if(typeof delay == 'string') delay = parseInt(delay);\r\n        if(typeof pos == 'string') eval(\"pos = \" + pos)\r\n        if(typeof rot == 'string') eval(\"rot = \" + rot)\r\n        if(!texturePath || !pos) {\r\n          console.warn(\"[Generator] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        const createdField = n.fields.find(f => f.key === \"created\");\r\n        if(createdField.value == \"false\" || createdField.value == false) {\r\n          console.log('!GEN! ONCE!');\r\n          app.physicsBodiesGenerator(mat, pos, rot, texturePath, name, geo, raycast, scale, sum, delay);\r\n          // createdField.value = true;\r\n        }\r\n\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Generator Wall\") {\r\n        const texturePath = this.getValue(nodeId, \"texturePath\");\r\n        const mat = this.getValue(nodeId, \"material\");\r\n        let pos = this.getValue(nodeId, \"pos\");\r\n        const size = this.getValue(nodeId, \"size\");\r\n        let rot = this.getValue(nodeId, \"rot\");\r\n        let delay = this.getValue(nodeId, \"delay\");\r\n        let spacing = this.getValue(nodeId, \"spacing\");\r\n        let raycast = this.getValue(nodeId, \"raycast\");\r\n        let scale = this.getValue(nodeId, \"scale\");\r\n        let name = this.getValue(nodeId, \"name\");\r\n        // spec adaptation\r\n        if(raycast == \"true\") {raycast = true} else {raycast = false;}\r\n        if(typeof delay == 'string') delay = parseInt(delay);\r\n        if(typeof pos == 'string') eval(\"pos = \" + pos);\r\n        if(typeof rot == 'string') eval(\"rot = \" + rot);\r\n        if(typeof scale == 'string') eval(\"scale = \" + scale);\r\n        if(!texturePath || !pos) {\r\n          console.warn(\"[Generator] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        const createdField = n.fields.find(f => f.key === \"created\");\r\n        if(createdField.value == \"false\" || createdField.value == false) {\r\n          app.physicsBodiesGeneratorWall(mat, pos, rot, texturePath, name, size, raycast, scale, spacing, delay);\r\n          // createdField.value = true;\r\n        }\r\n\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Add OBJ\") {\r\n        const path = this.getValue(nodeId, \"path\");\r\n        const texturePath = this.getValue(nodeId, \"texturePath\");\r\n        const mat = this.getValue(nodeId, \"material\");\r\n        let pos = this.getValue(nodeId, \"pos\");\r\n        let isPhysicsBody = this.getValue(nodeId, \"isPhysicsBody\");\r\n        let rot = this.getValue(nodeId, \"rot\");\r\n        let isInstancedObj = this.getValue(nodeId, \"isInstancedObj\");\r\n        let raycast = this.getValue(nodeId, \"raycast\");\r\n        let scale = this.getValue(nodeId, \"scale\");\r\n        let name = this.getValue(nodeId, \"name\");\r\n        // spec adaptation - nature of stuff\r\n        if(raycast == \"true\") {raycast = true} else {raycast = false;}\r\n        if(isInstancedObj == \"true\") {isInstancedObj = true} else {isInstancedObj = false;}\r\n        if(isPhysicsBody == \"true\") {isPhysicsBody = true} else {isPhysicsBody = false;}\r\n        if(typeof pos == 'string') eval(\"pos = \" + pos);\r\n        if(typeof rot == 'string') eval(\"rot = \" + rot);\r\n        if(typeof scale == 'string') eval(\"scale = \" + scale);\r\n        if(!texturePath || !path) {\r\n          console.warn(\"[Generator] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        const createdField = n.fields.find(f => f.key === \"created\");\r\n        if(createdField.value == \"false\" || createdField.value == false) {\r\n          app.editorAddOBJ(path, mat, pos, rot, texturePath, name, isPhysicsBody, raycast, scale, isInstancedObj).then((object) => {\r\n            object._GRAPH_CACHE = true;\r\n            n._returnCache = object;\r\n            this.enqueueOutputs(n, \"complete\");\r\n          }).catch((err) => {\r\n            console.log(`%cADD OBJ ERROR GRAPH!`, LOG_FUNNY_ARCADE);\r\n            n._returnCache = null;\r\n            this.enqueueOutputs(n, \"error\");\r\n          })\r\n          // createdField.value = true;\r\n        }\r\n        // sync\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Generator Pyramid\") {\r\n        const texturePath = this.getValue(nodeId, \"texturePath\");\r\n        const mat = this.getValue(nodeId, \"material\");\r\n        let pos = this.getValue(nodeId, \"pos\");\r\n        const levels = this.getValue(nodeId, \"levels\");\r\n        let rot = this.getValue(nodeId, \"rot\");\r\n        let delay = this.getValue(nodeId, \"delay\");\r\n        let spacing = this.getValue(nodeId, \"spacing\");\r\n        let raycast = this.getValue(nodeId, \"raycast\");\r\n        let scale = this.getValue(nodeId, \"scale\");\r\n        let name = this.getValue(nodeId, \"name\");\r\n        // spec adaptation\r\n        if(raycast == \"true\") {raycast = true} else {raycast = false;}\r\n        if(typeof delay == 'string') delay = parseInt(delay);\r\n        if(typeof pos == 'string') eval(\"pos = \" + pos);\r\n        if(typeof rot == 'string') eval(\"rot = \" + rot);\r\n        if(typeof scale == 'string') eval(\"scale = \" + scale);\r\n        if(!texturePath || !pos) {\r\n          console.warn(\"[Generator] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        const createdField = n.fields.find(f => f.key === \"created\");\r\n        if(createdField.value == \"false\" || createdField.value == false) {\r\n          app.physicsBodiesGeneratorDeepPyramid(mat, pos, rot, texturePath, name, levels, raycast, scale, spacing, delay).then((objects) => {\r\n            // console.log('!GEN PYRAMID COMPLETE!');\r\n            n._returnCache = objects;\r\n            this.enqueueOutputs(n, \"complete\");\r\n          })\r\n          // createdField.value = true;\r\n        }\r\n        // sync\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Set Force On Hit\") {\r\n        const objectName = this.getValue(nodeId, \"objectName\");\r\n        const strength = this.getValue(nodeId, \"strength\");\r\n        const rayDirection = this.getValue(nodeId, \"rayDirection\");\r\n        if(!objectName || !rayDirection || !strength) {\r\n          console.warn(\"[Set Force On Hit] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        let b = app.matrixAmmo.getBodyByName(objectName);\r\n        const i = new Ammo.btVector3(\r\n          rayDirection[0] * strength,\r\n          rayDirection[1] * strength,\r\n          rayDirection[2] * strength\r\n        );\r\n        b.applyCentralImpulse(i);\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Set Video Texture\") {\r\n        const objectName = this.getValue(nodeId, \"objectName\");\r\n        let videoTextureArg = this.getValue(nodeId, \"VideoTextureArg\");\r\n\r\n        if(!objectName) {\r\n          console.warn(\"[Set Video Texture] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n\r\n        // console.warn(\"[Set Video Texture] arg:\", videoTextureArg);\r\n        if(typeof videoTextureArg != 'object') {\r\n          // console.warn(\"[Set Video Texture] arg is not object!:\", videoTextureArg);\r\n          if(typeof videoTextureArg == 'string') {\r\n            eval(\"videoTextureArg = \" + videoTextureArg);\r\n          }\r\n          if(typeof videoTextureArg === \"undefined\" || videoTextureArg === null)\r\n            videoTextureArg = {\r\n              type: \"video\", // video , camera  //not tested canvas2d, canvas2dinline\r\n              src: \"res/videos/tunel.mp4\",\r\n            };\r\n        }\r\n\r\n        let o = app.getSceneObjectByName(objectName);\r\n        o.loadVideoTexture(videoTextureArg);\r\n\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Set CanvasInline\") {\r\n        const objectName = this.getValue(nodeId, \"objectName\");\r\n        let canvaInlineProgram = this.getValue(nodeId, \"canvaInlineProgram\");\r\n        let specialCanvas2dArg = this.getValue(nodeId, \"specialCanvas2dArg\");\r\n        if(!objectName) {\r\n          console.log(`%c Node [Set CanvasInline] probably objectname is missing...`, LOG_FUNNY_ARCADE);\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        // console.warn(\"[canvaInlineProgram] specialCanvas2dArg arg:\", specialCanvas2dArg);\r\n        if(typeof specialCanvas2dArg == 'string') {\r\n          eval(\"specialCanvas2dArg = \" + specialCanvas2dArg);\r\n        }\r\n        if(typeof canvaInlineProgram != 'function') {\r\n          // console.warn(\"[canvaInlineProgram] arg is not object!:\", canvaInlineProgram);\r\n          if(typeof canvaInlineProgram == 'string') {\r\n            canvaInlineProgram = eval(\"canvaInlineProgram = \" + canvaInlineProgram);\r\n          }\r\n          if(typeof canvaInlineProgram === \"undefined\" || canvaInlineProgram === null)\r\n            canvaInlineProgram = function(ctx, canvas) {};\r\n        }\r\n\r\n        let o = app.getSceneObjectByName(objectName);\r\n        if(typeof o === 'undefined') {\r\n          console.log(`%c Node [Set CanvasInline] probably objectname is wrong...`, LOG_FUNNY_ARCADE);\r\n          mb.show(\"FluxCodexVertex Exec order is breaked on [Set CanvasInline] node id:\", n.id);\r\n          return;\r\n        }\r\n        // mb.show(\"FluxCodexVertex WHAT IS on [Set CanvasInline] node id:\", n.id);\r\n        o.loadVideoTexture({\r\n          type: \"canvas2d-inline\",\r\n          canvaInlineProgram: canvaInlineProgram,\r\n          specialCanvas2dArg: specialCanvas2dArg ? specialCanvas2dArg : undefined\r\n        });\r\n\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Curve\") {\r\n        const cName = this.getValue(nodeId, \"name\");\r\n        const cDelta = this.getValue(nodeId, \"delta\");\r\n        if(!cName) {\r\n          console.log(`%c Node [CURVE] probably name is missing...`, LOG_FUNNY_ARCADE);\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        let curve = this.curveEditor.curveStore.getByName(nodeId);\r\n        if(!curve) {\r\n          console.warn(\"Curve not found:\", cName);\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        if(!curve.baked) {\r\n          console.log(`%cNode [CURVE] ${curve} bake.`, LOG_FUNNY_ARCADE);\r\n          curve.bake();\r\n        }\r\n        n.curve = curve;\r\n        const t01 = cDelta / curve.length;\r\n        // smooth\r\n        // const t01 = curve.loop\r\n        // ? (cDelta / curve.length) % 1\r\n        // : Math.min(1, Math.max(0, cDelta / curve.length));\r\n        let V = n.curve.evaluate(t01);\r\n        n._returnCache = V;\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"getNumberLiteral\") {\r\n        const literailNum = this.getValue(nodeId, \"number\");\r\n        n._returnCache = literailNum;\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Audio Reactive Node\") {\r\n        const src = this.getValue(nodeId, \"audioSrc\");\r\n        const loop = this.getValue(nodeId, \"loop\");\r\n        const thresholdBeat = this.getValue(nodeId, \"thresholdBeat\");\r\n        const createdField = n.fields.find(f => f.key === \"created\");\r\n        if(!n._audio && !n._loading) {\r\n          n._loading = true;\r\n          createdField.value = true;\r\n          createdField.disabled = true;\r\n          app.audioManager.load(src).then(asset => {\r\n            asset.audio.loop = loop;\r\n            n._audio = asset;\r\n            n._energyHistory = [];\r\n            n._beatCooldown = 0;\r\n            n._loading = false;\r\n          });\r\n          return;\r\n        }\r\n\r\n        if(!n._audio || !n._audio.ready) return;\r\n        const data = n._audio.updateFFT();\r\n        if(!data) return;\r\n        let low = 0, mid = 0, high = 0;\r\n        for(let i = 0;i < 16;i++) low += data[i];\r\n        for(let i = 16;i < 64;i++) mid += data[i];\r\n        for(let i = 64;i < 128;i++) high += data[i];\r\n        low /= 16;\r\n        mid /= 48;\r\n        high /= 64;\r\n        const energy = (low + mid + high) / 3;\r\n        const hist = n._energyHistory;\r\n        hist.push(low);\r\n        if(hist.length > 30) hist.shift();\r\n        let avg = 0;\r\n        for(let i = 0;i < hist.length;i++) avg += hist[i];\r\n        avg /= hist.length;\r\n        let beat = false;\r\n        if(low > avg * thresholdBeat && n._beatCooldown <= 0) {\r\n          beat = true;\r\n          n._beatCooldown = 10;\r\n        }\r\n        if(n._beatCooldown > 0) n._beatCooldown--;\r\n        n._returnCache = [low, mid, high, energy, beat];\r\n\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      } else if(n.title === \"Oscillator\") {\r\n        const min = this.getValue(nodeId, \"min\");\r\n        const max = this.getValue(nodeId, \"max\");\r\n        const step = this.getValue(nodeId, \"step\");\r\n        const regime = this.getValue(nodeId, \"regime\");\r\n        const resist = this.getValue(nodeId, \"resist\");\r\n        const resistMode = this.getValue(nodeId, \"resistMode\");\r\n        if(!n._listenerAttached) {\r\n          n.osc = new OSCILLATOR(min, max, step, {\r\n            regime: regime,\r\n            resist: resist,\r\n            resistMode: resistMode\r\n          });\r\n          n._listenerAttached = true;\r\n        }\r\n        n._returnCache = n.osc.UPDATE();\r\n      } else if(n.title === \"Set Shader Graph\") {\r\n        console.warn(\"[Set Shader Graph] ?????  ??input fields...\");\r\n        const objectName = this.getValue(nodeId, \"objectName\");\r\n        let selectedShader = this.getValue(nodeId, \"selectedShader\");\r\n        if(!objectName) {\r\n          console.warn(\"[Set Shader Graph] Missing input fields...\");\r\n          this.enqueueOutputs(n, \"execOut\");\r\n          return;\r\n        }\r\n        let o = app.getSceneObjectByName(objectName);\r\n        // \r\n        o.changeMaterial(\"graph\", app.shaderGraph.runtime_memory[selectedShader]);\r\n        this.enqueueOutputs(n, \"execOut\");\r\n        return;\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    }\r\n\r\n    if(n.category === \"logic\" && n.title === \"if\") {\r\n      // console.log('TEST LOGIC ')\r\n      const condition = Boolean(this.getValue(nodeId, \"condition\"));\r\n      this.enqueueOutputs(n, condition ? \"true\" : \"false\");\r\n      this._execContext = null;\r\n      return;\r\n    }\r\n\r\n    if(n.title === \"Get Speed\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(pos?.getSpeed) n._returnCache = pos.getSpeed()\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Water Material Params\") {\r\n      let deepColor = this.getValue(nodeId, \"deepColor(vec3f)\");\r\n      let waveSpeed = this.getValue(nodeId, \"waveSpeed\");\r\n      let shallowColor = this.getValue(nodeId, \"shallowColor(vec3f)\");\r\n      let waveScale = this.getValue(nodeId, \"waveScale\");\r\n      let waveHeight = this.getValue(nodeId, \"waveHeight\");\r\n      let fresnelPower = this.getValue(nodeId, \"fresnelPower\");\r\n      let specularPower = this.getValue(nodeId, \"specularPower\");\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      if(deepColor && sceneObjectName) {\r\n        deepColor = JSON.parse(deepColor);\r\n        shallowColor = JSON.parse(shallowColor);\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        obj.updateWaterParams(deepColor, shallowColor, waveSpeed, waveScale, waveHeight, fresnelPower, specularPower);\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set VertexAnim Intesity\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let intensity = this.getValue(nodeId, \"intensity\");\r\n      if(sceneObjectName) {\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        obj.vertexAnim.setIntensity(intensity);\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Vertex Wave\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let enableWave = this.getValue(nodeId, \"enableWave\");\r\n      let waveSpeed = this.getValue(nodeId, \"Wave Speed\");\r\n      let waveAmplitude = this.getValue(nodeId, \"Wave Amplitude\");\r\n      let waveFrequency = this.getValue(nodeId, \"Wave Frequency\");\r\n      if(sceneObjectName) {\r\n        if(enableWave == true || enableWave == \"true\") {\r\n          let obj = app.getSceneObjectByName(sceneObjectName);\r\n          obj.vertexAnim.enableWave();\r\n          obj.vertexAnim.setWaveParams(waveSpeed, waveAmplitude, waveFrequency);\r\n        } else {\r\n          obj.vertexAnim.disableWave();\r\n        }\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Vertex Wind\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let enableWind = this.getValue(nodeId, \"enableWind\");\r\n      let windSpeed = this.getValue(nodeId, \"Wind Speed\");\r\n      let windStrength = this.getValue(nodeId, \"Wind Strength\");\r\n      let windHeightInfluence = this.getValue(nodeId, \"Wind HeightInfluence\");\r\n      let windTurbulence = this.getValue(nodeId, \"Wind Turbulence\");\r\n      if(sceneObjectName) {\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        if(enableWind == true || enableWind == \"true\") {\r\n          obj.vertexAnim.enableWind();\r\n          obj.vertexAnim.setWindParams(windSpeed, windStrength, windHeightInfluence, windTurbulence);\r\n        } else {\r\n          obj.vertexAnim.disableWind();\r\n        }\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Vertex Pulse\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let enablePulse = this.getValue(nodeId, \"enablePulse\");\r\n      let pulseSpeed = this.getValue(nodeId, \"Pulse speed\");\r\n      let pulseAmount = this.getValue(nodeId, \"Pulse amount\");\r\n      let pulseCenterX = this.getValue(nodeId, \"Pulse centerX\");\r\n      let pulseCenterY = this.getValue(nodeId, \"Pulse centerY\");\r\n      if(sceneObjectName) {\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        if(enablePulse == true || enablePulse == \"true\") {\r\n          obj.vertexAnim.enablePulse();\r\n          obj.vertexAnim.setPulseParams(pulseSpeed, pulseAmount, pulseCenterX, pulseCenterY);\r\n        } else {\r\n          obj.vertexAnim.disablePulse();\r\n        }\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Vertex Twist\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let enableTwist = this.getValue(nodeId, \"enableTwist\");\r\n      let twistSpeed = this.getValue(nodeId, \"Twist speed\");\r\n      let twistAmount = this.getValue(nodeId, \"Twist amount\");\r\n      // setTwistParams: (speed, amount)\");\r\n      if(sceneObjectName) {\r\n        console.log(' TEST VERTEX ANIMATION !Twist ', enableTwist);\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        if(enableTwist == true || enableTwist == \"true\") {\r\n          obj.vertexAnim.enableTwist();\r\n          obj.vertexAnim.setTwistParams(twistSpeed, twistAmount);\r\n        }\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Vertex Noise\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let enableNoise = this.getValue(nodeId, \"enableNoise\");\r\n      let noiseScale = this.getValue(nodeId, \"Noise Scale\");\r\n      let noiseStrength = this.getValue(nodeId, \"Noise Strength\");\r\n      let noiseSpeed = this.getValue(nodeId, \"Noise Speed\");\r\n      // setNoiseParams: (scale, strength, speed)\r\n      if(sceneObjectName) {\r\n        console.log(' TEST VERTEX ANIMATION !enableNoise ', enableNoise);\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        if(enableNoise == true || enableNoise == \"true\") {\r\n          obj.vertexAnim.enableNoise();\r\n          obj.vertexAnim.setNoiseParams(noiseScale, noiseStrength, noiseSpeed);\r\n        }\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Vertex Ocean\") {\r\n      let sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      let enableOcean = this.getValue(nodeId, \"enableOcean\");\r\n      let oceanScale = this.getValue(nodeId, \"Ocean Scale\");\r\n      let oceanHeight = this.getValue(nodeId, \"Ocean Height\");\r\n      let oceanSpeed = this.getValue(nodeId, \"Ocean speed\");\r\n      if(sceneObjectName) {\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        if(enableOcean == true || enableOcean == \"true\") {\r\n          obj.vertexAnim.enableOcean();\r\n          obj.vertexAnim.setOceanParams(oceanScale, oceanHeight, oceanSpeed);\r\n        } else {\r\n          obj.vertexAnim.disableOcean();\r\n        }\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Material\") {\r\n      const materialType = this.getValue(nodeId, \"materialType\");\r\n      const sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      if(materialType && materialType !== \"graph\") {\r\n        console.log('sceneObjectName', sceneObjectName)\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        obj.changeMaterial(materialType);\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Texture\") {\r\n      const texpath = this.getValue(nodeId, \"texturePath\");\r\n      const sceneObjectName = this.getValue(nodeId, \"sceneObjectName\");\r\n      if(texpath) {\r\n        // console.log('sceneObjectName', sceneObjectName)\r\n        let obj = app.getSceneObjectByName(sceneObjectName);\r\n        obj.loadTex0([texpath]).then(() => {\r\n          setTimeout(() => obj.changeTexture(obj.texture0), 200);\r\n        })\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Speed\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(pos?.setSpeed) {\r\n        pos.setSpeed(this.getValue(nodeId, \"thrust\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Position\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(pos?.setPosition) {\r\n        pos.setPosition(this.getValue(nodeId, \"x\"), this.getValue(nodeId, \"y\"), this.getValue(nodeId, \"z\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Rotation\") {\r\n      const rot = this.getValue(nodeId, \"rotation\");\r\n      if(rot?.setRotation) {\r\n        rot.setRotation(this.getValue(nodeId, \"x\"), this.getValue(nodeId, \"y\"), this.getValue(nodeId, \"z\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Rotate\") {\r\n      const rot = this.getValue(nodeId, \"rotation\");\r\n      if(rot?.setRotate) {\r\n        rot.setRotate(this.getValue(nodeId, \"x\"), this.getValue(nodeId, \"y\"), this.getValue(nodeId, \"z\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set RotateX\") {\r\n      const rot = this.getValue(nodeId, \"rotation\");\r\n      if(rot?.setRotateX) {\r\n        rot.setRotateX(this.getValue(nodeId, \"x\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set RotateY\") {\r\n      const rot = this.getValue(nodeId, \"rotation\");\r\n      if(rot?.setRotateY) {\r\n        rot.setRotateY(this.getValue(nodeId, \"y\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set RotateZ\") {\r\n      const rot = this.getValue(nodeId, \"rotation\");\r\n      if(rot?.setRotateZ) {\r\n        rot.setRotateZ(this.getValue(nodeId, \"z\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Translate By X\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(pos?.translateByX) {\r\n        pos.translateByX(this.getValue(nodeId, \"x\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Translate By Y\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(pos?.translateByY) {\r\n        pos.translateByX(this.getValue(nodeId, \"y\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Translate By Z\") {\r\n      const pos = this.getValue(nodeId, \"position\");\r\n      if(pos?.translateByZ) {\r\n        pos.translateByX(this.getValue(nodeId, \"z\"));\r\n      }\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    } else if(n.title === \"Set Production Mode\") {\r\n      const disableLoopWarns = this.getValue(nodeId, \"disableLoopWarns\");\r\n      if(disableLoopWarns) {}\r\n      // console.log('set production mode true - must be saved on editorx level.')\r\n      byId('hideEditorBtn').click();\r\n      this.enqueueOutputs(n, \"execOut\");\r\n      return;\r\n    }\r\n    // console.log(\"BEFORE COMPARE \");\r\n    if([\"math\", \"value\", \"compare\", \"stringOperation\"].includes(n.category)) {\r\n      let result;\r\n      switch(n.title) {\r\n        case \"Starts With [string]\":\r\n          // console.log('test startsWith');\r\n          result = this.getValue(nodeId, \"input\").startsWith(this.getValue(nodeId, \"prefix\"));\r\n          break;\r\n        case \"Add\":\r\n          result = this.getValue(nodeId, \"a\") + this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Sub\":\r\n          result = this.getValue(nodeId, \"a\") - this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Mul\":\r\n          result = this.getValue(nodeId, \"a\") * this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Div\":\r\n          result = this.getValue(nodeId, \"a\") / this.getValue(nodeId, \"b\");\r\n          break;\r\n        case \"Sin\":\r\n          result = Math.sin(this.getValue(nodeId, \"a\"));\r\n          break;\r\n        case \"Cos\":\r\n          result = Math.cos(this.getValue(nodeId, \"a\"));\r\n          break;\r\n        case \"Pi\":\r\n          result = Math.PI;\r\n          break;\r\n        case \"A > B\":\r\n          result = this.getValue(nodeId, \"A\") > this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"A < B\":\r\n          result = this.getValue(nodeId, \"A\") < this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"A == B\":\r\n          let varA = this.getValue(nodeId, \"A\");\r\n          let varB = this.getValue(nodeId, \"B\");\r\n          if(typeof varA == \"object\") {\r\n            const r = this.deepEqual(varA, varB);\r\n            result = r;\r\n          } else {\r\n            result = this.getValue(nodeId, \"A\") != this.getValue(nodeId, \"B\");\r\n          }\r\n          break;\r\n        case \"A != B\":\r\n          let varAN = this.getValue(nodeId, \"A\");\r\n          let varBN = this.getValue(nodeId, \"B\");\r\n          if(typeof varAN == \"object\") {\r\n            const r = this.deepEqual(varAN, varBN);\r\n            result = !r;\r\n          } else {\r\n            result = this.getValue(nodeId, \"A\") != this.getValue(nodeId, \"B\");\r\n          }\r\n          break;\r\n        case \"A >= B\":\r\n          result = this.getValue(nodeId, \"A\") >= this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"A <= B\":\r\n          result = this.getValue(nodeId, \"A\") <= this.getValue(nodeId, \"B\");\r\n          break;\r\n        case \"GenRandInt\":\r\n          const min = +n.fields?.find(f => f.key === \"min\")?.value || 0;\r\n          const max = +n.fields?.find(f => f.key === \"max\")?.value || 10;\r\n          result = Math.floor(Math.random() * (max - min + 1)) + min;\r\n          break;\r\n        default:\r\n          result = undefined;\r\n      }\r\n      n._returnCache = result;\r\n      if(n.displayEl) n.displayEl.textContent = typeof result === \"number\" ? result.toFixed(3) : String(result);\r\n    }\r\n    this._execContext = null;\r\n  }\r\n\r\n  getConnectedSource(nodeId, inputName) {\r\n    const link = this.links.find(l => l.to.node === nodeId && l.to.pin === inputName);\r\n    if(!link) return null;\r\n    return {\r\n      node: this.nodes[link.from.node],\r\n      pin: link.from.pin,\r\n    };\r\n  }\r\n\r\n  populateAccessMethods(select) {\r\n    select.innerHTML = \"\";\r\n    this.accessObject.forEach(obj => {\r\n      Object.getOwnPropertyNames(obj.__proto__)\r\n        .filter(k => typeof obj[k] === \"function\" && k !== \"constructor\")\r\n        .forEach(fn => {\r\n          const opt = document.createElement(\"option\");\r\n          opt.value = `${obj.name}.${fn}`;\r\n          opt.textContent = `${obj.name}.${fn}`;\r\n          select.appendChild(opt);\r\n        });\r\n    });\r\n\r\n    select.onchange = e => {\r\n      const [objName, fnName] = e.target.value.split(\".\");\r\n      this.adaptNodeToAccessMethod(node, objName, fnName);\r\n    };\r\n  }\r\n\r\n  getByPath(obj, path) {\r\n    return path.split(\".\").reduce((acc, key) => acc?.[key], obj);\r\n  }\r\n\r\n  getVariable(type, key) {\r\n    const entry = this.variables[type]?.[key];\r\n    if(entry === undefined) return undefined;\r\n    if(entry && typeof entry === \"object\" && \"value\" in entry) {\r\n      return entry.value;\r\n    }\r\n    return entry;\r\n  }\r\n\r\n  enqueueOutputs(n, pinName) {\r\n    this.links\r\n      .filter(l => l.from.node === n.id && l.from.pin === pinName && l.type === \"action\")\r\n      .forEach(l =>\r\n        setTimeout(() => {\r\n          this.triggerNode(l.to.node);\r\n        }, 2)\r\n      );\r\n  }\r\n\r\n  deleteNode(nodeId) {\r\n    const node = this.nodes[nodeId];\r\n    if(!node) return;\r\n\r\n    this.links = this.links.filter(link => {\r\n      if(link.from.node === nodeId || link.to.node === nodeId) {\r\n        const dom = document.getElementById(link.id);\r\n        if(dom) dom.remove();\r\n        return false;\r\n      }\r\n      return true;\r\n    });\r\n\r\n    const dom = this.board.querySelector(`[data-id=\"${nodeId}\"]`);\r\n    if(dom) dom.remove();\r\n    delete this.nodes[nodeId];\r\n    this.updateLinks();\r\n  }\r\n\r\n  bindGlobalListeners() {\r\n    document.addEventListener(\"mousemove\", this.handleMouseMove.bind(this));\r\n    document.addEventListener(\"mouseup\", this.handleMouseUp.bind(this));\r\n    this.boardWrap.addEventListener(\r\n      \"mousedown\",\r\n      this.handleBoardWrapMouseDown.bind(this)\r\n    );\r\n    this.boardWrap.addEventListener(\"mousedown\", () => {\r\n      byId(\"app\").style.opacity = 1;\r\n    });\r\n    this.board.addEventListener(\"click\", () => {\r\n      byId(\"app\").style.opacity = 1;\r\n    });\r\n  }\r\n\r\n  handleMouseMove(e) {\r\n    if(this.state.draggingNode) {\r\n      const el = this.state.draggingNode;\r\n      const newX = e.clientX - this.state.dragOffset[0];\r\n      const newY = e.clientY - this.state.dragOffset[1];\r\n      el.style.left = newX + \"px\";\r\n      el.style.top = newY + \"px\";\r\n      const id = el.dataset.id;\r\n      if(this.nodes[id]) {\r\n        this.nodes[id].x = newX;\r\n        this.nodes[id].y = newY;\r\n      }\r\n      this.updateLinks();\r\n    } else if(this.state.panning) {\r\n      const dx = e.clientX - this.state.panStart[0],\r\n        dy = e.clientY - this.state.panStart[1];\r\n      this.state.pan[0] += dx;\r\n      this.state.pan[1] += dy;\r\n      this.board.style.transform = `translate(${this.state.pan[0]}px,${this.state.pan[1]}px)`;\r\n      this.state.panStart = [e.clientX, e.clientY];\r\n      this.updateLinks();\r\n    }\r\n  }\r\n\r\n  handleMouseUp() {\r\n    // if(this.state.draggingNode) setTimeout(() => this.updateValueDisplays(), 0);\r\n    this.state.draggingNode = null;\r\n    this.state.panning = false;\r\n    document.body.style.cursor = \"default\";\r\n  }\r\n\r\n  handleBoardWrapMouseDown(e) {\r\n    if(!e.target.closest(\".node\")) {\r\n      this.state.panning = true;\r\n      this.state.panStart = [e.clientX, e.clientY];\r\n      document.body.style.cursor = \"grabbing\";\r\n      this.selectNode(null);\r\n    }\r\n  }\r\n\r\n  updateLinks() {\r\n    while(this.svg.firstChild) this.svg.removeChild(this.svg.firstChild);\r\n    const bRect = this.board.getBoundingClientRect();\r\n    this.links.forEach(l => {\r\n      const fromDot = this._getPinDot(l.from.node, l.from.pin, true);\r\n      const toDot = this._getPinDot(l.to.node, l.to.pin, false);\r\n      if(!fromDot || !toDot) return;\r\n      const fRect = fromDot.getBoundingClientRect(),\r\n        tRect = toDot.getBoundingClientRect();\r\n      const x1 = fRect.left - bRect.left + 6,\r\n        y1 = fRect.top - bRect.top + 6;\r\n      const x2 = tRect.left - bRect.left + 6,\r\n        y2 = tRect.top - bRect.top + 6;\r\n      const path = document.createElementNS(\r\n        \"http://www.w3.org/2000/svg\",\r\n        \"path\"\r\n      );\r\n      path.setAttribute(\"class\", \"link \" + (l.type === \"value\" ? \"value\" : \"\"));\r\n      path.setAttribute(\r\n        \"d\",\r\n        `M${x1},${y1} C${x1 + 50},${y1} ${x2 - 50},${y2} ${x2},${y2}`\r\n      );\r\n      this.svg.appendChild(path);\r\n    });\r\n  }\r\n\r\n  runGraph() {\r\n    if(byId(\"graph-status\").innerHTML == '\uD83D\uDD34' || Object.values(this.nodes).length == 0) {\r\n      // Dummy thoughts \u2014> this is wrong.\r\n      // Every data in DOMs is good to use like status flags or any others calls.\r\n      if(mb) mb.show('FluxCodexVertex not ready yet...');\r\n      return;\r\n    }\r\n    let getCurrentGIzmoObj = app.mainRenderBundle.filter((o) => o.effects.gizmoEffect && o.effects.gizmoEffect.enabled)\r\n    if (getCurrentGIzmoObj.length>0) getCurrentGIzmoObj[0].effects.gizmoEffect.enabled = false;\r\n\r\n    byId(\"app\").style.opacity = 0.5;\r\n    this.initEventNodes();\r\n    Object.values(this.nodes).forEach(n => (n._returnCache = undefined));\r\n    Object.values(this.nodes)\r\n      .filter(n => n.category === \"event\" && n.title === \"onLoad\")\r\n      .forEach(n => this.triggerNode(n.id));\r\n    byId(\"graph-status\").innerHTML = '\uD83D\uDD34';\r\n  }\r\n\r\n  compileGraph() {\r\n    // this is save !!!\r\n    const bundle = {\r\n      nodes: this.nodes,\r\n      links: this.links,\r\n      nodeCounter: this.nodeCounter,\r\n      linkCounter: this.linkCounter,\r\n      pan: this.state.pan,\r\n      variables: this.variables,\r\n    };\r\n\r\n    function saveReplacer(key, value) {\r\n      if(key === 'fn') return undefined;\r\n      if(key === 'accessObject') return undefined;\r\n      if(key === '_returnCache') return undefined;\r\n      if(key === '_listenerAttached') return false;\r\n      if(key === '_audio') return undefined;\r\n      if(key === '_loading') return false;\r\n      if(key === '_energyHistory') return undefined;\r\n      if(key === '_beatCooldown') return 0;\r\n      return value;\r\n    }\r\n\r\n    let d = JSON.stringify(bundle, saveReplacer);\r\n    localStorage.setItem(this.SAVE_KEY, d);\r\n    document.dispatchEvent(new CustomEvent('save-graph', {detail: d}));\r\n    // this.log(\"Graph saved to LocalStorage and final script\");\r\n  }\r\n\r\n  clearStorage() {\r\n    let ask = confirm(\"\u26A0\uFE0F This will delete all nodes. Are you sure?\");\r\n    if(ask) {\r\n      this.clearAllNodes();\r\n      localStorage.removeItem(this.SAVE_KEY);\r\n      this.compileGraph(); // not just save empty\r\n      // location.reload(true);\r\n    }\r\n  }\r\n\r\n  clearAllNodes() {\r\n    // Remove node DOMs\r\n    this.board.querySelectorAll(\".node\").forEach(n => n.remove());\r\n    // Clear data\r\n    this.nodes = [];\r\n    this.nodes.length = 0;\r\n    this.links.length = 0;\r\n    // Clear state\r\n    this.state.selectedNode = null;\r\n    this.state.draggingNode = null;\r\n    this.state.connectingPin = null;\r\n    // Optional: redraw connections\r\n    this.updateLinks();\r\n  }\r\n\r\n  _buildSaveBundle() {\r\n    return {\r\n      nodes: this.nodes,\r\n      links: this.links,\r\n      nodeCounter: this.nodeCounter,\r\n      linkCounter: this.linkCounter,\r\n      pan: this.state.pan,\r\n      variables: this.variables,\r\n      version: 1,\r\n    };\r\n  }\r\n\r\n  _loadFromBundle(data) {\r\n    this.nodes = data.nodes || {};\r\n    this.links = data.links || {};\r\n    this.nodeCounter = data.nodeCounter || 0;\r\n    this.linkCounter = data.linkCounter || 0;\r\n    this.state.pan = data.pan || {x: 0, y: 0};\r\n\r\n    this.variables = data.variables || {\r\n      number: {},\r\n      boolean: {},\r\n      string: {},\r\n    };\r\n\r\n    // refresh UI\r\n    this._refreshVarsList(this._varsPopup.children[1]);\r\n    this.loadFromImport();\r\n\r\n    this.log(\"Graph imported from JSON\");\r\n  }\r\n\r\n  exportToJSON() {\r\n    const bundle = this._buildSaveBundle();\r\n    console.log(bundle);\r\n\r\n    function saveReplacer(key, value) {\r\n      if(key === 'fn') return undefined;\r\n      if(key === 'accessObject') return undefined;\r\n      if(key === '_returnCache') return undefined;\r\n      if(key === '_listenerAttached') return false;\r\n      return value;\r\n    }\r\n\r\n    const json = JSON.stringify(bundle, saveReplacer);\r\n\r\n    const blob = new Blob([json], {type: \"application/json\"});\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"fluxcodex-graph.json\";\r\n    a.click();\r\n\r\n    URL.revokeObjectURL(url);\r\n\r\n    this.log(\"Graph exported as JSON\");\r\n  }\r\n\r\n  _createImportInput() {\r\n    const input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n    input.accept = \".json\";\r\n    input.style.display = \"none\";\r\n\r\n    input.onchange = e => {\r\n      const file = e.target.files[0];\r\n      if(!file) return;\r\n\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        try {\r\n          const data = JSON.parse(reader.result);\r\n          this._loadFromBundle(data);\r\n        } catch(err) {\r\n          console.error(\"Invalid JSON file\", err);\r\n        }\r\n      };\r\n      reader.readAsText(file);\r\n    };\r\n\r\n    document.body.appendChild(input);\r\n    this._importInput = input;\r\n  }\r\n\r\n  init() {\r\n    const saved = localStorage.getItem(this.SAVE_KEY);\r\n    if(saved || app.graph) {\r\n      try {\r\n        let data;\r\n        try {\r\n          if(app.graph) {\r\n            data = app.graph;\r\n          } else {\r\n            console.warn(\"\u26A0\uFE0F Used cached data for graph, load from localstorage!\");\r\n            data = JSON.parse(saved);\r\n          }\r\n          if(data == null) {\r\n            console.warn(\"\u26A0\uFE0F No file also no cache for graph, Editor faild to load!\");\r\n            return;\r\n          }\r\n        } catch(e) {\r\n          console.warn(\"\u26A0\uFE0F No cache for graph, load from module!\");\r\n          data = app.graph;\r\n        }\r\n        if(data.variables) {\r\n          this.variables = data.variables;\r\n          this._refreshVarsList(this._varsPopup.children[1]);\r\n        }\r\n        this.nodes = data.nodes || {};\r\n        this.links = data.links || [];\r\n        this.nodeCounter = data.nodeCounter || 1;\r\n        this.linkCounter = data.linkCounter || 1;\r\n        this.state.pan = data.pan || [0, 0];\r\n        this.board.style.transform = `translate(${this.state.pan[0]}px,${this.state.pan[1]}px)`;\r\n        Object.values(this.nodes).forEach(spec => {\r\n          const domEl = this.createNodeDOM(spec);\r\n          this.board.appendChild(domEl);\r\n          if((spec.category === \"value\" && spec.title !== \"GenRandInt\") ||\r\n            spec.category === \"math\" || spec.title === \"Print\") {\r\n            spec.displayEl = domEl.querySelector(\".value-display\");\r\n          }\r\n          this.updateNodeDOM(spec.id);\r\n        });\r\n        this.updateLinks();\r\n        this.restoreConnectionsRuntime();\r\n        this.log(\"Loaded graph.\");\r\n        return;\r\n      } catch(e) {\r\n        console.error(\"Failed to load graph from storage:\", e);\r\n      }\r\n    }\r\n    this.addNode(\"event\");\r\n  }\r\n\r\n  loadFromImport() {\r\n    Object.values(this.nodes).forEach(spec => {\r\n      const domEl = this.createNodeDOM(spec);\r\n      this.board.appendChild(domEl);\r\n\r\n      if((spec.category === \"value\" && spec.title !== \"GenRandInt\") ||\r\n        spec.category === \"math\" || spec.title === \"Print\") {\r\n        spec.displayEl = domEl.querySelector(\".value-display\");\r\n      }\r\n      // Only function nodes get dynamic pins updated\r\n      if(spec.category === \"action\" && spec.title === \"Function\") {\r\n        this.updateNodeDOM(spec.id);\r\n      }\r\n    });\r\n    this.updateLinks();\r\n    this.updateValueDisplays();\r\n    this.log(\"Restored graph.\");\r\n\r\n    this.compileGraph();\r\n    return;\r\n  }\r\n\r\n  onNodeDoubleClick(node) {\r\n    console.log(`%c Node [CURVE  func] ${node.curve}`, LOG_FUNNY_ARCADE);\r\n    if(node.title !== \"Curve\") return;\r\n    this.curveEditor.bindCurve(node.curve, {\r\n      name: node.id,\r\n      idNode: node.id\r\n    });\r\n    this.curveEditor.toggleEditor(true);\r\n  }\r\n\r\n  mergeGraphBundle(data) {\r\n    if(!data || !data.nodes) return;\r\n\r\n    const nodeOffset = this.nodeCounter;\r\n    const linkOffset = this.linkCounter;\r\n    const nodeIdMap = {};\r\n\r\n    // 1. Map and Create Nodes\r\n    Object.values(data.nodes).forEach(node => {\r\n      const oldId = node.id;\r\n      // Ensure we create a truly unique ID string\r\n      const newId = \"n\" + (this.nodeCounter++);\r\n      nodeIdMap[oldId] = newId;\r\n\r\n      const newNode = {\r\n        ...node,\r\n        id: newId,\r\n        // Offset so they don't overlap existing nodes\r\n        x: (node.x || 0) + 100,\r\n        y: (node.y || 0) + 100\r\n      };\r\n\r\n      this.nodes[newId] = newNode;\r\n\r\n      // Create DOM element\r\n      const domEl = this.createNodeDOM(newNode);\r\n      this.board.appendChild(domEl);\r\n\r\n      if((newNode.category === \"value\" && newNode.title !== \"GenRandInt\") ||\r\n        newNode.category === \"math\" || newNode.title === \"Print\") {\r\n        newNode.displayEl = domEl.querySelector(\".value-display\");\r\n      }\r\n    });\r\n\r\n    // 2. Map and Create Links\r\n    if(Array.isArray(data.links)) {\r\n      data.links.forEach(link => {\r\n        const newLinkId = \"l\" + (this.linkCounter++);\r\n\r\n        const newLink = {\r\n          ...link,\r\n          id: newLinkId,\r\n          from: {\r\n            ...link.from,\r\n            node: nodeIdMap[link.from.node]\r\n          },\r\n          to: {\r\n            ...link.to,\r\n            node: nodeIdMap[link.to.node]\r\n          }\r\n        };\r\n\r\n        // Only add link if BOTH nodes were successfully remapped\r\n        if(this.nodes[newLink.from.node] && this.nodes[newLink.to.node]) {\r\n          this.links.push(newLink);\r\n        }\r\n      });\r\n    }\r\n\r\n    // 3. Critical UI Refresh Sequence\r\n    // First, update the DOM positions for the new nodes\r\n    Object.keys(nodeIdMap).forEach(oldId => {\r\n      this.updateNodeDOM(nodeIdMap[oldId]);\r\n    });\r\n\r\n    // Second, tell the engine to draw the lines\r\n    this.updateLinks();\r\n\r\n    // Third, if your engine requires runtime binding (like events/logic)\r\n    if(this.restoreConnectionsRuntime) {\r\n      this.restoreConnectionsRuntime();\r\n    }\r\n\r\n    this.log(`Merged ${Object.keys(nodeIdMap).length} nodes with links.`);\r\n    this.compileGraph(); // Save to LocalStorage\r\n  }\r\n}", "import {byId, FullscreenManager, isMobile, jsonHeaders, LOG_FUNNY_ARCADE, mb} from \"../../engine/utils.js\";\r\nimport {openFragmentShaderEditor} from \"./flexCodexShader.js\";\r\n/**\r\n * @Author NIkola Lukic\r\n * @description\r\n * Web Editor for matrix-engine-wgpu\r\n * Using \"file protocol\" in direct way no virtual/syntetic assets\r\n */\r\nexport default class EditorHud {\r\n  constructor(core, a, toolTip) {\r\n    this.core = core;\r\n    this.sceneContainer = null;\r\n    this.FS = new FullscreenManager();\r\n    this.toolTip = toolTip;\r\n    if(a == 'infly') {\r\n      this.createTopMenuInFly();\r\n    } else if(a == \"created from editor\") {\r\n      this.createTopMenu();\r\n      this.createAssets();\r\n      this.createGizmoIcons();\r\n    } else if(a == \"pre editor\") {\r\n      this.createTopMenuPre();\r\n    } else {\r\n      throw console.error('Editor err');\r\n    }\r\n    this.createEditorSceneContainer();\r\n    this.createScenePropertyBox();\r\n    this.currentProperties = [];\r\n\r\n    document.addEventListener('editor-not-running', () => {\r\n      this.noEditorConn();\r\n    });\r\n\r\n    document.addEventListener('file-detail-data', (e) => {\r\n      console.log(e.detail.details)\r\n      let getPATH = e.detail.details.path.split(\"public\")[1];\r\n      const ext = getPATH.split('.').pop();\r\n\r\n      if(ext == 'glb' && confirm(\"GLB FILE \uD83D\uDCE6 Do you wanna add it to the scene ?\")) {\r\n        let name = prompt(\"\uD83D\uDCE6 GLB file : \", getPATH);\r\n        let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n        if(confirm(\"\u269B Enable physics (Ammo)?\")) {\r\n          // infly\r\n          let o = {\r\n            physics: true,\r\n            path: getPATH,\r\n            index: objName\r\n          }\r\n          document.dispatchEvent(new CustomEvent('web.editor.addGlb', {\r\n            detail: o\r\n          }));\r\n        } else {\r\n          // infly\r\n          let o = {\r\n            physics: false,\r\n            path: getPATH,\r\n            index: objName\r\n          }\r\n          document.dispatchEvent(new CustomEvent('web.editor.addGlb', {\r\n            detail: o\r\n          }));\r\n        }\r\n      } else if(ext == 'obj' && confirm(\"OBJ FILE \uD83D\uDCE6 Do you wanna add it to the scene ?\")) {\r\n        let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n        if(confirm(\"\u269B Enable physics (Ammo)?\")) {\r\n          // infly \r\n          let o = {\r\n            physics: true,\r\n            path: getPATH,\r\n            index: objName\r\n          }\r\n          document.dispatchEvent(new CustomEvent('web.editor.addObj', {\r\n            detail: o\r\n          }));\r\n        } else {\r\n          // infly\r\n          let o = {\r\n            physics: false,\r\n            path: getPATH,\r\n            index: objName\r\n          }\r\n          document.dispatchEvent(new CustomEvent('web.editor.addObj', {\r\n            detail: o\r\n          }));\r\n        }\r\n      } else if(ext == 'mp3' && confirm(\"MP3 FILE \uD83D\uDCE6 Do you wanna add it to the scene ?\")) {\r\n        let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n        // infly\r\n        let o = {\r\n          path: getPATH,\r\n          name: objName\r\n        }\r\n        document.dispatchEvent(new CustomEvent('web.editor.addMp3', {\r\n          detail: o\r\n        }));\r\n      }\r\n\r\n\r\n      else {\r\n        let s = \"\";\r\n        for(let key in e.detail.details) {\r\n          if(key == \"path\") {\r\n            s += key + \":\" + e.detail.details[key].split(\"public\")[1] + \"\\n\";\r\n          } else {\r\n            s += key + \":\" + e.detail.details[key] + \"\\n\";\r\n          }\r\n        }\r\n        mb.show(s);\r\n      }\r\n    });\r\n  }\r\n\r\n  noEditorConn() {\r\n    this.errorForm = document.createElement(\"div\");\r\n    this.errorForm.id = \"errorForm\";\r\n    Object.assign(this.errorForm.style, {\r\n      position: \"absolute\",\r\n      top: \"20%\",\r\n      left: \"25%\",\r\n      width: \"50%\",\r\n      height: \"30vh\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\",\r\n      justifyContent: 'center',\r\n      alignItems: 'center'\r\n    });\r\n\r\n    this.errorForm.innerHTML = `\r\n       <h1 class='fancy-label' style=\"font-size: 24px;\" >No connection with editor node app.</h1>\r\n       <h3 class='fancy-label'>Run from root [npm run editorx] \\n \r\n          or run from ./src/tools/editor/backend [npm run editorx] \\n\r\n          Than refresh page [clear default cache browser with CTRL+F5] </h3>\r\n    `;\r\n    document.body.appendChild(this.errorForm);\r\n  }\r\n\r\n  createTopMenu() {\r\n    this.editorMenu = document.createElement(\"div\");\r\n    this.editorMenu.id = \"editorMenu\";\r\n    Object.assign(this.editorMenu.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"30%\",\r\n      width: \"60%\",\r\n      height: \"50px;\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      // overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.editorMenu.innerHTML = \" PROJECT MENU  \";\r\n\r\n    this.editorMenu.innerHTML = `\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Project \u25BE</div>\r\n      <div class=\"dropdown\">\r\n      <div id=\"start-watch\" class=\"drop-item\">\uD83D\uDEE0\uFE0F Watch</div>\r\n      <div id=\"stop-watch\" class=\"drop-item\">\uD83D\uDEE0\uFE0F Stop Watch</div>\r\n      <div id=\"start-refresh\" class=\"drop-item\">\uD83D\uDEE0\uFE0F Refresh</div>\r\n      <!--div id=\"start-prod-build\" class=\"drop-item\">\uD83D\uDEE0\uFE0F Build for production</div-->\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Insert \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"addCube\" class=\"drop-item\">\uD83E\uDDCACube</div>\r\n        <div id=\"addCubePhysics\" class=\"drop-item\">\uD83E\uDDCACube with Physics</div>\r\n        <div id=\"addSphere\" class=\"drop-item\">\u26AASphere</div>\r\n        <div id=\"addSpherePhysics\" class=\"drop-item\">\u26AASphere with Physics</div>\r\n        <small>Glb and Obj files add direct from asset (by selecting)</small>\r\n        <!--div class=\"drop-item\">\uD83D\uDCA1 Light</div-->\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">AI tools \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAITools\" class=\"drop-item\">\u26AA AI graph generator</div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Script \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showVisualCodeEditorBtn\" class=\"drop-item btn4\">\r\n           <span>Visual Scripting</span>\r\n           <small>\u2328\uFE0FFluxCodexVertex</small>\r\n           <small>\u2328\uFE0FPress F6 for run</small>\r\n        </div>\r\n        <div id=\"showCodeVARSBtn\" class=\"drop-item btn4\">\r\n           <span>Variable editor</span>\r\n           <small>\uD83D\uDD27Visual Script tool</small>\r\n        </div>\r\n        <div id=\"showCodeEditorBtn\" class=\"drop-item btn4\">\r\n           <span>Show code editor</span>\r\n           <small>\uD83D\uDC69\u200D\uD83D\uDCBBFunction raw edit</small>\r\n           <small>Custom Functions</small>\r\n        </div>\r\n        <div id=\"showCurveEditorBtn\" class=\"drop-item btn4\">\r\n           <span>Show curve editor</span>\r\n           <small>\uD83D\uDCC8Timeline curve editor</small>\r\n           <small> </small>\r\n        </div>\r\n        <div id=\"showShaderEditorBtn\" class=\"drop-item btn4\">\r\n           <span>Show shader editor</span>\r\n           <small>Shader editor</small>\r\n           <small> </small>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">View \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"hideEditorBtn\" class=\"drop-item\">\r\n           <h4>Hide Editor UI</h4>\r\n           <small>Show editor - press F4 \u2328\uFE0F</small>\r\n        </div>\r\n        <div id=\"bg-transparent\" class=\"drop-item\">\r\n           <h4>Background transparent</h4>\r\n           <small>Fancy style</small>\r\n        </div>\r\n        <div id=\"bg-tradicional\" class=\"drop-item\">\r\n           <h4>Background tradicional</h4>\r\n           <small>Old school</small>\r\n        </div>\r\n        <div id=\"fullScreenBtn\" class=\"drop-item\">\r\n         <span>FullScreen</span>\r\n         <small>Exit - press F11 \u2328\uFE0F</small>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">About \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAboutEditor\" class=\"drop-item\">matrix-engine-wgpu</div>\r\n        <div class=\"drop-item\">Raport issuse on <a href=\"https://github.com/zlatnaspirala/matrix-engine-wgpu/issues\">Github</a></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"btn2\">\r\n      <button class=\"btn\" id=\"saveMainGraphDOM\">SAVE GRAPH</button>\r\n      <button class=\"btn\" id=\"runMainGraphDOM\">RUN [F6]</button>\r\n      <button class=\"btn\" id=\"stopMainGraphDOM\">STOP</button>\r\n      <span id=\"graph-status\">\u26AB</span>\r\n    </div>\r\n  `;\r\n\r\n    document.body.appendChild(this.editorMenu);\r\n\r\n    // Mobile friendly toggles\r\n    this.editorMenu.querySelectorAll(\".top-btn\").forEach(btn => {\r\n      btn.addEventListener(\"click\", e => {\r\n        const menu = e.target.nextElementSibling;\r\n\r\n        // close others\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          if(d !== menu) d.style.display = \"none\";\r\n        });\r\n\r\n        // toggle\r\n        menu.style.display =\r\n          menu.style.display === \"block\" ? \"none\" : \"block\";\r\n      });\r\n    });\r\n\r\n    byId('saveMainGraphDOM').addEventListener('click', () => {\r\n      app.editor.fluxCodexVertex.compileGraph();\r\n    });\r\n    byId('runMainGraphDOM').addEventListener('click', () => {\r\n      app.editor.fluxCodexVertex.runGraph();\r\n    });\r\n\r\n    this.toolTip.attachTooltip(byId('saveMainGraphDOM'), \"Any changes in graph must be saved.\");\r\n    this.toolTip.attachTooltip(byId('runMainGraphDOM'), \"Run main graph, sometimes engine need refresh.\");\r\n    this.toolTip.attachTooltip(byId('stopMainGraphDOM'), \"Stop main graph, clear dynamic created objects.\");\r\n\r\n    byId('stopMainGraphDOM').addEventListener('click', () => {\r\n      // global for now.\r\n      app.editor.fluxCodexVertex.clearRuntime();\r\n    });\r\n\r\n    // Close on outside tap\r\n    document.addEventListener(\"click\", e => {\r\n      if(!this.editorMenu.contains(e.target)) {\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          d.style.display = \"none\";\r\n        });\r\n      }\r\n    });\r\n\r\n    byId('fullScreenBtn').addEventListener('click', () => {\r\n      this.FS.request()\r\n    });\r\n\r\n    this.toolTip.attachTooltip(byId('fullScreenBtn'), \"Just editor gui part for fullscreen - not fullscreen for real program.\");\r\n\r\n    byId('showAITools').addEventListener('click', () => {\r\n      byId('aiPopup').style.display = 'flex';\r\n    });\r\n    this.toolTip.attachTooltip(byId('showAITools'), \"Experimental stage, MEWGPU use open source ollama platform. Possible to create less complex - assets data not yet involment...\");\r\n\r\n    byId('hideEditorBtn').addEventListener('click', () => {\r\n      this.editorMenu.style.display = 'none';\r\n      this.assetsBox.style.display = 'none';\r\n      this.sceneProperty.style.display = 'none';\r\n      this.sceneContainer.style.display = 'none';\r\n      byId('app').style.display = 'none';\r\n    });\r\n\r\n    byId('bg-transparent').addEventListener('click', () => {\r\n      byId('boardWrap').style.backgroundImage = 'none';\r\n    });\r\n    this.toolTip.attachTooltip(byId('bg-transparent'), \"Make visible both (mix) graphs and render.\");\r\n\r\n    byId('bg-tradicional').addEventListener('click', () => {\r\n      // byId('boardWrap').style.backgroundImage = 'url(\"res/icons/editor/chatgpt-gen-bg.png\")';\r\n      byId('boardWrap').style.backgroundImage = '';\r\n    });\r\n    this.toolTip.attachTooltip(byId('bg-tradicional'), \"Make visible graphs layout only.\");\r\n\r\n    if(byId('stop-watch')) byId('stop-watch').addEventListener('click', () => {\r\n      document.dispatchEvent(new CustomEvent('stop-watch', {\r\n        detail: {}\r\n      }));\r\n    });\r\n    this.toolTip.attachTooltip(byId('stop-watch'), \"Stops JavaScript compilers. Use this when working with Git, for example, to avoid unnecessary builds.\");\r\n\r\n    if(byId('start-watch')) byId('start-watch').addEventListener('click', () => {\r\n      document.dispatchEvent(new CustomEvent('start-watch', {\r\n        detail: {}\r\n      }));\r\n    });\r\n    this.toolTip.attachTooltip(byId('start-watch'), \"Start watch builds for JavaScript compilers.No need at start up - watcher already started on backend of editor.\");\r\n\r\n    if(byId('cnpBtn')) byId('cnpBtn').addEventListener('click', () => {\r\n\r\n      let name = prompt(\"\uD83D\uDCE6 Project name :\", \"MyProject1\");\r\n      let features = {\r\n        physics: false,\r\n        networking: false\r\n      };\r\n\r\n      if(confirm(\"\u269B Enable physics (Ammo)?\")) {\r\n        features.physics = true;\r\n      }\r\n\r\n      if(confirm(\"\uD83D\uDD0C Enable networking (kurento/ov)?\")) {\r\n        features.networking = true;\r\n      }\r\n\r\n      console.log(features);\r\n\r\n      document.dispatchEvent(new CustomEvent('cnp', {\r\n        detail: {\r\n          name: name,\r\n          features: features\r\n        }\r\n      }));\r\n    });\r\n    if(byId('cnpBtn')) this.toolTip.attachTooltip(byId('cnpBtn'), \"Create new project. You must input project name.\");\r\n\r\n    byId('start-refresh').onclick = () => {\r\n      location.reload(true);\r\n    };\r\n    if(byId('start-refresh')) this.toolTip.attachTooltip(byId('start-refresh'), \"Simple refresh page.\");\r\n\r\n\r\n    // byId('start-prod-build').onclick = () => {\r\n    //   //\r\n    //   console.log('.......start-prod-build.......');\r\n    //   console.log('................................')\r\n\r\n    // };\r\n\r\n    // OBJECT LEVEL\r\n    if(byId('addCube')) byId('addCube').addEventListener('click', () => {\r\n      let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n      let o = {\r\n        physics: false,\r\n        index: objName\r\n      };\r\n      document.dispatchEvent(new CustomEvent('web.editor.addCube', {\r\n        detail: o\r\n      }));\r\n    });\r\n    if(byId('addCube')) this.toolTip.attachTooltip(byId('addCube'), \"Create Cube scene object with no physics.If you wanna objects who will be in kinematic also in physics regime (switching) then you need to use CubePhysics.\");\r\n\r\n    if(byId('addSphere')) byId('addSphere').addEventListener('click', () => {\r\n      let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n      let o = {\r\n        physics: false,\r\n        index: objName\r\n      };\r\n      document.dispatchEvent(new CustomEvent('web.editor.addSphere', {\r\n        detail: o\r\n      }));\r\n    });\r\n\r\n    if(byId('addCubePhysics')) byId('addCubePhysics').addEventListener('click', () => {\r\n      let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n      let o = {\r\n        physics: true,\r\n        index: objName\r\n      };\r\n      document.dispatchEvent(new CustomEvent('web.editor.addCube', {\r\n        detail: o\r\n      }));\r\n    });\r\n\r\n    if(byId('addSpherePhysics')) byId('addSpherePhysics').addEventListener('click', () => {\r\n      let objName = prompt(\"\uD83D\uDCE6 Enter uniq name: \");\r\n      let o = {\r\n        physics: true,\r\n        index: objName\r\n      };\r\n      document.dispatchEvent(new CustomEvent('web.editor.addSphere', {\r\n        detail: o\r\n      }));\r\n    });\r\n\r\n    // // settings\r\n    // setTimeout(() => {\r\n    //   this.core.cameras.WASD.pitch = byId('camera-settings-pitch').value;\r\n    //   this.core.cameras.WASD.yaw = byId('camera-settings-yaw').value;\r\n    // }, 1500);\r\n    //     <!--div id=\"cameraBox\" class=\"drop-item\">\r\n    //    <p>\uD83D\uDCFD\uFE0FCamera</p>\r\n    //    <div>Pitch: <input id=\"camera-settings-pitch\" step='0.1' type='number' value='0' /></div>\r\n    //    <div>Yaw: <input id=\"camera-settings-yaw\" step='0.1' type='number' value='0' /></div>\r\n    //    <!--div> Position :  </br>\r\n    //     \\n \r\n    //     X: <input id=\"camera-settings-pos-x\" step='0.5' type='number' value='0' /> \\n\r\n    //     Y: <input id=\"camera-settings-pos-y\" step='0.5' type='number' value='0' /> \\n\r\n    //     Z: <input id=\"camera-settings-pos-z\" step='0.5' type='number' value='0' />\r\n    //    </div-->\r\n    // </div-->\r\n    // byId('camera-settings-pitch').addEventListener('change', (e) => {\r\n    //   console.log('setting camera pitch ', e);\r\n    //   this.core.cameras.WASD.pitch = e.target.value;\r\n    // })\r\n    // byId('camera-settings-yaw').addEventListener('change', (e) => {\r\n    //   console.log('setting camera', e)\r\n    //   this.core.cameras.WASD.yaw = e.target.value;\r\n    // })\r\n\r\n    byId('showCodeEditorBtn').addEventListener('click', (e) => {\r\n      document.dispatchEvent(new CustomEvent('show-method-editor', {detail: {}}));\r\n    });\r\n\r\n    byId('showCurveEditorBtn').addEventListener('click', (e) => {\r\n      document.dispatchEvent(new CustomEvent('show-curve-editor', {detail: {}}));\r\n    });\r\n\r\n    byId('showShaderEditorBtn').addEventListener('click', (e) => {\r\n      if(byId('app').style.display == 'flex') {\r\n        byId('app').style.display = 'none';\r\n      }\r\n      if(byId('shaderDOM') === null) {\r\n        openFragmentShaderEditor().then((e) => {\r\n          app.shaderGraph = e;\r\n        });\r\n      } else if(byId('shaderDOM').style.display === 'flex') {\r\n        byId('shaderDOM').style.display = 'none';\r\n      } else {\r\n        byId('shaderDOM').style.display = 'flex'\r\n      }\r\n    });\r\n\r\n    byId('showVisualCodeEditorBtn').addEventListener('click', (e) => {\r\n      if(byId('shaderDOM') && byId('shaderDOM').style.display == 'flex') {\r\n        byId('shaderDOM').style.display = 'none';\r\n      }\r\n      if(byId('app').style.display == 'flex') {\r\n        byId('app').style.display = 'none';\r\n      } else {\r\n        byId('app').style.display = 'flex';\r\n        if(this.core.editor.fluxCodexVertex) this.core.editor.fluxCodexVertex.updateLinks();\r\n      }\r\n    });\r\n\r\n    byId('showCodeVARSBtn').addEventListener('click', (e) => {\r\n      byId('app').style.display = 'flex';\r\n      byId('varsPopup').style.display = 'flex';\r\n      this.core.editor.fluxCodexVertex.updateLinks();\r\n      // document.dispatchEvent(new CustomEvent('show-method-editor', {detail: {}}));\r\n    });\r\n\r\n    document.addEventListener('updateSceneContainer', (e) => {\r\n      this.updateSceneContainer();\r\n    })\r\n    this.showAboutModal = () => {\r\n      alert(`\r\n  \u2714\uFE0F Support for 3D objects and scene transformations\r\n  \u2714\uFE0F Ammo.js physics integration\r\n  \u2714\uFE0F Networking with Kurento/OpenVidu/Own middleware Nodejs -> frontend\r\n  \u2714\uFE0F Event system\r\n  \uD83C\uDFAF Save system - direct code line [file-protocol]\r\n  \uD83C\uDFAF Adding Visual Scripting System called \r\n     FlowCodexVertex (deactivete from top menu)(activate on pressing F4 key)\r\n  \uD83C\uDFAF Adding Visual Scripting graph for shaders - FlowCodexShader.\r\n     Source code: https://github.com/zlatnaspirala/matrix-engine-wgpu\r\n     More at https://maximumroulette.com\r\n        `);\r\n    }\r\n    byId('showAboutEditor').addEventListener('click', this.showAboutModal);\r\n  }\r\n\r\n  createGizmoIcons() {\r\n    this.gizmoBox = document.createElement(\"div\");\r\n    this.assetsBox.id = \"gizmoBox\";\r\n    Object.assign(this.gizmoBox.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"17.55%\",\r\n      width: \"190px\",\r\n      height: \"64px\",\r\n      backgroundColor: \"transparent\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      zIndex: \"10\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.gizmoBox.innerHTML = `\r\n    <div>\r\n    <img id=\"mode0\" data-mode=\"0\" class=\"gizmo-icon\" src=\"./res/textures/editor/0.png\" width=\"48px\" height=\"48px\"/>\r\n    <img id=\"mode1\" data-mode=\"1\" class=\"gizmo-icon\" src=\"./res/textures/editor/1.png\" width=\"48px\" height=\"48px\"/>\r\n    <img id=\"mode2\" data-mode=\"2\" class=\"gizmo-icon\" src=\"./res/textures/editor/2.png\" width=\"48px\" height=\"48px\"/>\r\n    </div>\r\n    `;\r\n    document.body.appendChild(this.gizmoBox);\r\n    if(!document.getElementById('gizmo-style')) {\r\n      const style = document.createElement('style');\r\n      style.id = 'gizmo-style';\r\n      style.innerHTML = `\r\n            .gizmo-icon {\r\n                cursor: pointer;\r\n                transition: all 0.2s ease-in-out;\r\n                border-radius: 4px;\r\n                padding: 4px;\r\n            }\r\n            /* Hover State */\r\n            .gizmo-icon:hover {\r\n                background-color: rgba(255, 255, 255, 0.15);\r\n                transform: scale(1.1);\r\n                filter: brightness(1.2);\r\n            }\r\n            /* Active/Click State */\r\n            .gizmo-icon:active {\r\n                transform: scale(0.95);\r\n                background-color: rgba(255, 255, 255, 0.3);\r\n            }\r\n        `;\r\n      document.head.appendChild(style);\r\n    }\r\n    const setMode = (e) => {\r\n      let m = parseInt(e.target.getAttribute(\"data-mode\"));\r\n      dispatchEvent(new CustomEvent('editor-set-gizmo-mode', {detail: {mode: m}}))\r\n      if(m == 0) {\r\n        byId('mode0').style.border = 'gray 1px solid';\r\n        byId('mode1').style.border = 'none';\r\n        byId('mode2').style.border = 'none';\r\n      } else if(m == 1) {\r\n        byId('mode0').style.border = 'none';\r\n        byId('mode1').style.border = 'gray 1px solid';\r\n        byId('mode2').style.border = 'none';\r\n      } else if(m == 2) {\r\n        byId('mode0').style.border = 'none';\r\n        byId('mode1').style.border = 'none';\r\n        byId('mode2').style.border = 'gray 1px solid';\r\n      }\r\n\r\n    }\r\n    ['mode0', 'mode1', 'mode2'].forEach(id => {\r\n      byId(id).addEventListener(\"pointerdown\", setMode);\r\n    });\r\n    this.toolTip.attachTooltip(byId('mode0'), `Set gizmo mode to 'translate'.\\n`);\r\n    this.toolTip.attachTooltip(byId('mode1'), `Set gizmo mode to 'rotate'.\\n`);\r\n    this.toolTip.attachTooltip(byId('mode2'), `Set gizmo mode to 'scale'.\\n`);\r\n  }\r\n\r\n  createAssets() {\r\n    this.assetsBox = document.createElement(\"div\");\r\n    this.assetsBox.id = \"assetsBox\";\r\n    Object.assign(this.assetsBox.style, {\r\n      position: \"absolute\",\r\n      bottom: \"0\",\r\n      left: \"17.55%\",\r\n      width: \"63%\",\r\n      height: \"250px\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n    this.assetsBox.innerHTML = \"ASSTES\";\r\n\r\n    this.assetsBox.innerHTML = `\r\n    <div id=\"folderTitle\" >Root</div>\r\n    <div id=\"folderBack\" class=\"scenePropItem\" >...</div>\r\n    <div id='res-folder' class=\"file-browser\">\r\n    </div>`;\r\n\r\n    document.body.appendChild(this.assetsBox);\r\n\r\n    byId('folderBack').addEventListener('click', () => {\r\n      let getCurrent = byId('res-folder').getAttribute('data-root-folder');\r\n      const t = getCurrent.substring(0, getCurrent.lastIndexOf(\"\\\\\"));\r\n      const last = t.substring(t.lastIndexOf(\"\\\\\") + 1);\r\n      if(last == \"public\") {\r\n        // console.log(last + \"<PREVENTED>\");\r\n        return;\r\n      }\r\n      document.dispatchEvent(new CustomEvent(\"nav-folder\", {\r\n        detail: {\r\n          rootFolder: t || \"\",\r\n          name: ''\r\n        }\r\n      }));\r\n    });\r\n\r\n    this.toolTip.attachTooltip(byId('folderTitle'), `This represent real folders files present intro res folder (what ever is there).\\n\r\n    From assets box you can add glb or obj files direct with simple click. Everyting will be saved automatic.\\n\r\n    Support for mp3 adding by click also. No support for mp4 - mp4 can be added from 'Set Textures' node.\r\n    `);\r\n    // folderTitle\r\n    document.addEventListener('la', (e) => {\r\n      console.log(`%c[Editor]Root Resource Folder: ${e.detail.rootFolder}`, LOG_FUNNY_ARCADE);\r\n      byId('res-folder').setAttribute('data-root-folder', e.detail.rootFolder);\r\n      byId('res-folder').innerHTML = '';\r\n      e.detail.payload.forEach((i) => {\r\n        let item = document.createElement('div');\r\n        item.classList.add('file-item');\r\n        if(i.isDir == true) {\r\n          item.classList.add('folder');\r\n        } else if(i.name.split('.')[1] == 'jpg' ||\r\n          i.name.split('.')[1] == 'png' ||\r\n          i.name.split('.')[1] == 'jpeg') {\r\n          item.classList.add('png');\r\n        } else if(i.name.split('.')[1] == 'mp3') {\r\n          item.classList.add('mp3');\r\n        } else if(i.name.split('.')[1] == 'js') {\r\n          item.classList.add('js');\r\n        } else if(i.name.split('.')[1] == 'ttf' ||\r\n          i.name.split('.')[1] == 'ttf' ||\r\n          i.name.split('.')[1] == 'TTF' ||\r\n          i.name.split('.')[1] == 'otf' ||\r\n          i.name.split('.')[1] == 'woff' ||\r\n          i.name.split('.')[1] == 'woff2') {\r\n          item.classList.add('ttf');\r\n        } else if(i.name.split('.')[1] == 'glb') {\r\n          item.classList.add('glb');\r\n        } else {\r\n          item.classList.add('unknown');\r\n        }\r\n\r\n        item.innerHTML = \"<p>\" + i.name + \"</p>\";\r\n        byId('res-folder').appendChild(item);\r\n        item.addEventListener('click', (e) => {\r\n\r\n          if(i.isDir == true) document.dispatchEvent(new CustomEvent(\"nav-folder\", {\r\n            detail: {\r\n              rootFolder: byId('res-folder').getAttribute('data-root-folder') || \"\",\r\n              name: item.children[0].innerText\r\n            }\r\n          }));\r\n\r\n          if(i.isDir == false) document.dispatchEvent(new CustomEvent(\"file-detail\", {\r\n            detail: {\r\n              rootFolder: byId('res-folder').getAttribute('data-root-folder') || \"\",\r\n              name: item.innerText\r\n            }\r\n          }));\r\n        });\r\n      });\r\n      document.querySelectorAll('.file-item').forEach(el => {\r\n        el.addEventListener('click', () => {\r\n          document.querySelectorAll('.file-item').forEach(x => x.classList.remove('selected'));\r\n          el.classList.add('selected');\r\n        });\r\n      });\r\n    })\r\n  }\r\n\r\n  createTopMenuPre() {\r\n    this.editorMenu = document.createElement(\"div\");\r\n    this.editorMenu.id = \"editorMenu\";\r\n    Object.assign(this.editorMenu.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"20%\",\r\n      width: \"60%\",\r\n      height: \"50px;\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.editorMenu.innerHTML = \" PROJECT MENU  \";\r\n\r\n    this.editorMenu.innerHTML = `\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Project \u25BE</div>\r\n      <div class=\"dropdown\">\r\n      <div id=\"cnpBtn\" class=\"drop-item\">\uD83D\uDCE6 Create new project</div>\r\n      <div id=\"loadProjectBtn\" class=\"drop-item\">\uD83D\uDCC2 Load</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">About \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAboutEditor\" class=\"drop-item\">matrix-engine-wgpu</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    document.body.appendChild(this.editorMenu);\r\n    // Mobile friendly toggles\r\n    this.editorMenu.querySelectorAll(\".top-btn\").forEach(btn => {\r\n      btn.addEventListener(\"click\", e => {\r\n        const menu = e.target.nextElementSibling;\r\n        // close others\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          if(d !== menu) d.style.display = \"none\";\r\n        });\r\n        menu.style.display =\r\n          menu.style.display === \"block\" ? \"none\" : \"block\";\r\n      });\r\n    });\r\n\r\n    // Close on outside tap\r\n    document.addEventListener(\"click\", e => {\r\n      if(!this.editorMenu.contains(e.target)) {\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          d.style.display = \"none\";\r\n        });\r\n      }\r\n    });\r\n\r\n    if(byId('loadProjectBtn')) byId('loadProjectBtn').addEventListener('click', () => {\r\n      document.dispatchEvent(new CustomEvent('lp', {\r\n        detail: {}\r\n      }));\r\n    });\r\n\r\n    if(byId('cnpBtn')) byId('cnpBtn').addEventListener('click', () => {\r\n      let name = prompt(\"\uD83D\uDCE6 Project name :\", \"MyProject1\");\r\n      let features = {\r\n        physics: false,\r\n        networking: false\r\n      };\r\n\r\n      if(confirm(\"\u269B Enable physics (Ammo)?\")) {\r\n        features.physics = true;\r\n      }\r\n\r\n      if(confirm(\"\uD83D\uDD0C Enable networking (kurento/ov)?\")) {\r\n        features.networking = true;\r\n      }\r\n      console.log(features);\r\n      document.dispatchEvent(new CustomEvent('cnp', {\r\n        detail: {\r\n          name: name,\r\n          features: features\r\n        }\r\n      }));\r\n    });\r\n\r\n    this.showAboutModal = () => {\r\n      alert(`\r\n  \u2714\uFE0F Support for 3D objects and scene transformations\r\n  \u2714\uFE0F Ammo.js physics integration\r\n  \u2714\uFE0F Networking with Kurento/OpenVidu/Own middleware Nodejs -> frontend\r\n  \u2714\uFE0F Event system\r\n  \uD83C\uDFAF Save system - direct code line [file-protocol]\r\n  \uD83C\uDFAF Adding Visual Scripting System called \r\n     FlowCodexVertex (deactivete from top menu)(activate on pressing F4 key)\r\n     Source code: https://github.com/zlatnaspirala/matrix-engine-wgpu\r\n     More at https://maximumroulette.com\r\n        `);\r\n    }\r\n    byId('showAboutEditor').addEventListener('click', this.showAboutModal);\r\n  }\r\n\r\n  createTopMenuInFly() {\r\n    this.editorMenu = document.createElement(\"div\");\r\n    this.editorMenu.id = \"editorMenu\";\r\n    Object.assign(this.editorMenu.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"20%\",\r\n      width: \"60%\",\r\n      height: \"50px;\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.editorMenu.innerHTML = \" PROJECT MENU \";\r\n    this.editorMenu.innerHTML = `\r\n    <div>INFLY Regime of work no saves. Nice for runtime debugging or get data for map setup.</div>\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">About \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAboutEditor\" class=\"drop-item\">matrix-engine-wgpu</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    document.body.appendChild(this.editorMenu);\r\n    // Mobile friendly toggles\r\n    this.editorMenu.querySelectorAll(\".top-btn\").forEach(btn => {\r\n      btn.addEventListener(\"click\", e => {\r\n        const menu = e.target.nextElementSibling;\r\n        // close others\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          if(d !== menu) d.style.display = \"none\";\r\n        });\r\n        menu.style.display =\r\n          menu.style.display === \"block\" ? \"none\" : \"block\";\r\n      });\r\n    });\r\n\r\n    // Close on outside tap\r\n    document.addEventListener(\"click\", e => {\r\n      if(!this.editorMenu.contains(e.target)) {\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          d.style.display = \"none\";\r\n        });\r\n      }\r\n    });\r\n\r\n    this.showAboutModal = () => {\r\n      alert(`\r\n  \u2714\uFE0F Support for 3D objects and scene transformations\r\n  \u2714\uFE0F Ammo.js physics integration\r\n  \u2714\uFE0F Networking with Kurento/OpenVidu/Own middleware Nodejs -> frontend\r\n  \u2714\uFE0F Event system\r\n  \uD83C\uDFAF Save system - direct code line [file-protocol]\r\n     Adding Visual Scripting System called \r\n     flowCodexVertex (deactivete from top menu)(activate on pressing F4 key)\r\n     Source code: https://github.com/zlatnaspirala/matrix-engine-wgpu\r\n     More at https://maximumroulette.com\r\n        `);\r\n    }\r\n    byId('showAboutEditor').addEventListener('click', this.showAboutModal);\r\n  }\r\n\r\n  createEditorSceneContainer() {\r\n    this.sceneContainer = document.createElement(\"div\");\r\n    this.sceneContainer.id = \"sceneContainer\";\r\n    Object.assign(this.sceneContainer.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"0\",\r\n      width: \"17.5%\",\r\n      height: \"100vh\",\r\n      backgroundColor: \"rgb(75 75 75 / 85%)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.scene = document.createElement(\"div\");\r\n    this.scene.id = \"scene\";\r\n    Object.assign(this.scene.style, {\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.sceneContainerTitle = document.createElement(\"div\");\r\n    this.sceneContainerTitle.style.height = '30px';\r\n    this.sceneContainerTitle.style.width = \"-webkit-fill-available\";\r\n    this.sceneContainerTitle.style.fontSize = (isMobile() == true ? \"x-larger\" : \"larger\");\r\n    this.sceneContainerTitle.style.padding = '5px';\r\n    this.sceneContainerTitle.innerHTML = 'Scene container';\r\n    this.sceneContainer.appendChild(this.sceneContainerTitle);\r\n    this.sceneContainer.appendChild(this.scene);\r\n    document.body.appendChild(this.sceneContainer);\r\n  }\r\n\r\n  updateSceneContainer() {\r\n    this.scene.innerHTML = ``;\r\n    this.core.mainRenderBundle.forEach(sceneObj => {\r\n      let so = document.createElement('div');\r\n      so.style.height = '20px';\r\n      so.classList.add('sceneContainerItem');\r\n      so.innerHTML = sceneObj.name;\r\n      so.addEventListener('click', this.updateSceneObjProperties);\r\n      this.scene.appendChild(so);\r\n    });\r\n  }\r\n\r\n  createScenePropertyBox() {\r\n    this.sceneProperty = document.createElement(\"div\");\r\n    this.sceneProperty.id = \"sceneProperty\";\r\n    this.sceneProperty.classList.add('scenePropItem');\r\n    Object.assign(this.sceneProperty.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      right: \"0\",\r\n      width: \"20%\",\r\n      height: \"100vh\",\r\n      backgroundColor: \"rgb(35 35 35 / 63%)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.objectProperies = document.createElement(\"div\");\r\n    this.objectProperies.id = \"objectProperies\";\r\n    Object.assign(this.objectProperies.style, {\r\n      width: \"100%\",\r\n      height: \"auto\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: 'monospace',\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.objectProperiesTitle = document.createElement(\"div\");\r\n    this.objectProperiesTitle.style.height = '40px';\r\n    this.objectProperiesTitle.style.fontSize = '120%';\r\n    this.objectProperiesTitle.innerHTML = 'Scene object properties';\r\n    this.sceneProperty.appendChild(this.objectProperiesTitle);\r\n    this.sceneProperty.appendChild(this.objectProperies);\r\n    document.body.appendChild(this.sceneProperty);\r\n  }\r\n\r\n  updateSceneObjProperties = (e) => {\r\n    this.currentProperties = [];\r\n    this.objectProperiesTitle.style.fontSize = '120%';\r\n    this.objectProperiesTitle.innerHTML = `Scene object properties`;\r\n    this.objectProperies.innerHTML = ``;\r\n    const currentSO = this.core.getSceneObjectByName(e.target.innerHTML);\r\n    this.objectProperiesTitle.innerHTML = `<span style=\"color:lime;\">Name: ${e.target.innerHTML}</span> \r\n      <span style=\"color:yellow;\"> [${currentSO.constructor.name}]`;\r\n    const OK = Object.keys(currentSO);\r\n    OK.forEach((prop) => {\r\n      // console.log('[key]:', prop);\r\n      if(prop == 'glb' && typeof currentSO[prop] !== 'undefined' && currentSO[prop] != null) {\r\n        this.currentProperties.push(new SceneObjectProperty(this.objectProperies, 'glb', currentSO, this.core));\r\n      } else {\r\n        this.currentProperties.push(new SceneObjectProperty(this.objectProperies, prop, currentSO, this.core));\r\n      }\r\n    });\r\n    // Add editor events system\r\n    this.currentProperties.push(new SceneObjectProperty(this.objectProperies, 'editor-events', currentSO, this.core));\r\n  }\r\n\r\n  updateSceneObjPropertiesFromGizmo = (name) => {\r\n    this.currentProperties = [];\r\n    this.objectProperiesTitle.style.fontSize = '120%';\r\n    this.objectProperiesTitle.innerHTML = `Scene object properties`;\r\n    this.objectProperies.innerHTML = ``;\r\n    const currentSO = this.core.getSceneObjectByName(name);\r\n    this.objectProperiesTitle.innerHTML = `<span style=\"color:lime;\">Name: ${name}</span> \r\n      <span style=\"color:yellow;\"> [${currentSO.constructor.name}]`;\r\n    const OK = Object.keys(currentSO);\r\n    OK.forEach((prop) => {\r\n      // console.log('[key]:', prop);\r\n      if(prop == 'glb' && typeof currentSO[prop] !== 'undefined' && currentSO[prop] != null) {\r\n        this.currentProperties.push(new SceneObjectProperty(this.objectProperies, 'glb', currentSO, this.core));\r\n      } else {\r\n        this.currentProperties.push(new SceneObjectProperty(this.objectProperies, prop, currentSO, this.core));\r\n      }\r\n    });\r\n    // Add editor events system\r\n    this.currentProperties.push(new SceneObjectProperty(this.objectProperies, 'editor-events', currentSO, this.core));\r\n  }\r\n}\r\n\r\nclass SceneObjectProperty {\r\n  constructor(parentDOM, propName, currSceneObj, core) {\r\n    this.core = core;\r\n    this.subObjectsProps = [];\r\n    this.propName = document.createElement(\"div\");\r\n    this.propName.style.width = '100%';\r\n    // console.log(\"init : \" + propName)\r\n    // Register\r\n    if(propName == \"device\" || propName == \"position\" || propName == \"rotation\"\r\n      || propName == \"raycast\" || propName == \"entityArgPass\" || propName == \"scale\"\r\n      || propName == \"maxInstances\" || propName == \"texturesPaths\" || propName == \"glb\"\r\n      || propName == \"itIsPhysicsBody\" || propName == \"useScale\"\r\n    ) {\r\n      this.propName.style.overflow = 'hidden';\r\n      this.propName.style.height = '20px';\r\n      this.propName.style.borderBottom = 'solid lime 2px';\r\n      this.propName.addEventListener('click', (e) => {\r\n        if(e.currentTarget.style.height != 'fit-content') {\r\n          this.propName.style.overflow = 'unset';\r\n          e.currentTarget.style.height = 'fit-content';\r\n        } else {\r\n          this.propName.style.overflow = 'hidden';\r\n          e.currentTarget.style.height = '20px';\r\n        }\r\n      })\r\n\r\n      if(propName == \"itIsPhysicsBody\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:green;\">PhysicsBody</span>\r\n        <span style=\"border-radius:6px;background:gray;\">More info\uD83D\uDD3D</span></div>`;\r\n      } else if(propName == \"position\" || propName == \"scale\" || propName == \"rotation\" || propName == \"glb\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:purple;\">sceneObj</span>\r\n        <span style=\"border-radius:6px;background:gray;\">More info\uD83D\uDD3D</span></div>`;\r\n      } else if(propName == \"entityArgPass\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:brown;\">webGPU props</span>\r\n        <span style=\"border-radius:6px;background:gray;\">More info\uD83D\uDD3D</span></div>`;\r\n      } else if(propName == \"maxInstances\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:brown;\">instanced</span>\r\n        <span style=\"border-radius:6px;background:gray;\"> <input type=\"number\" value=\"${currSceneObj[propName]}\" /> </span></div>`;\r\n      } else if(propName == \"useScale\") {\r\n        this.propName.innerHTML = `<div style=\"display:flex;\" >useScale  + ${this.readBool(currSceneObj, propName)} </div>`;\r\n      } else if(propName == \"texturesPaths\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:purple;\">sceneObj</span>\r\n         <span style=\"border-radius:6px;background:gray;\"> \r\n           Path: ${currSceneObj[propName]} \r\n         </span>\r\n           <div style=\"text-align:center;padding:5px;margin:5px;\"> <img src=\"${currSceneObj[propName]}\" width=\"256px\" height=\"auto\" /> </div>\r\n        </div>`;\r\n      } else {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:red;\">sys</span> \r\n        <span style=\"border-radius:6px;background:gray;\">${currSceneObj[propName]}</span></div>`;\r\n      }\r\n\r\n      // console.log('[propName] ', propName);\r\n      if(currSceneObj[propName] && typeof currSceneObj[propName].adapterInfo !== 'undefined') {\r\n        this.exploreSubObject(currSceneObj[propName].adapterInfo, 'adapterInfo').forEach((item) => {\r\n          if(typeof item === 'string') {\r\n            this.propName.innerHTML += `<div style=\"text-align:left;\"> ${item.split(':'[1])} </div>`;\r\n          } else {\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.appendChild(item);\r\n          }\r\n        })\r\n      } else if(propName == \"itIsPhysicsBody\") {\r\n        let body = this.core.matrixAmmo.getBodyByName(currSceneObj.name);\r\n        for(let key in body) {\r\n          if(typeof body[key] === 'string') {\r\n            this.propName.innerHTML += `<div style=\"display:flex;text-align:left;\"> \r\n              <div style=\"background:black;color:white;width:35%;\">${key}</div>\r\n              <div style=\"background:lime;color:black;width:55%;\">${body[key]} </div>`;\r\n          } else {\r\n            let item = document.createElement('div');\r\n            item.style.display = \"flex\";\r\n\r\n            let funcNameDesc = document.createElement('span');\r\n            funcNameDesc.style.background = \"blue\";\r\n            funcNameDesc.style.width = \"55%\";\r\n            funcNameDesc.innerHTML = key + \":\";\r\n            item.appendChild(funcNameDesc);\r\n\r\n            if(typeof body[key] === \"function\") {\r\n              console.log(\"function\");\r\n              let physicsFuncDesc = document.createElement('select');\r\n              // fill it\r\n              item.appendChild(physicsFuncDesc);\r\n            } else if(typeof body[key] === \"object\") {\r\n              console.log(\"OBJECT\");\r\n              let objDesc = document.createElement('span');\r\n              objDesc.style.background = \"yellow\";\r\n              objDesc.style.color = \"black\";\r\n              objDesc.innerHTML = key;\r\n              item.appendChild(objDesc);\r\n            }\r\n\r\n\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.style.textAlign = 'left';\r\n            this.propName.appendChild(item);\r\n          }\r\n        }\r\n      } else if(\r\n        propName == 'position' ||\r\n        propName == 'rotation' ||\r\n        propName == \"raycast\" ||\r\n        propName == \"entityArgPass\" ||\r\n        propName == \"scale\") {\r\n\r\n        // console.log('currSceneObj[propName] ', currSceneObj[propName]);\r\n        this.exploreSubObject(currSceneObj[propName], propName, currSceneObj).forEach((item) => {\r\n          if(typeof item === 'string') {\r\n            this.propName.innerHTML += `<div style=\"text-align:left;\"> ${item.split(':'[1])} </div>`;\r\n          } else {\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.appendChild(item);\r\n          }\r\n        })\r\n      } else if(propName == 'glb') {\r\n        this.exploreGlb(currSceneObj[propName], propName, currSceneObj).forEach((item) => {\r\n          if(typeof item === 'string') {\r\n            this.propName.innerHTML += `<div style=\"text-align:left;\"> ${item.split(':'[1])} </div>`;\r\n          } else {\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.appendChild(item);\r\n          }\r\n        });\r\n      } else if(propName == 'itIsPhysicsBody') {\r\n        this.propName.style.borderBottom = 'solid lime 2px';\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:deepskyblue;\">boolean</span>\r\n        <span style=\"border-radius:6px;background:gray;\">${currSceneObj[propName]}</span></div>`;\r\n      }\r\n\r\n      parentDOM.appendChild(this.propName);\r\n\r\n    } else if(propName == \"isVideo\") {\r\n      this.propName.style.borderBottom = 'solid lime 2px';\r\n      this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:deepskyblue;\">boolean</span>\r\n        <span style=\"border-radius:6px;background:gray;\">${currSceneObj[propName]}</span></div>`;\r\n      parentDOM.appendChild(this.propName);\r\n    } else if(propName == 'editor-events') {\r\n      this.addEditorEventsProp(currSceneObj, parentDOM);\r\n      this.addEditorDeleteAction(currSceneObj, parentDOM);\r\n\r\n    } else {\r\n      // this.propName.innerHTML = `<div>${propName}</div>`;\r\n      // this.propName.innerHTML += `<div>${currSceneObj[propName]}</div>`;\r\n    }\r\n  }\r\n\r\n  readBool(currSceneObj, rootKey) {\r\n    return `\r\n    <input type=\"checkbox\"\r\n      class=\"inputEditor\"\r\n      name=\"${rootKey}\"\r\n      ${currSceneObj[rootKey] == true ? \"checked\" : \"\"}\r\n      onchange=\"\r\n        console.log(this.checked, 'checkbox change fired');\r\n        document.dispatchEvent(\r\n          new CustomEvent('web.editor.input', {\r\n            detail: {\r\n              inputFor: ${currSceneObj ? \"'\" + currSceneObj.name + \"'\" : \"'no info'\"},\r\n              propertyId: ${currSceneObj ? \"'\" + rootKey + \"'\" : \"'no info'\"},\r\n              property: 'no info',\r\n              value: this.checked\r\n            }\r\n          })\r\n        );\r\n      \"\r\n    />\r\n  `;\r\n  }\r\n\r\n  exploreSubObject(subobj, rootKey, currSceneObj) {\r\n    let a = []; let __ = [];\r\n    for(const key in subobj) {\r\n      __.push(key);\r\n    }\r\n    __.forEach((prop, index) => {\r\n      if(index == 0) a.push(`${rootKey}`);\r\n      let d = null;\r\n      d = document.createElement(\"div\");\r\n      d.style.textAlign = \"left\";\r\n      d.style.display = \"flex\";\r\n      if(typeof subobj[prop] === 'number') {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;\" > \r\n\r\n         <input class=\"inputEditor\" name=\"${prop}\" \r\n          onchange=\"console.log(this.value, 'change fired'); \r\n          document.dispatchEvent(new CustomEvent('web.editor.input', {detail: {\r\n           'inputFor': ${currSceneObj ? \"'\" + currSceneObj.name + \"'\" : \"'no info'\"} ,\r\n           'propertyId': ${currSceneObj ? \"'\" + rootKey + \"'\" : \"'no info'\"} ,\r\n           'property': ${currSceneObj ? \"'\" + prop + \"'\" : \"'no info'\"} ,\r\n           'value': ${currSceneObj ? \"this.value\" : \"'no info'\"}\r\n          }}))\" \r\n         ${(rootKey == \"adapterInfo\" ? \" disabled='true'\" : \" \")} type=\"number\" value=\"${isNaN(subobj[prop]) ? 0 : subobj[prop]\r\n          }\" /> \r\n        \r\n         </div>`;\r\n      } else if(Array.isArray(subobj[prop])) {\r\n        d.innerHTML += `<div style=\"width:50%\">${prop}</div> \r\n         <div style=\"width:${(subobj[prop].length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > ${(subobj[prop].length == 0 ? \"[Empty array]\" : subobj[prop])} </div>`;\r\n      } else if(subobj[prop] === null) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      } else if(subobj[prop] == false) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >false</div>`;\r\n      } else if (typeof subobj[prop] === 'function') {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;padding:1px;border-radius:5px;\" >[Available from graph]</div>`;\r\n       } else if(subobj[prop] == \"\") {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >none</div>`;\r\n      } else {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      }\r\n\r\n      a.push(d);\r\n    });\r\n    // this.subObjectsProps.push(a);\r\n    return a;\r\n  }\r\n\r\n  exploreGlb(subobj, rootKey, currSceneObj) {\r\n    let a = []; let __ = [];\r\n    for(const key in subobj) {\r\n      __.push(key);\r\n    }\r\n    __.forEach((prop, index) => {\r\n      if(index == 0) a.push(`${rootKey}`);\r\n      let d = null;\r\n      d = document.createElement(\"div\");\r\n      d.style.textAlign = \"left\";\r\n      d.style.display = \"flex\";\r\n      d.style.flexWrap = \"wrap\";\r\n      if(typeof subobj[prop] === 'number') {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;\" >\r\n           <input\r\n           class=\"inputEditor\" name=\"${prop}\" \r\n           ${(prop === \"animationIndex\" ? \"max='\" + subobj['glbJsonData']['animations'].length - 1 + \"'\" : \"\")}\r\n             onchange=\"console.log(this.value, 'change fired'); \r\n            document.dispatchEvent(new CustomEvent('web.editor.input', {detail: {\r\n             'inputFor': ${currSceneObj ? \"'\" + currSceneObj.name + \"'\" : \"'no info'\"} ,\r\n             'propertyId': ${currSceneObj ? \"'\" + rootKey + \"'\" : \"'no info'\"} ,\r\n             'property': ${currSceneObj ? \"'\" + prop + \"'\" : \"'no info'\"} ,\r\n             'value': ${currSceneObj ? \"this.value\" : \"'no info'\"}\r\n            }}))\" \r\n           ${(rootKey == \"adapterInfo\" ? \"disabled='true'\" : \"\")}\" type=\"number\" value=\"${subobj[prop]}\" /> \r\n           </div>`;\r\n      } else if(Array.isArray(subobj[prop]) && prop == \"nodes\") {\r\n        console.log(\"init prop: \" + rootKey)\r\n        d.innerHTML += `<div style=\"width:50%\">${prop}</div> \r\n         <div style=\"width:${(subobj[prop].length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].length == 0 ? \"[Empty array]\" : subobj[prop].length)}\r\n         </div>`;\r\n      } else if(Array.isArray(subobj[prop]) && prop == \"skins\") {\r\n        console.log(\"init prop: \" + rootKey)\r\n        d.innerHTML += `<div style=\"width:50%\">${prop}</div> \r\n         <div style=\"width:${(subobj[prop].length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].length == 0 ? \"[Empty array]\" :\r\n            subobj[prop]\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return item.name + \" Joints:\" + item.joints.length + \"\\n inverseBindMatrices:\" + item.inverseBindMatrices;\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>`;\r\n      } else if(prop == \"glbJsonData\") {\r\n        console.log(\"init glbJsonData: \" + rootKey)\r\n\r\n        d.innerHTML += `<div style=\"width:50%\">Animations:</div> \r\n\r\n         <div style=\"width:${(subobj[prop].animations.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].animations.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].animations\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return item.name;\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n         \\n\r\n         <div style=\"width:50%\">Skinned meshes:</div> \r\n         <div style=\"width:${(subobj[prop].meshes.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].meshes.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].meshes\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return item.name + \" \\n Primitives : \" + item.primitives.length;\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n          \\n\r\n         <div style=\"width:50%\">Images:</div> \r\n         <div style=\"width:${(subobj[prop].images.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].images.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].images\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return \"<div>\" + item.name + \" \\n mimeType: \" + item.mimeType + \"</div>\";\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n\r\n         \\n\r\n         <div style=\"width:50%\">Materials:</div> \r\n         <div style=\"width:${(subobj[prop].materials.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].materials.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].materials\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return \"<div>\" + item.name + \" \\n metallicFactor: \" + item.pbrMetallicRoughness.metallicFactor +\r\n                    \" \\n roughnessFactor: \" + item.pbrMetallicRoughness.roughnessFactor + \"</div>\";\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n         \r\n         `;\r\n\r\n\r\n\r\n      } else if(subobj[prop] === null) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      } else if(subobj[prop] == false) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >false</div>`;\r\n      } else if(subobj[prop] == \"\") {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >none</div>`;\r\n      } else {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      }\r\n\r\n      a.push(d);\r\n    });\r\n    // this.subObjectsProps.push(a);\r\n    return a;\r\n  }\r\n\r\n  addEditorEventsProp(currSceneObj, parentDOM) {\r\n    this.propName.innerHTML += `<div>HIT</div>`;\r\n    this.propName.innerHTML += `<div style='display:flex;'>\r\n      <div style=\"align-content: center;\">onTargetReached (NoPhysics)</div>\r\n      <div><select id='sceneObjEditorPropEvents' ></select></div>\r\n    </div>`;\r\n\r\n    parentDOM.appendChild(this.propName);\r\n\r\n    byId('sceneObjEditorPropEvents').onchange = (e) => {\r\n      console.log('Event system selection:', e.target.value)\r\n      if(e.target.value == \"none\") {\r\n        currSceneObj.position.onTargetPositionReach = () => {};\r\n        console.log('clear event')\r\n        return;\r\n      }\r\n      const method = app.editor.methodsManager.methodsContainer.find(\r\n        m => m.name === e.target.value\r\n      );\r\n      let F = app.editor.methodsManager.compileFunction(method.code);\r\n      currSceneObj.position.onTargetPositionReach = F;\r\n      console.log('[position.onTargetPositionReach][attached]', F);\r\n    };\r\n\r\n    byId('sceneObjEditorPropEvents').innerHTML = \"\";\r\n    this.core.editor.methodsManager.methodsContainer.forEach((m, index) => {\r\n      if(index == 0) {\r\n        const op = document.createElement(\"option\");\r\n        op.value = 'none';\r\n        op.textContent = `none`;\r\n        byId('sceneObjEditorPropEvents').appendChild(op);\r\n      }\r\n\r\n      const op = document.createElement(\"option\");\r\n      op.value = m.name;\r\n      op.textContent = `${m.name}  [${m.type}]`;\r\n      byId('sceneObjEditorPropEvents').appendChild(op);\r\n    });\r\n  }\r\n\r\n  addEditorDeleteAction(currSceneObj, parentDOM) {\r\n    this.propName.innerHTML += `<div style='display:flex;'>\r\n      <div style=\"align-content: center;color:red;\">Delete sceneObject:</div>\r\n      <div><button  data-sceneobject='${currSceneObj.name}' id='delete-${currSceneObj.name}'>DELETE</button></div>\r\n    </div>`;\r\n    byId(`delete-${currSceneObj.name}`).addEventListener('click', () => {\r\n      if(this.core.mainRenderBundle.length <= 1) {\r\n        alert(\"WARN - SCENE IS EMPTY IN EDITOR MODE YOU WILL GOT FREEZE - After adding first obj again you must refresh!\");\r\n      }\r\n      // important\r\n      let name = currSceneObj.name;\r\n      let ruleOfNaming = name;\r\n\r\n      const underscoreIndex = name.indexOf('_');\r\n      const dashIndex = name.indexOf('-');\r\n\r\n      // Rule 1 & 2\r\n      if(\r\n        underscoreIndex === -1 ||               // no '_'\r\n        (dashIndex !== -1 && dashIndex < underscoreIndex) // '-' before '_'\r\n      ) {\r\n        ruleOfNaming = name.split('-')[0];\r\n      }\r\n\r\n      alert(ruleOfNaming);\r\n\r\n      document.dispatchEvent(new CustomEvent('web.editor.delete', {\r\n        detail: {prefix: ruleOfNaming, fullName: currSceneObj.name}\r\n      }));\r\n    });\r\n  }\r\n}", "/**\r\n * @description\r\n * MethodsManager only for web editor jobs.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n * @format\r\n * { name, code, fn, type, intervalId }\r\n */\r\nexport default class MethodsManager {\r\n  constructor(editorType) {\r\n    this.editorType = editorType;\r\n    this.methodsContainer = [];\r\n    this.createUI();\r\n    this.loadMethods(editorType).then((r) => {\r\n      this.methodsContainer = r;\r\n      this.refreshSelect();\r\n      this.select.click();\r\n    });\r\n    document.addEventListener('show-method-editor', () => {\r\n      this.popup.style.display = \"block\";\r\n      this.wrapper.style.display = \"block\";\r\n    });\r\n\r\n    document.addEventListener('XcompileFunction', (e) => {\r\n      this.compileFunction(e.detail.code);\r\n    })\r\n  }\r\n\r\n  loadMethods = async (editorType) => {\r\n    return new Promise(async (resolve, reject) => {\r\n      if(editorType == 'created from editor') {\r\n        const page = location.pathname.split(\"/\").pop().replace(\".html\", \"\");\r\n        // const file = `../projects/${page}/methods.js`;\r\n        const file = `./${page}_methods.js`;\r\n        let module;\r\n        try {\r\n          module = await import(file);\r\n          if(module) {resolve(module.default)} else {\r\n            reject([])\r\n          }\r\n        } catch(err) {\r\n          reject([]);\r\n        }\r\n      } else {\r\n        resolve([]);\r\n      }\r\n    })\r\n  }\r\n\r\n  makePopupDraggable() {\r\n    let isDragging = false;\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    // Use the wrapper as the drag handle\r\n    this.wrapper.style.cursor = \"move\";\r\n\r\n    this.wrapper.addEventListener(\"mousedown\", (e) => {\r\n      isDragging = true;\r\n      const rect = this.popup.getBoundingClientRect();\r\n      offsetX = e.clientX - rect.left;\r\n      offsetY = e.clientY - rect.top;\r\n      this.popup.style.transition = \"none\"; // remove transition during drag\r\n    });\r\n\r\n    document.addEventListener(\"mousemove\", (e) => {\r\n      if(!isDragging) return;\r\n      this.popup.style.left = e.clientX - offsetX + \"px\";\r\n      this.popup.style.top = e.clientY - offsetY + \"px\";\r\n      this.popup.style.transform = \"none\"; // cancel centering transform\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      if(isDragging) isDragging = false;\r\n    });\r\n  }\r\n\r\n  createUI() {\r\n    // Wrapper\r\n    this.wrapper = document.createElement(\"div\");\r\n    this.wrapper.style.cssText = `\r\n      padding: 10px; \r\n      background:#2f2f2f;\r\n      border-radius:8px;\r\n      color:#ddd; \r\n      font-family: monospace;\r\n    `;\r\n\r\n    this.select = document.createElement(\"select\");\r\n    this.select.style.cssText = `\r\n      width:100%;\r\n      padding:5px;\r\n      background:#3a3a3a;\r\n      color:#fff;\r\n      border:1px solid #555;\r\n      margin-bottom:10px;\r\n    `;\r\n\r\n    this.select.onchange = () => {\r\n      console.log(\"CHANGE SCRIPT SELECT\")\r\n      const index = this.select.selectedIndex;\r\n      const method = this.methodsContainer[index];\r\n      if(!method) return;\r\n\r\n      // Open editor with selected method\r\n      this.openEditor(method);\r\n    };\r\n\r\n    this.select.onclick = () => {\r\n      const index = this.select.selectedIndex;\r\n      const method = this.methodsContainer[index];\r\n      if(method) this.openEditor(method);\r\n    };\r\n\r\n    this.managerTitle = document.createElement(\"p\");\r\n    this.managerTitle.innerText = \"Custom Method Box\";\r\n    this.managerTitle.style.cssText = `\r\n      width:100%;\r\n      padding:6px;\r\n      margin-top: -10px;\r\n      color:#fff;\r\n      background: unset;\r\n      font-size: 140%;\r\n      font-family: 'stormfaze';\r\n    `;\r\n    this.wrapper.appendChild(this.managerTitle);\r\n\r\n    // BUTTON Add new\r\n    this.btnNew = document.createElement(\"button\");\r\n    this.btnNew.innerText = \"New Method\";\r\n    this.btnNew.style.cssText = `\r\n      width:30%;\r\n      padding:6px;\r\n      margin-left:10px;\r\n      background:rgb(20 94 171);\r\n      color:#fff;\r\n      border:1px solid #555;\r\n      cursor:pointer;\r\n    `;\r\n    this.btnNew.onclick = () => this.openEditor();\r\n    this.wrapper.appendChild(this.select);\r\n\r\n\r\n    // Popup Editor\r\n    this.popup = document.createElement(\"div\");\r\n    this.popup.style.cssText = `\r\n      position:fixed;\r\n      top:50%; left:50%;\r\n      transform:translate(-50%,-50%);\r\n      background:#2a2a2a;\r\n      padding:20px;\r\n      border:1px solid #555;\r\n      border-radius:8px;\r\n      display:none;\r\n      width:30%;\r\n      height: 75%;\r\n      z-index:999;\r\n    `;\r\n    this.popup.appendChild(this.wrapper);\r\n\r\n    // Add after btnSave or btnExit creation\r\n    this.btnRemove = document.createElement(\"button\");\r\n    this.btnRemove.innerText = \"Remove method\";\r\n    this.btnRemove.style.cssText = `\r\n        margin-top:10px;\r\n        margin-left:10px;\r\n        padding:6px 14px;\r\n        background:#a33;\r\n        color:#fff;\r\n        border:1px solid #800;\r\n        cursor:pointer;\r\n      `;\r\n    this.btnRemove.onclick = () => this.removeMethod();\r\n\r\n    this.textarea = document.createElement(\"textarea\");\r\n    this.textarea.id = \"code-editor-textarea\";\r\n    this.textarea.style.cssText = `\r\n      width:99%; \r\n      height:78%; \r\n      background:#1e1e1e;\r\n      font-size: larger;\r\n      color:#fff; \r\n      border:1px solid #555;\r\n      box-shadow: inset 0px 0px 10px 0px #3F51B5;\r\n      -webkit-text-stroke-width:0;\r\n    `;\r\n    // -webkit-text-stroke-color: #03A9F4;\r\n    this.popup.appendChild(this.textarea);\r\n\r\n    this.btnSave = document.createElement(\"button\");\r\n    this.btnSave.innerText = \"Save method\";\r\n    this.btnSave.style.cssText = `\r\n      margin-top:10px;\r\n      padding:6px 14px;\r\n      margin-left:10px;\r\n      background:rgb(45 133 0);\r\n      color:#fff;\r\n      border:1px solid #666;\r\n      cursor:pointer;\r\n    `;\r\n    this.btnSave.onclick = () => this.saveMethod();\r\n    this.popup.appendChild(this.btnSave);\r\n    this.popup.appendChild(this.btnRemove);\r\n    this.popup.appendChild(this.btnNew);\r\n\r\n    this.btnExit = document.createElement(\"button\");\r\n    this.btnExit.innerText = \"Hide\";\r\n    this.btnExit.style.cssText = `\r\n      margin-top:10px;\r\n      padding:6px 14px;\r\n      margin-left:10px;\r\n      background:#555;\r\n      color:#fff;\r\n      border:1px solid #666;\r\n      cursor:pointer;\r\n    `;\r\n    this.btnExit.onclick = () => {\r\n      this.popup.style.display = \"none\";\r\n    };\r\n    this.popup.appendChild(this.btnExit);\r\n\r\n    this.makePopupDraggable();\r\n    document.body.appendChild(this.popup);\r\n  }\r\n\r\n  openEditor(existing) {\r\n    this.editing = existing || null;\r\n    this.textarea.value = existing ? existing.code : \"\";\r\n    // this.popup.style.display = \"block\";\r\n  }\r\n\r\n  saveMethod() {\r\n    const code = this.textarea.value.trim();\r\n\r\n    if(!code) return;\r\n\r\n    const name = this.extractName(code);\r\n\r\n    const obj = {\r\n      name,\r\n      code,\r\n      type: this.detectType(code),\r\n      fn: this.compileFunction(code),\r\n      intervalId: null\r\n    };\r\n\r\n    if(obj.type === \"interval\") {\r\n      obj.intervalId = obj.fn(); // start the interval\r\n    }\r\n\r\n    // Replace or add\r\n    if(this.editing) {\r\n      const idx = this.methodsContainer.indexOf(this.editing);\r\n      this.methodsContainer[idx] = obj;\r\n    } else {\r\n      this.methodsContainer.push(obj);\r\n    }\r\n\r\n    this.refreshSelect();\r\n    this.popup.style.display = \"none\";\r\n\r\n    document.dispatchEvent(new CustomEvent('save-methods', {\r\n      detail: {\r\n        methodsContainer: this.methodsContainer\r\n      }\r\n    }));\r\n\r\n  }\r\n\r\n  removeMethod() {\r\n    if(!this.editing) return; // nothing selected\r\n\r\n    const idx = this.methodsContainer.indexOf(this.editing);\r\n    if(idx === -1) return;\r\n\r\n    // If it was an interval, clear it\r\n    if(this.methodsContainer[idx].intervalId) {\r\n      clearInterval(this.methodsContainer[idx].intervalId);\r\n    }\r\n\r\n    // Remove from container\r\n    this.methodsContainer.splice(idx, 1);\r\n\r\n    // Reset editing\r\n    this.editing = null;\r\n\r\n    // Refresh select options\r\n    this.refreshSelect();\r\n\r\n    // Optionally clear editor\r\n    this.textarea.value = \"\";\r\n\r\n    // Dispatch update event\r\n    document.dispatchEvent(new CustomEvent('save-methods', {\r\n      detail: {\r\n        methodsContainer: this.methodsContainer\r\n      }\r\n    }));\r\n  }\r\n\r\n  refreshSelect() {\r\n    this.select.innerHTML = \"\";\r\n    this.methodsContainer.forEach(m => {\r\n      const op = document.createElement(\"option\");\r\n      op.textContent = `${m.name}  [${m.type}]`;\r\n      this.select.appendChild(op);\r\n    });\r\n  }\r\n\r\n  extractName(code) {\r\n    const match = code.match(/function\\s+([a-zA-Z0-9_]+)/);\r\n    return match ? match[1] : \"method_\" + (this.methodsContainer.length + 1);\r\n  }\r\n\r\n  detectType(code) {\r\n    if(code.includes(\"setInterval\")) return \"interval\";\r\n    if(code.includes(\"return\")) return \"return\";\r\n    return \"void\";\r\n  }\r\n\r\n  compileFunction(code) {\r\n    try {\r\n      // Wrap the function code into a callable unit\r\n      const fn = new Function(code + \"; return \" + this.extractName(code) + \";\")();\r\n      return fn;\r\n    } catch(e) {\r\n      console.error(\"Compilation error:\", e);\r\n      return () => {};\r\n    }\r\n  }\r\n\r\n  destroyIntervals() {\r\n    this.methodsContainer.forEach(m => {\r\n      if(m.intervalId) clearInterval(m.intervalId);\r\n    });\r\n  }\r\n}\r\n", "import {METoolTip} from \"../../engine/plugin/tooltip/ToolTip\";\r\nimport {byId} from \"../../engine/utils\";\r\nimport {MEEditorClient} from \"./client\";\r\nimport EditorProvider from \"./editor.provider\";\r\nimport {openFragmentShaderEditor} from \"./flexCodexShader\";\r\nimport FluxCodexVertex from \"./fluxCodexVertex\";\r\nimport EditorHud from \"./hud\";\r\nimport MethodsManager from \"./methodsManager\";\r\n\r\nexport class Editor {\r\n  constructor(core, a, projName) {\r\n    this.core = core;\r\n    this.toolTip = new METoolTip();\r\n    this.methodsManager = new MethodsManager(this.check(a));\r\n    this.editorHud = new EditorHud(core, this.check(a), this.toolTip);\r\n    this.editorProvider = new EditorProvider(core, this.check(a));\r\n    if(this.check(a) == 'pre editor') {\r\n      this.client = new MEEditorClient(this.check(a));\r\n    } else if(this.check(a) == 'created from editor') {\r\n      document.addEventListener('editorx-ws-ready', () => {\r\n        openFragmentShaderEditor().then((e) => {\r\n          byId('shaderDOM').style.display = 'none';\r\n          app.shaderGraph = e;\r\n        })\r\n      });\r\n      this.client = new MEEditorClient(this.check(a), projName);\r\n      this.createFluxCodexVertexDOM();\r\n      setTimeout(() => {\r\n        console.log(\"MOMENT BEFORE COSTRUCT MAIN FLUXCODEXVERTEX GRAPH\");\r\n        this.fluxCodexVertex = new FluxCodexVertex('board', 'boardWrap', 'log', this.methodsManager, projName, this.toolTip);\r\n        setTimeout(() => {\r\n          this.fluxCodexVertex.updateLinks();\r\n        }, 2500);\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  check(a) {\r\n    if(typeof a !== 'undefined' && a == \"created from editor\") {\r\n      return a;\r\n    } else if(typeof a !== 'undefined' && a == \"pre editor\") {\r\n      return a;\r\n    } else {\r\n      return \"infly\";\r\n    }\r\n  }\r\n\r\n  createFluxCodexVertexDOM() {\r\n    let FCV = document.createElement('div');\r\n    FCV.id = 'app';\r\n    FCV.style.display = 'none';\r\n    FCV.style.opacity = 1;\r\n    FCV.innerHTML = `\r\n    <div id=\"leftBar\">\r\n      <span>Declaration</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setProductionMode')\">Set ProductionMode</button>\r\n      <span>Events/Func</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('event')\">Event: onLoad</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('onDraw')\">Event: onDraw</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('onKey')\">Event: onKey</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('eventCustom')\">Custom Event</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('dispatchEvent')\">Dispatch Event</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('function')\">Function</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('if')\">If Branch</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('genrand')\">GenRandInt</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('print')\">Print</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('timeout')\">SetTimeout</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getArray')\">getArray</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('forEach')\">forEach</button>\r\n      <span>Scene objects [agnostic]</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getSceneObject')\">Get scene object</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('addObj')\">Add OBJ</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getObjectAnimation')\">Get Object Animation</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setPosition')\">Set position</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getShaderGraph')\">Set Shader Graph</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setMaterial')\">Set Material</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setSpeed')\">Set Speed</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getSpeed')\">Get Speed</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setRotation')\">Set rotation</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setRotate')\">Set Rotate</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setRotateX')\">Set RotateX</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setRotateY')\">Set RotateY</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setRotateZ')\">Set RotateZ</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setTexture')\">Set Texture</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('translateByX')\">TranslateByX</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('translateByY')\">TranslateByY</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('translateByZ')\">TranslateByZ</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('onTargetPositionReach')\">onTarget PositionReach</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('rayHitEvent')\">Ray Hit Event</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setWaterParams')\">Set Water Material Params</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexAnim')\">Set VertexAnim Intesity</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexWave')\">Set Vertex Wave</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexWind')\">Set Vertex Wind</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexPulse')\">Set Vertex Pulse</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexTwist')\">Set Vertex Twist</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexNoise')\">Set Vertex Noise</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVertexOcean')\">Set Vertex Ocean</button>\r\n      <span>Dinamics</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('dynamicFunction')\">Function Dinamic</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getSubObject')\">Get Sub Object</button>\r\n      <span>Data mod</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('curveTimeline')\">Curve Timeline</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('oscillator')\">Oscillator</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('getNumberLiteral')\">Get Number Literal</button>\r\n      <span>Networking</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('fetch')\">Fetch</button>\r\n      <span>Media</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('audioMP3')\">Add Mp3</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setVideoTexture')\">Set Video Tex[Mp4]</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setCanvasInlineTexture')\">Set Canvas2d Inline Tex</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('audioReactiveNode')\">Audio Reactive Node</button>\r\n      <span>Physics</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('generator')\">Generator in place</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('generatorWall')\">Generate Wall</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('generatorPyramid')\">Generate Pyramid</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('setForceOnHit')\">Set Force On Hit</button>\r\n      <span>String Operations</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('startsWith')\">Starts With</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('startsWith')\">Starts With</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('endsWith')\">Ends With</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('includes')\">includes</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('toUpperCase')\">toUpperCase</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('toLowerCase')\">toLowerCase</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('trim')\">Trim</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('length')\">Length</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('substring')\">Substring</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('startsWith')\">Replace</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('startsWith')\">Split</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('concat')\">Concat</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('isEmpty')\">isEmpty</button>\r\n\r\n      <span>Math</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('add')\">Add (+)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('sub')\">Sub (-)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('mul')\">Mul (*)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('div')\">Div (/)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('sin')\">Sin</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('cos')\">Cos</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('pi')\">Pi</button>\r\n      <span>COMPARISON</span>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('equal')\">Equal (==)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('notequal')\">Not Equal (!=)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('greater')\">Greater (>)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('less')\">Less (<)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('greaterEqual')\">Greater/Equal (>=)</button>\r\n      <button class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.addNode('lessEqual')\">Less/Equal (<=)</button>\r\n      <hr style=\"border:none; height:1px; background:rgba(255,255,255,0.03); margin:10px 0;\">\r\n      <span>Compile FluxCodexVertex</span>\r\n      <button style=\"color:#00bcd4;\" class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.compileGraph()\">Save Graph</button>\r\n      <button style=\"color:#00bcd4;\" class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.clearStorage();\">Clear All</button>\r\n      <button style=\"color:#00bcd4;\" class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.runGraph()\">Run (F6)</button>\r\n      <hr style=\"border:none; height:1px; background:rgba(255,255,255,0.03); margin:10px 0;\">\r\n      <button style=\"color: lime;\" class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex.exportToJSON()\">Export (JSON)</button>\r\n      <button style=\"color: lime;\" class=\"btn4 btnLeftBox\" onclick=\"app.editor.fluxCodexVertex._importInput.click()\">Import (JSON)</button>\r\n\r\n      <pre id=\"log\" aria-live=\"polite\"></pre>\r\n    </div>\r\n    <div id=\"boardWrap\">\r\n      <div id=\"board\">\r\n        <svg class=\"connections\"></svg>\r\n      </div>\r\n    </div>\r\n    `;\r\n    document.body.appendChild(FCV);\r\n  }\r\n}", "/**\r\n * @description \r\n * Bloom class for matrix-engine-wgpu\r\n * @public \r\n * \r\n * @setKnee\r\n * @setIntensity\r\n * @setThreshold\r\n * @setBlurRadius\r\n */\r\n\r\nexport class BloomPass {\r\n  constructor(width, height, device, intensity = 1.5) {\r\n    this.enabled = false;\r\n    this.device = device;\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.brightTex = this._createTexture();\r\n    this.blurTexA = this._createTexture();\r\n    this.blurTexB = this._createTexture();\r\n\r\n    this.sampler = device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear'\r\n    });\r\n\r\n    this.intensityBuffer = this._createUniformBuffer([intensity]);\r\n    this.blurDirX = this._createUniformBuffer([1, 0]);\r\n    this.blurDirY = this._createUniformBuffer([0, 1]);\r\n\r\n    this.params = {\r\n      intensity: intensity,\r\n      threshold: 0.6,\r\n      knee: 0.5,\r\n      blurRadius: 6.0\r\n    };\r\n\r\n    this.paramBuffer = this.device.createBuffer({\r\n      size: 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    this._updateParams();\r\n\r\n    this.brightPipeline = this._createPipeline(\r\n      brightPassWGSL(),\r\n      [{binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'float'}},\r\n      {binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'filtering'}},\r\n      {binding: 2, visibility: GPUShaderStage.FRAGMENT, buffer: {type: 'uniform'}}]\r\n    );\r\n\r\n    this.blurPipeline = this._createPipeline(\r\n      blurPassWGSL(),\r\n      [{binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'float'}},\r\n      {binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'filtering'}},\r\n      {binding: 2, visibility: GPUShaderStage.FRAGMENT, buffer: {type: 'uniform'}},\r\n      {binding: 3, visibility: GPUShaderStage.FRAGMENT, buffer: {type: 'uniform'}}]\r\n    );\r\n\r\n    this.combinePipeline = this._createPipeline(\r\n      combinePassWGSL(),\r\n      [{binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'float'}},\r\n      {binding: 1, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'float'}},\r\n      {binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'filtering'}},\r\n      {binding: 3, visibility: GPUShaderStage.FRAGMENT, buffer: {type: 'uniform'}}]\r\n    );\r\n  }\r\n\r\n  _createTexture() {\r\n    return this.device.createTexture({\r\n      size: [this.width, this.height],\r\n      format: 'rgba16float',\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n  }\r\n\r\n  _createPipeline(fragmentWGSL, bindGroupLayoutEntries) {\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: bindGroupLayoutEntries\r\n    });\r\n\r\n    return this.device.createRenderPipeline({\r\n      layout: this.device.createPipelineLayout({\r\n        bindGroupLayouts: [bindGroupLayout]\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({code: fullscreenQuadWGSL()}),\r\n        entryPoint: 'vert'\r\n      },\r\n      fragment: {\r\n        module: this.device.createShaderModule({code: fragmentWGSL}),\r\n        entryPoint: 'main',\r\n        targets: [{format: 'rgba16float'}]\r\n      },\r\n      primitive: {topology: 'triangle-list'}\r\n    });\r\n  }\r\n\r\n  _updateParams() {\r\n    this.device.queue.writeBuffer(this.paramBuffer, 0,\r\n      new Float32Array([\r\n        this.params.intensity,\r\n        this.params.threshold,\r\n        this.params.knee,\r\n        this.params.blurRadius,\r\n      ])\r\n    );\r\n  }\r\n\r\n  setIntensity = (v) => {\r\n    this.params.intensity = v;\r\n    this._updateParams();\r\n  }\r\n\r\n  setThreshold = (v) => {\r\n    this.params.threshold = v;\r\n    this._updateParams();\r\n  }\r\n\r\n  setKnee = (v) => {\r\n    this.params.knee = v;\r\n    this._updateParams();\r\n  }\r\n\r\n  setBlurRadius = (v) => {\r\n    this.params.blurRadius = v;\r\n    this._updateParams();\r\n  }\r\n\r\n  _createUniformBuffer(data) {\r\n    const buffer = this.device.createBuffer({\r\n      size: 16, // std140 safe\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(buffer, 0, new Float32Array(data));\r\n    return buffer;\r\n  }\r\n\r\n  _brightBindGroup(view) {\r\n    return this.device.createBindGroup({\r\n      layout: this.brightPipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        {binding: 0, resource: view},\r\n        {binding: 1, resource: this.sampler},\r\n        {binding: 2, resource: {buffer: this.paramBuffer}},\r\n      ]\r\n    });\r\n  }\r\n\r\n  _blurBindGroup(view, dirBuffer) {\r\n    return this.device.createBindGroup({\r\n      layout: this.blurPipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        {binding: 0, resource: view},\r\n        {binding: 1, resource: this.sampler},\r\n        {binding: 2, resource: {buffer: dirBuffer}},\r\n        {binding: 3, resource: {buffer: this.paramBuffer}},\r\n      ]\r\n    });\r\n  }\r\n\r\n  _combineBindGroup(sceneView, bloomView) {\r\n    return this.device.createBindGroup({\r\n      layout: this.combinePipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        {binding: 0, resource: sceneView},\r\n        {binding: 1, resource: bloomView},\r\n        {binding: 2, resource: this.sampler},\r\n        {binding: 3, resource: {buffer: this.paramBuffer}},\r\n      ]\r\n    });\r\n  }\r\n\r\n  _beginFullscreenPass(encoder, targetView) {\r\n    return encoder.beginRenderPass({\r\n      colorAttachments: [{\r\n        view: targetView,\r\n        loadOp: 'clear',\r\n        storeOp: 'store',\r\n        clearValue: {r: 0, g: 0, b: 0, a: 1}\r\n      }]\r\n    });\r\n  }\r\n\r\n  render(encoder, sceneView, finalTargetView) {\r\n    // ----- Bright pass -----\r\n    {\r\n      const pass = this._beginFullscreenPass(encoder, this.brightTex.createView());\r\n      pass.setPipeline(this.brightPipeline);\r\n      pass.setBindGroup(0, this._brightBindGroup(sceneView));\r\n      pass.draw(6);\r\n      pass.end();\r\n    }\r\n    // ----- Blur X -----\r\n    {\r\n      const pass = this._beginFullscreenPass(encoder, this.blurTexA.createView());\r\n      pass.setPipeline(this.blurPipeline);\r\n      pass.setBindGroup(0, this._blurBindGroup(this.brightTex.createView(), this.blurDirX));\r\n      pass.draw(6);\r\n      pass.end();\r\n    }\r\n    // ----- Blur Y -----\r\n    {\r\n      const pass = this._beginFullscreenPass(encoder, this.blurTexB.createView());\r\n      pass.setPipeline(this.blurPipeline);\r\n      pass.setBindGroup(0, this._blurBindGroup(this.blurTexA.createView(), this.blurDirY));\r\n      pass.draw(6);\r\n      pass.end();\r\n    }\r\n    // ----- Combine -----\r\n    {\r\n      const pass = this._beginFullscreenPass(encoder, finalTargetView);\r\n      pass.setPipeline(this.combinePipeline);\r\n      pass.setBindGroup(0, this._combineBindGroup(sceneView, this.blurTexB.createView())\r\n      );\r\n      pass.draw(6);\r\n      pass.end();\r\n    }\r\n  }\r\n}\r\n\r\nexport function fullscreenQuadWGSL() {\r\n  return `\r\n    @vertex\r\n    fn vert(@builtin(vertex_index) i : u32) -> @builtin(position) vec4<f32> {\r\n      var pos = array<vec2<f32>, 6>(\r\n        vec2(-1.0, -1.0), vec2(1.0, -1.0), vec2(-1.0, 1.0),\r\n        vec2(-1.0, 1.0), vec2(1.0, -1.0), vec2(1.0, 1.0)\r\n      );\r\n      return vec4(pos[i], 0.0, 1.0);\r\n    }\r\n  `;\r\n}\r\n\r\nfunction brightPassWGSL() {\r\n  return `\r\n    struct BloomParams {\r\n    intensity: f32,\r\n    threshold: f32,\r\n    knee: f32,\r\n    radius: f32,\r\n  };\r\n    @group(0) @binding(0) var tex: texture_2d<f32>;\r\n    @group(0) @binding(1) var samp: sampler;\r\n    @group(0) @binding(2) var<uniform> bloom: BloomParams;\r\n    @fragment\r\n    fn main(@builtin(position) p: vec4<f32>) -> @location(0) vec4<f32> {\r\n      let size = vec2<f32>(textureDimensions(tex));\r\n      let uv = p.xy / size;\r\n      let c = textureSample(tex, samp, uv).rgb;\r\n      let lum = dot(c, vec3<f32>(0.2126,0.7152,0.0722));\r\n      let x = max(lum - bloom.threshold, 0.0);\r\n      let w = x * x / (x + bloom.knee);\r\n      return vec4(c * w, 1.0);\r\n    }\r\n  `;\r\n}\r\n\r\nfunction blurPassWGSL() {\r\n  return `\r\n   struct BloomParams {\r\n    intensity: f32,\r\n    threshold: f32,\r\n    knee: f32,\r\n    radius: f32,\r\n  };\r\n\r\n  @group(0) @binding(0) var tex: texture_2d<f32>;\r\n  @group(0) @binding(1) var samp: sampler;\r\n  @group(0) @binding(2) var<uniform> dir: vec2<f32>;\r\n  @group(0) @binding(3) var<uniform> bloom: BloomParams;\r\n\r\n  @fragment\r\n  fn main(@builtin(position) p: vec4<f32>) -> @location(0) vec4<f32> {\r\n    let size = vec2<f32>(textureDimensions(tex));\r\n    let uv = p.xy / size;\r\n    let r = bloom.radius;\r\n    let o = array<f32,5>(-r, -r*0.5, 0.0, r*0.5, r);\r\n    let w = array<f32,5>(0.1,0.2,0.4,0.2,0.1);\r\n    var col = vec3(0.0);\r\n    for(var i=0;i<5;i++){\r\n      col += textureSample(tex, samp, uv + o[i]*dir/size).rgb * w[i];\r\n    }\r\n    return vec4(col,1.0);\r\n  }\r\n`;\r\n}\r\n\r\nfunction combinePassWGSL() {\r\n  return `\r\n  struct BloomParams {\r\n    intensity: f32,\r\n    threshold: f32,\r\n    knee: f32,\r\n    radius: f32,\r\n  };\r\n  @group(0) @binding(0) var origTex: texture_2d<f32>;\r\n  @group(0) @binding(1) var bloomTex: texture_2d<f32>;\r\n  @group(0) @binding(2) var samp: sampler;\r\n  @group(0) @binding(3) var<uniform> bloom: BloomParams;\r\n\r\n  @fragment\r\n  fn main(@builtin(position) p: vec4<f32>) -> @location(0) vec4<f32> {\r\n    let size = vec2<f32>(textureDimensions(origTex));\r\n    let uv = p.xy / size;\r\n\r\n    let origColor = textureSample(origTex, samp, uv).rgb;\r\n    let bloomColor = textureSample(bloomTex, samp, uv).rgb;\r\n\r\n    // additive bloom\r\n    let color = origColor + bloomColor * bloom.intensity;\r\n\r\n    return vec4(color, 1.0);\r\n  }\r\n`;\r\n}", "/**\r\n* MatrixEngine Raycaster (improved)\r\n* Author: Nikola Luki\u0107\r\n* Version: 2.0\r\n*/\r\n\r\nimport {mat4, vec3, vec4} from \"wgpu-matrix\";\r\n\r\nexport let touchCoordinate = {\r\n  enabled: false,\r\n  x: 0,\r\n  y: 0,\r\n  stopOnFirstDetectedHit: false,\r\n};\r\n\r\nfunction multiplyMatrixVector(matrix, vector) {\r\n  return vec4.transformMat4(vector, matrix);\r\n}\r\n\r\nexport function getRayFromMouse(event, canvas, camera) {\r\n  const rect = canvas.getBoundingClientRect();\r\n  const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n  const y = -(((event.clientY - rect.top) / rect.height) * 2 - 1); // flip Y (WebGPU NDC)\r\n\r\n  // Use precomputed projection if available\r\n  const invProjection = mat4.inverse(camera.projectionMatrix);\r\n  const invView = mat4.inverse(camera.view);\r\n\r\n  const clip = [x, y, 1, 1];\r\n  let eye = vec4.transformMat4(clip, invProjection);\r\n  eye = [eye[0], eye[1], -1, 0];\r\n  const worldDir4 = vec4.transformMat4(eye, invView);\r\n  const rayDirection = vec3.normalize([worldDir4[0], worldDir4[1], worldDir4[2]]);\r\n  const rayOrigin = [...camera.position];\r\n  return {rayOrigin, rayDirection, screen: {x, y}};\r\n}\r\n\r\n// Backward compatibility alias\r\nexport const getRayFromMouse2 = getRayFromMouse;\r\n\r\nexport function rayIntersectsSphere(rayOrigin, rayDirection, sphereCenter, sphereRadius) {\r\n  const center = [sphereCenter.x, sphereCenter.y, sphereCenter.z];\r\n  const oc = vec3.subtract(rayOrigin, center);\r\n  const a = vec3.dot(rayDirection, rayDirection);\r\n  const b = 2.0 * vec3.dot(oc, rayDirection);\r\n  const c = vec3.dot(oc, oc) - sphereRadius * sphereRadius;\r\n  const discriminant = b * b - 4 * a * c;\r\n\r\n  if(discriminant < 0) return null;\r\n  const t = (-b - Math.sqrt(discriminant)) / (2.0 * a);\r\n  if(t < 0) return null;\r\n\r\n  const hitPoint = vec3.add(rayOrigin, vec3.mulScalar(rayDirection, t));\r\n  const hitNormal = vec3.normalize(vec3.subtract(hitPoint, center));\r\n  return {t, hitPoint, hitNormal};\r\n}\r\n\r\nexport function computeAABB(vertices) {\r\n  const min = [Infinity, Infinity, Infinity];\r\n  const max = [-Infinity, -Infinity, -Infinity];\r\n  for(let i = 0;i < vertices.length;i += 3) {\r\n    min[0] = Math.min(min[0], vertices[i]);\r\n    min[1] = Math.min(min[1], vertices[i + 1]);\r\n    min[2] = Math.min(min[2], vertices[i + 2]);\r\n    max[0] = Math.max(max[0], vertices[i]);\r\n    max[1] = Math.max(max[1], vertices[i + 1]);\r\n    max[2] = Math.max(max[2], vertices[i + 2]);\r\n  }\r\n  return [min, max];\r\n}\r\n\r\n// Ray-AABB intersection returning distance (slab method)\r\nexport function rayIntersectsAABB(rayOrigin, rayDirection, boxMin, boxMax) {\r\n  let tmin = (boxMin[0] - rayOrigin[0]) / rayDirection[0];\r\n  let tmax = (boxMax[0] - rayOrigin[0]) / rayDirection[0];\r\n  if(tmin > tmax) [tmin, tmax] = [tmax, tmin];\r\n\r\n  let tymin = (boxMin[1] - rayOrigin[1]) / rayDirection[1];\r\n  let tymax = (boxMax[1] - rayOrigin[1]) / rayDirection[1];\r\n  if(tymin > tymax) [tymin, tymax] = [tymax, tymin];\r\n\r\n  if(tmin > tymax || tymin > tmax) return null;\r\n  if(tymin > tmin) tmin = tymin;\r\n  if(tymax < tmax) tmax = tymax;\r\n\r\n  let tzmin = (boxMin[2] - rayOrigin[2]) / rayDirection[2];\r\n  let tzmax = (boxMax[2] - rayOrigin[2]) / rayDirection[2];\r\n  if(tzmin > tzmax) [tzmin, tzmax] = [tzmax, tzmin];\r\n\r\n  if(tmin > tzmax || tzmin > tmax) return null;\r\n  const t = Math.max(tmin, 0.0);\r\n  const hitPoint = vec3.add(rayOrigin, vec3.mulScalar(rayDirection, t));\r\n  return {t, hitPoint};\r\n}\r\n\r\nexport function computeWorldVertsAndAABB(object) {\r\n  const modelMatrix = object.getModelMatrix(object.position);\r\n  const worldVerts = [];\r\n  for(let i = 0;i < object.mesh.vertices.length;i += 3) {\r\n    const local = [object.mesh.vertices[i], object.mesh.vertices[i + 1], object.mesh.vertices[i + 2]];\r\n    const world = vec3.transformMat4(local, modelMatrix);\r\n    worldVerts.push(...world);\r\n  }\r\n  const [boxMin, boxMax] = computeAABB(worldVerts);\r\n  return {modelMatrix, worldVerts, boxMin, boxMax};\r\n}\r\n\r\n// \uD83E\uDDE0 Dispatch rich event\r\nfunction dispatchRayHitEvent(canvas, data) {\r\n  if(data.eventName == 'click') {\r\n    canvas.dispatchEvent(new CustomEvent(\"ray.hit.event\", {detail: data}));\r\n  } else if(data.eventName == 'mousedown') {\r\n    canvas.dispatchEvent(new CustomEvent(\"ray.hit.mousedown\", {detail: data}));\r\n  } else {\r\n    canvas.dispatchEvent(new CustomEvent(\"ray.hit.event.mm\", {detail: data}));\r\n  }\r\n}\r\n\r\nexport function addRaycastsListener(canvasId = \"canvas1\", eventName = 'click') {\r\n  const canvas = document.getElementById(canvasId);\r\n  if(!canvas) {\r\n    console.warn(`[Raycaster] Canvas with id '${canvasId}' not found.`);\r\n    return;\r\n  }\r\n\r\n  canvas.addEventListener(eventName, (event) => {\r\n    const camera = app.cameras[app.mainCameraParams.type];\r\n    const {rayOrigin, rayDirection, screen} = getRayFromMouse(event, canvas, camera);\r\n    let closestHit = null;\r\n\r\n    for(const object of app.mainRenderBundle) {\r\n      if(!object.raycast?.enabled) continue;\r\n\r\n      const {boxMin, boxMax} = computeWorldVertsAndAABB(object);\r\n      const hitAABB = rayIntersectsAABB(rayOrigin, rayDirection, boxMin, boxMax);\r\n      if(!hitAABB) continue;\r\n\r\n      const sphereHit = rayIntersectsSphere(rayOrigin, rayDirection, object.position, object.raycast.radius);\r\n      const hit = sphereHit || hitAABB;\r\n\r\n      if(hit && (!closestHit || hit.t < closestHit.t)) {\r\n        closestHit = {...hit, hitObject: object};\r\n        if(touchCoordinate.stopOnFirstDetectedHit) break;\r\n      }\r\n    }\r\n\r\n    if(closestHit) {\r\n      dispatchRayHitEvent(canvas, {\r\n        hitObject: closestHit.hitObject,\r\n        hitPoint: closestHit.hitPoint,\r\n        hitNormal: closestHit.hitNormal || null,\r\n        hitDistance: closestHit.t,\r\n        rayOrigin,\r\n        rayDirection,\r\n        screenCoords: screen,\r\n        camera,\r\n        timestamp: performance.now(),\r\n        button: event.button,\r\n        eventName: eventName\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport function addRaycastsAABBListener(canvasId = \"canvas1\", eventName = 'click') {\r\n  const canvas = document.getElementById(canvasId);\r\n  if(!canvas) {\r\n    console.warn(`[Raycaster] Canvas with id '${canvasId}' not found.`);\r\n    return;\r\n  }\r\n\r\n  canvas.addEventListener(eventName, (event) => {\r\n    const camera = app.cameras[app.mainCameraParams.type];\r\n    const {rayOrigin, rayDirection, screen} = getRayFromMouse(event, canvas, camera);\r\n    let closestHit = null;\r\n\r\n    for(const object of app.mainRenderBundle) {\r\n      if(!object.raycast?.enabled) continue;\r\n      const {boxMin, boxMax} = computeWorldVertsAndAABB(object);\r\n      const hitAABB = rayIntersectsAABB(rayOrigin, rayDirection, boxMin, boxMax);\r\n      if(!hitAABB) continue;\r\n      const hit = hitAABB;\r\n      if(hit && (!closestHit || hit.t < closestHit.t)) {\r\n        closestHit = {...hit, hitObject: object};\r\n        if(touchCoordinate.stopOnFirstDetectedHit) break;\r\n      }\r\n    }\r\n\r\n    if(closestHit) {\r\n      dispatchRayHitEvent(canvas, {\r\n        hitObject: closestHit.hitObject,\r\n        hitPoint: closestHit.hitPoint,\r\n        hitNormal: closestHit.hitNormal || null,\r\n        hitDistance: closestHit.t,\r\n        rayOrigin,\r\n        rayDirection,\r\n        screenCoords: screen,\r\n        camera,\r\n        timestamp: performance.now(),\r\n        button: event.button,\r\n        eventName: eventName\r\n      });\r\n    }\r\n  });\r\n}\r\n", "import {runtimeCacheObjs} from \"../../tools/editor/fluxCodexVertex\";\r\nimport {downloadMeshes} from \"../loader-obj\";\r\n\r\n// general function for stabilisation \r\nexport function stabilizeTowerBody(body) {\r\n  body.setDamping(0.8, 0.95);\r\n  body.setSleepingThresholds(0.4, 0.4);\r\n  body.setAngularFactor(new Ammo.btVector3(0.1, 0.1, 0.1));\r\n  body.setFriction(1.0);\r\n  body.setRollingFriction(0.8);\r\n  // body.setSpinningFriction(0.8);\r\n}\r\n\r\n/**\r\n * @description Generator can be used also from visual scripting.\r\n * Work only for physics bodie variant.\r\n * @param {string} material \r\n * @enum \"standard\", \"power\"\r\n */\r\nexport function physicsBodiesGenerator(\r\n  material = \"standard\",\r\n  pos,\r\n  rot,\r\n  texturePath,\r\n  name = \"gen1\",\r\n  geometry = \"Cube\",\r\n  raycast = false,\r\n  scale = [1, 1, 1],\r\n  sum = 100,\r\n  delay = 500,\r\n  mesh = null) {\r\n  let engine = this;\r\n  const inputCube = {mesh: \"./res/meshes/blender/cube.obj\"};\r\n  const inputSphere = {mesh: \"./res/meshes/blender/sphere.obj\"};\r\n  function handler(m) {\r\n    let RAY = {enabled: (raycast == true ? true : false), radius: 1};\r\n    for(var x = 0;x < sum;x++) {\r\n      setTimeout(() => {\r\n        engine.addMeshObj({\r\n          material: {type: material},\r\n          position: pos,\r\n          rotation: rot,\r\n          rotationSpeed: {x: 0, y: 0, z: 0},\r\n          texturesPaths: [texturePath],\r\n          name: name + '_' + x,\r\n          mesh: m.mesh,\r\n          physics: {\r\n            enabled: true,\r\n            geometry: geometry,\r\n          },\r\n          raycast: RAY\r\n        });\r\n        // cache\r\n        const o = app.getSceneObjectByName(cubeName);\r\n        runtimeCacheObjs.push(o);\r\n      }, x * delay)\r\n    }\r\n  }\r\n  if(geometry == \"Cube\") {\r\n    downloadMeshes(inputCube, handler, {scale: scale})\r\n  } else if(geometry == \"Sphere\") {\r\n    downloadMeshes(inputSphere, handler, {scale: scale})\r\n  }\r\n}\r\n\r\n/**\r\n * @description Generate a wall of physics cubes\r\n * @param {string} material\r\n * @param {object} pos        starting position {x,y,z}\r\n * @param {object} rot\r\n * @param {string} texturePath\r\n * @param {string} name       base name\r\n * @param {string} size       \"WIDTHxHEIGHT\" \u2192 e.g. \"10x3\"\r\n * @param {boolean} raycast\r\n * @param {Array} scale\r\n * @param {number} spacing    distance between cubes\r\n */\r\nexport function physicsBodiesGeneratorWall(\r\n  material = \"standard\",\r\n  pos,\r\n  rot,\r\n  texturePath,\r\n  name = \"wallCube\",\r\n  size = \"10x3\",\r\n  raycast = false,\r\n  scale = [1, 1, 1],\r\n  spacing = 2,\r\n  delay = 200) {\r\n  const engine = this;\r\n\r\n  const [width, height] = size\r\n    .toLowerCase()\r\n    .split(\"x\")\r\n    .map(n => parseInt(n, 10));\r\n\r\n  const inputCube = {mesh: \"./res/meshes/blender/cube.obj\"};\r\n\r\n  function handler(m) {\r\n    let index = 0;\r\n    const RAY = {enabled: !!raycast, radius: 1};\r\n    for(let y = 0;y < height;y++) {\r\n      for(let x = 0;x < width;x++) {\r\n        const cubeName = `${name}_${index}`;\r\n        setTimeout(() => {\r\n          engine.addMeshObj({\r\n            material: {type: material},\r\n            position: {\r\n              x: pos.x + x * spacing,\r\n              y: pos.y + y * spacing - 2.8,\r\n              z: pos.z\r\n            },\r\n            rotation: rot,\r\n            rotationSpeed: {x: 0, y: 0, z: 0},\r\n            texturesPaths: [texturePath],\r\n            name: cubeName,\r\n            mesh: m.mesh,\r\n            physics: {\r\n              scale: scale,\r\n              enabled: true,\r\n              geometry: \"Cube\"\r\n            },\r\n            raycast: RAY\r\n          });\r\n          // const b = app.matrixAmmo.getBodyByName(cubeName);\r\n          // stabilizeTowerBody(b);\r\n          // cache\r\n          const o = app.getSceneObjectByName(cubeName);\r\n          runtimeCacheObjs.push(o);\r\n        }, index * delay)\r\n        index++;\r\n      }\r\n    }\r\n  }\r\n\r\n  downloadMeshes(inputCube, handler, {scale});\r\n}\r\n\r\n/**\r\n * @description Generate a pyramid of physics cubes\r\n * @param {object} pos       base position {x,y,z}\r\n * @param {object} rot\r\n * @param {string} texturePath\r\n * @param {string} name\r\n * @param {number} levels    number of pyramid levels\r\n * @param {boolean} raycast\r\n * @param {Array} scale\r\n * @param {number} spacing\r\n */\r\nexport function physicsBodiesGeneratorPyramid(\r\n  material = \"standard\",\r\n  pos,\r\n  rot,\r\n  texturePath,\r\n  name = \"pyramidCube\",\r\n  levels = 5,\r\n  raycast = false,\r\n  scale = [1, 1, 1],\r\n  spacing = 2,\r\n  delay = 500) {\r\n  const engine = this;\r\n  const inputCube = {mesh: \"./res/meshes/blender/cube.obj\"};\r\n\r\n  function handler(m) {\r\n    let index = 0;\r\n    const RAY = {enabled: !!raycast, radius: 1};\r\n\r\n    for(let y = 0;y < levels;y++) {\r\n      const rowCount = levels - y;\r\n      const xOffset = (rowCount - 1) * spacing * 0.5;\r\n      for(let x = 0;x < rowCount;x++) {\r\n        const cubeName = `${name}_${index}`;\r\n        setTimeout(() => {\r\n          engine.addMeshObj({\r\n            material: {type: material},\r\n            position: {\r\n              x: pos.x + x * spacing - xOffset,\r\n              y: pos.y + y * spacing,\r\n              z: pos.z\r\n            },\r\n            rotation: rot,\r\n            rotationSpeed: {x: 0, y: 0, z: 0},\r\n            texturesPaths: [texturePath],\r\n            name: cubeName,\r\n            mesh: m.mesh,\r\n            physics: {\r\n              scale: scale,\r\n              enabled: true,\r\n              geometry: \"Cube\"\r\n            },\r\n            raycast: RAY\r\n          });\r\n          // cache\r\n          const o = app.getSceneObjectByName(cubeName);\r\n          runtimeCacheObjs.push(o);\r\n        }, delay);\r\n        index++;\r\n      }\r\n    }\r\n  }\r\n\r\n  downloadMeshes(inputCube, handler, {scale});\r\n}\r\n\r\n/**\r\n * @description Generate a full 3D pyramid of physics cubes\r\n * @param {object} pos       base position {x,y,z}\r\n * @param {object} rot\r\n * @param {string} texturePath\r\n * @param {string} name\r\n * @param {number} levels    number of pyramid levels\r\n * @param {boolean} raycast\r\n * @param {Array} scale\r\n * @param {number} spacing\r\n */\r\nexport function physicsBodiesGeneratorDeepPyramid(\r\n  material = \"standard\",\r\n  pos,\r\n  rot,\r\n  texturePath,\r\n  name = \"pyramidCube\",\r\n  levels = 5,\r\n  raycast = false,\r\n  scale = [1, 1, 1],\r\n  spacing = 2,\r\n  delay = 200\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    const engine = this;\r\n    const inputCube = {mesh: \"./res/meshes/blender/cube.obj\"};\r\n    levels = parseFloat(levels);\r\n    function handler(m) {\r\n      let index = 0;\r\n      const totalCubes = (levels * (levels + 1) * (2 * levels + 1)) / 6;\r\n      const lastIndex = totalCubes - 1;\r\n      const RAY = {enabled: !!raycast, radius: 1};\r\n      const objects = [];\r\n      for(let y = 0;y < levels;y++) {\r\n        const sizeX = levels - y;\r\n        const sizeZ = levels - y;\r\n        const xOffset = (sizeX - 1) * spacing * 0.5;\r\n        const zOffset = (sizeZ - 1) * spacing * 0.5;\r\n        for(let x = 0;x < sizeX;x++) {\r\n          for(let z = 0;z < sizeZ;z++) {\r\n            const cubeName = `${name}_${index}`;\r\n            const currentIndex = index;\r\n            setTimeout(() => {\r\n              engine.addMeshObj({\r\n                material: {type: material},\r\n                position: {\r\n                  x: pos.x + x * spacing - xOffset,\r\n                  y: pos.y + y * spacing,\r\n                  z: pos.z + z * spacing - zOffset\r\n                },\r\n                rotation: rot,\r\n                rotationSpeed: {x: 0, y: 0, z: 0},\r\n                texturesPaths: [texturePath],\r\n                name: cubeName,\r\n                mesh: m.mesh,\r\n                physics: {\r\n                  scale: scale,\r\n                  enabled: true,\r\n                  geometry: \"Cube\"\r\n                },\r\n                raycast: RAY\r\n              });\r\n\r\n              const b = app.matrixAmmo.getBodyByName(cubeName);\r\n              stabilizeTowerBody(b);\r\n\r\n              const o = app.getSceneObjectByName(cubeName);\r\n              runtimeCacheObjs.push(o);\r\n              objects.push(o.name);\r\n\r\n              if(currentIndex === lastIndex) {\r\n                // console.log(\"Last cube added!\");\r\n                resolve(objects);\r\n              }\r\n            }, delay * index);\r\n            index++;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    downloadMeshes(inputCube, handler, {scale});\r\n  });\r\n}\r\n\r\nexport function physicsBodiesGeneratorTower(\r\n  material = \"standard\",\r\n  pos,\r\n  rot,\r\n  texturePath,\r\n  name = \"towerCube\",\r\n  height = 10,\r\n  raycast = false,\r\n  scale = [1, 1, 1],\r\n  spacing = 2\r\n) {\r\n  const engine = this;\r\n  const inputCube = {mesh: \"./res/meshes/blender/cube.obj\"};\r\n\r\n  function handler(m) {\r\n    const RAY = {enabled: !!raycast, radius: 1};\r\n\r\n    for(let y = 0;y < height;y++) {\r\n      const cubeName = `${name}_${y}`;\r\n\r\n      setTimeout(() => {\r\n        engine.addMeshObj({\r\n          material: {type: material},\r\n          position: {\r\n            x: pos.x,\r\n            y: pos.y + y * spacing,\r\n            z: pos.z\r\n          },\r\n          rotation: rot,\r\n          rotationSpeed: {x: 0, y: 0, z: 0},\r\n          texturesPaths: [texturePath],\r\n          name: cubeName,\r\n          mesh: m.mesh,\r\n          physics: {\r\n            scale: scale,\r\n            enabled: true,\r\n            geometry: \"Cube\"\r\n          },\r\n          raycast: RAY\r\n        });\r\n        const b = app.matrixAmmo.getBodyByName(cubeName);\r\n        stabilizeTowerBody(b);\r\n        // cache\r\n        const o = app.getSceneObjectByName(cubeName);\r\n        runtimeCacheObjs.push(o);\r\n      }, delay);\r\n    }\r\n  }\r\n\r\n  downloadMeshes(inputCube, handler, {scale});\r\n}\r\n\r\n// universal (both physics and non physics objects)\r\n// app.editorAddOBJ(mat, pos, rot, texturePath, name, isPhysicsBody, raycast, scale, isInstancedObj\r\nexport function addOBJ(\r\n  path,\r\n  material = \"standard\",\r\n  pos,\r\n  rot,\r\n  texturePath,\r\n  name,\r\n  isPhysicsBody = false,\r\n  raycast = false,\r\n  scale = [1, 1, 1],\r\n  isInstancedObj = false\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    const engine = this;\r\n    const inputCube = {mesh: path};\r\n    function handler(m) {\r\n      const RAY = {enabled: !!raycast, radius: 1};\r\n      // console.info('add cube form graph..')\r\n      engine.addMeshObj({\r\n        material: {type: material},\r\n        position: {\r\n          x: pos.x,\r\n          y: pos.y,\r\n          z: pos.z\r\n        },\r\n        rotation: rot,\r\n        rotationSpeed: {x: 0, y: 0, z: 0},\r\n        texturesPaths: [texturePath],\r\n        name: name,\r\n        mesh: m.mesh,\r\n        physics: {\r\n          scale: scale,\r\n          enabled: isPhysicsBody,\r\n          geometry: \"Cube\"\r\n        },\r\n        raycast: RAY\r\n      });\r\n      // const b = app.matrixAmmo.getBodyByName(name);\r\n      const o = app.getSceneObjectByName(name);\r\n      runtimeCacheObjs.push(o);\r\n      resolve(o);\r\n    }\r\n    downloadMeshes(inputCube, handler, {scale});\r\n  });\r\n}", "// TextureCache.js\r\nexport class TextureCache {\r\n  constructor(device) {\r\n    this.device = device;\r\n    this.cache = new Map();        // path -> Promise<TextureEntry>\r\n  }\r\n\r\n  async get(path, format) {\r\n    if(this.cache.has(path)) {\r\n      return this.cache.get(path); // reuse promise\r\n    }\r\n\r\n    const promise = this.#load(path, format);\r\n    this.cache.set(path, promise);\r\n    return promise;\r\n  }\r\n\r\n  async #load(path, format) {\r\n    const response = await fetch(path);\r\n    const blob = await response.blob();\r\n    const imageBitmap = await createImageBitmap(blob);\r\n\r\n    const texture = this.device.createTexture({\r\n      size: [imageBitmap.width, imageBitmap.height, 1],\r\n      format,\r\n      usage:\r\n        GPUTextureUsage.TEXTURE_BINDING |\r\n        GPUTextureUsage.COPY_DST |\r\n        GPUTextureUsage.RENDER_ATTACHMENT,\r\n    });\r\n\r\n    this.device.queue.copyExternalImageToTexture(\r\n      {source: imageBitmap},\r\n      {texture},\r\n      [imageBitmap.width, imageBitmap.height]\r\n    );\r\n\r\n    const sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n      addressModeU: \"repeat\",\r\n      addressModeV: \"repeat\",\r\n      addressModeW: \"repeat\",\r\n    });\r\n\r\n    return {texture, sampler};\r\n  }\r\n}\r\n", "export class AudioAssetManager {\r\n  constructor() {\r\n    this.assets = new Map();\r\n    this.loading = new Map();\r\n  }\r\n\r\n  load(path, options = {}) {\r\n    if(this.assets.has(path)) {\r\n      return Promise.resolve(this.assets.get(path));\r\n    }\r\n\r\n    if(this.loading.has(path)) {\r\n      return this.loading.get(path);\r\n    }\r\n\r\n    const asset = new MatrixMusicAsset({path, ...options});\r\n    const promise = asset.init().then(a => {\r\n      this.assets.set(path, a);\r\n      this.loading.delete(path);\r\n      return a;\r\n    });\r\n    this.loading.set(path, promise);\r\n    return promise;\r\n  }\r\n}\r\n\r\nexport class MatrixMusicAsset {\r\n  constructor({path, autoplay = true, containerId = null}) {\r\n    this.path = path;\r\n    this.autoplay = autoplay;\r\n    this.containerId = containerId;\r\n    this.audio = null;\r\n    this.ctx = null;\r\n    this.source = null;\r\n    this.gain = null;\r\n    this.filter = null;\r\n    this.analyser = null;\r\n    this.frequencyData = null;\r\n    this.ready = false;\r\n  }\r\n\r\n  async init() {\r\n    this.audio = document.createElement(\"audio\");\r\n    this.audio.id=this.path;\r\n    this.audio.src = `res/audios/${this.path}`;\r\n    this.audio.autoplay = this.autoplay;\r\n    this.audio.playsInline = true;\r\n    this.audio.controls = true;\r\n    (this.containerId\r\n      ? document.getElementById(this.containerId)\r\n      : document.body\r\n    )?.appendChild(this.audio);\r\n\r\n    const AudioCtx = window.AudioContext || window.webkitAudioContext;\r\n    this.ctx = new AudioCtx();\r\n    if(this.ctx.state === \"suspended\") {\r\n      await this.ctx.resume();\r\n    }\r\n\r\n    this.source = this.ctx.createMediaElementSource(this.audio);\r\n    this.gain = this.ctx.createGain();\r\n    this.filter = this.ctx.createBiquadFilter();\r\n    this.analyser = this.ctx.createAnalyser();\r\n    this.filter.frequency.value = 5000;\r\n    this.analyser.fftSize = 2048;\r\n    this.source.connect(this.gain)\r\n      .connect(this.filter)\r\n      .connect(this.ctx.destination);\r\n\r\n    this.source.connect(this.analyser);\r\n    this.frequencyData = new Uint8Array(this.analyser.frequencyBinCount);\r\n    try {\r\n      await this.audio.play();\r\n    } catch {}\r\n    this.ready = true;\r\n    return this;\r\n  }\r\n\r\n  updateFFT() {\r\n    if(!this.ready) return null;\r\n    this.analyser.getByteFrequencyData(this.frequencyData);\r\n    return this.frequencyData;\r\n  }\r\n}\r\n", "/**\r\n * @description\r\n * VolumetricPass class for matrix-engine-wgpu\r\n * Matches BloomPass architecture \u2014 drop-in standalone pass.\r\n *\r\n * Insert in frame loop after transPass.end(), before bloom:\r\n *   volumetricPass.render(encoder, sceneTextureView, mainDepthView, shadowArrayView, camera, light)\r\n *   bloomPass.render(encoder, volumetricPass.compositeOutputTex.createView(), bloomOutputTex)\r\n *\r\n * @setDensity         - fog density (default 0.03)\r\n * @setSteps           - ray march steps (default 32)\r\n * @setLightColor      - RGB light scattering color\r\n * @setScatterStrength - how bright the scattering is\r\n * @setHeightFalloff   - how fast fog fades with height\r\n */\r\n\r\nexport class VolumetricPass {\r\n  constructor(width, height, device, options = {}) {\r\n    this.enabled = false;\r\n    this.device = device;\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.volumetricTex = this._createTexture(width, height);\r\n\r\n    // Linear sampler \u2014 composite pass\r\n    this.sampler = device.createSampler({\r\n      label: 'VolumetricPass.linearSampler',\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n      addressModeU: 'clamp-to-edge',\r\n      addressModeV: 'clamp-to-edge',\r\n    });\r\n\r\n    // Comparison sampler \u2014 ALL THREE must agree:\r\n    //   device sampler:  { compare: 'less-equal' }\r\n    //   layout entry:    { type: 'comparison' }\r\n    //   WGSL type:       sampler_comparison\r\n    this.depthSampler = device.createSampler({\r\n      label: 'VolumetricPass.comparisonSampler',\r\n      compare: 'less-equal',\r\n    });\r\n\r\n    this.params = {\r\n      density:         options.density         ?? 0.03,\r\n      steps:           options.steps           ?? 32,\r\n      scatterStrength: options.scatterStrength  ?? 1.0,\r\n      heightFalloff:   options.heightFalloff   ?? 0.1,\r\n    };\r\n\r\n    this.lightParams = {\r\n      color:     options.lightColor ?? [1.0, 0.85, 0.6],\r\n      direction: [0.0, -1.0, 0.5],\r\n    };\r\n\r\n    this.paramsBuffer = device.createBuffer({\r\n      label: 'VolumetricPass.paramsBuffer',\r\n      size: 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.invViewProjBuffer = device.createBuffer({\r\n      label: 'VolumetricPass.invViewProjBuffer',\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.lightViewProjBuffer = device.createBuffer({\r\n      label: 'VolumetricPass.lightViewProjBuffer',\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.lightDirBuffer = device.createBuffer({\r\n      label: 'VolumetricPass.lightDirBuffer',\r\n      size: 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.lightColorBuffer = device.createBuffer({\r\n      label: 'VolumetricPass.lightColorBuffer',\r\n      size: 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    this._updateParams();\r\n    this._updateLightColor();\r\n\r\n    this.marchPipeline     = this._createMarchPipeline();\r\n    this.compositePipeline = this._createCompositePipeline();\r\n  }\r\n\r\n  // \u2500\u2500\u2500 Public setters \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\n  setDensity         = (v) => { this.params.density = v;         this._updateParams(); }\r\n  setSteps           = (v) => { this.params.steps = v;           this._updateParams(); }\r\n  setScatterStrength = (v) => { this.params.scatterStrength = v; this._updateParams(); }\r\n  setHeightFalloff   = (v) => { this.params.heightFalloff = v;   this._updateParams(); }\r\n\r\n  setLightColor = (r, g, b) => {\r\n    this.lightParams.color = [r, g, b];\r\n    this._updateLightColor();\r\n  }\r\n\r\n  setLightDirection = (x, y, z) => {\r\n    this.lightParams.direction = [x, y, z];\r\n    this.device.queue.writeBuffer(this.lightDirBuffer, 0, new Float32Array([x, y, z, 0.0]));\r\n  }\r\n\r\n  // \u2500\u2500\u2500 Internal \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\n  _updateParams() {\r\n    this.device.queue.writeBuffer(this.paramsBuffer, 0, new Float32Array([\r\n      this.params.density,\r\n      this.params.steps,\r\n      this.params.scatterStrength,\r\n      this.params.heightFalloff,\r\n    ]));\r\n  }\r\n\r\n  _updateLightColor() {\r\n    this.device.queue.writeBuffer(this.lightColorBuffer, 0,\r\n      new Float32Array([...this.lightParams.color, 0.0]));\r\n  }\r\n\r\n  _createTexture(w, h) {\r\n    return this.device.createTexture({\r\n      label: 'VolumetricPass.texture',\r\n      size: [w, h],\r\n      format: 'rgba16float',\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n  }\r\n\r\n  _beginPass(encoder, targetView, label) {\r\n    return encoder.beginRenderPass({\r\n      label,\r\n      colorAttachments: [{\r\n        view: targetView,\r\n        loadOp: 'clear',\r\n        storeOp: 'store',\r\n        clearValue: { r: 0, g: 0, b: 0, a: 0 }\r\n      }]\r\n    });\r\n  }\r\n\r\n  // \u2500\u2500\u2500 Pipelines \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\n  _createMarchPipeline() {\r\n    const bgl = this.device.createBindGroupLayout({\r\n      label: 'VolumetricPass.marchBGL',\r\n      entries: [\r\n        { binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'depth' } },\r\n        { binding: 1, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'depth', viewDimension: '2d-array' } },\r\n        { binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: { type: 'comparison' } },  // \u2190 must be 'comparison'\r\n        { binding: 3, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\r\n        { binding: 4, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\r\n        { binding: 5, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\r\n        { binding: 6, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\r\n        { binding: 7, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\r\n      ]\r\n    });\r\n    return this.device.createRenderPipeline({\r\n      label: 'VolumetricPass.marchPipeline',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'VolumetricPass.marchPipelineLayout',\r\n        bindGroupLayouts: [bgl]\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({ label: 'VolumetricPass.vert', code: fullscreenVertWGSL() }),\r\n        entryPoint: 'vert'\r\n      },\r\n      fragment: {\r\n        module: this.device.createShaderModule({ label: 'VolumetricPass.marchFrag', code: marchFragWGSL() }),\r\n        entryPoint: 'main',\r\n        targets: [{ format: 'rgba16float' }]\r\n      },\r\n      primitive: { topology: 'triangle-list' }\r\n    });\r\n  }\r\n\r\n  _createCompositePipeline() {\r\n    const bgl = this.device.createBindGroupLayout({\r\n      label: 'VolumetricPass.compositeBGL',\r\n      entries: [\r\n        { binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float' } },\r\n        { binding: 1, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float' } },\r\n        { binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: { type: 'filtering' } },\r\n        { binding: 3, visibility: GPUShaderStage.FRAGMENT, buffer: { type: 'uniform' } },\r\n      ]\r\n    });\r\n    return this.device.createRenderPipeline({\r\n      label: 'VolumetricPass.compositePipeline',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'VolumetricPass.compositePipelineLayout',\r\n        bindGroupLayouts: [bgl]\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({ label: 'VolumetricPass.compositeVert', code: fullscreenVertWGSL() }),\r\n        entryPoint: 'vert'\r\n      },\r\n      fragment: {\r\n        module: this.device.createShaderModule({ label: 'VolumetricPass.compositeFrag', code: compositeFragWGSL() }),\r\n        entryPoint: 'main',\r\n        targets: [{ format: 'rgba16float' }]\r\n      },\r\n      primitive: { topology: 'triangle-list' }\r\n    });\r\n  }\r\n\r\n  // \u2500\u2500\u2500 Bind Groups \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\n  _marchBindGroup(depthView, shadowArrayView) {\r\n    return this.device.createBindGroup({\r\n      label: 'VolumetricPass.marchBindGroup',\r\n      layout: this.marchPipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        { binding: 0, resource: depthView },\r\n        { binding: 1, resource: shadowArrayView },\r\n        { binding: 2, resource: this.depthSampler },        // comparison sampler\r\n        { binding: 3, resource: { buffer: this.invViewProjBuffer } },\r\n        { binding: 4, resource: { buffer: this.lightViewProjBuffer } },\r\n        { binding: 5, resource: { buffer: this.lightDirBuffer } },\r\n        { binding: 6, resource: { buffer: this.lightColorBuffer } },\r\n        { binding: 7, resource: { buffer: this.paramsBuffer } },\r\n      ]\r\n    });\r\n  }\r\n\r\n  _compositeBindGroup(sceneView) {\r\n    return this.device.createBindGroup({\r\n      label: 'VolumetricPass.compositeBindGroup',\r\n      layout: this.compositePipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        { binding: 0, resource: sceneView },\r\n        { binding: 1, resource: this.volumetricTex.createView() },\r\n        { binding: 2, resource: this.sampler },\r\n        { binding: 3, resource: { buffer: this.paramsBuffer } },\r\n      ]\r\n    });\r\n  }\r\n\r\n  // \u2500\u2500\u2500 Render \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  /**\r\n   * @param {GPUCommandEncoder} encoder\r\n   * @param {GPUTextureView} sceneView        \u2014 your sceneTextureView\r\n   * @param {GPUTextureView} depthView        \u2014 your mainDepthView\r\n   * @param {GPUTextureView} shadowArrayView  \u2014 your shadowArrayView\r\n   * @param {object} camera  \u2014 { invViewProjectionMatrix: Float32Array(16) }\r\n   * @param {object} light   \u2014 { viewProjectionMatrix: Float32Array(16), direction: [x,y,z] }\r\n   */\r\n  render(encoder, sceneView, depthView, shadowArrayView, camera, light) {\r\n    this.device.queue.writeBuffer(this.invViewProjBuffer,   0, camera.invViewProjectionMatrix);\r\n    this.device.queue.writeBuffer(this.lightViewProjBuffer, 0, light.viewProjectionMatrix);\r\n    this.device.queue.writeBuffer(this.lightDirBuffer,      0, new Float32Array([...light.direction, 0.0]));\r\n\r\n    // Pass 1 \u2014 ray march \u2192 volumetricTex\r\n    {\r\n      const pass = this._beginPass(encoder, this.volumetricTex.createView(), 'VolumetricPass.marchPass');\r\n      pass.setPipeline(this.marchPipeline);\r\n      pass.setBindGroup(0, this._marchBindGroup(depthView, shadowArrayView));\r\n      pass.draw(6);\r\n      pass.end();\r\n    }\r\n\r\n    // Pass 2 \u2014 composite \u2192 compositeOutputTex (feed this to bloomPass instead of sceneTextureView)\r\n    {\r\n      const pass = this._beginPass(encoder, this.compositeOutputTex.createView(), 'VolumetricPass.compositePass');\r\n      pass.setPipeline(this.compositePipeline);\r\n      pass.setBindGroup(0, this._compositeBindGroup(sceneView));\r\n      pass.draw(6);\r\n      pass.end();\r\n    }\r\n  }\r\n\r\n  /** Call once after constructor. Chainable: new VolumetricPass(...).init() */\r\n  init() {\r\n    this.compositeOutputTex = this._createTexture(this.width, this.height);\r\n    return this;\r\n  }\r\n\r\n  /** Call on canvas resize */\r\n  resize(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.volumetricTex      = this._createTexture(width, height);\r\n    this.compositeOutputTex = this._createTexture(width, height);\r\n  }\r\n}\r\n\r\n\r\n// \u2500\u2500\u2500 WGSL Shaders \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport function fullscreenVertWGSL() {\r\n  return /* wgsl */`\r\n    @vertex\r\n    fn vert(@builtin(vertex_index) i: u32) -> @builtin(position) vec4<f32> {\r\n      var pos = array<vec2<f32>, 6>(\r\n        vec2(-1.0, -1.0), vec2(1.0, -1.0), vec2(-1.0,  1.0),\r\n        vec2(-1.0,  1.0), vec2(1.0, -1.0), vec2(1.0,  1.0)\r\n      );\r\n      return vec4(pos[i], 0.0, 1.0);\r\n    }\r\n  `;\r\n}\r\n\r\nfunction marchFragWGSL() {\r\n  return /* wgsl */`\r\n\r\n  @group(0) @binding(0) var depthTex:   texture_depth_2d;\r\n  @group(0) @binding(1) var shadowTex:  texture_depth_2d_array;\r\n  @group(0) @binding(2) var cmpSamp:    sampler_comparison;\r\n  @group(0) @binding(3) var<uniform> invViewProj:   mat4x4<f32>;\r\n  @group(0) @binding(4) var<uniform> lightViewProj: mat4x4<f32>;\r\n  @group(0) @binding(5) var<uniform> lightDir:      vec4<f32>;\r\n  @group(0) @binding(6) var<uniform> lightColor:    vec4<f32>;\r\n\r\n  struct Params { density: f32, steps: f32, scatterStrength: f32, heightFalloff: f32 }\r\n  @group(0) @binding(7) var<uniform> params: Params;\r\n\r\n  fn worldPos(uv: vec2<f32>, depth: f32) -> vec3<f32> {\r\n    let ndc   = vec4(uv.x * 2.0 - 1.0, (1.0 - uv.y) * 2.0 - 1.0, depth, 1.0);\r\n    let world = invViewProj * ndc;\r\n    return world.xyz / world.w;\r\n  }\r\n\r\n  fn fogDensity(p: vec3<f32>) -> f32 {\r\n    return params.density * exp(-max(p.y, 0.0) * params.heightFalloff);\r\n  }\r\n\r\n  @fragment\r\n  fn main(@builtin(position) fc: vec4<f32>) -> @location(0) vec4<f32> {\r\n    let sz    = vec2<f32>(textureDimensions(depthTex));\r\n    let uv    = fc.xy / sz;\r\n    let depth = textureLoad(depthTex, vec2<i32>(fc.xy), 0);\r\n\r\n    let ro    = worldPos(uv, 0.0);\r\n    let rt    = worldPos(uv, depth);\r\n    let rlen  = length(rt - ro);\r\n    let rdir  = normalize(rt - ro);\r\n    let steps = max(i32(params.steps), 8);\r\n    let step  = rlen / f32(steps);\r\n\r\n    var accum = vec3<f32>(0.0);\r\n    var trans = 1.0;\r\n\r\n    for (var i = 0; i < steps; i++) {\r\n      let p = ro + rdir * ((f32(i) + 0.5) * step);\r\n\r\n      // \u2500\u2500 textureSampleCompare MUST be in uniform control flow \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n      // Compute shadow coords for every sample unconditionally.\r\n      // Gate the contribution with branchless math \u2014 never use if/continue/break above this call.\r\n      let ls  = lightViewProj * vec4(p, 1.0);\r\n      let lp  = ls.xyz / ls.w;\r\n      let suv = lp.xy * 0.5 + 0.5;\r\n\r\n      let shadow   = textureSampleCompare(shadowTex, cmpSamp, suv, 0, lp.z - 0.002);\r\n      let inBounds = f32(suv.x >= 0.0 && suv.x <= 1.0 && suv.y >= 0.0 && suv.y <= 1.0);\r\n      let lit      = shadow * inBounds;\r\n\r\n      let d   = fogDensity(p) * step;\r\n      let ext = exp(-d);\r\n      let s   = trans * (1.0 - ext) * lit * params.scatterStrength * f32(d > 0.0001);\r\n\r\n      accum += s * lightColor.rgb;\r\n      trans *= select(1.0, ext, d > 0.0001);\r\n    }\r\n\r\n    return vec4<f32>(accum, 1.0 - trans);\r\n  }\r\n  `;\r\n}\r\n\r\nfunction compositeFragWGSL() {\r\n  return /* wgsl */`\r\n\r\n  @group(0) @binding(0) var sceneTex: texture_2d<f32>;\r\n  @group(0) @binding(1) var volTex:   texture_2d<f32>;\r\n  @group(0) @binding(2) var samp:     sampler;\r\n  struct Params { density: f32, steps: f32, scatterStrength: f32, heightFalloff: f32 }\r\n  @group(0) @binding(3) var<uniform> params: Params;\r\n\r\n  @fragment\r\n  fn main(@builtin(position) fc: vec4<f32>) -> @location(0) vec4<f32> {\r\n    let uv    = fc.xy / vec2<f32>(textureDimensions(sceneTex));\r\n    let scene = textureSample(sceneTex, samp, uv);\r\n    let vol   = textureSample(volTex, samp, uv);\r\n    // vol.rgb = scattered light | vol.a = fog opacity\r\n    return vec4<f32>(scene.rgb * (1.0 - vol.a) + vol.rgb, scene.a);\r\n  }\r\n  `;\r\n}", "import {mat4, vec3} from \"wgpu-matrix\";\r\nimport {ArcballCamera, RPGCamera, WASDCamera} from \"./engine/engine.js\";\r\nimport {createInputHandler} from \"./engine/engine.js\";\r\nimport MEMeshObj from \"./engine/mesh-obj.js\";\r\nimport MatrixAmmo from \"./physics/matrix-ammo.js\";\r\nimport {LOG_FUNNY_BIG_ARCADE, LOG_FUNNY_ARCADE, LOG_FUNNY_BIG_NEON, LOG_WARN, genName, mb, urlQuery, LOG_FUNNY, LOG_FUNNY_EXTRABIG} from \"./engine/utils.js\";\r\nimport {MultiLang} from \"./multilang/lang.js\";\r\nimport {MatrixSounds} from \"./sounds/sounds.js\";\r\nimport {downloadMeshes, play} from \"./engine/loader-obj.js\";\r\nimport {SpotLight} from \"./engine/lights.js\";\r\nimport {BVHPlayer} from \"./engine/loaders/bvh.js\";\r\nimport {BVHPlayerInstances} from \"./engine/loaders/bvh-instaced.js\";\r\nimport {Editor} from \"./tools/editor/editor.js\";\r\nimport MEMeshObjInstances from \"./engine/instanced/mesh-obj-instances.js\";\r\nimport {BloomPass, fullscreenQuadWGSL} from \"./engine/postprocessing/bloom.js\";\r\nimport {addRaycastsListener} from \"./engine/raycast.js\";\r\nimport {addOBJ, physicsBodiesGenerator, physicsBodiesGeneratorDeepPyramid, physicsBodiesGeneratorPyramid, physicsBodiesGeneratorTower, physicsBodiesGeneratorWall} from \"./engine/generators/generator.js\";\r\nimport {TextureCache} from \"./engine/core-cache.js\";\r\nimport {AudioAssetManager} from \"./sounds/audioAsset.js\";\r\nimport {graphAdapter} from \"./tools/editor/flexCodexShaderAdapter.js\";\r\nimport {VolumetricPass} from \"./engine/postprocessing/volumetric.js\";\r\n\r\n/**\r\n * @description\r\n * Main engine root class.\r\n * @author Nikola Lukic 2025\r\n * @email zlatnaspirala@gmail.com\r\n * @web https://maximumroulette.com\r\n * @github zlatnaspirala\r\n */\r\nexport default class MatrixEngineWGPU {\r\n  // save class reference\r\n  reference = {\r\n    MEMeshObj,\r\n    MEMeshObjInstances,\r\n    BVHPlayerInstances,\r\n    BVHPlayer,\r\n    downloadMeshes,\r\n    addRaycastsListener,\r\n    graphAdapter\r\n  }\r\n\r\n  mainRenderBundle = [];\r\n  lightContainer = [];\r\n  frame = () => {};\r\n  entityHolder = [];\r\n  lastTime = 0;\r\n  entityArgPass = {\r\n    loadOp: 'clear',\r\n    storeOp: 'store',\r\n    depthLoadOp: 'clear',\r\n    depthStoreOp: 'store'\r\n  }\r\n\r\n  matrixSounds = new MatrixSounds();\r\n  audioManager = new AudioAssetManager();\r\n\r\n  constructor(options, callback) {\r\n    if(typeof options == 'undefined' || typeof options == \"function\") {\r\n      this.options = {\r\n        useSingleRenderPass: true,\r\n        canvasSize: 'fullscreen',\r\n        canvasId: 'canvas1',\r\n        mainCameraParams: {\r\n          type: 'WASD',\r\n          responseCoef: 2000\r\n        },\r\n        clearColor: {r: 0.584, g: 0, b: 0.239, a: 1.0}\r\n      }\r\n      callback = options;\r\n    }\r\n    if(typeof options.clearColor === 'undefined') {\r\n      options.clearColor = {r: 0.584, g: 0, b: 0.239, a: 1.0};\r\n    }\r\n    if(typeof options.canvasId === 'undefined') {\r\n      options.canvasId = 'canvas1';\r\n    }\r\n    if(typeof options.mainCameraParams === 'undefined') {\r\n      options.mainCameraParams = {\r\n        type: 'WASD',\r\n        responseCoef: 2000\r\n      }\r\n    }\r\n\r\n    // in case of optimisation\r\n    if(typeof options.dontUsePhysics == 'undefined') {\r\n      this.physicsBodiesGenerator = physicsBodiesGenerator.bind(this);\r\n      this.physicsBodiesGeneratorWall = physicsBodiesGeneratorWall.bind(this);\r\n      this.physicsBodiesGeneratorPyramid = physicsBodiesGeneratorPyramid.bind(this);\r\n      this.physicsBodiesGeneratorTower = physicsBodiesGeneratorTower.bind(this);\r\n      this.physicsBodiesGeneratorDeepPyramid = physicsBodiesGeneratorDeepPyramid.bind(this);\r\n    }\r\n    this.editorAddOBJ = addOBJ.bind(this);\r\n\r\n    this.logLoopError = true;\r\n    // context select options\r\n    if(typeof options.alphaMode == 'undefined') {\r\n      options.alphaMode = \"no\";\r\n    } else if(options.alphaMode != 'opaque' && options.alphaMode != 'premultiplied') {\r\n      console.error(\"[webgpu][alphaMode] Wrong enum Valid:'opaque','premultiplied' !!!\");\r\n      return;\r\n    }\r\n    if(typeof options.useContex == 'undefined') {\r\n      options.useContex = \"webgpu\";\r\n      // this.context = canvas.getContext('webgpu', { alphaMode: 'opaque' });\r\n      // this.context = canvas.getContext('webgpu', { alphaMode: 'premultiplied' });\r\n    }\r\n\r\n    if(typeof options.dontUsePhysics == 'undefined') {\r\n      this.matrixAmmo = new MatrixAmmo();\r\n    }\r\n\r\n    this.editor = undefined;\r\n    if(typeof options.useEditor !== \"undefined\") {\r\n      if(typeof options.projectType !== \"undefined\" && options.projectType == \"created from editor\") {\r\n        this.editor = new Editor(this, \"created from editor\", options.projectName);\r\n      } else if(typeof options.projectType !== \"undefined\" && options.projectType == \"pre editor\") {\r\n        this.editor = new Editor(this, options.projectType);\r\n      } else {\r\n        this.editor = new Editor(this, \"infly\");\r\n      }\r\n    }\r\n\r\n    window.addEventListener('keydown', e => {\r\n      if(e.code == \"F4\") {\r\n        e.preventDefault();\r\n        mb.error(`Activated WebEditor view.`);\r\n        app.activateEditor();\r\n        return false;\r\n      }\r\n    });\r\n\r\n    this.activateEditor = () => {\r\n      if(this.editor == null || typeof this.editor === 'undefined') {\r\n        if(typeof options.projectType !== \"undefined\" && options.projectType == \"created from editor\") {\r\n          this.editor = new Editor(this, \"created from editor\");\r\n        } else if(typeof options.projectType !== \"undefined\" && options.projectType == \"pre editor\") {\r\n          this.editor = new Editor(this, options.projectType);\r\n        } else {\r\n          this.editor = new Editor(this, \"infly\");\r\n        }\r\n        this.editor.editorHud.updateSceneContainer();\r\n      } else {\r\n        this.editor.editorHud.editorMenu.style.display = 'flex';\r\n        this.editor.editorHud.assetsBox.style.display = 'flex';\r\n        this.editor.editorHud.sceneProperty.style.display = 'flex';\r\n        this.editor.editorHud.sceneContainer.style.display = 'flex';\r\n      }\r\n    };\r\n\r\n    this.options = options;\r\n    this.mainCameraParams = options.mainCameraParams;\r\n\r\n    const target = this.options.appendTo || document.body;\r\n    var canvas = document.createElement('canvas');\r\n    canvas.id = this.options.canvasId;\r\n    if(this.options.canvasSize == 'fullscreen') {\r\n      canvas.width = window.innerWidth;\r\n      canvas.height = window.innerHeight;\r\n    } else {\r\n      canvas.width = this.options.canvasSize.w;\r\n      canvas.height = this.options.canvasSize.h;\r\n    }\r\n    target.append(canvas);\r\n    // The camera types\r\n    const initialCameraPosition = vec3.create(0, 0, 0);\r\n    this.mainCameraParams = {\r\n      type: this.options.mainCameraParams.type,\r\n      responseCoef: this.options.mainCameraParams.responseCoef\r\n    };\r\n\r\n    // add defaul generatl config later\r\n    this.cameras = {\r\n      arcball: new ArcballCamera({position: initialCameraPosition}),\r\n      WASD: new WASDCamera({position: initialCameraPosition, canvas: canvas, pitch: 0.18, yaw: -0.1}),\r\n      RPG: new RPGCamera({position: initialCameraPosition, canvas: canvas}),\r\n    };\r\n\r\n    this.label = new MultiLang()\r\n    if(urlQuery.lang != null) {\r\n      this.label.loadMultilang(urlQuery.lang).then((r) => {\r\n        this.label.get = r;\r\n      }).catch((r) => {\r\n        this.label.get = r;\r\n      });\r\n    } else {\r\n      this.label.loadMultilang().then((r) => {\r\n        this.label.get = r;\r\n      }).catch((r) => {\r\n        this.label.get = r;\r\n      });;\r\n    }\r\n    this.init({canvas, callback})\r\n  }\r\n\r\n  init = async ({canvas, callback}) => {\r\n    this.canvas = canvas;\r\n    this.adapter = await navigator.gpu.requestAdapter();\r\n    this.device = await this.adapter.requestDevice({\r\n      extensions: [\"ray_tracing\"]\r\n    });\r\n\r\n    if(this.options.alphaMode == \"no\") {\r\n      this.context = canvas.getContext('webgpu');\r\n    } else if(this.options.alphaMode == \"opaque\") {\r\n      this.context = canvas.getContext('webgpu', {alphaMode: 'opaque'});\r\n    } else if(this.options.alphaMode == \"opaque\") {\r\n      this.context = canvas.getContext('webgpu', {alphaMode: 'premultiplied'});\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio;\r\n    canvas.width = canvas.clientWidth * devicePixelRatio;\r\n    canvas.height = canvas.clientHeight * devicePixelRatio;\r\n    const presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n\r\n    this.context.configure({\r\n      device: this.device,\r\n      format: presentationFormat,\r\n      alphaMode: 'premultiplied',\r\n    });\r\n\r\n    // if(this.options.useSingleRenderPass == true) {\r\n    this.frame = this.frameSinglePass;\r\n\r\n    this.globalAmbient = vec3.create(0.5, 0.5, 0.5);\r\n    this.MAX_SPOTLIGHTS = 20;\r\n    this.inputHandler = createInputHandler(window, canvas);\r\n    this.createGlobalStuff();\r\n    this.shadersPack = {};\r\n\r\n    console.log(\"%c ---------------------------------------------------------------------------------------------- \", LOG_FUNNY);\r\n    console.log(\"%c \uD83E\uDDEC Matrix-Engine-Wgpu \uD83E\uDDEC \", LOG_FUNNY_BIG_NEON);\r\n    console.log(\"%c ---------------------------------------------------------------------------------------------- \", LOG_FUNNY);\r\n    console.log(\"%c Version 1.9.0 \", LOG_FUNNY);\r\n    console.log(\"%c\uD83D\uDC7D  \", LOG_FUNNY_EXTRABIG);\r\n    console.log(\r\n      \"%cMatrix Engine WGPU - Port is open.\\n\" +\r\n      \"Creative power loaded with visual scripting.\\n\" +\r\n      \"Last features : Adding Gizmo , Optimised render in name of performance,\\n\" +\r\n      \" audioReactiveNode, onDraw , onKey , curve editor.\\n\" +\r\n      \"No tracking. No hype. Just solutions. \uD83D\uDD25\", LOG_FUNNY_BIG_ARCADE);\r\n    console.log(\r\n      \"%cSource code: \uD83D\uDC49 GitHub:\\nhttps://github.com/zlatnaspirala/matrix-engine-wgpu\",\r\n      LOG_FUNNY_ARCADE);\r\n    // pseude async\r\n    setTimeout(() => {this.run(callback)}, 50);\r\n  };\r\n\r\n  createGlobalStuff() {\r\n    // OPTIMISATION\r\n    this.textureCache = new TextureCache(this.device);\r\n    this._destroyQueue = new Set();\r\n    this.flushDestroyQueue = () => {\r\n      if(!this._destroyQueue.size) return;\r\n      this._destroyQueue.forEach(name => {\r\n        this.removeSceneObjectByName(name);\r\n      });\r\n      this._destroyQueue.clear();\r\n    };\r\n    this.destroyByPrefix = (prefix) => {\r\n      const toDestroy = [];\r\n      for(const obj of this.mainRenderBundle) {\r\n        if(obj.name.startsWith(prefix)) {\r\n          toDestroy.push(obj.name);\r\n        }\r\n      }\r\n      toDestroy.forEach(name =>\r\n        this._destroyQueue.add(name)\r\n      );\r\n    };\r\n    this.destroyBySufix = (sufix) => {\r\n      const toDestroy = [];\r\n      for(const obj of this.mainRenderBundle) {\r\n        if(obj.name.endsWith(sufix)) {\r\n          toDestroy.push(obj.name);\r\n        }\r\n      }\r\n      toDestroy.forEach(name =>\r\n        this._destroyQueue.add(name)\r\n      );\r\n    }\r\n\r\n    // Just syntetic to help visual scripting part\r\n    this.bloomPass = {\r\n      enabled: false,\r\n      setIntensity: (v) => {},\r\n      setKnee: (v) => {},\r\n      setBlurRadius: (v) => {},\r\n      setThreshold: (v) => {},\r\n    };\r\n\r\n    this.volumetricPass = {\r\n      enabled: false\r\n    };\r\n\r\n    this.bloomOutputTex = this.device.createTexture({\r\n      size: [this.canvas.width, this.canvas.height],\r\n      format: 'rgba16float',\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n\r\n    this.sceneTexture = this.device.createTexture({\r\n      label: \"final pipeline sceneTexture\",\r\n      size: [this.canvas.width, this.canvas.height],\r\n      format: 'rgba16float',\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING\r\n    });\r\n\r\n    this.sceneTextureView = this.sceneTexture.createView();\r\n\r\n    this.presentSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear'\r\n    });\r\n\r\n    this.presentPipeline = this.device.createRenderPipeline({\r\n      label: \"final pipeline\",\r\n      layout: 'auto',\r\n      vertex: {\r\n        module: this.device.createShaderModule({code: fullscreenQuadWGSL()}),\r\n        entryPoint: 'vert',\r\n      },\r\n      fragment: {\r\n        module: this.device.createShaderModule({\r\n          code: `\r\n        @group(0) @binding(0) var hdrTex : texture_2d<f32>;\r\n        @group(0) @binding(1) var samp : sampler;\r\n\r\n        @fragment\r\n        fn main(@builtin(position) pos: vec4<f32>) -> @location(0) vec4<f32> {\r\n          let uv = pos.xy / vec2<f32>(textureDimensions(hdrTex));\r\n          let hdr = textureSample(hdrTex, samp, uv).rgb;\r\n\r\n          // simple tonemap\r\n          let ldr = hdr / (hdr + vec3(1.0));\r\n\r\n          return vec4<f32>(ldr, 1.0);\r\n        }\r\n      `\r\n        }),\r\n        entryPoint: 'main',\r\n        targets: [{format: 'bgra8unorm'}], // rgba16float  bgra8unorm\r\n      },\r\n    });\r\n\r\n    this.createBloomBindGroup();\r\n\r\n    this.spotlightUniformBuffer = this.device.createBuffer({\r\n      label: 'spotlightUniformBufferGLOBAL',\r\n      size: this.MAX_SPOTLIGHTS * 144,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    this.SHADOW_RES = 1024;\r\n    this.createTexArrayForShadows()\r\n\r\n    this.mainDepthTexture = this.device.createTexture({\r\n      size: [this.canvas.width, this.canvas.height],\r\n      format: 'depth24plus',\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n\r\n    this.mainDepthView = this.mainDepthTexture.createView();\r\n\r\n    this.mainRenderPassDesc = {\r\n      label: 'mainRenderPassDesc',\r\n      colorAttachments: [{\r\n        view: undefined,                // set each frame\r\n        loadOp: 'clear',\r\n        storeOp: 'store',\r\n        clearValue: [0.02, 0.02, 0.02, 1],\r\n      }],\r\n      depthStencilAttachment: {\r\n        view: this.mainDepthView,       // fixed\r\n        depthLoadOp: 'clear',\r\n        depthStoreOp: 'store',\r\n        depthClearValue: 1.0,\r\n      },\r\n    };\r\n\r\n    // pointer effect-not in use\r\n    const depthTexture = this.device.createTexture({\r\n      size: [this.canvas.width, this.canvas.height],\r\n      format: \"depth24plus\",\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\r\n    });\r\n\r\n    this.depthTextureViewTrail = depthTexture.createView();\r\n  }\r\n\r\n  createTexArrayForShadows() {\r\n    let numberOfLights = this.lightContainer.length;\r\n    if(this.lightContainer.length == 0) {\r\n      setTimeout(() => {\r\n        // console.info('Test light again...')\r\n        this.createMe();\r\n      }, 800);\r\n    }\r\n\r\n    this.createMe = () => {\r\n      Math.max(1, this.lightContainer.length);\r\n      if(this.lightContainer.length == 0) {\r\n        setTimeout(() => {\r\n          // console.info('Create now test...')\r\n          this.createMe();\r\n        }, 800);\r\n        return;\r\n      }\r\n\r\n      // console.warn('Create this.shadowTextureArray...')\r\n      this.shadowTextureArray = this.device.createTexture({\r\n        label: `shadowTextureArray[GLOBAL] num of light ${numberOfLights}`,\r\n        size: {\r\n          width: 1024,\r\n          height: 1024,\r\n          depthOrArrayLayers: numberOfLights, // at least 1\r\n        },\r\n        dimension: '2d',\r\n        format: 'depth32float',\r\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n      });\r\n\r\n      this.shadowArrayView = this.shadowTextureArray.createView({\r\n        dimension: '2d-array'\r\n      });\r\n\r\n      this.shadowVideoTexture = this.device.createTexture({\r\n        size: [1024, 1024],\r\n        format: \"depth32float\",\r\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n      });\r\n\r\n      this.shadowVideoView = this.shadowVideoTexture.createView({\r\n        dimension: \"2d\",\r\n      });\r\n    }\r\n\r\n    this.createMe();\r\n  }\r\n\r\n  getSceneObjectByName = (name) => {return this.mainRenderBundle.find((sceneObject) => sceneObject.name === name)}\r\n\r\n  getSceneLightByName = (name) => {return this.lightContainer.find((l) => l.name === name)}\r\n\r\n  getNameFromPath(p) {return p.split(/[/\\\\]/).pop().replace(/\\.[^/.]+$/, \"\");}\r\n\r\n  removeSceneObjectByName = (name) => {\r\n    const index = this.mainRenderBundle.findIndex(obj => obj.name === name);\r\n    if(index === -1) {\r\n      console.warn(\"%cScene object not found:\" + name, LOG_FUNNY_ARCADE);\r\n      return false;\r\n    }\r\n    const obj = this.mainRenderBundle[index];\r\n    let testPB = app.matrixAmmo.getBodyByName(obj.name);\r\n    if(testPB !== null) {\r\n      try {\r\n        this.matrixAmmo.dynamicsWorld.removeRigidBody(testPB);\r\n      } catch(e) {\r\n        console.warn(\"%cPhysics cleanup error:\" + e, LOG_FUNNY_ARCADE);\r\n      }\r\n    }\r\n    this.mainRenderBundle.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  addLight(o) {\r\n    const camera = this.cameras[this.mainCameraParams.type];\r\n    let newLight = new SpotLight(camera, this.inputHandler, this.device, this.lightContainer.length);\r\n    this.lightContainer.push(newLight);\r\n    this.createTexArrayForShadows();\r\n    console.log(`%cAdd light: ${newLight}`, LOG_FUNNY_ARCADE);\r\n  }\r\n\r\n  addMeshObj = (o, clearColor = this.options.clearColor) => {\r\n    if(typeof o.name === 'undefined') {o.name = genName(9)}\r\n    if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n    if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n    if(typeof o.material === 'undefined') {o.material = {type: 'standard'}}\r\n    if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n    if(typeof o.scale === 'undefined') {o.scale = [1, 1, 1];}\r\n    if(typeof o.raycast === 'undefined') {o.raycast = {enabled: false, radius: 2}}\r\n    if(typeof o.useScale === 'undefined') {o.useScale = false;}\r\n    o.entityArgPass = this.entityArgPass;\r\n    o.cameras = this.cameras;\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\", // must be fixed<<\r\n        radius: (typeof o.scale == Number ? o.scale : o.scale[0]),\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Cube\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n    o.physics.position = o.position;\r\n    if(typeof o.objAnim == 'undefined' || typeof o.objAnim == null) {\r\n      o.objAnim = null;\r\n    } else {\r\n      if(typeof o.objAnim.animations !== 'undefined') {\r\n        o.objAnim.play = play;\r\n      }\r\n      // no need for single test it in future\r\n      o.objAnim.meshList = o.objAnim.meshList;\r\n      if(typeof o.mesh === 'undefined') {\r\n        o.mesh = o.objAnim.meshList[0];\r\n        console.info('objSeq animation is active.');\r\n      }\r\n      // scale for all second option!\r\n      o.objAnim.scaleAll = function(s) {\r\n        for(var k in this.meshList) {\r\n          // console.log('SCALE meshList');\r\n          this.meshList[k].setScale(s);\r\n        }\r\n      }\r\n    }\r\n\r\n    o.textureCache = this.textureCache;\r\n    let AM = this.globalAmbient.slice();\r\n    let myMesh1 = new MEMeshObj(this.canvas, this.device, this.context, o, this.inputHandler, AM);\r\n    myMesh1.spotlightUniformBuffer = this.spotlightUniformBuffer;\r\n    myMesh1.clearColor = clearColor;\r\n    if(o.physics.enabled == true) {\r\n      this.matrixAmmo.addPhysics(myMesh1, o.physics)\r\n    }\r\n    this.mainRenderBundle.push(myMesh1);\r\n\r\n    if(typeof this.editor !== 'undefined') {\r\n      this.editor.editorHud.updateSceneContainer();\r\n    }\r\n  }\r\n\r\n  createBloomBindGroup() {\r\n    this.bloomBindGroup = this.device.createBindGroup({\r\n      layout: this.presentPipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        {binding: 0, resource: this.bloomOutputTex},\r\n        {binding: 1, resource: this.presentSampler}\r\n      ]\r\n    })\r\n    this.noBloomBindGroup = this.device.createBindGroup({\r\n      layout: this.presentPipeline.getBindGroupLayout(0),\r\n      entries: [\r\n        {binding: 0, resource: this.sceneTexture.createView()},\r\n        {binding: 1, resource: this.presentSampler}\r\n      ]\r\n    })\r\n  }\r\n\r\n  async run(callback) {\r\n    // await this.device.queue.onSubmittedWorkDone();\r\n    setTimeout(() => {requestAnimationFrame(this.frame)}, 1000);\r\n    setTimeout(() => {callback(this)}, 1)\r\n  }\r\n\r\n  destroyProgram = () => {\r\n    console.warn('%c[MatrixEngineWGPU] Destroy program', 'color: orange');\r\n\r\n    // 1\uFE0F\u20E3 Stop render loop\r\n    this.frame = () => {};\r\n    if(this._rafId) {\r\n      cancelAnimationFrame(this._rafId);\r\n      this._rafId = null;\r\n    }\r\n\r\n    // 2\uFE0F\u20E3 Destroy scene objects\r\n    for(const obj of this.mainRenderBundle) {\r\n      try {\r\n        obj?.destroy?.();\r\n      } catch(e) {\r\n        console.warn('Object destroy error:', obj?.name, e);\r\n      }\r\n    }\r\n    this.mainRenderBundle.length = 0;\r\n\r\n    // 3\uFE0F\u20E3 Physics\r\n    this.matrixAmmo?.destroy?.();\r\n    this.matrixAmmo = null;\r\n\r\n    // 4\uFE0F\u20E3 Editor\r\n    this.editor?.destroy?.();\r\n    this.editor = null;\r\n\r\n    // 5\uFE0F\u20E3 Input\r\n    this.inputHandler?.destroy?.();\r\n    this.inputHandler = null;\r\n\r\n    // 6\uFE0F\u20E3 GLOBAL GPU RESOURCES\r\n    this.mainDepthTexture?.destroy();\r\n    this.shadowTextureArray?.destroy();\r\n    this.shadowVideoTexture?.destroy();\r\n\r\n    this.mainDepthTexture = null;\r\n    this.shadowTextureArray = null;\r\n    this.shadowVideoTexture = null;\r\n\r\n    // 7\uFE0F\u20E3 Lose WebGPU context\r\n    try {\r\n      this.context?.unconfigure?.();\r\n    } catch {}\r\n\r\n    // 8\uFE0F\u20E3 Canvas\r\n    this.canvas?.remove();\r\n\r\n    this.canvas = null;\r\n    this.device = null;\r\n    this.context = null;\r\n    this.adapter = null;\r\n\r\n    console.warn('%c[MatrixEngineWGPU] Destroy complete \u2714', 'color: lightgreen');\r\n  };\r\n\r\n  updateLights() {\r\n    const floatsPerLight = 36; // not 20 anymore\r\n    const data = new Float32Array(this.MAX_SPOTLIGHTS * floatsPerLight);\r\n    for(let i = 0;i < this.MAX_SPOTLIGHTS;i++) {\r\n      if(i < this.lightContainer.length) {\r\n        const buf = this.lightContainer[i].getLightDataBuffer();\r\n        data.set(buf, i * floatsPerLight);\r\n      } else {\r\n        data.set(new Float32Array(floatsPerLight), i * floatsPerLight);\r\n      }\r\n    }\r\n    this.device.queue.writeBuffer(this.spotlightUniformBuffer, 0, data.buffer);\r\n  }\r\n\r\n  frameSinglePass = () => {\r\n    if(typeof this.mainRenderBundle == 'undefined' || this.mainRenderBundle.length == 0) {\r\n      setTimeout(() => {requestAnimationFrame(this.frame)}, 100);\r\n      return;\r\n    }\r\n    let now;\r\n    const currentTime = performance.now() / 1000;\r\n    const bufferUpdates = [];\r\n    this.mainRenderBundle.forEach((m, index) => {\r\n      if(m.vertexAnimBuffer && m.vertexAnimParams) {\r\n        m.time = currentTime * m.deltaTimeAdapter;\r\n        m.vertexAnimParams[0] = m.time;\r\n        bufferUpdates.push({\r\n          buffer: m.vertexAnimBuffer,\r\n          data: m.vertexAnimParams\r\n        });\r\n      }\r\n      if(m.isVideo == true) {\r\n        if(!m.externalTexture) {\r\n          m.createBindGroupForRender();\r\n          setTimeout(() => {\r\n            requestAnimationFrame(this.frame)\r\n          }, 300)\r\n          return;\r\n        }\r\n      }\r\n    })\r\n    for(const update of bufferUpdates) {\r\n      this.device.queue.writeBuffer(update.buffer, 0, update.data);\r\n    }\r\n    try {\r\n      let commandEncoder = this.device.createCommandEncoder();\r\n      if(this.matrixAmmo) this.matrixAmmo.updatePhysics();\r\n      this.updateLights();\r\n\r\n      // update meshes\r\n      this.mainRenderBundle.forEach((mesh, index) => {\r\n        mesh.position.update();\r\n        mesh.updateModelUniformBuffer();\r\n        if(mesh.update) mesh.update();\r\n        this.lightContainer.forEach((light) => {\r\n          light.update();\r\n          mesh.getTransformationMatrix(this.mainRenderBundle, light, index);\r\n        })\r\n      })\r\n\r\n      for(let i = 0;i < this.lightContainer.length;i++) {\r\n        const light = this.lightContainer[i];\r\n        let ViewPerLightRenderShadowPass = this.shadowTextureArray.createView({\r\n          dimension: '2d',\r\n          baseArrayLayer: i,\r\n          arrayLayerCount: 1, // must be > 0\r\n          baseMipLevel: 0,\r\n          mipLevelCount: 1,\r\n        });\r\n\r\n        const shadowPass = commandEncoder.beginRenderPass({\r\n          label: \"shadowPass\",\r\n          colorAttachments: [],\r\n          depthStencilAttachment: {\r\n            view: ViewPerLightRenderShadowPass,\r\n            depthLoadOp: 'clear',\r\n            depthStoreOp: 'store',\r\n            depthClearValue: 1.0,\r\n          }\r\n        });\r\n\r\n        now = performance.now() / 1000;\r\n        for(const [meshIndex, mesh] of this.mainRenderBundle.entries()) {\r\n          if(mesh instanceof BVHPlayerInstances) {\r\n            mesh.updateInstanceData(mesh.getModelMatrix(mesh.position, mesh.useScale))\r\n            shadowPass.setPipeline(light.shadowPipelineInstanced);\r\n          } else {\r\n            shadowPass.setPipeline(light.shadowPipeline);\r\n          }\r\n\r\n          if(mesh.videoIsReady == 'NONE') {\r\n            shadowPass.setBindGroup(0, light.getShadowBindGroup(mesh, meshIndex));\r\n            if(mesh instanceof BVHPlayerInstances) {\r\n              shadowPass.setBindGroup(1, mesh.modelBindGroupInstanced);\r\n            } else {\r\n              shadowPass.setBindGroup(1, mesh.modelBindGroup);\r\n            }\r\n            mesh.drawShadows(shadowPass, light);\r\n          }\r\n        }\r\n        shadowPass.end();\r\n      }\r\n\r\n      // with no postprocessing\r\n      // const currentTextureView = this.context.getCurrentTexture().createView();\r\n      // this.mainRenderPassDesc.colorAttachments[0].view = currentTextureView;\r\n      this.mainRenderPassDesc.colorAttachments[0].view = this.sceneTextureView;\r\n\r\n      let pass = commandEncoder.beginRenderPass(this.mainRenderPassDesc);\r\n      // opaque\r\n      for(const mesh of this.mainRenderBundle) {\r\n        if(mesh.material?.useBlend === true) continue;\r\n        pass.setPipeline(mesh.pipeline);\r\n        if(!mesh.sceneBindGroupForRender || (mesh.FINISH_VIDIO_INIT == false && mesh.isVideo == true)) {\r\n          for(const m of this.mainRenderBundle) {\r\n            if(m.isVideo == true) {\r\n              // console.log(\"%c\u2705shadowVideoView ${this.shadowVideoView}\", LOG_FUNNY_ARCADE);\r\n              m.shadowDepthTextureView = this.shadowVideoView;\r\n              m.FINISH_VIDIO_INIT = true;\r\n              m.setupPipeline();\r\n              pass.setPipeline(mesh.pipeline);\r\n            } else {\r\n              m.shadowDepthTextureView = this.shadowArrayView;\r\n              m.setupPipeline();\r\n            }\r\n          }\r\n        }\r\n        mesh.drawElements(pass, this.lightContainer);\r\n      }\r\n      // blend\r\n      for(const mesh of this.mainRenderBundle) {\r\n        if(mesh.material?.useBlend !== true) continue;\r\n        pass.setPipeline(mesh.pipelineTransparent);\r\n        if(!mesh.sceneBindGroupForRender || (mesh.FINISH_VIDIO_INIT == false && mesh.isVideo == true)) {\r\n          for(const m of this.mainRenderBundle) {\r\n            if(m.isVideo == true) {\r\n              // console.log(\"%c\u2705shadowVideoView ${this.shadowVideoView}\", LOG_FUNNY_ARCADE);\r\n              m.shadowDepthTextureView = this.shadowVideoView;\r\n              m.FINISH_VIDIO_INIT = true;\r\n              m.setupPipeline();\r\n              pass.setPipeline(mesh.pipelineTransparent);\r\n            } else {\r\n              m.shadowDepthTextureView = this.shadowArrayView;\r\n              m.setupPipeline();\r\n            }\r\n          }\r\n        }\r\n        mesh.drawElements(pass, this.lightContainer);\r\n      }\r\n      pass.end();\r\n\r\n      if(this.collisionSystem) this.collisionSystem.update();\r\n      const transPassDesc = {\r\n        colorAttachments: [{view: this.sceneTextureView, loadOp: 'load', storeOp: 'store'}],\r\n        depthStencilAttachment: {\r\n          view: this.mainDepthView,\r\n          depthLoadOp: 'load',\r\n          depthStoreOp: 'store',\r\n          depthClearValue: 1.0,\r\n        }\r\n      };\r\n      const transPass = commandEncoder.beginRenderPass(transPassDesc);\r\n      const viewProjMatrix = mat4.multiply(this.cameras[this.mainCameraParams.type].projectionMatrix,\r\n        this.cameras[this.mainCameraParams.type].view, mat4.identity());\r\n      for(const mesh of this.mainRenderBundle) {\r\n        if(mesh.effects) Object.keys(mesh.effects).forEach(effect_ => {\r\n          const effect = mesh.effects[effect_];\r\n          if(effect == null || effect.enabled == false) return;\r\n          let md = mesh.getModelMatrix(mesh.position, mesh.useScale);\r\n          if(effect.updateInstanceData) effect.updateInstanceData(md);\r\n          effect.render(transPass, mesh, viewProjMatrix)\r\n        });\r\n      }\r\n      transPass.end();\r\n\r\n      // volumetric\r\n\r\n      if(this.volumetricPass.enabled === true) {\r\n        const cam = this.cameras[this.mainCameraParams.type];\r\n        // You need invViewProj \u2014 compute it from your existing matrices:\r\n        // cam.invViewProjectionMatrix should be mat4.invert(viewProjMatrix)\r\n        // If you don't store it yet, compute once per frame:\r\n        const invViewProj = mat4.invert(\r\n          mat4.multiply(cam.projectionMatrix, cam.view, mat4.identity())\r\n        );\r\n\r\n        // Grab first light for direction + shadow matrix\r\n        const light = this.lightContainer[0];\r\n\r\n        this.volumetricPass.render(\r\n          commandEncoder,\r\n          this.sceneTextureView,        // \u2190 your existing scene color\r\n          this.mainDepthView,           // \u2190 your existing depth\r\n          this.shadowArrayView,         // \u2190 your existing shadow array\r\n          {invViewProjectionMatrix: invViewProj},\r\n          {\r\n            viewProjectionMatrix: light.viewProjMatrix, // Float32Array 16\r\n            direction: light.direction,                       // [x, y, z]\r\n          }\r\n        );\r\n      }\r\n\r\n      //\r\n\r\n      const canvasView = this.context.getCurrentTexture().createView();\r\n      // Bloom\r\n      if(this.bloomPass.enabled == true) {\r\n        const bloomInput = this.volumetricPass.enabled\r\n          ? this.volumetricPass.compositeOutputTex.createView()\r\n          : this.sceneTextureView;\r\n        this.bloomPass.render(commandEncoder, bloomInput, this.bloomOutputTex);\r\n        // ori\r\n        // this.bloomPass.render(commandEncoder, this.sceneTextureView, this.bloomOutputTex);\r\n      }\r\n\r\n      pass = commandEncoder.beginRenderPass({\r\n        colorAttachments: [{\r\n          view: canvasView,\r\n          loadOp: 'clear',\r\n          storeOp: 'store',\r\n          clearValue: {r: 0, g: 0, b: 0, a: 1}\r\n        }]\r\n      });\r\n\r\n      pass.setPipeline(this.presentPipeline);\r\n      pass.setBindGroup(0, this.bloomPass.enabled === true ? this.bloomBindGroup : this.noBloomBindGroup);\r\n\r\n      pass.draw(6);\r\n      pass.end();\r\n\r\n      this.graphUpdate(now);\r\n      this.device.queue.submit([commandEncoder.finish()]);\r\n      requestAnimationFrame(this.frame);\r\n    } catch(err) {\r\n      if(this.logLoopError) console.log('%cLoop(err):' + err + \" info : \" + err.stack, LOG_WARN)\r\n      requestAnimationFrame(this.frame);\r\n    }\r\n  }\r\n\r\n  graphUpdate = (delta) => {}\r\n\r\n  addGlbObj = (o, BVHANIM, glbFile, clearColor = this.options.clearColor) => {\r\n    if(typeof o.name === 'undefined') {o.name = genName(9)}\r\n    if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n    if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n    if(typeof o.material === 'undefined') {o.material = {type: 'standard'}}\r\n    if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n    if(typeof o.scale === 'undefined') {o.scale = [1, 1, 1];}\r\n    if(typeof o.raycast === 'undefined') {o.raycast = {enabled: false, radius: 2}}\r\n    if(typeof o.pointerEffect === 'undefined') {o.pointerEffect = {enabled: false};}\r\n    if(typeof o.useScale === 'undefined') {o.useScale = false;}\r\n\r\n    o.entityArgPass = this.entityArgPass;\r\n    o.cameras = this.cameras;\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\",//                   must be fixed<<\r\n        radius: (typeof o.scale == Number ? o.scale : o.scale[0]),\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Cube\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n    o.physics.position = o.position;\r\n    if(typeof o.objAnim == 'undefined' || typeof o.objAnim == null) {\r\n      o.objAnim = null;\r\n    } else {\r\n      alert('GLB not use objAnim (it is only for obj sequence). GLB use BVH skeletal for animation');\r\n    }\r\n\r\n    o.textureCache = this.textureCache;\r\n    let skinnedNodeIndex = 0;\r\n    for(const skinnedNode of glbFile.skinnedMeshNodes) {\r\n      let c = 0;\r\n      for(const primitive of skinnedNode.mesh.primitives) {\r\n        // console.log(`count: ${c} primitive-glb: ${primitive}`);\r\n        // primitive is mesh - probably with own material . material/texture per primitive\r\n        // create scene object for each skinnedNode\r\n        o.name = o.name + \"-\" + skinnedNode.name + '-' + c;\r\n        const bvhPlayer = new BVHPlayer(\r\n          o,\r\n          BVHANIM,\r\n          glbFile,\r\n          c,\r\n          skinnedNodeIndex,\r\n          this.canvas,\r\n          this.device,\r\n          this.context,\r\n          this.inputHandler,\r\n          this.globalAmbient.slice());\r\n        skinnedNodeIndex++;\r\n        // console.log(`bvhPlayer!!!!!: ${bvhPlayer}`);\r\n        bvhPlayer.spotlightUniformBuffer = this.spotlightUniformBuffer;\r\n        bvhPlayer.clearColor = clearColor;\r\n        // if(o.physics.enabled == true) {\r\n        //   this.matrixAmmo.addPhysics(myMesh1, o.physics)\r\n        // }\r\n        // make it soft\r\n        this.mainRenderBundle.push(bvhPlayer);\r\n        setTimeout(() => {\r\n          document.dispatchEvent(new CustomEvent('updateSceneContainer', {detail: {}}))\r\n        }, 50);\r\n        c++;\r\n      }\r\n    }\r\n    if(typeof this.editor !== 'undefined') {\r\n      this.editor.editorHud.updateSceneContainer();\r\n    }\r\n  }\r\n\r\n  addGlbObjInctance = (o, BVHANIM, glbFile, clearColor = this.options.clearColor) => {\r\n    if(typeof o.name === 'undefined') {o.name = genName(9)}\r\n    if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n    if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n    if(typeof o.material === 'undefined') {o.material = {type: 'standard'}}\r\n    if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n    if(typeof o.scale === 'undefined') {o.scale = [1, 1, 1];}\r\n    if(typeof o.raycast === 'undefined') {o.raycast = {enabled: false, radius: 2}}\r\n    if(typeof o.pointerEffect === 'undefined') {\r\n      o.pointerEffect = {\r\n        enabled: false,\r\n        pointer: false,\r\n        ballEffect: false\r\n      };\r\n    }\r\n    if(typeof o.useScale === 'undefined') {o.useScale = false;}\r\n    o.entityArgPass = this.entityArgPass;\r\n    o.cameras = this.cameras;\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: o.scale,\r\n        enabled: true,\r\n        geometry: \"Sphere\",//                   must be fixed<<\r\n        radius: (typeof o.scale == Number ? o.scale : o.scale[0]),\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Cube\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n    o.physics.position = o.position;\r\n    if(typeof o.objAnim == 'undefined' || typeof o.objAnim == null) {\r\n      o.objAnim = null;\r\n    } else {\r\n      console.warn('GLB not use objAnim (it is only for obj sequence). GLB use BVH skeletal for animation');\r\n    }\r\n\r\n    let skinnedNodeIndex = 0;\r\n    for(const skinnedNode of glbFile.skinnedMeshNodes) {\r\n      let c = 0;\r\n      for(const primitive of skinnedNode.mesh.primitives) {\r\n        // console.log(`count: ${c} primitive-glb: ${primitive}`);\r\n        // primitive is mesh - probably with own material . material/texture per primitive\r\n        // create scene object for each skinnedNode\r\n        o.name = o.name + \"_\" + skinnedNode.name;\r\n        // maybe later add logic from constructor\r\n        // always fisrt sub mesh(skinnedmeg-vert group how comes from loaders)\r\n        if(skinnedNodeIndex == 0) {} else {\r\n          o.pointerEffect = {enabled: false};\r\n        }\r\n        const bvhPlayer = new BVHPlayerInstances(\r\n          o,\r\n          BVHANIM,\r\n          glbFile,\r\n          c,\r\n          skinnedNodeIndex,\r\n          this.canvas,\r\n          this.device,\r\n          this.context,\r\n          this.inputHandler,\r\n          this.globalAmbient.slice());\r\n        // console.log(`bvhPlayer!!!!!: ${bvhPlayer}`);\r\n        bvhPlayer.spotlightUniformBuffer = this.spotlightUniformBuffer;\r\n        bvhPlayer.clearColor = clearColor;\r\n        // if(o.physics.enabled == true) {\r\n        //   this.matrixAmmo.addPhysics(myMesh1, o.physics)\r\n        // }\r\n        // make it soft\r\n        setTimeout(() => {\r\n          this.mainRenderBundle.push(bvhPlayer);\r\n          setTimeout(() => {\r\n            document.dispatchEvent(new CustomEvent('updateSceneContainer', {detail: {}}))\r\n          }, 50);\r\n        }, 200)\r\n        c++;\r\n      }\r\n      skinnedNodeIndex++;\r\n    }\r\n    if(typeof this.editor !== 'undefined') {\r\n      this.editor.editorHud.updateSceneContainer();\r\n    }\r\n  }\r\n\r\n  activateBloomEffect = () => {\r\n    if(this.bloomPass.enabled != true) {\r\n      this.bloomPass = new BloomPass(this.canvas.width, this.canvas.height, this.device, 1.5);\r\n      this.bloomPass.enabled = true;\r\n    }\r\n  }\r\n\r\n  activateVolumetricEffect = () => {\r\n    if(this.volumetricPass.enabled != true) {\r\n      this.volumetricPass = new VolumetricPass(\r\n        this.canvas.width,\r\n        this.canvas.height,\r\n        this.device,\r\n        {\r\n          density: 0.03,\r\n          steps: 32,\r\n          scatterStrength: 1.2,\r\n          heightFalloff: 0.08,\r\n          lightColor: [1.0, 0.88, 0.65],  // warm sunlight\r\n        }\r\n      ).init();\r\n      this.volumetricPass.enabled = true;\r\n    }\r\n  }\r\n}", "export default {\"nodes\":{\"n24\":{\"id\":\"n24\",\"title\":\"onLoad\",\"x\":171.11114501953125,\"y\":775.111083984375,\"category\":\"event\",\"inputs\":[],\"outputs\":[{\"name\":\"exec\",\"type\":\"action\"}],\"fields\":[]},\"n25\":{\"id\":\"n25\",\"title\":\"Add OBJ\",\"x\":444.416748046875,\"y\":721.4270935058594,\"category\":\"action\",\"inputs\":[{\"name\":\"exec\",\"type\":\"action\"},{\"name\":\"path\",\"type\":\"string\"},{\"name\":\"material\",\"type\":\"string\"},{\"name\":\"pos\",\"type\":\"object\"},{\"name\":\"rot\",\"type\":\"object\"},{\"name\":\"texturePath\",\"type\":\"string\"},{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"raycast\",\"type\":\"boolean\"},{\"name\":\"scale\",\"type\":\"object\"},{\"name\":\"isPhysicsBody\",\"type\":\"boolean\"},{\"name\":\"isInstancedObj\",\"type\":\"boolean\"}],\"outputs\":[{\"name\":\"execOut\",\"type\":\"action\"},{\"name\":\"complete\",\"type\":\"action\"},{\"name\":\"error\",\"type\":\"action\"}],\"fields\":[{\"key\":\"path\",\"value\":\"res/meshes/shapes/cube.obj\"},{\"key\":\"material\",\"value\":\"standard\"},{\"key\":\"pos\",\"value\":\"{x:0, y:0, z:0}\"},{\"key\":\"rot\",\"value\":\"{x:0, y:0, z:0}\"},{\"key\":\"texturePath\",\"value\":\"res/textures/default.png\"},{\"key\":\"name\",\"value\":\"box1\"},{\"key\":\"raycast\",\"value\":\"false\"},{\"key\":\"scale\",\"value\":\"[1,1,1]\"},{\"key\":\"isPhysicsBody\",\"value\":\"false\"},{\"key\":\"isInstancedObj\",\"value\":\"false\"},{\"key\":\"created\",\"value\":false}],\"noselfExec\":true},\"node_26\":{\"id\":\"node_26\",\"title\":\"Print\",\"x\":806.7917175292969,\"y\":729.2569580078125,\"category\":\"actionprint\",\"inputs\":[{\"name\":\"exec\",\"type\":\"action\"},{\"name\":\"value\",\"type\":\"any\"}],\"outputs\":[{\"name\":\"execOut\",\"type\":\"action\"}],\"fields\":[{\"key\":\"label\",\"value\":\"Result\"}],\"builtIn\":true,\"noselfExec\":\"true\",\"displayEl\":{}},\"node_27\":{\"id\":\"node_27\",\"title\":\"Print\",\"x\":830.8646087646484,\"y\":1009.013916015625,\"category\":\"actionprint\",\"inputs\":[{\"name\":\"exec\",\"type\":\"action\"},{\"name\":\"value\",\"type\":\"any\"}],\"outputs\":[{\"name\":\"execOut\",\"type\":\"action\"}],\"fields\":[{\"key\":\"label\",\"value\":\"Result\"}],\"builtIn\":true,\"noselfExec\":\"true\",\"displayEl\":{}}},\"links\":[{\"id\":\"l22\",\"from\":{\"node\":\"n24\",\"pin\":\"exec\",\"type\":\"action\",\"out\":true},\"to\":{\"node\":\"n25\",\"pin\":\"exec\"},\"type\":\"action\"},{\"id\":\"link_23\",\"from\":{\"node\":\"n25\",\"pin\":\"complete\",\"type\":\"action\",\"out\":true},\"to\":{\"node\":\"node_26\",\"pin\":\"exec\"},\"type\":\"action\"},{\"id\":\"link_24\",\"from\":{\"node\":\"n25\",\"pin\":\"error\",\"type\":\"action\",\"out\":true},\"to\":{\"node\":\"node_27\",\"pin\":\"exec\"},\"type\":\"action\"}],\"nodeCounter\":28,\"linkCounter\":25,\"pan\":[-169,-490],\"variables\":{\"number\":{},\"boolean\":{},\"string\":{},\"object\":{}}};\n", "export let shaderGraphsProdc = [\r\n  {\r\n    \"name\": \"fragShaderGraph\",\r\n    \"content\": \"{\\\"nodes\\\":[{\\\"id\\\":\\\"N0\\\",\\\"type\\\":\\\"FragmentOutput\\\",\\\"x\\\":347,\\\"y\\\":321,\\\"inputs\\\":{\\\"color\\\":{\\\"default\\\":\\\"vec4f(1.0)\\\"}}}],\\\"connections\\\":[]}\"\r\n  }\r\n];\r\n", "import MatrixEngineWGPU from \"../../src/world.js\";\r\nimport {downloadMeshes} from '../../src/engine/loader-obj.js';\r\nimport {uploadGLBModel} from \"../../src/engine/loaders/webgpu-gltf.js\";\r\nimport graph from \"./graph.js\";\r\nimport {shaderGraphsProdc} from \"./shader-graphs.js\"\r\nimport {gizmoEffect} from \"../../src/shaders/gizmo/gimzoShader.js\";\r\nimport {addRaycastsListener} from \"../../src/engine/raycast.js\";\r\nimport {flameEffect} from \"../../src/shaders/flame-effect/flameEffect.js\";\r\n\r\nlet app = new MatrixEngineWGPU(\r\n\r\n  {\r\n\r\n    useEditor: true,\r\n    projectType: \"created from editor\",\r\n    projectName: 'Test2',\r\n    useSingleRenderPass: true,\r\n    canvasSize: 'fullscreen',\r\n    mainCameraParams: {\r\n      type: 'WASD',\r\n      responseCoef: 1000\r\n    },\r\n    clearColor: {r: 0, b: 0.1, g: 0.1, a: 1}\r\n  }\r\n\r\n  , (app) => {\r\n    addEventListener('AmmoReady', async () => {\r\n\r\n      addRaycastsListener(\"canvas1\", \"mousedown\");\r\n      // app.canvas.addEventListener(\"ray.hit.event\", (e) => {\r\n      //   console.log('ray.hit.event detected', e.detail);\r\n      // })\r\n\r\n      // [only fro projects created from editor]\r\n      app.graph = graph;\r\n      shaderGraphsProdc.forEach((gShader) => {\r\n        let shaderReady = JSON.parse(gShader.content);\r\n        app.shadersPack[gShader.name] = shaderReady.final;\r\n        if(typeof shaderReady.final === \"undefined\") console.warn(`Shader ${shaderReady.name} is not compiled.`);\r\n      });\r\n      // [light]\r\n      app.addLight();\r\n\r\n      // ME START FLOOR addCube\r\n\r\n      downloadMeshes({mesh: \"./res/meshes/blender/plane.obj\"}, (m) => {\r\n        let texturesPaths = ['./res/meshes/blender/cube.png'];\r\n        app.addMeshObj({\r\n          position: {x: 0, y: -1, z: -20}, rotation: {x: 0, y: 0, z: 0}, rotationSpeed: {x: 0, y: 0, z: 0},\r\n          texturesPaths: [texturesPaths],\r\n          name: 'FLOOR',\r\n          pointerEffect: {\r\n            enabled: true,\r\n            // pointEffect: true,\r\n            gizmoEffect: true,\r\n            // destructionEffect: true\r\n          },\r\n          mesh: m.mesh,\r\n          raycast: {enabled: true, radius: 2},\r\n          physics: {enabled: false, geometry: \"Cube\"}\r\n        });\r\n      }, {scale: [25, 1, 25]});\r\n\r\n      // ME END FLOOR addCube\r\n\r\n\r\n\r\n      // ME START FLOOR useScaleno info\r\n      setTimeout(() => {\r\n        app.getSceneObjectByName('FLOOR').useScale = true;\r\n      }, 800);\r\n      // ME END FLOOR useScaleno info\r\n\r\n\r\n      // ME START monster\r\n      var glbFile01 = await fetch('res/meshes/glb/monster.glb').then(res => res.arrayBuffer().then(buf => uploadGLBModel(buf, app.device)));\r\n      texturesPaths = ['./res/meshes/blender/cube.png'];\r\n      app.addGlbObjInctance({\r\n        position: {x: 0, y: 0, z: -20}, rotation: {x: 0, y: 0, z: 0}, rotationSpeed: {x: 0, y: 0, z: 0},\r\n        texturesPaths: [texturesPaths],\r\n        scale: [20, 20, 20],\r\n        name: app.getNameFromPath('res/meshes/glb/monster.glb'),\r\n        material: {type: 'standard', useTextureFromGlb: true},\r\n        raycast: {enabled: true, radius: 2},\r\n        physics: {enabled: true, geometry: \"Cube\"},\r\n        useScale: true,\r\n        pointerEffect: {\r\n          enabled: true,\r\n          // pointEffect: true,\r\n          // destructionEffect: true\r\n          flameEmitter: true\r\n        },\r\n      }, null, glbFile01);\r\n      // ME END monster\r\n\r\n      // ME START FLOOR updatePosz\r\n      setTimeout(() => {\r\n        app.getSceneObjectByName('FLOOR').position.SetZ(-18.454014167181374);\r\n      }, 800);\r\n      // ME END FLOOR updatePosz\r\n\r\n \r\n \r\n  // ME START FLOOR updatePosx\r\n setTimeout(() => {\r\n  app.getSceneObjectByName('FLOOR').position.SetX(-0.09999999999998835);\r\n }, 800);\r\n // ME END FLOOR updatePosx\r\n \r\n   // ME START FLOOR updatePosy\r\n setTimeout(() => {\r\n  app.getSceneObjectByName('FLOOR').position.SetY(-3.9799999999999853);\r\n }, 800);\r\n // ME END FLOOR updatePosy\r\n \r\n // [MAIN_REPLACE2]\r\n    })\r\n  })\r\nwindow.app = app;\r\n"],
  "mappings": "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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAjB,IAAI,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAnB,IAAI,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAxB,IAAI,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACA5B,IAAI,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAvB,IAAI,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAxB,IAAI,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAvB,IAAI,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,KAAK,EAAE,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,MAAM,GAAG,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAG,GAAG,KAAK,IAAI,GAAG,CAAC,KAAK,KAAK,IAAI,MAAM,GAAG,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAG,GAAG,KAAK,IAAI,GAAG,CAAC,KAAK,KAAK,IAAI,MAAM,GAAG,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAG,GAAG,KAAK,IAAI,GAAG,CAAC,KAAK,KAAK,IAAI,MAAM,GAAG,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAG,GAAG,KAAK,IAAI,GAAG,CAAC,KAAK,KAAK,IAAI,MAAM,GAAG,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAG,GAAG,KAAK,IAAI,GAAG,CAAC,KAAK,KAAK,IAAI,MAAM,GAAG,KAAcA,WAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAG,GAAG,KAAK,I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",
  "names": ["VecType", "setDefaultType", "create", "x", "y", "fromValues", "create", "set", "x", "y", "VecType", "ceil", "floor", "round", "clamp", "min", "max", "add", "addScaled", "scale", "angle", "dot", "subtract", "sub", "equalsApproximately", "utils.EPSILON", "equals", "lerp", "lerpV", "mulScalar", "divScalar", "inverse", "invert", "length", "len", "lengthSq", "lenSq", "distance", "dist", "distanceSq", "distSq", "normalize", "negate", "copy", "clone", "multiply", "mul", "divide", "div", "zero", "transformMat4", "getTranslation", "getAxis", "getScaling", "setDefaultType", "x2", "y2", "identity", "vec3.create", "left", "right", "vec3.normalize", "vec3.subtract", "vec3.cross", "rotateX", "rotateY", "rotateZ", "n", "vec3.dot", "vec3.len", "r", "id", "type", "addScript", "min", "max", "options", "id", "min", "max", "LOG_FUNNY_ARCADE", "length", "result", "el", "mat", "x", "y", "options", "clamp", "lerp", "rotate", "min", "max", "div", "angle", "window", "x", "y", "n", "dist", "device", "size", "texturesPaths", "path", "LOG_FUNNY_ARCADE", "PointEffect", "device", "pass", "size", "device", "length", "x", "y", "result", "dist", "pass", "size", "device", "r", "pass", "device", "name", "pass", "device", "pass", "device", "o", "sum", "LOG_FUNNY_ARCADE", "size", "n", "VERTEX_ANIM_FLAGS", "scale", "PointEffect", "pos", "modelMatrix", "pass", "Ammo", "LOG_FUNNY_ARCADE", "body", "x", "y", "pos", "name", "zero", "rot", "LOG_FUNNY_ARCADE", "r", "name", "path", "x", "name", "min", "max", "device", "fov", "aspect", "near", "far", "x", "y", "EPSILON", "ctorMap", "newMat3", "VecType", "create", "x", "y", "VecType", "subtract", "VecType", "cross", "VecType", "normalize", "VecType", "len", "MatType", "setDefaultType", "create", "negate", "copy", "clone", "equalsApproximately", "utils.EPSILON", "equals", "identity", "transpose", "inverse", "determinant", "invert", "multiply", "mul", "setTranslation", "getTranslation", "vec3.create", "getAxis", "setAxis", "getScaling", "perspective", "ortho", "left", "right", "frustum", "xAxis", "yAxis", "zAxis", "lookAt", "vec3.normalize", "vec3.subtract", "vec3.cross", "translation", "translate", "rotationX", "rotateX", "rotationY", "rotateY", "rotationZ", "rotateZ", "axisRotation", "x", "y", "n", "rotation", "axisRotate", "rotate", "scaling", "scale", "degToRad", "byId", "id", "multiply", "r", "name", "degToRad", "mat4Impl", "rotation", "item", "x", "EPSILON", "add", "clone", "copy", "create", "determinant", "equals", "fromQuat", "fromValues", "frustum", "getScaling", "getTranslation", "identity", "invert", "lookAt", "mul", "multiply", "ortho", "perspective", "rotate", "rotateX", "rotateY", "rotateZ", "scale", "set", "sub", "subtract", "translate", "transpose", "create", "clone", "copy", "fromValues", "set", "identity", "transpose", "invert", "determinant", "multiply", "translate", "x", "y", "scale", "rotate", "len", "EPSILON", "rotateX", "rotateY", "rotateZ", "x2", "y2", "translation", "getTranslation", "mat", "getScaling", "scaling", "o", "fromQuat", "frustum", "left", "right", "perspective", "ortho", "lookAt", "add", "subtract", "equals", "mul", "sub", "type", "size", "device", "name", "n", "node", "scale", "rotation", "translation", "device", "header", "n", "node", "o", "device", "translation", "rotation", "scale", "path", "type", "dot", "x", "y", "rot", "len", "node", "device", "pass", "device", "texturesPaths", "type", "size", "options", "i", "o", "y", "x", "pos", "r", "angle", "n", "device", "type", "scale", "x", "pass", "device", "r", "pass", "pos", "device", "r", "pass", "pos", "device", "type", "path", "scale", "r", "x", "pass", "device", "type", "path", "scale", "r", "x", "pass", "device", "o", "sum", "size", "x", "n", "scale", "pos", "pass", "o", "device", "translation", "rotation", "scale", "path", "type", "dot", "x", "y", "rot", "len", "node", "name", "LOG_FUNNY_ARCADE", "o", "texturesPaths", "node", "id", "node", "n", "x", "y", "el", "type", "name", "result", "r", "x", "y", "x", "n", "path", "el", "r", "id", "b", "node", "y", "type", "row", "body", "nodeId", "e", "placeholder", "LOG_FUNNY_ARCADE", "n", "y", "x", "r", "LOG_FUNNY_ARCADE", "el", "name", "obj", "n", "LOG_FUNNY_ARCADE", "x", "o", "el", "nodeId", "node", "y", "args", "type", "id", "placeholder", "copy", "name", "row", "select", "left", "right", "dom", "obj", "path", "objectName", "dot", "spec", "options", "target", "varField", "pos", "result", "r", "min", "max", "body", "delay", "createdField", "objects", "rot", "name", "o", "e", "id", "LOG_FUNNY_ARCADE", "el", "x", "body", "op", "r", "name", "obj", "device", "fragmentWGSL", "pass", "x", "y", "min", "max", "body", "pos", "rot", "texturePath", "name", "raycast", "scale", "sum", "delay", "x", "o", "size", "spacing", "n", "y", "cubeName", "levels", "objects", "path", "isPhysicsBody", "isInstancedObj", "device", "path", "path", "options", "device", "options", "r", "x", "y", "pass", "options", "r", "LOG_FUNNY_ARCADE", "name", "obj", "o", "pass", "app", "texturesPaths"]
}
