{
  "version": 3,
  "sources": ["../node_modules/src/utils.ts", "../node_modules/src/vec2.ts", "../node_modules/src/vec3.ts", "../node_modules/src/vec2-impl.ts", "../node_modules/src/mat3-impl.ts", "../node_modules/src/vec3-impl.ts", "../node_modules/src/mat4-impl.ts", "../node_modules/src/quat.ts", "../node_modules/src/quat-impl.ts", "../node_modules/src/vec4.ts", "../node_modules/src/vec4-impl.ts", "../node_modules/src/wgpu-matrix.ts", "../src/shaders/shaders.js", "../src/engine/utils.js", "../src/engine/matrix-class.js", "../src/engine/engine.js", "../src/engine/ball.js", "../src/engine/cube.js", "../src/shaders/vertex.wgsl.js", "../src/shaders/fragment.wgsl.js", "../src/shaders/fragment.wgsl.metal.js", "../src/shaders/fragment.wgsl.normalmap.js", "../src/shaders/fragment.wgsl.pong.js", "../src/shaders/fragment.wgsl.power.js", "../src/engine/materials.js", "../src/shaders/fragment.video.wgsl.js", "../src/shaders/vertex.wgsl.normalmap.js", "../src/shaders/standalone/pointer.effect.js", "../src/engine/effects/pointerEffect.js", "../src/engine/mesh-obj.js", "../src/physics/matrix-ammo.js", "res/multilang/en-backup.js", "../src/multilang/lang.js", "../src/sounds/sounds.js", "../src/engine/loader-obj.js", "../src/shaders/vertexShadow.wgsl.js", "../src/engine/behavior.js", "../src/shaders/instanced/vertexShadow.instanced.wgsl.js", "../src/engine/lights.js", "../node_modules/src/utils.ts", "../node_modules/src/vec2.ts", "../node_modules/src/vec2-impl.ts", "../node_modules/src/mat3-impl.ts", "../node_modules/src/vec3.ts", "../node_modules/src/vec3-impl.ts", "../node_modules/src/mat4-impl.ts", "../node_modules/src/vec4-impl.ts", "../node_modules/src/wgpu-matrix.ts", "../node_modules/bvh-loader/module/bvh-loader.js", "../node_modules/bvh-loader/index.js", "../src/engine/loaders/webgpu-gltf.js", "../src/engine/loaders/bvh.js", "../src/shaders/instanced/fragment.instanced.wgsl.js", "../src/engine/instanced/materials-instanced.js", "../src/shaders/instanced/vertex.instanced.wgsl.js", "../src/engine/geometry-factory.js", "../src/shaders/standalone/geo.instanced.js", "../src/engine/effects/gen.js", "../src/shaders/energy-bars/energy-bar-shader.js", "../src/engine/effects/energy-bar.js", "../src/engine/effects/mana-bar.js", "../src/shaders/flame-effect/flameEffect.js", "../src/engine/effects/flame.js", "../src/shaders/flame-effect/flame-instanced.js", "../src/engine/effects/flame-emmiter.js", "../src/shaders/standalone/geo.tex.js", "../src/engine/effects/gen-tex.js", "../src/engine/effects/gen-tex2.js", "../src/engine/instanced/mesh-obj-instances.js", "../src/engine/loaders/bvh-instaced.js", "../src/tools/editor/client.js", "../src/tools/editor/editor.provider.js", "../src/tools/editor/hud.js", "../src/tools/editor/editor.js", "../src/world.js", "../projects/MM/app-gen.js"],
  "sourcesContent": ["/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nexport let EPSILON = 0.000001;\n\n/**\n * Set the value for EPSILON for various checks\n * @param v - Value to use for EPSILON.\n * @returns previous value of EPSILON;\n */\nexport function setEpsilon(v: number): number {\n  const old = EPSILON;\n  EPSILON = v;\n  return old;\n}\n\n/**\n * Convert degrees to radians\n * @param degrees - Angle in degrees\n * @returns angle converted to radians\n */\nexport function degToRad(degrees: number): number {\n  return degrees * Math.PI / 180;\n}\n\n/**\n * Convert radians to degrees\n * @param radians - Angle in radians\n * @returns angle converted to degrees\n */\nexport function radToDeg(radians: number): number {\n  return radians * 180 / Math.PI;\n}\n\n/**\n * Lerps between a and b via t\n * @param a - starting value\n * @param b - ending value\n * @param t - value where 0 = a and 1 = b\n * @returns a + (b - a) * t\n */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/**\n * Compute the opposite of lerp. Given a and b and a value between\n * a and b returns a value between 0 and 1. 0 if a, 1 if b.\n * Note: no clamping is done.\n * @param a - start value\n * @param b - end value\n * @param v - value between a and b\n * @returns (v - a) / (b - a)\n */\nexport function inverseLerp(a: number, b: number, v: number): number {\n  const d = b - a;\n  return (Math.abs(b - a) < EPSILON)\n     ? a\n     : (v - a) / d;\n}\n\n/**\n * Compute the euclidean modulo\n *\n * ```\n * // table for n / 3\n * -5, -4, -3, -2, -1,  0,  1,  2,  3,  4,  5   <- n\n * ------------------------------------\n * -2  -1  -0  -2  -1   0,  1,  2,  0,  1,  2   <- n % 3\n *  1   2   0   1   2   0,  1,  2,  0,  1,  2   <- euclideanModule(n, 3)\n * ```\n *\n * @param n - dividend\n * @param m - divisor\n * @returns the euclidean modulo of n / m\n */\nexport function euclideanModulo(n: number, m: number) {\n  return ((n % m) + m) % m;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 2 values, Float32Array with 2 values, or a Float64Array with 2 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec2.setDefaultType}.\n */\nexport type Vec2 = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Vec2 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new Vec2. In other words you can do this\n *\n *     const v = vec2.cross(v1, v2);  // Creates a new Vec2 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec2.create();\n *     vec2.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec2.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec2 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec2\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Vec2\n */\nexport function setDefaultType(ctor: new (n: number) => Vec2) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values.\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Vec2's specified type\n * it would be faster to use\n *\n * ```\n * const v = vec2.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Vec2Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `vec2.create` is usually used\n * to create a Vec2 to be filled out as in\n *\n * ```\n * const sum = vec2.create();\n * vec2.add(v1, v2, sum);\n * ```\n *\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport function create(x = 0, y = 0): Vec2 {\n  const dst = new VecType(2);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n    }\n  }\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 3 values, Float32Array with 3 values, or a Float64Array with 3 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec3.setDefaultType}.\n */\nexport type Vec3 = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Vec3 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec3`. In other words you can do this\n *\n *     const v = vec3.cross(v1, v2);  // Creates a new Vec3 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec3.create();\n *     vec3.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec3.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec3 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec3\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Vec3\n */\nexport function setDefaultType(ctor: new (n: number) => Vec3) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number): Vec3 {\n  const dst = new VecType(3);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Vec2, create, setDefaultType, VecType } from './vec2';\nimport { Vec3, VecType as Vec3Type } from './vec3';\n\nexport default Vec2;\nexport { create, setDefaultType };\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Vec2\n * Also see {@link vec2.create} and {@link vec2.copy}\n *\n * @param x first value\n * @param y second value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = x;\n  dst[1] = y;\n\n  return dst;\n}\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec2, min = 0, max = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec2, b: Vec2, scale: number, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec2, b: Vec2): number {\n  const ax = a[0];\n  const ay = a[1];\n  const bx = a[0];\n  const by = a[1];\n  const mag1 = Math.sqrt(ax * ax + ay * ay);\n  const mag2 = Math.sqrt(bx * bx + by * by);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec2, b: Vec2): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec2, b: Vec2): boolean {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec2, b: Vec2, t: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec2, b: Vec2, t: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec2, b: Vec2, dst?: Vec3): Vec3 {\n  dst = dst || new Vec3Type(3);\n  const z = a[0] * b[1] - a[1] * b[0];\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = z;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec2, b: Vec2): number {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return Math.sqrt(v0 * v0 + v1 * v1);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return v0 * v0 + v1 * v1;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return dx * dx + dy * dy;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const len = Math.sqrt(v0 * v0 + v1 * v1);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as {@link vec2.clone})\n * Also see {@link vec2.create} and {@link vec2.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as {@link vec2.copy})\n * Also see {@link vec2.create} and {@link vec2.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec2, b: Vec2, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random unit vector * scale\n * @param scale - Default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const angle = Math.random() * 2 * Math.PI;\n  dst[0] = Math.cos(angle) * scale;\n  dst[1] = Math.sin(angle) * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 0;\n  dst[1] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform Vec2 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec2, m: Mat4, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = x * m[0] + y * m[4] + m[12];\n  dst[1] = x * m[1] + y * m[5] + m[13];\n\n  return dst;\n}\n\n/**\n * Transforms vec4 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec2, m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = m[0] * x + m[4] * y + m[8];\n  dst[1] = m[1] * x + m[5] * y + m[9];\n\n  return dst;\n}\n\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport * as utils from './utils.js';\nimport { Quat } from './quat';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport Vec2, * as vec2 from './vec2-impl';\n\nexport default Mat3;\n\nexport type Mat3LikeCtor = new (n: number) => Mat3;\n\n/**\n * 3x3 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat3.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat3.create();\n *     mat3.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat3.identity();\n *     const trans = mat3.translation([1, 2, 3]);\n *     mat3.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: Mat3LikeCtor = Float32Array;\n\n// This mess is because with Mat3 we have 3 unused elements.\n// For Float32Array and Float64Array that's not an issue\n// but for Array it's troublesome\nconst ctorMap = new Map<Mat3LikeCtor,() => Mat3>([\n  [Float32Array, () => new Float32Array(12)],\n  [Float64Array, () => new Float64Array(12)],\n  [Array, () => new Array(12).fill(0)],\n]);\nlet newMat3: () => Mat3 = ctorMap.get(Float32Array)!;\n\n/**\n * Sets the type this library creates for a Mat3\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Mat3\n */\nexport function setDefaultType(ctor: new (n: number) => Mat3) {\n  const oldType = MatType;\n  MatType = ctor;\n  newMat3 = ctorMap.get(ctor)!;\n  return oldType;\n}\n\n/**\n * Create a Mat3 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat3's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat3.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat3Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat3.create` is usually used\n * to create a Mat3 to be filled out as in\n *\n * ```\n * const m = mat3.create();\n * mat3.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @returns matrix created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number,\n    v3?: number, v4?: number, v5?: number,\n    v6?: number, v7?: number, v8?: number): Mat3 {\n  const dst = newMat3();\n  // to make the array homogenous\n  dst[3] = 0;\n  dst[7] = 0;\n  dst[11] = 0;\n\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[4] = v3;\n          if (v4 !== undefined) {\n            dst[5] = v4;\n            if (v5 !== undefined) {\n              dst[6] = v5;\n              if (v6 !== undefined) {\n                dst[8] = v6;\n                if (v7 !== undefined) {\n                  dst[9] = v7;\n                  if (v8 !== undefined) {\n                    dst[10] = v8;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return dst;\n}\n\n/**\n * Sets the values of a Mat3\n * Also see {@link mat3.create} and {@link mat3.copy}\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat3 set from values.\n */\nexport function set(\n    v0: number, v1: number, v2: number,\n    v3: number, v4: number, v5: number,\n    v6: number, v7: number, v8: number, dst?: Mat3) {\n  dst = dst || newMat3();\n\n  dst[0] = v0;  dst[1] = v1;  dst[ 2] = v2;  dst[ 3] = 0;\n  dst[4] = v3;  dst[5] = v4;  dst[ 6] = v5;  dst[ 7] = 0;\n  dst[8] = v6;  dst[9] = v7;  dst[10] = v8;  dst[11] = 0;\n\n  return dst;\n}\n\n/**\n * Creates a Mat3 from the upper left 3x3 part of a Mat4\n * @param m4 - source matrix\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat3 made from m4\n */\nexport function fromMat4(m4: Mat4, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n  dst[0] = m4[0];  dst[1] = m4[1];  dst[ 2] = m4[ 2];  dst[ 3] = 0;\n  dst[4] = m4[4];  dst[5] = m4[5];  dst[ 6] = m4[ 6];  dst[ 7] = 0;\n  dst[8] = m4[8];  dst[9] = m4[9];  dst[10] = m4[10];  dst[11] = 0;\n  return dst;\n}\n\n/**\n * Creates a Mat3 rotation matrix from a quaternion\n * @param q - quaternion to create matrix from\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat3 made from q\n */\nexport function fromQuat(q: Quat, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const x = q[0]; const y = q[1]; const z = q[2]; const w = q[3];\n  const x2 = x + x; const y2 = y + y; const z2 = z + z;\n\n  const xx = x * x2;\n  const yx = y * x2;\n  const yy = y * y2;\n  const zx = z * x2;\n  const zy = z * y2;\n  const zz = z * z2;\n  const wx = w * x2;\n  const wy = w * y2;\n  const wz = w * z2;\n\n  dst[ 0] = 1 - yy - zz;  dst[ 1] = yx + wz;      dst[ 2] = zx - wy;      dst[ 3] = 0;\n  dst[ 4] = yx - wz;      dst[ 5] = 1 - xx - zz;  dst[ 6] = zy + wx;      dst[ 7] = 0;\n  dst[ 8] = zx + wy;      dst[ 9] = zy - wx;      dst[10] = 1 - xx - yy;  dst[11] = 0;\n\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = -m[ 0];  dst[ 1] = -m[ 1];  dst[ 2] = -m[ 2];\n  dst[ 4] = -m[ 4];  dst[ 5] = -m[ 5];  dst[ 6] = -m[ 6];\n  dst[ 8] = -m[ 8];  dst[ 9] = -m[ 9];  dst[10] = -m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix. (same as {@link mat3.clone})\n * Also see {@link mat3.create} and {@link mat3.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = m[ 0];  dst[ 1] = m[ 1];  dst[ 2] = m[ 2];\n  dst[ 4] = m[ 4];  dst[ 5] = m[ 5];  dst[ 6] = m[ 6];\n  dst[ 8] = m[ 8];  dst[ 9] = m[ 9];  dst[10] = m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as {@link mat3.copy})\n * Also see {@link mat3.create} and {@link mat3.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat3, b: Mat3): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat3, b: Mat3): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10];\n}\n\n/**\n * Creates a 3-by-3 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 3-by-3 identity matrix.\n */\nexport function identity(dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;  dst[ 1] = 0;  dst[ 2] = 0;\n  dst[ 4] = 0;  dst[ 5] = 1;  dst[ 6] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n  if (dst === m) {\n    let t: number;\n\n    // 0 1 2\n    // 4 5 6\n    // 8 9 10\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  dst[ 0] = m00;  dst[ 1] = m10;  dst[ 2] = m20;\n  dst[ 4] = m01;  dst[ 5] = m11;  dst[ 6] = m21;\n  dst[ 8] = m02;  dst[ 9] = m12;  dst[10] = m22;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  const b01 =  m22 * m11 - m12 * m21;\n  const b11 = -m22 * m10 + m12 * m20;\n  const b21 =  m21 * m10 - m11 * m20;\n\n  const invDet = 1 / (m00 * b01 + m01 * b11 + m02 * b21);\n\n  dst[ 0] = b01 * invDet;\n  dst[ 1] = (-m22 * m01 + m02 * m21) * invDet;\n  dst[ 2] = ( m12 * m01 - m02 * m11) * invDet;\n  dst[ 4] = b11 * invDet;\n  dst[ 5] = ( m22 * m00 - m02 * m20) * invDet;\n  dst[ 6] = (-m12 * m00 + m02 * m10) * invDet;\n  dst[ 8] = b21 * invDet;\n  dst[ 9] = (-m21 * m00 + m01 * m20) * invDet;\n  dst[10] = ( m11 * m00 - m01 * m10) * invDet;\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat3): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  return m00 * (m11 * m22 - m21 * m12) -\n         m10 * (m01 * m22 - m21 * m02) +\n         m20 * (m01 * m12 - m11 * m02);\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat3, b: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22;\n\n  return dst;\n}\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 3-by-3 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n  }\n  dst[ 8] = v[0];\n  dst[ 9] = v[1];\n  dst[10] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 3-by-3 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  dst[0] = m[8];\n  dst[1] = m[9];\n  return dst;\n}\n\n/**\n * Returns an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y,\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat3, axis: number, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  return dst;\n}\n\n/**\n * Sets an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(m: Mat3, v: Vec2, axis: number, dst?: Mat3): Mat3 {\n  if (dst !== m) {\n    dst = copy(m, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const yx = m[4];\n  const yy = m[5];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy);\n  dst[1] = Math.sqrt(yx * yx + yy * yy);\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which translates by the given vector v.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;     dst[ 1] = 0;     dst[ 2] = 0;\n  dst[ 4] = 0;     dst[ 5] = 1;     dst[ 6] = 0;\n  dst[ 8] = v[0];  dst[ 9] = v[1];  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Translates the given 3-by-3 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n  }\n\n  dst[ 8] = m00 * v0 + m10 * v1 + m20;\n  dst[ 9] = m01 * v0 + m11 * v1 + m21;\n  dst[10] = m02 * v0 + m12 * v1 + m22;\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which rotates  by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotation(angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] =  c;  dst[ 1] = s;  dst[ 2] = 0;\n  dst[ 4] = -s;  dst[ 5] = c;  dst[ 6] = 0;\n  dst[ 8] =  0;  dst[ 9] = 0;  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 3-by-3 matrix  by the given angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotate(m: Mat3, angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     2 entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = v[0];  dst[ 1] = 0;     dst[ 2] = 0;\n  dst[ 4] = 0;     dst[ 5] = v[1];  dst[ 6] = 0;\n  dst[ 8] = 0;     dst[ 9] = 0;     dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 3-by-3 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of 2 entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which scales uniformly in each dimension\n * @param s - Amount to scale\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function uniformScaling(s: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = s;  dst[ 1] = 0;  dst[ 2] = 0;\n  dst[ 4] = 0;  dst[ 5] = s;  dst[ 6] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 3-by-3 matrix in each dimension by an amount\n * given.\n * @param m - The matrix to be modified.\n * @param s - Amount to scale.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function uniformScale(m: Mat3, s: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = s * m[0 * 4 + 0];\n  dst[ 1] = s * m[0 * 4 + 1];\n  dst[ 2] = s * m[0 * 4 + 2];\n\n  dst[ 4] = s * m[1 * 4 + 0];\n  dst[ 5] = s * m[1 * 4 + 1];\n  dst[ 6] = s * m[1 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Vec3, create, setDefaultType, VecType } from './vec3';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Quat } from './quat';\n\nexport default Vec3;\nexport { create, setDefaultType };\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Vec3\n * Also see {@link vec3.create} and {@link vec3.copy}\n *\n * @param x first value\n * @param y second value\n * @param z third value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, z: number, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = x;\n  dst[1] = y;\n  dst[2] = z;\n\n  return dst;\n}\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec3, min = 0, max = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec3, b: Vec3, scale: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec3, b: Vec3): number {\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const bx = a[0];\n  const by = a[1];\n  const bz = a[2];\n  const mag1 = Math.sqrt(ax * ax + ay * ay + az * az);\n  const mag2 = Math.sqrt(bx * bx + by * by + bz * bz);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec3, b: Vec3): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec3, b: Vec3): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec3, b: Vec3, t: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec3, b: Vec3, t: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const t1 = a[2] * b[0] - a[0] * b[2];\n  const t2 = a[0] * b[1] - a[1] * b[0];\n  dst[0] = a[1] * b[2] - a[2] * b[1];\n  dst[1] = t1;\n  dst[2] = t2;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec3, b: Vec3): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return v0 * v0 + v1 * v1 + v2 * v2;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return dx * dx + dy * dy + dz * dz;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n  }\n\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as {@link vec3.clone})\n * Also see {@link vec3.create} and {@link vec3.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as {@link vec3.copy})\n * Also see {@link vec3.create} and {@link vec3.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random vector\n * @param scale - Default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const angle = Math.random() * 2 * Math.PI;\n  const z = Math.random() * 2 - 1;\n  const zScale = Math.sqrt(1 - z * z) * scale;\n  dst[0] = Math.cos(angle) * zScale;\n  dst[1] = Math.sin(angle) * zScale;\n  dst[2] = z * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec3 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = (m[3] * x + m[7] * y + m[11] * z + m[15]) || 1;\n\n  dst[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  dst[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  dst[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n\n  return dst;\n}\n\n/**\n * Transform vec4 by upper 3x3 matrix inside 4x4 matrix.\n * @param v - The direction.\n * @param m - The matrix.\n * @param dst - optional Vec3 to store result. If not passed a new one is created.\n * @returns The transformed vector.\n */\nexport function transformMat4Upper3x3(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[0] = v0 * m[0 * 4 + 0] + v1 * m[1 * 4 + 0] + v2 * m[2 * 4 + 0];\n  dst[1] = v0 * m[0 * 4 + 1] + v1 * m[1 * 4 + 1] + v2 * m[2 * 4 + 1];\n  dst[2] = v0 * m[0 * 4 + 2] + v1 * m[1 * 4 + 2] + v2 * m[2 * 4 + 2];\n\n  return dst;\n}\n\n/**\n * Transforms vec3 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec3, m: Mat3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n\n  dst[0] = x * m[0] + y * m[4] + z * m[8];\n  dst[1] = x * m[1] + y * m[5] + z * m[9];\n  dst[2] = x * m[2] + y * m[6] + z * m[10];\n\n  return dst;\n}\n\n/**\n * Transforms vec3 by Quaternion\n * @param v - the vector to transform\n * @param q - the quaternion to transform by\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed\n */\nexport function transformQuat(v: Vec3, q: Quat, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const w2 = q[3] * 2;\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n\n  const uvX = qy * z - qz * y;\n  const uvY = qz * x - qx * z;\n  const uvZ = qx * y - qy * x;\n\n  dst[0] = x + uvX * w2 + (qy * uvZ - qz * uvY) * 2;\n  dst[1] = y + uvY * w2 + (qz * uvX - qx * uvZ) * 2;\n  dst[2] = z + uvZ * w2 + (qx * uvY - qy * uvX) * 2;\n\n  return dst;\n}\n\n/**\n * Returns the translation component of a 4-by-4 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat3, dst?: Vec3) {\n    dst = dst || new VecType(3);\n    dst[0] = m[12];\n    dst[1] = m[13];\n    dst[2] = m[14];\n    return dst;\n}\n/**\n * Returns an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y, 2 = z;\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat4, axis: number, dst?: Vec3) {\n    dst = dst || new VecType(3);\n    const off = axis * 4;\n    dst[0] = m[off + 0];\n    dst[1] = m[off + 1];\n    dst[2] = m[off + 2];\n    return dst;\n}\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat4, dst: Vec3) {\n    dst = dst || new VecType(3);\n    const xx = m[0];\n    const xy = m[1];\n    const xz = m[2];\n    const yx = m[4];\n    const yy = m[5];\n    const yz = m[6];\n    const zx = m[8];\n    const zy = m[9];\n    const zz = m[10];\n    dst[0] = Math.sqrt(xx * xx + xy * xy + xz * xz);\n    dst[1] = Math.sqrt(yx * yx + yy * yy + yz * yz);\n    dst[2] = Math.sqrt(zx * zx + zy * zy + zz * zz);\n    return dst;\n}", "\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Quat } from './quat';\nimport Vec3, * as vec3 from './vec3-impl';\nimport * as utils from './utils';\n\nexport default Mat4;\n\nexport type Mat4LikeCtor = new (n: number) => Mat4;\n\n/**\n * 4x4 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat4.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat4.create();\n *     mat4.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat4.identity();\n *     const trans = mat4.translation([1, 2, 3]);\n *     mat4.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: Mat4LikeCtor = Float32Array;\n\n/**\n * Sets the type this library creates for a Mat4\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Mat4\n */\nexport function setDefaultType(ctor: new (n: number) => Mat4) {\n  const oldType = MatType;\n  MatType = ctor;\n  return oldType;\n}\n\n/**\n * Create a Mat4 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat4's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat4.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat4Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat4.create` is usually used\n * to create a Mat4 to be filled out as in\n *\n * ```\n * const m = mat4.create();\n * mat4.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param v9 - value for element 9\n * @param v10 - value for element 10\n * @param v11 - value for element 11\n * @param v12 - value for element 12\n * @param v13 - value for element 13\n * @param v14 - value for element 14\n * @param v15 - value for element 15\n * @returns created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number, v3?: number,\n    v4?: number, v5?: number, v6?: number, v7?: number,\n    v8?: number, v9?: number, v10?: number, v11?: number,\n    v12?: number, v13?: number, v14?: number, v15?: number): Mat4 {\n  const dst = new MatType(16);\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[3] = v3;\n          if (v4 !== undefined) {\n            dst[4] = v4;\n            if (v5 !== undefined) {\n              dst[5] = v5;\n              if (v6 !== undefined) {\n                dst[6] = v6;\n                if (v7 !== undefined) {\n                  dst[7] = v7;\n                  if (v8 !== undefined) {\n                    dst[8] = v8;\n                    if (v9 !== undefined) {\n                      dst[9] = v9;\n                      if (v10 !== undefined) {\n                        dst[10] = v10;\n                        if (v11 !== undefined) {\n                          dst[11] = v11;\n                          if (v12 !== undefined) {\n                            dst[12] = v12;\n                            if (v13 !== undefined) {\n                              dst[13] = v13;\n                              if (v14 !== undefined) {\n                                dst[14] = v14;\n                                if (v15 !== undefined) {\n                                  dst[15] = v15;\n                                }\n                              }\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  return dst;\n}\n\n/**\n * Sets the values of a Mat4\n * Also see {@link mat4.create} and {@link mat4.copy}\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param v9 - value for element 9\n * @param v10 - value for element 10\n * @param v11 - value for element 11\n * @param v12 - value for element 12\n * @param v13 - value for element 13\n * @param v14 - value for element 14\n * @param v15 - value for element 15\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat4 created from values.\n */\nexport function set(\n    v0: number, v1: number, v2: number, v3: number,\n    v4: number, v5: number, v6: number, v7: number,\n    v8: number, v9: number, v10: number, v11: number,\n    v12: number, v13: number, v14: number, v15: number,\n    dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = v0;   dst[ 1] = v1;   dst[ 2] = v2;   dst[ 3] = v3;\n  dst[ 4] = v4;   dst[ 5] = v5;   dst[ 6] = v6;   dst[ 7] = v7;\n  dst[ 8] = v8;   dst[ 9] = v9;   dst[10] = v10;  dst[11] = v11;\n  dst[12] = v12;  dst[13] = v13;  dst[14] = v14;  dst[15] = v15;\n\n  return dst;\n}\n\n/**\n * Creates a Mat4 from a Mat3\n * @param m3 - source matrix\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat4 made from m3\n */\nexport function fromMat3(m3: Mat3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = m3[0];  dst[ 1] = m3[1];  dst[ 2] = m3[ 2];  dst[ 3] = 0;\n  dst[ 4] = m3[4];  dst[ 5] = m3[5];  dst[ 6] = m3[ 6];  dst[ 7] = 0;\n  dst[ 8] = m3[8];  dst[ 9] = m3[9];  dst[10] = m3[10];  dst[11] = 0;\n  dst[12] = 0;      dst[13] = 0;      dst[14] = 0;       dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a Mat4 rotation matrix from a quaternion\n * @param q - quaternion to create matrix from\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns Mat4 made from q\n */\nexport function fromQuat(q: Quat, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const x = q[0]; const y = q[1]; const z = q[2]; const w = q[3];\n  const x2 = x + x; const y2 = y + y; const z2 = z + z;\n\n  const xx = x * x2;\n  const yx = y * x2;\n  const yy = y * y2;\n  const zx = z * x2;\n  const zy = z * y2;\n  const zz = z * z2;\n  const wx = w * x2;\n  const wy = w * y2;\n  const wz = w * z2;\n\n  dst[ 0] = 1 - yy - zz;  dst[ 1] = yx + wz;      dst[ 2] = zx - wy;      dst[ 3] = 0;\n  dst[ 4] = yx - wz;      dst[ 5] = 1 - xx - zz;  dst[ 6] = zy + wx;      dst[ 7] = 0;\n  dst[ 8] = zx + wy;      dst[ 9] = zy - wx;      dst[10] = 1 - xx - yy;  dst[11] = 0;\n  dst[12] = 0;            dst[13] = 0;            dst[14] = 0;            dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = -m[ 0];  dst[ 1] = -m[ 1];  dst[ 2] = -m[ 2];  dst[ 3] = -m[ 3];\n  dst[ 4] = -m[ 4];  dst[ 5] = -m[ 5];  dst[ 6] = -m[ 6];  dst[ 7] = -m[ 7];\n  dst[ 8] = -m[ 8];  dst[ 9] = -m[ 9];  dst[10] = -m[10];  dst[11] = -m[11];\n  dst[12] = -m[12];  dst[13] = -m[13];  dst[14] = -m[14];  dst[15] = -m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix. (same as {@link mat4.clone})\n * Also see {@link mat4.create} and {@link mat4.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = m[ 0];  dst[ 1] = m[ 1];  dst[ 2] = m[ 2];  dst[ 3] = m[ 3];\n  dst[ 4] = m[ 4];  dst[ 5] = m[ 5];  dst[ 6] = m[ 6];  dst[ 7] = m[ 7];\n  dst[ 8] = m[ 8];  dst[ 9] = m[ 9];  dst[10] = m[10];  dst[11] = m[11];\n  dst[12] = m[12];  dst[13] = m[13];  dst[14] = m[14];  dst[15] = m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as {@link mat4.copy})\n * Also see {@link mat4.create} and {@link mat4.set}\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat4, b: Mat4): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 3] - b[ 3]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 7] - b[ 7]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON &&\n         Math.abs(a[11] - b[11]) < utils.EPSILON &&\n         Math.abs(a[12] - b[12]) < utils.EPSILON &&\n         Math.abs(a[13] - b[13]) < utils.EPSILON &&\n         Math.abs(a[14] - b[14]) < utils.EPSILON &&\n         Math.abs(a[15] - b[15]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat4, b: Mat4): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 3] === b[ 3] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 7] === b[ 7] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10] &&\n         a[11] === b[11] &&\n         a[12] === b[12] &&\n         a[13] === b[13] &&\n         a[14] === b[14] &&\n         a[15] === b[15];\n}\n\n/**\n * Creates a 4-by-4 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 4-by-4 identity matrix.\n */\nexport function identity(dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;  dst[ 1] = 0;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] = 1;  dst[ 6] = 0;  dst[ 7] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = 1;  dst[11] = 0;\n  dst[12] = 0;  dst[13] = 0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n  if (dst === m) {\n    let t;\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[3];\n    m[3] = m[12];\n    m[12] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    t = m[7];\n    m[7] = m[13];\n    m[13] = t;\n\n    t = m[11];\n    m[11] = m[14];\n    m[14] = t;\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  dst[ 0] = m00;  dst[ 1] = m10;  dst[ 2] = m20;  dst[ 3] = m30;\n  dst[ 4] = m01;  dst[ 5] = m11;  dst[ 6] = m21;  dst[ 7] = m31;\n  dst[ 8] = m02;  dst[ 9] = m12;  dst[10] = m22;  dst[11] = m32;\n  dst[12] = m03;  dst[13] = m13;  dst[14] = m23;  dst[15] = m33;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n  const tmp12 = m20 * m31;\n  const tmp13 = m30 * m21;\n  const tmp14 = m10 * m31;\n  const tmp15 = m30 * m11;\n  const tmp16 = m10 * m21;\n  const tmp17 = m20 * m11;\n  const tmp18 = m00 * m31;\n  const tmp19 = m30 * m01;\n  const tmp20 = m00 * m21;\n  const tmp21 = m20 * m01;\n  const tmp22 = m00 * m11;\n  const tmp23 = m10 * m01;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n      (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n      (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n      (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n      (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  const d = 1 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\n\n  dst[ 0] = d * t0;\n  dst[ 1] = d * t1;\n  dst[ 2] = d * t2;\n  dst[ 3] = d * t3;\n  dst[ 4] = d * ((tmp1 * m10 + tmp2 * m20 + tmp5 * m30) -\n          (tmp0 * m10 + tmp3 * m20 + tmp4 * m30));\n  dst[ 5] = d * ((tmp0 * m00 + tmp7 * m20 + tmp8 * m30) -\n          (tmp1 * m00 + tmp6 * m20 + tmp9 * m30));\n  dst[ 6] = d * ((tmp3 * m00 + tmp6 * m10 + tmp11 * m30) -\n          (tmp2 * m00 + tmp7 * m10 + tmp10 * m30));\n  dst[ 7] = d * ((tmp4 * m00 + tmp9 * m10 + tmp10 * m20) -\n          (tmp5 * m00 + tmp8 * m10 + tmp11 * m20));\n  dst[ 8] = d * ((tmp12 * m13 + tmp15 * m23 + tmp16 * m33) -\n          (tmp13 * m13 + tmp14 * m23 + tmp17 * m33));\n  dst[ 9] = d * ((tmp13 * m03 + tmp18 * m23 + tmp21 * m33) -\n          (tmp12 * m03 + tmp19 * m23 + tmp20 * m33));\n  dst[10] = d * ((tmp14 * m03 + tmp19 * m13 + tmp22 * m33) -\n          (tmp15 * m03 + tmp18 * m13 + tmp23 * m33));\n  dst[11] = d * ((tmp17 * m03 + tmp20 * m13 + tmp23 * m23) -\n          (tmp16 * m03 + tmp21 * m13 + tmp22 * m23));\n  dst[12] = d * ((tmp14 * m22 + tmp17 * m32 + tmp13 * m12) -\n          (tmp16 * m32 + tmp12 * m12 + tmp15 * m22));\n  dst[13] = d * ((tmp20 * m32 + tmp12 * m02 + tmp19 * m22) -\n          (tmp18 * m22 + tmp21 * m32 + tmp13 * m02));\n  dst[14] = d * ((tmp18 * m12 + tmp23 * m32 + tmp15 * m02) -\n          (tmp22 * m32 + tmp14 * m02 + tmp19 * m12));\n  dst[15] = d * ((tmp22 * m22 + tmp16 * m02 + tmp21 * m12) -\n          (tmp20 * m12 + tmp23 * m22 + tmp17 * m02));\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat4): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n             (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n             (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n             (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n             (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  return m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat4, b: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a03 = a[3];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a13 = a[ 4 + 3];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const a23 = a[ 8 + 3];\n  const a30 = a[12 + 0];\n  const a31 = a[12 + 1];\n  const a32 = a[12 + 2];\n  const a33 = a[12 + 3];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b03 = b[3];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b13 = b[ 4 + 3];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n  const b23 = b[ 8 + 3];\n  const b30 = b[12 + 0];\n  const b31 = b[12 + 1];\n  const b32 = b[12 + 2];\n  const b33 = b[12 + 3];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02 + a30 * b03;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02 + a31 * b03;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02 + a32 * b03;\n  dst[ 3] = a03 * b00 + a13 * b01 + a23 * b02 + a33 * b03;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12 + a30 * b13;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12 + a31 * b13;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12 + a32 * b13;\n  dst[ 7] = a03 * b10 + a13 * b11 + a23 * b12 + a33 * b13;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22 + a30 * b23;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22 + a31 * b23;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22 + a32 * b23;\n  dst[11] = a03 * b20 + a13 * b21 + a23 * b22 + a33 * b23;\n  dst[12] = a00 * b30 + a10 * b31 + a20 * b32 + a30 * b33;\n  dst[13] = a01 * b30 + a11 * b31 + a21 * b32 + a31 * b33;\n  dst[14] = a02 * b30 + a12 * b31 + a22 * b32 + a32 * b33;\n  dst[15] = a03 * b30 + a13 * b31 + a23 * b32 + a33 * b33;\n\n  return dst;\n}\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 4-by-4 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 3] = a[ 3];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n    dst[ 7] = a[ 7];\n    dst[ 8] = a[ 8];\n    dst[ 9] = a[ 9];\n    dst[10] = a[10];\n    dst[11] = a[11];\n  }\n  dst[12] = v[0];\n  dst[13] = v[1];\n  dst[14] = v[2];\n  dst[15] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 4-by-4 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  dst[0] = m[12];\n  dst[1] = m[13];\n  dst[2] = m[14];\n  return dst;\n}\n\n/**\n * Returns an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y, 2 = z;\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat4, axis: number, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  dst[2] = m[off + 2];\n  return dst;\n}\n\n/**\n * Sets an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y, 2 = z;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(a: Mat4, v: Vec3, axis: number, dst: Mat4): Mat4 {\n  if (dst !== a) {\n    dst = copy(a, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  dst[off + 2] = v[2];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const xz = m[2];\n  const yx = m[4];\n  const yy = m[5];\n  const yz = m[6];\n  const zx = m[8];\n  const zy = m[9];\n  const zz = m[10];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy + xz * xz);\n  dst[1] = Math.sqrt(yx * yx + yy * yy + yz * yz);\n  dst[2] = Math.sqrt(zx * zx + zy * zy + zz * zz);\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the angular height\n * of the frustum, the aspect ratio, and the near and far clipping planes.  The\n * arguments define a frustum extending in the negative z direction.  The given\n * angle is the vertical angle of the frustum, and the horizontal angle is\n * determined to produce the given aspect ratio.  The arguments near and far are\n * the distances to the near and far clipping planes.  Note that near and far\n * are not z coordinates, but rather they are distances along the negative\n * z-axis.  The matrix generated sends the viewing frustum to the unit box.\n * We assume a unit box extending from -1 to 1 in the x and y dimensions and\n * from 0 to 1 in the z dimension.\n *\n * Note: If you pass `Infinity` for zFar then it will produce a projection matrix\n * returns -Infinity for Z when transforming coordinates with Z <= 0 and +Infinity for Z\n * otherwise.\n *\n * @param fieldOfViewYInRadians - The camera angle from top to bottom (in radians).\n * @param aspect - The aspect ratio width / height.\n * @param zNear - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param zFar - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The perspective matrix.\n */\nexport function perspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewYInRadians);\n\n  dst[0]  = f / aspect;\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = f;\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[11] = -1;\n\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[15] = 0;\n\n  if (zFar === Infinity) {\n    dst[10] = -1;\n    dst[14] = -zNear;\n  } else {\n    const rangeInv = 1 / (zNear - zFar);\n    dst[10] = zFar * rangeInv;\n    dst[14] = zFar * zNear * rangeInv;\n  }\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 orthogonal transformation matrix that transforms from\n * the given the left, right, bottom, and top dimensions to -1 +1 in x, and y\n * and 0 to +1 in z.\n * @param left - Left side of the near clipping plane viewport.\n * @param right - Right side of the near clipping plane viewport.\n * @param bottom - Bottom of the near clipping plane viewport.\n * @param top - Top of the near clipping plane viewport.\n * @param near - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param far - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The orthographic projection matrix.\n */\nexport function ortho(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[0]  = 2 / (right - left);\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = 2 / (top - bottom);\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[10] = 1 / (near - far);\n  dst[11] = 0;\n\n  dst[12] = (right + left) / (left - right);\n  dst[13] = (top + bottom) / (bottom - top);\n  dst[14] = near / (near - far);\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the left, right,\n * top, bottom, near and far clipping planes. The arguments define a frustum\n * extending in the negative z direction. The arguments near and far are the\n * distances to the near and far clipping planes. Note that near and far are not\n * z coordinates, but rather they are distances along the negative z-axis. The\n * matrix generated sends the viewing frustum to the unit box. We assume a unit\n * box extending from -1 to 1 in the x and y dimensions and from 0 to 1 in the z\n * dimension.\n * @param left - The x coordinate of the left plane of the box.\n * @param right - The x coordinate of the right plane of the box.\n * @param bottom - The y coordinate of the bottom plane of the box.\n * @param top - The y coordinate of the right plane of the box.\n * @param near - The negative z coordinate of the near plane of the box.\n * @param far - The negative z coordinate of the far plane of the box.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The perspective projection matrix.\n */\nexport function frustum(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const dx = (right - left);\n  const dy = (top - bottom);\n  const dz = (near - far);\n\n  dst[ 0] = 2 * near / dx;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 2 * near / dy;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = (left + right) / dx;\n  dst[ 9] = (top + bottom) / dy;\n  dst[10] = far / dz;\n  dst[11] = -1;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = near * far / dz;\n  dst[15] = 0;\n\n  return dst;\n}\n\nlet xAxis: Vec3;\nlet yAxis: Vec3;\nlet zAxis: Vec3;\n\n/**\n * Computes a 4-by-4 aim transformation.\n *\n * This is a matrix which positions an object aiming down positive Z.\n * toward the target.\n *\n * Note: this is **NOT** the inverse of lookAt as lookAt looks at negative Z.\n *\n * @param position - The position of the object.\n * @param target - The position meant to be aimed at.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The aim matrix.\n */\nexport function aim(position: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(vec3.subtract(target, position, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];     dst[ 1] = xAxis[1];     dst[ 2] = xAxis[2];     dst[ 3] = 0;\n  dst[ 4] = yAxis[0];     dst[ 5] = yAxis[1];     dst[ 6] = yAxis[2];     dst[ 7] = 0;\n  dst[ 8] = zAxis[0];     dst[ 9] = zAxis[1];     dst[10] = zAxis[2];     dst[11] = 0;\n  dst[12] = position[0];  dst[13] = position[1];  dst[14] = position[2];  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 camera aim transformation.\n *\n * This is a matrix which positions an object aiming down negative Z.\n * toward the target.\n *\n * Note: this is the inverse of `lookAt`\n *\n * @param eye - The position of the object.\n * @param target - The position meant to be aimed at.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The aim matrix.\n */\nexport function cameraAim(eye: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(vec3.subtract(eye, target, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];     dst[ 1] = xAxis[1];     dst[ 2] = xAxis[2];     dst[ 3] = 0;\n  dst[ 4] = yAxis[0];     dst[ 5] = yAxis[1];     dst[ 6] = yAxis[2];     dst[ 7] = 0;\n  dst[ 8] = zAxis[0];     dst[ 9] = zAxis[1];     dst[10] = zAxis[2];     dst[11] = 0;\n  dst[12] = eye[0];  dst[13] = eye[1];  dst[14] = eye[2];  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 view transformation.\n *\n * This is a view matrix which transforms all other objects\n * to be in the space of the view defined by the parameters.\n *\n * @param eye - The position of the object.\n * @param target - The position meant to be aimed at.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The look-at matrix.\n */\nexport function lookAt(eye: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(vec3.subtract(eye, target, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];  dst[ 1] = yAxis[0];  dst[ 2] = zAxis[0];  dst[ 3] = 0;\n  dst[ 4] = xAxis[1];  dst[ 5] = yAxis[1];  dst[ 6] = zAxis[1];  dst[ 7] = 0;\n  dst[ 8] = xAxis[2];  dst[ 9] = yAxis[2];  dst[10] = zAxis[2];  dst[11] = 0;\n\n  dst[12] = -(xAxis[0] * eye[0] + xAxis[1] * eye[1] + xAxis[2] * eye[2]);\n  dst[13] = -(yAxis[0] * eye[0] + yAxis[1] * eye[1] + yAxis[2] * eye[2]);\n  dst[14] = -(zAxis[0] * eye[0] + zAxis[1] * eye[1] + zAxis[2] * eye[2]);\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which translates by the given vector v.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;     dst[ 1] = 0;     dst[ 2] = 0;     dst[ 3] = 0;\n  dst[ 4] = 0;     dst[ 5] = 1;     dst[ 6] = 0;     dst[ 7] = 0;\n  dst[ 8] = 0;     dst[ 9] = 0;     dst[10] = 1;     dst[11] = 0;\n  dst[12] = v[0];  dst[13] = v[1];  dst[14] = v[2];  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Translates the given 4-by-4 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 3] = m03;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n    dst[ 7] = m13;\n    dst[ 8] = m20;\n    dst[ 9] = m21;\n    dst[10] = m22;\n    dst[11] = m23;\n  }\n\n  dst[12] = m00 * v0 + m10 * v1 + m20 * v2 + m30;\n  dst[13] = m01 * v0 + m11 * v1 + m21 * v2 + m31;\n  dst[14] = m02 * v0 + m12 * v1 + m22 * v2 + m32;\n  dst[15] = m03 * v0 + m13 * v1 + m23 * v2 + m33;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the x-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationX(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = 1;  dst[ 1] =  0;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] =  c;  dst[ 6] = s;  dst[ 7] = 0;\n  dst[ 8] = 0;  dst[ 9] = -s;  dst[10] = c;  dst[11] = 0;\n  dst[12] = 0;  dst[13] =  0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the x-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateX(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[4]  = c * m10 + s * m20;\n  dst[5]  = c * m11 + s * m21;\n  dst[6]  = c * m12 + s * m22;\n  dst[7]  = c * m13 + s * m23;\n  dst[8]  = c * m20 - s * m10;\n  dst[9]  = c * m21 - s * m11;\n  dst[10] = c * m22 - s * m12;\n  dst[11] = c * m23 - s * m13;\n\n  if (m !== dst) {\n    dst[ 0] = m[ 0];\n    dst[ 1] = m[ 1];\n    dst[ 2] = m[ 2];\n    dst[ 3] = m[ 3];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the y-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationY(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;  dst[ 1] = 0;  dst[ 2] = -s;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] = 1;  dst[ 6] =  0;  dst[ 7] = 0;\n  dst[ 8] = s;  dst[ 9] = 0;  dst[10] =  c;  dst[11] = 0;\n  dst[12] = 0;  dst[13] = 0;  dst[14] =  0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the y-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateY(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 - s * m20;\n  dst[ 1] = c * m01 - s * m21;\n  dst[ 2] = c * m02 - s * m22;\n  dst[ 3] = c * m03 - s * m23;\n  dst[ 8] = c * m20 + s * m00;\n  dst[ 9] = c * m21 + s * m01;\n  dst[10] = c * m22 + s * m02;\n  dst[11] = c * m23 + s * m03;\n\n  if (m !== dst) {\n    dst[ 4] = m[ 4];\n    dst[ 5] = m[ 5];\n    dst[ 6] = m[ 6];\n    dst[ 7] = m[ 7];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the z-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationZ(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] =  c;  dst[ 1] = s;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = -s;  dst[ 5] = c;  dst[ 6] = 0;  dst[ 7] = 0;\n  dst[ 8] =  0;  dst[ 9] = 0;  dst[10] = 1;  dst[11] = 0;\n  dst[12] =  0;  dst[13] = 0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the z-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateZ(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n  dst[ 3] = c * m03 + s * m13;\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n  dst[ 7] = c * m13 - s * m03;\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n    dst[11] = m[11];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport function axisRotation(axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  dst[ 0] = xx + (1 - xx) * c;\n  dst[ 1] = x * y * oneMinusCosine + z * s;\n  dst[ 2] = x * z * oneMinusCosine - y * s;\n  dst[ 3] = 0;\n  dst[ 4] = x * y * oneMinusCosine - z * s;\n  dst[ 5] = yy + (1 - yy) * c;\n  dst[ 6] = y * z * oneMinusCosine + x * s;\n  dst[ 7] = 0;\n  dst[ 8] = x * z * oneMinusCosine + y * s;\n  dst[ 9] = y * z * oneMinusCosine - x * s;\n  dst[10] = zz + (1 - zz) * c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle. (same as axisRotation)\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport const rotation = axisRotation;\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle.\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function axisRotate(m: Mat4, axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  const r00 = xx + (1 - xx) * c;\n  const r01 = x * y * oneMinusCosine + z * s;\n  const r02 = x * z * oneMinusCosine - y * s;\n  const r10 = x * y * oneMinusCosine - z * s;\n  const r11 = yy + (1 - yy) * c;\n  const r12 = y * z * oneMinusCosine + x * s;\n  const r20 = x * z * oneMinusCosine + y * s;\n  const r21 = y * z * oneMinusCosine - x * s;\n  const r22 = zz + (1 - zz) * c;\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n\n  dst[ 0] = r00 * m00 + r01 * m10 + r02 * m20;\n  dst[ 1] = r00 * m01 + r01 * m11 + r02 * m21;\n  dst[ 2] = r00 * m02 + r01 * m12 + r02 * m22;\n  dst[ 3] = r00 * m03 + r01 * m13 + r02 * m23;\n  dst[ 4] = r10 * m00 + r11 * m10 + r12 * m20;\n  dst[ 5] = r10 * m01 + r11 * m11 + r12 * m21;\n  dst[ 6] = r10 * m02 + r11 * m12 + r12 * m22;\n  dst[ 7] = r10 * m03 + r11 * m13 + r12 * m23;\n  dst[ 8] = r20 * m00 + r21 * m10 + r22 * m20;\n  dst[ 9] = r20 * m01 + r21 * m11 + r22 * m21;\n  dst[10] = r20 * m02 + r21 * m12 + r22 * m22;\n  dst[11] = r20 * m03 + r21 * m13 + r22 * m23;\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle. (same as rotate)\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport const rotate = axisRotate;\n\n/**\n * Creates a 4-by-4 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     three entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = v[0];  dst[ 1] = 0;     dst[ 2] = 0;     dst[ 3] = 0;\n  dst[ 4] = 0;     dst[ 5] = v[1];  dst[ 6] = 0;     dst[ 7] = 0;\n  dst[ 8] = 0;     dst[ 9] = 0;     dst[10] = v[2];  dst[11] = 0;\n  dst[12] = 0;     dst[13] = 0;     dst[14] = 0;     dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 4-by-4 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of three entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n  dst[ 3] = v0 * m[0 * 4 + 3];\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n  dst[ 7] = v1 * m[1 * 4 + 3];\n  dst[ 8] = v2 * m[2 * 4 + 0];\n  dst[ 9] = v2 * m[2 * 4 + 1];\n  dst[10] = v2 * m[2 * 4 + 2];\n  dst[11] = v2 * m[2 * 4 + 3];\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which scales a uniform amount in each dimension.\n * @param s - the amount to scale\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function uniformScaling(s: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = s;  dst[ 1] = 0;  dst[ 2] = 0;  dst[ 3] = 0;\n  dst[ 4] = 0;  dst[ 5] = s;  dst[ 6] = 0;  dst[ 7] = 0;\n  dst[ 8] = 0;  dst[ 9] = 0;  dst[10] = s;  dst[11] = 0;\n  dst[12] = 0;  dst[13] = 0;  dst[14] = 0;  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 4-by-4 matrix in each dimension by a uniform scale.\n * @param m - The matrix to be modified.\n * @param s - The amount to scale.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function uniformScale(m: Mat4, s: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = s * m[0 * 4 + 0];\n  dst[ 1] = s * m[0 * 4 + 1];\n  dst[ 2] = s * m[0 * 4 + 2];\n  dst[ 3] = s * m[0 * 4 + 3];\n  dst[ 4] = s * m[1 * 4 + 0];\n  dst[ 5] = s * m[1 * 4 + 1];\n  dst[ 6] = s * m[1 * 4 + 2];\n  dst[ 7] = s * m[1 * 4 + 3];\n  dst[ 8] = s * m[2 * 4 + 0];\n  dst[ 9] = s * m[2 * 4 + 1];\n  dst[10] = s * m[2 * 4 + 2];\n  dst[11] = s * m[2 * 4 + 3];\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 4 values, Float32Array with 4 values, or a Float64Array with 4 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link quat.setDefaultType}.\n */\nexport type Quat = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Quat4 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Quat4`. In other words you can do this\n *\n *     const v = quat4.cross(v1, v2);  // Creates a new Quat4 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = quat4.create();\n *     quat4.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     quat4.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let QuatType: new (n: number) => Quat = Float32Array;\n\n/**\n * Sets the type this library creates for a Quat4\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Quat4\n */\nexport function setDefaultType(ctor: new (n: number) => Quat) {\n  const oldType = QuatType;\n  QuatType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a quat4; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param w - Initial w value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number, w?: number): Quat {\n  const dst = new QuatType(4);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n        if (w !== undefined) {\n          dst[3] = w;\n        }\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Quat, create, setDefaultType, QuatType } from './quat';\nimport { Mat3 } from './mat3.js';\nimport { Mat4 } from './mat4.js';\nimport { Vec3 } from './vec3.js';\nimport * as vec3 from './vec3-impl.js';\n\nexport type RotationOrder =  'xyz' |  'xzy' |  'yxz' |  'yzx' |  'zxy' |  'zyx';\n\nexport default Quat;\nexport { create, setDefaultType };\n\n/**\n * Creates a Quat; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param z - Initial w value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Quat\n * Also see {@link quat.create} and {@link quat.copy}\n *\n * @param x first value\n * @param y second value\n * @param z third value\n * @param w fourth value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, z: number, w: number, dst?: Quat) {\n  dst = dst || new QuatType(4);\n\n  dst[0] = x;\n  dst[1] = y;\n  dst[2] = z;\n  dst[3] = w;\n\n  return dst;\n}\n\n/**\n * Sets a quaternion from the given angle and  axis,\n * then returns it.\n *\n * @param axis - the axis to rotate around\n * @param angleInRadians - the angle\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The quaternion that represents the given axis and angle\n **/\nexport function fromAxisAngle(axis: Vec3, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n  const s = Math.sin(halfAngle);\n\n  dst[0] = s * axis[0];\n  dst[1] = s * axis[1];\n  dst[2] = s * axis[2];\n  dst[3] = Math.cos(halfAngle);\n\n  return dst;\n}\n\n/**\n * Gets the rotation axis and angle\n * @param q - quaternion to compute from\n * @param dst - Vec3 to hold result. If not passed in a new one is created.\n * @return angle and axis\n */\nexport function toAxisAngle(q: Quat, dst?: Vec3): { angle: number, axis: Vec3 } {\n  dst = dst || vec3.create(4);\n\n  const angle = Math.acos(q[3]) * 2;\n  const s = Math.sin(angle * 0.5);\n  if (s > utils.EPSILON) {\n    dst[0] = q[0] / s;\n    dst[1] = q[1] / s;\n    dst[2] = q[2] / s;\n  } else {\n    dst[0] = 1;\n    dst[1] = 0;\n    dst[2] = 0;\n  }\n\n  return { angle, axis: dst };\n}\n\n/**\n * Returns the angle in degrees between two rotations a and b.\n * @param a - quaternion a\n * @param b - quaternion b\n * @return angle in radians between the two quaternions\n */\nexport function angle(a: Quat, b: Quat) {\n  const d = dot(a, b);\n  return Math.acos(2 * d * d - 1);\n}\n\n/**\n * Multiplies two quaternions\n *\n * @param a - the first quaternion\n * @param b - the second quaternion\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function multiply(a: Quat, b: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const aw = a[3];\n\n  const bx = b[0];\n  const by = b[1];\n  const bz = b[2];\n  const bw = b[3];\n\n  dst[0] = ax * bw + aw * bx + ay * bz - az * by;\n  dst[1] = ay * bw + aw * by + az * bx - ax * bz;\n  dst[2] = az * bw + aw * bz + ax * by - ay * bx;\n  dst[3] = aw * bw - ax * bx - ay * by - az * bz;\n\n  return dst;\n}\n\n/**\n * Multiplies two quaternions\n *\n * @param a - the first quaternion\n * @param b - the second quaternion\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport const mul = multiply;\n\n/**\n * Rotates the given quaternion around the X axis by the given angle.\n * @param q - quaternion to rotate\n * @param angleInRadians - The angle by which to rotate\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function rotateX(q: Quat, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const qw = q[3];\n\n  const bx = Math.sin(halfAngle);\n  const bw = Math.cos(halfAngle);\n\n  dst[0] = qx * bw + qw * bx;\n  dst[1] = qy * bw + qz * bx;\n  dst[2] = qz * bw - qy * bx;\n  dst[3] = qw * bw - qx * bx;\n\n  return dst;\n}\n\n/**\n * Rotates the given quaternion around the Y axis by the given angle.\n * @param q - quaternion to rotate\n * @param angleInRadians - The angle by which to rotate\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function rotateY(q: Quat, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const qw = q[3];\n\n  const by = Math.sin(halfAngle);\n  const bw = Math.cos(halfAngle);\n\n  dst[0] = qx * bw - qz * by;\n  dst[1] = qy * bw + qw * by;\n  dst[2] = qz * bw + qx * by;\n  dst[3] = qw * bw - qy * by;\n\n  return dst;\n}\n\n/**\n * Rotates the given quaternion around the Z axis by the given angle.\n * @param q - quaternion to rotate\n * @param angleInRadians - The angle by which to rotate\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function rotateZ(q: Quat, angleInRadians: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const halfAngle = angleInRadians * 0.5;\n\n  const qx = q[0];\n  const qy = q[1];\n  const qz = q[2];\n  const qw = q[3];\n\n  const bz = Math.sin(halfAngle);\n  const bw = Math.cos(halfAngle);\n\n  dst[0] = qx * bw + qy * bz;\n  dst[1] = qy * bw - qx * bz;\n  dst[2] = qz * bw + qw * bz;\n  dst[3] = qw * bw - qz * bz;\n\n  return dst;\n}\n\n/**\n * Spherically linear interpolate between two quaternions\n *\n * @param a - starting value\n * @param b - ending value\n * @param t - value where 0 = a and 1 = b\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the result of a * b\n */\nexport function slerp(a: Quat, b: Quat, t: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const aw = a[3];\n\n  let bx = b[0];\n  let by = b[1];\n  let bz = b[2];\n  let bw = b[3];\n\n  let cosOmega = ax * bx + ay * by + az * bz + aw * bw;\n\n  if (cosOmega < 0) {\n    cosOmega = -cosOmega;\n    bx = -bx;\n    by = -by;\n    bz = -bz;\n    bw = -bw;\n  }\n\n  let scale0;\n  let scale1;\n\n  if (1.0 - cosOmega > utils.EPSILON) {\n    const omega = Math.acos(cosOmega);\n    const sinOmega = Math.sin(omega);\n    scale0 = Math.sin((1 - t) * omega) / sinOmega;\n    scale1 = Math.sin(t * omega) / sinOmega;\n  } else {\n    scale0 = 1.0 - t;\n    scale1 = t;\n  }\n\n  dst[0] = scale0 * ax + scale1 * bx;\n  dst[1] = scale0 * ay + scale1 * by;\n  dst[2] = scale0 * az + scale1 * bz;\n  dst[3] = scale0 * aw + scale1 * bw;\n\n  return dst;\n}\n\n/**\n * Compute the inverse of a quaternion\n *\n * @param q - quaternion to compute the inverse of\n * @returns A quaternion that is the result of a * b\n */\nexport function inverse(q: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const a0 = q[0];\n  const a1 = q[1];\n  const a2 = q[2];\n  const a3 = q[3];\n\n  const dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n  const invDot = dot ? 1 / dot : 0;\n\n  dst[0] = -a0 * invDot;\n  dst[1] = -a1 * invDot;\n  dst[2] = -a2 * invDot;\n  dst[3] =  a3 * invDot;\n\n  return dst;\n}\n\n/**\n * Compute the conjugate of a quaternion\n * For quaternions with a magnitude of 1 (a unit quaternion)\n * this returns the same as the inverse but is faster to calculate.\n *\n * @param q - quaternion to compute the conjugate of.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The conjugate of q\n */\nexport function conjugate(q: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = -q[0];\n  dst[1] = -q[1];\n  dst[2] = -q[2];\n  dst[3] =  q[3];\n\n  return dst;\n}\n\n/**\n * Creates a quaternion from the given rotation matrix.\n *\n * The created quaternion is not normalized.\n *\n * @param m - rotation matrix\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns the result\n */\nexport function fromMat(m: Mat3 | Mat4, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  /*\n  0 1 2\n  3 4 5\n  6 7 8\n\n  0 1 2\n  4 5 6\n  8 9 10\n   */\n\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n  // article \"Quaternion Calculus and Fast Animation\".\n  const trace = m[0] + m[5] + m[10];\n\n  if (trace > 0.0) {\n    // |w| > 1/2, may as well choose w > 1/2\n    const root = Math.sqrt(trace + 1); // 2w\n    dst[3] = 0.5 * root;\n    const invRoot = 0.5 / root; // 1/(4w)\n\n    dst[0] = (m[6] - m[9]) * invRoot;\n    dst[1] = (m[8] - m[2]) * invRoot;\n    dst[2] = (m[1] - m[4]) * invRoot;\n  } else {\n    // |w| <= 1/2\n    let i = 0;\n\n    if (m[5] > m[0]) {\n      i = 1;\n    }\n    if (m[10] > m[i * 4 + i]) {\n      i = 2;\n    }\n\n    const j = (i + 1) % 3;\n    const k = (i + 2) % 3;\n\n    const root = Math.sqrt(m[i * 4 + i] - m[j * 4 + j] - m[k * 4 + k] + 1.0);\n    dst[i] = 0.5 * root;\n\n    const invRoot = 0.5 / root;\n\n    dst[3] = (m[j * 4 + k] - m[k * 4 + j]) * invRoot;\n    dst[j] = (m[j * 4 + i] + m[i * 4 + j]) * invRoot;\n    dst[k] = (m[k * 4 + i] + m[i * 4 + k]) * invRoot;\n  }\n\n  return dst;\n}\n\n/**\n * Creates a quaternion from the given euler angle x, y, z using the provided intrinsic order for the conversion.\n *\n * @param xAngleInRadians - angle to rotate around X axis in radians.\n * @param yAngleInRadians - angle to rotate around Y axis in radians.\n * @param zAngleInRadians - angle to rotate around Z axis in radians.\n * @param order - order to apply euler angles\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion representing the same rotation as the euler angles applied in the given order\n */\nexport function fromEuler(\n    xAngleInRadians: number,\n    yAngleInRadians: number,\n    zAngleInRadians: number,\n    order: RotationOrder,\n    dst?: Quat) {\n  dst = dst || new QuatType(4);\n\n  const xHalfAngle = xAngleInRadians * 0.5;\n  const yHalfAngle = yAngleInRadians * 0.5;\n  const zHalfAngle = zAngleInRadians * 0.5;\n\n  const sx = Math.sin(xHalfAngle);\n  const cx = Math.cos(xHalfAngle);\n  const sy = Math.sin(yHalfAngle);\n  const cy = Math.cos(yHalfAngle);\n  const sz = Math.sin(zHalfAngle);\n  const cz = Math.cos(zHalfAngle);\n\n  switch (order) {\n    case 'xyz':\n      dst[0] = sx * cy * cz + cx * sy * sz;\n      dst[1] = cx * sy * cz - sx * cy * sz;\n      dst[2] = cx * cy * sz + sx * sy * cz;\n      dst[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case 'xzy':\n      dst[0] = sx * cy * cz - cx * sy * sz;\n      dst[1] = cx * sy * cz - sx * cy * sz;\n      dst[2] = cx * cy * sz + sx * sy * cz;\n      dst[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case 'yxz':\n      dst[0] = sx * cy * cz + cx * sy * sz;\n      dst[1] = cx * sy * cz - sx * cy * sz;\n      dst[2] = cx * cy * sz - sx * sy * cz;\n      dst[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case 'yzx':\n      dst[0] = sx * cy * cz + cx * sy * sz;\n      dst[1] = cx * sy * cz + sx * cy * sz;\n      dst[2] = cx * cy * sz - sx * sy * cz;\n      dst[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case 'zxy':\n      dst[0] = sx * cy * cz - cx * sy * sz;\n      dst[1] = cx * sy * cz + sx * cy * sz;\n      dst[2] = cx * cy * sz + sx * sy * cz;\n      dst[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case 'zyx':\n      dst[0] = sx * cy * cz - cx * sy * sz;\n      dst[1] = cx * sy * cz + sx * cy * sz;\n      dst[2] = cx * cy * sz - sx * sy * cz;\n      dst[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    default:\n      throw new Error(`Unknown rotation order: ${order}`);\n  }\n\n  return dst;\n}\n\n/**\n * Copies a quaternion. (same as {@link quat.clone})\n * Also see {@link quat.create} and {@link quat.set}\n * @param q - The quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is a copy of q\n */\nexport function copy(q: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = q[0];\n  dst[1] = q[1];\n  dst[2] = q[2];\n  dst[3] = q[3];\n\n  return dst;\n}\n\n/**\n * Clones a quaternion. (same as {@link quat.copy})\n * Also see {@link quat.create} and {@link quat.set}\n * @param q - The quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A copy of q.\n */\nexport const clone = copy;\n\n/**\n * Adds two quaternions; assumes a and b have the same dimension.\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the sum of a and b.\n */\nexport function add(a: Quat, b: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n  dst[3] = a[3] + b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two quaternions.\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the difference of a and b.\n */\nexport function subtract(a: Quat, b: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n  dst[3] = a[3] - b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two quaternions.\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns A quaternion that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Multiplies a quaternion by a scalar.\n * @param v - The quaternion.\n * @param k - The scalar.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The scaled quaternion.\n */\nexport function mulScalar(v: Quat, k: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n  dst[3] = v[3] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a quaternion by a scalar. (same as mulScalar)\n * @param v - The quaternion.\n * @param k - The scalar.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The scaled quaternion.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The scaled quaternion.\n */\nexport function divScalar(v: Quat, k: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n  dst[3] = v[3] / k;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two quaternions\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @returns dot product\n */\nexport function dot(a: Quat, b: Quat): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]) + (a[3] * b[3]);\n}\n\n/**\n * Performs linear interpolation on two quaternions.\n * Given quaternions a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @param t - Interpolation coefficient.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Quat, b: Quat, t: number, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n  dst[3] = a[3] + t * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Computes the length of quaternion\n * @param v - quaternion.\n * @returns length of quaternion.\n */\nexport function length(v: Quat): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n}\n\n/**\n * Computes the length of quaternion (same as length)\n * @param v - quaternion.\n * @returns length of quaternion.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of quaternion\n * @param v - quaternion.\n * @returns square of the length of quaternion.\n */\nexport function lengthSq(v: Quat): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3;\n}\n\n/**\n * Computes the square of the length of quaternion (same as lengthSq)\n * @param v - quaternion.\n * @returns square of the length of quaternion.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Divides a quaternion by its Euclidean length and returns the quotient.\n * @param v - The quaternion.\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns The normalized quaternion.\n */\nexport function normalize(v: Quat, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n    dst[3] = v3 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Check if 2 quaternions are approximately equal\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @returns true if quaternions are approximately equal\n */\nexport function equalsApproximately(a: Quat, b: Quat): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON &&\n         Math.abs(a[3] - b[3]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 quaternions are exactly equal\n * @param a - Operand quaternion.\n * @param b - Operand quaternion.\n * @returns true if quaternions are exactly equal\n */\nexport function equals(a: Quat, b: Quat): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Creates an identity quaternion\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns an identity quaternion\n */\nexport function identity(dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n  dst[3] = 1;\n\n  return dst;\n}\n\nlet tempVec3: Vec3;\nlet xUnitVec3: Vec3;\nlet yUnitVec3: Vec3;\n\n/**\n * Computes a quaternion to represent the shortest rotation from one vector to another.\n *\n * @param aUnit - the start vector\n * @param bUnit - the end vector\n * @param dst - quaternion to hold result. If not passed in a new one is created.\n * @returns the result\n */\nexport function rotationTo(aUnit: Vec3, bUnit: Vec3, dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  tempVec3 = tempVec3 || vec3.create();\n  xUnitVec3 = xUnitVec3 || vec3.create(1, 0, 0);\n  yUnitVec3 = yUnitVec3 || vec3.create(0, 1, 0);\n\n  const dot = vec3.dot(aUnit, bUnit);\n  if (dot < -0.999999) {\n    vec3.cross(xUnitVec3, aUnit, tempVec3);\n    if (vec3.len(tempVec3) < 0.000001) {\n      vec3.cross(yUnitVec3, aUnit, tempVec3);\n    }\n\n    vec3.normalize(tempVec3, tempVec3);\n    fromAxisAngle(tempVec3, Math.PI, dst);\n\n    return dst;\n  } else if (dot > 0.999999) {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 1;\n\n    return dst;\n  } else {\n    vec3.cross(aUnit, bUnit, tempVec3);\n\n    dst[0] = tempVec3[0];\n    dst[1] = tempVec3[1];\n    dst[2] = tempVec3[2];\n    dst[3] = 1 + dot;\n\n    return normalize(dst, dst);\n  }\n}\n\nlet tempQuat1: Quat;\nlet tempQuat2: Quat;\n\n/**\n * Performs a spherical linear interpolation with two control points\n *\n * @param a - the first quaternion\n * @param b - the second quaternion\n * @param c - the third quaternion\n * @param d - the fourth quaternion\n * @param t - Interpolation coefficient 0 to 1\n * @returns result\n */\nexport function sqlerp(\n    a: Quat,\n    b: Quat,\n    c: Quat,\n    d: Quat,\n    t: number,\n    dst?: Quat): Quat {\n  dst = dst || new QuatType(4);\n\n  tempQuat1 = tempQuat1 || new QuatType(4);\n  tempQuat2 = tempQuat2 || new QuatType(4);\n\n  slerp(a, d, t, tempQuat1);\n  slerp(b, c, t, tempQuat2);\n  slerp(tempQuat1, tempQuat2, 2 * t * (1 - t), dst);\n\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * A JavaScript array with 4 values, Float32Array with 4 values, or a Float64Array with 4 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec4.setDefaultType}.\n */\nexport type Vec4 = number[] | Float32Array | Float64Array;\n\n/**\n *\n * Vec4 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec4`. In other words you can do this\n *\n *     const v = vec4.cross(v1, v2);  // Creates a new Vec4 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec4.create();\n *     vec4.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec4.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec4 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec4\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n * @returns previous constructor for Vec4\n */\nexport function setDefaultType(ctor: new (n: number) => Vec4) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param w - Initial w value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number, w?: number): Vec4 {\n  const dst = new VecType(4);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n        if (w !== undefined) {\n          dst[3] = w;\n        }\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Vec4, create, setDefaultType, VecType } from './vec4';\nimport { Mat4 } from './mat4';\n\nexport default Vec4;\nexport { create, setDefaultType };\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param z - Initial w value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Sets the values of a Vec4\n * Also see {@link vec4.create} and {@link vec4.copy}\n *\n * @param x first value\n * @param y second value\n * @param z third value\n * @param w fourth value\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector with its elements set.\n */\nexport function set(x: number, y: number, z: number, w: number, dst?: Vec4) {\n  dst = dst || new VecType(4);\n\n  dst[0] = x;\n  dst[1] = y;\n  dst[2] = z;\n  dst[3] = w;\n\n  return dst;\n}\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n  dst[3] = Math.ceil(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n  dst[3] = Math.floor(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n  dst[3] = Math.round(v[3]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec4, min = 0, max = 1, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n  dst[3] = Math.min(max, Math.max(min, v[3]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n  dst[3] = a[3] + b[3];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec4, b: Vec4, scale: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n  dst[3] = a[3] + b[3] * scale;\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n  dst[3] = a[3] - b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec4, b: Vec4): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON &&\n         Math.abs(a[3] - b[3]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec4, b: Vec4): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec4, b: Vec4, t: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n  dst[3] = a[3] + t * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec4, b: Vec4, t: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n  dst[3] = a[3] + t[3] * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n  dst[3] = Math.max(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n  dst[3] = Math.min(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n  dst[3] = v[3] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n  dst[3] = v[3] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n  dst[3] = 1 / v[3];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the dot product of two vectors\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec4, b: Vec4): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]) + (a[3] * b[3]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz + dw * dw);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return dx * dx + dy * dy + dz * dz + dw * dw;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n    dst[3] = v3 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n  dst[3] = -v[3];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as {@link vec4.clone})\n * Also see {@link vec4.create} and {@link vec4.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n  dst[3] = v[3];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as {@link vec4.copy})\n * Also see {@link vec4.create} and {@link vec4.set}\n * @param v - The vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n  dst[3] = a[3] * b[3];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec4, b: Vec4, dst?: Vec4) {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n  dst[3] = a[3] / b[3];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not passed in a new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n  dst[3] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec4 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec4 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec4, m: Mat4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = v[3];\n\n  dst[0] = m[0] * x + m[4] * y + m[ 8] * z + m[12] * w;\n  dst[1] = m[1] * x + m[5] * y + m[ 9] * z + m[13] * w;\n  dst[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  dst[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n\n  return dst;\n}\n", "import Mat3, * as mat3 from './mat3-impl';\nimport Mat4, * as mat4 from './mat4-impl';\nimport Quat, * as quat from './quat-impl';\nimport Vec2, * as vec2 from './vec2-impl';\nimport Vec3, * as vec3 from './vec3-impl';\nimport Vec4, * as vec4 from './vec4-impl';\nimport * as utils from './utils';\n\n/**\n * Sets the type this library creates for all types\n *\n * example:\n *\n * ```\n * setDefaultType(Float64Array);\n * ```\n *\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n */\nexport function setDefaultType(ctor: new (n: number) => Float32Array | Float64Array | number[]) {\n  mat3.setDefaultType(ctor);\n  mat4.setDefaultType(ctor);\n  quat.setDefaultType(ctor);\n  vec2.setDefaultType(ctor);\n  vec3.setDefaultType(ctor);\n  vec4.setDefaultType(ctor);\n}\n\nexport {\n  Mat3,\n  mat3,\n  Mat4,\n  mat4,\n  Quat,\n  quat,\n  utils,\n  Vec2,\n  vec2,\n  Vec3,\n  vec3,\n  Vec4,\n  vec4,\n};", "/**\r\n * @description\r\n * UNIT Texures -\r\n * Good for performance\r\n */\r\nexport const UNLIT_SHADER = `struct Uniforms {\r\n  viewProjectionMatrix : mat4x4f\r\n}\r\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\r\n\r\n@group(1) @binding(0) var<uniform> modelMatrix : mat4x4f;\r\n\r\nstruct VertexInput {\r\n  @location(0) position : vec4f,\r\n  @location(1) normal : vec3f,\r\n  @location(2) uv : vec2f\r\n}\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) position : vec4f,\r\n  @location(0) normal: vec3f,\r\n  @location(1) uv : vec2f,\r\n}\r\n\r\n@vertex\r\nfn vertexMain(input: VertexInput) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  output.position = uniforms.viewProjectionMatrix * modelMatrix * input.position;\r\n  output.normal = normalize((modelMatrix * vec4(input.normal, 0)).xyz);\r\n  output.uv = input.uv;\r\n  return output;\r\n}\r\n\r\n@group(1) @binding(1) var meshSampler: sampler;\r\n@group(1) @binding(2) var meshTexture: texture_2d<f32>;\r\n\r\n// Static directional lighting\r\nconst lightDir = vec3f(0, 1, 0);\r\nconst dirColor = vec3(1);\r\nconst ambientColor = vec3f(0.05);\r\n\r\n@fragment\r\nfn fragmentMain(input: VertexOutput) -> @location(0) vec4f {\r\n  let textureColor = textureSample(meshTexture, meshSampler, input.uv);\r\n\r\n  // Very simplified lighting algorithm.\r\n  let lightColor = saturate(ambientColor + max(dot(input.normal, lightDir), 0.0) * dirColor);\r\n\r\n  return vec4f(textureColor.rgb * lightColor, textureColor.a);\r\n}`;\r\n", "\r\nexport var supportsTouch = 'ontouchstart' in window || navigator.msMaxTouchPoints;\r\n\r\nexport function isMobile() {\r\n\tif(supportsTouch == true) return true;\r\n\tconst toMatch = [/Android/i, /webOS/i, /iPhone/i, /iPad/i, /iPod/i, /BlackBerry/i, /Windows Phone/i];\r\n\treturn toMatch.some(toMatchItem => {\r\n\t\treturn navigator.userAgent.match(toMatchItem);\r\n\t});\r\n};\r\n\r\nexport const vec3 = {\r\n  cross(a, b, dst) {\r\n    dst = dst || new Float32Array(3);\r\n\r\n    const t0 = a[1] * b[2] - a[2] * b[1];\r\n    const t1 = a[2] * b[0] - a[0] * b[2];\r\n    const t2 = a[0] * b[1] - a[1] * b[0];\r\n\r\n    dst[0] = t0;\r\n    dst[1] = t1;\r\n    dst[2] = t2;\r\n\r\n    return dst;\r\n  },\r\n\r\n  subtract(a, b, dst) {\r\n    dst = dst || new Float32Array(3);\r\n\r\n    dst[0] = a[0] - b[0];\r\n    dst[1] = a[1] - b[1];\r\n    dst[2] = a[2] - b[2];\r\n\r\n    return dst;\r\n  },\r\n\r\n  normalize(v, dst) {\r\n    dst = dst || new Float32Array(3);\r\n\r\n    const length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n    // make sure we don't divide by 0.\r\n    if(length > 0.00001) {\r\n      dst[0] = v[0] / length;\r\n      dst[1] = v[1] / length;\r\n      dst[2] = v[2] / length;\r\n    } else {\r\n      dst[0] = 0;\r\n      dst[1] = 0;\r\n      dst[2] = 0;\r\n    }\r\n\r\n    return dst;\r\n  },\r\n};\r\n\r\nexport const mat4 = {\r\n  projection(width, height, depth, dst) {\r\n    // Note: This matrix flips the Y axis so that 0 is at the top.\r\n    return mat4.ortho(0, width, height, 0, depth, -depth, dst);\r\n  },\r\n\r\n  perspective(fieldOfViewYInRadians, aspect, zNear, zFar, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    const f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewYInRadians);\r\n    const rangeInv = 1 / (zNear - zFar);\r\n\r\n    dst[0] = f / aspect;\r\n    dst[1] = 0;\r\n    dst[2] = 0;\r\n    dst[3] = 0;\r\n\r\n    dst[4] = 0;\r\n    dst[5] = f;\r\n    dst[6] = 0;\r\n    dst[7] = 0;\r\n\r\n    dst[8] = 0;\r\n    dst[9] = 0;\r\n    dst[10] = zFar * rangeInv;\r\n    dst[11] = -1;\r\n\r\n    dst[12] = 0;\r\n    dst[13] = 0;\r\n    dst[14] = zNear * zFar * rangeInv;\r\n    dst[15] = 0;\r\n\r\n    return dst;\r\n  },\r\n\r\n  ortho(left, right, bottom, top, near, far, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    dst[0] = 2 / (right - left);\r\n    dst[1] = 0;\r\n    dst[2] = 0;\r\n    dst[3] = 0;\r\n\r\n    dst[4] = 0;\r\n    dst[5] = 2 / (top - bottom);\r\n    dst[6] = 0;\r\n    dst[7] = 0;\r\n\r\n    dst[8] = 0;\r\n    dst[9] = 0;\r\n    dst[10] = 1 / (near - far);\r\n    dst[11] = 0;\r\n\r\n    dst[12] = (right + left) / (left - right);\r\n    dst[13] = (top + bottom) / (bottom - top);\r\n    dst[14] = near / (near - far);\r\n    dst[15] = 1;\r\n\r\n    return dst;\r\n  },\r\n\r\n  identity(dst) {\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = 1; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = 1; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = 1; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  multiply(a, b, dst) {\r\n    dst = dst || new Float32Array(16);\r\n    const b00 = b[0 * 4 + 0];\r\n    const b01 = b[0 * 4 + 1];\r\n    const b02 = b[0 * 4 + 2];\r\n    const b03 = b[0 * 4 + 3];\r\n    const b10 = b[1 * 4 + 0];\r\n    const b11 = b[1 * 4 + 1];\r\n    const b12 = b[1 * 4 + 2];\r\n    const b13 = b[1 * 4 + 3];\r\n    const b20 = b[2 * 4 + 0];\r\n    const b21 = b[2 * 4 + 1];\r\n    const b22 = b[2 * 4 + 2];\r\n    const b23 = b[2 * 4 + 3];\r\n    const b30 = b[3 * 4 + 0];\r\n    const b31 = b[3 * 4 + 1];\r\n    const b32 = b[3 * 4 + 2];\r\n    const b33 = b[3 * 4 + 3];\r\n    const a00 = a[0 * 4 + 0];\r\n    const a01 = a[0 * 4 + 1];\r\n    const a02 = a[0 * 4 + 2];\r\n    const a03 = a[0 * 4 + 3];\r\n    const a10 = a[1 * 4 + 0];\r\n    const a11 = a[1 * 4 + 1];\r\n    const a12 = a[1 * 4 + 2];\r\n    const a13 = a[1 * 4 + 3];\r\n    const a20 = a[2 * 4 + 0];\r\n    const a21 = a[2 * 4 + 1];\r\n    const a22 = a[2 * 4 + 2];\r\n    const a23 = a[2 * 4 + 3];\r\n    const a30 = a[3 * 4 + 0];\r\n    const a31 = a[3 * 4 + 1];\r\n    const a32 = a[3 * 4 + 2];\r\n    const a33 = a[3 * 4 + 3];\r\n\r\n    dst[0] = b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30;\r\n    dst[1] = b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31;\r\n    dst[2] = b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32;\r\n    dst[3] = b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33;\r\n\r\n    dst[4] = b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30;\r\n    dst[5] = b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31;\r\n    dst[6] = b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32;\r\n    dst[7] = b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33;\r\n\r\n    dst[8] = b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30;\r\n    dst[9] = b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31;\r\n    dst[10] = b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32;\r\n    dst[11] = b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33;\r\n\r\n    dst[12] = b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30;\r\n    dst[13] = b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31;\r\n    dst[14] = b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32;\r\n    dst[15] = b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33;\r\n\r\n    return dst;\r\n  },\r\n\r\n  cameraAim(eye, target, up, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    const zAxis = vec3.normalize(vec3.subtract(eye, target));\r\n    const xAxis = vec3.normalize(vec3.cross(up, zAxis));\r\n    const yAxis = vec3.normalize(vec3.cross(zAxis, xAxis));\r\n\r\n    dst[0] = xAxis[0]; dst[1] = xAxis[1]; dst[2] = xAxis[2]; dst[3] = 0;\r\n    dst[4] = yAxis[0]; dst[5] = yAxis[1]; dst[6] = yAxis[2]; dst[7] = 0;\r\n    dst[8] = zAxis[0]; dst[9] = zAxis[1]; dst[10] = zAxis[2]; dst[11] = 0;\r\n    dst[12] = eye[0]; dst[13] = eye[1]; dst[14] = eye[2]; dst[15] = 1;\r\n\r\n    return dst;\r\n  },\r\n\r\n  inverse(m, dst) {\r\n    dst = dst || new Float32Array(16);\r\n\r\n    const m00 = m[0 * 4 + 0];\r\n    const m01 = m[0 * 4 + 1];\r\n    const m02 = m[0 * 4 + 2];\r\n    const m03 = m[0 * 4 + 3];\r\n    const m10 = m[1 * 4 + 0];\r\n    const m11 = m[1 * 4 + 1];\r\n    const m12 = m[1 * 4 + 2];\r\n    const m13 = m[1 * 4 + 3];\r\n    const m20 = m[2 * 4 + 0];\r\n    const m21 = m[2 * 4 + 1];\r\n    const m22 = m[2 * 4 + 2];\r\n    const m23 = m[2 * 4 + 3];\r\n    const m30 = m[3 * 4 + 0];\r\n    const m31 = m[3 * 4 + 1];\r\n    const m32 = m[3 * 4 + 2];\r\n    const m33 = m[3 * 4 + 3];\r\n\r\n    const tmp0 = m22 * m33;\r\n    const tmp1 = m32 * m23;\r\n    const tmp2 = m12 * m33;\r\n    const tmp3 = m32 * m13;\r\n    const tmp4 = m12 * m23;\r\n    const tmp5 = m22 * m13;\r\n    const tmp6 = m02 * m33;\r\n    const tmp7 = m32 * m03;\r\n    const tmp8 = m02 * m23;\r\n    const tmp9 = m22 * m03;\r\n    const tmp10 = m02 * m13;\r\n    const tmp11 = m12 * m03;\r\n    const tmp12 = m20 * m31;\r\n    const tmp13 = m30 * m21;\r\n    const tmp14 = m10 * m31;\r\n    const tmp15 = m30 * m11;\r\n    const tmp16 = m10 * m21;\r\n    const tmp17 = m20 * m11;\r\n    const tmp18 = m00 * m31;\r\n    const tmp19 = m30 * m01;\r\n    const tmp20 = m00 * m21;\r\n    const tmp21 = m20 * m01;\r\n    const tmp22 = m00 * m11;\r\n    const tmp23 = m10 * m01;\r\n\r\n    const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\r\n      (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\r\n    const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\r\n      (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\r\n    const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\r\n      (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\r\n    const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\r\n      (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\r\n\r\n    const d = 1 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\r\n\r\n    dst[0] = d * t0;\r\n    dst[1] = d * t1;\r\n    dst[2] = d * t2;\r\n    dst[3] = d * t3;\r\n\r\n    dst[4] = d * ((tmp1 * m10 + tmp2 * m20 + tmp5 * m30) -\r\n      (tmp0 * m10 + tmp3 * m20 + tmp4 * m30));\r\n    dst[5] = d * ((tmp0 * m00 + tmp7 * m20 + tmp8 * m30) -\r\n      (tmp1 * m00 + tmp6 * m20 + tmp9 * m30));\r\n    dst[6] = d * ((tmp3 * m00 + tmp6 * m10 + tmp11 * m30) -\r\n      (tmp2 * m00 + tmp7 * m10 + tmp10 * m30));\r\n    dst[7] = d * ((tmp4 * m00 + tmp9 * m10 + tmp10 * m20) -\r\n      (tmp5 * m00 + tmp8 * m10 + tmp11 * m20));\r\n\r\n    dst[8] = d * ((tmp12 * m13 + tmp15 * m23 + tmp16 * m33) -\r\n      (tmp13 * m13 + tmp14 * m23 + tmp17 * m33));\r\n    dst[9] = d * ((tmp13 * m03 + tmp18 * m23 + tmp21 * m33) -\r\n      (tmp12 * m03 + tmp19 * m23 + tmp20 * m33));\r\n    dst[10] = d * ((tmp14 * m03 + tmp19 * m13 + tmp22 * m33) -\r\n      (tmp15 * m03 + tmp18 * m13 + tmp23 * m33));\r\n    dst[11] = d * ((tmp17 * m03 + tmp20 * m13 + tmp23 * m23) -\r\n      (tmp16 * m03 + tmp21 * m13 + tmp22 * m23));\r\n\r\n    dst[12] = d * ((tmp14 * m22 + tmp17 * m32 + tmp13 * m12) -\r\n      (tmp16 * m32 + tmp12 * m12 + tmp15 * m22));\r\n    dst[13] = d * ((tmp20 * m32 + tmp12 * m02 + tmp19 * m22) -\r\n      (tmp18 * m22 + tmp21 * m32 + tmp13 * m02));\r\n    dst[14] = d * ((tmp18 * m12 + tmp23 * m32 + tmp15 * m02) -\r\n      (tmp22 * m32 + tmp14 * m02 + tmp19 * m12));\r\n    dst[15] = d * ((tmp22 * m22 + tmp16 * m02 + tmp21 * m12) -\r\n      (tmp20 * m12 + tmp23 * m22 + tmp17 * m02));\r\n    return dst;\r\n  },\r\n\r\n  lookAt(eye, target, up, dst) {\r\n    return mat4.inverse(mat4.cameraAim(eye, target, up, dst), dst);\r\n  },\r\n\r\n  translation([tx, ty, tz], dst) {\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = 1; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = 1; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = 1; dst[11] = 0;\r\n    dst[12] = tx; dst[13] = ty; dst[14] = tz; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  rotationX(angleInRadians, dst) {\r\n    const c = Math.cos(angleInRadians);\r\n    const s = Math.sin(angleInRadians);\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = 1; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = c; dst[6] = s; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = -s; dst[10] = c; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  rotationY(angleInRadians, dst) {\r\n    const c = Math.cos(angleInRadians);\r\n    const s = Math.sin(angleInRadians);\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = c; dst[1] = 0; dst[2] = -s; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = 1; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = s; dst[9] = 0; dst[10] = c; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  rotationZ(angleInRadians, dst) {\r\n    const c = Math.cos(angleInRadians);\r\n    const s = Math.sin(angleInRadians);\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = c; dst[1] = s; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = -s; dst[5] = c; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = 1; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  scaling([sx, sy, sz], dst) {\r\n    dst = dst || new Float32Array(16);\r\n    dst[0] = sx; dst[1] = 0; dst[2] = 0; dst[3] = 0;\r\n    dst[4] = 0; dst[5] = sy; dst[6] = 0; dst[7] = 0;\r\n    dst[8] = 0; dst[9] = 0; dst[10] = sz; dst[11] = 0;\r\n    dst[12] = 0; dst[13] = 0; dst[14] = 0; dst[15] = 1;\r\n    return dst;\r\n  },\r\n\r\n  translate(m, translation, dst) {\r\n    return mat4.multiply(m, mat4.translation(translation), dst);\r\n  },\r\n\r\n  rotateX(m, angleInRadians, dst) {\r\n    return mat4.multiply(m, mat4.rotationX(angleInRadians), dst);\r\n  },\r\n\r\n  rotateY(m, angleInRadians, dst) {\r\n    return mat4.multiply(m, mat4.rotationY(angleInRadians), dst);\r\n  },\r\n\r\n  rotateZ(m, angleInRadians, dst) {\r\n    return mat4.multiply(m, mat4.rotationZ(angleInRadians), dst);\r\n  },\r\n\r\n  scale(m, scale, dst) {\r\n    return mat4.multiply(m, mat4.scaling(scale), dst);\r\n  },\r\n};\r\n\r\nexport function degToRad(degrees) {return (degrees * Math.PI) / 180};\r\n\r\nexport function radToDeg(r) {var pi = Math.PI; return r * (180 / pi)};\r\n\r\nexport function createAppEvent(name, myDetails) {\r\n  return new CustomEvent(name, {\r\n    detail: {\r\n      eventName: name,\r\n      data: myDetails,\r\n    },\r\n    bubbles: true,\r\n  });\r\n}\r\n\r\n/**\r\n * @description\r\n * Load script in runtime.\r\n */\r\nexport var scriptManager = {\r\n  SCRIPT_ID: 0,\r\n  LOAD: function addScript(src, id, type, parent, callback) {\r\n    var s = document.createElement('script');\r\n    s.onload = function() {\r\n      // console.log('Script id loaded [src]: ' + this.src);\r\n      if(typeof callback != 'undefined') callback();\r\n    };\r\n    if(typeof type !== 'undefined') {\r\n      s.setAttribute('type', type);\r\n      s.innerHTML = src;\r\n    } else {s.setAttribute('src', src)}\r\n    if(typeof id !== 'undefined') {s.setAttribute('id', id)}\r\n    if(typeof parent !== 'undefined') {\r\n      document.getElementById(parent).appendChild(s);\r\n      if(typeof callback != 'undefined') callback();\r\n    } else {\r\n      document.body.appendChild(s);\r\n    }\r\n  },\r\n  loadModule: function addScript(src, id, type, parent) {\r\n    console.log('Script id load called ');\r\n    var s = document.createElement('script');\r\n    s.onload = function() {\r\n      scriptManager.SCRIPT_ID++;\r\n    };\r\n\r\n    if(typeof type === 'undefined') {\r\n      s.setAttribute('type', 'module');\r\n      s.setAttribute('src', src);\r\n    } else {\r\n      s.setAttribute('type', type);\r\n      s.innerHTML = src;\r\n    }\r\n\r\n    s.setAttribute('src', src);\r\n    if(typeof id !== 'undefined') {\r\n      s.setAttribute('id', id);\r\n    }\r\n\r\n    if(typeof parent !== 'undefined') {\r\n      document.getElementById(parent).appendChild(s);\r\n    } else {\r\n      document.body.appendChild(s);\r\n    }\r\n  },\r\n  loadGLSL: function(src) {\r\n    return new Promise((resolve) => {\r\n      fetch(src).then((data) => {\r\n        resolve(data.text())\r\n      })\r\n    })\r\n  }\r\n};\r\n\r\n// GET PULSE VALUES IN REAL TIME\r\nexport function OSCILLATOR(min, max, step) {\r\n  if((typeof min === 'string' || typeof min === 'number') && (typeof max === 'string' || typeof max === 'number') && (typeof step === 'string' || typeof step === 'number')) {\r\n    var ROOT = this;\r\n    this.min = parseFloat(min);\r\n    this.max = parseFloat(max);\r\n    this.step = parseFloat(step);\r\n    this.value_ = parseFloat(min);\r\n    this.status = 0;\r\n    this.on_maximum_value = function() {};\r\n    this.on_minimum_value = function() {};\r\n    this.UPDATE = function(STATUS_) {\r\n      if(STATUS_ === undefined) {\r\n        if(this.status == 0 && this.value_ < this.max) {\r\n          this.value_ = this.value_ + this.step;\r\n          if(this.value_ >= this.max) {\r\n            this.value_ = this.max;\r\n            this.status = 1;\r\n            ROOT.on_maximum_value();\r\n          }\r\n          return this.value_;\r\n        } else if(this.status == 1 && this.value_ > this.min) {\r\n          this.value_ = this.value_ - this.step;\r\n          if(this.value_ <= this.min) {\r\n            this.value_ = this.min;\r\n            this.status = 0;\r\n            ROOT.on_minimum_value();\r\n          }\r\n          return this.value_;\r\n        }\r\n      } else {\r\n        return this.value_;\r\n      }\r\n    };\r\n  } else {\r\n    console.log(\"OSCILLATOR ERROR\");\r\n  }\r\n}\r\n\r\n// this is class not func ecma5\r\nexport function SWITCHER() {\r\n  var ROOT = this;\r\n  ROOT.VALUE = 1;\r\n  ROOT.GET = function() {\r\n    ROOT.VALUE = ROOT.VALUE * -1;\r\n    return ROOT.VALUE;\r\n  };\r\n}\r\n\r\nexport function ORBIT(cx, cy, angle, p) {\r\n  var s = Math.sin(angle);\r\n  var c = Math.cos(angle);\r\n  p.x -= cx;\r\n  p.y -= cy;\r\n  var xnew = p.x * c - p.y * s;\r\n  var ynew = p.x * s + p.y * c;\r\n  p.x = xnew + cx;\r\n  p.y = ynew + cy;\r\n  return p;\r\n}\r\n\r\nexport function ORBIT_FROM_ARRAY(cx, cy, angle, p, byIndexs) {\r\n  var s = Math.sin(angle);\r\n  var c = Math.cos(angle);\r\n  p[byIndexs[0]] -= cx;\r\n  p[byIndexs[1]] -= cy;\r\n  var xnew = p[byIndexs[0]] * c - p[byIndexs[1]] * s;\r\n  var ynew = p[byIndexs[0]] * s + p[byIndexs[1]] * c;\r\n  p[byIndexs[0]] = xnew + cx;\r\n  p[byIndexs[1]] = ynew + cy;\r\n  return p;\r\n}\r\n\r\nexport var byId = function(id) {return document.getElementById(id)};\r\nexport function randomFloatFromTo(min, max) {return Math.random() * (max - min) + min;}\r\n\r\nexport function randomIntFromTo(min, max) {\r\n  if(typeof min === 'object' || typeof max === 'object') {\r\n    console.log(\r\n      \"SYS : warning Desciption : Replace object with string , this >> \" + typeof min + ' and ' + typeof min + ' << must be string or number.'\r\n    );\r\n  } else if(typeof min === 'undefined' || typeof max === 'undefined') {\r\n    console.log(\r\n      \"SYS : warning Desciption : arguments (min, max) cant be undefined , this >> \" + typeof min + ' and ' + typeof min + ' << must be string or number.'\r\n    );\r\n  } else {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n  }\r\n}\r\n\r\nexport var urlQuery = (function() {\r\n  var query_string = {};\r\n  var query = window.location.search.substring(1);\r\n  var vars = query.split('&');\r\n  for(var i = 0;i < vars.length;i++) {\r\n    var pair = vars[i].split('=');\r\n    if(typeof query_string[pair[0]] === 'undefined') {\r\n      query_string[pair[0]] = decodeURIComponent(pair[1]);\r\n    } else if(typeof query_string[pair[0]] === 'string') {\r\n      var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];\r\n      query_string[pair[0]] = arr;\r\n    } else {\r\n      query_string[pair[0]].push(decodeURIComponent(pair[1]));\r\n    }\r\n  }\r\n  return query_string;\r\n})();\r\n\r\n\r\nexport function getAxisRot(q1) {\r\n  var x, y, z;\r\n\r\n  // if w>1 acos and sqrt will produce errors, this cant happen if quaternion is normalised\r\n  if(q1.w > 1) q1.normalise();\r\n  var angle = 2 * Math.acos(q1.w);\r\n  // assuming quaternion normalised then w is less than 1, so term always positive.\r\n  var s = Math.sqrt(1 - q1.w * q1.w);\r\n  // test to avoid divide by zero, s is always positive due to sqrt\r\n  if(s < 0.001) {\r\n    // if s close to zero then direction of axis not important\r\n    // if it is important that axis is normalised then replace with x=1; y=z=0;\r\n\r\n    x = q1.x;\r\n    y = q1.y;\r\n    z = q1.z;\r\n  } else {\r\n    x = q1.x / s; // normalise axis\r\n    y = q1.y / s;\r\n    z = q1.z / s;\r\n  }\r\n  return [radToDeg(x), radToDeg(y), radToDeg(z)]\r\n}\r\n\r\nexport function getAxisRot2(targetAxis, Q) {\r\n  Q.normalize(); // if w>1 acos and sqrt will produce errors, this cant happen if quaternion is normalised\r\n  var angle = 2 * Math.acos(Q.w());\r\n  var s = Math.sqrt(1 - Q.w() * Q.w()); // assuming quaternion normalised then w is less than 1, so term always positive.\r\n  if(s < 0.001) { // test to avoid divide by zero, s is always positive due to sqrt\r\n    // if s close to zero then direction of axis not important\r\n    // if it is important that axis is normalised then replace with x=1; y=z=0;\r\n    // targetAxis.x = 1;\r\n    // targetAxis.y = 0;\r\n    // targetAxis.z = 0;\r\n    targetAxis.x = Q.x();\r\n    targetAxis.y = Q.y();\r\n    targetAxis.z = Q.z();\r\n  } else {\r\n    targetAxis.x = Q.x() / s; // normalise axis\r\n    targetAxis.y = Q.y() / s;\r\n    targetAxis.z = Q.z() / s;\r\n  }\r\n  return [targetAxis, angle];\r\n}\r\n\r\nexport function getAxisRot3(Q) {\r\n\r\n  var angle = Math.acos(Q.w) * 2;\r\n  var axis = {};\r\n\r\n  if(Math.sin(Math.acos(angle)) > 0) {\r\n\r\n    axis.x = Q.x / Math.sin(Math.acos(angle / 2));\r\n    axis.y = Q.y / Math.sin(Math.acos(angle / 2));\r\n    axis.z = Q.z / Math.sin(Math.acos(angle / 2));\r\n\r\n  } else {\r\n    axis.x = 0;\r\n    axis.y = 0;\r\n    axis.z = 0;\r\n  }\r\n\r\n  return axis;\r\n}\r\n\r\n// NTO TESTED\r\nexport function quaternion_rotation_matrix(Q) {\r\n\r\n  // Covert a quaternion into a full three-dimensional rotation matrix.\r\n\r\n  // Input\r\n  // :param Q: A 4 element array representing the quaternion (q0,q1,q2,q3) \r\n\r\n  // Output\r\n  // :return: A 3x3 element matrix representing the full 3D rotation matrix. \r\n  //          This rotation matrix converts a point in the local reference \r\n  //          frame to a point in the global reference frame.\r\n  // \"\"\"\r\n  // # Extract the values from Q\r\n  var q0 = Q[0]\r\n  var q1 = Q[1]\r\n  var q2 = Q[2]\r\n  var q3 = Q[3]\r\n\r\n  // # First row of the rotation matrix\r\n  var r00 = 2 * (q0 * q0 + q1 * q1) - 1\r\n  var r01 = 2 * (q1 * q2 - q0 * q3)\r\n  var r02 = 2 * (q1 * q3 + q0 * q2)\r\n\r\n  // # Second row of the rotation matrix\r\n  var r10 = 2 * (q1 * q2 + q0 * q3)\r\n  var r11 = 2 * (q0 * q0 + q2 * q2) - 1\r\n  var r12 = 2 * (q2 * q3 - q0 * q1)\r\n\r\n  // # Third row of the rotation matrix\r\n  var r20 = 2 * (q1 * q3 - q0 * q2)\r\n  var r21 = 2 * (q2 * q3 + q0 * q1)\r\n  var r22 = 2 * (q0 * q0 + q3 * q3) - 1\r\n\r\n  // # 3x3 rotation matrix\r\n  var rot_matrix = [[r00, r01, r02],\r\n  [r10, r11, r12],\r\n  [r20, r21, r22]]\r\n\r\n  return rot_matrix;\r\n}\r\n\r\n// copnsole log graphics\r\nexport const LOG_WARN = 'background: gray; color: yellow; font-size:10px';\r\nexport const LOG_INFO = 'background: green; color: white; font-size:11px';\r\nexport const LOG_MATRIX = \"font-family: stormfaze;color: #lime; font-size:11px;text-shadow: 2px 2px 4px orangered;background: black;\";\r\nexport const LOG_FUNNY = \"font-family: stormfaze;color: #f1f033; font-size:14px;text-shadow: 2px 2px 4px #f335f4, 4px 4px 4px #d64444, 2px 2px 4px #c160a6, 6px 2px 0px #123de3;background: black;\";\r\nexport const LOG_FUNNY_SMALL = \"font-family: stormfaze;color: #f1f033; font-size:10px;text-shadow: 2px 2px 4px #f335f4, 4px 4px 4px #d64444, 1px 1px 2px #c160a6, 3px 1px 0px #123de3;background: black;\";\r\n\r\nexport function genName(length) {\r\n  const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  let result = \"\";\r\n  for(let i = 0;i < length;i++) {\r\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return result;\r\n}\r\n\r\nexport let mb = {\r\n  root: () => byId('msgBox'),\r\n  pContent: () => byId('not-content'),\r\n  copy: function() {\r\n    navigator.clipboard.writeText(mb.root().children[0].innerText);\r\n  },\r\n  c: 0, ic: 0, t: {},\r\n  setContent: function(content, t) {\r\n    var iMsg = document.createElement('div');\r\n    iMsg.innerHTML = content;\r\n    iMsg.id = `msgbox-loc-${mb.c}`;\r\n    mb.root().appendChild(iMsg);\r\n    iMsg.classList.add('animate1')\r\n    if(t == 'ok') {\r\n      iMsg.style = 'font-family: stormfaze;color:white;padding:7px;margin:2px';\r\n    } else {\r\n      iMsg.style = 'font-family: stormfaze;color:white;padding:7px;margin:2px';\r\n    }\r\n  },\r\n  kill: function() {\r\n    mb.root().remove();\r\n  },\r\n  show: function(content, t) {\r\n    mb.setContent(content, t);\r\n    mb.root().style.display = \"block\";\r\n    var loc2 = mb.c;\r\n    setTimeout(function() {\r\n      byId(`msgbox-loc-${loc2}`).classList.remove(\"fadeInDown\");\r\n      byId(`msgbox-loc-${loc2}`).classList.add(\"fadeOut\");\r\n      setTimeout(function() {\r\n        byId(`msgbox-loc-${loc2}`).style.display = \"none\";\r\n        byId(`msgbox-loc-${loc2}`).classList.remove(\"fadeOut\");\r\n\r\n        byId(`msgbox-loc-${loc2}`).remove();\r\n        mb.ic++;\r\n        if(mb.c == mb.ic) {\r\n          mb.root().style.display = 'none';\r\n        }\r\n      }, 1000)\r\n    }, 3000);\r\n    mb.c++;\r\n  },\r\n  error: function(content) {\r\n    if(mb.root() == null) return;\r\n    mb.root().classList.remove(\"success\")\r\n    mb.root().classList.add(\"error\")\r\n    mb.root().classList.add(\"fadeInDown\");\r\n    mb.show(content, 'err');\r\n  },\r\n  success: function(content) {\r\n    if(mb.root() == null) return;\r\n    mb.root().classList.remove(\"error\")\r\n    mb.root().classList.add(\"success\")\r\n    mb.root().classList.add(\"fadeInDown\");\r\n    mb.show(content, 'ok');\r\n  }\r\n}\r\n\r\n// Registry to track running animations per element\r\nconst typingStates = new Map();\r\n\r\nexport function typeText(elementId, htmlString, delay = 50) {\r\n  const el = document.getElementById(elementId);\r\n  if(!el) return;\r\n\r\n  // If an existing typing is running for this element, cancel it\r\n  if(typingStates.has(elementId)) {\r\n    clearTimeout(typingStates.get(elementId).timeoutId);\r\n    typingStates.delete(elementId);\r\n  }\r\n\r\n  el.innerHTML = ''; // Clear previous content\r\n\r\n  const tempEl = document.createElement('div');\r\n  tempEl.innerHTML = htmlString;\r\n\r\n  const queue = [];\r\n\r\n  function flatten(node) {\r\n    if(node.nodeType === Node.TEXT_NODE) {\r\n      queue.push({type: 'text', text: node.textContent});\r\n    } else if(node.nodeType === Node.ELEMENT_NODE) {\r\n      if(node.tagName.toLowerCase() === 'img') {\r\n        queue.push({\r\n          type: 'img',\r\n          src: node.getAttribute('src'),\r\n          alt: node.getAttribute('alt') || ''\r\n        });\r\n      } else {\r\n        queue.push({\r\n          type: 'element',\r\n          tag: node.tagName.toLowerCase(),\r\n          attributes: Object.fromEntries([...node.attributes].map(attr => [attr.name, attr.value]))\r\n        });\r\n        for(const child of node.childNodes) flatten(child);\r\n        queue.push({type: 'end'});\r\n      }\r\n    }\r\n  }\r\n\r\n  for(const node of tempEl.childNodes) flatten(node);\r\n\r\n  let stack = [];\r\n  let currentElement = el;\r\n\r\n  function typeNextChar() {\r\n    if(queue.length === 0) {\r\n      typingStates.delete(elementId); // Cleanup after finish\r\n      return;\r\n    }\r\n\r\n    const item = queue[0];\r\n\r\n    if(item.type === 'text') {\r\n      if(!item.index) item.index = 0;\r\n\r\n      const ch = item.text[item.index];\r\n      if(ch === '\\n') {\r\n        currentElement.appendChild(document.createElement('br'));\r\n      } else {\r\n        currentElement.appendChild(document.createTextNode(ch));\r\n      }\r\n\r\n      item.index++;\r\n      if(item.index >= item.text.length) queue.shift();\r\n\r\n    } else if(item.type === 'element') {\r\n      const newEl = document.createElement(item.tag);\r\n      if(item.attributes) {\r\n        for(let [key, val] of Object.entries(item.attributes)) {\r\n          newEl.setAttribute(key, val);\r\n        }\r\n      }\r\n      currentElement.appendChild(newEl);\r\n      stack.push(currentElement);\r\n      currentElement = newEl;\r\n      queue.shift();\r\n\r\n    } else if(item.type === 'end') {\r\n      currentElement = stack.pop();\r\n      queue.shift();\r\n\r\n    } else if(item.type === 'img') {\r\n      const img = document.createElement('img');\r\n      img.src = item.src;\r\n      img.alt = item.alt;\r\n      img.style.maxWidth = '100px';\r\n      img.style.verticalAlign = 'middle';\r\n      currentElement.appendChild(img);\r\n      queue.shift();\r\n    }\r\n\r\n    // Schedule next step and store timeoutId for control\r\n    const timeoutId = setTimeout(typeNextChar, delay);\r\n    typingStates.set(elementId, {timeoutId});\r\n  }\r\n\r\n  typeNextChar();\r\n}\r\n\r\n\r\nexport function setupCanvasFilters(canvasId) {\r\n  let canvas = document.getElementById(canvasId);\r\n  if(canvas == null) {\r\n    canvas = document.getElementsByTagName('canvas')[0];\r\n  }\r\n\r\n  const filterState = {\r\n    blur: \"0px\",\r\n    grayscale: \"0%\",\r\n    brightness: \"100%\",\r\n    contrast: \"100%\",\r\n    saturate: \"100%\",\r\n    sepia: \"0%\",\r\n    invert: \"0%\",\r\n    hueRotate: \"0deg\"\r\n  };\r\n\r\n  function updateFilter() {\r\n    const filterString = `\r\n      blur(${filterState.blur}) \r\n      grayscale(${filterState.grayscale}) \r\n      brightness(${filterState.brightness}) \r\n      contrast(${filterState.contrast}) \r\n      saturate(${filterState.saturate}) \r\n      sepia(${filterState.sepia}) \r\n      invert(${filterState.invert}) \r\n      hue-rotate(${filterState.hueRotate})\r\n    `.trim();\r\n\r\n    canvas.style.filter = filterString;\r\n  }\r\n\r\n  const bindings = {\r\n    blurControl: \"blur\",\r\n    grayscaleControl: \"grayscale\",\r\n    brightnessControl: \"brightness\",\r\n    contrastControl: \"contrast\",\r\n    saturateControl: \"saturate\",\r\n    sepiaControl: \"sepia\",\r\n    invertControl: \"invert\",\r\n    hueControl: \"hueRotate\"\r\n  };\r\n\r\n  Object.entries(bindings).forEach(([selectId, key]) => {\r\n    const el = document.getElementById(selectId);\r\n    el.addEventListener(\"change\", (e) => {\r\n      filterState[key] = e.target.value;\r\n      updateFilter();\r\n    });\r\n  });\r\n\r\n  updateFilter(); // Initial\r\n}\r\n\r\n/**\r\n * @description\r\n * // Save an object\r\n    Storage.set('playerData', { name: 'Slayzer', hp: 120, mana: 80 });\r\n\r\n    // Load it back\r\n    const player = Storage.get('playerData');\r\n    console.log(player.name); // \"Slayzer\"\r\n\r\n    // Check if exists\r\n    if (Storage.has('playerData')) console.log('Found!');\r\n\r\n    // Remove one\r\n    Storage.remove('playerData');\r\n\r\n    // Clear all localStorage\r\n    Storage.clear();\r\n */\r\nexport const LS = {\r\n  set(key, value) {\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  },\r\n\r\n  get(key, defaultValue = null) {\r\n    const item = localStorage.getItem(key);\r\n    try {\r\n      return item ? JSON.parse(item) : defaultValue;\r\n    } catch(e) {\r\n      console.warn(`Error parsing localStorage key \"${key}\"`, e);\r\n      return defaultValue;\r\n    }\r\n  },\r\n\r\n  has(key) {\r\n    return localStorage.getItem(key) !== null;\r\n  },\r\n\r\n  remove(key) {\r\n    localStorage.removeItem(key);\r\n  },\r\n\r\n  clear() {\r\n    localStorage.clear();\r\n  }\r\n};\r\n\r\nexport const SS = {\r\n  set(key, value) {\r\n    sessionStorage.setItem(key, JSON.stringify(value));\r\n  },\r\n\r\n  get(key, defaultValue = null) {\r\n    const item = sessionStorage.getItem(key);\r\n    try {\r\n      return item ? JSON.parse(item) : defaultValue;\r\n    } catch(e) {\r\n      console.warn(`Error parsing sessionStorage key \"${key}\"`, e);\r\n      return defaultValue;\r\n    }\r\n  },\r\n\r\n  has(key) {\r\n    return sessionStorage.getItem(key) !== null;\r\n  },\r\n\r\n  remove(key) {\r\n    sessionStorage.removeItem(key);\r\n  },\r\n\r\n  clear() {\r\n    sessionStorage.clear();\r\n  }\r\n};\r\nexport const jsonHeaders = new Headers({\r\n\t\"Content-Type\": \"application/json\",\r\n\t\"Accept\": \"application/json\",\r\n});\r\n\r\nexport const htmlHeader = new Headers({\r\n\t\"Content-Type\": \"text/html\",\r\n\t\"Accept\": \"text/plain\",\r\n});\r\n\r\nexport function isEven(n) {\r\n  return n % 2 === 0;\r\n}\r\n\r\nexport function isOdd(n) {\r\n  return n % 2 !== 0;\r\n}\r\n\r\nexport class FullscreenManagerElement {\r\n  constructor(targetElement = document.documentElement) {\r\n    this.target = targetElement;\r\n  }\r\n\r\n  isFullscreen() {\r\n    return !!(\r\n      document.fullscreenElement ||\r\n      document.webkitFullscreenElement ||\r\n      document.mozFullScreenElement ||\r\n      document.msFullscreenElement\r\n    );\r\n  }\r\n\r\n  request() {\r\n    const el = this.target;\r\n    return (\r\n      el.requestFullscreen?.() ||\r\n      el.webkitRequestFullscreen?.() ||\r\n      el.mozRequestFullScreen?.() ||\r\n      el.msRequestFullscreen?.()\r\n    );\r\n  }\r\n\r\n  exit() {\r\n    return (\r\n      document.exitFullscreen?.() ||\r\n      document.webkitExitFullscreen?.() ||\r\n      document.mozCancelFullScreen?.() ||\r\n      document.msExitFullscreen?.()\r\n    );\r\n  }\r\n\r\n  toggle() {\r\n    if (this.isFullscreen()) return this.exit();\r\n    return this.request();\r\n  }\r\n\r\n  onChange(callback) {\r\n    [\r\n      \"fullscreenchange\",\r\n      \"webkitfullscreenchange\",\r\n      \"mozfullscreenchange\",\r\n      \"MSFullscreenChange\"\r\n    ].forEach(evt => \r\n      document.addEventListener(evt, () => {\r\n        callback(this.isFullscreen(), this.target);\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nexport class FullscreenManager {\r\n  constructor() {\r\n    this.target = document.documentElement; // fullscreen whole page / window\r\n  }\r\n\r\n  isFullscreen() {\r\n    return !!(\r\n      document.fullscreenElement ||\r\n      document.webkitFullscreenElement ||\r\n      document.mozFullScreenElement ||\r\n      document.msFullscreenElement\r\n    );\r\n  }\r\n\r\n  request() {\r\n    const el = this.target;\r\n    return (\r\n      el.requestFullscreen?.() ||\r\n      el.webkitRequestFullscreen?.() ||\r\n      el.mozRequestFullScreen?.() ||\r\n      el.msRequestFullscreen?.()\r\n    );\r\n  }\r\n\r\n  exit() {\r\n    return (\r\n      document.exitFullscreen?.() ||\r\n      document.webkitExitFullscreen?.() ||\r\n      document.mozCancelFullScreen?.() ||\r\n      document.msExitFullscreen?.()\r\n    );\r\n  }\r\n\r\n  toggle() {\r\n    return this.isFullscreen() ? this.exit() : this.request();\r\n  }\r\n\r\n  onChange(callback) {\r\n    [\r\n      \"fullscreenchange\",\r\n      \"webkitfullscreenchange\",\r\n      \"mozfullscreenchange\",\r\n      \"MSFullscreenChange\"\r\n    ].forEach(evt =>\r\n      document.addEventListener(evt, () => {\r\n        callback(this.isFullscreen());\r\n      })\r\n    );\r\n  }\r\n}", "import {degToRad, radToDeg} from \"./utils\";\r\n\r\n/**\r\n * @description \r\n * Sub classes for matrix-wgpu\r\n * Base class\r\n * Position { x, y, z }\r\n */\r\n\r\nexport class Position {\r\n  constructor(x, y, z) {\r\n    // console.log('TEST TYTPOF ', x)\r\n    this.remoteName = null;\r\n    this.netObject = null;\r\n    this.toRemote = [];\r\n    this.teams = [];\r\n\r\n    this.netTolerance = 3;\r\n    this.netTolerance__ = 0;\r\n\r\n    if(typeof x == 'undefined') x = 0;\r\n    if(typeof y == 'undefined') y = 0;\r\n    if(typeof z == 'undefined') z = 0;\r\n\r\n    this.x = parseFloat(x);\r\n    this.y = parseFloat(y);\r\n    this.z = parseFloat(z);\r\n\r\n    this.velY = 0;\r\n    this.velX = 0;\r\n    this.velZ = 0;\r\n    this.inMove = false;\r\n    this.targetX = parseFloat(x);\r\n    this.targetY = parseFloat(y);\r\n    this.targetZ = parseFloat(z);\r\n    this.thrust = 0.01;\r\n\r\n    return this;\r\n  }\r\n\r\n  setSpeed(n) {\r\n    if(typeof n === 'number') {\r\n      this.thrust = n;\r\n    } else {\r\n      console.log('Description: arguments (w, h) must be type of number.');\r\n    }\r\n  }\r\n\r\n  translateByX(x) {\r\n    this.inMove = true;\r\n    this.targetX = parseFloat(x);\r\n  };\r\n\r\n  translateByY(y) {\r\n    this.inMove = true;\r\n    this.targetY = parseFloat(y);\r\n  }\r\n\r\n  translateByZ(z) {\r\n    this.inMove = true;\r\n    this.targetZ = parseFloat(z);\r\n  }\r\n\r\n  translateByXY(x, y) {\r\n    this.inMove = true;\r\n    this.targetX = parseFloat(x);\r\n    this.targetY = parseFloat(y);\r\n  }\r\n\r\n  translateByXZ(x, z) {\r\n    this.inMove = true;\r\n    this.targetX = parseFloat(x);\r\n    this.targetZ = parseFloat(z);\r\n  }\r\n\r\n  translateByYZ(y, z) {\r\n    this.inMove = true;\r\n    this.targetY = parseFloat(y);\r\n    this.targetZ = parseFloat(z);\r\n  }\r\n\r\n  onTargetPositionReach() {}\r\n\r\n  update() {\r\n    var tx = parseFloat(this.targetX) - parseFloat(this.x),\r\n      ty = parseFloat(this.targetY) - parseFloat(this.y),\r\n      tz = parseFloat(this.targetZ) - parseFloat(this.z),\r\n      dist = Math.sqrt(tx * tx + ty * ty + tz * tz);\r\n    this.velX = (tx / dist) * this.thrust;\r\n    this.velY = (ty / dist) * this.thrust;\r\n    this.velZ = (tz / dist) * this.thrust;\r\n    if(this.inMove == true) {\r\n      if(dist > this.thrust) {\r\n        this.x += this.velX;\r\n        this.y += this.velY;\r\n        this.z += this.velZ;\r\n        if(this.netObject != null) {\r\n          if(this.netTolerance__ > this.netTolerance) {\r\n\r\n            if(this.teams.length == 0) {\r\n              app.net.send({\r\n                toRemote: this.toRemote, // default null\r\n                remoteName: this.remoteName, // default null\r\n                sceneName: this.netObject,\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            } else {\r\n              // logic is only for two team - index 0 is local !!!\r\n              if(this.teams.length > 0) if(this.teams[0].length > 0) app.net.send({\r\n                toRemote: this.teams[0], // default null remote conns\r\n                sceneName: this.netObject, // origin scene name to receive\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n              // remove if (this.teams[1].length > 0)  after alll this is only for CASE OF SUM PLAYER 3 FOR TEST ONLY\r\n              if(this.teams.length > 0) if(this.teams[1].length > 0) app.net.send({\r\n                toRemote: this.teams[1], // default null remote conns\r\n                remoteName: this.remoteName, // to enemy players\r\n                sceneName: this.netObject, // now not important\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            }\r\n            this.netTolerance__ = 0;\r\n          } else {\r\n            this.netTolerance__++;\r\n          }\r\n        }\r\n      } else {\r\n        this.x = this.targetX;\r\n        this.y = this.targetY;\r\n        this.z = this.targetZ;\r\n        this.inMove = false;\r\n        this.onTargetPositionReach();\r\n        if(this.netObject != null) {\r\n          if(this.netTolerance__ > this.netTolerance) {\r\n\r\n            // \r\n            if(this.teams.length == 0) {\r\n              app.net.send({\r\n                toRemote: this.toRemote, // default null\r\n                remoteName: this.remoteName, // default null\r\n                sceneName: this.netObject,\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            } else {\r\n              // logic is only for two team - index 0 is local !\r\n              if(this.teams[0].length > 0) app.net.send({\r\n                toRemote: this.teams[0],\r\n                sceneName: this.netObject,\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n              if(this.teams[1].length > 0) app.net.send({\r\n                // team: this.teams[1],\r\n                toRemote: this.teams[1], // default null remote conns\r\n                remoteName: this.remoteName, // to enemy players\r\n                sceneName: this.netObject, // now not important\r\n                netPos: {x: this.x, y: this.y, z: this.z},\r\n              });\r\n            }\r\n\r\n            this.netTolerance__ = 0;\r\n          } else {\r\n            this.netTolerance__++;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  get worldLocation() {\r\n    return [parseFloat(this.x), parseFloat(this.y), parseFloat(this.z)];\r\n  }\r\n\r\n  SetX(newx, em) {\r\n    this.x = newx;\r\n    this.targetX = newx;\r\n    this.inMove = false;\r\n  }\r\n\r\n  SetY(newy, em) {\r\n    this.y = newy;\r\n    this.targetY = newy;\r\n    this.inMove = false;\r\n  }\r\n\r\n  SetZ(newz, em) {\r\n    this.z = newz;\r\n    this.targetZ = newz;\r\n    this.inMove = false;\r\n  }\r\n\r\n  get X() {\r\n    return parseFloat(this.x)\r\n  }\r\n\r\n  get Y() {\r\n    return parseFloat(this.y)\r\n  }\r\n\r\n  get Z() {\r\n    return parseFloat(this.z)\r\n  }\r\n\r\n  setPosition(newx, newy, newz) {\r\n    this.x = newx;\r\n    this.y = newy;\r\n    this.z = newz;\r\n    this.targetX = newx;\r\n    this.targetY = newy;\r\n    this.targetZ = newz;\r\n    this.inMove = false;\r\n  }\r\n}\r\n\r\nexport class Rotation {\r\n  constructor(x, y, z) {\r\n    this.toRemote = [];\r\n    this.teams = [];\r\n    this.remoteName = null;\r\n    this.emitX = null;\r\n    this.emitY = null;\r\n    this.emitZ = null;\r\n    if(typeof x == 'undefined') x = 0;\r\n    if(typeof y == 'undefined') y = 0;\r\n    if(typeof z == 'undefined') z = 0;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n    this.netx = x;\r\n    this.nety = y;\r\n    this.netz = z;\r\n    this.rotationSpeed = {x: 0, y: 0, z: 0};\r\n    this.angle = 0;\r\n    this.axis = {x: 0, y: 0, z: 0};\r\n    // not in use good for exstend logic\r\n    this.matrixRotation = null;\r\n  }\r\n\r\n  toDegree() {\r\n\r\n    /*\r\n    heading = atan2(y * sin(angle)- x * z * (1 - cos(angle)) , 1 - (y2 + z2 ) * (1 - cos(angle)))\r\n    attitude = asin(x * y * (1 - cos(angle)) + z * sin(angle))\r\n    bank = atan2(x * sin(angle)-y * z * (1 - cos(angle)) , 1 - (x2 + z2) * (1 - cos(angle)))\r\n    */\r\n    return [radToDeg(this.axis.x), radToDeg(this.axis.y), radToDeg(this.axis.z)];\r\n  }\r\n\r\n  toDegreeX() {\r\n    return Math.cos(radToDeg(this.axis.x) / 2)\r\n  }\r\n\r\n  toDegreeY() {\r\n    return Math.cos(radToDeg(this.axis.z) / 2)\r\n  }\r\n\r\n  toDegreeZ() {\r\n    return Math.cos(radToDeg(this.axis.y) / 2)\r\n  }\r\n\r\n  getRotX() {\r\n    if(this.rotationSpeed.x == 0) {\r\n      if(this.netx != this.x && this.emitX) {\r\n        app.net.send({\r\n          remoteName: this.remoteName,\r\n          sceneName: this.emitX,\r\n          netRotX: this.x\r\n        })\r\n      }\r\n      this.netx = this.x;\r\n      return degToRad(this.x);\r\n    } else {\r\n      this.x = this.x + this.rotationSpeed.x * 0.001;\r\n      return degToRad(this.x);\r\n    }\r\n  }\r\n\r\n  getRotY() {\r\n    if(this.rotationSpeed.y == 0) {\r\n      if(this.nety != this.y && this.emitY) {\r\n        // ---------------------------------------\r\n        if(this.teams.length == 0) {\r\n          app.net.send({\r\n            toRemote: this.toRemote,\r\n            remoteName: this.remoteName,\r\n            sceneName: this.emitY,\r\n            netRotY: this.y\r\n          });\r\n          this.nety = this.y;\r\n        } else {\r\n          if(this.teams[0].length > 0) app.net.send({\r\n            toRemote: this.teams[0],\r\n            sceneName: this.emitY,\r\n            netRotY: this.y\r\n          });\r\n          if(this.teams[1].length > 0) app.net.send({\r\n            toRemote: this.teams[1],\r\n            remoteName: this.remoteName,\r\n            sceneName: this.emitY,\r\n            netRotY: this.y\r\n          });\r\n          this.nety = this.y;\r\n        }\r\n        //-------------------------------------------\r\n      }\r\n\r\n      return degToRad(this.y);\r\n    } else {\r\n      this.y = this.y + this.rotationSpeed.y * 0.001;\r\n      return degToRad(this.y);\r\n    }\r\n  }\r\n\r\n  getRotZ() {\r\n    if(this.rotationSpeed.z == 0) {\r\n      if(this.netz != this.z && this.emitZ) {\r\n        app.net.send({\r\n          remoteName: this.remoteName,\r\n          sceneName: this.emitZ,\r\n          netRotZ: this.z\r\n        })\r\n      }\r\n      this.netz = this.z;\r\n      return degToRad(this.z);\r\n    } else {\r\n      this.z = this.z + this.rotationSpeed.z * 0.001;\r\n      return degToRad(this.z);\r\n    }\r\n  }\r\n\r\n}\r\n", "// Note: The code in this file does not use the 'dst' output parameter of functions in the\r\n// 'wgpu-matrix' library, so produces many temporary vectors and matrices.\r\n// This is intentional, as this sample prefers readability over performance.\r\nimport {mat4, vec3} from 'wgpu-matrix';\r\nimport {LOG_INFO} from './utils';\r\n\r\n// The common functionality between camera implementations\r\nclass CameraBase {\r\n  // The camera matrix\r\n  matrix_ = new Float32Array([\r\n    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1,\r\n  ]);\r\n\r\n  // The calculated view matrix readonly\r\n  view_ = mat4.create();\r\n\r\n  // Aliases to column vectors of the matrix\r\n  right_ = new Float32Array(this.matrix_.buffer, 4 * 0, 4);\r\n  up_ = new Float32Array(this.matrix_.buffer, 4 * 4, 4);\r\n  back_ = new Float32Array(this.matrix_.buffer, 4 * 8, 4);\r\n  position_ = new Float32Array(this.matrix_.buffer, 4 * 12, 4);\r\n\r\n  // Returns the camera matrix\r\n  get matrix() {\r\n    return this.matrix_;\r\n  }\r\n  // Assigns `mat` to the camera matrix\r\n  set matrix(mat) {\r\n    mat4.copy(mat, this.matrix_);\r\n  }\r\n\r\n  // setProjection(fov = (2*Math.PI) / 5 , aspect = 1, near = 0.5, far = 1000) {\r\n  //   this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  // }\r\n\r\n  // Returns the camera view matrix\r\n  get view() {\r\n    return this.view_;\r\n  }\r\n  // Assigns `mat` to the camera view\r\n  set view(mat) {\r\n    mat4.copy(mat, this.view_);\r\n  }\r\n\r\n  // Returns column vector 0 of the camera matrix\r\n  get right() {\r\n    return this.right_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 0 of the camera matrix\r\n  set right(vec) {\r\n    vec3.copy(vec, this.right_);\r\n  }\r\n\r\n  // Returns column vector 1 of the camera matrix\r\n  get up() {\r\n    return this.up_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 1 of the camera matrix \\ Vec3\r\n  set up(vec) {\r\n    vec3.copy(vec, this.up_);\r\n  }\r\n\r\n  // Returns column vector 2 of the camera matrix\r\n  get back() {\r\n    return this.back_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 2 of the camera matrix\r\n  set back(vec) {\r\n    vec3.copy(vec, this.back_);\r\n  }\r\n\r\n  // Returns column vector 3 of the camera matrix\r\n  get position() {\r\n    return this.position_;\r\n  }\r\n\r\n  // Assigns `vec` to the first 3 elements of column vector 3 of the camera matrix\r\n  set position(vec) {\r\n    vec3.copy(vec, this.position_);\r\n  }\r\n}\r\n\r\n// WASDCamera is a camera implementation that behaves similar to first-person-shooter PC games.\r\nexport class WASDCamera extends CameraBase {\r\n  // The camera absolute pitch angle\r\n  pitch = 0;\r\n  // The camera absolute yaw angle\r\n  yaw = 0;\r\n\r\n  // The movement veloicty readonly\r\n  velocity_ = vec3.create();\r\n\r\n  // Speed multiplier for camera movement\r\n  movementSpeed = 10;\r\n\r\n  // Speed multiplier for camera rotation\r\n  rotationSpeed = 1;\r\n\r\n  // Movement velocity drag coeffient [0 .. 1]\r\n  // 0: Continues forever\r\n  // 1: Instantly stops moving\r\n  frictionCoefficient = 0.99;\r\n\r\n  // Returns velocity vector\r\n  get velocity() {\r\n    return this.velocity_;\r\n  }\r\n  // Assigns `vec` to the velocity vector\r\n  set velocity(vec) {\r\n    vec3.copy(vec, this.velocity_);\r\n  }\r\n\r\n  setProjection(fov = (2 * Math.PI) / 5, aspect = 1, near = 1, far = 1000) {\r\n    this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  }\r\n\r\n  constructor(options) {\r\n    super();\r\n    if(options && (options.position || options.target)) {\r\n      const position = options.position ?? vec3.create(0, 0, 0);\r\n      const target = options.target ?? vec3.create(0, 0, 0);\r\n      const forward = vec3.normalize(vec3.sub(target, position));\r\n      this.recalculateAngles(forward);\r\n      this.position = position;\r\n      this.canvas = options.canvas;\r\n      this.aspect = options.canvas.width / options.canvas.height;\r\n      this.setProjection((2 * Math.PI) / 5, this.aspect, 1, 2000);\r\n      // console.log(`%cCamera constructor : ${position}`, LOG_INFO);\r\n    }\r\n  }\r\n\r\n  // Returns the camera matrix\r\n  get matrix() {\r\n    return super.matrix;\r\n  }\r\n\r\n  // Assigns `mat` to the camera matrix, and recalcuates the camera angles\r\n  set matrix(mat) {\r\n    super.matrix = mat;\r\n    this.recalculateAngles(this.back);\r\n  }\r\n\r\n  update(deltaTime, input) {\r\n    const sign = (positive, negative) =>\r\n      (positive ? 1 : 0) - (negative ? 1 : 0);\r\n\r\n    // Apply the delta rotation to the pitch and yaw angles\r\n    this.yaw -= input.analog.x * deltaTime * this.rotationSpeed;\r\n    this.pitch -= input.analog.y * deltaTime * this.rotationSpeed;\r\n\r\n    // Wrap yaw between [0\u00B0 .. 360\u00B0], just to prevent large accumulation.\r\n    this.yaw = mod(this.yaw, Math.PI * 2);\r\n    // Clamp pitch between [-90\u00B0 .. +90\u00B0] to prevent somersaults.\r\n    this.pitch = clamp(this.pitch, -Math.PI / 2, Math.PI / 2);\r\n\r\n    // Save the current position, as we're about to rebuild the camera matrix.\r\n    const position = vec3.copy(this.position);\r\n\r\n    // Reconstruct the camera's rotation, and store into the camera matrix.\r\n    super.matrix = mat4.rotateX(mat4.rotationY(this.yaw), this.pitch);\r\n    // super.matrix = mat4.rotateX(mat4.rotationY(this.yaw), -this.pitch);\r\n    // super.matrix = mat4.rotateY(mat4.rotateX(this.pitch), this.yaw);\r\n\r\n    // Calculate the new target velocity\r\n    const digital = input.digital;\r\n    const deltaRight = sign(digital.right, digital.left);\r\n    const deltaUp = sign(digital.up, digital.down);\r\n    const targetVelocity = vec3.create();\r\n    const deltaBack = sign(digital.backward, digital.forward);\r\n    vec3.addScaled(targetVelocity, this.right, deltaRight, targetVelocity);\r\n    vec3.addScaled(targetVelocity, this.up, deltaUp, targetVelocity);\r\n    vec3.addScaled(targetVelocity, this.back, deltaBack, targetVelocity);\r\n    vec3.normalize(targetVelocity, targetVelocity);\r\n    vec3.mulScalar(targetVelocity, this.movementSpeed, targetVelocity);\r\n\r\n    // Mix new target velocity\r\n    this.velocity = lerp(\r\n      targetVelocity,\r\n      this.velocity,\r\n      Math.pow(1 - this.frictionCoefficient, deltaTime)\r\n    );\r\n\r\n    // Integrate velocity to calculate new position\r\n    this.position = vec3.addScaled(position, this.velocity, deltaTime);\r\n\r\n    // Invert the camera matrix to build the view matrix\r\n    this.view = mat4.invert(this.matrix);\r\n    return this.view;\r\n  }\r\n\r\n  // Recalculates the yaw and pitch values from a directional vector\r\n  recalculateAngles(dir) {\r\n    this.yaw = Math.atan2(dir[0], dir[2]);\r\n    this.pitch = -Math.asin(dir[1]);\r\n  }\r\n}\r\n\r\n// ArcballCamera implements a basic orbiting camera around the world origin\r\nexport class ArcballCamera extends CameraBase {\r\n  // The camera distance from the target\r\n  distance = 0;\r\n\r\n  // The current angular velocity\r\n  angularVelocity = 0;\r\n\r\n  // The current rotation axis\r\n  axis_ = vec3.create();\r\n\r\n  // Returns the rotation axis\r\n  get axis() {\r\n    return this.axis_;\r\n  }\r\n  // Assigns `vec` to the rotation axis\r\n  set axis(vec) {\r\n    vec3.copy(vec, this.axis_);\r\n  }\r\n\r\n  // Speed multiplier for camera rotation\r\n  rotationSpeed = 1;\r\n\r\n  // Speed multiplier for camera zoom\r\n  zoomSpeed = 0.1;\r\n\r\n  // Rotation velocity drag coeffient [0 .. 1]\r\n  // 0: Spins forever\r\n  // 1: Instantly stops spinning\r\n  frictionCoefficient = 0.999;\r\n\r\n  setProjection(fov = (2 * Math.PI) / 5, aspect = 1, near = 1, far = 1000) {\r\n    this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  }\r\n  // Construtor\r\n  constructor(options) {\r\n    super();\r\n    if(options && options.position) {\r\n      this.position = options.position;\r\n      this.distance = vec3.len(this.position);\r\n      this.back = vec3.normalize(this.position);\r\n\r\n      this.setProjection((2 * Math.PI) / 5, this.aspect, 1, 2000);\r\n\r\n      this.recalcuateRight();\r\n      this.recalcuateUp();\r\n    }\r\n  }\r\n\r\n  // Returns the camera matrix\r\n  get matrix() {\r\n    return super.matrix;\r\n  }\r\n\r\n  // Assigns `mat` to the camera matrix, and recalcuates the distance\r\n  set matrix(mat) {\r\n    super.matrix = mat;\r\n    this.distance = vec3.len(this.position);\r\n  }\r\n\r\n  update(deltaTime, input) {\r\n    const epsilon = 0.0000001;\r\n\r\n    if(input.analog.touching) {\r\n      // Currently being dragged.\r\n      this.angularVelocity = 0;\r\n    } else {\r\n      // Dampen any existing angular velocity\r\n      this.angularVelocity *= Math.pow(1 - this.frictionCoefficient, deltaTime);\r\n    }\r\n\r\n    // Calculate the movement vector\r\n    const movement = vec3.create();\r\n    vec3.addScaled(movement, this.right, input.analog.x, movement);\r\n    vec3.addScaled(movement, this.up, -input.analog.y, movement);\r\n\r\n    // Cross the movement vector with the view direction to calculate the rotation axis x magnitude\r\n    const crossProduct = vec3.cross(movement, this.back);\r\n\r\n    // Calculate the magnitude of the drag\r\n    const magnitude = vec3.len(crossProduct);\r\n\r\n    if(magnitude > epsilon) {\r\n      // Normalize the crossProduct to get the rotation axis\r\n      this.axis = vec3.scale(crossProduct, 1 / magnitude);\r\n\r\n      // Remember the current angular velocity. This is used when the touch is released for a fling.\r\n      this.angularVelocity = magnitude * this.rotationSpeed;\r\n    }\r\n\r\n    // The rotation around this.axis to apply to the camera matrix this update\r\n    const rotationAngle = this.angularVelocity * deltaTime;\r\n    if(rotationAngle > epsilon) {\r\n      // Rotate the matrix around axis\r\n      // Note: The rotation is not done as a matrix-matrix multiply as the repeated multiplications\r\n      // will quickly introduce substantial error into the matrix.\r\n      this.back = vec3.normalize(rotate(this.back, this.axis, rotationAngle));\r\n      this.recalcuateRight();\r\n      this.recalcuateUp();\r\n    }\r\n\r\n    // recalculate `this.position` from `this.back` considering zoom\r\n    if(input.analog.zoom !== 0) {\r\n      this.distance *= 1 + input.analog.zoom * this.zoomSpeed;\r\n    }\r\n    this.position = vec3.scale(this.back, this.distance);\r\n\r\n    // Invert the camera matrix to build the view matrix\r\n    this.view = mat4.invert(this.matrix);\r\n    return this.view;\r\n  }\r\n\r\n  // Assigns `this.right` with the cross product of `this.up` and `this.back`\r\n  recalcuateRight() {\r\n    this.right = vec3.normalize(vec3.cross(this.up, this.back));\r\n  }\r\n\r\n  // Assigns `this.up` with the cross product of `this.back` and `this.right`\r\n  recalcuateUp() {\r\n    this.up = vec3.normalize(vec3.cross(this.back, this.right));\r\n  }\r\n}\r\n\r\n// Returns `x` clamped between [`min` .. `max`]\r\nfunction clamp(x, min, max) {\r\n  return Math.min(Math.max(x, min), max);\r\n}\r\n\r\n// Returns `x` float-modulo `div`\r\nfunction mod(x, div) {\r\n  return x - Math.floor(Math.abs(x) / div) * div * Math.sign(x);\r\n}\r\n\r\n// Returns `vec` rotated `angle` radians around `axis`\r\nfunction rotate(vec, axis, angle) {\r\n  return vec3.transformMat4Upper3x3(vec, mat4.rotation(axis, angle));\r\n}\r\n\r\n// Returns the linear interpolation between 'a' and 'b' using 's'\r\nfunction lerp(a, b, s) {\r\n  return vec3.addScaled(a, vec3.sub(b, a), s);\r\n}\r\n\r\nexport function createInputHandler(window, canvas) {\r\n  let digital = {\r\n    forward: false,\r\n    backward: false,\r\n    left: false,\r\n    right: false,\r\n    up: false,\r\n    down: false,\r\n  };\r\n  let analog = {\r\n    x: 0,\r\n    y: 0,\r\n    zoom: 0,\r\n  };\r\n  let mouseDown = false;\r\n\r\n  const setDigital = (e, value) => {\r\n    switch(e.code) {\r\n      case 'KeyW': digital.forward = value; break;\r\n      case 'KeyS': digital.backward = value; break;\r\n      case 'KeyA': digital.left = value; break;\r\n      case 'KeyD': digital.right = value; break;\r\n      case 'Space': digital.up = value; break;\r\n      case 'ShiftLeft':\r\n      case 'ControlLeft':\r\n      case 'KeyC': digital.down = value; break;\r\n    }\r\n    // if you wanna dosavle all keyboard input for some reason...\r\n    // add later like new option feature...\r\n    // e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  window.addEventListener('keydown', (e) => setDigital(e, true));\r\n  window.addEventListener('keyup', (e) => setDigital(e, false));\r\n\r\n  canvas.style.touchAction = 'pinch-zoom';\r\n  canvas.addEventListener('pointerdown', () => {mouseDown = true;});\r\n  canvas.addEventListener('pointerup', () => {mouseDown = false;});\r\n  canvas.addEventListener('pointermove', (e) => {\r\n    mouseDown = e.pointerType === 'mouse' ? (e.buttons & 1) !== 0 : true;\r\n    if(mouseDown) {\r\n      analog.x += e.movementX / 10;\r\n      analog.y += e.movementY / 10;\r\n    }\r\n  });\r\n\r\n  canvas.addEventListener('wheel', (e) => {\r\n    // if((e.buttons & 1) !== 0) {\r\n    //   analog.zoom += Math.sign(e.deltaY);\r\n    //   e.preventDefault();\r\n    //   e.stopPropagation();\r\n    // }\r\n  }, {passive: false});\r\n\r\n  return () => {\r\n    // Guard: prevent zero deltas from breaking camera math\r\n    const safeX = analog.x || 0.0001;\r\n    const safeY = analog.y || 0.0001;\r\n    const out = {\r\n      digital,\r\n      analog: {\r\n        x: safeX,\r\n        y: safeY,\r\n        zoom: analog.zoom,\r\n        touching: mouseDown,\r\n      },\r\n    };\r\n    // Reset only the deltas for next frame\r\n    analog.x = 0;\r\n    analog.y = 0;\r\n    analog.zoom = 0;\r\n    return out;\r\n  };\r\n}\r\n\r\nexport class RPGCamera extends CameraBase {\r\n  followMe = null;\r\n  pitch = 0;\r\n  yaw = 0;\r\n  velocity_ = vec3.create();\r\n  movementSpeed = 10;\r\n  rotationSpeed = 1;\r\n  followMeOffset = 150; // << mobile adaptation needed after all...\r\n  // Movement velocity drag coeffient [0 .. 1]\r\n  // 0: Continues forever\r\n  // 1: Instantly stops moving\r\n  frictionCoefficient = 0.99;\r\n  // Returns velocity vector\r\n\r\n  // Inside your camera control init\r\n  scrollY = 50;\r\n  minY = 50.5;   // minimum camera height\r\n  maxY = 135.0;   // maximum camera height\r\n  scrollSpeed = 1;\r\n\r\n\r\n\r\n  get velocity() {\r\n    return this.velocity_;\r\n  }\r\n  // Assigns `vec` to the velocity vector\r\n  set velocity(vec) {\r\n    vec3.copy(vec, this.velocity_);\r\n  }\r\n\r\n  setProjection(fov = (2 * Math.PI) / 5, aspect = 1, near = 1, far = 1000) {\r\n    this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n  }\r\n\r\n  constructor(options) {\r\n    super();\r\n    if(options && (options.position || options.target)) {\r\n      const position = options.position ?? vec3.create(0, 0, 0);\r\n      const target = options.target ?? vec3.create(0, 0, 0);\r\n      const forward = vec3.normalize(vec3.sub(target, position));\r\n      this.recalculateAngles(forward);\r\n      this.position = position;\r\n      this.canvas = options.canvas;\r\n      this.aspect = options.canvas.width / options.canvas.height;\r\n      this.setProjection((2 * Math.PI) / 5, this.aspect, 1, 2000);\r\n      // console.log(`%cCamera constructor : ${position}`, LOG_INFO);\r\n\r\n      this.mousRollInAction = false;\r\n      addEventListener('wheel', (e) => {\r\n        // Scroll up = zoom out / higher Y\r\n        this.mousRollInAction = true;\r\n        this.scrollY -= e.deltaY * this.scrollSpeed * 0.01;\r\n        // Clamp to range\r\n        this.scrollY = Math.max(this.minY, Math.min(this.maxY, this.scrollY));\r\n      });\r\n    }\r\n  }\r\n\r\n  get matrix() {\r\n    return super.matrix;\r\n  }\r\n\r\n  // Assigns `mat` to the camera matrix, and recalcuates the camera angles\r\n  set matrix(mat) {\r\n    super.matrix = mat;\r\n    this.recalculateAngles(this.back);\r\n  }\r\n\r\n  update(deltaTime, input) {\r\n    const sign = (positive, negative) =>\r\n      (positive ? 1 : 0) - (negative ? 1 : 0);\r\n    // Apply the delta rotation to the pitch and yaw angles\r\n    this.yaw = 0;//-= input.analog.x * deltaTime * this.rotationSpeed;\r\n    this.pitch = -0.88;//  -= input.analog.y * deltaTime * this.rotationSpeed;\r\n    // // Wrap yaw between [0\u00B0 .. 360\u00B0], just to prevent large accumulation.\r\n    this.yaw = mod(this.yaw, Math.PI * 2);\r\n    // // Clamp pitch between [-90\u00B0 .. +90\u00B0] to prevent somersaults.\r\n    this.pitch = clamp(this.pitch, -Math.PI / 2, Math.PI / 2);\r\n    // Save the current position, as we're about to rebuild the camera matrix.\r\n    if(this.followMe != null && this.followMe.inMove === true ||\r\n      this.mousRollInAction == true\r\n    ) {\r\n      //  console.log(\"  follow : \" + this.followMe.x)\r\n\r\n      this.followMeOffset = this.scrollY;\r\n      // if player not move allow mouse explore map \r\n      this.position[0] = this.followMe.x;\r\n      this.position[2] = this.followMe.z + this.followMeOffset;\r\n      app.lightContainer[0].position[0] = this.followMe.x;\r\n      app.lightContainer[0].position[2] = this.followMe.z;\r\n      app.lightContainer[0].target[0] = this.followMe.x;\r\n      app.lightContainer[0].target[2] = this.followMe.z;\r\n\r\n      this.mousRollInAction = false;\r\n    }\r\n\r\n\r\n    const smoothFactor = 0.1;\r\n    this.position[1] += (this.scrollY - this.position[1]) * smoothFactor;\r\n\r\n    let position = vec3.copy(this.position);\r\n    // Reconstruct the camera's rotation, and store into the camera matrix.\r\n    super.matrix = mat4.rotateX(mat4.rotationY(this.yaw), this.pitch);\r\n    // Calculate the new target velocity\r\n    const digital = input.digital;\r\n    const deltaRight = sign(digital.right, digital.left);\r\n    const deltaUp = sign(digital.up, digital.down);\r\n    const targetVelocity = vec3.create();\r\n    const deltaBack = sign(digital.backward, digital.forward);\r\n    // older then follow\r\n    if(deltaBack == -1) {\r\n      // console.log(deltaBack + \"  deltaBack \")\r\n      position[2] += -10;\r\n    } else if(deltaBack == 1) {\r\n      position[2] += 10;\r\n    }\r\n    position[0] += deltaRight * 10;\r\n    vec3.addScaled(targetVelocity, this.right, deltaRight, targetVelocity);\r\n    vec3.addScaled(targetVelocity, this.up, deltaUp, targetVelocity);\r\n    vec3.normalize(targetVelocity, targetVelocity);\r\n    vec3.mulScalar(targetVelocity, this.movementSpeed, targetVelocity);\r\n    this.velocity = lerp(\r\n      targetVelocity,\r\n      this.velocity,\r\n      Math.pow(1 - this.frictionCoefficient, deltaTime)\r\n    );\r\n    this.position = vec3.addScaled(position, this.velocity, deltaTime);\r\n    this.view = mat4.invert(this.matrix);\r\n    return this.view;\r\n  }\r\n\r\n  recalculateAngles(dir) {\r\n    this.yaw = Math.atan2(dir[0], dir[2]);\r\n    this.pitch = -Math.asin(dir[1]);\r\n  }\r\n}\r\n", "import {UNLIT_SHADER} from \"../shaders/shaders\";\r\nimport {mat4, vec3} from 'wgpu-matrix';\r\nimport {Position, Rotation} from \"./matrix-class\";\r\nimport {createInputHandler} from \"./engine\";\r\n\r\nexport default class MEBall {\r\n\r\n\tconstructor(canvas, device, context, o) {\r\n\t\tthis.context = context;\r\n\t\tthis.device = device;\r\n\r\n\t\t// The input handler\r\n\t\tthis.inputHandler = createInputHandler(window, canvas);\r\n\t\tthis.cameras = o.cameras;\r\n\t\tthis.scale = o.scale;\r\n\t\tconsole.log('passed : o.mainCameraParams.responseCoef ', o.mainCameraParams.responseCoef)\r\n\t\tthis.mainCameraParams = {\r\n\t\t\ttype: o.mainCameraParams.type,\r\n\t\t\tresponseCoef: o.mainCameraParams.responseCoef\r\n\t\t} // |  WASD 'arcball' };\r\n\r\n\t\tthis.lastFrameMS = 0;\r\n\r\n\t\tthis.entityArgPass = o.entityArgPass;\r\n\r\n\t\tthis.SphereLayout = {\r\n\t\t\tvertexStride: 8 * 4,\r\n\t\t\tpositionsOffset: 0,\r\n\t\t\tnormalOffset: 3 * 4,\r\n\t\t\tuvOffset: 6 * 4,\r\n\t\t};\r\n\r\n\t\tif(typeof o.raycast === 'undefined') {\r\n\t\t\tthis.raycast = {\r\n\t\t\t\tenabled: false,\r\n\t\t\t\tradius: 2\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tthis.raycast = o.raycast;\r\n\t\t}\r\n\r\n\t\tthis.texturesPaths = [];\r\n\r\n\t\to.texturesPaths.forEach((t) => {\r\n\t\t\tthis.texturesPaths.push(t)\r\n\t\t})\r\n\r\n\t\tthis.position = new Position(o.position.x, o.position.y, o.position.z)\r\n\t\tthis.rotation = new Rotation(o.rotation.x, o.rotation.y, o.rotation.z);\r\n\t\tthis.rotation.rotationSpeed.x = o.rotationSpeed.x;\r\n\t\tthis.rotation.rotationSpeed.y = o.rotationSpeed.y;\r\n\t\tthis.rotation.rotationSpeed.z = o.rotationSpeed.z;\r\n\r\n\t\tthis.shaderModule = device.createShaderModule({code: UNLIT_SHADER});\r\n\t\tthis.presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n\r\n\t\tthis.pipeline = device.createRenderPipeline({\r\n\t\t\tlayout: 'auto',\r\n\t\t\tvertex: {\r\n\t\t\t\tmodule: this.shaderModule,\r\n\t\t\t\tentryPoint: 'vertexMain',\r\n\t\t\t\tbuffers: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tarrayStride: this.SphereLayout.vertexStride,\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// position\r\n\t\t\t\t\t\t\t\tshaderLocation: 0,\r\n\t\t\t\t\t\t\t\toffset: this.SphereLayout.positionsOffset,\r\n\t\t\t\t\t\t\t\tformat: 'float32x3',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// normal\r\n\t\t\t\t\t\t\t\tshaderLocation: 1,\r\n\t\t\t\t\t\t\t\toffset: this.SphereLayout.normalOffset,\r\n\t\t\t\t\t\t\t\tformat: 'float32x3',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t// uv\r\n\t\t\t\t\t\t\t\tshaderLocation: 2,\r\n\t\t\t\t\t\t\t\toffset: this.SphereLayout.uvOffset,\r\n\t\t\t\t\t\t\t\tformat: 'float32x2',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tfragment: {\r\n\t\t\t\tmodule: this.shaderModule,\r\n\t\t\t\tentryPoint: 'fragmentMain',\r\n\t\t\t\ttargets: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tformat: this.presentationFormat,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tprimitive: {\r\n\t\t\t\ttopology: 'triangle-list',\r\n\r\n\t\t\t\t// Backface culling since the sphere is solid piece of geometry.\r\n\t\t\t\t// Faces pointing away from the camera will be occluded by faces\r\n\t\t\t\t// pointing toward the camera.\r\n\t\t\t\tcullMode: 'back',\r\n\t\t\t},\r\n\r\n\t\t\t// Enable depth testing so that the fragment closest to the camera\r\n\t\t\t// is rendered in front.\r\n\t\t\tdepthStencil: {\r\n\t\t\t\tdepthWriteEnabled: true,\r\n\t\t\t\tdepthCompare: 'less',\r\n\t\t\t\tformat: 'depth24plus',\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.depthTexture = device.createTexture({\r\n\t\t\tsize: [canvas.width, canvas.height],\r\n\t\t\tformat: 'depth24plus',\r\n\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT,\r\n\t\t});\r\n\r\n\t\tthis.uniformBufferSize = 4 * 16; // 4x4 matrix\r\n\t\tthis.uniformBuffer = device.createBuffer({\r\n\t\t\tsize: this.uniformBufferSize,\r\n\t\t\tusage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n\t\t});\r\n\r\n\t\t// Fetch the images and upload them into a GPUTexture.\r\n\t\tthis.texture0 = null;\r\n\t\tthis.moonTexture = null;\r\n\r\n\t\tthis.settings = {\r\n\t\t\tuseRenderBundles: true,\r\n\t\t\tasteroidCount: 15,\r\n\t\t};\r\n\r\n\t\tthis.loadTex0(this.texturesPaths, device).then(() => {\r\n\t\t\tthis.loadTex1(this.texturesPaths, device).then(() => {\r\n\t\t\t\tthis.sampler = device.createSampler({\r\n\t\t\t\t\tmagFilter: 'linear',\r\n\t\t\t\t\tminFilter: 'linear',\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.transform = mat4.create();\r\n\t\t\t\tmat4.identity(this.transform);\r\n\r\n\t\t\t\t// Create one large central planet surrounded by a large ring of asteroids\r\n\t\t\t\tthis.planet = this.createGeometry(this.scale);\r\n\t\t\t\tthis.planet.bindGroup = this.createSphereBindGroup(this.texture0, this.transform);\r\n\r\n\t\t\t\tvar asteroids = [\r\n\t\t\t\t\tthis.createGeometry(12, 8, 6, 0.15),\r\n\t\t\t\t];\r\n\r\n\t\t\t\tthis.renderables = [this.planet];\r\n\r\n\t\t\t\t// this.ensureEnoughAsteroids(asteroids, this.transform);\r\n\t\t\t\tthis.renderPassDescriptor = {\r\n\t\t\t\t\tcolorAttachments: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tview: undefined,\r\n\t\t\t\t\t\t\tclearValue: {r: 0.0, g: 0.0, b: 0.0, a: 1.0},\r\n\t\t\t\t\t\t\tloadOp: this.entityArgPass.loadOp,\r\n\t\t\t\t\t\t\tstoreOp: this.entityArgPass.storeOp,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t\tdepthStencilAttachment: {\r\n\t\t\t\t\t\tview: this.depthTexture.createView(),\r\n\t\t\t\t\t\tdepthClearValue: 1.0,\r\n\t\t\t\t\t\tdepthLoadOp: this.entityArgPass.depthLoadOp,\r\n\t\t\t\t\t\tdepthStoreOp: this.entityArgPass.depthStoreOp,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst aspect = canvas.width / canvas.height;\r\n\t\t\t\tthis.projectionMatrix = mat4.perspective((2 * Math.PI) / 5, aspect, 1, 100.0);\r\n\t\t\t\tthis.modelViewProjectionMatrix = mat4.create();\r\n\r\n\t\t\t\tthis.frameBindGroup = device.createBindGroup({\r\n\t\t\t\t\tlayout: this.pipeline.getBindGroupLayout(0),\r\n\t\t\t\t\tentries: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbinding: 0,\r\n\t\t\t\t\t\t\tresource: {\r\n\t\t\t\t\t\t\t\tbuffer: this.uniformBuffer,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\t// The render bundle can be encoded once and re-used as many times as needed.\r\n\t\t\t\t// Because it encodes all of the commands needed to render at the GPU level,\r\n\t\t\t\t// those commands will not need to execute the associated JavaScript code upon\r\n\t\t\t\t// execution or be re-validated, which can represent a significant time savings.\r\n\t\t\t\t//\r\n\t\t\t\t// However, because render bundles are immutable once created, they are only\r\n\t\t\t\t// appropriate for rendering content where the same commands will be executed\r\n\t\t\t\t// every time, with the only changes being the contents of the buffers and\r\n\t\t\t\t// textures used. Cases where the executed commands differ from frame-to-frame,\r\n\t\t\t\t// such as when using frustrum or occlusion culling, will not benefit from\r\n\t\t\t\t// using render bundles as much.\r\n\t\t\t\tthis.renderBundle;\r\n\t\t\t\tthis.updateRenderBundle();\r\n\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t}\r\n\r\n\tensureEnoughAsteroids(asteroids, transform) {\r\n\t\tfor(let i = this.renderables.length;i <= this.settings.asteroidCount;++i) {\r\n\t\t\t// Place copies of the asteroid in a ring.\r\n\t\t\tconst radius = Math.random() * 1.7 + 1.25;\r\n\t\t\tconst angle = Math.random() * Math.PI * 2;\r\n\t\t\tconst x = Math.sin(angle) * radius;\r\n\t\t\tconst y = (Math.random() - 0.5) * 0.015;\r\n\t\t\tconst z = Math.cos(angle) * radius;\r\n\r\n\t\t\tmat4.identity(transform);\r\n\t\t\tmat4.translate(transform, [x, y, z], transform);\r\n\t\t\tmat4.rotateX(transform, Math.random() * Math.PI, transform);\r\n\t\t\tmat4.rotateY(transform, Math.random() * Math.PI, transform);\r\n\t\t\tthis.renderables.push({\r\n\t\t\t\t...asteroids[i % asteroids.length],\r\n\t\t\t\tbindGroup: this.createSphereBindGroup(this.moonTexture, transform),\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tupdateRenderBundle() {\r\n\t\tconsole.log('updateRenderBundle')\r\n\t\tconst renderBundleEncoder = this.device.createRenderBundleEncoder({\r\n\t\t\tcolorFormats: [this.presentationFormat],\r\n\t\t\tdepthStencilFormat: 'depth24plus',\r\n\t\t});\r\n\t\tthis.renderScene(renderBundleEncoder);\r\n\t\tthis.renderBundle = renderBundleEncoder.finish();\r\n\t}\r\n\r\n\tcreateGeometry(radius, widthSegments = 8, heightSegments = 4, randomness = 0) {\r\n\r\n\t\tconst sphereMesh = this.createSphereMesh(radius, widthSegments, heightSegments, randomness);\r\n\t\t// Create a vertex buffer from the sphere data.\r\n\t\tconst vertices = this.device.createBuffer({\r\n\t\t\tsize: sphereMesh.vertices.byteLength,\r\n\t\t\tusage: GPUBufferUsage.VERTEX,\r\n\t\t\tmappedAtCreation: true,\r\n\t\t});\r\n\t\tnew Float32Array(vertices.getMappedRange()).set(sphereMesh.vertices);\r\n\t\tvertices.unmap();\r\n\r\n\t\tconst indices = this.device.createBuffer({\r\n\t\t\tsize: sphereMesh.indices.byteLength,\r\n\t\t\tusage: GPUBufferUsage.INDEX,\r\n\t\t\tmappedAtCreation: true,\r\n\t\t});\r\n\t\tnew Uint16Array(indices.getMappedRange()).set(sphereMesh.indices);\r\n\t\tindices.unmap();\r\n\r\n\t\treturn {\r\n\t\t\tvertices,\r\n\t\t\tindices,\r\n\t\t\tindexCount: sphereMesh.indices.length,\r\n\t\t};\r\n\t}\r\n\r\n\tcreateSphereBindGroup(texture, transform) {\r\n\r\n\t\tconst uniformBufferSize = 4 * 16; // 4x4 matrix\r\n\t\tconst uniformBuffer = this.device.createBuffer({\r\n\t\t\tsize: uniformBufferSize,\r\n\t\t\tusage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n\t\t\tmappedAtCreation: true,\r\n\t\t});\r\n\t\tnew Float32Array(uniformBuffer.getMappedRange()).set(transform);\r\n\t\tuniformBuffer.unmap();\r\n\r\n\t\tconst bindGroup = this.device.createBindGroup({\r\n\t\t\tlayout: this.pipeline.getBindGroupLayout(1),\r\n\t\t\tentries: [\r\n\t\t\t\t{\r\n\t\t\t\t\tbinding: 0,\r\n\t\t\t\t\tresource: {\r\n\t\t\t\t\t\tbuffer: uniformBuffer,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tbinding: 1,\r\n\t\t\t\t\tresource: this.sampler,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tbinding: 2,\r\n\t\t\t\t\tresource: texture.createView(),\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t});\r\n\r\n\t\treturn bindGroup;\r\n\t}\r\n\r\n\tgetTransformationMatrix(pos) {\r\n\t\t// const viewMatrix = mat4.identity();\r\n\t\tconst now = Date.now();\r\n\t\tconst deltaTime = (now - this.lastFrameMS) / this.mainCameraParams.responseCoef;\r\n\t\tthis.lastFrameMS = now;\r\n\r\n\t\t// const viewMatrix = mat4.identity(); ORI\r\n\t\tconst camera = this.cameras[this.mainCameraParams.type];\r\n\t\tconst viewMatrix = camera.update(deltaTime, this.inputHandler());\r\n\r\n\t\tmat4.translate(viewMatrix, vec3.fromValues(pos.x, pos.y, pos.z), viewMatrix);\r\n\r\n\t\tmat4.rotateX(viewMatrix, Math.PI * this.rotation.getRotX(), viewMatrix);\r\n\t\tmat4.rotateY(viewMatrix, Math.PI * this.rotation.getRotY(), viewMatrix);\r\n\t\tmat4.rotateZ(viewMatrix, Math.PI * this.rotation.getRotZ(), viewMatrix);\r\n\r\n\t\tmat4.multiply(this.projectionMatrix, viewMatrix, this.modelViewProjectionMatrix);\r\n\t\treturn this.modelViewProjectionMatrix;\r\n\t}\r\n\r\n\tasync loadTex1(texPaths, device) {\r\n\t\treturn new Promise(async (resolve) => {\r\n\t\t\tconst response = await fetch(texPaths[0]);\r\n\t\t\tconst imageBitmap = await createImageBitmap(await response.blob());\r\n\r\n\t\t\tthis.moonTexture = device.createTexture({\r\n\t\t\t\tsize: [imageBitmap.width, imageBitmap.height, 1],\r\n\t\t\t\tformat: 'rgba8unorm',\r\n\t\t\t\tusage:\r\n\t\t\t\t\tGPUTextureUsage.TEXTURE_BINDING |\r\n\t\t\t\t\tGPUTextureUsage.COPY_DST |\r\n\t\t\t\t\tGPUTextureUsage.RENDER_ATTACHMENT,\r\n\t\t\t});\r\n\t\t\tvar moonTexture = this.moonTexture\r\n\t\t\tdevice.queue.copyExternalImageToTexture(\r\n\t\t\t\t{source: imageBitmap},\r\n\t\t\t\t{texture: moonTexture},\r\n\t\t\t\t[imageBitmap.width, imageBitmap.height]\r\n\t\t\t);\r\n\t\t\tresolve()\r\n\t\t})\r\n\t}\r\n\r\n\tasync loadTex0(paths, device) {\r\n\t\treturn new Promise(async (resolve) => {\r\n\t\t\tconst response = await fetch(paths[0]);\r\n\t\t\tconst imageBitmap = await createImageBitmap(await response.blob());\r\n\t\t\tconsole.log('loadTex0 WHAT IS THIS -> ', this)\r\n\t\t\tthis.texture0 = device.createTexture({\r\n\t\t\t\tsize: [imageBitmap.width, imageBitmap.height, 1],\r\n\t\t\t\tformat: 'rgba8unorm',\r\n\t\t\t\tusage:\r\n\t\t\t\t\tGPUTextureUsage.TEXTURE_BINDING |\r\n\t\t\t\t\tGPUTextureUsage.COPY_DST |\r\n\t\t\t\t\tGPUTextureUsage.RENDER_ATTACHMENT,\r\n\t\t\t});\r\n\t\t\tvar texture0 = this.texture0\r\n\t\t\tdevice.queue.copyExternalImageToTexture(\r\n\t\t\t\t{source: imageBitmap},\r\n\t\t\t\t{texture: texture0},\r\n\t\t\t\t[imageBitmap.width, imageBitmap.height]\r\n\t\t\t);\r\n\t\t\tresolve()\r\n\t\t})\r\n\r\n\t}\r\n\r\n\tcreateSphereMesh(radius, widthSegments = 3, heightSegments = 3, randomness = 0) {\r\n\t\tconst vertices = [];\r\n\t\tconst indices = [];\r\n\r\n\t\twidthSegments = Math.max(3, Math.floor(widthSegments));\r\n\t\theightSegments = Math.max(2, Math.floor(heightSegments));\r\n\r\n\t\tconst firstVertex = vec3.create();\r\n\t\tconst vertex = vec3.create();\r\n\t\tconst normal = vec3.create();\r\n\r\n\t\tlet index = 0;\r\n\t\tconst grid = [];\r\n\r\n\t\t// generate vertices, normals and uvs\r\n\t\tfor(let iy = 0;iy <= heightSegments;iy++) {\r\n\t\t\tconst verticesRow = [];\r\n\t\t\tconst v = iy / heightSegments;\r\n\t\t\t// special case for the poles\r\n\t\t\tlet uOffset = 0;\r\n\t\t\tif(iy === 0) {\r\n\t\t\t\tuOffset = 0.5 / widthSegments;\r\n\t\t\t} else if(iy === heightSegments) {\r\n\t\t\t\tuOffset = -0.5 / widthSegments;\r\n\t\t\t}\r\n\r\n\t\t\tfor(let ix = 0;ix <= widthSegments;ix++) {\r\n\t\t\t\tconst u = ix / widthSegments;\r\n\t\t\t\t// Poles should just use the same position all the way around.\r\n\t\t\t\tif(ix == widthSegments) {\r\n\t\t\t\t\tvec3.copy(firstVertex, vertex);\r\n\t\t\t\t} else if(ix == 0 || (iy != 0 && iy !== heightSegments)) {\r\n\t\t\t\t\tconst rr = radius + (Math.random() - 0.5) * 2 * randomness * radius;\r\n\t\t\t\t\t// vertex\r\n\t\t\t\t\tvertex[0] = -rr * Math.cos(u * Math.PI * 2) * Math.sin(v * Math.PI);\r\n\t\t\t\t\tvertex[1] = rr * Math.cos(v * Math.PI);\r\n\t\t\t\t\tvertex[2] = rr * Math.sin(u * Math.PI * 2) * Math.sin(v * Math.PI);\r\n\t\t\t\t\tif(ix == 0) {\r\n\t\t\t\t\t\tvec3.copy(vertex, firstVertex);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvertices.push(...vertex);\r\n\r\n\t\t\t\t// normal\r\n\t\t\t\tvec3.copy(vertex, normal);\r\n\t\t\t\tvec3.normalize(normal, normal);\r\n\t\t\t\tvertices.push(...normal);\r\n\t\t\t\t// uv\r\n\t\t\t\tvertices.push(u + uOffset, 1 - v);\r\n\t\t\t\tverticesRow.push(index++);\r\n\t\t\t}\r\n\t\t\tgrid.push(verticesRow);\r\n\t\t}\r\n\t\t// indices\r\n\t\tfor(let iy = 0;iy < heightSegments;iy++) {\r\n\t\t\tfor(let ix = 0;ix < widthSegments;ix++) {\r\n\t\t\t\tconst a = grid[iy][ix + 1];\r\n\t\t\t\tconst b = grid[iy][ix];\r\n\t\t\t\tconst c = grid[iy + 1][ix];\r\n\t\t\t\tconst d = grid[iy + 1][ix + 1];\r\n\r\n\t\t\t\tif(iy !== 0) indices.push(a, b, d);\r\n\t\t\t\tif(iy !== heightSegments - 1) indices.push(b, c, d);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tvertices: new Float32Array(vertices),\r\n\t\t\tindices: new Uint16Array(indices),\r\n\t\t};\r\n\t}\r\n\r\n\t// Render bundles function as partial, limited render passes, so we can use the\r\n\t// same code both to render the scene normally and to build the render bundle.\r\n\trenderScene(passEncoder) {\r\n\t\tif(typeof this.renderables === 'undefined') return;\r\n\t\tpassEncoder.setPipeline(this.pipeline);\r\n\t\tpassEncoder.setBindGroup(0, this.frameBindGroup);\r\n\t\t// Loop through every renderable object and draw them individually.\r\n\t\t// (Because many of these meshes are repeated, with only the transforms\r\n\t\t// differing, instancing would be highly effective here. This sample\r\n\t\t// intentionally avoids using instancing in order to emulate a more complex\r\n\t\t// scene, which helps demonstrate the potential time savings a render bundle\r\n\t\t// can provide.)\r\n\t\tlet count = 0;\r\n\t\tfor(const renderable of this.renderables) {\r\n\t\t\tpassEncoder.setBindGroup(1, renderable.bindGroup);\r\n\t\t\tpassEncoder.setVertexBuffer(0, renderable.vertices);\r\n\t\t\tpassEncoder.setIndexBuffer(renderable.indices, 'uint16');\r\n\t\t\tpassEncoder.drawIndexed(renderable.indexCount);\r\n\r\n\t\t\tif(++count > this.settings.asteroidCount) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdraw = () => {\r\n\t\tif(this.moonTexture == null) {\r\n\t\t\t// console.log('not ready')\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst transformationMatrix = this.getTransformationMatrix(this.position);\r\n\t\tthis.device.queue.writeBuffer(\r\n\t\t\tthis.uniformBuffer,\r\n\t\t\t0,\r\n\t\t\ttransformationMatrix.buffer,\r\n\t\t\ttransformationMatrix.byteOffset,\r\n\t\t\ttransformationMatrix.byteLength\r\n\t\t);\r\n\t\tthis.renderPassDescriptor.colorAttachments[0].view = this.context\r\n\t\t\t.getCurrentTexture()\r\n\t\t\t.createView();\r\n\t}\r\n}", "import {UNLIT_SHADER} from \"../shaders/shaders\";\r\nimport {mat4, vec3} from 'wgpu-matrix';\r\nimport {Position, Rotation} from \"./matrix-class\";\r\nimport {createInputHandler} from \"./engine\";\r\n\r\nvar SphereLayout = {\r\n\tvertexStride: 8 * 4,\r\n\tpositionsOffset: 0,\r\n\tnormalOffset: 3 * 4,\r\n\tuvOffset: 6 * 4,\r\n};\r\n\r\nexport default class MECube {\r\n\r\n\tconstructor(canvas, device, context, o) {\r\n\t\tthis.device = device;\r\n\t\tthis.context = context;\r\n\t\tthis.entityArgPass = o.entityArgPass;\r\n\t\tthis.inputHandler = createInputHandler(window, canvas);\r\n\t\tthis.cameras = o.cameras;\r\n\t\tconsole.log('passed : o.mainCameraParams.responseCoef ', o.mainCameraParams.responseCoef)\r\n\t\tthis.mainCameraParams = {\r\n\t\t\ttype: o.mainCameraParams.type,\r\n\t\t\tresponseCoef: o.mainCameraParams.responseCoef\r\n\t\t} // |  WASD 'arcball' };\r\n\r\n\t\tthis.lastFrameMS = 0;\r\n\t\tthis.shaderModule = device.createShaderModule({\r\n\t\t\tcode: UNLIT_SHADER,\r\n\t\t});\r\n\r\n\t\tthis.texturesPaths = [];\r\n\r\n\t\tif(typeof o.raycast === 'undefined') {\r\n\t\t\tthis.raycast = {\r\n\t\t\t\tenabled: false,\r\n\t\t\t\tradius: 2\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tthis.raycast = o.raycast;\r\n\t\t}\r\n\r\n\t\t// useUVShema4x2 pass this from top !\r\n\r\n\t\to.texturesPaths.forEach((t) => {\r\n\t\t\tthis.texturesPaths.push(t)\r\n\t\t})\r\n\r\n\t\tthis.presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n\t\tthis.position = new Position(o.position.x, o.position.y, o.position.z);\r\n\t\tconsole.log('cube added on pos : ', this.position)\r\n\t\tthis.rotation = new Rotation(o.rotation.x, o.rotation.y, o.rotation.z);\r\n\t\tthis.rotation.rotationSpeed.x = o.rotationSpeed.x;\r\n\t\tthis.rotation.rotationSpeed.y = o.rotationSpeed.y;\r\n\t\tthis.rotation.rotationSpeed.z = o.rotationSpeed.z;\r\n\r\n\t\tthis.scale = o.scale;\r\n\t\tthis.pipeline = device.createRenderPipeline({\r\n\t\t\tlayout: 'auto',\r\n\t\t\tvertex: {\r\n\t\t\t\tmodule: this.shaderModule,\r\n\t\t\t\tentryPoint: 'vertexMain',\r\n\t\t\t\tbuffers: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tarrayStride: SphereLayout.vertexStride,\r\n\t\t\t\t\t\tattributes: [\r\n\t\t\t\t\t\t\t// position\r\n\t\t\t\t\t\t\t{shaderLocation: 0, offset: SphereLayout.positionsOffset, format: 'float32x3'},\r\n\t\t\t\t\t\t\t// normal\r\n\t\t\t\t\t\t\t{shaderLocation: 1, offset: SphereLayout.normalOffset, format: 'float32x3'},\r\n\t\t\t\t\t\t\t// uv\r\n\t\t\t\t\t\t\t{shaderLocation: 2, offset: SphereLayout.uvOffset, format: 'float32x2', },\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t},\r\n\t\t\tfragment: {\r\n\t\t\t\tmodule: this.shaderModule,\r\n\t\t\t\tentryPoint: 'fragmentMain',\r\n\t\t\t\ttargets: [{format: this.presentationFormat, },],\r\n\t\t\t},\r\n\t\t\tprimitive: {\r\n\t\t\t\ttopology: 'triangle-list',\r\n\t\t\t\t// Backface culling since the sphere is solid piece of geometry.\r\n\t\t\t\t// Faces pointing away from the camera will be occluded by faces\r\n\t\t\t\t// pointing toward the camera.\r\n\t\t\t\tcullMode: 'back',\r\n\t\t\t},\r\n\t\t\t// Enable depth testing so that the fragment closest to the camera\r\n\t\t\t// is rendered in front.\r\n\t\t\tdepthStencil: {\r\n\t\t\t\tdepthWriteEnabled: true,\r\n\t\t\t\tdepthCompare: 'less',\r\n\t\t\t\tformat: 'depth24plus',\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.depthTexture = device.createTexture({\r\n\t\t\tsize: [canvas.width, canvas.height],\r\n\t\t\tformat: 'depth24plus',\r\n\t\t\tusage: GPUTextureUsage.RENDER_ATTACHMENT,\r\n\t\t});\r\n\r\n\t\tthis.uniformBufferSize = 4 * 16; // 4x4 matrix\r\n\t\tthis.uniformBuffer = device.createBuffer({\r\n\t\t\tsize: this.uniformBufferSize,\r\n\t\t\tusage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n\t\t});\r\n\r\n\t\t// Fetch the images and upload them into a GPUTexture.\r\n\t\tthis.texture0 = null;\r\n\t\tthis.moonTexture = null;\r\n\r\n\t\tthis.settings = {\r\n\t\t\tuseRenderBundles: true,\r\n\t\t\tasteroidCount: 15,\r\n\t\t};\r\n\r\n\t\tthis.loadTex0(this.texturesPaths, device).then(() => {\r\n\t\t\tthis.loadTex1(this.texturesPaths, device).then(() => {\r\n\r\n\t\t\t\tthis.sampler = device.createSampler({\r\n\t\t\t\t\tmagFilter: 'linear',\r\n\t\t\t\t\tminFilter: 'linear',\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.transform = mat4.create();\r\n\t\t\t\tmat4.identity(this.transform);\r\n\r\n\t\t\t\tthis.planet = this.createGeometry({\r\n\t\t\t\t\tscale: this.scale,\r\n\t\t\t\t\tuseUVShema4x2: false\r\n\t\t\t\t});\r\n\t\t\t\tthis.planet.bindGroup = this.createSphereBindGroup(this.texture0, this.transform);\r\n\r\n\t\t\t\t// can be used like instance draws\r\n\t\t\t\tvar asteroids = [\r\n\t\t\t\t\t// this.createGeometry(0.2, 8, 6, 0.15),\r\n\t\t\t\t];\r\n\r\n\t\t\t\tthis.renderables = [this.planet];\r\n\t\t\t\t// this.ensureEnoughAsteroids(asteroids, this.transform);\r\n\t\t\t\tthis.renderPassDescriptor = {\r\n\t\t\t\t\tcolorAttachments: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tview: undefined,\r\n\t\t\t\t\t\t\tclearValue: {r: 0.0, g: 0.0, b: 0.0, a: 1.0},\r\n\t\t\t\t\t\t\tloadOp: this.entityArgPass.loadOp,\r\n\t\t\t\t\t\t\tstoreOp: this.entityArgPass.storeOp,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t\tdepthStencilAttachment: {\r\n\t\t\t\t\t\tview: this.depthTexture.createView(),\r\n\t\t\t\t\t\tdepthClearValue: 1.0,\r\n\t\t\t\t\t\tdepthLoadOp: this.entityArgPass.depthLoadOp,\r\n\t\t\t\t\t\tdepthStoreOp: this.entityArgPass.depthStoreOp,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst aspect = canvas.width / canvas.height;\r\n\t\t\t\tthis.projectionMatrix = mat4.perspective((2 * Math.PI) / 5, aspect, 1, 1000.0);\r\n\t\t\t\tthis.modelViewProjectionMatrix = mat4.create();\r\n\r\n\t\t\t\tthis.frameBindGroup = device.createBindGroup({\r\n\t\t\t\t\tlayout: this.pipeline.getBindGroupLayout(0),\r\n\t\t\t\t\tentries: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tbinding: 0,\r\n\t\t\t\t\t\t\tresource: {buffer: this.uniformBuffer, },\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// The render bundle can be encoded once and re-used as many times as needed.\r\n\t\t\t\t// Because it encodes all of the commands needed to render at the GPU level,\r\n\t\t\t\t// those commands will not need to execute the associated JavaScript code upon\r\n\t\t\t\t// execution or be re-validated, which can represent a significant time savings.\r\n\t\t\t\t//\r\n\t\t\t\t// However, because render bundles are immutable once created, they are only\r\n\t\t\t\t// appropriate for rendering content where the same commands will be executed\r\n\t\t\t\t// every time, with the only changes being the contents of the buffers and\r\n\t\t\t\t// textures used. Cases where the executed commands differ from frame-to-frame,\r\n\t\t\t\t// such as when using frustrum or occlusion culling, will not benefit from\r\n\t\t\t\t// using render bundles as much.\r\n\t\t\t\tthis.renderBundle;\r\n\t\t\t\tthis.updateRenderBundle();\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tensureEnoughAsteroids(asteroids, transform) {\r\n\t\tfor(let i = this.renderables.length;i <= this.settings.asteroidCount;++i) {\r\n\t\t\t// Place copies of the asteroid in a ring.\r\n\t\t\tconst radius = Math.random() * 1.7 + 1.25;\r\n\t\t\tconst angle = Math.random() * Math.PI * 2;\r\n\t\t\tconst x = Math.sin(angle) * radius;\r\n\t\t\tconst y = (Math.random() - 0.5) * 0.015;\r\n\t\t\tconst z = Math.cos(angle) * radius;\r\n\r\n\t\t\tmat4.identity(transform);\r\n\t\t\tmat4.translate(transform, [x, y, z], transform);\r\n\t\t\tmat4.rotateX(transform, Math.random() * Math.PI, transform);\r\n\t\t\tmat4.rotateY(transform, Math.random() * Math.PI, transform);\r\n\t\t\tthis.renderables.push({\r\n\t\t\t\t...asteroids[i % asteroids.length],\r\n\t\t\t\tbindGroup: this.createSphereBindGroup(this.moonTexture, transform),\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tupdateRenderBundle() {\r\n\t\tconsole.log('[CUBE] updateRenderBundle')\r\n\t\tconst renderBundleEncoder = this.device.createRenderBundleEncoder({\r\n\t\t\tcolorFormats: [this.presentationFormat],\r\n\t\t\tdepthStencilFormat: 'depth24plus',\r\n\t\t});\r\n\t\tthis.renderScene(renderBundleEncoder);\r\n\t\tthis.renderBundle = renderBundleEncoder.finish();\r\n\t}\r\n\r\n\tcreateGeometry(options) {\r\n\t\tconst mesh = this.createCubeVertices(options);\r\n\t\t// Create a vertex buffer from the sphere data.\r\n\t\tconst vertices = this.device.createBuffer({\r\n\t\t\tsize: mesh.vertices.byteLength,\r\n\t\t\tusage: GPUBufferUsage.VERTEX,\r\n\t\t\tmappedAtCreation: true,\r\n\t\t});\r\n\t\tnew Float32Array(vertices.getMappedRange()).set(mesh.vertices);\r\n\t\tvertices.unmap();\r\n\r\n\t\tconst indices = this.device.createBuffer({\r\n\t\t\tsize: mesh.indices.byteLength,\r\n\t\t\tusage: GPUBufferUsage.INDEX,\r\n\t\t\tmappedAtCreation: true,\r\n\t\t});\r\n\t\tnew Uint16Array(indices.getMappedRange()).set(mesh.indices);\r\n\t\tindices.unmap();\r\n\r\n\t\treturn {\r\n\t\t\tvertices,\r\n\t\t\tindices,\r\n\t\t\tindexCount: mesh.indices.length,\r\n\t\t};\r\n\t}\r\n\r\n\tcreateSphereBindGroup(texture, transform) {\r\n\r\n\t\tconst uniformBufferSize = 4 * 16; // 4x4 matrix\r\n\t\tconst uniformBuffer = this.device.createBuffer({\r\n\t\t\tsize: uniformBufferSize,\r\n\t\t\tusage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n\t\t\tmappedAtCreation: true,\r\n\t\t});\r\n\t\tnew Float32Array(uniformBuffer.getMappedRange()).set(transform);\r\n\t\tuniformBuffer.unmap();\r\n\r\n\t\tconst bindGroup = this.device.createBindGroup({\r\n\t\t\tlayout: this.pipeline.getBindGroupLayout(1),\r\n\t\t\tentries: [\r\n\t\t\t\t{\r\n\t\t\t\t\tbinding: 0,\r\n\t\t\t\t\tresource: {\r\n\t\t\t\t\t\tbuffer: uniformBuffer,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tbinding: 1,\r\n\t\t\t\t\tresource: this.sampler,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tbinding: 2,\r\n\t\t\t\t\tresource: texture.createView(),\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t});\r\n\r\n\t\treturn bindGroup;\r\n\t}\r\n\r\n\r\n\t// TEST \r\n\tgetViewMatrix() {\r\n\t\tconst camera = this.cameras[this.mainCameraParams.type];\r\n\t\tconst viewMatrix = camera.update(deltaTime, this.inputHandler());\r\n\t\treturn viewMatrix;\r\n\t}\r\n\r\n\tgetTransformationMatrix(pos) {\r\n\t\tconst now = Date.now();\r\n\t\tconst deltaTime = (now - this.lastFrameMS) / this.mainCameraParams.responseCoef;\r\n\t\tthis.lastFrameMS = now;\r\n\r\n\t\t// const viewMatrix = mat4.identity(); ORI\r\n\t\tconst camera = this.cameras[this.mainCameraParams.type];\r\n\t\tconst viewMatrix = camera.update(deltaTime, this.inputHandler());\r\n\r\n\t\tmat4.translate(viewMatrix, vec3.fromValues(pos.x, pos.y, pos.z), viewMatrix);\r\n\t\tmat4.rotateX(viewMatrix, Math.PI * this.rotation.getRotX(), viewMatrix);\r\n\t\tmat4.rotateY(viewMatrix, Math.PI * this.rotation.getRotY(), viewMatrix);\r\n\t\tmat4.rotateZ(viewMatrix, Math.PI * this.rotation.getRotZ(), viewMatrix);\r\n\t\tmat4.multiply(this.projectionMatrix, viewMatrix, this.modelViewProjectionMatrix);\r\n\r\n\t\treturn this.modelViewProjectionMatrix;\r\n\t}\r\n\r\n\tasync loadTex1(textPath, device) {\r\n\t\treturn new Promise(async (resolve) => {\r\n\t\t\tconst response = await fetch(textPath[0]);\r\n\t\t\tconst imageBitmap = await createImageBitmap(await response.blob());\r\n\t\t\tthis.moonTexture = device.createTexture({\r\n\t\t\t\tsize: [imageBitmap.width, imageBitmap.height, 1],\r\n\t\t\t\tformat: 'rgba8unorm',\r\n\t\t\t\tusage:\r\n\t\t\t\t\tGPUTextureUsage.TEXTURE_BINDING |\r\n\t\t\t\t\tGPUTextureUsage.COPY_DST |\r\n\t\t\t\t\tGPUTextureUsage.RENDER_ATTACHMENT,\r\n\t\t\t});\r\n\t\t\tvar moonTexture = this.moonTexture\r\n\t\t\tdevice.queue.copyExternalImageToTexture(\r\n\t\t\t\t{source: imageBitmap},\r\n\t\t\t\t{texture: moonTexture},\r\n\t\t\t\t[imageBitmap.width, imageBitmap.height]\r\n\t\t\t);\r\n\t\t\tresolve()\r\n\t\t})\r\n\t}\r\n\r\n\tasync loadTex0(texturesPaths, device) {\r\n\t\treturn new Promise(async (resolve) => {\r\n\t\t\tconst response = await fetch(texturesPaths[0]);\r\n\t\t\tconst imageBitmap = await createImageBitmap(await response.blob());\r\n\t\t\tconsole.log('WHAT IS THIS ', this)\r\n\t\t\tthis.texture0 = device.createTexture({\r\n\t\t\t\tsize: [imageBitmap.width, imageBitmap.height, 1],\r\n\t\t\t\tformat: 'rgba8unorm',\r\n\t\t\t\tusage:\r\n\t\t\t\t\tGPUTextureUsage.TEXTURE_BINDING |\r\n\t\t\t\t\tGPUTextureUsage.COPY_DST |\r\n\t\t\t\t\tGPUTextureUsage.RENDER_ATTACHMENT,\r\n\t\t\t});\r\n\t\t\tvar texture0 = this.texture0\r\n\t\t\tdevice.queue.copyExternalImageToTexture(\r\n\t\t\t\t{source: imageBitmap},\r\n\t\t\t\t{texture: texture0},\r\n\t\t\t\t[imageBitmap.width, imageBitmap.height]\r\n\t\t\t);\r\n\t\t\tresolve()\r\n\t\t})\r\n\r\n\t}\r\n\r\n\r\n\t// Render bundles function as partial, limited render passes, so we can use the\r\n\t// same code both to render the scene normally and to build the render bundle.\r\n\trenderScene(passEncoder) {\r\n\r\n\t\tif(typeof this.renderables === 'undefined') return;\r\n\t\tpassEncoder.setPipeline(this.pipeline);\r\n\t\tpassEncoder.setBindGroup(0, this.frameBindGroup);\r\n\r\n\t\t// Loop through every renderable object and draw them individually.\r\n\t\t// (Because many of these meshes are repeated, with only the transforms\r\n\t\t// differing, instancing would be highly effective here. This sample\r\n\t\t// intentionally avoids using instancing in order to emulate a more complex\r\n\t\t// scene, which helps demonstrate the potential time savings a render bundle\r\n\t\t// can provide.)\r\n\t\tlet count = 0;\r\n\t\tfor(const renderable of this.renderables) {\r\n\t\t\tpassEncoder.setBindGroup(1, renderable.bindGroup);\r\n\t\t\tpassEncoder.setVertexBuffer(0, renderable.vertices);\r\n\t\t\tpassEncoder.setIndexBuffer(renderable.indices, 'uint16');\r\n\t\t\tpassEncoder.drawIndexed(renderable.indexCount);\r\n\t\t\tif(++count > this.settings.asteroidCount) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcreateCubeVertices(options) {\r\n\t\tif(typeof options === 'undefined') {\r\n\t\t\tvar options = {\r\n\t\t\t\tscale: 1,\r\n\t\t\t\tuseUVShema4x2: false\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(typeof options.scale === 'undefined') options.scale = 1;\r\n\r\n\t\tlet vertices;\r\n\t\tif(options.useUVShema4x2 == true) {\r\n\t\t\tvertices = new Float32Array([\r\n\t\t\t\t//  position   |  texture coordinate\r\n\t\t\t\t//-------------+----------------------\r\n\t\t\t\t// front face     select the top left image  1, 0.5,   \r\n\t\t\t\t-1, 1, 1, 1, 0, 0, 0, 0,\r\n\t\t\t\t-1, -1, 1, 1, 0, 0, 0, 0.5,\r\n\t\t\t\t1, 1, 1, 1, 0, 0, 0.25, 0,\r\n\t\t\t\t1, -1, 1, 1, 0, 0, 0.25, 0.5,\r\n\t\t\t\t// right face     select the top middle image\r\n\t\t\t\t1, 1, -1, 1, 0, 0, 0.25, 0,\r\n\t\t\t\t1, 1, 1, 1, 0, 0, 0.5, 0,\r\n\t\t\t\t1, -1, -1, 1, 0, 0, 0.25, 0.5,\r\n\t\t\t\t1, -1, 1, 1, 0, 0, 0.5, 0.5,\r\n\t\t\t\t// back face      select to top right image\r\n\t\t\t\t1, 1, -1, 1, 0, 0, 0.5, 0,\r\n\t\t\t\t1, -1, -1, 1, 0, 0, 0.5, 0.5,\r\n\t\t\t\t-1, 1, -1, 1, 0, 0, 0.75, 0,\r\n\t\t\t\t-1, -1, -1, 1, 0, 0, 0.75, 0.5,\r\n\t\t\t\t// left face       select the bottom left image\r\n\t\t\t\t-1, 1, 1, 1, 0, 0, 0, 0.5,\r\n\t\t\t\t-1, 1, -1, 1, 0, 0, 0.25, 0.5,\r\n\t\t\t\t-1, -1, 1, 1, 0, 0, 0, 1,\r\n\t\t\t\t-1, -1, -1, 1, 0, 0, 0.25, 1,\r\n\t\t\t\t// bottom face     select the bottom middle image\r\n\t\t\t\t1, -1, 1, 1, 0, 0, 0.25, 0.5,\r\n\t\t\t\t-1, -1, 1, 1, 0, 0, 0.5, 0.5,\r\n\t\t\t\t1, -1, -1, 1, 0, 0, 0.25, 1,\r\n\t\t\t\t-1, -1, -1, 1, 0, 0, 0.5, 1,\r\n\t\t\t\t// top face        select the bottom right image\r\n\t\t\t\t-1, 1, 1, 1, 0, 0, 0.5, 0.5,\r\n\t\t\t\t1, 1, 1, 1, 0, 0, 0.75, 0.5,\r\n\t\t\t\t-1, 1, -1, 1, 0, 0, 0.5, 1,\r\n\t\t\t\t1, 1, -1, 1, 0, 0, 0.75, 1,\r\n\t\t\t]);\r\n\t\t} else {\r\n\t\t\tvertices = new Float32Array([\r\n\t\t\t\t//  position                                                   |  texture coordinate\r\n\t\t\t\t//-------------                                              +----------------------\r\n\t\t\t\t// front face     select the top left image  1, 0.5,   \r\n\t\t\t\t-1 * options.scale, 1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 0,\r\n\t\t\t\t-1 * options.scale, -1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 1,\r\n\t\t\t\t1 * options.scale, 1 * options.scale, 1 * options.scale, 1, 0, 0, 1, 0,\r\n\t\t\t\t1 * options.scale, -1 * options.scale, 1 * options.scale, 1, 0, 0, 1, 1,\r\n\t\t\t\t// right face     select the top middle image\r\n\t\t\t\t1 * options.scale, 1 * options.scale, -1 * options.scale, 1, 0, 0, 0, 0,\r\n\t\t\t\t1 * options.scale, 1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 1,\r\n\t\t\t\t1 * options.scale, -1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 0,\r\n\t\t\t\t1 * options.scale, -1 * options.scale, 1 * options.scale, 1, 0, 0, 1, 1,\r\n\t\t\t\t// back face      select to top right image\r\n\t\t\t\t1 * options.scale, 1 * options.scale, -1 * options.scale, 1, 0, 0, 0, 0,\r\n\t\t\t\t1 * options.scale, -1 * options.scale, -1 * options.scale, 1, 0, 0, 0, 1,\r\n\t\t\t\t-1 * options.scale, 1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 0,\r\n\t\t\t\t-1 * options.scale, -1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 1,\r\n\t\t\t\t// left face       select the bottom left image\r\n\t\t\t\t-1 * options.scale, 1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 0,\r\n\t\t\t\t-1 * options.scale, 1 * options.scale, -1 * options.scale, 1, 0, 0, 0, 1,\r\n\t\t\t\t-1 * options.scale, -1 * options.scale, 1 * options.scale, 1, 0, 0, 1, 0,\r\n\t\t\t\t-1 * options.scale, -1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 1,\r\n\t\t\t\t// bottom face     select the bottom middle image\r\n\t\t\t\t1 * options.scale, -1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 0,\r\n\t\t\t\t-1 * options.scale, -1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 1,\r\n\t\t\t\t1 * options.scale, -1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 0,\r\n\t\t\t\t-1 * options.scale, -1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 1,\r\n\t\t\t\t// top face        select the bottom right image\r\n\t\t\t\t-1 * options.scale, 1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 0,\r\n\t\t\t\t1 * options.scale, 1 * options.scale, 1 * options.scale, 1, 0, 0, 0, 1,\r\n\t\t\t\t-1 * options.scale, 1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 0,\r\n\t\t\t\t1 * options.scale, 1 * options.scale, -1 * options.scale, 1, 0, 0, 1, 1,\r\n\t\t\t])\r\n\t\t}\r\n\r\n\r\n\t\tconst indices = new Uint16Array([\r\n\t\t\t0, 1, 2, 2, 1, 3,  // front\r\n\t\t\t4, 5, 6, 6, 5, 7,  // right\r\n\t\t\t8, 9, 10, 10, 9, 11,  // back\r\n\t\t\t12, 13, 14, 14, 13, 15,  // left\r\n\t\t\t16, 17, 18, 18, 17, 19,  // bottom\r\n\t\t\t20, 21, 22, 22, 21, 23,  // top\r\n\t\t]);\r\n\r\n\t\treturn {\r\n\t\t\tvertices,\r\n\t\t\tindices,\r\n\t\t\tnumVertices: indices.length,\r\n\t\t};\r\n\t}\r\n\r\n\tdraw = () => {\r\n\t\tif(this.moonTexture == null) {\r\n\t\t\t// console.log('not ready')\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst transformationMatrix = this.getTransformationMatrix(this.position);\r\n\t\tthis.device.queue.writeBuffer(\r\n\t\t\tthis.uniformBuffer,\r\n\t\t\t0,\r\n\t\t\ttransformationMatrix.buffer,\r\n\t\t\ttransformationMatrix.byteOffset,\r\n\t\t\ttransformationMatrix.byteLength\r\n\t\t);\r\n\t\tthis.renderPassDescriptor.colorAttachments[0].view = this.context\r\n\t\t\t.getCurrentTexture()\r\n\t\t\t.createView();\r\n\t}\r\n}", "export let vertexWGSL = `const MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n\r\nstruct VertexOutput {\r\n  @location(0) shadowPos: vec4f,\r\n  @location(1) fragPos: vec3f,\r\n  @location(2) fragNorm: vec3f,\r\n  @location(3) uv: vec2f,\r\n  @builtin(position) Position: vec4f,\r\n}\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @location(1) normal: vec3f,\r\n  @location(2) uv: vec2f,\r\n  @location(3) joints: vec4<u32>,\r\n  @location(4) weights: vec4<f32>\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  var pos = vec4(position, 1.0);\r\n  var nrm = normal;\r\n  let skinned = skinVertex(pos, nrm, joints, weights);\r\n  let worldPos = model.modelMatrix * skinned.position;\r\n  let normalMatrix = mat3x3f(\r\n    model.modelMatrix[0].xyz,\r\n    model.modelMatrix[1].xyz,\r\n    model.modelMatrix[2].xyz\r\n  );\r\n  output.Position = scene.cameraViewProjMatrix * worldPos;\r\n  output.fragPos = worldPos.xyz;\r\n  output.shadowPos = scene.lightViewProjMatrix * worldPos;\r\n  output.fragNorm = normalize(normalMatrix * skinned.normal);\r\n  output.uv = uv;\r\n  return output;\r\n}`;", "export let fragmentWGSL = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\n// RPG or any other usage [selected obj effect]\r\n@group(2) @binding(0) var<uniform> uSelected : f32;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n    return material.baseColor * light.color * light.intensity * NdotL;\r\n    // return material.baseColor * light.color * light.intensity * NdotL;\r\n}\r\n\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    // coneAtten = 1.0;\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    // return (diffuse + specular) * radiance * NdotL * coneAtten;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    var finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    let fresnel = pow(1.0 - max(dot(N, V), 0.0), 3.0);\r\n\r\n    if (uSelected > 0.5) {\r\n        let glowColor = vec3f(0.2, 0.8, 1.0);\r\n        finalColor += glowColor * fresnel * 0.1;\r\n    }\r\n\r\n    return vec4f(finalColor, 1.0);\r\n}`;", "export let fragmentWGSLMetal = `override shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    // let metallic = mrTex.b * material.metallicFactor;\r\n    // let roughness = mrTex.g * material.roughnessFactor;\r\n    let metallic = material.metallicFactor;\r\n    let roughness = material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\n// PCF shadow sampling\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(shadowMapArray, shadowSampler, shadowUV + offsets[i] * oneOverSize, layer, depthRef - bias);\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let materialData = getPBRMaterial(input.uv);\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n   var Lo = vec3f(0.0);\r\n  for(var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n    let L = normalize(spotlights[i].position - input.fragPos);\r\n    let H = normalize(V + L);\r\n    let distance = length(spotlights[i].position - input.fragPos);\r\n    let attenuation = clamp(1.0 - (distance / spotlights[i].range), 0.0, 1.0);\r\n\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let radiance = spotlights[i].color * spotlights[i].intensity * attenuation;\r\n\r\n    let NDF = distributionGGX(N, H, materialData.roughness);\r\n    let G   = geometrySmith(N, V, L, materialData.roughness);\r\n    let F0 = mix(vec3f(0.04), materialData.baseColor, materialData.metallic);\r\n    let F  = fresnelSchlick(max(dot(H, V), 0.0), F0);\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - materialData.metallic);\r\n\r\n    let diffuse  = kD * materialData.baseColor / PI;\r\n    let specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\r\n\r\n    // Combine diffuse + specular and multiply by NdotL and radiance\r\n    Lo += (diffuse + specular) * radiance * NdotL;\r\n}\r\n\r\nlet ambient = scene.globalAmbient * materialData.baseColor;\r\nvar color = ambient + Lo;\r\nreturn vec4f(color, 1.0);\r\n}\r\n`;\r\n\r\n\r\n// let N = normalize(input.fragNorm);\r\n// let L = normalize(spotlights[0].position - input.fragPos);\r\n// let NdotL = max(dot(N,L),0.0);\r\n// let radiance = spotlights[0].color * 10.0; // test high intensity\r\n// Lo += materialData.baseColor * radiance * NdotL;", "export let fragmentWGSLNormalMap = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n// PBR normalmap\r\n@group(0) @binding(9) var normalTex: texture_2d<f32>;\r\n@group(0) @binding(10) var normalSampler: sampler;\r\n\r\nstruct FragmentInput {\r\n  @location(0) shadowPos : vec4f,\r\n  @location(1) fragPos   : vec3f,\r\n  @location(2) fragNorm  : vec3f,\r\n  @location(3) uv        : vec2f,\r\n  @location(4) tangent   : vec4f, // new\r\n};\r\n\r\nfn getNormalMap(uv: vec2f, N: vec3f) -> vec3f {\r\n    // Sample normal map\r\n    let nSample = textureSample(normalTex, normalSampler, uv).rgb;\r\n    // Convert from [0,1] \u2192 [-1,1]\r\n    let nTangent = nSample * 2.0 - vec3f(1.0);\r\n    \r\n    // TODO: if you have TBN matrix, convert tangent-space \u2192 world-space\r\n    // For now, assume fragNorm is already aligned (simple approx)\r\n    return normalize(nTangent);\r\n}\r\n\r\nfn getNormalMap2(uv: vec2f, N: vec3f, T: vec3f, B: vec3f) -> vec3f {\r\n    let nSample = textureSample(normalTex, normalSampler, uv).rgb;\r\n    let nTangent = nSample * 2.0 - vec3f(1.0);\r\n    let worldNormal = normalize(T * nTangent.x + B * nTangent.y + N * nTangent.z);\r\n    return worldNormal;\r\n}\r\n    \r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n    return material.baseColor * light.color * light.intensity * NdotL;\r\n    // return material.baseColor * light.color * light.intensity * NdotL;\r\n}\r\n\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    // coneAtten = 1.0;\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    // return (diffuse + specular) * radiance * NdotL * coneAtten;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    // let norm = normalize(input.fragNorm);\r\n    let N = normalize(input.fragNorm);\r\n    let T = normalize(input.tangent.xyz);\r\n    let B = cross(N, T) * input.tangent.w; // handedness\r\n    let norm = getNormalMap2(input.uv, N, T, B);\r\n\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    let finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n    return vec4f(finalColor, 1.0);\r\n}`;", "export let fragmentWGSLPong = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    let coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n    if (coneAtten <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    // --- diffuse controlled by metallic ---\r\n    let kD = 1.0 - material.metallic;  // 1.0 \u2192 full diffuse, 0.0 \u2192 fully metallic\r\n    let lambert = kD * material.baseColor * light.color * light.intensity * NdotL;\r\n\r\n    // --- simple specular controlled by roughness ---\r\n    let H = normalize(L + V);\r\n    let shininess = mix(2.0, 128.0, 1.0 - material.roughness); // map roughness \u2192 exponent\r\n    let spec = pow(max(dot(N, H), 0.0), shininess);\r\n    let specular = light.color * spec * material.metallic; // only strong if metallic > 0\r\n\r\n    return (lambert + specular) * coneAtten;\r\n}\r\n// Debug hybrid spotlight\r\nfn computeSpotLight3(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    let coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    if (coneAtten <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    // ---- baseline lambert ----\r\n    let lambert = material.baseColor * light.color * light.intensity * NdotL;\r\n\r\n    // ---- add a bit of specular safely ----\r\n    let H = normalize(L + V);\r\n    let spec = pow(max(dot(N, H), 0.0), 32.0); // simple Blinn-Phong\r\n    let specular = light.color * spec * 0.2;   // scaled so it doesn\u2019t kill diffuse\r\n\r\n    // final mix\r\n    return (lambert + specular) * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight2(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    let finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n    return vec4f(finalColor, 1.0);\r\n}`;", "export let fragmentWGSLPower = `override shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\n// PCF shadow sampling\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(shadowMapArray, shadowSampler, shadowUV + offsets[i] * oneOverSize, layer, depthRef - bias);\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let materialData = getPBRMaterial(input.uv);\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    var Lo = vec3f(0.0);\r\n    for(var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let L = normalize(spotlights[i].position - input.fragPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(spotlights[i].position - input.fragPos);\r\n        let attenuation = clamp(1.0 - (distance / spotlights[i].range), 0.0, 1.0);\r\n        let radiance = spotlights[i].color * spotlights[i].intensity * attenuation;\r\n        let NDF = distributionGGX(N, H, materialData.roughness);\r\n        let G   = geometrySmith(N, V, L, materialData.roughness);\r\n        let F0 = mix(vec3f(0.04), materialData.baseColor, materialData.metallic);\r\n        let F  = fresnelSchlick(max(dot(H, V), 0.0), F0);\r\n        let kS = F;\r\n        let kD = (vec3f(1.0) - kS) * (1.0 - materialData.metallic);\r\n        let diffuse  = kD * materialData.baseColor / PI; // Lambertian diffuse // ??\r\n        let NdotL = max(dot(N, L), 0.0);\r\n        let specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\r\n        Lo += NdotL * spotlights[i].color * spotlights[i].intensity;\r\n    }\r\n    let ambient = scene.globalAmbient * materialData.baseColor;\r\n    var color = ambient + Lo;\r\n    return vec4f(color, 1.0);\r\n}\r\n`;\r\n\r\n\r\n// let N = normalize(input.fragNorm);\r\n// let L = normalize(spotlights[0].position - input.fragPos);\r\n// let NdotL = max(dot(N,L),0.0);\r\n// let radiance = spotlights[0].color * 10.0; // test high intensity\r\n// Lo += materialData.baseColor * radiance * NdotL;", "import {fragmentWGSL} from \"../shaders/fragment.wgsl\";\r\nimport {fragmentWGSLMetal} from \"../shaders/fragment.wgsl.metal\";\r\nimport {fragmentWGSLNormalMap} from \"../shaders/fragment.wgsl.normalmap\";\r\nimport {fragmentWGSLPong} from \"../shaders/fragment.wgsl.pong\";\r\nimport {fragmentWGSLPower} from \"../shaders/fragment.wgsl.power\";\r\n\r\n/**\r\n * @description\r\n * Created for matrix-engine-wgpu project. MeshObj class estends Materials.\r\n * @variable material is engine meta data variable not real material object.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n */\r\nexport default class Materials {\r\n  constructor(device, material, glb) {\r\n    this.device = device;\r\n    this.glb = glb;\r\n    this.material = material;\r\n    this.isVideo = false;\r\n    this.videoIsReady = 'NONE';\r\n    this.compareSampler = this.device.createSampler({\r\n      compare: 'less-equal',           // safer for shadow comparison\r\n      addressModeU: 'clamp-to-edge',   // prevents UV leaking outside\r\n      addressModeV: 'clamp-to-edge',\r\n      magFilter: 'linear',             // smooth PCF\r\n      minFilter: 'linear',\r\n    });\r\n    // For image textures (standard sampler)\r\n    this.imageSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // For external video textures (needs to be filtering sampler too!)\r\n    this.videoSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // FX effect\r\n    this.postFXModeBuffer = this.device.createBuffer({\r\n      size: 4, // u32 = 4 bytes\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dymmy buffer\r\n    this.dummySpotlightUniformBuffer = this.device.createBuffer({\r\n      size: 80, // Must match size in shader\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.device.queue.writeBuffer(this.dummySpotlightUniformBuffer, 0, new Float32Array(20));\r\n    // Create a 1x1 RGBA texture filled with white\r\n    const mrDummyTex = this.device.createTexture({\r\n      size: [1, 1, 1],\r\n      format: this.getFormat(),\r\n      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n    });\r\n    // Upload a single pixel\r\n    const pixel = new Uint8Array([255, 255, 255, 255]); // white RGBA\r\n    this.device.queue.writeTexture(\r\n      {texture: mrDummyTex},\r\n      pixel,\r\n      {bytesPerRow: 4},\r\n      [1, 1, 1]\r\n    );\r\n    this.metallicRoughnessTextureView = mrDummyTex.createView();\r\n    this.metallicRoughnessSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // 4 floats for baseColorFactor + 1 metallic + 1 roughness + 2 pad floats = 8 floats\r\n    const materialPBRSize = 8 * 4; // 32 bytes\r\n    this.materialPBRBuffer = this.device.createBuffer({\r\n      size: materialPBRSize,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dummy values\r\n    const baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    const metallicFactor = 0.1;    // diffuse like plastic\r\n    const roughnessFactor = 0.5;   // some gloss\r\n    const pad = [0.0, 0.0];\r\n    // Pack into Float32Array\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      ...pad\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n\r\n    if(this.material.type == 'normalmap') {\r\n      const normalTexInfo = this.glb.glbJsonData.materials[0].normalTexture;\r\n      if(normalTexInfo) {\r\n        const tex = this.glb.glbJsonData.glbTextures[normalTexInfo.index];\r\n        this.normalTextureView = tex.createView();\r\n        this.normalSampler = this.device.createSampler({\r\n          magFilter: 'linear',\r\n          minFilter: 'linear',\r\n        });\r\n      } else {\r\n        // console.log('>>>ERRR >>>normalTexture>>')\r\n      }\r\n    } else {\r\n      // console.log('>DUMMY>normalTexture>')\r\n      // dummy for normal map 1x1 neutral normal map\r\n      this.normalDummyTex = device.createTexture({\r\n        size: [1, 1, 1],\r\n        format: 'rgba8unorm',\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n      });\r\n      // RGBA value for neutral normal in tangent space\r\n      const neutralNormal = new Uint8Array([128, 128, 255, 255]);\r\n      this.device.queue.writeTexture(\r\n        {texture: this.normalDummyTex},\r\n        neutralNormal,\r\n        {bytesPerRow: 4},\r\n        [1, 1, 1]\r\n      );\r\n      // Create texture view & sampler\r\n      this.normalTextureView = this.normalDummyTex.createView();\r\n      this.normalSampler = this.device.createSampler({\r\n        magFilter: 'linear',\r\n        minFilter: 'linear',\r\n      });\r\n    }\r\n  }\r\n\r\n  getMaterial() {\r\n    // console.log('Material TYPE:', this.material.type);\r\n    if(this.material.type == 'standard') {\r\n      return fragmentWGSL;\r\n    } else if(this.material.type == 'pong') {\r\n      return fragmentWGSLPong;\r\n    } else if(this.material.type == 'power') {\r\n      return fragmentWGSLPower;\r\n    } else if(this.material.type == 'metal') {\r\n      return fragmentWGSLMetal;\r\n    } else if(this.material.type == 'normalmap') {\r\n      return fragmentWGSLNormalMap;\r\n    }\r\n    console.warn('Unknown material type:', this.material?.type);\r\n    return fragmentWGSL; // fallback\r\n  }\r\n\r\n  getFormat() {\r\n    if(this.material?.format == 'darker') {\r\n      return 'rgba8unorm-srgb';\r\n    } else if(this.material?.format == 'normal') {\r\n      return 'rgba8unorm';\r\n    } else {\r\n      return 'rgba8unorm';\r\n    }\r\n  }\r\n  // not affect all fs\r\n  setupMaterialPBR(metallicFactor) {\r\n    const baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    const roughnessFactor = 0.5;   // some gloss\r\n    const pad = [0.0, 0.0];\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      ...pad\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n  }\r\n\r\n  updatePostFXMode(mode) {\r\n    const arrayBuffer = new Uint32Array([mode]);\r\n    this.device.queue.writeBuffer(this.postFXModeBuffer, 0, arrayBuffer);\r\n  }\r\n\r\n  async loadTex0(texturesPaths) {\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    return new Promise(async (resolve) => {\r\n      const response = await fetch(texturesPaths[0]);\r\n      const imageBitmap = await createImageBitmap(await response.blob());\r\n      this.texture0 = this.device.createTexture({\r\n        size: [imageBitmap.width, imageBitmap.height, 1], // REMOVED 1\r\n        format: this.getFormat(),\r\n        usage:\r\n          GPUTextureUsage.TEXTURE_BINDING |\r\n          GPUTextureUsage.COPY_DST |\r\n          GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: imageBitmap},\r\n        {texture: this.texture0},\r\n        [imageBitmap.width, imageBitmap.height]\r\n      );\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  async loadVideoTexture(arg) {\r\n    this.videoIsReady = 'MAYBE';\r\n    if(arg.type === 'video') {\r\n      this.video = document.createElement('video');\r\n      this.video.src = arg.src || 'res/videos/tunel.mp4';\r\n      this.video.crossOrigin = 'anonymous';\r\n      this.video.autoplay = true;\r\n      this.video.loop = true;\r\n      document.body.append(this.video);\r\n      this.video.style.display = 'none';\r\n      this.video.style.position = 'absolute';\r\n      this.video.style.top = '750px';\r\n      this.video.style.left = '50px';\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'videoElement') {\r\n      this.video = arg.el;\r\n      await this.video.play();\r\n    } else if(arg.type === 'camera') {\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      try {\r\n        const stream = await (navigator.mediaDevices?.getUserMedia?.({\r\n          video: {\r\n            width: {ideal: 1280},\r\n            height: {ideal: 720},\r\n          },\r\n          audio: false\r\n        }));\r\n        this.video.srcObject = stream;\r\n        await this.video.play();\r\n        this.isVideo = true;\r\n      } catch(err) {\r\n        console.error(\"\u274C Failed to access camera:\", err);\r\n        return;\r\n      }\r\n    } else if(arg.type === 'canvas2d') {\r\n      // Existing canvas (arg.el) \u2014 assume it's actively drawing\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      const stream = arg.el.captureStream?.() || arg.el.mozCaptureStream?.();\r\n      if(!stream) {console.error('\u274C Cannot capture stream from canvas2d'); return;}\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'canvas2d-inline') {\r\n      // Miniature inline-drawn canvas created dynamically\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = arg.width || 256;\r\n      canvas.height = arg.height || 256;\r\n      const ctx = canvas.getContext('2d');\r\n      if(typeof arg.canvaInlineProgram === 'function') {\r\n        // Start drawing loop\r\n        const drawLoop = () => {\r\n          arg.canvaInlineProgram(ctx, canvas);\r\n          requestAnimationFrame(drawLoop);\r\n        };\r\n        drawLoop();\r\n      }\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      this.isVideo = true;\r\n      const stream = canvas.captureStream?.() || canvas.mozCaptureStream?.();\r\n      if(!stream) {\r\n        console.error('\u274C Cannot capture stream from inline canvas');\r\n        return;\r\n      }\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n    }\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // \u2705 Now - maybe noT\r\n    this.createLayoutForRender();\r\n  }\r\n\r\n  updateVideoTexture() {\r\n    if(!this.video || this.video.readyState < 2) return;\r\n    if(!this.externalTexture) {\r\n      // create it once\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n      this.videoIsReady = 'YES';\r\n      console.log(\"\u2705video bind.\");\r\n    } else {\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n    }\r\n  }\r\n\r\n  getMaterialTexture(glb, materialIndex) {\r\n    const matDef = glb.glbJsonData.materials[materialIndex];\r\n\r\n    if(!matDef) {\r\n      console.warn('[engine] no material in glb...');\r\n      return null;\r\n    }\r\n\r\n    if(matDef.pbrMetallicRoughness?.baseColorTexture) {\r\n      const texIndex = matDef.pbrMetallicRoughness.baseColorTexture.index;\r\n      return glb.glbJsonData.glbTextures[texIndex].createView();\r\n    }\r\n\r\n    return null;\r\n  }\r\n  getMaterialTextureFromMaterial(material) {\r\n    if(!material || !material.pbrMetallicRoughness) return this.fallbackTextureView;\r\n\r\n    const texInfo = material.pbrMetallicRoughness.baseColorTexture;\r\n    if(!texInfo) return this.fallbackTextureView;\r\n\r\n    const texIndex = texInfo.index;\r\n    return this.glb.glbTextures[texIndex].createView();\r\n  }\r\n\r\n  createBindGroupForRender() {\r\n    let textureResource = this.isVideo\r\n      ? this.externalTexture\r\n      : this.texture0.createView();\r\n    // console.log('TEST TEX this.texture0 ', this.texture0);\r\n    if(this.material.useTextureFromGlb === true) {\r\n      // 0 probably always for basicColor\r\n      const material = this.skinnedNode.mesh.primitives[0].material;\r\n      const textureView = material.baseColorTexture.imageView;\r\n      // const sampler = material.baseColorTexture.sampler;\r\n      textureResource = textureView;\r\n    }\r\n\r\n    if(!textureResource || !this.sceneUniformBuffer || !this.shadowDepthTextureView) {\r\n      if(!textureResource) console.warn(\"\u2757Missing res texture: \", textureResource);\r\n      if(!this.sceneUniformBuffer) console.warn(\"\u2757Missing res: this.sceneUniformBuffer: \", this.sceneUniformBuffer);\r\n      if(!this.shadowDepthTextureView) console.warn(\"\u2757Missing res: this.shadowDepthTextureView: \", this.shadowDepthTextureView);\r\n      if(typeof textureResource === 'undefined') {\r\n        this.updateVideoTexture();\r\n      }\r\n      return;\r\n    }\r\n    if(this.isVideo == true) {\r\n      // console.info(\"\u2705 video sceneBindGroupForRender\");\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        label: 'sceneBindGroupForRender [video]',\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.videoSampler, },\r\n          {binding: 5, resource: {buffer: this.postFXModeBuffer}}\r\n        ],\r\n      });\r\n      // Special case for video maybe better solution exist\r\n      if(this.video.paused == true) this.video.play();\r\n    } else {\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        label: 'sceneBindGroupForRender [mesh][materials]',\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.imageSampler, },\r\n          {binding: 5, resource: {buffer: !this.spotlightUniformBuffer ? this.dummySpotlightUniformBuffer : this.spotlightUniformBuffer}, },\r\n          {binding: 6, resource: this.metallicRoughnessTextureView},\r\n          {binding: 7, resource: this.metallicRoughnessSampler},\r\n          {binding: 8, resource: {buffer: this.materialPBRBuffer}},\r\n          // NEW: dummy normal map\r\n          {binding: 9, resource: this.normalTextureView},\r\n          {binding: 10, resource: this.normalSampler},\r\n        ],\r\n      });\r\n    }\r\n  }\r\n\r\n  createLayoutForRender() {\r\n    let e = [\r\n      {\r\n        binding: 0,\r\n        visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\r\n        buffer: {type: 'uniform'},\r\n      },\r\n      ...(this.isVideo == false\r\n        ? [\r\n          {\r\n            binding: 1,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: \"depth\",\r\n              viewDimension: \"2d-array\", // <- must match shadowMapArray\r\n              multisampled: false,\r\n            },\r\n          },\r\n        ] : [{\r\n          binding: 1,\r\n          visibility: GPUShaderStage.FRAGMENT,\r\n          texture: {\r\n            sampleType: \"depth\",\r\n            viewDimension: \"2d\",\r\n          },\r\n        },])\r\n      , {\r\n        binding: 2,\r\n        visibility: GPUShaderStage.FRAGMENT,\r\n        sampler: {type: 'comparison'},\r\n      },\r\n      ...(this.isVideo\r\n        ? [ // VIDEO\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            externalTexture: {},\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}, // for video sampling\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          }\r\n        ]\r\n        : [ // IMAGE\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d',\r\n            },\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'},\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          },\r\n          {\r\n            binding: 6,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d'\r\n            }\r\n          },\r\n          {\r\n            binding: 7,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          },\r\n          {\r\n            binding: 8,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'}\r\n          },\r\n          {\r\n            binding: 9,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {sampleType: 'float', viewDimension: '2d'},\r\n          },\r\n          {\r\n            binding: 10,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          }\r\n        ])\r\n    ];\r\n    // console.log(\"BG E :  is used normal  \", this.material.type)\r\n    this.bglForRender = this.device.createBindGroupLayout({label: 'bglForRender', entries: e, });\r\n  }\r\n}", "export let fragmentVideoWGSL = `override shadowDepthTextureSize: f32 = 1024.0;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix : mat4x4f,\r\n  cameraViewProjMatrix : mat4x4f,\r\n  lightPos : vec3f,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMap: texture_depth_2d;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_external;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> postFXMode: u32;\r\n\r\n// \u274C No binding(4) here!\r\n\r\nstruct FragmentInput {\r\n  @location(0) shadowPos : vec4f,\r\n  @location(1) fragPos : vec3f,\r\n  @location(2) fragNorm : vec3f,\r\n  @location(3) uv : vec2f,\r\n}\r\n\r\nconst albedo = vec3f(0.9);\r\nconst ambientFactor = 0.7;\r\n\r\n@fragment\r\nfn main(input : FragmentInput) -> @location(0) vec4f {\r\n  // Shadow filtering\r\n  var visibility = 0.0;\r\n  let oneOverShadowDepthTextureSize = 1.0 / shadowDepthTextureSize;\r\n  for (var y = -1; y <= 1; y++) {\r\n    for (var x = -1; x <= 1; x++) {\r\n      let offset = vec2f(vec2(x, y)) * oneOverShadowDepthTextureSize;\r\n      visibility += textureSampleCompare(\r\n        shadowMap, shadowSampler,\r\n        input.shadowPos.xy + offset, input.shadowPos.z - 0.007\r\n      );\r\n    }\r\n  }\r\n  visibility /= 9.0;\r\n\r\n  let lambertFactor = max(dot(normalize(scene.lightPos - input.fragPos), normalize(input.fragNorm)), 0.0);\r\n  let lightingFactor = min(ambientFactor + visibility * lambertFactor, 1.0);\r\n\r\n  // \u2705 Correct way to sample video texture\r\n  let textureColor = textureSampleBaseClampToEdge(meshTexture, meshSampler, input.uv);\r\n  let color: vec4f = vec4(textureColor.rgb * lightingFactor * albedo, 1.0);\r\n\r\n   switch (postFXMode) {\r\n    case 0: {\r\n      // Default\r\n      return color;\r\n    }\r\n    case 1: {\r\n      // Invert\r\n      return vec4f(1.0 - color.rgb, color.a);\r\n    }\r\n    case 2: {\r\n      // Grayscale\r\n      let gray = dot(color.rgb, vec3f(0.299, 0.587, 0.114));\r\n      return vec4f(vec3f(gray), color.a);\r\n    }\r\n    case 3: {\r\n      // Chroma Key\r\n      let keyColor = vec3f(0.0, 1.0, 0.0);\r\n      let threshold = 0.3;\r\n      let diff = distance(color.rgb, keyColor);\r\n      if (diff < threshold) {\r\n        return vec4f(0.0, 0.0, 0.0, 0.0);\r\n      }\r\n      return color;\r\n    }\r\n    default: {\r\n      return color;\r\n    }\r\n  }\r\n\r\n  // return color;\r\n}\r\n`;", "export let vertexWGSL_NM = `const MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n\r\nstruct VertexOutput {\r\n  @location(0) shadowPos: vec4f,\r\n  @location(1) fragPos: vec3f,\r\n  @location(2) fragNorm: vec3f,\r\n  @location(3) uv: vec2f,\r\n  @location(4) tangent: vec4f,      // NEW\r\n  @builtin(position) Position: vec4f,\r\n}\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @location(1) normal: vec3f,\r\n  @location(2) uv: vec2f,\r\n  @location(3) joints: vec4<u32>,\r\n  @location(4) weights: vec4<f32>,\r\n  @location(5) tangent: vec4f               // NEW\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  \r\n  // Skin positions & normals\r\n  var pos = vec4(position, 1.0);\r\n  var nrm = normal;\r\n  let skinned = skinVertex(pos, nrm, joints, weights);\r\n\r\n  // Skin tangent\r\n  var skinnedTangent = vec3f(tangent.xyz);\r\n  for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n      let jointIndex = joints[i];\r\n      let w = weights[i];\r\n      if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          let boneMat3 = mat3x3f(\r\n              boneMat[0].xyz,\r\n              boneMat[1].xyz,\r\n              boneMat[2].xyz\r\n          );\r\n          skinnedTangent += (boneMat3 * tangent.xyz) * w;\r\n      }\r\n  }\r\n\r\n  // Transform to world space\r\n  let worldPos = model.modelMatrix * skinned.position;\r\n  let normalMatrix = mat3x3f(\r\n      model.modelMatrix[0].xyz,\r\n      model.modelMatrix[1].xyz,\r\n      model.modelMatrix[2].xyz\r\n  );\r\n\r\n  output.Position = scene.cameraViewProjMatrix * worldPos;\r\n  output.fragPos = worldPos.xyz;\r\n  output.shadowPos = scene.lightViewProjMatrix * worldPos;\r\n  output.fragNorm = normalize(normalMatrix * skinned.normal);\r\n  output.uv = uv;\r\n  output.tangent = vec4(normalize(skinnedTangent), tangent.w);  // OUTPUT tangent\r\n\r\n  return output;\r\n}`;", "export const pointerEffect = `\r\nstruct Camera {\r\n  viewProjMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct Model {\r\n  modelMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(1) var<uniform> model : Model;\r\n\r\nstruct VertexInput {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) v_uv : vec2<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VertexInput) -> VSOut {\r\n  var out : VSOut;\r\n  let worldPos = model.modelMatrix * vec4<f32>(input.position,1.0);\r\n  out.Position = camera.viewProjMatrix * worldPos;\r\n  out.v_uv = input.uv;\r\n  return out;\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  // Center the UVs (0.0\u20131.0 \u2192 -1.0\u20131.0)\r\n  let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n\r\n  // Distance from center\r\n  let dist = length(uv);\r\n\r\n  // Glow falloff\r\n  let glow = exp(-dist * 1.0); // try values 3.0\u20136.0 for tighter glow\r\n\r\n  // Gradient color (inner bright \u2192 outer dim)\r\n  let baseColor = vec3<f32>(0.2, 0.7, 1.0);\r\n  let glowColor = vec3<f32>(0.7, 0.9, 1.0);\r\n\r\n  // Blend based on glow strength\r\n  let color = mix(baseColor, glowColor, glow) * glow;\r\n\r\n  return vec4<f32>(color, 1.0);\r\n}`;", "import {mat4} from \"wgpu-matrix\";\r\nimport {pointerEffect} from \"../../shaders/standalone/pointer.effect.js\";\r\n\r\nexport class PointerEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    // fiktive \r\n    this.enabled = true;\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Vertex data: simple quad\r\n    let S = 10;\r\n    const vertexData = new Float32Array([\r\n      -0.5 * S, 0.5 * S, 0.0 * S,  // top-left\r\n      0.5 * S, 0.5 * S, 0.0 * S,  // top-right\r\n      -0.1 * S, -0.1 * S, 0.0 * S,  // bottom-left\r\n      0.1 * S, -0.1 * S, 0.0 * S,  // bottom-right\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 0, 1, 0, 0, 1, 1, 1\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([\r\n      0, 2, 1,\r\n      1, 2, 3\r\n    ]);\r\n\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: pointerEffect});\r\n\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: true, depthCompare: 'always', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  draw(pass, cameraMatrix, modelMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, modelMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n      const objPos = mesh.position;\r\n      const modelMatrix = mat4.identity();\r\n      mat4.translate(modelMatrix, [objPos.x, objPos.y + 60, objPos.z], modelMatrix);\r\n      this.draw(transPass, viewProjMatrix, modelMatrix);\r\n  }\r\n}", "import {mat4, vec3} from 'wgpu-matrix';\r\nimport {Position, Rotation} from \"./matrix-class\";\r\nimport {vertexWGSL} from '../shaders/vertex.wgsl';\r\nimport {degToRad, genName, LOG_FUNNY_SMALL} from './utils';\r\nimport Materials from './materials';\r\nimport {fragmentVideoWGSL} from '../shaders/fragment.video.wgsl';\r\nimport {vertexWGSL_NM} from '../shaders/vertex.wgsl.normalmap';\r\nimport {PointerEffect} from './effects/pointerEffect';\r\n\r\nexport default class MEMeshObj extends Materials {\r\n  constructor(canvas, device, context, o, inputHandler, globalAmbient, _glbFile = null, primitiveIndex = null, skinnedNodeIndex = null) {\r\n    super(device, o.material, _glbFile);\r\n    if(typeof o.name === 'undefined') o.name = genName(3);\r\n    if(typeof o.raycast === 'undefined') {\r\n      this.raycast = {enabled: false, radius: 2};\r\n    } else {\r\n      this.raycast = o.raycast;\r\n    }\r\n\r\n    if(typeof o.pointerEffect === 'undefined') {this.pointerEffect = {enabled: false};}\r\n\r\n    this.name = o.name;\r\n    this.done = false;\r\n    this.canvas = canvas;\r\n    this.device = device;\r\n    this.context = context;\r\n    this.entityArgPass = o.entityArgPass;\r\n    this.clearColor = \"red\";\r\n    this.video = null;\r\n    this.FINISH_VIDIO_INIT = false;\r\n    this.globalAmbient = [...globalAmbient];\r\n    if(typeof o.material.useTextureFromGlb === 'undefined' ||\r\n      typeof o.material.useTextureFromGlb !== \"boolean\") {\r\n      o.material.useTextureFromGlb = false;\r\n    }\r\n    // console.log('Material class arg:', o.material)\r\n    this.material = o.material;\r\n\r\n    // Mesh stuff - for single mesh or t-posed (fiktive-first in loading order)\r\n    this.mesh = o.mesh;\r\n    if(_glbFile != null) {\r\n      if(typeof this.mesh == 'undefined') {\r\n        this.mesh = {};\r\n        this.mesh.feedFromRealGlb = true;\r\n      }\r\n      // V\r\n      const verView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].positions.view;\r\n      const byteOffsetV = verView.byteOffset || 0;\r\n      const byteLengthV = verView.buffer.byteLength;\r\n      const vertices = new Float32Array(\r\n        verView.buffer.buffer,\r\n        byteOffsetV,\r\n        byteLengthV / 4\r\n      );\r\n      this.mesh.vertices = vertices;\r\n      //N\r\n      const norView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].normals.view;\r\n      const normalsUint8 = norView.buffer;\r\n      const byteOffsetN = norView.byteOffset || 0; // if your loader provides it\r\n      const byteLengthN = normalsUint8.byteLength;\r\n      const normals = new Float32Array(\r\n        normalsUint8.buffer,\r\n        byteOffsetN,\r\n        byteLengthN / 4\r\n      );\r\n      this.mesh.vertexNormals = normals;\r\n      //UV\r\n      let accessor = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].texcoords[0];\r\n      const bufferView = accessor.view;\r\n      const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n      const count = accessor.count * 2; // VEC2 = 2 floats per vertex\r\n      const uvFloatArray = new Float32Array(bufferView.buffer.buffer, byteOffset, count);\r\n      this.mesh.uvs = uvFloatArray;\r\n      this.mesh.textures = uvFloatArray;\r\n      // I\r\n      let binaryI = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].indices;\r\n      const indicesView = binaryI.view;\r\n      const indicesUint8 = indicesView.buffer;\r\n      const byteOffsetI = indicesView.byteOffset || 0;\r\n      const byteLengthI = indicesUint8.byteLength;\r\n      // Decide on type from accessor.componentType\r\n      // (5121 = UNSIGNED_BYTE, 5123 = UNSIGNED_SHORT, 5125 = UNSIGNED_INT)\r\n      let indicesArray;\r\n      switch(binaryI.componentType) {\r\n        case 5121: // UNSIGNED_BYTE\r\n          indicesArray = new Uint8Array(indicesUint8.buffer, byteOffsetI, byteLengthI);\r\n          break;\r\n        case 5123: // UNSIGNED_SHORT\r\n          indicesArray = new Uint16Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 2);\r\n          break;\r\n        case 5125: // UNSIGNED_INT\r\n          indicesArray = new Uint32Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 4);\r\n          break;\r\n        default:\r\n          throw new Error(\"Unknown index componentType\");\r\n      }\r\n      this.mesh.indices = indicesArray;\r\n      // W\r\n      let weightsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].weights.view;\r\n      this.mesh.weightsView = weightsView;\r\n      let primitive = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex];\r\n      let finalRoundedWeights = this.getAccessorArray(_glbFile, primitive.weights.weightsAccessIndex);\r\n      const weightsArray = finalRoundedWeights;\r\n      // Normalize each group of 4\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const sum = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(sum > 0) {\r\n          const inv = 1 / sum;\r\n          weightsArray[i] *= inv;\r\n          weightsArray[i + 1] *= inv;\r\n          weightsArray[i + 2] *= inv;\r\n          weightsArray[i + 3] *= inv;\r\n        } else {\r\n          weightsArray[i] = 1; weightsArray[i + 1] = 0;\r\n          weightsArray[i + 2] = 0; weightsArray[i + 3] = 0;\r\n        }\r\n      }\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const s = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(Math.abs(s - 1.0) > 0.001) console.warn(\"Weight not normalized!\", i, s);\r\n      }\r\n      this.mesh.weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer real data\",\r\n        size: weightsArray.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(this.mesh.weightsBuffer.getMappedRange()).set(weightsArray);\r\n      this.mesh.weightsBuffer.unmap();\r\n      let jointsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].joints.view;\r\n      this.mesh.jointsView = jointsView;\r\n      // Create typed array from the buffer (Uint16Array or Uint8Array depending on GLB)\r\n      let jointsArray16 = new Uint16Array(\r\n        jointsView.buffer,\r\n        jointsView.byteOffset || 0,\r\n        jointsView.byteLength / 2 // in Uint16 elements\r\n      );\r\n      const jointsArray32 = new Uint32Array(jointsArray16.length);\r\n      for(let i = 0;i < jointsArray16.length;i++) {\r\n        jointsArray32[i] = jointsArray16[i];\r\n      }\r\n      // Create GPU buffer for joints\r\n      this.mesh.jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer[real-data]\",\r\n        size: jointsArray32.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      // Upload the data to GPU\r\n      new Uint32Array(this.mesh.jointsBuffer.getMappedRange()).set(jointsArray32);\r\n      this.mesh.jointsBuffer.unmap();\r\n\r\n      // TANGENTS\r\n      let tangentArray = null;\r\n      if(_glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents) {\r\n        const tangentView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents.view;\r\n        const byteOffsetT = tangentView.byteOffset || 0;\r\n        const byteLengthT = tangentView.buffer.byteLength;\r\n        tangentArray = new Float32Array(\r\n          tangentView.buffer,\r\n          byteOffsetT,\r\n          byteLengthT / 4\r\n        );\r\n        this.mesh.tangents = tangentArray;\r\n\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer[real-data]\",\r\n          size: tangentArray.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(tangentArray);\r\n        this.mesh.tangentsBuffer.unmap();\r\n      } else {\r\n        // \uD83D\uDFE2 dummy fallback\r\n        const dummyTangents = new Float32Array(this.mesh.vertices.length / 3 * 4);\r\n        for(let i = 0;i < dummyTangents.length;i += 4) {\r\n          dummyTangents[i + 0] = 1.0; // T = (1,0,0)\r\n          dummyTangents[i + 1] = 0.0;\r\n          dummyTangents[i + 2] = 0.0;\r\n          dummyTangents[i + 3] = 1.0; // handedness\r\n        }\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer dummy\",\r\n          size: dummyTangents.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(dummyTangents);\r\n        this.mesh.tangentsBuffer.unmap();\r\n        console.warn(\"GLTF primitive has no TANGENT attribute (normal map won\u2019t work properly).\");\r\n      }\r\n\r\n      // if(this.material.useTextureFromGlb == true) {\r\n      //   console.log('get glb images ', _glbFile.glbJsonData.materials);\r\n      //   _glbFile.glbJsonData.materials.forEach(material => {\r\n      //     console.log('get material :', material);\r\n      //   });\r\n\r\n      //   _glbFile.glbJsonData.images.forEach(imgGpuTexture => {\r\n      //     console.log('get images :', imgGpuTexture);\r\n      //   });\r\n\r\n\r\n      //   _glbFile.glbJsonData.glbTextures.forEach(glbTexture => {\r\n      //     console.log('get glbTextures :', glbTexture);\r\n      //   });\r\n      // }\r\n    } else {\r\n      // obj files flow\r\n      this.mesh.uvs = this.mesh.textures;\r\n    }\r\n    console.log(`%c Mesh loaded: ${o.name}`, LOG_FUNNY_SMALL);\r\n    // ObjSequence animation\r\n    if(typeof o.objAnim !== 'undefined' && o.objAnim != null) {\r\n      this.objAnim = o.objAnim;\r\n      for(var key in this.objAnim.animations) {\r\n        if(key != 'active') this.objAnim.animations[key].speedCounter = 0;\r\n      }\r\n      console.log(`%c Mesh objAnim exist: ${o.objAnim}`, LOG_FUNNY_SMALL);\r\n      this.drawElements = this.drawElementsAnim;\r\n    }\r\n    this.inputHandler = inputHandler;\r\n    this.cameras = o.cameras;\r\n    this.mainCameraParams = {\r\n      type: o.mainCameraParams.type,\r\n      responseCoef: o.mainCameraParams.responseCoef\r\n    };\r\n    this.lastFrameMS = 0;\r\n    this.texturesPaths = [];\r\n    o.texturesPaths.forEach((t) => {this.texturesPaths.push(t)})\r\n    this.presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n    this.position = new Position(o.position.x, o.position.y, o.position.z);\r\n    this.rotation = new Rotation(o.rotation.x, o.rotation.y, o.rotation.z);\r\n    this.rotation.rotationSpeed.x = o.rotationSpeed.x;\r\n    this.rotation.rotationSpeed.y = o.rotationSpeed.y;\r\n    this.rotation.rotationSpeed.z = o.rotationSpeed.z;\r\n    this.scale = o.scale;\r\n    // new dummy for skin mesh\r\n    if(!this.joints) {\r\n      const jointsData = new Uint32Array((this.mesh.vertices.length / 3) * 4);\r\n      const jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer\",\r\n        size: jointsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint32Array(jointsBuffer.getMappedRange()).set(jointsData);\r\n      jointsBuffer.unmap();\r\n      this.joints = {\r\n        data: jointsData,\r\n        buffer: jointsBuffer,\r\n        stride: 16, // vec4<u32>\r\n      };\r\n      const numVerts = this.mesh.vertices.length / 3;\r\n      // Weights data (vec4<f32>) \u2013 default all weight to bone 0\r\n      const weightsData = new Float32Array(numVerts * 4);\r\n      for(let i = 0;i < numVerts;i++) {\r\n        weightsData[i * 4 + 0] = 1.0; // 100% influence of bone 0\r\n        weightsData[i * 4 + 1] = 0.0;\r\n        weightsData[i * 4 + 2] = 0.0;\r\n        weightsData[i * 4 + 3] = 0.0;\r\n      }\r\n      // GPU buffer\r\n      const weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer dummy\",\r\n        size: weightsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(weightsBuffer.getMappedRange()).set(weightsData);\r\n      weightsBuffer.unmap();\r\n      this.weights = {\r\n        data: weightsData,\r\n        buffer: weightsBuffer,\r\n        stride: 16, // vec4<f32>\r\n      };\r\n    }\r\n\r\n    this.runProgram = () => {\r\n      return new Promise(async (resolve) => {\r\n        this.shadowDepthTextureSize = 1024;\r\n        this.modelViewProjectionMatrix = mat4.create();\r\n        this.loadTex0(this.texturesPaths).then(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    }\r\n\r\n    this.runProgram().then(() => {\r\n      this.context.configure({\r\n        device: this.device,\r\n        format: this.presentationFormat,\r\n        alphaMode: 'premultiplied',\r\n      });\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexBuffer.getMappedRange()).set(this.mesh.vertices);\r\n        this.vertexBuffer.unmap();\r\n      }\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexNormalsBuffer.getMappedRange()).set(this.mesh.vertexNormals);\r\n        this.vertexNormalsBuffer.unmap();\r\n      }\r\n\r\n      this.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: this.mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexTexCoordsBuffer.getMappedRange()).set(this.mesh.textures);\r\n        this.vertexTexCoordsBuffer.unmap();\r\n      }\r\n\r\n      // Create the model index buffer.\r\n      this.indexCount = this.mesh.indices.length;\r\n      const indexCount = this.mesh.indices.length;\r\n      const size = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n\r\n      this.indexBuffer = this.device.createBuffer({\r\n        size,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true\r\n      });\r\n\r\n      new Uint16Array(this.indexBuffer.getMappedRange()).set(this.mesh.indices);\r\n      this.indexBuffer.unmap();\r\n      this.indexCount = indexCount;\r\n      let glbInfo = {\r\n        arrayStride: 4 * 4, // vec4<f32> = 4 * 4 bytes\r\n        attributes: [{format: 'float32x4', offset: 0, shaderLocation: 4}]\r\n      }\r\n\r\n      let tang = null;\r\n\r\n\r\n      // if(this.mesh.feedFromRealGlb && this.mesh.feedFromRealGlb == true) {\r\n      //   // console.log('it is GLB ')\r\n      //   glbInfo = {\r\n      //     arrayStride: 4 * 4, // vec4<f32> = 4 * 4 bytes\r\n      //     attributes: [{format: 'float32x4', offset: 0, shaderLocation: 4}]\r\n      //   }\r\n      // } else {\r\n      //   // console.log('it is not  GLB ')\r\n      //   glbInfo = {\r\n      //     arrayStride: 4 * 4, // vec4<f32> = 4 * 4 bytes\r\n      //     attributes: [{format: 'float32x4', offset: 0, shaderLocation: 4}]\r\n      //   }\r\n      // }\r\n      // Create some common descriptors used for both the shadow pipeline\r\n      // and the color rendering pipeline.\r\n      this.vertexBuffers = [\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [\r\n            {\r\n              // position\r\n              shaderLocation: 0,\r\n              offset: 0,\r\n              format: \"float32x3\",\r\n            }\r\n          ],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [\r\n            {\r\n              // normal\r\n              shaderLocation: 1,\r\n              offset: 0,\r\n              format: \"float32x3\",\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 2,\r\n          attributes: [\r\n            {\r\n              // uvs\r\n              shaderLocation: 2,\r\n              offset: 0,\r\n              format: \"float32x2\",\r\n            },\r\n          ],\r\n        },\r\n        // joint indices\r\n        {\r\n          arrayStride: 4 * 4, // vec4<u32> = 4 * 4 bytes\r\n          attributes: [{format: 'uint32x4', offset: 0, shaderLocation: 3}]\r\n        },\r\n        // weights\r\n        glbInfo,\r\n      ];\r\n\r\n      if(this.mesh.tangentsBuffer) {\r\n        this.vertexBuffers.push({\r\n          arrayStride: 4 * 4, // vec4<f32> = 16 bytes\r\n          attributes: [\r\n            {shaderLocation: 5, format: \"float32x4\", offset: 0}\r\n          ]\r\n        });\r\n      } else {\r\n        // for non glb - non skinned use basic shaders\r\n      }\r\n\r\n      // Note: The frontFace and cullMode values have no effect on the \r\n      // \"point-list\", \"line-list\", or \"line-strip\" topologies.\r\n      this.primitive = {\r\n        topology: 'triangle-list',\r\n        cullMode: 'back', // typical for shadow passes\r\n        frontFace: 'ccw'\r\n      }\r\n\r\n      // Selected effect\r\n      this.selectedBuffer = device.createBuffer({\r\n        size: 4, // just one float\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.selectedBindGroupLayout = device.createBindGroupLayout({\r\n        label: 'selectedBindGroupLayout mesh',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {}},\r\n        ],\r\n      });\r\n\r\n      this.selectedBindGroup = device.createBindGroup({\r\n        label: 'selectedBindGroup mesh',\r\n        layout: this.selectedBindGroupLayout,\r\n        entries: [{binding: 0, resource: {buffer: this.selectedBuffer}}],\r\n      });\r\n\r\n      this.setSelectedEffect = (selected = false) => {\r\n        this.device.queue.writeBuffer(this.selectedBuffer, 0, new Float32Array([selected ? 1.0 : 0.0]));\r\n      };\r\n      // 0 default\r\n      this.setSelectedEffect();\r\n\r\n      // Create a bind group layout which holds the scene uniforms and\r\n      // the texture+sampler for depth. We create it manually because the WebPU\r\n      // implementation doesn't infer this from the shader (yet).\r\n      this.createLayoutForRender();\r\n\r\n      this.modelUniformBuffer = this.device.createBuffer({\r\n        size: 4 * 16, // 4x4 matrix\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.sceneUniformBuffer = this.device.createBuffer({\r\n        label: 'sceneUniformBuffer per mesh',\r\n        size: 176,\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n      // test MUST BE IF\r\n      this.uniformBufferBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'uniformBufferBindGroupLayout in mesh regular',\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            visibility: GPUShaderStage.VERTEX,\r\n            buffer: {\r\n              type: 'uniform',\r\n            },\r\n          },\r\n          {\r\n            binding: 1,\r\n            visibility: GPUShaderStage.VERTEX,\r\n            buffer: {\r\n              type: 'uniform',\r\n            },\r\n          },\r\n        ],\r\n      });\r\n\r\n      // dummy for non skin mesh like this class\r\n      function alignTo256(n) {\r\n        return Math.ceil(n / 256) * 256;\r\n      }\r\n\r\n      let MAX_BONES = 100;\r\n      this.MAX_BONES = MAX_BONES;\r\n      this.bonesBuffer = device.createBuffer({\r\n        label: \"bonesBuffer\",\r\n        size: alignTo256(64 * MAX_BONES),\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      const bones = new Float32Array(this.MAX_BONES * 16);\r\n      for(let i = 0;i < this.MAX_BONES;i++) {\r\n        // identity matrices\r\n        bones.set([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], i * 16);\r\n      }\r\n      this.device.queue.writeBuffer(this.bonesBuffer, 0, bones);\r\n\r\n      this.modelBindGroup = this.device.createBindGroup({\r\n        label: 'modelBindGroup in mesh',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            resource: {\r\n              buffer: this.modelUniformBuffer,\r\n            },\r\n          },\r\n          {binding: 1, resource: {buffer: this.bonesBuffer}},\r\n        ],\r\n      });\r\n\r\n      this.mainPassBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'mainPassBindGroupLayout mesh',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'depth'}},\r\n          {binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'comparison'}},\r\n        ],\r\n      });\r\n\r\n      // pointerEffect bonus\r\n      // TEST - OPTIONS ON BASE MESHOBJ LEVEL\r\n      this.effects = {};\r\n      if(this.pointerEffect && this.pointerEffect.enabled === true) {\r\n        let pf = navigator.gpu.getPreferredCanvasFormat();\r\n        this.effects.pointer = new PointerEffect(device, pf, this, true);\r\n      }\r\n      // end\r\n\r\n      // Rotates the camera around the origin based on time.\r\n      this.getTransformationMatrix = (mainRenderBundle, spotLight, index) => {\r\n        const now = Date.now();\r\n        const dt = (now - this.lastFrameMS) / this.mainCameraParams.responseCoef;\r\n        this.lastFrameMS = now;\r\n        const camera = this.cameras[this.mainCameraParams.type];\r\n        if(index == 0) camera.update(dt, inputHandler());\r\n        const camVP = mat4.multiply(camera.projectionMatrix, camera.view);\r\n        const sceneData = new Float32Array(44);\r\n        // Light VP\r\n        sceneData.set(spotLight.viewProjMatrix, 0);\r\n        // Camera VP\r\n        sceneData.set(camVP, 16);\r\n        // Camera position + padding\r\n        sceneData.set([camera.position.x, camera.position.y, camera.position.z, 0.0], 32);\r\n        // Light position + padding\r\n        sceneData.set([spotLight.position[0], spotLight.position[1], spotLight.position[2], 0.0], 36);\r\n        sceneData.set([this.globalAmbient[0], this.globalAmbient[1], this.globalAmbient[2], 0.0], 40);\r\n        device.queue.writeBuffer(\r\n          this.sceneUniformBuffer,\r\n          0,\r\n          sceneData.buffer,\r\n          sceneData.byteOffset,\r\n          sceneData.byteLength\r\n        );\r\n      };\r\n\r\n      this.getModelMatrix = (pos) => {\r\n        let modelMatrix = mat4.identity();\r\n        mat4.translate(modelMatrix, [pos.x, pos.y, pos.z], modelMatrix);\r\n        if(this.itIsPhysicsBody) {\r\n          mat4.rotate(modelMatrix,\r\n            [this.rotation.axis.x, this.rotation.axis.y, this.rotation.axis.z],\r\n            degToRad(this.rotation.angle),\r\n            modelMatrix\r\n          );\r\n        } else {\r\n          mat4.rotateX(modelMatrix, this.rotation.getRotX(), modelMatrix);\r\n          mat4.rotateY(modelMatrix, this.rotation.getRotY(), modelMatrix);\r\n          mat4.rotateZ(modelMatrix, this.rotation.getRotZ(), modelMatrix);\r\n        }\r\n        // Apply scale if you have it, e.g.:\r\n        // console.warn('what is csle comes from user level not glb ', this.scale)\r\n        if(this.glb || this.objAnim) {\r\n          mat4.scale(modelMatrix, [this.scale[0], this.scale[1], this.scale[2]], modelMatrix);\r\n        }\r\n        return modelMatrix;\r\n      };\r\n\r\n      // looks like affect on transformations for now const 0\r\n      const modelMatrix = mat4.translation([0, 0, 0]);\r\n      const modelData = modelMatrix;\r\n      this.device.queue.writeBuffer(\r\n        this.modelUniformBuffer,\r\n        0,\r\n        modelData.buffer,\r\n        modelData.byteOffset,\r\n        modelData.byteLength\r\n      );\r\n      this.done = true;\r\n      try {\r\n        this.setupPipeline();\r\n      } catch(err) {console.log('err in create pipeline in init ', err)}\r\n    }).then(() => {\r\n      if(typeof this.objAnim !== 'undefined' && this.objAnim !== null) {\r\n        console.log('after all updateMeshListBuffers...')\r\n        this.updateMeshListBuffers();\r\n      }\r\n    })\r\n  }\r\n\r\n  setupPipeline = () => {\r\n    this.createBindGroupForRender();\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      label: 'Mesh Pipeline \u2705',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'createPipelineLayout Mesh',\r\n        bindGroupLayouts: [\r\n          this.bglForRender,\r\n          this.uniformBufferBindGroupLayout,\r\n          this.selectedBindGroupLayout],\r\n      }),\r\n      vertex: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.material.type == 'normalmap') ? vertexWGSL_NM : vertexWGSL,\r\n        }),\r\n        buffers: this.vertexBuffers,\r\n      },\r\n      fragment: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.isVideo == true ? fragmentVideoWGSL : this.getMaterial()),\r\n        }),\r\n        targets: [\r\n          {\r\n            format: this.presentationFormat,\r\n          },\r\n        ],\r\n        constants: {\r\n          shadowDepthTextureSize: this.shadowDepthTextureSize,\r\n        },\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n    // console.log('\u2705Set Pipeline done');\r\n  }\r\n\r\n  updateModelUniformBuffer = () => {\r\n    if(this.done == false) return;\r\n    // Per-object model matrix only\r\n    const modelMatrix = this.getModelMatrix(this.position);\r\n    this.device.queue.writeBuffer(\r\n      this.modelUniformBuffer,\r\n      0,\r\n      modelMatrix.buffer,\r\n      modelMatrix.byteOffset,\r\n      modelMatrix.byteLength\r\n    );\r\n  }\r\n\r\n  createGPUBuffer(dataArray, usage) {\r\n    if(!dataArray || typeof dataArray.length !== 'number') {\r\n      throw new Error('Invalid data array passed to createGPUBuffer');\r\n    }\r\n\r\n    const size = dataArray.length * dataArray.BYTES_PER_ELEMENT;\r\n    if(!Number.isFinite(size) || size <= 0) {\r\n      throw new Error(`Invalid buffer size: ${size}`);\r\n    }\r\n\r\n    const buffer = this.device.createBuffer({\r\n      size,\r\n      usage,\r\n      mappedAtCreation: true,\r\n    });\r\n\r\n    const writeArray = dataArray.constructor === Float32Array\r\n      ? new Float32Array(buffer.getMappedRange())\r\n      : new Uint16Array(buffer.getMappedRange());\r\n    writeArray.set(dataArray);\r\n    buffer.unmap();\r\n    return buffer;\r\n  }\r\n\r\n  updateMeshListBuffers() {\r\n    for(const key in this.objAnim.meshList) {\r\n      const mesh = this.objAnim.meshList[key];\r\n      mesh.vertexBuffer = this.device.createBuffer({\r\n        size: mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexBuffer.getMappedRange()).set(mesh.vertices);\r\n      mesh.vertexBuffer.unmap();\r\n      // Normals\r\n      mesh.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexNormalsBuffer.getMappedRange()).set(mesh.vertexNormals);\r\n      mesh.vertexNormalsBuffer.unmap();\r\n      // UVs\r\n      mesh.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexTexCoordsBuffer.getMappedRange()).set(mesh.textures);\r\n      mesh.vertexTexCoordsBuffer.unmap();\r\n      // Indices\r\n      const indexCount = mesh.indices.length;\r\n      const indexSize = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n      mesh.indexBuffer = this.device.createBuffer({\r\n        size: indexSize,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint16Array(mesh.indexBuffer.getMappedRange()).set(mesh.indices);\r\n      mesh.indexBuffer.unmap();\r\n      mesh.indexCount = indexCount;\r\n    }\r\n  }\r\n\r\n  drawElements = (pass, lightContainer) => {\r\n    if(this.isVideo) {\r\n      this.updateVideoTexture();\r\n    }\r\n    // Bind per-mesh uniforms\r\n    pass.setBindGroup(0, this.sceneBindGroupForRender);\r\n    pass.setBindGroup(1, this.modelBindGroup);\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2;\r\n      for(const light of lightContainer) {\r\n        pass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    // probably no need i forgot on ambient - very similar\r\n    if(this.selectedBindGroup) {\r\n      pass.setBindGroup(2, this.selectedBindGroup);\r\n    }\r\n\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    pass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    if(this.joints) {\r\n      if(this.constructor.name === \"BVHPlayer\") {\r\n        pass.setVertexBuffer(3, this.mesh.jointsBuffer);  // real\r\n        pass.setVertexBuffer(4, this.mesh.weightsBuffer); //real\r\n      } else {\r\n        // dummy\r\n        pass.setVertexBuffer(3, this.joints.buffer);  // new dummy\r\n        pass.setVertexBuffer(4, this.weights.buffer); // new dummy\r\n      }\r\n    }\r\n\r\n    if(this.mesh.tangentsBuffer) {\r\n      pass.setVertexBuffer(5, this.mesh.tangentsBuffer);\r\n    }\r\n\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  drawElementsAnim = (renderPass, lightContainer) => {\r\n    if(!this.sceneBindGroupForRender || !this.modelBindGroup) {console.log(' NULL 1'); return;}\r\n    if(!this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni]) {console.log(' NULL 2'); return;}\r\n\r\n    renderPass.setBindGroup(0, this.sceneBindGroupForRender);\r\n    renderPass.setBindGroup(1, this.modelBindGroup);\r\n    const mesh = this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni];\r\n\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2;\r\n      for(const light of lightContainer) {\r\n        renderPass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    if(this.selectedBindGroup) {\r\n      renderPass.setBindGroup(2, this.selectedBindGroup);\r\n    }\r\n\r\n    renderPass.setVertexBuffer(0, mesh.vertexBuffer);\r\n    renderPass.setVertexBuffer(1, mesh.vertexNormalsBuffer);\r\n    renderPass.setVertexBuffer(2, mesh.vertexTexCoordsBuffer);\r\n\r\n    if(this.constructor.name === \"BVHPlayer\") {\r\n      // real\r\n      renderPass.setVertexBuffer(3, this.mesh.jointsBuffer);\r\n      renderPass.setVertexBuffer(4, this.mesh.weightsBuffer);\r\n    } else {\r\n      // dummy\r\n      renderPass.setVertexBuffer(3, this.joints.buffer);\r\n      renderPass.setVertexBuffer(4, this.weights.buffer);\r\n    }\r\n\r\n    if(this.mesh.tangentsBuffer) {\r\n      renderPass.setVertexBuffer(5, this.mesh.tangentsBuffer);\r\n    }\r\n\r\n    renderPass.setIndexBuffer(mesh.indexBuffer, 'uint16');\r\n    renderPass.drawIndexed(mesh.indexCount);\r\n\r\n    if(this.objAnim.playing == true) {\r\n      if(this.objAnim.animations[this.objAnim.animations.active].speedCounter >= this.objAnim.animations[this.objAnim.animations.active].speed) {\r\n        this.objAnim.currentAni++;\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter = 0;\r\n      } else {\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter++;\r\n      }\r\n      if(this.objAnim.currentAni >= this.objAnim.animations[this.objAnim.animations.active].to) {\r\n        this.objAnim.currentAni = this.objAnim.animations[this.objAnim.animations.active].from;\r\n      }\r\n    }\r\n  }\r\n\r\n  drawShadows = (shadowPass, light) => {\r\n    shadowPass.setVertexBuffer(0, this.vertexBuffer);\r\n    shadowPass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    shadowPass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    shadowPass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    shadowPass.drawIndexed(this.indexCount);\r\n  }\r\n}", "import {LOG_FUNNY, degToRad, quaternion_rotation_matrix, radToDeg, scriptManager} from \"../engine/utils\";\r\n\r\nexport default class MatrixAmmo {\r\n  constructor() {\r\n    // THIS PATH IS PATH FROM PUBLIC FINAL FOLDER\r\n    scriptManager.LOAD(\r\n      \"https://maximumroulette.com/apps/megpu/ammo.js\",\r\n      \"ammojs\",\r\n      undefined,\r\n      undefined,\r\n      this.init,\r\n    );\r\n    this.lastRoll = '';\r\n    this.presentScore = '';\r\n    this.speedUpSimulation = 1;\r\n  }\r\n\r\n  init = () => {\r\n    Ammo().then(Ammo => {\r\n      // Physics variables\r\n      this.dynamicsWorld = null;\r\n      this.rigidBodies = [];\r\n      this.Ammo = Ammo;\r\n      this.lastUpdate = 0\r\n      console.log(\"%c Ammo core loaded.\", LOG_FUNNY);\r\n      this.initPhysics();\r\n      // simulate async\r\n      setTimeout(() => {\r\n        dispatchEvent(new CustomEvent('AmmoReady', {}))\r\n      } , 200)\r\n    });\r\n  };\r\n\r\n  initPhysics() {\r\n    let Ammo = this.Ammo;\r\n    // Physics configuration\r\n    var collisionConfiguration = new Ammo.btDefaultCollisionConfiguration(),\r\n      dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration),\r\n      overlappingPairCache = new Ammo.btDbvtBroadphase(),\r\n      solver = new Ammo.btSequentialImpulseConstraintSolver();\r\n\r\n    this.dynamicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, overlappingPairCache, solver, collisionConfiguration);\r\n    this.dynamicsWorld.setGravity(new Ammo.btVector3(0, -10, 0));\r\n\r\n    var groundShape = new Ammo.btBoxShape(new Ammo.btVector3(70, 1, 70)),\r\n      groundTransform = new Ammo.btTransform();\r\n    groundTransform.setIdentity();\r\n    groundTransform.setOrigin(new Ammo.btVector3(0, -4.45, 0));\r\n    var mass = 0,\r\n      isDynamic = (mass !== 0),\r\n      localInertia = new Ammo.btVector3(0, 0, 0);\r\n\r\n    if(isDynamic) groundShape.calculateLocalInertia(mass, localInertia);\r\n\r\n    var myMotionState = new Ammo.btDefaultMotionState(groundTransform),\r\n      rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, myMotionState, groundShape, localInertia),\r\n      body = new Ammo.btRigidBody(rbInfo);\r\n    body.name = 'ground';\r\n    this.ground = body;\r\n    this.dynamicsWorld.addRigidBody(body);\r\n    this.detectCollision()\r\n  }\r\n\r\n  addPhysics(MEObject, pOptions) {\r\n    if(pOptions.geometry == \"Sphere\") {\r\n      this.addPhysicsSphere(MEObject, pOptions)\r\n    } else if(pOptions.geometry == \"Cube\") {\r\n      this.addPhysicsBox(MEObject, pOptions)\r\n    }\r\n  }\r\n\r\n  addPhysicsSphere(MEObject, pOptions) {\r\n    const FLAGS = {\r\n      TEST_NIDZA: 3,\r\n      CF_KINEMATIC_OBJECT: 2\r\n    }\r\n\r\n    let Ammo = this.Ammo;\r\n    var colShape = new Ammo.btSphereShape(Array.isArray(pOptions.radius) ? pOptions.radius[0] : pOptions.radius),\r\n      startTransform = new Ammo.btTransform();\r\n    startTransform.setIdentity();\r\n    var mass = 1;\r\n    var localInertia = new Ammo.btVector3(0, 0, 0);\r\n    colShape.calculateLocalInertia(mass, localInertia);\r\n    startTransform.setOrigin(new Ammo.btVector3(pOptions.position.x, pOptions.position.y, pOptions.position.z));\r\n\r\n    var myMotionState = new Ammo.btDefaultMotionState(startTransform),\r\n      rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, myMotionState, colShape, localInertia),\r\n      body = new Ammo.btRigidBody(rbInfo);\r\n\r\n    if(pOptions.mass == 0 && typeof pOptions.state == 'undefined' && typeof pOptions.collide == 'undefined') {\r\n      body.setActivationState(2)\r\n      body.setCollisionFlags(FLAGS.CF_KINEMATIC_OBJECT);\r\n      // console.log('what is pOptions.mass and state is 2 ....', pOptions.mass)\r\n    } else if(typeof pOptions.collide != 'undefined' && pOptions.collide == false) {\r\n      // idea not work for now - eliminate collide effect\r\n      body.setActivationState(4)\r\n      body.setCollisionFlags(FLAGS.TEST_NIDZA);\r\n    } else {\r\n      body.setActivationState(4)\r\n    }\r\n\r\n    body.name = pOptions.name;\r\n    MEObject.itIsPhysicsBody = true;\r\n    body.MEObject = MEObject;\r\n    this.dynamicsWorld.addRigidBody(body);\r\n    this.rigidBodies.push(body);\r\n    return body;\r\n  }\r\n\r\n  addPhysicsBox(MEObject, pOptions) {\r\n    const FLAGS = {\r\n      TEST_NIDZA: 3,\r\n      CF_KINEMATIC_OBJECT: 2\r\n    }\r\n\r\n    let Ammo = this.Ammo;\r\n    // improve this - scale by comp\r\n    var colShape = new Ammo.btBoxShape(new Ammo.btVector3(pOptions.scale[0], pOptions.scale[1], pOptions.scale[2])),\r\n      startTransform = new Ammo.btTransform();\r\n    startTransform.setIdentity();\r\n    var mass = pOptions.mass;\r\n    var localInertia = new Ammo.btVector3(0, 0, 0);\r\n    colShape.calculateLocalInertia(mass, localInertia);\r\n    startTransform.setOrigin(new Ammo.btVector3(pOptions.position.x, pOptions.position.y, pOptions.position.z));\r\n    // console.log('startTransform.setRotation', startTransform.setRotation)\r\n    var t = startTransform.getRotation()\r\n    t.setX(degToRad(pOptions.rotation.x))\r\n    t.setY(degToRad(pOptions.rotation.y))\r\n    t.setZ(degToRad(pOptions.rotation.z))\r\n    startTransform.setRotation(t)\r\n\r\n    var myMotionState = new Ammo.btDefaultMotionState(startTransform),\r\n      rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, myMotionState, colShape, localInertia),\r\n      body = new Ammo.btRigidBody(rbInfo);\r\n\r\n    if(pOptions.mass == 0 && typeof pOptions.state == 'undefined' && typeof pOptions.collide == 'undefined') {\r\n      body.setActivationState(2)\r\n      body.setCollisionFlags(FLAGS.CF_KINEMATIC_OBJECT);\r\n      // console.log('what is pOptions.mass and state is 2 ....', pOptions.mass)\r\n    } else if(typeof pOptions.collide != 'undefined' && pOptions.collide == false) {\r\n      // idea not work for now - eliminate collide effect\r\n      body.setActivationState(4)\r\n      body.setCollisionFlags(FLAGS.TEST_NIDZA);\r\n    } else {\r\n      body.setActivationState(4)\r\n    }\r\n    body.name = pOptions.name;\r\n    MEObject.itIsPhysicsBody = true;\r\n    body.MEObject = MEObject;\r\n    this.dynamicsWorld.addRigidBody(body);\r\n    this.rigidBodies.push(body);\r\n    return body;\r\n  }\r\n\r\n  setBodyVelocity(body, x, y, z) {\r\n    var tbv30 = new Ammo.btVector3();\r\n    tbv30.setValue(x, y, z);\r\n    body.setLinearVelocity(tbv30);\r\n  }\r\n\r\n  setKinematicTransform(body, x, y, z, rx, ry, rz) {\r\n    if(typeof rx == 'undefined') {var rx = 0;}\r\n    if(typeof ry == 'undefined') {var ry = 0;}\r\n    if(typeof rz == 'undefined') {var rz = 0;}\r\n    let pos = new Ammo.btVector3();\r\n    // let quat = new Ammo.btQuaternion();\r\n    pos = body.getWorldTransform().getOrigin();\r\n    let localRot = body.getWorldTransform().getRotation();\r\n    // console.log('pre pos x:', pos.x(), \" y : \", pos.y(), \" z:\", pos.z())\r\n    pos.setX(pos.x() + x)\r\n    pos.setY(pos.y() + y)\r\n    pos.setZ(pos.z() + z)\r\n    localRot.setX(rx)\r\n    localRot.setY(ry)\r\n    localRot.setZ(rz)\r\n    let physicsBody = body;\r\n    let ms = physicsBody.getMotionState();\r\n    if(ms) {\r\n      var tmpTrans = new Ammo.btTransform();\r\n      tmpTrans.setIdentity();\r\n      tmpTrans.setOrigin(pos);\r\n      tmpTrans.setRotation(localRot);\r\n      ms.setWorldTransform(tmpTrans);\r\n    }\r\n  }\r\n\r\n  getBodyByName(name) {\r\n    var b = null;\r\n    this.rigidBodies.forEach((item, index, array) => {\r\n      if(item.name == name) {\r\n        b = array[index];\r\n      }\r\n    });\r\n    return b;\r\n  }\r\n\r\n  getNameByBody(body) {\r\n    var b = null;\r\n    this.rigidBodies.forEach((item, index, array) => {\r\n      if(item.kB == body.kB) {\r\n        b = array[index].name;\r\n      }\r\n    });\r\n    return b;\r\n  }\r\n\r\n  deactivatePhysics(body) {\r\n    const CF_KINEMATIC_OBJECT = 2;\r\n    const DISABLE_DEACTIVATION = 4;\r\n    // 1. Remove from world\r\n    this.dynamicsWorld.removeRigidBody(body);\r\n    // 2. Set body to kinematic\r\n    const flags = body.getCollisionFlags();\r\n    body.setCollisionFlags(flags | CF_KINEMATIC_OBJECT);\r\n    body.setActivationState(DISABLE_DEACTIVATION); // no auto-wakeup\r\n    // 3. Clear motion\r\n    const zero = new Ammo.btVector3(0, 0, 0);\r\n    body.setLinearVelocity(zero);\r\n    body.setAngularVelocity(zero);\r\n    // 4. Reset transform to current position (optional \u2014 preserves pose)\r\n    const currentTransform = body.getWorldTransform();\r\n    body.setWorldTransform(currentTransform);\r\n    body.getMotionState().setWorldTransform(currentTransform);\r\n    // 5. Add back to physics world\r\n    this.matrixAmmo.dynamicsWorld.addRigidBody(body);\r\n    // 6. Mark it manually (logic flag)\r\n    body.isKinematic = true;\r\n  }\r\n\r\n  detectCollision() {\r\n    // console.log('override this')\r\n    return;\r\n    this.lastRoll = '';\r\n    this.presentScore = '';\r\n    let dispatcher = this.dynamicsWorld.getDispatcher();\r\n    let numManifolds = dispatcher.getNumManifolds();\r\n    for(let i = 0;i < numManifolds;i++) {\r\n      let contactManifold = dispatcher.getManifoldByIndexInternal(i);\r\n      // let numContacts = contactManifold.getNumContacts();\r\n      // this.rigidBodies.forEach((item) => {\r\n      //   if(item.kB == contactManifold.getBody0().kB) {\r\n      //     // console.log('Detected body0 =', item.name)\r\n      //   }\r\n      if(this.ground.kB == contactManifold.getBody0().kB &&\r\n        this.getNameByBody(contactManifold.getBody1()) == 'CubePhysics1') {\r\n        // console.log(this.ground ,'GROUND IS IN CONTACT WHO IS BODY1 ', contactManifold.getBody1())\r\n        // console.log('GROUND IS IN CONTACT WHO IS BODY1 getNameByBody  ', this.getNameByBody(contactManifold.getBody1()))\r\n        // CHECK ROTATION\r\n        var testR = contactManifold.getBody1().getWorldTransform().getRotation();\r\n        console.log('this.lastRoll = ', this.lastRoll, ' presentScore = ', this.presentScore)\r\n      }\r\n    }\r\n  }\r\n\r\n  updatePhysics() {\r\n    if(typeof Ammo === 'undefined') return;\r\n    const trans = new Ammo.btTransform();\r\n    const transform = new Ammo.btTransform();\r\n\r\n    this.rigidBodies.forEach(function(body) {\r\n      if(body.isKinematic) {\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(\r\n          body.MEObject.position.x,\r\n          body.MEObject.position.y,\r\n          body.MEObject.position.z\r\n        ));\r\n        const quat = new Ammo.btQuaternion();\r\n        quat.setRotation(\r\n          new Ammo.btVector3(\r\n            body.MEObject.rotation.axis.x,\r\n            body.MEObject.rotation.axis.y,\r\n            body.MEObject.rotation.axis.z\r\n          ),\r\n          degToRad(body.MEObject.rotation.angle)\r\n        );\r\n        transform.setRotation(quat);\r\n\r\n        body.setWorldTransform(transform);\r\n        const ms = body.getMotionState();\r\n        if(ms) ms.setWorldTransform(transform);\r\n      }\r\n    });\r\n\r\n    Ammo.destroy(transform);\r\n\r\n    // Step simulation AFTER setting kinematic transforms\r\n    const timeStep = 1 / 60;\r\n    const maxSubSteps = 10;\r\n\r\n    for(let i = 0;i < this.speedUpSimulation;i++) {\r\n      this.dynamicsWorld.stepSimulation(timeStep, maxSubSteps);\r\n    }\r\n\r\n    this.rigidBodies.forEach(function(body) {\r\n      if(!body.isKinematic && body.getMotionState()) {\r\n        body.getMotionState().getWorldTransform(trans);\r\n\r\n        const _x = +trans.getOrigin().x().toFixed(2);\r\n        const _y = +trans.getOrigin().y().toFixed(2);\r\n        const _z = +trans.getOrigin().z().toFixed(2);\r\n\r\n        body.MEObject.position.setPosition(_x, _y, _z);\r\n\r\n        const rot = trans.getRotation();\r\n        const rotAxis = rot.getAxis();\r\n        rot.normalize();\r\n\r\n        body.MEObject.rotation.axis.x = rotAxis.x();\r\n        body.MEObject.rotation.axis.y = rotAxis.y();\r\n        body.MEObject.rotation.axis.z = rotAxis.z();\r\n        body.MEObject.rotation.matrixRotation = quaternion_rotation_matrix(rot);\r\n        body.MEObject.rotation.angle = radToDeg(parseFloat(rot.getAngle().toFixed(2)));\r\n      }\r\n    });\r\n\r\n    Ammo.destroy(trans);\r\n    this.detectCollision();\r\n  }\r\n}", "export const en = {\r\n  \"play\": \"Play\",\r\n  \"sendmsg\": \"Send message\",\r\n  \"changeTheme\": \"Theme dark/light\",\r\n  \"yes\": \"Yes\",\r\n  \"no\": \"No\",\r\n  \"on\": \"On\",\r\n  \"off\": \"Off\",\r\n  \"startGame\": \"\uD83C\uDFB2Start Game\",\r\n  \"changeLang\": \"Change Lang\",\r\n  \"english\": \"English\",\r\n  \"serbian\": \"Serbian\",\r\n  \"MAX\": \"MAX\",\r\n  \"MIN\": \"MIN\",\r\n  \"straight\": \"Straight\",\r\n  \"threeOf\": \"ThreeOf\",\r\n  \"fullhouse\": \"FULLH\",\r\n  \"help\": \"HELP\",\r\n  \"roll\":\"ROLL DICES\",\r\n  \"settings\": \"Settings\",\r\n  \"hand\": \"Hand\",\r\n  \"up\": \"Up |\",\r\n  \"down\": \"Down\",\r\n  \"free\": \"Free\",\r\n  \"cornerText\": \"\uD83C\uDFB2\",\r\n  \"poker\":\"Poker\",\r\n  \"jamb\":\"Jamb\",\r\n  \"final\":\"Final \u03A3\",\r\n  \"hide\": \"HIDE\",\r\n  \"sounds\": \"Sounds\",\r\n  \"welcomeMsg\": \"Welcome here, <br> open source project \uD83C\uDFB2 Jamb 3d deluxe game <br> download from \",\r\n  \"ready\":\"Ready for play \uD83C\uDFB2!\",\r\n  \"freetoroll\":\"Free for roll \uD83C\uDFB2!\",\r\n  \"pick5\":\"Pick best 5 \uD83C\uDFB2 and choose table field!\",\r\n  \"hand1\":\"First hand in play - please wait...\",\r\n  \"hand2\":\"Secound hand in play - please wait...\",\r\n  \"graphics\":\"Graphics options\",\r\n  \"choosename\":\"Choose nickname:\",\r\n  \"table\":\"Table\",\r\n  \"aboutword\":\"About\",\r\n  \"about\":\"<i>Jamb 3d deluxe</i> is a modern 3D dice game built entirely with MatrixEngineWGPU, a high-performance WebGPU-based rendering engine developed for creating interactive graphics directly in the browser. The game delivers smooth visuals, realistic dice physics, and an engaging user experience \u2014 all without requiring any plugins or installations. \\n This project is powered by open technologies and is designed to be lightweight, fast, and highly customizable. It\u2019s a great example of how WebGPU can be used for real-time interactive content. \\n \uD83D\uDD17 Download / Try it: \\n github.com/zlatnaspirala/matrix-engine-wgpu \\n \uD83D\uDEE0 License: \\n The core engine and the Jamb 3d deluxe project are released under the GPL v3 license, making them free and open-source for both personal and commercial use \u2014 as long as you respect the terms of the license. \\n Whether you're a developer, gamer, or enthusiast, Jamb 3d deluxe is a fun way to experience the potential of modern browser-based 3D technology. <img width='320' height='320' src='https://github.com/zlatnaspirala/matrix-engine-wgpu/blob/main/public/res/icons/512.png?raw=true' />\",\r\n\r\n  \"letthegame\": \"Let the game begin!\",\r\n  \"leaderboard\": \"Leaderboard\",\r\n  \"about_\": \"About\",\r\n  \"next\": \"Next\",\r\n  \"back\": \"Back\",\r\n  \"used\": \"used\",\r\n  \"gameplaychannel\":\"gameplay channel\",\r\n  \"alreadyingame\": \"Already in game:\",\r\n  \"waiting_for_others\": \"Waiting for others...\",\r\n  \"titleBan\":\"\u272DBan \uD83D\uDFE2\uD83D\uDFE2\uD83D\uDFE2\",\r\n  \"aboutRPG\": \"Forest Of Hollow Blood Made in MatrixEngineWGPU webGPU engine. Open source part can be found in engine repo <a href='https://github.com/zlatnaspirala/matrix-engine-wgpu'> @zlatnaspirala Github.com </a>. Music by <a href='https://pixabay.com/users/mfcc-28627740/?utm_source=link-attribution&utm_medium=referral&utm_campaign=music&utm_content=274290'>Mykola Sosin</a> from <a href='https://pixabay.com//?utm_source=link-attribution&utm_medium=referral&utm_campaign=music&utm_content=274290'>Pixabay</a> Characters used from great mixamo.com -\u2705What you can do You can use Mixamo characters and animations royalty-free in commercial, personal, or non\u2011profit projects (games, films, prints, etc.).You own your creations / how you use them.No requirement to credit Adobe / Mixamo (though allowed). -\uD83D\uDEABWhat you cannot do You cannot redistribute or sell the raw Mixamo character or animation files \u201Cas is\u201D (i.e. as standalone assets) to others.You can\u2019t use Mixamo content to create a competing library of characters / animations (i.e. you can\u2019t just package them and sell them to others). You can\u2019t use Mixamo\u2019s content (or outputs) to train AI / machine learning models. Used free assets from great https://craftpix.net Magic icons : https://craftpix.net/freebies/free-rpg-splash-game-512x512-icons/ For background music in rpg template used: Music by Dvir Silverstone from Pixabay Sound Effect by Crunchpix Studio from Pixabay Music by Emmraan from Pixabay . Logo includes the official WebGPU logo. WebGPU logo by W3C Licensed under Creative Commons Attribution 4.0 .   'Ruined rock fence' (https://skfb.ly/6RLwN) by VladNeko is licensed under Creative Commons Attribution (http://creativecommons.org/licenses/by/4.0/).\",\r\n  \"mariasword\": \"Maria Sword, the silver blade of the East, strikes with speed and elegance. Her courage burns quietly but never falters.\",\r\n  \"slayzer\":\"Slayzer \u2014 a dark creation with blades for arms. Silent, swift, and born from shadow.\",\r\n  \"steelborn\":\"Steelborn \u2014 a small yet fearless warrior clad in shining iron armor, wielding his sword with unshakable resolve.\",\r\n  \"warrok\": \"Warrok \u2014 a fierce brute forged in battle, wielding raw strength and unbreakable will.\",\r\n  \"skeletonz\": \"Skeletonz \u2014 a restless warrior of bone and shadow, risen again to fight without fear.\",\r\n  \"erika\": \"Erika moves like a shadow: quiet, precise and watchful. She carries one dark arrow \u2014 simple, deadly and personal.\",\r\n  \"arissa\": \"Arissa hides her power behind calm eyes and empty hands. No blade or staff\u2014only the swirling dark orbs she conjures when the fight begins.\",\r\n\r\n  \"gameplayused\":\"Forest Of Hollow Blood for now have only one channel for gameplay. Please wait for current party end...\",\r\n\r\n\r\n  \"nogold\" : \"Not enough gold!\",\r\n  \"invertorysecret\" : \"Corona Ignifera magic secret Sol Corona,Flamma Crystal\\n  Aqua Sanctum magic secret Mare Pearl,Luna Gemma\\n Umbra Silens magic secret Umbra Vellum,Noctis Band\\n Terra Fortis magic secret Terra Clavis,Ardent Vine,Silva Heart\\n Ventus Aegis magic secret Ventus Pluma,Ignifur Cape\\n Ferrum Lux magic secret Ferrum Anulus,Lux Feather\\n Sanguis Vita magic secret Sanguis Orb,Vita Flos \\n Tenebris Vox magic secret Tenebris Fang,Vox Chime \\n Aether Gladius magic secret Gladius Ignis,Aether Scale \\n Fulgur Mortis magic secret Fulgur Stone,Mortis Bone \\n Corona Umbra magic secret Umbra Silens,Corona Ignifera,Tenebris Vox \\n Terra Sanctum magic secret Terra Fortis,Aqua Sanctum \\n Aether Fortis magic secret Aether Gladius,Ferrum Lux \\n  Vita Mindza magic secret Sanguis Vita,Ventus Aegis \\n Mortis Ultima magic secret Fulgur Mortis,Corona Umbra,Aether Fortis\"\r\n}", "import {en} from \"../../public/res/multilang/en-backup\";\r\nimport {LOG_MATRIX} from \"../engine/utils\";\r\n\r\nexport class MultiLang {\r\n\r\n  constructor() {\r\n    addEventListener('updateLang', () => {\r\n      console.log('Multilang updated.')\r\n      this.update();\r\n    })\r\n  }\r\n\r\n  update = function() {\r\n    var allTranDoms = document.querySelectorAll('[data-label]');\r\n    allTranDoms.forEach((i) => {\r\n      i.innerHTML = this.get[i.getAttribute('data-label')]\r\n    })\r\n  }\r\n\r\n  loadMultilang = async function(lang = 'en') {\r\n    if (lang == 'rs') lang = 'sr'; // exc\r\n    lang = 'res/multilang/' + lang + '.json';\r\n    console.info(`%cMultilang: ${lang}` , LOG_MATRIX);\r\n    try {\r\n      const r = await fetch(lang, {\r\n        headers: {\r\n          'Accept': 'application/json',\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n      return await r.json();\r\n    } catch(err) {\r\n      console.warn('Not possible to access multilang json asset! Err => ', err, '. Use backup lang predefinited object. Only english avaible.');\r\n      return en;\r\n    }\r\n  }\r\n}", "export class MatrixSounds {\r\n\r\n  constructor() {\r\n    this.volume = 0.5;\r\n    this.audios = {};\r\n    this.enabled = true; // \uD83D\uDD07 global flag to mute/allow audio\r\n  }\r\n\r\n  muteAll() {\r\n    this.enabled = false;\r\n    Object.values(this.audios).forEach(audio => audio.pause());\r\n  }\r\n\r\n  unmuteAll() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  createClones(c, name, path) {\r\n    for(let x = 1;x < c;x++) {\r\n      const a = new Audio(path);\r\n      a.id = name + x;\r\n      a.volume = this.volume;\r\n      this.audios[name + x] = a;\r\n      document.body.append(a);\r\n    }\r\n  }\r\n\r\n  createAudio(name, path, useClones) {\r\n    const a = new Audio(path);\r\n    a.id = name;\r\n    a.volume = this.volume;\r\n    this.audios[name] = a;\r\n    document.body.append(a);\r\n    if(typeof useClones !== 'undefined') {\r\n      this.createClones(useClones, name, path);\r\n    }\r\n  }\r\n\r\n  play(name) {\r\n    if(!this.enabled) return; // \uD83D\uDD07 prevent playing if muted\r\n\r\n    const audio = this.audios[name];\r\n    if(!audio) return;\r\n\r\n    if(audio.paused) {\r\n      audio.play().catch((e) => {\r\n        if(e.name !== 'NotAllowedError') console.warn(\"sounds error:\", e);\r\n      });\r\n    } else {\r\n      this.tryClone(name);\r\n    }\r\n  }\r\n\r\n  tryClone(name) {\r\n    if(!this.enabled) return; // \uD83D\uDD07 prevent playing clones\r\n\r\n    let cc = 1;\r\n    try {\r\n      while(this.audios[name + cc] && this.audios[name + cc].paused === false) {\r\n        cc++;\r\n      }\r\n      if(this.audios[name + cc]) {\r\n        this.audios[name + cc].play();\r\n      }\r\n    } catch(err) {\r\n      console.warn(\"Clone play failed:\", err);\r\n    }\r\n  }\r\n}", "/**\r\n * The main Mesh class. The constructor will parse through the OBJ file data\r\n * and collect the vertex, vertex normal, texture, and face information. This\r\n * information can then be used later on when creating your VBOs. See\r\n * OBJ.initMeshBuffers for an example of how to use the newly created Mesh\r\n *\r\n * Nidza Note:\r\n * There is difference from me source obj loader and me-wgpu obj loader\r\n * Here we need scele in comp x,y,z because we use also primitive [cube, sphere etc...]\r\n * @class Mesh\r\n * @constructor\r\n *\r\n * @param {String} objectData a string representation of an OBJ file with newlines preserved.\r\n */\r\n\r\nexport class constructMesh {\r\n\r\n  constructor (objectData, inputArg) {\r\n    this.inputArg = inputArg;\r\n    this.objectData = objectData;\r\n    this.create(objectData, inputArg);\r\n    this.setScale = (s) => {\r\n      this.inputArg.scale = s;\r\n      this.create(this.objectData, this.inputArg)\r\n    };\r\n    this.updateBuffers = () => {\r\n      this.inputArg.scale = [0.1,0.1,0.1];\r\n      this.create(this.objectData, this.inputArg);\r\n    };\r\n  }\r\n\r\n  create = (objectData, inputArg, callback) => {\r\n\r\n    if (typeof callback === 'undefined') callback = function() {};\r\n\r\n    let initOrientation = [0,1,2];\r\n    /*\r\n      The OBJ file format does a sort of compression when saving a model in a\r\n      program like Blender. There are at least 3 sections (4 including textures)\r\n      within the file. Each line in a section begins with the same string:\r\n        * 'v': indicates vertex section\r\n        * 'vn': indicates vertex normal section\r\n        * 'f': indicates the faces section\r\n        * 'vt': indicates vertex texture section (if textures were used on the model)\r\n      Each of the above sections (except for the faces section) is a list/set of\r\n      unique vertices.\r\n      Each line of the faces section contains a list of\r\n      (vertex, [texture], normal) groups\r\n      Some examples:\r\n          // the texture index is optional, both formats are possible for models\r\n          // without a texture applied\r\n          f 1/25 18/46 12/31\r\n          f 1//25 18//46 12//31\r\n          // A 3 vertex face with texture indices\r\n          f 16/92/11 14/101/22 1/69/1\r\n          // A 4 vertex face\r\n          f 16/92/11 40/109/40 38/114/38 14/101/22\r\n      The first two lines are examples of a 3 vertex face without a texture applied.\r\n      The second is an example of a 3 vertex face with a texture applied.\r\n      The third is an example of a 4 vertex face. Note: a face can contain N\r\n      number of vertices.\r\n      Each number that appears in one of the groups is a 1-based index\r\n      corresponding to an item from the other sections (meaning that indexing\r\n      starts at one and *not* zero).\r\n      For example:\r\n          `f 16/92/11` is saying to\r\n            - take the 16th element from the [v] vertex array\r\n            - take the 92nd element from the [vt] texture array\r\n            - take the 11th element from the [vn] normal array\r\n          and together they make a unique vertex.\r\n      Using all 3+ unique Vertices from the face line will produce a polygon.\r\n      Now, you could just go through the OBJ file and create a new vertex for\r\n      each face line and WebGL will draw what appears to be the same model.\r\n      However, vertices will be overlapped and duplicated all over the place.\r\n      Consider a cube in 3D space centered about the origin and each side is\r\n      2 units long. The front face (with the positive Z-axis pointing towards\r\n      you) would have a Top Right vertex (looking orthogonal to its normal)\r\n      mapped at (1,1,1) The right face would have a Top Left vertex (looking\r\n      orthogonal to its normal) at (1,1,1) and the top face would have a Bottom\r\n      Right vertex (looking orthogonal to its normal) at (1,1,1). Each face\r\n      has a vertex at the same coordinates, however, three distinct vertices\r\n      will be drawn at the same spot.\r\n      To solve the issue of duplicate Vertices (the `(vertex, [texture], normal)`\r\n      groups), while iterating through the face lines, when a group is encountered\r\n      the whole group string ('16/92/11') is checked to see if it exists in the\r\n      packed.hashindices object, and if it doesn't, the indices it specifies\r\n      are used to look up each attribute in the corresponding attribute arrays\r\n      already created. The values are then copied to the corresponding unpacked\r\n      array (flattened to play nice with WebGL's ELEMENT_ARRAY_BUFFER indexing),\r\n      the group string is added to the hashindices set and the current unpacked\r\n      index is used as this hashindices value so that the group of elements can\r\n      be reused. The unpacked index is incremented. If the group string already\r\n      exists in the hashindices object, its corresponding value is the index of\r\n      that group and is appended to the unpacked indices array.\r\n      */\r\n    var verts = [],\r\n      vertNormals = [],\r\n      textures = [],\r\n      unpacked = {};\r\n    // unpacking stuff\r\n    unpacked.verts = [];\r\n    unpacked.norms = [];\r\n    unpacked.textures = [];\r\n    unpacked.hashindices = {};\r\n    unpacked.indices = [];\r\n    unpacked.index = 0;\r\n    // array of lines separated by the newline\r\n    var lines = objectData.split('\\n');\r\n\r\n    // update swap orientation\r\n    if (inputArg.swap[0] !== null) {\r\n      swap(inputArg.swap[0], inputArg.swap[1], initOrientation);\r\n    }\r\n\r\n    var VERTEX_RE = /^v\\s/;\r\n    var NORMAL_RE = /^vn\\s/;\r\n    var TEXTURE_RE = /^vt\\s/;\r\n    var FACE_RE = /^f\\s/;\r\n    var WHITESPACE_RE = /\\s+/;\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n      var line = lines[i].trim();\r\n      var elements = line.split(WHITESPACE_RE);\r\n      elements.shift();\r\n\r\n      if (VERTEX_RE.test(line)) {\r\n        // if this is a vertex\r\n        verts.push.apply(verts, elements);\r\n      } else if (NORMAL_RE.test(line)) {\r\n        // if this is a vertex normal\r\n        vertNormals.push.apply(vertNormals, elements);\r\n      } else if (TEXTURE_RE.test(line)) {\r\n        // if this is a texture\r\n        textures.push.apply(textures, elements);\r\n      } else if (FACE_RE.test(line)) {\r\n        // if this is a face\r\n        /*\r\n          split this face into an array of vertex groups\r\n          for example:\r\n            f 16/92/11 14/101/22 1/69/1\r\n          becomes:\r\n            ['16/92/11', '14/101/22', '1/69/1'];\r\n          */\r\n        var quad = false;\r\n        for (var j = 0, eleLen = elements.length; j < eleLen; j++) {\r\n          // Triangulating quads\r\n          // quad: 'f v0/t0/vn0 v1/t1/vn1 v2/t2/vn2 v3/t3/vn3/'\r\n          // corresponding triangles:\r\n          //      'f v0/t0/vn0 v1/t1/vn1 v2/t2/vn2'\r\n          //      'f v2/t2/vn2 v3/t3/vn3 v0/t0/vn0'\r\n          if (j === 3 && !quad) {\r\n            // add v2/t2/vn2 in again before continuing to 3\r\n            j = 2;\r\n            quad = true;\r\n          }\r\n          if (elements[j] in unpacked.hashindices) {\r\n            unpacked.indices.push(unpacked.hashindices[elements[j]]);\r\n          } else {\r\n            /*\r\n                  Each element of the face line array is a vertex which has its\r\n                  attributes delimited by a forward slash. This will separate\r\n                  each attribute into another array:\r\n                      '19/92/11'\r\n                  becomes:\r\n                      vertex = ['19', '92', '11'];\r\n                  where\r\n                      vertex[0] is the vertex index\r\n                      vertex[1] is the texture index\r\n                      vertex[2] is the normal index\r\n                  Think of faces having Vertices which are comprised of the\r\n                  attributes location (v), texture (vt), and normal (vn).\r\n                  */\r\n            var vertex = elements[j].split('/');\r\n            /*\r\n                  The verts, textures, and vertNormals arrays each contain a\r\n                  flattend array of coordinates.\r\n                  Because it gets confusing by referring to vertex and then\r\n                  vertex (both are different in my descriptions) I will explain\r\n                  what's going on using the vertexNormals array:\r\n                  vertex[2] will contain the one-based index of the vertexNormals\r\n                  section (vn). One is subtracted from this index number to play\r\n                  nice with javascript's zero-based array indexing.\r\n                  Because vertexNormal is a flattened array of x, y, z values,\r\n                  simple pointer arithmetic is used to skip to the start of the\r\n                  vertexNormal, then the offset is added to get the correct\r\n                  component: +0 is x, +1 is y, +2 is z.\r\n                  This same process is repeated for verts and textures.\r\n                  */\r\n            // vertex position\r\n            unpacked.verts.push(+verts[(vertex[0] - 1) * 3 + initOrientation[0]] * inputArg.scale[0]);\r\n            unpacked.verts.push(+verts[(vertex[0] - 1) * 3 + initOrientation[1]] * inputArg.scale[1]);\r\n            unpacked.verts.push(+verts[(vertex[0] - 1) * 3 + initOrientation[2]] * inputArg.scale[2]);\r\n\r\n            // vertex textures\r\n            if (textures.length) {\r\n              unpacked.textures.push(+textures[(vertex[1] - 1) * 2 + 0]);\r\n              unpacked.textures.push(+textures[(vertex[1] - 1) * 2 + 1]);\r\n            }\r\n            // vertex normals\r\n            unpacked.norms.push(+vertNormals[(vertex[2] - 1) * 3 + 0]);\r\n            unpacked.norms.push(+vertNormals[(vertex[2] - 1) * 3 + 1]);\r\n            unpacked.norms.push(+vertNormals[(vertex[2] - 1) * 3 + 2]);\r\n            // add the newly created vertex to the list of indices\r\n            unpacked.hashindices[elements[j]] = unpacked.index;\r\n            unpacked.indices.push(unpacked.index);\r\n            // increment the counter\r\n            unpacked.index += 1;\r\n          }\r\n          if (j === 3 && quad) {\r\n            // add v0/t0/vn0 onto the second triangle\r\n            unpacked.indices.push(unpacked.hashindices[elements[0]]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.vertices = unpacked.verts;\r\n    this.vertexNormals = unpacked.norms;\r\n    this.textures = unpacked.textures;\r\n    this.indices = unpacked.indices;\r\n    callback();\r\n    return this;\r\n  };\r\n\r\n}\r\n\r\nvar Ajax = function () {\r\n  // this is just a helper class to ease ajax calls\r\n  var _this = this;\r\n  this.xmlhttp = new XMLHttpRequest();\r\n\r\n  this.get = function (url, callback) {\r\n    _this.xmlhttp.onreadystatechange = function () {\r\n      if (_this.xmlhttp.readyState === 4) {\r\n        callback(_this.xmlhttp.responseText, _this.xmlhttp.status);\r\n      }\r\n    };\r\n    _this.xmlhttp.open('GET', url, true);\r\n    _this.xmlhttp.send();\r\n  };\r\n};\r\n\r\n/**\r\n * Takes in an object of `mesh_name`, `'/url/to/OBJ/file'` pairs and a callback\r\n * function. Each OBJ file will be ajaxed in and automatically converted to\r\n * an OBJ.Mesh. When all files have successfully downloaded the callback\r\n * function provided will be called and passed in an object containing\r\n * the newly created meshes.\r\n *\r\n * **Note:** In order to use this function as a way to download meshes, a\r\n * webserver of some sort must be used.\r\n *\r\n * @param {Object} nameAndURLs an object where the key is the name of the mesh and the value is the url to that mesh's OBJ file\r\n *\r\n * @param {Function} completionCallback should contain a function that will take one parameter: an object array where the keys will be the unique object name and the value will be a Mesh object\r\n *\r\n * @param {Object} meshes In case other meshes are loaded separately or if a previously declared variable is desired to be used, pass in a (possibly empty) json object of the pattern: { '<mesh_name>': OBJ.Mesh }\r\n *\r\n */\r\nexport var downloadMeshes = function (nameAndURLs, completionCallback, inputArg) {\r\n  // the total number of meshes. this is used to implement \"blocking\"\r\n  var semaphore = Object.keys(nameAndURLs).length;\r\n  // if error is true, an alert will given\r\n  var error = false;\r\n  // this is used to check if all meshes have been downloaded\r\n  // if meshes is supplied, then it will be populated, otherwise\r\n  // a new object is created. this will be passed into the completionCallback\r\n  if (typeof inputArg === 'undefined') {\r\n    var inputArg = {\r\n      scale: [0.1,0.1,0.1],\r\n      swap: [null]\r\n     };\r\n  }\r\n  if (typeof inputArg.scale === 'undefined') inputArg.scale = [0.1,0.1,0.1];\r\n  if (typeof inputArg.swap === 'undefined') inputArg.swap = [null];\r\n\r\n  var meshes = {};\r\n\r\n  // loop over the mesh_name,url key,value pairs\r\n  for (var mesh_name in nameAndURLs) {\r\n    if (nameAndURLs.hasOwnProperty(mesh_name)) {\r\n      new Ajax().get(\r\n        nameAndURLs[mesh_name],\r\n        (function (name) {\r\n          return function (data, status) {\r\n            if (status === 200) {\r\n              meshes[name] = new constructMesh(data, inputArg);\r\n            } else {\r\n              error = true;\r\n              console.error('An error has occurred and the mesh \"' + name + '\" could not be downloaded.');\r\n            }\r\n            // the request has finished, decrement the counter\r\n            semaphore--;\r\n            if (semaphore === 0) {\r\n              if (error) {\r\n                // if an error has occurred, the user is notified here and the\r\n                // callback is not called\r\n                console.error('An error has occurred and one or meshes has not been ' + 'downloaded. The execution of the script has terminated.');\r\n                throw '';\r\n              }\r\n              // there haven't been any errors in retrieving the meshes\r\n              // call the callback\r\n              completionCallback(meshes);\r\n            }\r\n          };\r\n        })(mesh_name)\r\n      );\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Takes in the WebGL context and a Mesh, then creates and appends the buffers\r\n * to the mesh object as attributes.\r\n *\r\n * @param {WebGLRenderingContext} gl the `canvas.getContext('webgl')` context instance\r\n * @param {Mesh} mesh a single `OBJ.Mesh` instance\r\n *\r\n * The newly created mesh attributes are:\r\n *\r\n * Attrbute | Description\r\n * :--- | ---\r\n * **normalBuffer**       |contains the model&#39;s Vertex Normals\r\n * normalBuffer.itemSize  |set to 3 items\r\n * normalBuffer.numItems  |the total number of vertex normals\r\n * |\r\n * **textureBuffer**      |contains the model&#39;s Texture Coordinates\r\n * textureBuffer.itemSize |set to 2 items\r\n * textureBuffer.numItems |the number of texture coordinates\r\n * |\r\n * **vertexBuffer**       |contains the model&#39;s Vertex Position Coordinates (does not include w)\r\n * vertexBuffer.itemSize  |set to 3 items\r\n * vertexBuffer.numItems  |the total number of vertices\r\n * |\r\n * **indexBuffer**        |contains the indices of the faces\r\n * indexBuffer.itemSize   |is set to 1\r\n * indexBuffer.numItems   |the total number of indices\r\n *\r\n * A simple example (a lot of steps are missing, so don't copy and paste):\r\n *\r\n *     var gl   = canvas.getContext('webgl'),\r\n *         mesh = OBJ.Mesh(obj_file_data);\r\n *     // compile the shaders and create a shader program\r\n *     var shaderProgram = gl.createProgram();\r\n *     // compilation stuff here\r\n *     ...\r\n *     // make sure you have vertex, vertex normal, and texture coordinate\r\n *     // attributes located in your shaders and attach them to the shader program\r\n *     shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, \"aVertexPosition\");\r\n *     gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);\r\n *\r\n *     shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, \"aVertexNormal\");\r\n *     gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);\r\n *\r\n *     shaderProgram.textureCoordAttribute = gl.getAttribLocation(shaderProgram, \"aTextureCoord\");\r\n *     gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);\r\n *\r\n *     // create and initialize the vertex, vertex normal, and texture coordinate buffers\r\n *     // and save on to the mesh object\r\n *     OBJ.initMeshBuffers(gl, mesh);\r\n *\r\n *     // now to render the mesh\r\n *     gl.bindBuffer(gl.ARRAY_BUFFER, mesh.vertexBuffer);\r\n *     gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, mesh.vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n *     // it's possible that the mesh doesn't contain\r\n *     // any texture coordinates (e.g. suzanne.obj in the development branch).\r\n *     // in this case, the texture vertexAttribArray will need to be disabled\r\n *     // before the call to drawElements\r\n *     if(!mesh.textures.length){\r\n *       gl.disableVertexAttribArray(shaderProgram.textureCoordAttribute);\r\n *     }\r\n *     else{\r\n *       // if the texture vertexAttribArray has been previously\r\n *       // disabled, then it needs to be re-enabled\r\n *       gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);\r\n *       gl.bindBuffer(gl.ARRAY_BUFFER, mesh.textureBuffer);\r\n *       gl.vertexAttribPointer(shaderProgram.textureCoordAttribute, mesh.textureBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n *     }\r\n *\r\n *     gl.bindBuffer(gl.ARRAY_BUFFER, mesh.normalBuffer);\r\n *     gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, mesh.normalBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n *\r\n *     gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, model.mesh.indexBuffer);\r\n *     gl.drawElements(gl.TRIANGLES, model.mesh.indexBuffer.numItems, gl.UNSIGNED_SHORT, 0);\r\n */\r\nexport var initMeshBuffers = function (gl, mesh) {\r\n  // mesh.vertexNormals\r\n  // mesh.textures\r\n  // mesh.vertices\r\n  // mesh.indices\r\n};\r\n\r\n/**\r\n * @description\r\n * Construct sequence list argument for downloadMeshes.\r\n * This is adaptation for blender obj animation export.\r\n * For example:\r\n *    matrixEngine.objLoader.downloadMeshes(\r\n      matrixEngine.objLoader.makeObjSeqArg(\r\n        {\r\n          id: objName,\r\n          joinMultiPahts: [\r\n            {\r\n              path: \"res/bvh-skeletal-base/swat-guy/seq-walk/low/swat\",\r\n              id: objName,\r\n              from: 1, to: 34\r\n            },\r\n            {\r\n              path: \"res/bvh-skeletal-base/swat-guy/seq-walk-pistol/low/swat-walk-pistol\",\r\n              id: objName,\r\n              from: 35, to: 54\r\n            }\r\n          ]\r\n        }),\r\n      onLoadObj\r\n    );\r\n */\r\nexport const makeObjSeqArg = (arg) => {\r\n  // Adaptation for blender (animation) obj exporter.\r\n  var local = {};\r\n\r\n  function localCalc(arg, noInitial = false) {\r\n    var zeros = '00000';\r\n    var l = {};\r\n    var helper = arg.from;\r\n    for (let j = arg.from, z=1; j <= arg.to;j++ ) {\r\n\r\n      if (z > 9 && z < 99) {\r\n        zeros = '0000';\r\n      } else if (z > 99 && z < 999) {\r\n        zeros = '000';\r\n      } // no need more then 999\r\n\r\n      if (helper == arg.from && noInitial === false) {\r\n        l[arg.id] = arg.path + '_' + zeros + z + '.obj';\r\n      } else {\r\n        l[arg.id + (helper-1)] = arg.path + '_' + zeros + z + '.obj';\r\n      }\r\n      helper++;\r\n      z++;\r\n    }\r\n    return l;\r\n  }\r\n\r\n  if (typeof arg.path === 'string' ) {\r\n    local = localCalc(arg);\r\n  } else if (typeof arg.path === 'undefined')  {\r\n    if (typeof arg.joinMultiPahts !== 'undefined')  {\r\n      console.log(\"ITS joinMultiPahts!\");\r\n      var localFinal = {};\r\n      arg.joinMultiPahts.forEach((arg, index)=> {\r\n        if (index === 0) {\r\n          localFinal = Object.assign(local, localCalc(arg));\r\n        } else {\r\n          localFinal = Object.assign(local, localCalc(arg, true));\r\n        }\r\n      });\r\n      console.log(\"joinMultiPahts LOCAL => \", localFinal);\r\n      return localFinal;\r\n    }\r\n  }\r\n\r\n  return local;\r\n}\r\n\r\n/**\r\n * @description\r\n * Switching obj seq animations frames range.\r\n */\r\nexport function play (nameAni) {\r\n  this.animations.active = nameAni;\r\n  this.currentAni = this.animations[this.animations.active].from;\r\n  this.playing = true;\r\n}\r\n", "export let vertexShadowWGSL =  `struct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<uniform> model : Model;\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f\r\n) -> @builtin(position) vec4f {\r\n  return scene.lightViewProjMatrix * model.modelMatrix * vec4(position, 1);\r\n}\r\n`;", "import {OSCILLATOR} from \"./utils\";\r\n\r\n/**\r\n * @description\r\n * Can be reuse for any other tasks.\r\n * @author Nikola Lukic\r\n */\r\n\r\nexport default class Behavior {\r\n\r\n  status = \"Only oscillator\";\r\n\r\n  constructor() {\r\n    this.osc0 = new OSCILLATOR(0, 5, 0.01);\r\n  }\r\n\r\n  setOsc0(min,max, step){\r\n    this.osc0.min =min;\r\n    this.osc0.max =max;\r\n    this.osc0.step =step;\r\n  }\r\n\r\n  // apend - keep init origin\r\n  addPath(NUMBER) {\r\n    let inc = this.osc0.UPDATE();\r\n     console.log('test inc' ,inc)\r\n    console.log('test inc + number' ,(NUMBER + inc))\r\n    return (inc + NUMBER);\r\n  }\r\n\r\n  setPath0() {\r\n    return this.osc0.UPDATE();\r\n  }\r\n\r\n}", "export let vertexShadowWGSLInstanced =  `struct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\n// keep it for switch on end\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct InstanceData {\r\n  model : mat4x4<f32>,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n// @group(1) @binding(0) var<uniform> model : Model;\r\n@group(1) @binding(0) var<storage, read> instances : array<InstanceData>;\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @builtin(instance_index) instId: u32\r\n) -> @builtin(position) vec4f {\r\n   let worldPos = instances[instId].model * vec4(position, 1.0);\r\n  return scene.lightViewProjMatrix * worldPos;\r\n  // return scene.lightViewProjMatrix * model.modelMatrix * vec4(position, 1);\r\n}\r\n`;", "import {mat4, vec3} from 'wgpu-matrix';\r\nimport {vertexShadowWGSL} from '../shaders/vertexShadow.wgsl';\r\nimport Behavior from './behavior';\r\nimport {vertexShadowWGSLInstanced} from '../shaders/instanced/vertexShadow.instanced.wgsl';\r\n\r\n/**\r\n * @description\r\n * Spot light with shodow cast.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n */\r\nexport class SpotLight {\r\n  camera;\r\n  inputHandler;\r\n\r\n  position;\r\n  target;\r\n  up;\r\n  direction;\r\n\r\n  viewMatrix;\r\n  projectionMatrix;\r\n  viewProjMatrix;\r\n\r\n  fov;\r\n  aspect;\r\n  near;\r\n  far;\r\n\r\n  innerCutoff;\r\n  outerCutoff;\r\n\r\n  spotlightUniformBuffer;\r\n\r\n  constructor(\r\n    camera,\r\n    inputHandler,\r\n    device,\r\n    position = vec3.create(0, 10, -20),\r\n    target = vec3.create(0, 0, -20),\r\n    fov = 45, aspect = 1.0, near = 0.1, far = 200) {\r\n\r\n    this.fov = fov;\r\n    this.aspect = aspect;\r\n    this.near = near;\r\n    this.far = far;\r\n\r\n    this.camera = camera;\r\n    this.inputHandler = inputHandler;\r\n    this.position = position;\r\n    this.target = target;\r\n    this.up = vec3.create(0, 0, -1);\r\n    this.direction = vec3.normalize(vec3.subtract(target, position));\r\n    this.intensity = 1.0;\r\n    this.color = vec3.create(1.0, 1.0, 1.0); // white\r\n\r\n    this.viewMatrix = mat4.lookAt(position, target, this.up);\r\n    this.projectionMatrix = mat4.perspective(\r\n      (this.fov * Math.PI) / 180,\r\n      this.aspect,\r\n      this.near,\r\n      this.far\r\n    );\r\n\r\n    this.setProjection = function(fov = (2 * Math.PI) / 5, aspect = 1.0, near = 0.1, far = 200) {\r\n      this.projectionMatrix = mat4.perspective(fov, aspect, near, far);\r\n    }\r\n\r\n    this.updateProjection = function() {\r\n      this.projectionMatrix = mat4.perspective(this.fov, this.aspect, this.near, this.far);\r\n    }\r\n\r\n    this.device = device;\r\n    this.viewProjMatrix = mat4.multiply(this.projectionMatrix, this.viewMatrix);\r\n\r\n    this.fov = fov;\r\n    this.aspect = aspect;\r\n    this.near = near;\r\n    this.far = far;\r\n\r\n    this.innerCutoff = Math.cos((Math.PI / 180) * 20.0);\r\n    this.outerCutoff = Math.cos((Math.PI / 180) * 30.0);\r\n\r\n    this.ambientFactor = 0.5;\r\n    this.range = 20.0;\r\n    this.shadowBias = 0.01;\r\n\r\n    this.SHADOW_RES = 1024;\r\n    this.primitive = {\r\n      topology: 'triangle-list',\r\n      cullMode: 'back', // for front interest border drawen shadows !\r\n      frontFace: 'ccw'\r\n    }\r\n\r\n    this.shadowTexture = this.device.createTexture({\r\n      label: 'shadowTexture[light]',\r\n      size: [this.SHADOW_RES, this.SHADOW_RES, 1],\r\n      format: \"depth32float\",\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n\r\n    this.shadowSampler = device.createSampler({\r\n      label: 'shadowSampler[light]',\r\n      compare: 'less',\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n\r\n    this.renderPassDescriptor = {\r\n      label: \"renderPassDescriptor shadowPass [per SpotLigth]\",\r\n      colorAttachments: [],\r\n      depthStencilAttachment: {\r\n        view: this.shadowTexture.createView(),\r\n        depthClearValue: 1.0,\r\n        depthLoadOp: \"clear\",\r\n        depthStoreOp: \"store\",\r\n      },\r\n    }\r\n\r\n    this.uniformBufferBindGroupLayout = this.device.createBindGroupLayout({\r\n      label: 'uniformBufferBindGroupLayout in light',\r\n      entries: [\r\n        {\r\n          binding: 0,\r\n          visibility: GPUShaderStage.VERTEX,\r\n          buffer: {\r\n            type: 'uniform',\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    this.shadowBindGroupContainer = [];\r\n    this.shadowBindGroup = [];\r\n\r\n    this.getShadowBindGroup = (mesh, index) => {\r\n\r\n      if(this.shadowBindGroupContainer[index]) {\r\n        return this.shadowBindGroupContainer[index];\r\n      }\r\n\r\n      this.shadowBindGroupContainer[index] = this.device.createBindGroup({\r\n        label: 'sceneBindGroupForShadow in light',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            resource: {\r\n              buffer: mesh.sceneUniformBuffer,\r\n            },\r\n          },\r\n        ],\r\n      });\r\n      return this.shadowBindGroupContainer[index];\r\n    }\r\n\r\n    // test\r\n    this.getShadowBindGroup_bones = (index) => {\r\n\r\n      if(this.shadowBindGroup[index]) {\r\n        return this.shadowBindGroup[index];\r\n      }\r\n\r\n      this.modelUniformBuffer = this.device.createBuffer({\r\n        size: 4 * 16, // 4x4 matrix\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.shadowBindGroup[index] = this.device.createBindGroup({\r\n        label: 'model BindGroupForShadow in light',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            resource: {\r\n              buffer: this.modelUniformBuffer,\r\n            },\r\n          },\r\n        ],\r\n      });\r\n      return this.shadowBindGroup[index];\r\n    }\r\n\r\n    this.modelBindGroupLayout = this.device.createBindGroupLayout({\r\n      label: 'modelBindGroupLayout in light [one bindings]',\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform', }}\r\n      ]\r\n    });\r\n\r\n    this.modelBindGroupLayoutInstanced = this.device.createBindGroupLayout({\r\n      label: 'modelBindGroupLayout in light [for skinned] [instanced]',\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}, },\r\n      ],\r\n    });\r\n \r\n    this.shadowPipeline = this.device.createRenderPipeline({\r\n      label: 'shadowPipeline per light',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'createPipelineLayout - uniformBufferBindGroupLayout light [regular]',\r\n        bindGroupLayouts: [\r\n          this.uniformBufferBindGroupLayout,\r\n          this.modelBindGroupLayout,\r\n        ],\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({\r\n          code: vertexShadowWGSL,\r\n        }),\r\n        buffers: [\r\n          {\r\n            arrayStride: 12, // 3 * 4 bytes (vec3f)\r\n            attributes: [\r\n              {\r\n                shaderLocation: 0, // must match @location(0) in vertex shader\r\n                offset: 0,\r\n                format: \"float32x3\",\r\n              },\r\n            ],\r\n          },\r\n        ]\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth32float',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n\r\n    this.shadowPipelineInstanced = this.device.createRenderPipeline({\r\n      label: 'shadowPipeline [instanced] per light',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'createPipelineLayout - uniformBufferBindGroupLayout light [instanced]',\r\n        bindGroupLayouts: [\r\n          this.uniformBufferBindGroupLayout,\r\n          this.modelBindGroupLayoutInstanced,\r\n        ],\r\n      }),\r\n      vertex: {\r\n        module: this.device.createShaderModule({\r\n          code: vertexShadowWGSLInstanced,\r\n        }),\r\n        buffers: [\r\n          {\r\n            arrayStride: 12, // 3 * 4 bytes (vec3f)\r\n            attributes: [\r\n              {\r\n                shaderLocation: 0, // must match @location(0) in vertex shader\r\n                offset: 0,\r\n                format: \"float32x3\",\r\n              },\r\n            ],\r\n          },\r\n        ]\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth32float',\r\n      },\r\n      primitive: this.primitive,\r\n    });\r\n\r\n    this.getMainPassBindGroup = function(mesh) {\r\n      // You can cache it per mesh to avoid recreating each frame\r\n      if(!this.mainPassBindGroupContainer) this.mainPassBindGroupContainer = [];\r\n      const index = mesh._lightBindGroupIndex || 0; // assign unique per mesh if needed\r\n      if(this.mainPassBindGroupContainer[index]) {\r\n        return this.mainPassBindGroupContainer[index];\r\n      }\r\n      this.mainPassBindGroupContainer[index] = this.device.createBindGroup({\r\n        label: `mainPassBindGroup for mesh`,\r\n        layout: mesh.mainPassBindGroupLayout, // this should match the pipeline\r\n        entries: [\r\n          {\r\n            binding: 0, // must match @binding in shader for shadow texture\r\n            resource: this.shadowTexture.createView(),\r\n          },\r\n          {\r\n            binding: 1, // must match @binding in shader for shadow sampler\r\n            resource: this.shadowSampler,\r\n          },\r\n        ],\r\n      });\r\n      return this.mainPassBindGroupContainer[index];\r\n    }\r\n\r\n    // Only osc values +-\r\n    this.behavior = new Behavior();\r\n\r\n    // put here only func\r\n    this.updater = [];\r\n  }\r\n\r\n  update() {\r\n    this.updater.forEach((update) => {update(this)})\r\n    this.direction = vec3.normalize(vec3.subtract(this.target, this.position));\r\n    const target = vec3.add(this.position, this.direction);\r\n    this.viewMatrix = mat4.lookAt(this.position, target, this.up);\r\n    this.viewProjMatrix = mat4.multiply(this.projectionMatrix, this.viewMatrix);\r\n  }\r\n\r\n  getLightDataBuffer() {\r\n    const m = this.viewProjMatrix;\r\n    return new Float32Array([\r\n      ...this.position, 0.0,\r\n      ...this.direction, 0.0,\r\n      this.innerCutoff,\r\n      this.outerCutoff,\r\n      this.intensity,\r\n      0.0,\r\n      ...this.color,\r\n      0.0,\r\n      this.range,\r\n      this.ambientFactor,\r\n      this.shadowBias,  // <<--- use shadowBias\r\n      0.0,              // keep padding\r\n      ...m\r\n    ]);\r\n  }\r\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nexport let EPSILON = 0.000001;\n\n/**\n * Set the value for EPSILON for various checks\n * @param v - Value to use for EPSILON.\n * @returns previous value of EPSILON;\n */\nexport function setEpsilon(v: number): number {\n  const old = EPSILON;\n  EPSILON = v;\n  return old;\n}\n\n/**\n * Convert degrees to radians\n * @param degrees - Angle in degrees\n * @returns angle converted to radians\n */\nexport function degToRad(degrees: number): number {\n  return degrees * Math.PI / 180;\n}\n\n/**\n * Convert radians to degrees\n * @param radians - Angle in radians\n * @returns angle converted to degrees\n */\nexport function radToDeg(radians: number): number {\n  return radians * 180 / Math.PI;\n}\n\n/**\n * Lerps between a and b via t\n * @param a - starting value\n * @param b - ending value\n * @param t - value where 0 = a and 1 = b\n * @returns a + (b - a) * t\n */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/**\n * Compute the opposite of lerp. Given a and b and a value between\n * a and b returns a value between 0 and 1. 0 if a, 1 if b.\n * Note: no clamping is done.\n * @param a - start value\n * @param b - end value\n * @param v - value between a and b\n * @returns (v - a) / (b - a)\n */\nexport function inverseLerp(a: number, b: number, v: number): number {\n  const d = b - a;\n  return (Math.abs(b - a) < EPSILON)\n     ? a\n     : (v - a) / d;\n}\n\n/**\n * Compute the euclidean modulo\n *\n * ```\n * // table for n / 3\n * -5, -4, -3, -2, -1,  0,  1,  2,  3,  4,  5   <- n\n * ------------------------------------\n * -2  -1  -0  -2  -1   0,  1,  2,  0,  1,  2   <- n % 3\n *  1   2   0   1   2   0,  1,  2,  0,  1,  2   <- euclideanModule(n, 3)\n * ```\n *\n * @param n - dividend\n * @param m - divisor\n * @returns the euclidean modulo of n / m\n */\nexport function euclideanModulo(n: number, m: number) {\n  return ((n % m) + m) % m;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport { ArrayLike } from './array-like';\n\n/**\n * A JavaScript array with 2 values, Float32Array with 2 values, or a Float64Array with 2 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec2.setDefaultType}.\n */\nexport type Vec2 = ArrayLike;\n\n/**\n *\n * Vec2 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new Vec2. In other words you can do this\n *\n *     const v = vec2.cross(v1, v2);  // Creates a new Vec2 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec2.create();\n *     vec2.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec2.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec2 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec2\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Vec2\n */\nexport function setDefaultType(ctor: new (n: number) => Vec2) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values.\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Vec2's specified type\n * it would be faster to use\n *\n * ```\n * const v = vec2.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Vec2Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `vec2.create` is usually used\n * to create a Vec2 to be filled out as in\n *\n * ```\n * const sum = vec2.create();\n * vec2.add(v1, v2, sum);\n * ```\n *\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport function create(x = 0, y = 0): Vec2 {\n  const dst = new VecType(2);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n    }\n  }\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\nimport { Vec2, create, setDefaultType, VecType } from './vec2';\n\nexport default Vec2;\nexport { create, setDefaultType };\n\n/**\n * Creates a Vec2; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec2, min = 0, max = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec2, b: Vec2, scale: number, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec2, b: Vec2): number {\n  const ax = a[0];\n  const ay = a[1];\n  const bx = a[0];\n  const by = a[1];\n  const mag1 = Math.sqrt(ax * ax + ay * ay);\n  const mag2 = Math.sqrt(bx * bx + by * by);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec2, b: Vec2): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec2, b: Vec2): boolean {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec2, b: Vec2, t: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec2, b: Vec2, t: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec2, k: number, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(3);\n  const z = a[0] * b[1] - a[1] * b[0];\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = z;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec2, b: Vec2): number {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return Math.sqrt(v0 * v0 + v1 * v1);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec2): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  return v0 * v0 + v1 * v1;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec2, b: Vec2): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  return dx * dx + dy * dy;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const len = Math.sqrt(v0 * v0 + v1 * v1);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as clone)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as copy)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec2, b: Vec2, dst?: Vec2) {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec2, b: Vec2, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random unit vector * scale\n * @param scale - Default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const angle = Math.random() * 2 * Math.PI;\n  dst[0] = Math.cos(angle) * scale;\n  dst[1] = Math.sin(angle) * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  dst[0] = 0;\n  dst[1] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform Vec2 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec2, m: Mat4, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = x * m[0] + y * m[4] + m[12];\n  dst[1] = x * m[1] + y * m[5] + m[13];\n\n  return dst;\n}\n\n/**\n * Transforms vec4 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional Vec2 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec2, m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || new VecType(2);\n\n  const x = v[0];\n  const y = v[1];\n\n  dst[0] = m[0] * x + m[4] * y + m[8];\n  dst[1] = m[1] * x + m[5] * y + m[9];\n\n  return dst;\n}\n\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport { ArrayLikeCtor } from './array-like';\nimport * as utils from './utils.js';\nimport { Mat3 } from './mat3';\nimport Vec2, * as vec2 from './vec2-impl';\n\nexport default Mat3;\n\n/**\n * 3x3 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat3.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat3.create();\n *     mat3.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat3.identity();\n *     const trans = mat3.translation([1, 2, 3]);\n *     mat3.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: ArrayLikeCtor = Float32Array;\n\n// This mess is because with Mat3 we have 3 unused elements.\n// For Float32Array and Float64Array that's not an issue\n// but for Array it's troublesome\nconst ctorMap = new Map<ArrayLikeCtor,() => Mat3>([\n  [Float32Array, () => new Float32Array(12)],\n  [Float64Array, () => new Float64Array(12)],\n  [Array, () => new Array(12).fill(0)],\n]);\nlet newMat3: () => Mat3 = ctorMap.get(Float32Array)!;\n\n/**\n * Sets the type this library creates for a Mat3\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Mat3\n */\nexport function setDefaultType(ctor: new (n: number) => Mat3) {\n  const oldType = MatType;\n  MatType = ctor;\n  newMat3 = ctorMap.get(ctor)!;\n  return oldType;\n}\n\n/**\n * Create a Mat3 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat3's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat3.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat3Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat3.create` is usually used\n * to create a Mat3 to be filled out as in\n *\n * ```\n * const m = mat3.create();\n * mat3.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @returns matrix created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number,\n    v3?: number, v4?: number, v5?: number,\n    v6?: number, v7?: number, v8?: number): Mat3 {\n  const dst = newMat3();\n  // to make the array homogenous\n  dst[3] = 0;\n  dst[7] = 0;\n  dst[11] = 0;\n\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[4] = v3;\n          if (v4 !== undefined) {\n            dst[5] = v4;\n            if (v5 !== undefined) {\n              dst[6] = v5;\n              if (v6 !== undefined) {\n                dst[8] = v6;\n                if (v7 !== undefined) {\n                  dst[9] = v7;\n                  if (v8 !== undefined) {\n                    dst[10] = v8;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = -m[ 0];\n  dst[ 1] = -m[ 1];\n  dst[ 2] = -m[ 2];\n  dst[ 4] = -m[ 4];\n  dst[ 5] = -m[ 5];\n  dst[ 6] = -m[ 6];\n  dst[ 8] = -m[ 8];\n  dst[ 9] = -m[ 9];\n  dst[10] = -m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix.\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = m[ 0];\n  dst[ 1] = m[ 1];\n  dst[ 2] = m[ 2];\n\n  dst[ 4] = m[ 4];\n  dst[ 5] = m[ 5];\n  dst[ 6] = m[ 6];\n\n  dst[ 8] = m[ 8];\n  dst[ 9] = m[ 9];\n  dst[10] = m[10];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as copy)\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat3, b: Mat3): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a Operand matrix.\n * @param b Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat3, b: Mat3): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10];\n}\n\n/**\n * Creates a 3-by-3 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 3-by-3 identity matrix.\n */\nexport function identity(dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n  if (dst === m) {\n    let t: number;\n\n    // 0 1 2\n    // 4 5 6\n    // 8 9 10\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  dst[ 0] = m00;\n  dst[ 1] = m10;\n  dst[ 2] = m20;\n  dst[ 4] = m01;\n  dst[ 5] = m11;\n  dst[ 6] = m21;\n  dst[ 8] = m02;\n  dst[ 9] = m12;\n  dst[10] = m22;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  const m11_x_m22 = m11 * m22;\n  const m21_x_m12 = m21 * m12;\n  const m01_x_m22 = m01 * m22;\n  const m21_x_m02 = m21 * m02;\n  const m01_x_m12 = m01 * m12;\n  const m11_x_m02 = m11 * m02;\n\n  const invDet = 1 / (\n      m00 * (m11_x_m22 - m21_x_m12) -\n      m10 * (m01_x_m22 - m21_x_m02) +\n      m20 * (m01_x_m12 - m11_x_m02));\n\n  dst[ 0] = +(m11_x_m22 - m21_x_m12) * invDet;\n  dst[ 1] = -(m10 * m22 - m20 * m12) * invDet;\n  dst[ 2] = +(m10 * m21 - m20 * m11) * invDet;\n  dst[ 4] = -(m01_x_m22 - m21_x_m02) * invDet;\n  dst[ 5] = +(m00 * m22 - m20 * m02) * invDet;\n  dst[ 6] = -(m00 * m21 - m20 * m01) * invDet;\n  dst[ 8] = +(m01_x_m12 - m11_x_m02) * invDet;\n  dst[ 9] = -(m00 * m12 - m10 * m02) * invDet;\n  dst[10] = +(m00 * m11 - m10 * m01) * invDet;\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat3): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  return m00 * (m11 * m22 - m21 * m12) -\n         m10 * (m01 * m22 - m21 * m02) +\n         m20 * (m01 * m12 - m11 * m02);\n}\n\n/**\n * Computes the inverse of a 3-by-3 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat3, b: Mat3, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22;\n\n  return dst;\n}\n\n/**\n * Multiplies two 3-by-3 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 3-by-3 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n  }\n  dst[ 8] = v[0];\n  dst[ 9] = v[1];\n  dst[10] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 3-by-3 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  dst[0] = m[8];\n  dst[1] = m[9];\n  return dst;\n}\n\n/**\n * Returns an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y,\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat3, axis: number, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  return dst;\n}\n\n/**\n * Sets an axis of a 3x3 matrix as a vector with 2 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(m: Mat3, v: Vec2, axis: number, dst?: Mat3): Mat3 {\n  if (dst !== m) {\n    dst = copy(m, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat3, dst?: Vec2): Vec2 {\n  dst = dst || vec2.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const yx = m[4];\n  const yy = m[5];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy);\n  dst[1] = Math.sqrt(yx * yx + yy * yy);\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which translates by the given vector v.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 8] = v[0];\n  dst[ 9] = v[1];\n  dst[10] = 1;\n  return dst;\n}\n\n/**\n * Translates the given 3-by-3 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n  }\n\n  dst[ 8] = m00 * v0 + m10 * v1 + m20;\n  dst[ 9] = m01 * v0 + m11 * v1 + m21;\n  dst[10] = m02 * v0 + m12 * v1 + m22;\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which rotates  by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotation(angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;\n  dst[ 1] = s;\n  dst[ 2] = 0;\n  dst[ 4] = -s;\n  dst[ 5] = c;\n  dst[ 6] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 3-by-3 matrix  by the given angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotate(m: Mat3, angleInRadians: number, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 3-by-3 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     2 entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  dst[ 0] = v[0];\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = v[1];\n  dst[ 6] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 3-by-3 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of 2 entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat3, v: Vec2, dst?: Mat3): Mat3 {\n  dst = dst || newMat3();\n\n  const v0 = v[0];\n  const v1 = v[1];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n  }\n\n  return dst;\n}\n\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport { ArrayLike } from './array-like';\n\n/**\n * A JavaScript array with 3 values, Float32Array with 3 values, or a Float64Array with 3 values.\n * When created by the library will create the default type which is `Float32Array`\n * but can be set by calling {@link vec3.setDefaultType}.\n */\nexport type Vec3 = ArrayLike;\n\n/**\n *\n * Vec3 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec3`. In other words you can do this\n *\n *     const v = vec3.cross(v1, v2);  // Creates a new Vec3 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec3.create();\n *     vec3.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec3.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nexport let VecType: new (n: number) => Vec3 = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec3\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Vec3\n */\nexport function setDefaultType(ctor: new (n: number) => Vec3) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number) {\n  const dst = new VecType(3);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n      }\n    }\n  }\n  return dst;\n}", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport * as utils from './utils.js';\nimport { Vec3, create, setDefaultType, VecType } from './vec3';\nimport { Mat3 } from './mat3';\nimport { Mat4 } from './mat4';\n\nexport default Vec3;\nexport { create, setDefaultType };\n\n/**\n * Creates a vec3; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec3, min = 0, max = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec3, b: Vec3, scale: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n\n  return dst;\n}\n\n/**\n * Returns the angle in radians between two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns The angle in radians between the 2 vectors.\n */\nexport function angle(a: Vec3, b: Vec3): number {\n  const ax = a[0];\n  const ay = a[1];\n  const az = a[2];\n  const bx = a[0];\n  const by = a[1];\n  const bz = a[2];\n  const mag1 = Math.sqrt(ax * ax + ay * ay + az * az);\n  const mag2 = Math.sqrt(bx * bx + by * by + bz * bz);\n  const mag = mag1 * mag2;\n  const cosine = mag && dot(a, b) / mag;\n  return Math.acos(cosine);\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec3, b: Vec3): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec3, b: Vec3): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec3, b: Vec3, t: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec3, b: Vec3, t: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec3, k: number, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the cross product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of a cross b.\n */\nexport function cross(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const t1 = a[2] * b[0] - a[0] * b[2];\n  const t2 = a[0] * b[1] - a[1] * b[0];\n  dst[0] = a[1] * b[2] - a[2] * b[1];\n  dst[1] = t1;\n  dst[2] = t2;\n\n  return dst;\n}\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec3, b: Vec3): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec3): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  return v0 * v0 + v1 * v1 + v2 * v2;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec3, b: Vec3): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  return dx * dx + dy * dy + dz * dz;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n  }\n\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as clone)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as copy)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec3, b: Vec3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec3, b: Vec3, dst?: Vec3) {\n  dst = dst || new VecType(3);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Creates a random vector\n * @param scale - Default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns The random vector.\n */\nexport function random(scale = 1, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const angle = Math.random() * 2 * Math.PI;\n  const z = Math.random() * 2 - 1;\n  const zScale = Math.sqrt(1 - z * z) * scale;\n  dst[0] = Math.cos(angle) * zScale;\n  dst[1] = Math.sin(angle) * zScale;\n  dst[2] = z * scale;\n\n  return dst;\n}\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec3 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = (m[3] * x + m[7] * y + m[11] * z + m[15]) || 1;\n\n  dst[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  dst[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  dst[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n\n  return dst;\n}\n\n/**\n * Transform vec4 by upper 3x3 matrix inside 4x4 matrix.\n * @param v - The direction.\n * @param m - The matrix.\n * @param dst - optional Vec3 to store result. If not passed a new one is created.\n * @returns The transformed vector.\n */\nexport function transformMat4Upper3x3(v: Vec3, m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[0] = v0 * m[0 * 4 + 0] + v1 * m[1 * 4 + 0] + v2 * m[2 * 4 + 0];\n  dst[1] = v0 * m[0 * 4 + 1] + v1 * m[1 * 4 + 1] + v2 * m[2 * 4 + 1];\n  dst[2] = v0 * m[0 * 4 + 2] + v1 * m[1 * 4 + 2] + v2 * m[2 * 4 + 2];\n\n  return dst;\n}\n\n/**\n * Transforms vec4 by 3x3 matrix\n *\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec3 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat3(v: Vec3, m: Mat3, dst?: Vec3): Vec3 {\n  dst = dst || new VecType(3);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n\n  dst[0] = x * m[0] + y * m[4] + z * m[8];\n  dst[1] = x * m[1] + y * m[5] + z * m[9];\n  dst[2] = x * m[2] + y * m[6] + z * m[10];\n\n  return dst;\n}\n\n", "\nimport { ArrayLikeCtor } from './array-like';\nimport { Mat4 } from './mat4';\nimport Vec3, * as vec3 from './vec3-impl';\nimport * as utils from './utils';\n\nexport default Mat4;\n\n/**\n * 4x4 Matrix math math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new matrix. In other words you can do this\n *\n *     const mat = mat4.translation([1, 2, 3]);  // Creates a new translation matrix\n *\n * or\n *\n *     const mat = mat4.create();\n *     mat4.translation([1, 2, 3], mat);  // Puts translation matrix in mat.\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always save to pass any matrix as the destination. So for example\n *\n *     const mat = mat4.identity();\n *     const trans = mat4.translation([1, 2, 3]);\n *     mat4.multiply(mat, trans, mat);  // Multiplies mat * trans and puts result in mat.\n *\n */\nlet MatType: ArrayLikeCtor = Float32Array;\n\n/**\n * Sets the type this library creates for a Mat4\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Mat4\n */\nexport function setDefaultType(ctor: new (n: number) => Mat4) {\n  const oldType = MatType;\n  MatType = ctor;\n  return oldType;\n}\n\n/**\n * Create a Mat4 from values\n *\n * Note: Since passing in a raw JavaScript array\n * is valid in all circumstances, if you want to\n * force a JavaScript array into a Mat4's specified type\n * it would be faster to use\n *\n * ```\n * const m = mat4.clone(someJSArray);\n * ```\n *\n * Note: a consequence of the implementation is if your Mat4Type = `Array`\n * instead of `Float32Array` or `Float64Array` then any values you\n * don't pass in will be undefined. Usually this is not an issue since\n * (a) using `Array` is rare and (b) using `mat4.create` is usually used\n * to create a Mat4 to be filled out as in\n *\n * ```\n * const m = mat4.create();\n * mat4.perspective(fov, aspect, near, far, m);\n * ```\n *\n * @param v0 - value for element 0\n * @param v1 - value for element 1\n * @param v2 - value for element 2\n * @param v3 - value for element 3\n * @param v4 - value for element 4\n * @param v5 - value for element 5\n * @param v6 - value for element 6\n * @param v7 - value for element 7\n * @param v8 - value for element 8\n * @param v9 - value for element 9\n * @param v10 - value for element 10\n * @param v11 - value for element 11\n * @param v12 - value for element 12\n * @param v13 - value for element 13\n * @param v14 - value for element 14\n * @param v15 - value for element 15\n * @returns created from values.\n */\nexport function create(\n    v0?: number, v1?: number, v2?: number, v3?: number,\n    v4?: number, v5?: number, v6?: number, v7?: number,\n    v8?: number, v9?: number, v10?: number, v11?: number,\n    v12?: number, v13?: number, v14?: number, v15?: number): Mat4 {\n  const dst = new MatType(16);\n  if (v0 !== undefined) {\n    dst[0] = v0;\n    if (v1 !== undefined) {\n      dst[1] = v1;\n      if (v2 !== undefined) {\n        dst[2] = v2;\n        if (v3 !== undefined) {\n          dst[3] = v3;\n          if (v4 !== undefined) {\n            dst[4] = v4;\n            if (v5 !== undefined) {\n              dst[5] = v5;\n              if (v6 !== undefined) {\n                dst[6] = v6;\n                if (v7 !== undefined) {\n                  dst[7] = v7;\n                  if (v8 !== undefined) {\n                    dst[8] = v8;\n                    if (v9 !== undefined) {\n                      dst[9] = v9;\n                      if (v10 !== undefined) {\n                        dst[10] = v10;\n                        if (v11 !== undefined) {\n                          dst[11] = v11;\n                          if (v12 !== undefined) {\n                            dst[12] = v12;\n                            if (v13 !== undefined) {\n                              dst[13] = v13;\n                              if (v14 !== undefined) {\n                                dst[14] = v14;\n                                if (v15 !== undefined) {\n                                  dst[15] = v15;\n                                }\n                              }\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  return dst;\n}\n\n/**\n * Negates a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns -m.\n */\nexport function negate(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = -m[ 0];\n  dst[ 1] = -m[ 1];\n  dst[ 2] = -m[ 2];\n  dst[ 3] = -m[ 3];\n  dst[ 4] = -m[ 4];\n  dst[ 5] = -m[ 5];\n  dst[ 6] = -m[ 6];\n  dst[ 7] = -m[ 7];\n  dst[ 8] = -m[ 8];\n  dst[ 9] = -m[ 9];\n  dst[10] = -m[10];\n  dst[11] = -m[11];\n  dst[12] = -m[12];\n  dst[13] = -m[13];\n  dst[14] = -m[14];\n  dst[15] = -m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix.\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport function copy(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = m[ 0];\n  dst[ 1] = m[ 1];\n  dst[ 2] = m[ 2];\n  dst[ 3] = m[ 3];\n  dst[ 4] = m[ 4];\n  dst[ 5] = m[ 5];\n  dst[ 6] = m[ 6];\n  dst[ 7] = m[ 7];\n  dst[ 8] = m[ 8];\n  dst[ 9] = m[ 9];\n  dst[10] = m[10];\n  dst[11] = m[11];\n  dst[12] = m[12];\n  dst[13] = m[13];\n  dst[14] = m[14];\n  dst[15] = m[15];\n\n  return dst;\n}\n\n/**\n * Copies a matrix (same as copy)\n * @param m - The matrix.\n * @param dst - The matrix. If not passed a new one is created.\n * @returns A copy of m.\n */\nexport const clone = copy;\n\n/**\n * Check if 2 matrices are approximately equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are approximately equal\n */\nexport function equalsApproximately(a: Mat4, b: Mat4): boolean {\n  return Math.abs(a[ 0] - b[ 0]) < utils.EPSILON &&\n         Math.abs(a[ 1] - b[ 1]) < utils.EPSILON &&\n         Math.abs(a[ 2] - b[ 2]) < utils.EPSILON &&\n         Math.abs(a[ 3] - b[ 3]) < utils.EPSILON &&\n         Math.abs(a[ 4] - b[ 4]) < utils.EPSILON &&\n         Math.abs(a[ 5] - b[ 5]) < utils.EPSILON &&\n         Math.abs(a[ 6] - b[ 6]) < utils.EPSILON &&\n         Math.abs(a[ 7] - b[ 7]) < utils.EPSILON &&\n         Math.abs(a[ 8] - b[ 8]) < utils.EPSILON &&\n         Math.abs(a[ 9] - b[ 9]) < utils.EPSILON &&\n         Math.abs(a[10] - b[10]) < utils.EPSILON &&\n         Math.abs(a[11] - b[11]) < utils.EPSILON &&\n         Math.abs(a[12] - b[12]) < utils.EPSILON &&\n         Math.abs(a[13] - b[13]) < utils.EPSILON &&\n         Math.abs(a[14] - b[14]) < utils.EPSILON &&\n         Math.abs(a[15] - b[15]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 matrices are exactly equal\n * @param a - Operand matrix.\n * @param b - Operand matrix.\n * @returns true if matrices are exactly equal\n */\nexport function equals(a: Mat4, b: Mat4): boolean {\n  return a[ 0] === b[ 0] &&\n         a[ 1] === b[ 1] &&\n         a[ 2] === b[ 2] &&\n         a[ 3] === b[ 3] &&\n         a[ 4] === b[ 4] &&\n         a[ 5] === b[ 5] &&\n         a[ 6] === b[ 6] &&\n         a[ 7] === b[ 7] &&\n         a[ 8] === b[ 8] &&\n         a[ 9] === b[ 9] &&\n         a[10] === b[10] &&\n         a[11] === b[11] &&\n         a[12] === b[12] &&\n         a[13] === b[13] &&\n         a[14] === b[14] &&\n         a[15] === b[15];\n}\n\n/**\n * Creates a 4-by-4 identity matrix.\n *\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A 4-by-4 identity matrix.\n */\nexport function identity(dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Takes the transpose of a matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The transpose of m.\n */\nexport function transpose(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n  if (dst === m) {\n    let t;\n\n    t = m[1];\n    m[1] = m[4];\n    m[4] = t;\n\n    t = m[2];\n    m[2] = m[8];\n    m[8] = t;\n\n    t = m[3];\n    m[3] = m[12];\n    m[12] = t;\n\n    t = m[6];\n    m[6] = m[9];\n    m[9] = t;\n\n    t = m[7];\n    m[7] = m[13];\n    m[13] = t;\n\n    t = m[11];\n    m[11] = m[14];\n    m[14] = t;\n    return dst;\n  }\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  dst[ 0] = m00;\n  dst[ 1] = m10;\n  dst[ 2] = m20;\n  dst[ 3] = m30;\n  dst[ 4] = m01;\n  dst[ 5] = m11;\n  dst[ 6] = m21;\n  dst[ 7] = m31;\n  dst[ 8] = m02;\n  dst[ 9] = m12;\n  dst[10] = m22;\n  dst[11] = m32;\n  dst[12] = m03;\n  dst[13] = m13;\n  dst[14] = m23;\n  dst[15] = m33;\n\n  return dst;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix.\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport function inverse(m: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n  const tmp12 = m20 * m31;\n  const tmp13 = m30 * m21;\n  const tmp14 = m10 * m31;\n  const tmp15 = m30 * m11;\n  const tmp16 = m10 * m21;\n  const tmp17 = m20 * m11;\n  const tmp18 = m00 * m31;\n  const tmp19 = m30 * m01;\n  const tmp20 = m00 * m21;\n  const tmp21 = m20 * m01;\n  const tmp22 = m00 * m11;\n  const tmp23 = m10 * m01;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n      (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n      (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n      (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n      (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  const d = 1 / (m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3);\n\n  dst[ 0] = d * t0;\n  dst[ 1] = d * t1;\n  dst[ 2] = d * t2;\n  dst[ 3] = d * t3;\n  dst[ 4] = d * ((tmp1 * m10 + tmp2 * m20 + tmp5 * m30) -\n          (tmp0 * m10 + tmp3 * m20 + tmp4 * m30));\n  dst[ 5] = d * ((tmp0 * m00 + tmp7 * m20 + tmp8 * m30) -\n          (tmp1 * m00 + tmp6 * m20 + tmp9 * m30));\n  dst[ 6] = d * ((tmp3 * m00 + tmp6 * m10 + tmp11 * m30) -\n          (tmp2 * m00 + tmp7 * m10 + tmp10 * m30));\n  dst[ 7] = d * ((tmp4 * m00 + tmp9 * m10 + tmp10 * m20) -\n          (tmp5 * m00 + tmp8 * m10 + tmp11 * m20));\n  dst[ 8] = d * ((tmp12 * m13 + tmp15 * m23 + tmp16 * m33) -\n          (tmp13 * m13 + tmp14 * m23 + tmp17 * m33));\n  dst[ 9] = d * ((tmp13 * m03 + tmp18 * m23 + tmp21 * m33) -\n          (tmp12 * m03 + tmp19 * m23 + tmp20 * m33));\n  dst[10] = d * ((tmp14 * m03 + tmp19 * m13 + tmp22 * m33) -\n          (tmp15 * m03 + tmp18 * m13 + tmp23 * m33));\n  dst[11] = d * ((tmp17 * m03 + tmp20 * m13 + tmp23 * m23) -\n          (tmp16 * m03 + tmp21 * m13 + tmp22 * m23));\n  dst[12] = d * ((tmp14 * m22 + tmp17 * m32 + tmp13 * m12) -\n          (tmp16 * m32 + tmp12 * m12 + tmp15 * m22));\n  dst[13] = d * ((tmp20 * m32 + tmp12 * m02 + tmp19 * m22) -\n          (tmp18 * m22 + tmp21 * m32 + tmp13 * m02));\n  dst[14] = d * ((tmp18 * m12 + tmp23 * m32 + tmp15 * m02) -\n          (tmp22 * m32 + tmp14 * m02 + tmp19 * m12));\n  dst[15] = d * ((tmp22 * m22 + tmp16 * m02 + tmp21 * m12) -\n          (tmp20 * m12 + tmp23 * m22 + tmp17 * m02));\n\n  return dst;\n}\n\n/**\n * Compute the determinant of a matrix\n * @param m - the matrix\n * @returns the determinant\n */\nexport function determinant(m: Mat4): number {\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  const tmp0  = m22 * m33;\n  const tmp1  = m32 * m23;\n  const tmp2  = m12 * m33;\n  const tmp3  = m32 * m13;\n  const tmp4  = m12 * m23;\n  const tmp5  = m22 * m13;\n  const tmp6  = m02 * m33;\n  const tmp7  = m32 * m03;\n  const tmp8  = m02 * m23;\n  const tmp9  = m22 * m03;\n  const tmp10 = m02 * m13;\n  const tmp11 = m12 * m03;\n\n  const t0 = (tmp0 * m11 + tmp3 * m21 + tmp4 * m31) -\n             (tmp1 * m11 + tmp2 * m21 + tmp5 * m31);\n  const t1 = (tmp1 * m01 + tmp6 * m21 + tmp9 * m31) -\n             (tmp0 * m01 + tmp7 * m21 + tmp8 * m31);\n  const t2 = (tmp2 * m01 + tmp7 * m11 + tmp10 * m31) -\n             (tmp3 * m01 + tmp6 * m11 + tmp11 * m31);\n  const t3 = (tmp5 * m01 + tmp8 * m11 + tmp11 * m21) -\n             (tmp4 * m01 + tmp9 * m11 + tmp10 * m21);\n\n  return m00 * t0 + m10 * t1 + m20 * t2 + m30 * t3;\n}\n\n/**\n * Computes the inverse of a 4-by-4 matrix. (same as inverse)\n * @param m - The matrix.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The inverse of m.\n */\nexport const invert = inverse;\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport function multiply(a: Mat4, b: Mat4, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const a00 = a[0];\n  const a01 = a[1];\n  const a02 = a[2];\n  const a03 = a[3];\n  const a10 = a[ 4 + 0];\n  const a11 = a[ 4 + 1];\n  const a12 = a[ 4 + 2];\n  const a13 = a[ 4 + 3];\n  const a20 = a[ 8 + 0];\n  const a21 = a[ 8 + 1];\n  const a22 = a[ 8 + 2];\n  const a23 = a[ 8 + 3];\n  const a30 = a[12 + 0];\n  const a31 = a[12 + 1];\n  const a32 = a[12 + 2];\n  const a33 = a[12 + 3];\n  const b00 = b[0];\n  const b01 = b[1];\n  const b02 = b[2];\n  const b03 = b[3];\n  const b10 = b[ 4 + 0];\n  const b11 = b[ 4 + 1];\n  const b12 = b[ 4 + 2];\n  const b13 = b[ 4 + 3];\n  const b20 = b[ 8 + 0];\n  const b21 = b[ 8 + 1];\n  const b22 = b[ 8 + 2];\n  const b23 = b[ 8 + 3];\n  const b30 = b[12 + 0];\n  const b31 = b[12 + 1];\n  const b32 = b[12 + 2];\n  const b33 = b[12 + 3];\n\n  dst[ 0] = a00 * b00 + a10 * b01 + a20 * b02 + a30 * b03;\n  dst[ 1] = a01 * b00 + a11 * b01 + a21 * b02 + a31 * b03;\n  dst[ 2] = a02 * b00 + a12 * b01 + a22 * b02 + a32 * b03;\n  dst[ 3] = a03 * b00 + a13 * b01 + a23 * b02 + a33 * b03;\n  dst[ 4] = a00 * b10 + a10 * b11 + a20 * b12 + a30 * b13;\n  dst[ 5] = a01 * b10 + a11 * b11 + a21 * b12 + a31 * b13;\n  dst[ 6] = a02 * b10 + a12 * b11 + a22 * b12 + a32 * b13;\n  dst[ 7] = a03 * b10 + a13 * b11 + a23 * b12 + a33 * b13;\n  dst[ 8] = a00 * b20 + a10 * b21 + a20 * b22 + a30 * b23;\n  dst[ 9] = a01 * b20 + a11 * b21 + a21 * b22 + a31 * b23;\n  dst[10] = a02 * b20 + a12 * b21 + a22 * b22 + a32 * b23;\n  dst[11] = a03 * b20 + a13 * b21 + a23 * b22 + a33 * b23;\n  dst[12] = a00 * b30 + a10 * b31 + a20 * b32 + a30 * b33;\n  dst[13] = a01 * b30 + a11 * b31 + a21 * b32 + a31 * b33;\n  dst[14] = a02 * b30 + a12 * b31 + a22 * b32 + a32 * b33;\n  dst[15] = a03 * b30 + a13 * b31 + a23 * b32 + a33 * b33;\n\n  return dst;\n}\n\n/**\n * Multiplies two 4-by-4 matrices with a on the left and b on the right (same as multiply)\n * @param a - The matrix on the left.\n * @param b - The matrix on the right.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix product of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Sets the translation component of a 4-by-4 matrix to the given\n * vector.\n * @param a - The matrix.\n * @param v - The vector.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The matrix with translation set.\n */\nexport function setTranslation(a: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || identity();\n  if (a !== dst) {\n    dst[ 0] = a[ 0];\n    dst[ 1] = a[ 1];\n    dst[ 2] = a[ 2];\n    dst[ 3] = a[ 3];\n    dst[ 4] = a[ 4];\n    dst[ 5] = a[ 5];\n    dst[ 6] = a[ 6];\n    dst[ 7] = a[ 7];\n    dst[ 8] = a[ 8];\n    dst[ 9] = a[ 9];\n    dst[10] = a[10];\n    dst[11] = a[11];\n  }\n  dst[12] = v[0];\n  dst[13] = v[1];\n  dst[14] = v[2];\n  dst[15] = 1;\n  return dst;\n}\n\n/**\n * Returns the translation component of a 4-by-4 matrix as a vector with 3\n * entries.\n * @param m - The matrix.\n * @param dst - vector to hold result. If not passed a new one is created.\n * @returns The translation component of m.\n */\nexport function getTranslation(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  dst[0] = m[12];\n  dst[1] = m[13];\n  dst[2] = m[14];\n  return dst;\n}\n\n/**\n * Returns an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param axis - The axis 0 = x, 1 = y, 2 = z;\n * @returns The axis component of m.\n */\nexport function getAxis(m: Mat4, axis: number, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n  const off = axis * 4;\n  dst[0] = m[off + 0];\n  dst[1] = m[off + 1];\n  dst[2] = m[off + 2];\n  return dst;\n}\n\n/**\n * Sets an axis of a 4x4 matrix as a vector with 3 entries\n * @param m - The matrix.\n * @param v - the axis vector\n * @param axis - The axis  0 = x, 1 = y, 2 = z;\n * @param dst - The matrix to set. If not passed a new one is created.\n * @returns The matrix with axis set.\n */\nexport function setAxis(a: Mat4, v: Vec3, axis: number, dst: Mat4): Mat4 {\n  if (dst !== a) {\n    dst = copy(a, dst);\n  }\n  const off = axis * 4;\n  dst[off + 0] = v[0];\n  dst[off + 1] = v[1];\n  dst[off + 2] = v[2];\n  return dst;\n}\n\n/**\n * Returns the scaling component of the matrix\n * @param m - The Matrix\n * @param dst - The vector to set. If not passed a new one is created.\n */\nexport function getScaling(m: Mat4, dst?: Vec3): Vec3 {\n  dst = dst || vec3.create();\n\n  const xx = m[0];\n  const xy = m[1];\n  const xz = m[2];\n  const yx = m[4];\n  const yy = m[5];\n  const yz = m[6];\n  const zx = m[8];\n  const zy = m[9];\n  const zz = m[10];\n\n  dst[0] = Math.sqrt(xx * xx + xy * xy + xz * xz);\n  dst[1] = Math.sqrt(yx * yx + yy * yy + yz * yz);\n  dst[2] = Math.sqrt(zx * zx + zy * zy + zz * zz);\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the angular height\n * of the frustum, the aspect ratio, and the near and far clipping planes.  The\n * arguments define a frustum extending in the negative z direction.  The given\n * angle is the vertical angle of the frustum, and the horizontal angle is\n * determined to produce the given aspect ratio.  The arguments near and far are\n * the distances to the near and far clipping planes.  Note that near and far\n * are not z coordinates, but rather they are distances along the negative\n * z-axis.  The matrix generated sends the viewing frustum to the unit box.\n * We assume a unit box extending from -1 to 1 in the x and y dimensions and\n * from 0 to 1 in the z dimension.\n * @param fieldOfViewYInRadians - The camera angle from top to bottom (in radians).\n * @param aspect - The aspect ratio width / height.\n * @param zNear - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param zFar - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The perspective matrix.\n */\nexport function perspective(fieldOfViewYInRadians: number, aspect: number, zNear: number, zFar: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewYInRadians);\n  const rangeInv = 1 / (zNear - zFar);\n\n  dst[0]  = f / aspect;\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = f;\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[10] = zFar * rangeInv;\n  dst[11] = -1;\n\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = zNear * zFar * rangeInv;\n  dst[15] = 0;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 orthogonal transformation matrix that transforms from\n * the given the left, right, bottom, and top dimensions to -1 +1 in x, and y\n * and 0 to +1 in z.\n * @param left - Left side of the near clipping plane viewport.\n * @param right - Right side of the near clipping plane viewport.\n * @param bottom - Bottom of the near clipping plane viewport.\n * @param top - Top of the near clipping plane viewport.\n * @param near - The depth (negative z coordinate)\n *     of the near clipping plane.\n * @param far - The depth (negative z coordinate)\n *     of the far clipping plane.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The perspective matrix.\n */\nexport function ortho(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[0]  = 2 / (right - left);\n  dst[1]  = 0;\n  dst[2]  = 0;\n  dst[3]  = 0;\n\n  dst[4]  = 0;\n  dst[5]  = 2 / (top - bottom);\n  dst[6]  = 0;\n  dst[7]  = 0;\n\n  dst[8]  = 0;\n  dst[9]  = 0;\n  dst[10] = 1 / (near - far);\n  dst[11] = 0;\n\n  dst[12] = (right + left) / (left - right);\n  dst[13] = (top + bottom) / (bottom - top);\n  dst[14] = near / (near - far);\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Computes a 4-by-4 perspective transformation matrix given the left, right,\n * top, bottom, near and far clipping planes. The arguments define a frustum\n * extending in the negative z direction. The arguments near and far are the\n * distances to the near and far clipping planes. Note that near and far are not\n * z coordinates, but rather they are distances along the negative z-axis. The\n * matrix generated sends the viewing frustum to the unit box. We assume a unit\n * box extending from -1 to 1 in the x and y dimensions and from 0 to 1 in the z\n * dimension.\n * @param left - The x coordinate of the left plane of the box.\n * @param right - The x coordinate of the right plane of the box.\n * @param bottom - The y coordinate of the bottom plane of the box.\n * @param top - The y coordinate of the right plane of the box.\n * @param near - The negative z coordinate of the near plane of the box.\n * @param far - The negative z coordinate of the far plane of the box.\n * @param dst - Output matrix. If not passed a new one is created.\n * @returns The perspective projection matrix.\n */\nexport function frustum(left: number, right: number, bottom: number, top: number, near: number, far: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const dx = (right - left);\n  const dy = (top - bottom);\n  const dz = (near - far);\n\n  dst[ 0] = 2 * near / dx;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 2 * near / dy;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = (left + right) / dx;\n  dst[ 9] = (top + bottom) / dy;\n  dst[10] = far / dz;\n  dst[11] = -1;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = near * far / dz;\n  dst[15] = 0;\n\n  return dst;\n}\n\nlet xAxis: Vec3;\nlet yAxis: Vec3;\nlet zAxis: Vec3;\n\n/**\n * Computes a 4-by-4 look-at transformation.\n *\n * This is a matrix which positions the camera itself. If you want\n * a view matrix (a matrix which moves things in front of the camera)\n * take the inverse of this.\n *\n * @param eye - The position of the eye.\n * @param target - The position meant to be viewed.\n * @param up - A vector pointing up.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The look-at matrix.\n */\nexport function lookAt(eye: Vec3, target: Vec3, up: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  xAxis = xAxis || vec3.create();\n  yAxis = yAxis || vec3.create();\n  zAxis = zAxis || vec3.create();\n\n  vec3.normalize(\n      vec3.subtract(eye, target, zAxis), zAxis);\n  vec3.normalize(vec3.cross(up, zAxis, xAxis), xAxis);\n  vec3.normalize(vec3.cross(zAxis, xAxis, yAxis), yAxis);\n\n  dst[ 0] = xAxis[0];\n  dst[ 1] = xAxis[1];\n  dst[ 2] = xAxis[2];\n  dst[ 3] = 0;\n  dst[ 4] = yAxis[0];\n  dst[ 5] = yAxis[1];\n  dst[ 6] = yAxis[2];\n  dst[ 7] = 0;\n  dst[ 8] = zAxis[0];\n  dst[ 9] = zAxis[1];\n  dst[10] = zAxis[2];\n  dst[11] = 0;\n  dst[12] = eye[0];\n  dst[13] = eye[1];\n  dst[14] = eye[2];\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which translates by the given vector v.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translation matrix.\n */\nexport function translation(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n  dst[11] = 0;\n  dst[12] = v[0];\n  dst[13] = v[1];\n  dst[14] = v[2];\n  dst[15] = 1;\n  return dst;\n}\n\n/**\n * Translates the given 4-by-4 matrix by the given vector v.\n * @param m - The matrix.\n * @param v - The vector by\n *     which to translate.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The translated matrix.\n */\nexport function translate(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const m30 = m[3 * 4 + 0];\n  const m31 = m[3 * 4 + 1];\n  const m32 = m[3 * 4 + 2];\n  const m33 = m[3 * 4 + 3];\n\n  if (m !== dst) {\n    dst[ 0] = m00;\n    dst[ 1] = m01;\n    dst[ 2] = m02;\n    dst[ 3] = m03;\n    dst[ 4] = m10;\n    dst[ 5] = m11;\n    dst[ 6] = m12;\n    dst[ 7] = m13;\n    dst[ 8] = m20;\n    dst[ 9] = m21;\n    dst[10] = m22;\n    dst[11] = m23;\n  }\n\n  dst[12] = m00 * v0 + m10 * v1 + m20 * v2 + m30;\n  dst[13] = m01 * v0 + m11 * v1 + m21 * v2 + m31;\n  dst[14] = m02 * v0 + m12 * v1 + m22 * v2 + m32;\n  dst[15] = m03 * v0 + m13 * v1 + m23 * v2 + m33;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the x-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationX(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = 1;\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = c;\n  dst[ 6] = s;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = -s;\n  dst[10] = c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the x-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateX(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[4]  = c * m10 + s * m20;\n  dst[5]  = c * m11 + s * m21;\n  dst[6]  = c * m12 + s * m22;\n  dst[7]  = c * m13 + s * m23;\n  dst[8]  = c * m20 - s * m10;\n  dst[9]  = c * m21 - s * m11;\n  dst[10] = c * m22 - s * m12;\n  dst[11] = c * m23 - s * m13;\n\n  if (m !== dst) {\n    dst[ 0] = m[ 0];\n    dst[ 1] = m[ 1];\n    dst[ 2] = m[ 2];\n    dst[ 3] = m[ 3];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the y-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationY(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;\n  dst[ 1] = 0;\n  dst[ 2] = -s;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = 1;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = s;\n  dst[ 9] = 0;\n  dst[10] = c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the y-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateY(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m20 = m[2 * 4 + 0];\n  const m21 = m[2 * 4 + 1];\n  const m22 = m[2 * 4 + 2];\n  const m23 = m[2 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 - s * m20;\n  dst[ 1] = c * m01 - s * m21;\n  dst[ 2] = c * m02 - s * m22;\n  dst[ 3] = c * m03 - s * m23;\n  dst[ 8] = c * m20 + s * m00;\n  dst[ 9] = c * m21 + s * m01;\n  dst[10] = c * m22 + s * m02;\n  dst[11] = c * m23 + s * m03;\n\n  if (m !== dst) {\n    dst[ 4] = m[ 4];\n    dst[ 5] = m[ 5];\n    dst[ 6] = m[ 6];\n    dst[ 7] = m[ 7];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the z-axis by the given angle.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotation matrix.\n */\nexport function rotationZ(angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c;\n  dst[ 1] = s;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = -s;\n  dst[ 5] = c;\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = 1;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the z-axis by the given\n * angle.\n * @param m - The matrix.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function rotateZ(m: Mat4, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const m00 = m[0 * 4 + 0];\n  const m01 = m[0 * 4 + 1];\n  const m02 = m[0 * 4 + 2];\n  const m03 = m[0 * 4 + 3];\n  const m10 = m[1 * 4 + 0];\n  const m11 = m[1 * 4 + 1];\n  const m12 = m[1 * 4 + 2];\n  const m13 = m[1 * 4 + 3];\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n\n  dst[ 0] = c * m00 + s * m10;\n  dst[ 1] = c * m01 + s * m11;\n  dst[ 2] = c * m02 + s * m12;\n  dst[ 3] = c * m03 + s * m13;\n  dst[ 4] = c * m10 - s * m00;\n  dst[ 5] = c * m11 - s * m01;\n  dst[ 6] = c * m12 - s * m02;\n  dst[ 7] = c * m13 - s * m03;\n\n  if (m !== dst) {\n    dst[ 8] = m[ 8];\n    dst[ 9] = m[ 9];\n    dst[10] = m[10];\n    dst[11] = m[11];\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport function axisRotation(axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  dst[ 0] = xx + (1 - xx) * c;\n  dst[ 1] = x * y * oneMinusCosine + z * s;\n  dst[ 2] = x * z * oneMinusCosine - y * s;\n  dst[ 3] = 0;\n  dst[ 4] = x * y * oneMinusCosine - z * s;\n  dst[ 5] = yy + (1 - yy) * c;\n  dst[ 6] = y * z * oneMinusCosine + x * s;\n  dst[ 7] = 0;\n  dst[ 8] = x * z * oneMinusCosine + y * s;\n  dst[ 9] = y * z * oneMinusCosine - x * s;\n  dst[10] = zz + (1 - zz) * c;\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Creates a 4-by-4 matrix which rotates around the given axis by the given\n * angle. (same as axisRotation)\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns A matrix which rotates angle radians\n *     around the axis.\n */\nexport const rotation = axisRotation;\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle.\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport function axisRotate(m: Mat4, axis: Vec3, angleInRadians: number, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  let x = axis[0];\n  let y = axis[1];\n  let z = axis[2];\n  const n = Math.sqrt(x * x + y * y + z * z);\n  x /= n;\n  y /= n;\n  z /= n;\n  const xx = x * x;\n  const yy = y * y;\n  const zz = z * z;\n  const c = Math.cos(angleInRadians);\n  const s = Math.sin(angleInRadians);\n  const oneMinusCosine = 1 - c;\n\n  const r00 = xx + (1 - xx) * c;\n  const r01 = x * y * oneMinusCosine + z * s;\n  const r02 = x * z * oneMinusCosine - y * s;\n  const r10 = x * y * oneMinusCosine - z * s;\n  const r11 = yy + (1 - yy) * c;\n  const r12 = y * z * oneMinusCosine + x * s;\n  const r20 = x * z * oneMinusCosine + y * s;\n  const r21 = y * z * oneMinusCosine - x * s;\n  const r22 = zz + (1 - zz) * c;\n\n  const m00 = m[0];\n  const m01 = m[1];\n  const m02 = m[2];\n  const m03 = m[3];\n  const m10 = m[4];\n  const m11 = m[5];\n  const m12 = m[6];\n  const m13 = m[7];\n  const m20 = m[8];\n  const m21 = m[9];\n  const m22 = m[10];\n  const m23 = m[11];\n\n  dst[ 0] = r00 * m00 + r01 * m10 + r02 * m20;\n  dst[ 1] = r00 * m01 + r01 * m11 + r02 * m21;\n  dst[ 2] = r00 * m02 + r01 * m12 + r02 * m22;\n  dst[ 3] = r00 * m03 + r01 * m13 + r02 * m23;\n  dst[ 4] = r10 * m00 + r11 * m10 + r12 * m20;\n  dst[ 5] = r10 * m01 + r11 * m11 + r12 * m21;\n  dst[ 6] = r10 * m02 + r11 * m12 + r12 * m22;\n  dst[ 7] = r10 * m03 + r11 * m13 + r12 * m23;\n  dst[ 8] = r20 * m00 + r21 * m10 + r22 * m20;\n  dst[ 9] = r20 * m01 + r21 * m11 + r22 * m21;\n  dst[10] = r20 * m02 + r21 * m12 + r22 * m22;\n  dst[11] = r20 * m03 + r21 * m13 + r22 * m23;\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n\n/**\n * Rotates the given 4-by-4 matrix around the given axis by the\n * given angle. (same as rotate)\n * @param m - The matrix.\n * @param axis - The axis\n *     about which to rotate.\n * @param angleInRadians - The angle by which to rotate (in radians).\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The rotated matrix.\n */\nexport const rotate = axisRotate;\n\n/**\n * Creates a 4-by-4 matrix which scales in each dimension by an amount given by\n * the corresponding entry in the given vector; assumes the vector has three\n * entries.\n * @param v - A vector of\n *     three entries specifying the factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaling matrix.\n */\nexport function scaling(v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  dst[ 0] = v[0];\n  dst[ 1] = 0;\n  dst[ 2] = 0;\n  dst[ 3] = 0;\n  dst[ 4] = 0;\n  dst[ 5] = v[1];\n  dst[ 6] = 0;\n  dst[ 7] = 0;\n  dst[ 8] = 0;\n  dst[ 9] = 0;\n  dst[10] = v[2];\n  dst[11] = 0;\n  dst[12] = 0;\n  dst[13] = 0;\n  dst[14] = 0;\n  dst[15] = 1;\n\n  return dst;\n}\n\n/**\n * Scales the given 4-by-4 matrix in each dimension by an amount\n * given by the corresponding entry in the given vector; assumes the vector has\n * three entries.\n * @param m - The matrix to be modified.\n * @param v - A vector of three entries specifying the\n *     factor by which to scale in each dimension.\n * @param dst - matrix to hold result. If not passed a new one is created.\n * @returns The scaled matrix.\n */\nexport function scale(m: Mat4, v: Vec3, dst?: Mat4): Mat4 {\n  dst = dst || new MatType(16);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n\n  dst[ 0] = v0 * m[0 * 4 + 0];\n  dst[ 1] = v0 * m[0 * 4 + 1];\n  dst[ 2] = v0 * m[0 * 4 + 2];\n  dst[ 3] = v0 * m[0 * 4 + 3];\n  dst[ 4] = v1 * m[1 * 4 + 0];\n  dst[ 5] = v1 * m[1 * 4 + 1];\n  dst[ 6] = v1 * m[1 * 4 + 2];\n  dst[ 7] = v1 * m[1 * 4 + 3];\n  dst[ 8] = v2 * m[2 * 4 + 0];\n  dst[ 9] = v2 * m[2 * 4 + 1];\n  dst[10] = v2 * m[2 * 4 + 2];\n  dst[11] = v2 * m[2 * 4 + 3];\n\n  if (m !== dst) {\n    dst[12] = m[12];\n    dst[13] = m[13];\n    dst[14] = m[14];\n    dst[15] = m[15];\n  }\n\n  return dst;\n}\n", "/*\n * Copyright 2022 Gregg Tavares\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport { ArrayLikeCtor } from './array-like';\nimport * as utils from './utils.js';\nimport { Mat4 } from './mat4';\nimport { Vec4 } from './vec4';\n\nexport default Vec4;\n\n/**\n *\n * Vec4 math functions.\n *\n * Almost all functions take an optional `dst` argument. If it is not passed in the\n * functions will create a new `Vec4`. In other words you can do this\n *\n *     const v = vec4.cross(v1, v2);  // Creates a new Vec4 with the cross product of v1 x v2.\n *\n * or\n *\n *     const v = vec4.create();\n *     vec4.cross(v1, v2, v);  // Puts the cross product of v1 x v2 in v\n *\n * The first style is often easier but depending on where it's used it generates garbage where\n * as there is almost never allocation with the second style.\n *\n * It is always safe to pass any vector as the destination. So for example\n *\n *     vec4.cross(v1, v2, v1);  // Puts the cross product of v1 x v2 in v1\n *\n */\n\nlet VecType: ArrayLikeCtor = Float32Array;\n\n/**\n * Sets the type this library creates for a Vec4\n * @param ctor - the constructor for the type. Either `Float32Array`, 'Float64Array', or `Array`\n * @returns previous constructor for Vec4\n */\nexport function setDefaultType(ctor: new (n: number) => Vec4) {\n  const oldType = VecType;\n  VecType = ctor;\n  return oldType;\n}\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values.\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param w - Initial w value.\n * @returns the created vector\n */\nexport function create(x?: number, y?: number, z?: number, w?: number): Vec4 {\n  const dst = new VecType(4);\n  if (x !== undefined) {\n    dst[0] = x;\n    if (y !== undefined) {\n      dst[1] = y;\n      if (z !== undefined) {\n        dst[2] = z;\n        if (w !== undefined) {\n          dst[3] = w;\n        }\n      }\n    }\n  }\n  return dst;\n}\n\n/**\n * Creates a vec4; may be called with x, y, z to set initial values. (same as create)\n * @param x - Initial x value.\n * @param y - Initial y value.\n * @param z - Initial z value.\n * @param z - Initial w value.\n * @returns the created vector\n */\nexport const fromValues = create;\n\n/**\n * Applies Math.ceil to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the ceil of each element of v.\n */\nexport function ceil(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.ceil(v[0]);\n  dst[1] = Math.ceil(v[1]);\n  dst[2] = Math.ceil(v[2]);\n  dst[3] = Math.ceil(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.floor to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the floor of each element of v.\n */\nexport function floor(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.floor(v[0]);\n  dst[1] = Math.floor(v[1]);\n  dst[2] = Math.floor(v[2]);\n  dst[3] = Math.floor(v[3]);\n\n  return dst;\n}\n\n/**\n * Applies Math.round to each element of vector\n * @param v - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the round of each element of v.\n */\nexport function round(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.round(v[0]);\n  dst[1] = Math.round(v[1]);\n  dst[2] = Math.round(v[2]);\n  dst[3] = Math.round(v[3]);\n\n  return dst;\n}\n\n/**\n * Clamp each element of vector between min and max\n * @param v - Operand vector.\n * @param max - Min value, default 0\n * @param min - Max value, default 1\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that the clamped value of each element of v.\n */\nexport function clamp(v: Vec4, min = 0, max = 1, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(max, Math.max(min, v[0]));\n  dst[1] = Math.min(max, Math.max(min, v[1]));\n  dst[2] = Math.min(max, Math.max(min, v[2]));\n  dst[3] = Math.min(max, Math.max(min, v[3]));\n\n  return dst;\n}\n\n/**\n * Adds two vectors; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a and b.\n */\nexport function add(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0];\n  dst[1] = a[1] + b[1];\n  dst[2] = a[2] + b[2];\n  dst[3] = a[3] + b[3];\n\n  return dst;\n}\n\n/**\n * Adds two vectors, scaling the 2nd; assumes a and b have the same dimension.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param scale - Amount to scale b\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the sum of a + b * scale.\n */\nexport function addScaled(a: Vec4, b: Vec4, scale: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + b[0] * scale;\n  dst[1] = a[1] + b[1] * scale;\n  dst[2] = a[2] + b[2] * scale;\n  dst[3] = a[3] + b[3] * scale;\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport function subtract(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] - b[0];\n  dst[1] = a[1] - b[1];\n  dst[2] = a[2] - b[2];\n  dst[3] = a[3] - b[3];\n\n  return dst;\n}\n\n/**\n * Subtracts two vectors.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A vector that is the difference of a and b.\n */\nexport const sub = subtract;\n\n/**\n * Check if 2 vectors are approximately equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are approximately equal\n */\nexport function equalsApproximately(a: Vec4, b: Vec4): boolean {\n  return Math.abs(a[0] - b[0]) < utils.EPSILON &&\n         Math.abs(a[1] - b[1]) < utils.EPSILON &&\n         Math.abs(a[2] - b[2]) < utils.EPSILON &&\n         Math.abs(a[3] - b[3]) < utils.EPSILON;\n}\n\n/**\n * Check if 2 vectors are exactly equal\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns true if vectors are exactly equal\n */\nexport function equals(a: Vec4, b: Vec4): boolean {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficient.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The linear interpolated result.\n */\nexport function lerp(a: Vec4, b: Vec4, t: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t * (b[0] - a[0]);\n  dst[1] = a[1] + t * (b[1] - a[1]);\n  dst[2] = a[2] + t * (b[2] - a[2]);\n  dst[3] = a[3] + t * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Performs linear interpolation on two vectors.\n * Given vectors a and b and interpolation coefficient vector t, returns\n * a + t * (b - a).\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param t - Interpolation coefficients vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns the linear interpolated result.\n */\nexport function lerpV(a: Vec4, b: Vec4, t: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] + t[0] * (b[0] - a[0]);\n  dst[1] = a[1] + t[1] * (b[1] - a[1]);\n  dst[2] = a[2] + t[2] * (b[2] - a[2]);\n  dst[3] = a[3] + t[3] * (b[3] - a[3]);\n\n  return dst;\n}\n\n/**\n * Return max values of two vectors.\n * Given vectors a and b returns\n * [max(a[0], b[0]), max(a[1], b[1]), max(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The max components vector.\n */\nexport function max(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.max(a[0], b[0]);\n  dst[1] = Math.max(a[1], b[1]);\n  dst[2] = Math.max(a[2], b[2]);\n  dst[3] = Math.max(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Return min values of two vectors.\n * Given vectors a and b returns\n * [min(a[0], b[0]), min(a[1], b[1]), min(a[2], b[2])].\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The min components vector.\n */\nexport function min(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = Math.min(a[0], b[0]);\n  dst[1] = Math.min(a[1], b[1]);\n  dst[2] = Math.min(a[2], b[2]);\n  dst[3] = Math.min(a[3], b[3]);\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function mulScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] * k;\n  dst[1] = v[1] * k;\n  dst[2] = v[2] * k;\n  dst[3] = v[3] * k;\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by a scalar. (same as mulScalar)\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport const scale = mulScalar;\n\n/**\n * Divides a vector by a scalar.\n * @param v - The vector.\n * @param k - The scalar.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The scaled vector.\n */\nexport function divScalar(v: Vec4, k: number, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0] / k;\n  dst[1] = v[1] / k;\n  dst[2] = v[2] / k;\n  dst[3] = v[3] / k;\n\n  return dst;\n}\n\n/**\n * Inverse a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport function inverse(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 1 / v[0];\n  dst[1] = 1 / v[1];\n  dst[2] = 1 / v[2];\n  dst[3] = 1 / v[3];\n\n  return dst;\n}\n\n/**\n * Invert a vector. (same as inverse)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The inverted vector.\n */\nexport const invert = inverse;\n\n/**\n * Computes the dot product of two vectors; assumes both vectors have\n * three entries.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @returns dot product\n */\nexport function dot(a: Vec4, b: Vec4): number {\n  return (a[0] * b[0]) + (a[1] * b[1]) + (a[2] * b[2]) + (a[3] * b[3]);\n}\n\n/**\n * Computes the length of vector\n * @param v - vector.\n * @returns length of vector.\n */\nexport function length(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n}\n\n/**\n * Computes the length of vector (same as length)\n * @param v - vector.\n * @returns length of vector.\n */\nexport const len = length;\n\n/**\n * Computes the square of the length of vector\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport function lengthSq(v: Vec4): number {\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  return v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3;\n}\n\n/**\n * Computes the square of the length of vector (same as lengthSq)\n * @param v - vector.\n * @returns square of the length of vector.\n */\nexport const lenSq = lengthSq;\n\n/**\n * Computes the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport function distance(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return Math.sqrt(dx * dx + dy * dy + dz * dz + dw * dw);\n}\n\n/**\n * Computes the distance between 2 points (same as distance)\n * @param a - vector.\n * @param b - vector.\n * @returns distance between a and b\n */\nexport const dist = distance;\n\n/**\n * Computes the square of the distance between 2 points\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport function distanceSq(a: Vec4, b: Vec4): number {\n  const dx = a[0] - b[0];\n  const dy = a[1] - b[1];\n  const dz = a[2] - b[2];\n  const dw = a[3] - b[3];\n  return dx * dx + dy * dy + dz * dz + dw * dw;\n}\n\n/**\n * Computes the square of the distance between 2 points (same as distanceSq)\n * @param a - vector.\n * @param b - vector.\n * @returns square of the distance between a and b\n */\nexport const distSq = distanceSq;\n\n/**\n * Divides a vector by its Euclidean length and returns the quotient.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The normalized vector.\n */\nexport function normalize(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const v0 = v[0];\n  const v1 = v[1];\n  const v2 = v[2];\n  const v3 = v[3];\n  const len = Math.sqrt(v0 * v0 + v1 * v1 + v2 * v2 + v3 * v3);\n\n  if (len > 0.00001) {\n    dst[0] = v0 / len;\n    dst[1] = v1 / len;\n    dst[2] = v2 / len;\n    dst[3] = v3 / len;\n  } else {\n    dst[0] = 0;\n    dst[1] = 0;\n    dst[2] = 0;\n    dst[3] = 0;\n  }\n\n  return dst;\n}\n\n/**\n * Negates a vector.\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns -v.\n */\nexport function negate(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = -v[0];\n  dst[1] = -v[1];\n  dst[2] = -v[2];\n  dst[3] = -v[3];\n\n  return dst;\n}\n\n/**\n * Copies a vector. (same as clone)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport function copy(v: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = v[0];\n  dst[1] = v[1];\n  dst[2] = v[2];\n  dst[3] = v[3];\n\n  return dst;\n}\n\n/**\n * Clones a vector. (same as copy)\n * @param v - The vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns A copy of v.\n */\nexport const clone = copy;\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport function multiply(a: Vec4, b: Vec4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] * b[0];\n  dst[1] = a[1] * b[1];\n  dst[2] = a[2] * b[2];\n  dst[3] = a[3] * b[3];\n\n  return dst;\n}\n\n/**\n * Multiplies a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as mul)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of products of entries of a and b.\n */\nexport const mul = multiply;\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length.\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport function divide(a: Vec4, b: Vec4, dst?: Vec4) {\n  dst = dst || new VecType(4);\n\n  dst[0] = a[0] / b[0];\n  dst[1] = a[1] / b[1];\n  dst[2] = a[2] / b[2];\n  dst[3] = a[3] / b[3];\n\n  return dst;\n}\n\n/**\n * Divides a vector by another vector (component-wise); assumes a and\n * b have the same length. (same as divide)\n * @param a - Operand vector.\n * @param b - Operand vector.\n * @param dst - vector to hold result. If not new one is created.\n * @returns The vector of quotients of entries of a and b.\n */\nexport const div = divide;\n\n/**\n * Zero's a vector\n * @param dst - vector to hold result. If not new one is created.\n * @returns The zeroed vector.\n */\nexport function zero(dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  dst[0] = 0;\n  dst[1] = 0;\n  dst[2] = 0;\n  dst[3] = 0;\n\n  return dst;\n}\n\n\n/**\n * transform vec4 by 4x4 matrix\n * @param v - the vector\n * @param m - The matrix.\n * @param dst - optional vec4 to store result. If not passed a new one is created.\n * @returns the transformed vector\n */\nexport function transformMat4(v: Vec4, m: Mat4, dst?: Vec4): Vec4 {\n  dst = dst || new VecType(4);\n\n  const x = v[0];\n  const y = v[1];\n  const z = v[2];\n  const w = v[3];\n\n  dst[0] = m[0] * x + m[4] * y + m[ 8] * z + m[12] * w;\n  dst[1] = m[1] * x + m[5] * y + m[ 9] * z + m[13] * w;\n  dst[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  dst[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n\n  return dst;\n}\n", "import * as types from './array-like';\nimport * as mat3 from './mat3-impl';\nimport * as mat4 from './mat4-impl';\nimport * as vec2 from './vec2-impl';\nimport * as vec3 from './vec3-impl';\nimport * as vec4 from './vec4-impl';\nimport * as utils from './utils';\n\n/**\n * Sets the type this library creates for all types\n * @remarks\n *\n * example:\n *\n * ```\n * setDefaultType(Float64Array);\n * ```\n *\n * @param ctor - the constructor for the type. Either `Float32Array`, `Float64Array`, or `Array`\n */\nexport function setDefaultType(ctor: new (n: number) => Float32Array | Float64Array | number[]) {\n  mat3.setDefaultType(ctor);\n  mat4.setDefaultType(ctor);\n  vec2.setDefaultType(ctor);\n  vec3.setDefaultType(ctor);\n  vec4.setDefaultType(ctor);\n}\n\nexport {\n  mat3,\n  mat4,\n  types,  // for docs\n  utils,\n  vec2,\n  vec3,\n  vec4,\n};", "import {mat4} from 'webgpu-matrix';\r\n/**\r\n * @description Manual convert python script BVH\r\n * from https://github.com/dabeschte/npybvh to the JS.\r\n * @author Nikola Lukic\r\n * @license GPL-V3\r\n */\r\n\r\nexport function degToRad(degrees) {return (degrees * Math.PI) / 180};\r\n\r\nfunction arraySum3(a, b) {\r\n  var rez1 = a[0] + b[0];\r\n  var rez2 = a[1] + b[1];\r\n  var rez3 = a[2] + b[2];\r\n  return [rez1, rez2, rez3];\r\n}\r\n\r\nfunction deg2rad(degrees) {\r\n  return degrees * (Math.PI / 180);\r\n}\r\n\r\nfunction npdeg2rad(degrees) {\r\n  return [degrees[0] * (Math.PI / 180),\r\n  degrees[1] * (Math.PI / 180),\r\n  degrees[2] * (Math.PI / 180)];\r\n}\r\n\r\nfunction rad2deg(radians) {\r\n  return radians * (180 / Math.PI);\r\n}\r\n\r\nfunction byId(id) {\r\n  return document.getElementById(id);\r\n}\r\n\r\n// fix for .dot N-dim vs 1D-dim Array\r\nexport function dot3vs1(a, b) {\r\n  var aNumRows = a.length, aNumCols = a[0].length,\r\n    bNumRows = b.length;\r\n  var REZ1 = 0, REZ2 = 0, REZ3 = 0;\r\n  if(aNumRows == 3 && aNumCols == 3 &&\r\n    bNumRows == 3) {\r\n    for(var j = 0;j < a.length;j++) {\r\n      // First root of 3x3 a.\r\n      REZ1 += a[0][j] * b[j];\r\n      REZ2 += a[1][j] * b[j];\r\n      REZ3 += a[2][j] * b[j];\r\n    }\r\n    var finalRez = [REZ1, REZ2, REZ3];\r\n    return finalRez;\r\n  } else {\r\n    console.error(\"Bad arguments for dot3vs1\");\r\n  }\r\n}\r\n\r\nexport function multiply(a, b) {\r\n  var aNumRows = a.length, aNumCols = a[0].length,\r\n    bNumRows = b.length, bNumCols = b[0].length,\r\n    m = new Array(aNumRows);\r\n  for(var r = 0;r < aNumRows;++r) {\r\n    m[r] = new Array(bNumCols);\r\n    for(var c = 0;c < bNumCols;++c) {\r\n      m[r][c] = 0;\r\n      for(var i = 0;i < aNumCols;++i) {\r\n        m[r][c] += a[r][i] * b[i][c];\r\n      }\r\n    }\r\n  }\r\n  return m;\r\n}\r\n\r\n/**\r\n * @description\r\n * Euler's rotation theorem tells us that any rotation in 3D can be described by 3\r\n * angles.  Let's call the 3 angles the *Euler angle vector* and call the angles\r\n * in the vector :Math:`alpha`, :Math:`beta` and :Math:`gamma`.  The vector is [\r\n * :Math:`alpha`, :Math:`beta`. :Math:`gamma` ] and, in this description, the\r\n * order of the parameters specifies the order in which the rotations occur (so\r\n * the rotation corresponding to :Math:`alpha` is applied first).\r\n * @source https://github.com/matthew-brett/transforms3d/blob/master/transforms3d/euler.py\r\n */\r\n\r\n// map axes strings to/from tuples of inner axis, parity, repetition, frame\r\nvar _AXES2TUPLE = {\r\n  'sxyz': [0, 0, 0, 0], 'sxyx': [0, 0, 1, 0], 'sxzy': [0, 1, 0, 0],\r\n  'sxzx': [0, 1, 1, 0], 'syzx': [1, 0, 0, 0], 'syzy': [1, 0, 1, 0],\r\n  'syxz': [1, 1, 0, 0], 'syxy': [1, 1, 1, 0], 'szxy': [2, 0, 0, 0],\r\n  'szxz': [2, 0, 1, 0], 'szyx': [2, 1, 0, 0], 'szyz': [2, 1, 1, 0],\r\n  'rzyx': [0, 0, 0, 1], 'rxyx': [0, 0, 1, 1], 'ryzx': [0, 1, 0, 1],\r\n  'rxzx': [0, 1, 1, 1], 'rxzy': [1, 0, 0, 1], 'ryzy': [1, 0, 1, 1],\r\n  'rzxy': [1, 1, 0, 1], 'ryxy': [1, 1, 1, 1], 'ryxz': [2, 0, 0, 1],\r\n  'rzxz': [2, 0, 1, 1], 'rxyz': [2, 1, 0, 1], 'rzyz': [2, 1, 1, 1]\r\n};\r\n\r\n// axis sequences for Euler angles\r\nvar _NEXT_AXIS = [1, 2, 0, 1];\r\n\r\nexport function euler2mat(ai, aj, ak, axes) {\r\n  if(typeof axes === 'undefined') var axes = 'sxyz';\r\n  // Return rotation matrix from Euler angles and axis sequence.\r\n  // Parameters\r\n  /*\r\n  ai : float\r\n      First rotation angle (according to `axes`).\r\n  aj : float\r\n      Second rotation angle (according to `axes`).\r\n  ak : float\r\n      Third rotation angle (according to `axes`).\r\n  axes : str, optional\r\n      Axis specification; one of 24 axis sequences as string or encoded\r\n      tuple - e.g. ``sxyz`` (the default).\r\n  Returns\r\n  -------\r\n  mat : array (3, 3)\r\n      Rotation matrix or affine.\r\n  Examples\r\n  --------\r\n  >>> R = euler2mat(1, 2, 3, 'syxz')\r\n  >>> np.allclose(np.sum(R[0]), -1.34786452)\r\n  True\r\n  >>> R = euler2mat(1, 2, 3, (0, 1, 0, 1))\r\n  >>> np.allclose(np.sum(R[0]), -0.383436184)\r\n  True */\r\n  try {\r\n    var firstaxis = _AXES2TUPLE[axes][0],\r\n      parity = _AXES2TUPLE[axes][1],\r\n      repetition = _AXES2TUPLE[axes][2],\r\n      frame = _AXES2TUPLE[axes][3];\r\n  }\r\n  catch(AttributeError) {\r\n    // _TUPLE2AXES[axes]  # validation\r\n    // firstaxis, parity, repetition, frame = axes\r\n    console.error(\"AttributeError: \", AttributeError);\r\n  }\r\n\r\n  var i = firstaxis;\r\n  var j = _NEXT_AXIS[i + parity];\r\n  var k = _NEXT_AXIS[i - parity + 1];\r\n\r\n  if(frame) {\r\n    ai = ak;\r\n    ak = ai;\r\n  }\r\n  if(parity) {\r\n    ai = -ai;\r\n    aj = -aj;\r\n    ak = -ak;\r\n  }\r\n\r\n  var si = Math.sin(ai);\r\n  var sj = Math.sin(aj);\r\n  var sk = Math.sin(ak);\r\n  var ci = Math.cos(ai);\r\n  var cj = Math.cos(aj);\r\n  var ck = Math.cos(ak);\r\n  var cc = ci * ck;\r\n  var cs = ci * sk;\r\n  var sc = si * ck;\r\n  var ss = si * sk;\r\n\r\n  // M = np.eye(3)\r\n  var M = [\r\n    [1., 0., 0],\r\n    [0., 1., 0],\r\n    [0., 0., 1]\r\n  ];\r\n\r\n  if(repetition) {\r\n    M[i][i] = cj;\r\n    M[i][j] = sj * si;\r\n    M[i][k] = sj * ci;\r\n    M[j][i] = sj * sk;\r\n    M[j][j] = -cj * ss + cc;\r\n    M[j][k] = -cj * cs - sc;\r\n    M[k][i] = -sj * ck;\r\n    M[k][j] = cj * sc + cs;\r\n    M[k][k] = cj * cc - ss;\r\n  } else {\r\n    M[i][i] = cj * ck;\r\n    M[i][j] = sj * sc - cs;\r\n    M[i][k] = sj * cc + ss;\r\n    M[j][i] = cj * sk;\r\n    M[j][j] = sj * ss + cc;\r\n    M[j][k] = sj * cs - sc;\r\n    M[k][i] = -sj;\r\n    M[k][j] = cj * si;\r\n    M[k][k] = cj * ci;\r\n  }\r\n  return M;\r\n}\r\n\r\n/**\r\n * @description\r\n * How to calculate the angle from rotation matrix.\r\n */\r\nexport function mat2euler(M, rad2deg_flag) {\r\n  var pitch_1, pitch_2,\r\n    roll_1, roll_2,\r\n    yaw_1, yaw_2,\r\n    pitch, roll, yaw;\r\n\r\n  if(M[2][0] != 1 & M[2][0] != -1) {\r\n    pitch_1 = -1 * Math.asin(M[2][0]);\r\n    pitch_2 = Math.PI - pitch_1;\r\n    roll_1 = Math.atan2(M[2][1] / Math.cos(pitch_1), M[2][2] / Math.cos(pitch_1));\r\n    roll_2 = Math.atan2(M[2][1] / Math.cos(pitch_2), M[2][2] / Math.cos(pitch_2));\r\n    yaw_1 = Math.atan2(M[1][0] / Math.cos(pitch_1), M[0][0] / Math.cos(pitch_1));\r\n    yaw_2 = Math.atan2(M[1][0] / Math.cos(pitch_2), M[0][0] / Math.cos(pitch_2));\r\n    pitch = pitch_1;\r\n    roll = roll_1;\r\n    yaw = yaw_1;\r\n  } else {\r\n    yaw = 0;\r\n    if(M[2][0] == -1) {\r\n      pitch = Math.PI / 2;\r\n      roll = yaw + Math.atan2(M[0][1], M[0][2]);\r\n    } else {\r\n      pitch = -Math.PI / 2;\r\n      roll = -1 * yaw + Math.atan2(-1 * M[0][1], -1 * M[0][2]);\r\n    }\r\n  }\r\n\r\n  if(typeof rad2deg_flag !== \"undefined\") {\r\n    // convert from radians to degrees\r\n    roll = (roll * 180) / Math.PI;\r\n    pitch = (pitch * 180) / Math.PI;\r\n    yaw = (yaw * 180) / Math.PI;\r\n  }\r\n\r\n  return [roll, pitch, yaw];\r\n}\r\n\r\nexport class MEBvhJoint {\r\n\r\n  constructor(name, parent) {\r\n    this.name = name;\r\n    this.parent = parent;\r\n\r\n    this.offset = [\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n    ];\r\n\r\n    this.channels = [];\r\n    this.children = [];\r\n\r\n    // New: where in the frame array this joint\u2019s channels start ???\r\n    this.channelOffset = 0;\r\n  }\r\n\r\n  add_child(child) {\r\n    this.children.push(child);\r\n  }\r\n\r\n  __repr__() {\r\n    return this.name;\r\n  }\r\n\r\n  position_animated() {\r\n    var detFlag = false;\r\n    for(const item in this.channels) {\r\n      if(this.channels[item].endsWith(\"position\") == true) {\r\n        detFlag = true;\r\n      }\r\n    }\r\n    return detFlag;\r\n  }\r\n\r\n  rotation_animated() {\r\n    var detFlag = false;\r\n    for(const item in this.channels) {\r\n      if(this.channels[item].endsWith(\"rotation\") == true) {\r\n        detFlag = true;\r\n      }\r\n    }\r\n    return detFlag;\r\n  }\r\n\r\n  createIdentityMatrix() {\r\n    // Returns a flat Float32Array of length 16 (column-major)\r\n    return new Float32Array([\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n    ]);\r\n  }\r\n\r\n  matrixFromKeyframe(frameData) {\r\n    const m = this.createIdentityMatrix();\r\n    let t = [0, 0, 0];\r\n    let r = [0, 0, 0];\r\n\r\n    for(let i = 0;i < this.channels.length;i++) {\r\n      const channel = this.channels[i];\r\n      const value = frameData[this.channelOffset + i];\r\n      // channelOffset = index into frameData where this joint\u2019s values start\r\n\r\n      switch(channel) {\r\n        case 'Xposition': t[0] = value; break;\r\n        case 'Yposition': t[1] = value; break;\r\n        case 'Zposition': t[2] = value; break;\r\n        case 'Xrotation': r[0] = degToRad(value); break;\r\n        case 'Yrotation': r[1] = degToRad(value); break;\r\n        case 'Zrotation': r[2] = degToRad(value); break;\r\n      }\r\n    }\r\n\r\n    // Apply translation\r\n    mat4.translate(m, t, m);\r\n    // Apply rotations in BVH order (important!)\r\n    mat4.rotateX(m, r[0], m);\r\n    mat4.rotateY(m, r[1], m);\r\n    mat4.rotateZ(m, r[2], m);\r\n\r\n    return m;\r\n  }\r\n}\r\n\r\nexport class MEBvh {\r\n  constructor() {\r\n    this.joints = {};\r\n    this.root = null;\r\n    this.keyframes = null;\r\n    this.frames = 0;\r\n    this.fps = 0;\r\n    this.myName = \"MATRIX-ENGINE-BVH\";\r\n    // new\r\n    this.jointOrder = []; // array to store joints in order\r\n  }\r\n\r\n  computeJointOrder() {\r\n    this.jointOrder = [];\r\n    const traverse = joint => {\r\n      this.jointOrder.push(joint.name);\r\n      for(const child of joint.children) {\r\n        traverse(child);\r\n      }\r\n    };\r\n    traverse(this.root); // root is your MEBvhJoint\r\n  }\r\n\r\n  computeChannelOffsets() {\r\n    let offset = 0;\r\n    const walk = (joint) => {\r\n      joint.channelOffset = offset;        // assign\r\n      offset += joint.channels.length;     // advance\r\n      for(const child of joint.children) {\r\n        walk(child);\r\n      }\r\n    };\r\n    if(this.root) walk(this.root);\r\n    this.totalChannels = offset; // store total for frame allocation\r\n  }\r\n\r\n  async parse_file(link) {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(link).then(event => {\r\n        event.text().then(text => {\r\n\r\n          var hierarchy = text.split(\"MOTION\")[0];\r\n          var motion = text.split(\"MOTION\")[1];\r\n\r\n          var newLog = document.createElement(\"div\");\r\n          newLog.innerHTML += '<h2>Hierarchy</h2>';\r\n          newLog.innerHTML += '<p>' + hierarchy + '</p>';\r\n          var newLog2 = document.createElement(\"span\");\r\n          newLog2.innerHTML += '<h2>Motion</h2>';\r\n          newLog2.innerHTML += '<p class=\"paragraf fixHeight\" >' + motion + '</p>';\r\n\r\n          if(byId && byId('log') !== null) {\r\n            byId('log').appendChild(newLog2);\r\n            byId('log').appendChild(newLog);\r\n          }\r\n\r\n          this._parse_hierarchy(hierarchy);\r\n\r\n          this.computeJointOrder()\r\n\r\n          this.computeChannelOffsets(); // <\u2014 must do this here NEW\r\n          this.parse_motion(motion);\r\n\r\n          resolve();\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  _parse_hierarchy(text) {\r\n    var lines = text.split(/\\s*\\n+\\s*/);\r\n    var joint_stack = [];\r\n\r\n    for(var key in lines) {\r\n      var line = lines[key];\r\n      var words = line.split(/\\s+/);\r\n      var instruction = words[0];\r\n      var parent = null;\r\n\r\n      if(instruction == \"JOINT\" || instruction == \"ROOT\") {\r\n        if(instruction == \"JOINT\") {\r\n          // -1 py -> last item\r\n          parent = joint_stack[joint_stack.length - 1];\r\n        } else {\r\n          parent = null;\r\n        }\r\n\r\n        var joint = new MEBvhJoint(words[1], parent);\r\n\r\n        this.joints[joint.name] = joint;\r\n        if(parent != null) {\r\n          parent.add_child(joint);\r\n        }\r\n        joint_stack.push(joint);\r\n        if(instruction == \"ROOT\") {\r\n          this.root = joint;\r\n        }\r\n      } else if(instruction == \"CHANNELS\") {\r\n        for(var j = 2;j < words.length;j++) {\r\n          joint_stack[joint_stack.length - 1].channels.push(words[j]);\r\n        }\r\n      } else if(instruction == \"OFFSET\") {\r\n        for(var j = 1;j < words.length;j++) {\r\n          joint_stack[joint_stack.length - 1].offset[j - 1] = parseFloat(\r\n            words[j]\r\n          );\r\n        }\r\n      } else if(instruction == \"End\") {\r\n        var joint = new MEBvhJoint(\r\n          joint_stack[joint_stack.length - 1].name + \"_end\",\r\n          joint_stack[joint_stack.length - 1]\r\n        );\r\n        joint_stack[joint_stack.length - 1].add_child(joint);\r\n        joint_stack.push(joint);\r\n        this.joints[joint.name] = joint;\r\n      } else if(instruction == \"}\") {\r\n        joint_stack.pop();\r\n      }\r\n    }\r\n  }\r\n\r\n  _add_pose_recursive(joint, offset, poses) {\r\n\r\n    var newLog1 = document.createElement(\"span\");\r\n    newLog1.innerHTML += '<h2>add_pose_recursive</h2>';\r\n    newLog1.innerHTML += '<p class=\"paragraf\" >Joint Name: ' + joint.name + '</p>';\r\n    newLog1.innerHTML += '<p>joint.parent    : ' + (joint.parent != null ? joint.parent.name : 'null') + '</p>';\r\n    newLog1.innerHTML += '<p>joint.offset    : ' + joint.offset + '</p>';\r\n    newLog1.innerHTML += '<p>joint.children.length  : ' + joint.children.length + '</p>';\r\n\r\n    (joint.children.length != 0 ? newLog1.innerHTML += '<p> Childrens: ' : newLog1.innerHTML += 'No Childrens ');\r\n    joint.children.forEach(iJoint => {\r\n      newLog1.innerHTML += ' ' + iJoint['name'] + ' , ';\r\n    });\r\n    newLog1.innerHTML += '</p>';\r\n\r\n    newLog1.innerHTML += '<p>Argument offset : ' + offset + '</p>';\r\n    byId('log').appendChild(newLog1);\r\n\r\n    var pose = arraySum3(joint.offset, offset);\r\n    poses.push(pose);\r\n\r\n    for(var c in joint.children) {\r\n      this._add_pose_recursive(joint.children[c], pose, poses);\r\n    }\r\n  }\r\n\r\n  plot_hierarchy() {\r\n    // import matplotlib.pyplot as plt\r\n    // from mpl_toolkits.mplot3d import axes3d, Axes3D\r\n\r\n    var poses = [];\r\n    this._add_pose_recursive(this.root, [0, 0, 0], poses);\r\n\r\n    // pos = np.array(poses);\r\n\r\n    /* Draw staff DISABLED\r\n        fig = plt.figure()\r\n        ax = fig.add_subplot(111, projection='3d')\r\n        ax.scatter(pos[:, 0], pos[:, 2], pos[:, 1])\r\n        ax.set_xlim(-30, 30)\r\n        ax.set_ylim(-30, 30)\r\n        ax.set_zlim(-30, 30)\r\n        plt.show() */\r\n  }\r\n\r\n  parse_motion(text) {\r\n\r\n    var lines = text.split(/\\s*\\n+\\s*/);\r\n    var frame = 0;\r\n    for(var key in lines) {\r\n      var line = lines[key];\r\n      if(line == \"\") {continue;}\r\n      var words = line.split(/\\s+/);\r\n      if(line.startsWith(\"Frame Time:\")) {\r\n        this.fps = Math.round(1 / parseFloat(words[2]));\r\n        continue;\r\n      }\r\n      if(line.startsWith(\"Frames:\")) {\r\n        this.frames = parseInt(words[1]);\r\n        continue;\r\n      }\r\n      if(this.keyframes == null) {\r\n        // OK this is just costruction (define) with random values.\r\n        var localArr = Array.from(Array(this.frames), () => new Array(words.length));\r\n        this.keyframes = localArr;\r\n      }\r\n\r\n      for(var angle_index = 0;angle_index < words.length;angle_index++) {\r\n        this.keyframes[frame][angle_index] = parseFloat(words[angle_index]);\r\n      }\r\n\r\n      frame += 1;\r\n    }\r\n  }\r\n\r\n  _extract_rotation(frame_pose, index_offset, joint) {\r\n    var local_rotation = [0, 0, 0],\r\n      M_rotation;\r\n\r\n    for(var key in joint.channels) {\r\n      var channel = joint.channels[key];\r\n\r\n      if(channel.endsWith(\"position\")) {\r\n        continue;\r\n      }\r\n      if(channel == \"Xrotation\") {\r\n        local_rotation[0] = frame_pose[index_offset];\r\n      } else if(channel == \"Yrotation\") {\r\n        local_rotation[1] = frame_pose[index_offset];\r\n      } else if(channel == \"Zrotation\") {\r\n        local_rotation[2] = frame_pose[index_offset];\r\n      } else {\r\n        console.warn(\"Unknown channel {channel}\");\r\n        // raise Exception(f\"Unknown channel {channel}\");\r\n      }\r\n      index_offset += 1;\r\n    }\r\n\r\n    local_rotation = npdeg2rad(local_rotation);\r\n\r\n    M_rotation = [\r\n      [1, 0, 0],\r\n      [0, 1, 0],\r\n      [0, 0, 1],\r\n    ];\r\n\r\n    for(key in joint.channels) {\r\n\r\n      var channel = joint.channels[key];\r\n      if(channel.endsWith(\"position\")) {\r\n        continue;\r\n      }\r\n\r\n      var euler_rot;\r\n      if(channel == \"Xrotation\") {\r\n        // console.warn(\"local_rotation \" + local_rotation);\r\n        euler_rot = [local_rotation[0], 0., 0.];\r\n      } else if(channel == \"Yrotation\") {\r\n        euler_rot = [0., local_rotation[1], 0.];\r\n      } else if(channel == \"Zrotation\") {\r\n        euler_rot = [0., 0., local_rotation[2]];\r\n      } else {\r\n        console.warn(\"Unknown channel {channel}\");\r\n      }\r\n\r\n      var M_channel = euler2mat(euler_rot[0], euler_rot[1], euler_rot[2], euler_rot[3])\r\n      var M_rotation = multiply(M_rotation, M_channel);\r\n\r\n    }\r\n    return [M_rotation, index_offset];\r\n  }\r\n\r\n  _extract_position(joint, frame_pose, index_offset) {\r\n    var offset_position = [0, 0, 0];\r\n    for(var key in joint.channels) {\r\n      var channel = joint.channels[key];\r\n\r\n      if(channel.endsWith(\"rotation\")) {\r\n        continue;\r\n      }\r\n\r\n      if(channel == \"Xposition\") {\r\n        offset_position[0] = frame_pose[index_offset];\r\n      } else if(channel == \"Yposition\") {\r\n        offset_position[1] = frame_pose[index_offset];\r\n      } else if(channel == \"Zposition\") {\r\n        offset_position[2] = frame_pose[index_offset];\r\n      } else {\r\n        console.warn(\"Unknown channel {channel}\");\r\n        // raise Exception(f\"Unknown channel {channel}\")\r\n      }\r\n      index_offset += 1;\r\n    }\r\n    return [offset_position, index_offset];\r\n  }\r\n\r\n  _recursive_apply_frame(\r\n    joint,\r\n    frame_pose,\r\n    index_offset,\r\n    p,\r\n    r,\r\n    M_parent,\r\n    p_parent\r\n  ) {\r\n    var joint_index;\r\n    if(joint.position_animated()) {\r\n      var local = this._extract_position(joint, frame_pose, index_offset);\r\n      var offset_position = local[0],\r\n        index_offset = local[1];\r\n\r\n    } else {\r\n      var offset_position = [0, 0, 0];\r\n    }\r\n\r\n    if(joint.channels.length == 0) {\r\n\r\n      var local2 = 0;\r\n      for(var item in this.joints) {\r\n\r\n        if(joint.name == item) {\r\n          joint_index = local2;\r\n        }\r\n        local2++;\r\n      }\r\n\r\n      p[joint_index] = arraySum3(p_parent, dot3vs1(M_parent, joint.offset));\r\n      r[joint_index] = mat2euler(M_parent);\r\n      return index_offset;\r\n    }\r\n\r\n    if(joint.rotation_animated()) {\r\n      var local2 = this._extract_rotation(frame_pose, index_offset, joint);\r\n      var M_rotation = local2[0];\r\n      index_offset = local2[1];\r\n    } else {\r\n      var M_rotation = [\r\n        [1, 0, 0],\r\n        [0, 1, 0],\r\n        [0, 0, 1],\r\n      ];\r\n    }\r\n\r\n    var M = multiply(M_parent, M_rotation);\r\n    // https://www.khanacademy.org/math/precalculus/x9e81a4f98389efdf:matrices/x9e81a4f98389efdf:adding-and-subtracting-matrices/e/matrix_addition_and_subtraction\r\n\r\n    var position = arraySum3(p_parent, dot3vs1(M_parent, joint.offset));\r\n    position = arraySum3(position, offset_position);\r\n    var rotation = mat2euler(M, \"rad2deg\");\r\n\r\n    // just find by id\r\n    var local = 0;\r\n    for(const item in this.joints) {\r\n      if(joint.name == item) {\r\n        joint_index = local;\r\n      }\r\n      local++;\r\n    }\r\n\r\n    p[joint_index] = position;\r\n    r[joint_index] = rotation;\r\n\r\n    for(var c in joint.children) {\r\n      index_offset = this._recursive_apply_frame(\r\n        joint.children[c],\r\n        frame_pose,\r\n        index_offset,\r\n        p,\r\n        r,\r\n        M,\r\n        position\r\n      );\r\n    }\r\n\r\n    return index_offset;\r\n  }\r\n\r\n  frame_pose(frame) {\r\n    var jointLength = 0;\r\n    for(var x in this.joints) {jointLength++}\r\n    var p = Array.from(Array(jointLength), () => [0, 0, 0]);\r\n    var r = Array.from(Array(jointLength), () => [0, 0, 0]);\r\n    var frame_pose = this.keyframes[frame];\r\n    var M_parent = [\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n      [0, 0, 0],\r\n    ];\r\n\r\n    M_parent[0][0] = 1;\r\n    M_parent[1][1] = 1;\r\n    M_parent[2][2] = 1;\r\n\r\n    this._recursive_apply_frame(\r\n      this.root,\r\n      frame_pose,\r\n      0,\r\n      p,\r\n      r,\r\n      M_parent,\r\n      [0, 0, 0]\r\n    );\r\n\r\n    return [p, r];\r\n  }\r\n\r\n  all_frame_poses() {\r\n\r\n    var jointLength = 0;\r\n    for(var x in this.joints) {jointLength++}\r\n    var p = Array.from({length: this.frames}, () => Array.from({length: jointLength}, () => [0, 0, 0]));\r\n    var r = Array.from({length: this.frames}, () => Array.from({length: jointLength}, () => [0, 0, 0]));\r\n\r\n    for(var frame = 0;frame < this.keyframes.length;frame++) {\r\n      var local3 = this.frame_pose(frame);\r\n      p[frame] = local3[0];\r\n      r[frame] = local3[1];\r\n    }\r\n\r\n    return [p, r];\r\n  }\r\n\r\n  _plot_pose(p, r, fig, ax) {\r\n    /* \r\n      _plot_pose(p, r, fig=None, ax=None) {\r\n        import matplotlib.pyplot as plt\r\n        from mpl_toolkits.mplot3d import axes3d, Axes3D\r\n      if fig is None:\r\n          fig = plt.figure()\r\n      if ax is None:\r\n          ax = fig.add_subplot(111, projection='3d')\r\n      ax.cla()\r\n      ax.scatter(p[:, 0], p[:, 2], p[:, 1])\r\n      ax.set_xlim(-30, 30)\r\n      ax.set_ylim(-30, 30)\r\n      ax.set_zlim(-1, 59)\r\n      plt.draw()\r\n      plt.pause(0.001)\r\n    */\r\n  }\r\n\r\n  // Meybe helps for draw\r\n  // plot_frame(frame, fig=None, ax=None) {\r\n  plot_frame(frame, fig, ax) {\r\n    // ????\r\n    // p, (r = this.frame_pose(frame));\r\n    // this._plot_pose(p, r, fig, ax);\r\n  }\r\n\r\n  joint_names() {\r\n    var keys = [];\r\n    for(var key in this.joints) {\r\n      keys.push(key);\r\n    }\r\n    return keys;\r\n  }\r\n\r\n  plot_all_frames() {\r\n    /*\r\n      import matplotlib.pyplot as plt\r\n      from mpl_toolkits.mplot3d import axes3d, Axes3D\r\n      fig = plt.figure()\r\n      ax = fig.add_subplot(111, projection='3d')\r\n      for i in range(self.frames) {\r\n          self.plot_frame(i, fig, ax);\r\n      } \r\n    */\r\n  }\r\n\r\n  __repr__() {\r\n    return `BVH.JS ${this.joints.keys().length} joints, ${this.frames} frames`;\r\n  }\r\n}\r\n", "\r\nimport { MEBvh } from \"./module/bvh-loader\";\r\n\r\nexport default MEBvh;\r\n", "/**\r\n * @author Nikola Lukic zlatnaspirala\r\n * @description\r\n * Importer is adapted for matrix-engine-wgpu.\r\n * Improved - Fix children empty array.\r\n * Access to json raw data.\r\n * @source\r\n * https://github.com/Twinklebear/webgpu-gltf/blob/main/src/glb_import.js\r\n */\r\nimport {mat4} from \"gl-matrix\";\r\n\r\nconst GLTFRenderMode = {\r\n  POINTS: 0,\r\n  LINE: 1,\r\n  LINE_LOOP: 2,\r\n  LINE_STRIP: 3,\r\n  TRIANGLES: 4,\r\n  TRIANGLE_STRIP: 5,\r\n  // Note: fans are not supported in WebGPU, use should be\r\n  // an error or converted into a list/strip\r\n  TRIANGLE_FAN: 6,\r\n};\r\n\r\nconst GLTFComponentType = {\r\n  BYTE: 5120,\r\n  UNSIGNED_BYTE: 5121,\r\n  SHORT: 5122,\r\n  UNSIGNED_SHORT: 5123,\r\n  INT: 5124,\r\n  UNSIGNED_INT: 5125,\r\n  FLOAT: 5126,\r\n  DOUBLE: 5130,\r\n};\r\n\r\nconst GLTFTextureFilter = {\r\n  NEAREST: 9728,\r\n  LINEAR: 9729,\r\n  NEAREST_MIPMAP_NEAREST: 9984,\r\n  LINEAR_MIPMAP_NEAREST: 9985,\r\n  NEAREST_MIPMAP_LINEAR: 9986,\r\n  LINEAR_MIPMAP_LINEAR: 9987,\r\n};\r\n\r\nconst GLTFTextureWrap = {\r\n  REPEAT: 10497,\r\n  CLAMP_TO_EDGE: 33071,\r\n  MIRRORED_REPEAT: 33648,\r\n};\r\n\r\nfunction alignTo(val, align) {\r\n  return Math.floor((val + align - 1) / align) * align;\r\n}\r\n\r\nfunction gltfTypeNumComponents(type) {\r\n  switch(type) {\r\n    case 'SCALAR':\r\n      return 1;\r\n    case 'VEC2':\r\n      return 2;\r\n    case 'VEC3':\r\n      return 3;\r\n    case 'VEC4':\r\n      return 4;\r\n    default:\r\n      alert('Unhandled glTF Type ' + type);\r\n      return null;\r\n  }\r\n}\r\n\r\nfunction gltfTypeSize(componentType, type) {\r\n  var typeSize = 0;\r\n  switch(componentType) {\r\n    case GLTFComponentType.BYTE:\r\n      typeSize = 1;\r\n      break;\r\n    case GLTFComponentType.UNSIGNED_BYTE:\r\n      typeSize = 1;\r\n      break;\r\n    case GLTFComponentType.SHORT:\r\n      typeSize = 2;\r\n      break;\r\n    case GLTFComponentType.UNSIGNED_SHORT:\r\n      typeSize = 2;\r\n      break;\r\n    case GLTFComponentType.INT:\r\n      typeSize = 4;\r\n      break;\r\n    case GLTFComponentType.UNSIGNED_INT:\r\n      typeSize = 4;\r\n      break;\r\n    case GLTFComponentType.FLOAT:\r\n      typeSize = 4;\r\n      break;\r\n    case GLTFComponentType.DOUBLE:\r\n      typeSize = 4;\r\n      break;\r\n    default:\r\n      alert('Unrecognized GLTF Component Type?');\r\n  }\r\n  return gltfTypeNumComponents(type) * typeSize;\r\n}\r\n\r\nexport class GLTFBuffer {\r\n  constructor(buffer, size, offset) {\r\n    this.arrayBuffer = buffer;\r\n    this.size = size;\r\n    this.byteOffset = offset;\r\n  }\r\n}\r\n\r\nexport class GLTFBufferView {\r\n  constructor(buffer, view) {\r\n    this.length = view['byteLength'];\r\n    this.byteOffset = buffer.byteOffset;\r\n    if(view['byteOffset'] !== undefined) {\r\n      this.byteOffset += view['byteOffset'];\r\n    }\r\n    this.byteStride = 0;\r\n    if(view['byteStride'] !== undefined) {\r\n      this.byteStride = view['byteStride'];\r\n    }\r\n    this.buffer = new Uint8Array(buffer.arrayBuffer, this.byteOffset, this.length);\r\n\r\n    this.needsUpload = false;\r\n    this.gpuBuffer = null;\r\n    this.usage = 0;\r\n  }\r\n\r\n  addUsage(usage) {\r\n    this.usage = this.usage | usage;\r\n  }\r\n\r\n  upload(device) {\r\n    // Note: must align to 4 byte size when mapped at creation is true\r\n    var buf = device.createBuffer({\r\n      size: alignTo(this.buffer.byteLength, 4),\r\n      usage: this.usage,\r\n      mappedAtCreation: true\r\n    });\r\n    new (this.buffer.constructor)(buf.getMappedRange()).set(this.buffer);\r\n    buf.unmap();\r\n    this.gpuBuffer = buf;\r\n    this.needsUpload = false;\r\n  }\r\n}\r\n\r\nexport class GLTFAccessor {\r\n  constructor(view, accessor, weightsAccessIndex) {\r\n    this.count = accessor['count'];\r\n    this.componentType = accessor['componentType'];\r\n    this.gltfType = accessor['type'];\r\n    this.numComponents = gltfTypeNumComponents(accessor['type']);\r\n    this.numScalars = this.count * this.numComponents;\r\n    this.view = view;\r\n    this.byteOffset = 0;\r\n    if(accessor['byteOffset'] !== undefined) {\r\n      this.byteOffset = accessor['byteOffset'];\r\n    }\r\n    if(weightsAccessIndex) this.weightsAccessIndex = weightsAccessIndex;\r\n  }\r\n\r\n  get byteStride() {\r\n    var elementSize = gltfTypeSize(this.componentType, this.gltfType);\r\n    return Math.max(elementSize, this.view.byteStride);\r\n  }\r\n}\r\n\r\nexport class GLTFPrimitive {\r\n  constructor(indices, positions, normals, texcoords, material, topology, weights, joints, tangents) {\r\n    this.indices = indices;\r\n    this.positions = positions;\r\n    this.normals = normals;\r\n    this.texcoords = texcoords;\r\n    this.material = material;\r\n    this.topology = topology;\r\n    this.weights = weights;\r\n    this.joints = joints;\r\n    this.tangents = tangents;\r\n  }\r\n}\r\n\r\nexport class GLTFMesh {\r\n  constructor(name, primitives) {\r\n    this.name = name;\r\n    this.primitives = primitives;\r\n  }\r\n}\r\n\r\nexport class GLTFNode {\r\n  constructor(name, mesh, transform, n) {\r\n    this.name = name;\r\n    this.mesh = mesh;\r\n    this.transform = transform;\r\n\r\n    this.gpuUniforms = null;\r\n    this.bindGroup = null;\r\n\r\n    this.children = n.children || [];\r\n  }\r\n\r\n  upload(device) {\r\n    var buf = device.createBuffer(\r\n      {size: 4 * 4 * 4, usage: GPUBufferUsage.UNIFORM, mappedAtCreation: true});\r\n    new Float32Array(buf.getMappedRange()).set(this.transform);\r\n    buf.unmap();\r\n    this.gpuUniforms = buf;\r\n  }\r\n}\r\n\r\nfunction readNodeTransform(node) {\r\n  if(node['matrix']) {\r\n    var m = node['matrix'];\r\n    // Both glTF and gl matrix are column major\r\n    return mat4.fromValues(m[0],\r\n      m[1],\r\n      m[2],\r\n      m[3],\r\n      m[4],\r\n      m[5],\r\n      m[6],\r\n      m[7],\r\n      m[8],\r\n      m[9],\r\n      m[10],\r\n      m[11],\r\n      m[12],\r\n      m[13],\r\n      m[14],\r\n      m[15]);\r\n  } else {\r\n    var scale = [1, 1, 1];\r\n    var rotation = [0, 0, 0, 1];\r\n    var translation = [0, 0, 0];\r\n    if(node['scale']) {\r\n      scale = node['scale'];\r\n    }\r\n    if(node['rotation']) {\r\n      rotation = node['rotation'];\r\n    }\r\n    if(node['translation']) {\r\n      translation = node['translation'];\r\n    }\r\n    var m = mat4.create();\r\n    return mat4.fromRotationTranslationScale(m, rotation, translation, scale);\r\n  }\r\n}\r\n\r\n// function flattenGLTFChildren(nodes, node, parent_transform) {\r\n//   var tfm = readNodeTransform(node);\r\n//   var tfm = mat4.mul(tfm, parent_transform, tfm);\r\n//   node['matrix'] = tfm;\r\n//   node['scale'] = undefined;\r\n//   node['rotation'] = undefined;\r\n//   node['translation'] = undefined;\r\n//   if(node['children']) {\r\n//     for(var i = 0;i < node['children'].length;++i) {\r\n//       flattenGLTFChildren(nodes, nodes[node['children'][i]], tfm);\r\n//     }\r\n//     node['children'] = [];\r\n//   }\r\n// }\r\n\r\nfunction flattenGLTFChildren(nodes, node, parent_transform) {\r\n  var tfm = readNodeTransform(node);\r\n  var tfm = mat4.mul(tfm, parent_transform, tfm);\r\n  node['matrix'] = tfm;\r\n  node['scale'] = undefined;\r\n  node['rotation'] = undefined;\r\n  node['translation'] = undefined;\r\n\r\n  if(node['children']) {\r\n    for(var i = 0;i < node['children'].length;++i) {\r\n      flattenGLTFChildren(nodes, nodes[node['children'][i]], tfm);\r\n    }\r\n    // node['children'] = []; // REMOVE THIS LINE\r\n  }\r\n}\r\n\r\n\r\nfunction makeGLTFSingleLevel(nodes) {\r\n  var rootTfm = mat4.create();\r\n  for(var i = 0;i < nodes.length;++i) {\r\n    flattenGLTFChildren(nodes, nodes[i], rootTfm);\r\n  }\r\n  return nodes;\r\n}\r\n\r\nexport class GLTFMaterial {\r\n  constructor(material, textures) {\r\n    this.baseColorFactor = [1, 1, 1, 1];\r\n    this.baseColorTexture = null;\r\n    // padded to float4\r\n    this.emissiveFactor = [0, 0, 0, 1];\r\n    this.metallicFactor = 1.0;\r\n    this.roughnessFactor = 1.0;\r\n\r\n    if(material['pbrMetallicRoughness'] !== undefined) {\r\n      var pbr = material['pbrMetallicRoughness'];\r\n      if(pbr['baseColorFactor'] !== undefined) {\r\n        this.baseColorFactor = pbr['baseColorFactor'];\r\n      }\r\n      if(pbr['baseColorTexture'] !== undefined) {\r\n        // TODO multiple texcoords\r\n        this.baseColorTexture = textures[pbr['baseColorTexture']['index']];\r\n      }\r\n      if(pbr['metallicFactor'] !== undefined) {\r\n        this.metallicFactor = pbr['metallicFactor'];\r\n      }\r\n      if(pbr['roughnessFactor'] !== undefined) {\r\n        this.roughnessFactor = pbr['roughnessFactor'];\r\n      }\r\n    }\r\n    if(material['emissiveFactor'] !== undefined) {\r\n      this.emissiveFactor[0] = material['emissiveFactor'][0];\r\n      this.emissiveFactor[1] = material['emissiveFactor'][1];\r\n      this.emissiveFactor[2] = material['emissiveFactor'][2];\r\n    }\r\n\r\n    this.gpuBuffer = null;\r\n    this.bindGroupLayout = null;\r\n    this.bindGroup = null;\r\n  }\r\n\r\n  upload(device) {\r\n    var buf = device.createBuffer(\r\n      {size: 3 * 4 * 4, usage: GPUBufferUsage.UNIFORM, mappedAtCreation: true});\r\n    var mappingView = new Float32Array(buf.getMappedRange());\r\n    mappingView.set(this.baseColorFactor);\r\n    mappingView.set(this.emissiveFactor, 4);\r\n    mappingView.set([this.metallicFactor, this.roughnessFactor], 8);\r\n    buf.unmap();\r\n    this.gpuBuffer = buf;\r\n\r\n    var layoutEntries =\r\n      [{binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {type: 'uniform'}}];\r\n    var bindGroupEntries = [{\r\n      binding: 0,\r\n      resource: {\r\n        buffer: this.gpuBuffer,\r\n      }\r\n    }];\r\n\r\n    if(this.baseColorTexture) {\r\n      // Defaults for sampler and texture are fine, just make the objects\r\n      // exist to pick them up\r\n      layoutEntries.push({binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {}});\r\n      layoutEntries.push({binding: 2, visibility: GPUShaderStage.FRAGMENT, texture: {}});\r\n\r\n      bindGroupEntries.push({\r\n        binding: 1,\r\n        resource: this.baseColorTexture.sampler,\r\n      });\r\n      bindGroupEntries.push({\r\n        binding: 2,\r\n        resource: this.baseColorTexture.imageView,\r\n      });\r\n    }\r\n\r\n    this.bindGroupLayout = device.createBindGroupLayout({entries: layoutEntries});\r\n\r\n    this.bindGroup = device.createBindGroup({\r\n      layout: this.bindGroupLayout,\r\n      entries: bindGroupEntries,\r\n    });\r\n  }\r\n}\r\n\r\nexport class GLTFSampler {\r\n  constructor(sampler, device) {\r\n    var magFilter = sampler['magFilter'] === undefined ||\r\n      sampler['magFilter'] == GLTFTextureFilter.LINEAR\r\n      ? 'linear'\r\n      : 'nearest';\r\n    var minFilter = sampler['minFilter'] === undefined ||\r\n      sampler['minFilter'] == GLTFTextureFilter.LINEAR\r\n      ? 'linear'\r\n      : 'nearest';\r\n\r\n    var wrapS = 'repeat';\r\n    if(sampler['wrapS'] !== undefined) {\r\n      if(sampler['wrapS'] == GLTFTextureFilter.REPEAT) {\r\n        wrapS = 'repeat';\r\n      } else if(sampler['wrapS'] == GLTFTextureFilter.CLAMP_TO_EDGE) {\r\n        wrapS = 'clamp-to-edge';\r\n      } else {\r\n        wrapS = 'mirror-repeat';\r\n      }\r\n    }\r\n\r\n    var wrapT = 'repeat';\r\n    if(sampler['wrapT'] !== undefined) {\r\n      if(sampler['wrapT'] == GLTFTextureFilter.REPEAT) {\r\n        wrapT = 'repeat';\r\n      } else if(sampler['wrapT'] == GLTFTextureFilter.CLAMP_TO_EDGE) {\r\n        wrapT = 'clamp-to-edge';\r\n      } else {\r\n        wrapT = 'mirror-repeat';\r\n      }\r\n    }\r\n\r\n    this.sampler = device.createSampler({\r\n      magFilter: magFilter,\r\n      minFilter: minFilter,\r\n      addressModeU: wrapS,\r\n      addressModeV: wrapT,\r\n    });\r\n  }\r\n}\r\n\r\nexport class GLTFTexture {\r\n  constructor(sampler, image) {\r\n    this.gltfsampler = sampler;\r\n    this.sampler = sampler.sampler;\r\n    this.image = image;\r\n    this.imageView = image.createView();\r\n  }\r\n}\r\n\r\nexport class GLBModel {\r\n  constructor(nodes, skins, skinnedMeshNodes, glbJsonData, glbBinaryBuffer,noSkinMeshNodes) {\r\n    this.noSkinMeshNodes = noSkinMeshNodes;\r\n    this.nodes = nodes;\r\n    this.skins = skins;\r\n    this.skinnedMeshNodes = skinnedMeshNodes;\r\n    this.bvhToGLBMap = null;\r\n    this.glbJsonData = glbJsonData;\r\n    this.glbBinaryBuffer = glbBinaryBuffer;\r\n  }\r\n};\r\n\r\n// function getComponentSize(componentType) {\r\n//   switch(componentType) {\r\n//     case 5126: return 4; // float32\r\n//     case 5123: return 2; // uint16\r\n//     case 5121: return 1; // uint8\r\n//     default: throw new Error(\"Unknown componentType: \" + componentType);\r\n//   }\r\n// }\r\n\r\n// Upload a GLB model and return it\r\nexport async function uploadGLBModel(buffer, device) {\r\n  // 1\uFE0F\u20E3 Validate header\r\n  const header = new Uint32Array(buffer, 0, 5);\r\n  if(header[0] !== 0x46546C67) {\r\n    alert('This does not appear to be a glb file?');\r\n    return;\r\n  }\r\n\r\n  // 2\uFE0F\u20E3 JSON chunk\r\n  const glbJsonData = JSON.parse(\r\n    new TextDecoder('utf-8').decode(new Uint8Array(buffer, 20, header[3]))\r\n  );\r\n\r\n  // 3\uFE0F\u20E3 Binary chunk header + buffer\r\n  const binaryHeader = new Uint32Array(buffer, 20 + header[3], 2);\r\n  const glbBuffer = new GLTFBuffer(buffer, binaryHeader[0], 28 + header[3]);\r\n\r\n  // 4\uFE0F\u20E3 BufferViews\r\n  const bufferViews = glbJsonData.bufferViews.map(\r\n    v => new GLTFBufferView(glbBuffer, v)\r\n  );\r\n\r\n  const binaryOffset = 28 + header[3];\r\n  const binaryLength = binaryHeader[0];\r\n\r\n  // \u2705 raw ArrayBuffer slice of the binary chunk:\r\n  const glbBinaryBuffer = buffer.slice(binaryOffset, binaryOffset + binaryLength);\r\n\r\n  // 5\uFE0F\u20E3 Load images\r\n  const images = [];\r\n  if(glbJsonData.images) {\r\n    for(const imgJson of glbJsonData.images) {\r\n      const view = new GLTFBufferView(\r\n        glbBuffer,\r\n        glbJsonData.bufferViews[imgJson.bufferView]\r\n      );\r\n      const blob = new Blob([view.buffer], {type: imgJson['mime/type']});\r\n      const img = await createImageBitmap(blob);\r\n      const gpuImg = device.createTexture({\r\n        size: [img.width, img.height, 1],\r\n        format: 'rgba8unorm-srgb',\r\n        usage:\r\n          GPUTextureUsage.TEXTURE_BINDING |\r\n          GPUTextureUsage.COPY_DST |\r\n          GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n      device.queue.copyExternalImageToTexture(\r\n        {source: img},\r\n        {texture: gpuImg},\r\n        [img.width, img.height, 1]\r\n      );\r\n      images.push(gpuImg);\r\n    }\r\n  }\r\n\r\n  glbJsonData.glbTextures = images;\r\n  // console.log('IMAGES FROM GLB: ', images)\r\n  // 6\uFE0F\u20E3 Samplers, Textures, Materials\r\n  const defaultSampler = new GLTFSampler({}, device);\r\n  const samplers = (glbJsonData.samplers || []).map(\r\n    s => new GLTFSampler(s, device)\r\n  );\r\n  const textures = (glbJsonData.textures || []).map(tex => {\r\n    const sampler =\r\n      tex.sampler !== undefined ? samplers[tex.sampler] : defaultSampler;\r\n    return new GLTFTexture(sampler, images[tex.source]);\r\n  });\r\n\r\n  const defaultMaterial = new GLTFMaterial({});\r\n  const materials = (glbJsonData.materials || []).map(\r\n    m => new GLTFMaterial(m, textures)\r\n  );\r\n\r\n  // 7\uFE0F\u20E3 Meshes\r\n  const meshes = (glbJsonData.meshes || []).map(mesh => {\r\n    const primitives = mesh.primitives.map(prim => {\r\n      const topology = prim.mode ?? GLTFRenderMode.TRIANGLES;\r\n      // console.log('topology ', topology)\r\n      // Indices\r\n      let indices = null;\r\n      if(prim.indices !== undefined) {\r\n        const accessor = glbJsonData.accessors[prim.indices];\r\n        const viewID = accessor.bufferView;\r\n        bufferViews[viewID].needsUpload = true;\r\n        bufferViews[viewID].addUsage(GPUBufferUsage.INDEX);\r\n        indices = new GLTFAccessor(bufferViews[viewID], accessor);\r\n      }\r\n      // Vertex attributes\r\n      let positions = null,\r\n        normals = null,\r\n        tangents = null,\r\n        texcoords = [];\r\n      let weights = null;\r\n      let joints = null;\r\n      for(const attr in prim.attributes) {\r\n        const accessor = glbJsonData.accessors[prim.attributes[attr]];\r\n        const viewID = accessor.bufferView;\r\n        bufferViews[viewID].needsUpload = true;\r\n        bufferViews[viewID].addUsage(GPUBufferUsage.VERTEX);\r\n        if(attr === 'POSITION') {\r\n          positions = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else if(attr === 'NORMAL') {\r\n          normals = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else if(attr.startsWith('TEXCOORD')) {\r\n          texcoords.push(new GLTFAccessor(bufferViews[viewID], accessor));\r\n        } else if(attr === 'WEIGHTS_0') {\r\n          weights = new GLTFAccessor(bufferViews[viewID], accessor, prim.attributes['WEIGHTS_0']);\r\n        } else if(attr.startsWith('JOINTS')) {\r\n          joints = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else if(attr === 'TANGENT') {\r\n          tangents = new GLTFAccessor(bufferViews[viewID], accessor);\r\n        } else {\r\n          console.log('unknow-attr:', attr)\r\n        }\r\n      }\r\n\r\n      const material = prim.material !== undefined ? materials[prim.material] : defaultMaterial;\r\n      return new GLTFPrimitive(\r\n        indices,\r\n        positions,\r\n        normals,\r\n        texcoords,\r\n        material,\r\n        topology,\r\n        weights,\r\n        joints,\r\n        tangents\r\n      );\r\n    });\r\n    return new GLTFMesh(mesh.name, primitives);\r\n  });\r\n\r\n  // Upload buffers & materials\r\n  for(const bv of bufferViews) if(bv.needsUpload) bv.upload(device);\r\n  defaultMaterial.upload(device);\r\n  for(const m of materials) m.upload(device);\r\n  // 8\uFE0F\u20E3 Skins (we only store the index of inverseBindMatrices here)\r\n  const skins = (glbJsonData.skins || []).map(skin => ({\r\n    name: skin.name,\r\n    joints: skin.joints,\r\n    inverseBindMatrices: skin.inverseBindMatrices, // accessor index\r\n  }));\r\n  // 9\uFE0F\u20E3 Nodes\r\n  const nodes = [];\r\n  const gltfNodes = makeGLTFSingleLevel(glbJsonData.nodes);\r\n  for(let i = 0;i < gltfNodes.length;i++) {\r\n    const n = gltfNodes[i];\r\n    const meshObj = n.mesh !== undefined ? meshes[n.mesh] : null;\r\n    const node = new GLTFNode(n.name, meshObj, readNodeTransform(n), n);\r\n\r\n    if(n.skin !== undefined) node.skin = n.skin; // skin index\r\n    node.upload(device);\r\n    nodes.push(node);\r\n  }\r\n\r\n  // \uD83D\uDFE9 Build parent references:\r\n  for(let i = 0;i < gltfNodes.length;i++) {\r\n    const srcNode = gltfNodes[i];\r\n    // srcNode.children is an array of indices\r\n    if(srcNode.children) {\r\n      for(const childIndex of srcNode.children) {\r\n        nodes[childIndex].parent = i;   // add .parent to the child node\r\n      }\r\n    }\r\n  }\r\n  // Ensure nodes without parent are root nodes\r\n  for(const node of nodes) {\r\n    if(node.parent === undefined) node.parent = null;\r\n  }\r\n  const skinnedMeshNodes = nodes.filter(\r\n    n => n.mesh && n.skin !== undefined\r\n  );\r\n  let noSkinMeshNodes = null;\r\n\r\n  if(skinnedMeshNodes.length === 0) {\r\n    console.warn('No skins found \u2014 mesh not bound to skeleton');\r\n    noSkinMeshNodes = nodes.filter(n => n.mesh);\r\n  } else {\r\n    skinnedMeshNodes.forEach(n => {\r\n      // console.log('Mesh', n.mesh.name, 'uses skin index', n.skin);\r\n      // Per-mesh uniform buffer (example)\r\n      n.sceneUniformBuffer = device.createBuffer({\r\n        size: 44 * 4,\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n    });\r\n  }\r\n  let R = new GLBModel(nodes, skins, skinnedMeshNodes, glbJsonData, glbBinaryBuffer, noSkinMeshNodes)\r\n  return R;\r\n}\r\n", "import MEBvh from \"bvh-loader\";\r\nimport MEMeshObj from \"../mesh-obj\";\r\nimport {mat4, vec3, quat} from \"wgpu-matrix\";\r\n// import {degToRad} from \"../utils.js\";\r\nimport {GLTFBuffer} from \"./webgpu-gltf.js\";\r\n\r\nexport var animBVH = new MEBvh();\r\n\r\nexport let loadBVH = (path) => {\r\n  return new Promise((resolve, reject) => {\r\n    animBVH.parse_file(path).then(() => {\r\n      console.info(\"plot_hierarchy no function\")\r\n      animBVH.plot_hierarchy();\r\n      var r = animBVH.frame_pose(0);\r\n      // Not in use at the moment next feature - change skeletal or indipended new class.\r\n      // console.log(\"FINAL P => \", r[0].length)\r\n      // console.log(\"FINAL R => \", r[1].length)\r\n      var KEYS = animBVH.joint_names();\r\n      for(var x = 0;x < r[0].length;x++) {\r\n        // console.log(\"->\" + KEYS[x] + \"-> position: \" + r[0][x] + \" rotation: \" + r[1][x]);\r\n      }\r\n      var all = animBVH.all_frame_poses();\r\n      // console.log(\"Final All -> \", all);\r\n      resolve(animBVH);\r\n    }).catch((err) => {reject(err)});\r\n  })\r\n}\r\n\r\n/**\r\n * @description\r\n * Skinning basic done animation can be changed with animation index.\r\n * Holder for GLB model with skinning.\r\n * @param {GLBModel} glb - Your loaded GLB\r\n * @param {Object} bvhBones - Mapping of boneName \u2192 BVH bone data\r\n * @param {GPUDevice} device - WebGPU device\r\n * @credits Chatgpt assist here.\r\n */\r\nexport class BVHPlayer extends MEMeshObj {\r\n  constructor(o, bvh, glb, primitiveIndex, skinnedNodeIndex, canvas, device, context, inputHandler, globalAmbient) {\r\n    super(canvas, device, context, o, inputHandler, globalAmbient, glb, primitiveIndex, skinnedNodeIndex);\r\n    // bvh arg not actula at the moment\r\n    this.bvh = {};\r\n    this.glb = glb;\r\n    this.currentFrame = 0;\r\n    this.fps = 30;\r\n    this.timeAccumulator = 0;\r\n    // debug\r\n    this.scaleBoneTest = 1;\r\n    this.primitiveIndex = primitiveIndex;\r\n    if(!this.bvh.sharedState) {this.bvh.sharedState = {currentFrame: 0, timeAccumulator: 0};}\r\n    this.sharedState = this.bvh.sharedState;\r\n    // Reference to the skinned node containing all bones\r\n    this.skinnedNode = this.glb.skinnedMeshNodes[skinnedNodeIndex];\r\n    // console.log('this.skinnedNode', this.skinnedNode)\r\n    this.nodeWorldMatrices = Array.from(\r\n      {length: this.glb.nodes.length},\r\n      () => mat4.identity()\r\n    );\r\n    this.startTime = performance.now() / 1000; // seconds - anim speed control\r\n    this.MAX_BONES = 100; // predefined\r\n    this.skeleton = []; // array of joint node indices\r\n    this.animationSpeed = 1000;\r\n    this.inverseBindMatrices = []; // Float32Array for each joint\r\n    this.initInverseBindMatrices();\r\n    this.makeSkeletal();\r\n  }\r\n\r\n  makeSkeletal() {\r\n    let skin = this.glb.skins[0];\r\n    const accessorIndex = skin.inverseBindMatrices;\r\n    if(accessorIndex == null) {\r\n      console.warn(\"No inverseBindMatrices, using identity matrices\");\r\n    }\r\n    // 1. Load all inverse bind matrices once\r\n    const invBindArray = this.inverseBindMatrices; // set earlier by initInverseBindMatrices()\r\n    // 2. Build skeleton array from skin.joints only\r\n    this.skeleton = skin.joints.slice(); // direct copy of indices\r\n    // 3. Assign inverseBindMatrix to each joint node correctly\r\n    for(let i = 0;i < skin.joints.length;i++) {\r\n      const jointIndex = skin.joints[i];\r\n      const jointNode = this.glb.nodes[jointIndex];\r\n      // assign only to bone nodes\r\n      jointNode.inverseBindMatrix = invBindArray.slice(i * 16, (i + 1) * 16);\r\n      // decompose node\u2019s transform once (if not already)\r\n      if(!jointNode.transform) {\r\n        jointNode.transform = new Float32Array([\r\n          1, 0, 0, 0,\r\n          0, 1, 0, 0,\r\n          0, 0, 1, 0,\r\n          0, 0, 0, 1\r\n        ]);\r\n      }\r\n      if(!jointNode.translation || !jointNode.rotation || !jointNode.scale) {\r\n        const {translation, rotation, scale} = this.decomposeMatrix(jointNode.transform);\r\n        jointNode.translation = translation;\r\n        jointNode.rotation = rotation;\r\n        jointNode.scale = scale;\r\n      }\r\n    }\r\n    // 4. For mesh nodes or armature parent nodes, leave them alone\r\n    // what is animation , check is it more - we look for Armature by defoult \r\n    // friendly blender\r\n    this.glb.animationIndex = 0;\r\n    for(let j = 0;j < this.glb.glbJsonData.animations.length;j++) {\r\n      if(this.glb.glbJsonData.animations[j].name.indexOf('Armature') !== -1) {\r\n        this.glb.animationIndex = j;\r\n      }\r\n    }\r\n  }\r\n\r\n  initInverseBindMatrices(skinIndex = 0) {\r\n    const skin = this.glb.skins[skinIndex];\r\n    const invBindAccessorIndex = skin.inverseBindMatrices; // number\r\n    if(invBindAccessorIndex === undefined || invBindAccessorIndex === null) {\r\n      console.warn('No inverseBindMatrices accessor for skin', skinIndex);\r\n      return;\r\n    }\r\n    const invBindArray = this.getAccessorArray(this.glb, invBindAccessorIndex);\r\n    // \u2705 store directly as typed array (one big contiguous Float32Array)\r\n    this.inverseBindMatrices = invBindArray;\r\n  }\r\n\r\n  getNumberOfFramesCurAni() {\r\n    let anim = this.glb.glbJsonData.animations[this.glb.animationIndex]\r\n    const sampler = anim.samplers[0];\r\n    const inputAccessor = this.glb.glbJsonData.accessors[sampler.input];\r\n    const numFrames = inputAccessor.count;\r\n    return numFrames;\r\n  }\r\n\r\n  update(deltaTime) {\r\n    const frameTime = 1 / this.fps;\r\n    this.sharedState.timeAccumulator += deltaTime;\r\n    while(this.sharedState.timeAccumulator >= frameTime) {\r\n      this.sharedState.currentFrame = (this.sharedState.currentFrame + 1) % this.getNumberOfFramesCurAni();\r\n      this.sharedState.timeAccumulator -= frameTime;\r\n    }\r\n    // const frame = this.sharedState.currentFrame;\r\n    const currentTime = performance.now() / this.animationSpeed - this.startTime;\r\n    const boneMatrices = new Float32Array(this.MAX_BONES * 16);\r\n    if(this.glb.glbJsonData.animations && this.glb.glbJsonData.animations.length > 0) {\r\n      this.updateSingleBoneCubeAnimation(this.glb.glbJsonData.animations[this.glb.animationIndex], this.glb.nodes, currentTime, boneMatrices)\r\n    }\r\n  }\r\n\r\n  getAccessorArray(glb, accessorIndex) {\r\n    const accessor = glb.glbJsonData.accessors[accessorIndex];\r\n    const bufferView = glb.glbJsonData.bufferViews[accessor.bufferView];\r\n    const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n    const byteLength =\r\n      accessor.count *\r\n      this.getNumComponents(accessor.type) *\r\n      (accessor.componentType === 5126 ? 4 : 2); // adjust per type\r\n    const bufferDef = glb.glbBinaryBuffer;\r\n    // \u2705 now just slice:\r\n    const slice = this.getBufferSlice(bufferDef, byteOffset, byteLength);\r\n    switch(accessor.componentType) {\r\n      case 5126: // FLOAT\r\n        return new Float32Array(slice);\r\n      case 5123: // UNSIGNED_SHORT\r\n        return new Uint16Array(slice);\r\n      case 5121: // UNSIGNED_BYTE\r\n        return new Uint8Array(slice);\r\n      default:\r\n        throw new Error(\"Unsupported componentType: \" + accessor.componentType);\r\n    }\r\n  }\r\n\r\n  getAccessorTypeForChannel(path) {\r\n    switch(path) {\r\n      case \"translation\": return \"VEC3\";\r\n      case \"rotation\": return \"VEC4\";\r\n      case \"scale\": return \"VEC3\";\r\n      case \"weights\": return \"VECN\"; // if needed\r\n      default: throw new Error(\"Unknown channel path: \" + path);\r\n    }\r\n  }\r\n\r\n  getNumComponents(type) {\r\n    switch(type) {\r\n      case \"SCALAR\": return 1;\r\n      case \"VEC2\": return 2;\r\n      case \"VEC3\": return 3;\r\n      case \"VEC4\": return 4;\r\n      case \"MAT4\": return 16;\r\n      default: throw new Error(\"Unknown type: \" + type);\r\n    }\r\n  }\r\n\r\n  getComponentSize(componentType) {\r\n    switch(componentType) {\r\n      case 5126: return 4; // float32\r\n      case 5123: return 2; // uint16\r\n      case 5121: return 1; // uint8\r\n      default: throw new Error(\"Unknown componentType: \" + componentType);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  @description\r\n   *  Get a typed slice of the raw binary buffer from glTF buffer definitions.\r\n   * @param {Object} bufferDef - the glTF buffer definition (usually gltfJson.buffers[0])\r\n   * @param {Number} byteOffset - byte offset into the buffer\r\n   * @param {Number} byteLength - byte length to slice\r\n   * @returns {ArrayBuffer} sliced array buffer\r\n   **/\r\n  getBufferSlice(bufferDef, byteOffset, byteLength) {\r\n    // GLTFBuffer instance:\r\n    if(bufferDef instanceof GLTFBuffer) {\r\n      // Use .arrayBuffer + .byteOffset:\r\n      return bufferDef.arrayBuffer.slice(\r\n        bufferDef.byteOffset + (byteOffset || 0),\r\n        bufferDef.byteOffset + (byteOffset || 0) + byteLength\r\n      );\r\n    }\r\n\r\n    // Already have a raw ArrayBuffer:\r\n    if(bufferDef instanceof ArrayBuffer) {\r\n      return bufferDef.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n\r\n    // Some loaders store it as .data or ._data:\r\n    if(bufferDef && bufferDef.data instanceof ArrayBuffer) {\r\n      return bufferDef.data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n    if(bufferDef && bufferDef._data instanceof ArrayBuffer) {\r\n      return bufferDef._data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n\r\n    throw new Error(\"No binary data found in GLB buffer[0]\");\r\n  }\r\n\r\n  // --- helpers\r\n  lerpVec(a, b, t) {\r\n    return a.map((v, i) => v * (1 - t) + b[i] * t);\r\n  }\r\n\r\n  // Example quaternion slerp (a,b = [x,y,z,w])\r\n  quatSlerp(a, b, t) {\r\n    // naive slerp for small demo, normalize result\r\n    let dot = a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n    if(dot < 0) {b = b.map(v => -v); dot = -dot;}\r\n    if(dot > 0.9995) return lerpVec(a, b, t);\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n    return a.map((v, i) => s0 * v + s1 * b[i]);\r\n  }\r\n\r\n  // naive quaternion to 4x4 matrix\r\n  quatToMat4(q) {\r\n    const [x, y, z, w] = q;\r\n    const xx = x * x, yy = y * y, zz = z * z;\r\n    const xy = x * y, xz = x * z, yz = y * z, wx = w * x, wy = w * y, wz = w * z;\r\n    return new Float32Array([\r\n      1 - 2 * (yy + zz), 2 * (xy + wz), 2 * (xz - wy), 0,\r\n      2 * (xy - wz), 1 - 2 * (xx + zz), 2 * (yz + wx), 0,\r\n      2 * (xz + wy), 2 * (yz - wx), 1 - 2 * (xx + yy), 0,\r\n      0, 0, 0, 1\r\n    ]);\r\n  }\r\n\r\n  // Compose TRS to a 4\u00D74\r\n  composeMatrix(translation, rotationQuat, scale) {\r\n    const m = mat4.identity();\r\n    mat4.translate(m, translation, m);\r\n    const rot = mat4.fromQuat(rotationQuat);\r\n    mat4.multiply(m, rot, m);\r\n    mat4.scale(m, scale, m);\r\n    return m;\r\n\r\n    // const m = mat4.identity();\r\n    // mat4.translate(m, translation, m);\r\n    // const rot = mat4.fromQuat(rotationQuat);\r\n    // mat4.multiply(m, rot, m);\r\n    // mat4.scale(m, scale, m);\r\n\r\n    // // Flip Y globally\r\n    // const flipY = mat4.identity();\r\n    // mat4.scale(flipY, [1, 1, -1], flipY);\r\n    // mat4.multiply(m, flipY, m);\r\n\r\n    // return m;\r\n\r\n  }\r\n\r\n  decomposeMatrix(m) {\r\n    // m is column-major: indices:\r\n    // [ m0 m4 m8  m12\r\n    //   m1 m5 m9  m13\r\n    //   m2 m6 m10 m14\r\n    //   m3 m7 m11 m15 ]\r\n    const t = new Float32Array([m[12], m[13], m[14]]);\r\n\r\n    // Extract the 3 column vectors (upper-left 3x3)\r\n    const cx = [m[0], m[1], m[2]];\r\n    const cy = [m[4], m[5], m[6]];\r\n    const cz = [m[8], m[9], m[10]];\r\n\r\n    // Lengths = scales\r\n    const len = v => Math.hypot(v[0], v[1], v[2]);\r\n    let sx = len(cx), sy = len(cy), sz = len(cz);\r\n\r\n    // If any scale nearly zero, avoid divide-by-zero\r\n    if(sx === 0) sx = 1.0;\r\n    if(sy === 0) sy = 1.0;\r\n    if(sz === 0) sz = 1.0;\r\n\r\n    // Normalize columns to produce a pure rotation matrix\r\n    const r00 = m[0] / sx, r01 = m[4] / sy, r02 = m[8] / sz;\r\n    const r10 = m[1] / sx, r11 = m[5] / sy, r12 = m[9] / sz;\r\n    const r20 = m[2] / sx, r21 = m[6] / sy, r22 = m[10] / sz;\r\n\r\n    // Fix negative-scale (reflection) case: if determinant < 0, flip sign of one scale and corresponding column\r\n    const det3 = r00 * (r11 * r22 - r12 * r21) - r01 * (r10 * r22 - r12 * r20) + r02 * (r10 * r21 - r11 * r20);\r\n    if(det3 < 0) {\r\n      // flip Z\r\n      sz = -sz;\r\n      // flip third column sign\r\n      // multiply cz by -1 => r02,r12,r22 *= -1\r\n      // recompute normalized r* accordingly:\r\n      // since we only need a valid rotation matrix for quaternion conversion,\r\n      // just invert the third column\r\n      // (alternatively flip sx or sy\u2014this is a convention choice)\r\n      // Here we flip the third column:\r\n      // r02 = -r02; r12 = -r12; r22 = -r22;\r\n    }\r\n\r\n    // Build quaternion from rotation matrix (r00..r22)\r\n    // Using standard conversion (column-major rotation)\r\n    const trace = r00 + r11 + r22;\r\n    let qx, qy, qz, qw;\r\n    if(trace > 0.00001) {\r\n      const s = Math.sqrt(trace + 1.0) * 2; // s=4*qw\r\n      qw = 0.25 * s;\r\n      qx = (r21 - r12) / s;\r\n      qy = (r02 - r20) / s;\r\n      qz = (r10 - r01) / s;\r\n    } else if(r00 > r11 && r00 > r22) {\r\n      const s = Math.sqrt(1.0 + r00 - r11 - r22) * 2; // s=4*qx\r\n      qw = (r21 - r12) / s;\r\n      qx = 0.25 * s;\r\n      qy = (r01 + r10) / s;\r\n      qz = (r02 + r20) / s;\r\n    } else if(r11 > r22) {\r\n      const s = Math.sqrt(1.0 + r11 - r00 - r22) * 2; // s=4*qy\r\n      qw = (r02 - r20) / s;\r\n      qx = (r01 + r10) / s;\r\n      qy = 0.25 * s;\r\n      qz = (r12 + r21) / s;\r\n    } else {\r\n      const s = Math.sqrt(1.0 + r22 - r00 - r11) * 2; // s=4*qz\r\n      qw = (r10 - r01) / s;\r\n      qx = (r02 + r20) / s;\r\n      qy = (r12 + r21) / s;\r\n      qz = 0.25 * s;\r\n    }\r\n\r\n    const rot = new Float32Array([qx, qy, qz, qw]);\r\n    const scale = new Float32Array([sx, sy, sz]);\r\n    return {translation: t, rotation: rot, scale: scale};\r\n  }\r\n\r\n  slerp(q0, q1, t, out) {\r\n    let dot = q0[0] * q1[0] + q0[1] * q1[1] + q0[2] * q1[2] + q0[3] * q1[3];\r\n    if(dot < 0) {dot = -dot; q1 = [-q1[0], -q1[1], -q1[2], -q1[3]];}\r\n\r\n    if(dot > 0.9995) {\r\n      // linear\r\n      for(let i = 0;i < 4;i++) out[i] = q0[i] + t * (q1[i] - q0[i]);\r\n      // normalize\r\n      const len = Math.hypot(...out);\r\n      for(let i = 0;i < 4;i++) out[i] /= len;\r\n      return;\r\n    }\r\n\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n\r\n    for(let i = 0;i < 4;i++) {\r\n      out[i] = s0 * q0[i] + s1 * q1[i];\r\n    }\r\n  }\r\n\r\n  updateSingleBoneCubeAnimation(glbAnimation, nodes, time, boneMatrices) {\r\n    const channels = glbAnimation.channels;\r\n    const samplers = glbAnimation.samplers;\r\n    // --- Map channels per node for faster lookup\r\n    const nodeChannels = new Map();\r\n    for(const channel of channels) {\r\n      if(!nodeChannels.has(channel.target.node)) nodeChannels.set(channel.target.node, []);\r\n      nodeChannels.get(channel.target.node).push(channel);\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const nodeIndex = this.skeleton[j];\r\n      const node = nodes[nodeIndex];\r\n\r\n      // --- Initialize node TRS if needed\r\n      if(!node.translation) node.translation = new Float32Array([0, 0, 0]);\r\n      if(!node.rotation) node.rotation = quat.create();\r\n      if(!node.scale) node.scale = new Float32Array([1, 1, 1]);\r\n\r\n      // --- Keep original TRS for additive animation\r\n      if(!node.originalTranslation) node.originalTranslation = node.translation.slice();\r\n      if(!node.originalRotation) node.originalRotation = node.rotation.slice();\r\n      if(!node.originalScale) node.originalScale = node.scale.slice();\r\n\r\n      const channelsForNode = nodeChannels.get(nodeIndex) || [];\r\n\r\n      for(const channel of channelsForNode) {\r\n        const path = channel.target.path; // \"translation\" | \"rotation\" | \"scale\"\r\n        const sampler = samplers[channel.sampler];\r\n        // --- Get input/output arrays\r\n        const inputTimes = this.getAccessorArray(this.glb, sampler.input);\r\n        const outputArray = this.getAccessorArray(this.glb, sampler.output);\r\n        const numComponents = path === \"rotation\" ? 4 : 3;\r\n        // --- Find keyframe interval\r\n        const animTime = time % inputTimes[inputTimes.length - 1];\r\n        let i = 0;\r\n        while(i < inputTimes.length - 1 && inputTimes[i + 1] <= animTime) i++;\r\n        const t0 = inputTimes[i];\r\n        const t1 = inputTimes[Math.min(i + 1, inputTimes.length - 1)];\r\n        const factor = t1 !== t0 ? (animTime - t0) / (t1 - t0) : 0;\r\n        // --- Interpolated keyframe values\r\n        const v0 = outputArray.subarray(i * numComponents, (i + 1) * numComponents);\r\n        const v1 = outputArray.subarray(\r\n          Math.min(i + 1, inputTimes.length - 1) * numComponents,\r\n          Math.min(i + 2, inputTimes.length) * numComponents\r\n        );\r\n        // --- Apply animation\r\n        if(path === \"translation\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.translation[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"scale\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.scale[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"rotation\") {\r\n          this.slerp(v0, v1, factor, node.rotation);\r\n        }\r\n      }\r\n      // --- Recompose local transform\r\n      node.transform = this.composeMatrix(node.translation, node.rotation, node.scale);\r\n    }\r\n    const computeWorld = (nodeIndex) => {\r\n      const node = nodes[nodeIndex];\r\n      if(!node.worldMatrix) node.worldMatrix = mat4.create();\r\n      let parentWorld = node.parent !== null ? nodes[node.parent].worldMatrix : null;\r\n      if(parentWorld) {\r\n        // multiply parent * local\r\n        mat4.multiply(parentWorld, node.transform, node.worldMatrix);\r\n      } else {\r\n        mat4.copy(node.transform, node.worldMatrix);\r\n      }\r\n\r\n      // maybe no need to exist...\r\n      mat4.scale(node.worldMatrix, [this.scaleBoneTest, this.scaleBoneTest, this.scaleBoneTest], node.worldMatrix);\r\n\r\n      if(node.children) {\r\n        for(const childIndex of node.children) computeWorld(childIndex);\r\n      }\r\n    };\r\n    for(let i = 0;i < nodes.length;i++) {\r\n      if(nodes[i].parent === null || nodes[i].parent === undefined) {\r\n        computeWorld(i);\r\n      }\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const jointNode = nodes[this.skeleton[j]];\r\n      const finalMat = mat4.create();\r\n      mat4.multiply(jointNode.worldMatrix, jointNode.inverseBindMatrix, finalMat);\r\n      boneMatrices.set(finalMat, j * 16);\r\n    }\r\n    // --- Upload to GPU\r\n    this.device.queue.writeBuffer(this.bonesBuffer, 0, boneMatrices);\r\n    return boneMatrices;\r\n  }\r\n}", "export let fragmentWGSLInstanced = `\r\noverride shadowDepthTextureSize: f32 = 1024.0;\r\nconst PI: f32 = 3.141592653589793;\r\n\r\nstruct Scene {\r\n    lightViewProjMatrix  : mat4x4f,\r\n    cameraViewProjMatrix : mat4x4f,\r\n    cameraPos            : vec3f,\r\n    padding2             : f32,\r\n    lightPos             : vec3f,\r\n    padding              : f32,\r\n    globalAmbient        : vec3f,\r\n    padding3             : f32,\r\n};\r\n\r\nstruct SpotLight {\r\n    position      : vec3f,\r\n    _pad1         : f32,\r\n    direction     : vec3f,\r\n    _pad2         : f32,\r\n    innerCutoff   : f32,\r\n    outerCutoff   : f32,\r\n    intensity     : f32,\r\n    _pad3         : f32,\r\n    color         : vec3f,\r\n    _pad4         : f32,\r\n    range         : f32,\r\n    ambientFactor : f32,\r\n    shadowBias    : f32,\r\n    _pad5         : f32,\r\n    lightViewProj : mat4x4<f32>,\r\n};\r\n\r\nstruct MaterialPBR {\r\n    baseColorFactor : vec4f,\r\n    metallicFactor  : f32,\r\n    roughnessFactor : f32,\r\n    _pad1           : f32,\r\n    _pad2           : f32,\r\n};\r\n\r\nstruct PBRMaterialData {\r\n    baseColor : vec3f,\r\n    metallic  : f32,\r\n    roughness : f32,\r\n};\r\n\r\nconst MAX_SPOTLIGHTS = 20u;\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(0) @binding(1) var shadowMapArray: texture_depth_2d_array;\r\n@group(0) @binding(2) var shadowSampler: sampler_comparison;\r\n@group(0) @binding(3) var meshTexture: texture_2d<f32>;\r\n@group(0) @binding(4) var meshSampler: sampler;\r\n@group(0) @binding(5) var<uniform> spotlights: array<SpotLight, MAX_SPOTLIGHTS>;\r\n\r\n// PBR textures\r\n@group(0) @binding(6) var metallicRoughnessTex: texture_2d<f32>;\r\n@group(0) @binding(7) var metallicRoughnessSampler: sampler;\r\n@group(0) @binding(8) var<uniform> material: MaterialPBR;\r\n\r\n// RPG or any other usage [selected obj effect]\r\n@group(2) @binding(0) var<uniform> uSelected : f32;\r\n\r\nstruct FragmentInput {\r\n    @location(0) shadowPos : vec4f,\r\n    @location(1) fragPos   : vec3f,\r\n    @location(2) fragNorm  : vec3f,\r\n    @location(3) uv        : vec2f,\r\n    @location(4) colorMult : vec4f,\r\n};\r\n\r\nfn getPBRMaterial(uv: vec2f) -> PBRMaterialData {\r\n    let texColor = textureSample(meshTexture, meshSampler, uv);\r\n    let baseColor = texColor.rgb * material.baseColorFactor.rgb;\r\n    let mrTex = textureSample(metallicRoughnessTex, metallicRoughnessSampler, uv);\r\n    let metallic = mrTex.b * material.metallicFactor;\r\n    let roughness = mrTex.g * material.roughnessFactor;\r\n    return PBRMaterialData(baseColor, metallic, roughness);\r\n}\r\n\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3f) -> vec3f {\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nfn distributionGGX(N: vec3f, H: vec3f, roughness: f32) -> f32 {\r\n    let a = roughness * roughness;\r\n    let a2 = a * a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH * NdotH;\r\n    let denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\nfn geometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r * r) / 8.0;\r\n    return NdotV / (NdotV * (1.0 - k) + k);\r\n}\r\n\r\nfn geometrySmith(N: vec3f, V: vec3f, L: vec3f, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    return geometrySchlickGGX(NdotV, roughness) * geometrySchlickGGX(NdotL, roughness);\r\n}\r\n\r\nfn calculateSpotlightFactor(light: SpotLight, fragPos: vec3f) -> f32 {\r\n    let L = normalize(light.position - fragPos);\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    return clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n}\r\n\r\nfn computeSpotLight2(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    if (NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n    return material.baseColor * light.color * light.intensity * NdotL;\r\n    // return material.baseColor * light.color * light.intensity * NdotL;\r\n}\r\n\r\nfn computeSpotLight(light: SpotLight, N: vec3f, fragPos: vec3f, V: vec3f, material: PBRMaterialData) -> vec3f {\r\n    let L = normalize(light.position - fragPos);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n\r\n    let theta = dot(L, normalize(-light.direction));\r\n    let epsilon = light.innerCutoff - light.outerCutoff;\r\n    var coneAtten = clamp((theta - light.outerCutoff) / epsilon, 0.0, 1.0);\r\n\r\n    // coneAtten = 1.0;\r\n    if (coneAtten <= 0.0 || NdotL <= 0.0) {\r\n        return vec3f(0.0);\r\n    }\r\n\r\n    let F0 = mix(vec3f(0.04), material.baseColor.rgb, vec3f(material.metallic));\r\n    let H = normalize(L + V);\r\n    let F = F0 + (1.0 - F0) * pow(1.0 - max(dot(H, V), 0.0), 5.0);\r\n\r\n    let alpha = material.roughness * material.roughness;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let alpha2 = alpha * alpha;\r\n    let denom = (NdotH * NdotH * (alpha2 - 1.0) + 1.0);\r\n    let D = alpha2 / (PI * denom * denom + 1e-5);\r\n\r\n    let k = (alpha + 1.0) * (alpha + 1.0) / 8.0;\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let Gv = NdotV / (NdotV * (1.0 - k) + k);\r\n    let Gl = NdotL / (NdotL * (1.0 - k) + k);\r\n    let G = Gv * Gl;\r\n\r\n    let numerator = D * G * F;\r\n    let denominator = 4.0 * NdotV * NdotL + 1e-5;\r\n    let specular = numerator / denominator;\r\n\r\n    let kS = F;\r\n    let kD = (vec3f(1.0) - kS) * (1.0 - material.metallic);\r\n    let diffuse = kD * material.baseColor.rgb / PI;\r\n\r\n    let radiance = light.color * light.intensity;\r\n    // return (diffuse + specular) * radiance * NdotL * coneAtten;\r\n    return material.baseColor * light.color * light.intensity * NdotL * coneAtten;\r\n}\r\n\r\nfn sampleShadow(shadowUV: vec2f, layer: i32, depthRef: f32, normal: vec3f, lightDir: vec3f) -> f32 {\r\n    var visibility: f32 = 0.0;\r\n    let biasConstant: f32 = 0.001;\r\n    let slopeBias = max(0.002 * (1.0 - dot(normal, lightDir)), 0.0);\r\n    let bias = biasConstant + slopeBias;\r\n    let oneOverSize = 1.0 / (shadowDepthTextureSize * 0.5);\r\n    let offsets: array<vec2f, 9> = array<vec2f, 9>(\r\n        vec2(-1.0, -1.0), vec2(0.0, -1.0), vec2(1.0, -1.0),\r\n        vec2(-1.0,  0.0), vec2(0.0,  0.0), vec2(1.0,  0.0),\r\n        vec2(-1.0,  1.0), vec2(0.0,  1.0), vec2(1.0,  1.0)\r\n    );\r\n    for(var i: u32 = 0u; i < 9u; i = i + 1u) {\r\n        visibility += textureSampleCompare(\r\n            shadowMapArray, shadowSampler,\r\n            shadowUV + offsets[i] * oneOverSize,\r\n            layer, depthRef - bias\r\n        );\r\n    }\r\n    return visibility / 9.0;\r\n}\r\n\r\n@fragment\r\nfn main(input: FragmentInput) -> @location(0) vec4f {\r\n    let norm = normalize(input.fragNorm);\r\n    let viewDir = normalize(scene.cameraPos - input.fragPos);\r\n\r\n    // \u2705 now we declare materialData\r\n    let materialData = getPBRMaterial(input.uv);\r\n\r\n    var lightContribution = vec3f(0.0);\r\n\r\n    for (var i: u32 = 0u; i < MAX_SPOTLIGHTS; i = i + 1u) {\r\n        let sc = spotlights[i].lightViewProj * vec4<f32>(input.fragPos, 1.0);\r\n        let p  = sc.xyz / sc.w;\r\n        let uv = clamp(p.xy * 0.5 + vec2<f32>(0.5), vec2<f32>(0.0), vec2<f32>(1.0));\r\n        let depthRef = p.z * 0.5 + 0.5;\r\n\r\n        let lightDir = normalize(spotlights[i].position - input.fragPos);\r\n        let bias = spotlights[i].shadowBias;\r\n        let visibility = sampleShadow(uv, i32(i), depthRef - bias, norm, lightDir);\r\n        // let visibility = 1.0;\r\n        let contrib = computeSpotLight(spotlights[i], norm, input.fragPos, viewDir, materialData);\r\n        lightContribution += contrib * visibility;\r\n    }\r\n\r\n    let texColor = textureSample(meshTexture, meshSampler, input.uv);\r\n    var finalColor = texColor.rgb * (scene.globalAmbient + lightContribution);\r\n\r\n    // Apply per-instance tint\r\n    finalColor *= input.colorMult.rgb;\r\n\r\n    let N = normalize(input.fragNorm);\r\n    let V = normalize(scene.cameraPos - input.fragPos);\r\n    let fresnel = pow(1.0 - max(dot(N, V), 0.0), 3.0);\r\n\r\n    if (uSelected > 0.5) {\r\n        let glowColor = vec3f(0.2, 0.8, 1.0);\r\n        finalColor += glowColor * fresnel * 0.1;\r\n    }\r\n\r\n    let alpha = input.colorMult.a; // use alpha for blending\r\n    return vec4f(finalColor, alpha);\r\n}`;", "import {fragmentWGSL} from \"../../shaders/fragment.wgsl\";\r\nimport {fragmentWGSLMetal} from \"../../shaders/fragment.wgsl.metal\";\r\nimport {fragmentWGSLNormalMap} from \"../../shaders/fragment.wgsl.normalmap\";\r\nimport {fragmentWGSLPong} from \"../../shaders/fragment.wgsl.pong\";\r\nimport {fragmentWGSLPower} from \"../../shaders/fragment.wgsl.power\";\r\nimport {fragmentWGSLInstanced} from \"../../shaders/instanced/fragment.instanced.wgsl\";\r\n\r\n/**\r\n * @description\r\n * Created for matrix-engine-wgpu project.\r\n * MeshObj class estends Materials.\r\n * @var material is engine meta data variable not real material object.\r\n * @author Nikola Lukic\r\n * @email zlatnaspirala@gmail.com\r\n */\r\nexport default class MaterialsInstanced {\r\n  constructor(device, material, glb) {\r\n    this.device = device;\r\n    this.glb = glb;\r\n    this.material = material;\r\n    this.isVideo = false;\r\n    this.videoIsReady = 'NONE';\r\n    this.compareSampler = this.device.createSampler({\r\n      compare: 'less-equal',           // safer for shadow comparison\r\n      addressModeU: 'clamp-to-edge',   // prevents UV leaking outside\r\n      addressModeV: 'clamp-to-edge',\r\n      magFilter: 'linear',             // smooth PCF\r\n      minFilter: 'linear',\r\n    });\r\n    // For image textures (standard sampler)\r\n    this.imageSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // For external video textures (needs to be filtering sampler too!)\r\n    this.videoSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // FX effect\r\n    this.postFXModeBuffer = this.device.createBuffer({\r\n      size: 4, // u32 = 4 bytes\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dymmy buffer\r\n    this.dummySpotlightUniformBuffer = this.device.createBuffer({\r\n      size: 80, // Must match size in shader\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    this.device.queue.writeBuffer(this.dummySpotlightUniformBuffer, 0, new Float32Array(20));\r\n    // Create a 1x1 RGBA texture filled with white\r\n    const mrDummyTex = this.device.createTexture({\r\n      size: [1, 1, 1],\r\n      format: this.getFormat(),\r\n      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n    });\r\n    // Upload a single pixel\r\n    const pixel = new Uint8Array([255, 255, 255, 255]); // white RGBA\r\n    this.device.queue.writeTexture(\r\n      {texture: mrDummyTex},\r\n      pixel,\r\n      {bytesPerRow: 4},\r\n      [1, 1, 1]\r\n    );\r\n    this.metallicRoughnessTextureView = mrDummyTex.createView();\r\n    this.metallicRoughnessSampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // 4 floats for baseColorFactor + 1 metallic + 1 roughness + 2 pad floats = 8 floats\r\n    const materialPBRSize = 8 * 4; // 32 bytes\r\n    this.materialPBRBuffer = this.device.createBuffer({\r\n      size: materialPBRSize,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n    // Dummy values\r\n    const baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    const metallicFactor = 0.1;    // diffuse like plastic\r\n    const roughnessFactor = 0.5;   // some gloss\r\n    const pad = [0.0, 0.0];\r\n    // Pack into Float32Array\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      ...pad\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n\r\n    if(this.material.type == 'normalmap') {\r\n      const normalTexInfo = this.glb.glbJsonData.materials[0].normalTexture;\r\n      if(normalTexInfo) {\r\n        const tex = this.glb.glbJsonData.glbTextures[normalTexInfo.index];\r\n        this.normalTextureView = tex.createView();\r\n        this.normalSampler = this.device.createSampler({\r\n          magFilter: 'linear',\r\n          minFilter: 'linear',\r\n        });\r\n      } else {\r\n        // console.log('>>>ERRR >>>normalTexture>>')\r\n      }\r\n    } else {\r\n      // console.log('>DUMMY>normalTexture>')\r\n      // dummy for normal map 1x1 neutral normal map\r\n      this.normalDummyTex = device.createTexture({\r\n        size: [1, 1, 1],\r\n        format: 'rgba8unorm',\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,\r\n      });\r\n      // RGBA value for neutral normal in tangent space\r\n      const neutralNormal = new Uint8Array([128, 128, 255, 255]);\r\n      this.device.queue.writeTexture(\r\n        {texture: this.normalDummyTex},\r\n        neutralNormal,\r\n        {bytesPerRow: 4},\r\n        [1, 1, 1]\r\n      );\r\n      // Create texture view & sampler\r\n      this.normalTextureView = this.normalDummyTex.createView();\r\n      this.normalSampler = this.device.createSampler({\r\n        magFilter: 'linear',\r\n        minFilter: 'linear',\r\n      });\r\n    }\r\n  }\r\n\r\n  getMaterial() {\r\n    // make it for all after all....\r\n    if(this.material.type == 'standard') {\r\n      return fragmentWGSLInstanced;\r\n    } else if(this.material.type == 'pong') {\r\n      return fragmentWGSLPong;\r\n    } else if(this.material.type == 'power') {\r\n      return fragmentWGSLPower;\r\n    } else if(this.material.type == 'metal') {\r\n      return fragmentWGSLMetal;\r\n    } else if(this.material.type == 'normalmap') {\r\n      return fragmentWGSLNormalMap;\r\n    }\r\n    console.warn('Unknown material type:', this.material?.type);\r\n    return fragmentWGSL; // fallback\r\n  }\r\n\r\n  getFormat() {\r\n    if(this.material?.format == 'darker') {\r\n      return 'rgba8unorm-srgb';\r\n    } else if(this.material?.format == 'normal') {\r\n      return 'rgba8unorm';\r\n    } else {\r\n      return 'rgba8unorm';\r\n    }\r\n  }\r\n  // not affect all fs\r\n  setupMaterialPBR(metallicFactor) {\r\n    const baseColorFactor = [1.0, 1.0, 1.0, 1.0];\r\n    const roughnessFactor = 0.5;   // some gloss\r\n    const pad = [0.0, 0.0];\r\n    const materialArray = new Float32Array([\r\n      ...baseColorFactor,\r\n      metallicFactor,\r\n      roughnessFactor,\r\n      ...pad\r\n    ]);\r\n    this.device.queue.writeBuffer(this.materialPBRBuffer, 0, materialArray.buffer);\r\n  }\r\n\r\n  updatePostFXMode(mode) {\r\n    const arrayBuffer = new Uint32Array([mode]);\r\n    this.device.queue.writeBuffer(this.postFXModeBuffer, 0, arrayBuffer);\r\n  }\r\n\r\n  async loadTex0(texturesPaths) {\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    return new Promise(async (resolve) => {\r\n      const response = await fetch(texturesPaths[0]);\r\n      const imageBitmap = await createImageBitmap(await response.blob());\r\n      this.texture0 = this.device.createTexture({\r\n        size: [imageBitmap.width, imageBitmap.height, 1], // REMOVED 1\r\n        format: this.getFormat(),\r\n        usage:\r\n          GPUTextureUsage.TEXTURE_BINDING |\r\n          GPUTextureUsage.COPY_DST |\r\n          GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: imageBitmap},\r\n        {texture: this.texture0},\r\n        [imageBitmap.width, imageBitmap.height]\r\n      );\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  async loadVideoTexture(arg) {\r\n    this.videoIsReady = 'MAYBE';\r\n    if(arg.type === 'video') {\r\n      this.video = document.createElement('video');\r\n      this.video.src = arg.src || 'res/videos/tunel.mp4';\r\n      this.video.crossOrigin = 'anonymous';\r\n      this.video.autoplay = true;\r\n      this.video.loop = true;\r\n      document.body.append(this.video);\r\n      this.video.style.display = 'none';\r\n      this.video.style.position = 'absolute';\r\n      this.video.style.top = '750px';\r\n      this.video.style.left = '50px';\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'videoElement') {\r\n      this.video = arg.el;\r\n      await this.video.play();\r\n    } else if(arg.type === 'camera') {\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      try {\r\n        const stream = await (navigator.mediaDevices?.getUserMedia?.({\r\n          video: {\r\n            width: {ideal: 1280},\r\n            height: {ideal: 720},\r\n          },\r\n          audio: false\r\n        }));\r\n        this.video.srcObject = stream;\r\n        await this.video.play();\r\n        this.isVideo = true;\r\n      } catch(err) {\r\n        console.error(\"\u274C Failed to access camera:\", err);\r\n        return;\r\n      }\r\n    } else if(arg.type === 'canvas2d') {\r\n      // Existing canvas (arg.el) \u2014 assume it's actively drawing\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      const stream = arg.el.captureStream?.() || arg.el.mozCaptureStream?.();\r\n      if(!stream) {console.error('\u274C Cannot capture stream from canvas2d'); return;}\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n      this.isVideo = true;\r\n    } else if(arg.type === 'canvas2d-inline') {\r\n      // Miniature inline-drawn canvas created dynamically\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = arg.width || 256;\r\n      canvas.height = arg.height || 256;\r\n      const ctx = canvas.getContext('2d');\r\n      if(typeof arg.canvaInlineProgram === 'function') {\r\n        // Start drawing loop\r\n        const drawLoop = () => {\r\n          arg.canvaInlineProgram(ctx, canvas);\r\n          requestAnimationFrame(drawLoop);\r\n        };\r\n        drawLoop();\r\n      }\r\n      this.video = document.createElement('video');\r\n      this.video.autoplay = true;\r\n      this.video.muted = true;\r\n      this.video.playsInline = true;\r\n      this.video.style.display = 'none';\r\n      document.body.append(this.video);\r\n      this.isVideo = true;\r\n      const stream = canvas.captureStream?.() || canvas.mozCaptureStream?.();\r\n      if(!stream) {\r\n        console.error('\u274C Cannot capture stream from inline canvas');\r\n        return;\r\n      }\r\n      this.video.srcObject = stream;\r\n      await this.video.play();\r\n    }\r\n    this.sampler = this.device.createSampler({\r\n      magFilter: 'linear',\r\n      minFilter: 'linear',\r\n    });\r\n    // \u2705 Now - maybe noT\r\n    this.createLayoutForRender();\r\n  }\r\n\r\n  updateVideoTexture() {\r\n    if(!this.video || this.video.readyState < 2) return;\r\n    if(!this.externalTexture) {\r\n      // create it once\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n      this.videoIsReady = 'YES';\r\n      console.log(\"\u2705video bind.\");\r\n    } else {\r\n      this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n      this.createBindGroupForRender();\r\n    }\r\n  }\r\n\r\n  getMaterialTexture(glb, materialIndex) {\r\n    const matDef = glb.glbJsonData.materials[materialIndex];\r\n\r\n    if(!matDef) {\r\n      console.warn('[engine] no material in glb...');\r\n      return null;\r\n    }\r\n\r\n    if(matDef.pbrMetallicRoughness?.baseColorTexture) {\r\n      const texIndex = matDef.pbrMetallicRoughness.baseColorTexture.index;\r\n      return glb.glbJsonData.glbTextures[texIndex].createView();\r\n    }\r\n\r\n    return null;\r\n  }\r\n  getMaterialTextureFromMaterial(material) {\r\n    if(!material || !material.pbrMetallicRoughness) return this.fallbackTextureView;\r\n\r\n    const texInfo = material.pbrMetallicRoughness.baseColorTexture;\r\n    if(!texInfo) return this.fallbackTextureView;\r\n\r\n    const texIndex = texInfo.index;\r\n    return this.glb.glbTextures[texIndex].createView();\r\n  }\r\n\r\n  createBindGroupForRender() {\r\n    let textureResource = this.isVideo\r\n      ? this.externalTexture\r\n      : this.texture0.createView();\r\n    // console.log('TEST TEX this.texture0 ', this.texture0);\r\n    if(this.material.useTextureFromGlb === true) {\r\n      // console.log('TEST TEX material use from file ', this.name);\r\n      // 0 probably always for basicColor\r\n      const material = this.skinnedNode.mesh.primitives[0].material;\r\n      const textureView = material.baseColorTexture.imageView;\r\n      // const sampler = material.baseColorTexture.sampler;\r\n      textureResource = textureView;\r\n    }\r\n\r\n    if(!textureResource || !this.sceneUniformBuffer || !this.shadowDepthTextureView) {\r\n      if(!textureResource) console.warn(\"\u2757Missing res texture: \", textureResource);\r\n      if(!this.sceneUniformBuffer) console.warn(\"\u2757Missing res: this.sceneUniformBuffer: \", this.sceneUniformBuffer);\r\n      if(!this.shadowDepthTextureView) console.warn(\"\u2757Missing res: this.shadowDepthTextureView: \", this.shadowDepthTextureView);\r\n      if(typeof textureResource === 'undefined') {\r\n        this.updateVideoTexture();\r\n      }\r\n      return;\r\n    }\r\n    if(this.isVideo == true) {\r\n      // console.info(\"\u2705 video sceneBindGroupForRender\");\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.videoSampler, },\r\n          {binding: 5, resource: {buffer: this.postFXModeBuffer}}\r\n        ],\r\n      });\r\n      // Special case for video maybe better solution exist\r\n      if(this.video.paused == true) this.video.play();\r\n    } else {\r\n      this.sceneBindGroupForRender = this.device.createBindGroup({\r\n        layout: this.bglForRender,\r\n        entries: [\r\n          {binding: 0, resource: {buffer: this.sceneUniformBuffer}, },\r\n          {binding: 1, resource: this.shadowDepthTextureView, },\r\n          {binding: 2, resource: this.compareSampler, },\r\n          {binding: 3, resource: textureResource, },\r\n          {binding: 4, resource: this.imageSampler, },\r\n          {binding: 5, resource: {buffer: !this.spotlightUniformBuffer ? this.dummySpotlightUniformBuffer : this.spotlightUniformBuffer}, },\r\n          {binding: 6, resource: this.metallicRoughnessTextureView},\r\n          {binding: 7, resource: this.metallicRoughnessSampler},\r\n          {binding: 8, resource: {buffer: this.materialPBRBuffer}},\r\n          // NEW: dummy normal map\r\n          {binding: 9, resource: this.normalTextureView},\r\n          {binding: 10, resource: this.normalSampler},\r\n        ],\r\n      });\r\n    }\r\n  }\r\n\r\n  createLayoutForRender() {\r\n    let e = [\r\n      {\r\n        binding: 0,\r\n        visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\r\n        buffer: {type: 'uniform'},\r\n      },\r\n      ...(this.isVideo == false\r\n        ? [\r\n          {\r\n            binding: 1,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: \"depth\",\r\n              viewDimension: \"2d-array\", // <- must match shadowMapArray\r\n              multisampled: false,\r\n            },\r\n          },\r\n        ] : [{\r\n          binding: 1,\r\n          visibility: GPUShaderStage.FRAGMENT,\r\n          texture: {\r\n            sampleType: \"depth\",\r\n            viewDimension: \"2d\",\r\n          },\r\n        },])\r\n      , {\r\n        binding: 2,\r\n        visibility: GPUShaderStage.FRAGMENT,\r\n        sampler: {type: 'comparison'},\r\n      },\r\n      ...(this.isVideo\r\n        ? [ // VIDEO\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            externalTexture: {},\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}, // for video sampling\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          }\r\n        ]\r\n        : [ // IMAGE\r\n          {\r\n            binding: 3,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d',\r\n            },\r\n          },\r\n          {\r\n            binding: 4,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'},\r\n          },\r\n          {\r\n            binding: 5,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'},\r\n          },\r\n          {\r\n            binding: 6,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {\r\n              sampleType: 'float',\r\n              viewDimension: '2d'\r\n            }\r\n          },\r\n          {\r\n            binding: 7,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          },\r\n          {\r\n            binding: 8,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            buffer: {type: 'uniform'}\r\n          },\r\n          {\r\n            binding: 9,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            texture: {sampleType: 'float', viewDimension: '2d'},\r\n          },\r\n          {\r\n            binding: 10,\r\n            visibility: GPUShaderStage.FRAGMENT,\r\n            sampler: {type: 'filtering'}\r\n          }\r\n        ])\r\n    ];\r\n    // console.log(\"BG E :  is used normal  \", this.material.type)\r\n    this.bglForRender = this.device.createBindGroupLayout({label: 'bglForRender', entries: e, });\r\n  }\r\n}", "export let vertexWGSLInstanced = `const MAX_BONES = 100u;\r\n\r\nstruct Scene {\r\n  lightViewProjMatrix: mat4x4f,\r\n  cameraViewProjMatrix: mat4x4f,\r\n  lightPos: vec3f,\r\n}\r\n\r\n// not in use\r\nstruct Model {\r\n  modelMatrix: mat4x4f,\r\n}\r\n\r\nstruct Bones {\r\n  boneMatrices : array<mat4x4f, MAX_BONES>\r\n}\r\n\r\nstruct SkinResult {\r\n  position : vec4f,\r\n  normal   : vec3f,\r\n};\r\n\r\nstruct InstanceData {\r\n    model     : mat4x4<f32>,\r\n    colorMult : vec4<f32>,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> scene : Scene;\r\n@group(1) @binding(0) var<storage, read> instances : array<InstanceData>;\r\n@group(1) @binding(1) var<uniform> bones : Bones;\r\n\r\nstruct VertexOutput {\r\n  @location(0) shadowPos: vec4f,\r\n  @location(1) fragPos: vec3f,\r\n  @location(2) fragNorm: vec3f,\r\n  @location(3) uv: vec2f,\r\n  @location(4) colorMult: vec4f,\r\n  @builtin(position) Position: vec4f,\r\n}\r\n\r\nfn skinVertex(pos: vec4f, nrm: vec3f, joints: vec4<u32>, weights: vec4f) -> SkinResult {\r\n    var skinnedPos = vec4f(0.0);\r\n    var skinnedNorm = vec3f(0.0);\r\n    for (var i: u32 = 0u; i < 4u; i = i + 1u) {\r\n        let jointIndex = joints[i];\r\n        let w = weights[i];\r\n        if (w > 0.0) {\r\n          let boneMat = bones.boneMatrices[jointIndex];\r\n          skinnedPos  += (boneMat * pos) * w;\r\n          let boneMat3 = mat3x3f(\r\n            boneMat[0].xyz,\r\n            boneMat[1].xyz,\r\n            boneMat[2].xyz\r\n          );\r\n          skinnedNorm += (boneMat3 * nrm) * w;\r\n        }\r\n    }\r\n    return SkinResult(skinnedPos, skinnedNorm);\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position: vec3f,\r\n  @location(1) normal: vec3f,\r\n  @location(2) uv: vec2f,\r\n  @location(3) joints: vec4<u32>,\r\n  @location(4) weights: vec4<f32>,\r\n  @builtin(instance_index) instId: u32\r\n) -> VertexOutput {\r\n\r\n  let inst = instances[instId];\r\n\r\n  var output : VertexOutput;\r\n  var pos = vec4(position, 1.0);\r\n  var nrm = normal;\r\n  let skinned = skinVertex(pos, nrm, joints, weights);\r\n\r\n\r\n  // let worldPos = model.modelMatrix * skinned.position;\r\n  let worldPos = inst.model * skinned.position;\r\n\r\n  // build normal matrix from instance transform\r\n  let normalMatrix = mat3x3f(\r\n    inst.model[0].xyz,\r\n    inst.model[1].xyz,\r\n    inst.model[2].xyz\r\n  );\r\n\r\n  output.Position = scene.cameraViewProjMatrix * worldPos;\r\n  output.fragPos = worldPos.xyz;\r\n  output.shadowPos = scene.lightViewProjMatrix * worldPos;\r\n  output.fragNorm = normalize(normalMatrix * skinned.normal);\r\n  output.uv = uv;\r\n  output.colorMult = inst.colorMult;\r\n  return output;\r\n}`;", "\r\nexport class GeometryFactory {\r\n  static create(type, size = 1, segments = 16, options = {}) {\r\n    switch(type) {\r\n      case \"quad\": return GeometryFactory.quad(size);\r\n      case \"cube\": return GeometryFactory.cube(size);\r\n      case \"sphere\": return GeometryFactory.sphere(size, segments);\r\n      case \"pyramid\": return GeometryFactory.pyramid(size);\r\n      case \"star\": return GeometryFactory.star(size);\r\n      case \"circle\": return GeometryFactory.circle(size, segments);\r\n      case \"circle2\": return GeometryFactory.circle2(size, segments);\r\n      case \"diamond\": return GeometryFactory.diamond(size);\r\n      case \"rock\": return GeometryFactory.rock(size, options.detail || 3);\r\n      case \"meteor\": return GeometryFactory.meteor(size, options.detail || 6);\r\n      case \"thunder\": return GeometryFactory.thunder(size);\r\n      case \"shard\": return GeometryFactory.shard(size);\r\n      case \"circlePlane\": return GeometryFactory.circlePlane(size, segments);\r\n      case \"ring\": return GeometryFactory.ring(size, options.innerRatio || 0.7, segments, options.height || 0.05);\r\n      default: throw new Error(`Unknown geometry: ${type}`);\r\n    }\r\n  }\r\n\r\n  // --- BASIC SHAPES ---------------------------------------------------------\r\n  static quad(S = 1) {\r\n    const positions = new Float32Array([\r\n      -S, S, 0, S, S, 0, -S, -S, 0, S, -S, 0\r\n    ]);\r\n    const uvs = new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]);\r\n    const indices = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n    return {positions, uvs, indices};\r\n  }\r\n\r\n  static cube(S = 1) {\r\n    const p = S / 2;\r\n    const positions = new Float32Array([\r\n      -p, -p, p, p, -p, p, p, p, p, -p, p, p,\r\n      -p, -p, -p, -p, p, -p, p, p, -p, p, -p, -p,\r\n      -p, p, -p, -p, p, p, p, p, p, p, p, -p,\r\n      -p, -p, -p, p, -p, -p, p, -p, p, -p, -p, p,\r\n      p, -p, -p, p, p, -p, p, p, p, p, -p, p,\r\n      -p, -p, -p, -p, -p, p, -p, p, p, -p, p, -p\r\n    ]);\r\n    const uvs = new Float32Array(6 * 8).fill(0);\r\n    const indices = [];\r\n    for(let i = 0;i < 6;i++) {\r\n      const o = i * 4; indices.push(o, o + 1, o + 2, o, o + 2, o + 3);\r\n    }\r\n    let i = new Uint16Array(i);\r\n    return {positions, uvs, i};\r\n  }\r\n\r\n  static sphere(R = 0.1, seg = 16) {\r\n    const p = [], uv = [], ind = [];\r\n    for(let y = 0;y <= seg;y++) {\r\n      const v = y / seg, \u03B8 = v * Math.PI;\r\n      for(let x = 0;x <= seg;x++) {\r\n        const u = x / seg, \u03C6 = u * Math.PI * 2;\r\n        p.push(R * Math.sin(\u03B8) * Math.cos(\u03C6), R * Math.cos(\u03B8), R * Math.sin(\u03B8) * Math.sin(\u03C6));\r\n        uv.push(u, v);\r\n      }\r\n    }\r\n    for(let y = 0;y < seg;y++) {\r\n      for(let x = 0;x < seg;x++) {\r\n        const i = y * (seg + 1) + x;\r\n        ind.push(i, i + seg + 1, i + 1, i + 1, i + seg + 1, i + seg + 2);\r\n      }\r\n    }\r\n    return {positions: new Float32Array(p), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static pyramid(S = 1) {\r\n    const h = S, p = S / 2;\r\n    const pos = new Float32Array([\r\n      -p, 0, -p, p, 0, -p, p, 0, p, -p, 0, p, 0, h, 0\r\n    ]);\r\n    const uv = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1, 0.5, 0]);\r\n    const idx = new Uint16Array([0, 1, 2, 0, 2, 3, 0, 1, 4, 1, 2, 4, 2, 3, 4, 3, 0, 4]);\r\n    return {positions: pos, uvs: uv, indices: idx};\r\n  }\r\n\r\n  static star(S = 1) {\r\n    const R = S, r = S * 0.4, v = [], uv = [], ind = [];\r\n    for(let i = 0;i < 10;i++) {\r\n      const a = i / 10 * Math.PI * 2;\r\n      const rr = i % 2 ? r : R;\r\n      v.push(Math.cos(a) * rr, Math.sin(a) * rr, 0);\r\n      uv.push((Math.cos(a) + 1) / 2, (Math.sin(a) + 1) / 2);\r\n    }\r\n    for(let i = 1;i < 9;i++) ind.push(0, i, i + 1);\r\n    ind.push(0, 9, 1);\r\n    return {positions: new Float32Array(v), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static circle(R = 1, seg = 32) {\r\n    const p = [0, 0, 0], uv = [0.5, 0.5], ind = [];\r\n    for(let i = 0;i <= seg;i++) {\r\n      const a = i / seg * Math.PI * 2;\r\n      p.push(Math.cos(a) * R, Math.sin(a) * R, 0);\r\n      uv.push((Math.cos(a) + 1) / 2, (Math.sin(a) + 1) / 2);\r\n      if(i > 1) ind.push(0, i - 1, i);\r\n    }\r\n    return {positions: new Float32Array(p), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static circle2(radius = 1, segments = 64) {\r\n    const positions = [0, 0, 0]; // center\r\n    const uvs = [0.5, 0.5];      // center UV\r\n    const indices = [];\r\n\r\n    // create outer vertices\r\n    for(let i = 0;i <= segments;i++) {\r\n      const angle = (i / segments) * Math.PI * 2;\r\n      const x = Math.cos(angle) * radius;\r\n      const y = Math.sin(angle) * radius;\r\n      positions.push(x, y, 0);\r\n      // map to circular UV range [0,1]\r\n      uvs.push((x / radius + 1) / 2, (y / radius + 1) / 2);\r\n\r\n      if(i > 0) {\r\n        // center = 0, connect previous outer vertex with current outer vertex\r\n        indices.push(0, i, i + 1);\r\n      }\r\n    }\r\n\r\n    // close the circle (last triangle connects to first outer vertex)\r\n    // we already pushed (segments + 1) outer vertices, so last index = segments + 1\r\n    // but first outer vertex is index 1\r\n    indices.push(0, segments + 1, 1);\r\n\r\n    return {\r\n      positions: new Float32Array(positions),\r\n      uvs: new Float32Array(uvs),\r\n      indices: new Uint16Array(indices)\r\n    };\r\n  }\r\n\r\n  static diamond(S = 1) {\r\n    const h = S, p = S / 2;\r\n    const pos = new Float32Array([\r\n      0, h, 0,\r\n      -p, 0, -p, p, 0, -p, p, 0, p, -p, 0, p,\r\n      0, -h, 0\r\n    ]);\r\n    const uv = new Float32Array(6 * 2).fill(0);\r\n    const idx = new Uint16Array([\r\n      0, 1, 2, 0, 2, 3, 0, 3, 4, 0, 4, 1,\r\n      5, 2, 1, 5, 3, 2, 5, 4, 3, 5, 1, 4\r\n    ]);\r\n    return {positions: pos, uvs: uv, indices: idx};\r\n  }\r\n\r\n  // --- FANTASY & EFFECT GEOMETRIES -----------------------------------------\r\n  static thunder(S = 1) {\r\n    // jagged lightning bolt made of zig-zag quads\r\n    const pts = [0, 0, 0];\r\n    for(let i = 1;i < 8;i++) {\r\n      const x = (Math.random() - 0.5) * 0.2 * S;\r\n      const y = i * (S / 7);\r\n      const z = (Math.random() - 0.5) * 0.1 * S;\r\n      pts.push(x, y, z);\r\n    }\r\n    const p = [], uv = [], ind = [];\r\n    for(let i = 0;i < pts.length / 3 - 1;i++) {\r\n      const x1 = pts[i * 3], y1 = pts[i * 3 + 1], z1 = pts[i * 3 + 2];\r\n      const x2 = pts[(i + 1) * 3], y2 = pts[(i + 1) * 3 + 1], z2 = pts[(i + 1) * 3 + 2];\r\n      const w = 0.03 * S;\r\n      p.push(x1 - w, y1, z1, x1 + w, y1, z1, x2 - w, y2, z2, x2 + w, y2, z2);\r\n      uv.push(0, 0, 1, 0, 0, 1, 1, 1);\r\n      const o = i * 4;\r\n      ind.push(o, o + 1, o + 2, o + 1, o + 3, o + 2);\r\n    }\r\n    return {positions: new Float32Array(p), uvs: new Float32Array(uv), indices: new Uint16Array(ind)};\r\n  }\r\n\r\n  static rock(S = 1, detail = 4) {\r\n    // randomly perturbed sphere for organic shape\r\n    const base = GeometryFactory.sphere(S, detail);\r\n    const p = base.positions;\r\n    for(let i = 0;i < p.length;i += 3) {\r\n      const n = (Math.random() * 0.3 + 0.85);\r\n      p[i] *= n; p[i + 1] *= n; p[i + 2] *= n;\r\n    }\r\n    return base;\r\n  }\r\n\r\n  static meteor(S = 1, detail = 6) {\r\n    const base = GeometryFactory.rock(S, detail);\r\n    const p = base.positions;\r\n    // stretch and skew\r\n    for(let i = 0;i < p.length;i += 3) {\r\n      p[i + 1] *= (1.4 + Math.random() * 0.5);\r\n      p[i] *= (0.8 + Math.random() * 0.3);\r\n    }\r\n    return base;\r\n  }\r\n\r\n  static shard(S = 1) {\r\n    const positions = new Float32Array([\r\n      0, 0, 0, S * 0.3, 0, S * 0.2, -S * 0.2, 0, S * 0.3, 0, S * 1.2, 0\r\n    ]);\r\n    const uvs = new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]);\r\n    const indices = new Uint16Array([0, 1, 2, 1, 2, 3, 0, 2, 3, 0, 1, 3]);\r\n    return {positions, uvs, indices};\r\n  }\r\n\r\n  static circlePlane(radius = 1, segments = 32) {\r\n    const positions = [];\r\n    const uvs = [];\r\n    const indices = [];\r\n\r\n    // Center vertex\r\n    positions.push(0, 0, 0);\r\n    uvs.push(0.5, 0.5);\r\n\r\n    // Outer ring vertices\r\n    for(let i = 0;i <= segments;i++) {\r\n      const angle = (i / segments) * Math.PI * 2;\r\n      const x = Math.cos(angle) * radius;\r\n      const y = 0;\r\n      const z = Math.sin(angle) * radius;\r\n      positions.push(x, y, z);\r\n      uvs.push((x / radius + 1) / 2, (z / radius + 1) / 2);\r\n    }\r\n\r\n    // Triangles (fan)\r\n    for(let i = 1;i <= segments;i++) {\r\n      indices.push(0, i, i + 1);\r\n    }\r\n\r\n    return {\r\n      positions: new Float32Array(positions),\r\n      uvs: new Float32Array(uvs),\r\n      indices: new Uint16Array(indices)\r\n    };\r\n  }\r\n\r\n\r\n  static ring(outerRadius = 4, innerRadiusRatio = 0.7, segments = 48, height = 0.05) {\r\n    const innerRadius = outerRadius * innerRadiusRatio;\r\n    const positions = [];\r\n    const uvs = [];\r\n    const indices = [];\r\n\r\n    for(let i = 0;i <= segments;i++) {\r\n      const angle = (i / segments) * Math.PI * 2;\r\n      const cos = Math.cos(angle);\r\n      const sin = Math.sin(angle);\r\n\r\n      // outer edge\r\n      positions.push(cos * outerRadius, 0, sin * outerRadius);\r\n      uvs.push((cos + 1) / 2, (sin + 1) / 2);\r\n\r\n      // inner edge (slightly higher if you want a bit of volume)\r\n      positions.push(cos * innerRadius, height, sin * innerRadius);\r\n      uvs.push((cos * innerRadius / outerRadius + 1) / 2, (sin * innerRadius / outerRadius + 1) / 2);\r\n    }\r\n\r\n    // Triangles\r\n    for(let i = 0;i < segments * 2;i += 2) {\r\n      indices.push(i, i + 1, i + 2);\r\n      indices.push(i + 1, i + 3, i + 2);\r\n    }\r\n\r\n    return {\r\n      positions: new Float32Array(positions),\r\n      uvs: new Float32Array(uvs),\r\n      indices: new Uint16Array(indices)\r\n    };\r\n  }\r\n}", "export const geoInstancedEffect = `struct Camera {\r\n  viewProjMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\n// --- INSTANCE STORAGE BUFFER ----------------------------------------------\r\nstruct InstanceData {\r\n  model : mat4x4<f32>,\r\n  color : vec4<f32>,\r\n};\r\n@group(0) @binding(1) var<storage, read> instances : array<InstanceData>;\r\n\r\nstruct VertexInput {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) v_uv : vec2<f32>,\r\n  @location(1) v_color : vec4<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VertexInput, @builtin(instance_index) instanceIndex: u32) -> VSOut {\r\n  var out : VSOut;\r\n\r\n  // Use per-instance model matrix & color\r\n  let modelMatrix = instances[instanceIndex].model;\r\n  let color = instances[instanceIndex].color;\r\n\r\n  let worldPos = modelMatrix * vec4<f32>(input.position,1.0);\r\n  out.Position = camera.viewProjMatrix * worldPos;\r\n  out.v_uv = input.uv;\r\n  out.v_color = color;\r\n  return out;\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n  let dist = length(uv);\r\n  let glow = exp(-dist * 1.0);\r\n  let baseColor = vec3<f32>(0.2, 0.7, 1.0);\r\n  let glowColor = vec3<f32>(0.7, 0.9, 1.0);\r\n  let color = mix(baseColor, glowColor, glow) * glow * input.v_color.rgb;\r\n  let alpha = input.v_color.a;\r\n  return vec4<f32>(color, alpha);\r\n}\r\n`;", "import {GeometryFactory} from \"../geometry-factory.js\";\r\nimport {mat4} from \"wgpu-matrix\";\r\nimport {geoInstancedEffect} from \"../../shaders/standalone/geo.instanced.js\";\r\n\r\nexport class GenGeo {\r\n  constructor(device, format, type = \"sphere\", scale = 1) {\r\n    this.device = device;\r\n    this.format = format;\r\n    const geom = GeometryFactory.create(type, scale);\r\n    this.vertexData = geom.positions;\r\n    this.uvData = geom.uvs;\r\n    this.indexData = geom.indices;\r\n    this.enabled = true;\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    const {vertexData, uvData, indexData} = this;\r\n    // GPU buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.instanceTargets = [];\r\n    this.lerpSpeed = 0.05;\r\n    this.maxInstances = 5;\r\n    this.instanceCount = 2;\r\n    this.floatsPerInstance = 16 + 4;\r\n\r\n    for(let x = 0;x < this.maxInstances;x++) {\r\n      this.instanceTargets.push({\r\n        index: x,\r\n        position: [0, 0, 0],\r\n        currentPosition: [0, 0, 0],\r\n        scale: [1, 1, 1],\r\n        currentScale: [1, 1, 1],\r\n        color: [0.6, 0.8, 1.0, 0.4],\r\n      });\r\n    }\r\n    this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: this.instanceData.byteLength,\r\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: geoInstancedEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'less-equal', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    const count = Math.min(this.instanceCount, this.maxInstances);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // smooth interpolation of position & scale\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n      }\r\n      const local = mat4.identity();\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n      this.instanceData.set(finalMat, offset);\r\n      this.instanceData.set(t.color, offset + 16);\r\n    }\r\n    // IMPORTANT: upload ONLY the active range of floats to GPU to avoid leftover instances\r\n    const activeFloatCount = count * this.floatsPerInstance;\r\n    const activeBytes = activeFloatCount * 4;\r\n    // .subarray(0, activeFloatCount) ensures we don't upload garbage beyond instanceCount\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, this.instanceData.subarray(0, activeFloatCount));\r\n  };\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount, this.instanceCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n    this.draw(transPass, viewProjMatrix);\r\n  }\r\n}", "export const hpBarEffectShaders = `\r\nstruct Camera {\r\n  viewProj : mat4x4f\r\n};\r\nstruct Model {\r\n  model : mat4x4f,\r\n  color : vec4f,\r\n  progress : f32,\r\n};\r\n\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n@group(0) @binding(1) var<uniform> model : Model;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) position : vec4f,\r\n  @location(0) uv : vec2f,\r\n};\r\n\r\n@vertex\r\nfn vsMain(\r\n  @location(0) position : vec3f,\r\n  @location(1) uv : vec2f\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  output.position = camera.viewProj * model.model * vec4f(position, 1.0);\r\n  output.uv = uv;\r\n  return output;\r\n}\r\n\r\n@fragment\r\nfn fsMain(in : VertexOutput) -> @location(0) vec4f {\r\n  // simple left-to-right fill based on progress\r\n  if (in.uv.x > model.progress) {\r\n    return vec4f(0.1, 0.1, 0.1, 0.3); // empty (transparent gray)\r\n  }\r\n  return model.color; // filled\r\n}\r\n`;", "import {mat4} from \"wgpu-matrix\";\r\nimport {hpBarEffectShaders} from \"../../shaders/energy-bars/energy-bar-shader.js\";\r\n\r\nexport class HPBarEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    this.progress = 1.0;\r\n    this.color = [0.1, 0.9, 0.1, 1.0];\r\n    this.offsetY = 48;\r\n    this.enabled = true;\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Simple flat bar (width 100, height 10)\r\n    const W = 40;\r\n    const H = 3;\r\n\r\n    const vertexData = new Float32Array([\r\n      -0.5 * W, 0.5 * H, 0.0,\r\n      0.5 * W, 0.5 * H, 0.0,\r\n      -0.5 * W, -0.5 * H, 0.0,\r\n      0.5 * W, -0.5 * H, 0.0,\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 1,\r\n      1, 1,\r\n      0, 0,\r\n      1, 0\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    // Buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // model + color + progress (64 + 16 + 4)\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64 + 16 + 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // BindGroup\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}}\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}}\r\n      ]\r\n    });\r\n\r\n    // Pipeline\r\n    const shaderModule = this.device.createShaderModule({code: hpBarEffectShaders});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'always', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  setProgress(value) {\r\n    this.progress = Math.max(0.0, Math.min(1.0, value));\r\n  }\r\n\r\n  setColor(r, g, b, a = 1.0) {\r\n    this.color = [r, g, b, a];\r\n  }\r\n\r\n  draw(pass, cameraMatrix, modelMatrix) {\r\n    const color = new Float32Array(this.color);\r\n    const progressData = new Float32Array([this.progress]);\r\n\r\n    // Pack uniforms manually\r\n    const buffer = new ArrayBuffer(64 + 16 + 4);\r\n    const f32 = new Float32Array(buffer);\r\n    f32.set(cameraMatrix, 0); // not needed here\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, modelMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, color);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64 + 16, progressData);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, ) {\r\n    const pos = mesh.position;\r\n    const modelMatrix = mat4.identity();\r\n    mat4.translate(modelMatrix, [pos.x, pos.y + this.offsetY, pos.z], modelMatrix);\r\n    this.draw(pass, viewProjMatrix, modelMatrix);\r\n  }\r\n}", "import {mat4} from \"wgpu-matrix\";\r\nimport {hpBarEffectShaders} from \"../../shaders/energy-bars/energy-bar-shader.js\";\r\n\r\nexport class MANABarEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n\r\n    this.progress = 1.0;\r\n    this.color = [0.1, 0.1, 0.9, 1.0];\r\n    this.offsetY = 45;\r\n    this.enabled = true;\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    // Simple flat bar (width 100, height 10)\r\n    const W = 40;\r\n    const H = 3;\r\n\r\n    const vertexData = new Float32Array([\r\n      -0.5 * W, 0.5 * H, 0.0,\r\n      0.5 * W, 0.5 * H, 0.0,\r\n      -0.5 * W, -0.5 * H, 0.0,\r\n      0.5 * W, -0.5 * H, 0.0,\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 1,\r\n      1, 1,\r\n      0, 0,\r\n      1, 0\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    // Buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // model + color + progress (64 + 16 + 4)\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64 + 16 + 16,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    // BindGroup\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}}\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}}\r\n      ]\r\n    });\r\n\r\n    // Pipeline\r\n    const shaderModule = this.device.createShaderModule({code: hpBarEffectShaders});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'always', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  setProgress(value) {\r\n    this.progress = Math.max(0.0, Math.min(1.0, value));\r\n  }\r\n\r\n  setColor(r, g, b, a = 1.0) {\r\n    this.color = [r, g, b, a];\r\n  }\r\n\r\n  draw(pass, cameraMatrix, modelMatrix) {\r\n    const color = new Float32Array(this.color);\r\n    const progressData = new Float32Array([this.progress]);\r\n\r\n    // Pack uniforms manually\r\n    const buffer = new ArrayBuffer(64 + 16 + 4);\r\n    const f32 = new Float32Array(buffer);\r\n    f32.set(cameraMatrix, 0); // not needed here\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, modelMatrix);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, color);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64 + 16, progressData);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, ) {\r\n    const pos = mesh.position;\r\n    const modelMatrix = mat4.identity();\r\n    mat4.translate(modelMatrix, [pos.x, pos.y + this.offsetY, pos.z], modelMatrix);\r\n    this.draw(pass, viewProjMatrix, modelMatrix);\r\n  }\r\n}", "export const flameEffect = /* wgsl */`struct Camera {\r\n  viewProj : mat4x4<f32>\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct ModelData {\r\n  model : mat4x4<f32>,\r\n  time : vec4<f32>,\r\n  intensity : vec4<f32>,\r\n};\r\n@group(0) @binding(1) var<storage, read> modelDataArray : array<ModelData>;\r\n\r\nstruct VSIn {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @builtin(instance_index) instanceIdx : u32,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) position : vec4<f32>,\r\n  @location(0) uv : vec2<f32>,\r\n  @location(1) time : f32,\r\n  @location(2) intensity : f32,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VSIn) -> VSOut {\r\n  var output : VSOut;\r\n  let data = modelDataArray[input.instanceIdx];\r\n\r\n  let worldPos = data.model * vec4<f32>(input.position, 1.0);\r\n  output.position = camera.viewProj * worldPos;\r\n  output.uv = input.uv;\r\n  output.time = data.time.x;\r\n  output.intensity = data.intensity.x;\r\n  return output;\r\n}\r\n\r\n// --- Simple procedural noise ---\r\nfn hash(n : vec2<f32>) -> f32 {\r\n  return fract(sin(dot(n, vec2<f32>(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfn noise(p : vec2<f32>) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash(i + vec2<f32>(0.0,0.0)), hash(i + vec2<f32>(1.0,0.0)), u.x),\r\n    mix(hash(i + vec2<f32>(0.0,1.0)), hash(i + vec2<f32>(1.0,1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n  var uv = input.uv;\r\n  let t = input.time * 2.0;\r\n\r\n  // Animate upward\r\n  uv.y += t * 0.4;\r\n  uv.x += sin(t * 0.7) * 0.1;\r\n\r\n  var n = noise(uv * 6.0 + vec2<f32>(0.0, t * 0.8));\r\n  n = pow(n, 3.0); // sharper flame texture\r\n\r\n  let baseColor = input.color.rgb;\r\n  let intensity = input.intensity;\r\n  let alphaBase = input.color.a;\r\n\r\n  // color and intensity modulation\r\n  var finalColor = baseColor * n * intensity;\r\n\r\n  // smooth alpha mask\r\n  let alpha = smoothstep(0.1, 0.7, n) * alphaBase;\r\n\r\n  // output with premultiplied color (for additive/soft blending)\r\n  return vec4<f32>(finalColor * alpha, alpha);\r\n}\r\n`;\r\n", "import {mat4} from \"wgpu-matrix\";\r\nimport {flameEffect} from \"../../shaders/flame-effect/flameEffect\";\r\n\r\nexport class FlameEffect {\r\n  constructor(device, format) {\r\n    this.device = device;\r\n    this.format = format;\r\n    this.time = 0;\r\n    this.intensity = 12.0;\r\n    this.enabled = true;\r\n    this._initPipeline();\r\n  }\r\n\r\n  _initPipeline() {\r\n    const S = 40;\r\n    const vertexData = new Float32Array([\r\n      -0.5 * S, 0.5 * S, 0,\r\n      0.5 * S, 0.5 * S, 0,\r\n      -0.5 * S, -0.5 * S, 0,\r\n      0.5 * S, -0.5 * S, 0,\r\n    ]);\r\n\r\n    const uvData = new Float32Array([\r\n      0, 1, 1, 1, 0, 0, 1, 0\r\n    ]);\r\n\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // --- Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: 64 + 16 + 16, // model + time/intensity padded\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: flameEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: \"float32x3\"}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: \"float32x2\"}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: \"triangle-list\"},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: \"always\", format: \"depth24plus\"},\r\n      blend: {\r\n        color: {srcFactor: \"src-alpha\", dstFactor: \"one\", operation: \"add\"},\r\n        alpha: {srcFactor: \"one\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"}\r\n      }\r\n    });\r\n  }\r\n\r\n  draw(pass, cameraMatrix) {\r\n    // const timeBuffer = new Float32Array([this.time]);\r\n    // const intensityBuffer = new Float32Array([this.intensity]);\r\n\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, \"uint16\");\r\n    pass.drawIndexed(this.indexCount);\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    const local = mat4.identity();\r\n\r\n    // flame offset or scale\r\n    mat4.translate(local, [0, 20, 0], local);\r\n    mat4.scale(local, [1.0, 1.0, 1.0], local);\r\n\r\n    // multiply with baseModelMatrix to inherit world transform\r\n    const finalMat = mat4.identity();\r\n    mat4.multiply(baseModelMatrix, local, finalMat);\r\n\r\n    // now update GPU buffer\r\n    const timeBuffer = new Float32Array([this.time]);\r\n    const intensityBuffer = new Float32Array([this.intensity]);\r\n\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, finalMat);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 64, timeBuffer);\r\n    this.device.queue.writeBuffer(this.modelBuffer, 80, intensityBuffer);\r\n  };\r\n\r\n  render(pass, mesh, viewProjMatrix, dt = 0.01, offsetY = 50) {\r\n    this.time += dt;\r\n    this.draw(pass, viewProjMatrix);\r\n  }\r\n\r\n  setIntensity(v) {\r\n    this.intensity = v;\r\n  }\r\n}\r\n", "export const flameEffectInstance = `struct Camera {\r\n  viewProj : mat4x4<f32>\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\n// Array of particle instances\r\nstruct ModelData {\r\n  model : mat4x4<f32>,\r\n  time : vec4<f32>,       // x = time\r\n  intensity : vec4<f32>,  // x = intensity\r\n  color : vec4<f32>,      // rgba color\r\n};\r\n@group(0) @binding(1) var<storage, read> modelDataArray : array<ModelData>;\r\n\r\nstruct VSIn {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @builtin(instance_index) instanceIdx : u32,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) position : vec4<f32>,\r\n  @location(0) uv : vec2<f32>,\r\n  @location(1) time : f32,\r\n  @location(2) intensity : f32,\r\n  @location(3) @interpolate(flat) instanceIdx : u32,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VSIn) -> VSOut {\r\n  var output : VSOut;\r\n  let modelData = modelDataArray[input.instanceIdx];\r\n  let worldPos = modelData.model * vec4<f32>(input.position, 1.0);\r\n  output.position = camera.viewProj * worldPos;\r\n  output.uv = input.uv;\r\n  output.time = modelData.time.x;\r\n  output.intensity = modelData.intensity.x;\r\n  output.instanceIdx = input.instanceIdx;\r\n  return output;\r\n}\r\n\r\n// Simple procedural flame noise (value in 0..1)\r\nfn hash(n : vec2<f32>) -> f32 {\r\n  return fract(sin(dot(n, vec2<f32>(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfn noise(p : vec2<f32>) -> f32 {\r\n  let i = floor(p);\r\n  let f = fract(p);\r\n  let u = f * f * (3.0 - 2.0 * f);\r\n  return mix(\r\n    mix(hash(i + vec2<f32>(0.0,0.0)), hash(i + vec2<f32>(1.0,0.0)), u.x),\r\n    mix(hash(i + vec2<f32>(0.0,1.0)), hash(i + vec2<f32>(1.0,1.0)), u.x),\r\n    u.y\r\n  );\r\n}\r\n\r\n// Flame color gradient: black -> red -> orange -> yellow -> white\r\nfn flameColor(n: f32) -> vec3<f32> {\r\n  if (n < 0.3) {\r\n    return vec3<f32>(n * 3.0, 0.0, 0.0);               // dark red\r\n  } else if (n < 0.6) {\r\n    return vec3<f32>(1.0, (n - 0.3) * 3.33, 0.0);      // red -> orange\r\n  } else {\r\n    return vec3<f32>(1.0, 1.0, (n - 0.6) * 2.5);       // orange -> yellow -> white\r\n  }\r\n}\r\n\r\n@fragment\r\nfn fsMain(in : VSOut) -> @location(0) vec4<f32> {\r\n  // Read per-instance data\r\n  let modelData = modelDataArray[in.instanceIdx];\r\n  let baseColor = modelData.color.xyz;\r\n  let instanceAlpha = modelData.color.w;\r\n  let instIntensity = max(0.0, modelData.intensity.x);\r\n\r\n  // time with small instance offset\r\n  let t = in.time * 2.0 + f32(in.instanceIdx) * 0.13;\r\n\r\n  var uv = in.uv;\r\n  uv.y += t * 0.2;\r\n\r\n  // procedural noise\r\n  var n = noise(uv * 5.0 + vec2<f32>(0.0, t * 0.5));\r\n  // keep some brightness: milder sharpening than pow(n,3)\r\n  n = pow(n, 1.5);\r\n\r\n  // base flame color from gradient\r\n  let grad = flameColor(n);\r\n\r\n  let userColor = modelData.color.xyz;\r\n\r\n  // mix ratio (0.0 = pure red, 1.0 = user color)\r\n  let mixFactor = 0.5;\r\n  let mixedColor = mix(grad, userColor, mixFactor);\r\n\r\n  // flicker multipliers (shifted into positive range)\r\n  let flickR = 0.7 + 0.3 * sin(t * 3.0); // 0.4 .. 1.0\r\n  let flickG = 0.6 + 0.4 * cos(t * 2.0); // 0.2 .. 1.0\r\n  let flickB = 0.8 + 0.2 * sin(t * 1.5); // 0.6 .. 1.0\r\n\r\n  // combine gradient with per-instance baseColor and flicker\r\n  // var color = grad * baseColor * vec3<f32>(flickR, flickG, flickB);\r\n  var color = mixedColor * vec3<f32>(flickR, flickG, flickB);\r\n\r\n  // apply instance/global intensity\r\n  color = color * instIntensity;\r\n\r\n  // soft alpha based on noise and instance alpha\r\n  var alpha = smoothstep(0.0, 0.6, n) * instanceAlpha * instIntensity;\r\n\r\n  // final clamp to avoid negative or NaN values\r\n  color = clamp(color, vec3<f32>(0.0), vec3<f32>(10.0)); // allow HDR-like values for additive blending\r\n  alpha = clamp(alpha, 0.0, 1.0);\r\n\r\n  return vec4<f32>(color, alpha);\r\n}\r\n`;\r\n", "import {mat4} from \"wgpu-matrix\";\r\nimport {flameEffectInstance} from \"../../shaders/flame-effect/flame-instanced\";\r\nimport {randomFloatFromTo, randomIntFromTo} from \"../utils\";\r\n\r\nexport class FlameEmitter {\r\n  constructor(device, format, maxParticles = 20) {\r\n    this.device = device;\r\n    this.format = format;\r\n    this.time = 0;\r\n    this.intensity = 3.0;\r\n    this.enabled = true;\r\n    this.maxParticles = maxParticles;\r\n    this.instanceTargets = [];\r\n    this.floatsPerInstance = 28;\r\n    this.instanceData = new Float32Array(maxParticles * this.floatsPerInstance);\r\n    this.smoothFlickeringScale = 0.1;\r\n    this.maxY = 1.9;\r\n    this.minY = 0;\r\n    this.swap0 = 0;\r\n    this.swap1 = 1;\r\n    this.swap2 = 2;\r\n    for(let i = 0;i < maxParticles;i++) {\r\n      this.instanceTargets.push({\r\n        position: [0, 0, 0],\r\n        currentPosition: [0, 0, 0],\r\n        scale: [1, 1, 1],\r\n        currentScale: [1, 1, 1],\r\n        rotation: 0.1,\r\n        color: [1, 0.3, 0, 0.1],\r\n        time: 1,\r\n        intensity: 1,\r\n        riseSpeed: 1\r\n      });\r\n    }\r\n\r\n    this._initPipeline();\r\n  }\r\n\r\n  recreateVertexData(S) {\r\n    const vertexData = new Float32Array([\r\n      -0.4 * S, 0.5 * S, 0.0 * S,\r\n      0.4 * S, 0.5 * S, 0.0 * S,\r\n      -0.2 * S, -0.5 * S, 0.0 * S,\r\n      0.2 * S, -0.5 * S, 0.0 * S,\r\n    ]);\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n  }\r\n\r\n  recreateVertexDataRND(S) {\r\n    const vertexData = new Float32Array([\r\n      -randomFloatFromTo(0.1, 0.8) * S, randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n      randomFloatFromTo(0.1, 0.8) * S, randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n      -randomFloatFromTo(0.1, 0.4) * S, -randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n      randomFloatFromTo(0.1, 0.4) * S, -randomFloatFromTo(0.4, 0.6) * S, 0.0 * S,\r\n    ]);\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n  }\r\n\r\n  _initPipeline() {\r\n    const S = 5;\r\n    const vertexData = new Float32Array([\r\n      -0.2 * S, -0.5 * S, 0.0 * S,\r\n      0.2 * S, -0.5 * S, 0.0 * S,\r\n      -0.4 * S, 0.5 * S, 0.0 * S,\r\n      0.4 * S, 0.5 * S, 0.0 * S,\r\n    ]);\r\n    const uvData = new Float32Array([0, 1, 1, 1, 0, 0, 1, 0]);\r\n    const indexData = new Uint16Array([0, 2, 1, 1, 2, 3]);\r\n\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    // --- Uniforms\r\n    this.cameraBuffer = this.device.createBuffer({size: 64, usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST});\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: this.maxParticles * this.floatsPerInstance * 4,\r\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n      ]\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: flameEffectInstance});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vsMain\",\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: \"float32x3\"}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: \"float32x2\"}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fsMain\",\r\n        targets: [{format: this.format}]\r\n      },\r\n      primitive: {topology: \"triangle-list\"},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: \"less\", format: \"depth24plus\"},\r\n      blend: {\r\n        // color: {srcFactor: \"src-alpha\", dstFactor: \"one\", operation: \"add\"},\r\n        // alpha: {srcFactor: \"one\", dstFactor: \"one-minus-src-alpha\", operation: \"add\"}\r\n        color: {\r\n          srcFactor: 'src-alpha',\r\n          dstFactor: 'one-minus-src-alpha',\r\n          operation: 'add',\r\n        },\r\n        alpha: {\r\n          srcFactor: 'one',\r\n          dstFactor: 'one-minus-src-alpha',\r\n          operation: 'add',\r\n        },\r\n      }\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    const count = Math.min(this.instanceTargets.length, this.maxParticles);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // Smooth interpolation\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * 0.12;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * 0.12;\r\n      }\r\n      // Build local matrix: translate \u2192 rotate \u2192 scale\r\n      const local = mat4.identity();\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.rotateY(local, t.rotation, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n\r\n      this.instanceData.set(finalMat, offset);               // 0..15\r\n      this.instanceData.set([t.time, 0, 0, 0], offset + 16); // 16..19\r\n      this.instanceData.set([t.intensity, 0, 0, 0], offset + 20); // 20..23\r\n      this.instanceData.set([t.color[0], t.color[1], t.color[2], t.color[3] ?? 1.0], offset + 24); // 24..27\r\n    }\r\n\r\n    this.device.queue.writeBuffer(\r\n      this.modelBuffer,\r\n      0,\r\n      this.instanceData.subarray(0, count * this.floatsPerInstance)\r\n    );\r\n  }\r\n\r\n  render(pass, mesh, viewProjMatrix, dt = 0.1) {\r\n    // update global time\r\n    this.time += dt;\r\n    for(const p of this.instanceTargets) {\r\n      p.position[this.swap1] += dt * p.riseSpeed;\r\n      // Reset if too high\r\n      if(p.position[this.swap1] > this.maxY) {\r\n        p.position[this.swap1] = this.minY + Math.random() * 0.5;\r\n        p.position[this.swap0] = (Math.random() - 0.5) * 0.2;\r\n        p.position[this.swap2] = (Math.random() - 0.5) * 0.2 + 0.1;\r\n        p.riseSpeed = 0.2 + Math.random() * 1.0;\r\n      }\r\n      p.scale[0] = p.scale[1] = this.smoothFlickeringScale + Math.sin(this.time * 2.0 + p.position[this.swap1]) * 0.1;\r\n      p.rotation += dt * randomIntFromTo(3, 15);\r\n    }\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, viewProjMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, \"uint16\");\r\n    pass.drawIndexed(this.indexCount, this.instanceTargets.length);\r\n  }\r\n\r\n  setIntensity(v) {this.intensity = v;}\r\n}", "export const geoInstancedTexEffect = `\r\n// === CAMERA & INSTANCE BUFFERS ============================================\r\nstruct Camera {\r\n  viewProjMatrix : mat4x4<f32>,\r\n};\r\n@group(0) @binding(0) var<uniform> camera : Camera;\r\n\r\nstruct InstanceData {\r\n  model : mat4x4<f32>,\r\n  color : vec4<f32>,\r\n};\r\n@group(0) @binding(1) var<storage, read> instances : array<InstanceData>;\r\n\r\n// === TEXTURE & SAMPLER ====================================================\r\n@group(0) @binding(2) var mySampler : sampler;\r\n@group(0) @binding(3) var myTexture : texture_2d<f32>;\r\n\r\n// === VERTEX STAGE =========================================================\r\nstruct VertexInput {\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv       : vec2<f32>,\r\n};\r\n\r\nstruct VSOut {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) v_uv : vec2<f32>,\r\n  @location(1) v_color : vec4<f32>,\r\n};\r\n\r\n@vertex\r\nfn vsMain(input : VertexInput, @builtin(instance_index) instanceIndex : u32) -> VSOut {\r\n  var out : VSOut;\r\n  let inst = instances[instanceIndex];\r\n\r\n  let worldPos = inst.model * vec4<f32>(input.position, 1.0);\r\n  out.Position = camera.viewProjMatrix * worldPos;\r\n  out.v_uv = input.uv;\r\n  out.v_color = inst.color;\r\n  return out;\r\n}\r\n\r\n// === FRAGMENT STAGE =======================================================\r\n@fragment\r\nfn fsMain(input : VSOut) -> @location(0) vec4<f32> {\r\n\r\n // Adjust UV scaling and offset here\r\n  let uvScale = vec2<f32>(1.3, 1.3);   // < 1.0 = zoom out (more texture visible)\r\n  let uvOffset = vec2<f32>(0.01, 0.01); // move the texture slightly\r\n  \r\n  let adjustedUV = input.v_uv; // * uvScale + uvOffset; // make it like ring !\r\n\r\n  let texColor = textureSample(myTexture, mySampler, adjustedUV);\r\n\r\n  let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n  let dist = length(uv);\r\n  let glow = exp(-dist * 1.2);\r\n  let glowColor = mix(vec3<f32>(0.2, 0.7, 1.0), vec3<f32>(0.8, 0.95, 1.0), glow);\r\n\r\n  let baseRGB = texColor.rgb * glowColor;\r\n  let tintedRGB = mix(baseRGB, input.v_color.rgb, 0.8);\r\n  let finalAlpha = texColor.a * input.v_color.a * glow;\r\n\r\n  return vec4<f32>(tintedRGB, finalAlpha);\r\n\r\n  // let texColor = textureSample(myTexture, mySampler, input.v_uv);\r\n\r\n  // let uv = input.v_uv * 2.0 - vec2<f32>(1.0, 1.0);\r\n  // let dist = length(uv);\r\n  // let glow = exp(-dist * 1.2);\r\n  // let glowColor = mix(vec3<f32>(0.2, 0.7, 1.0), vec3<f32>(0.8, 0.95, 1.0), glow);\r\n\r\n  // // More balanced color blending:\r\n  // let baseRGB = texColor.rgb * glowColor;\r\n  // let tintedRGB = mix(baseRGB, input.v_color.rgb, 0.8); // 0.8 gives strong tint influence\r\n  // let finalAlpha = texColor.a * input.v_color.a * glow;\r\n\r\n  // return vec4<f32>(tintedRGB, finalAlpha);\r\n}\r\n`;\r\n", "import {geoInstancedTexEffect} from \"../../shaders/standalone/geo.tex.js\";\r\nimport {GeometryFactory} from \"../geometry-factory.js\";\r\nimport {mat4} from \"wgpu-matrix\";\r\n\r\nexport class GenGeoTexture {\r\n  constructor(device, format, type = \"sphere\", path, scale = 1) {\r\n    this.device = device;\r\n    this.format = format;\r\n    const geom = GeometryFactory.create(type, scale);\r\n    this.vertexData = geom.positions;\r\n    this.uvData = geom.uvs;\r\n    this.indexData = geom.indices;\r\n    this.enabled = true;\r\n\r\n    this.rotateEffect = true;\r\n    this.rotateEffectSpeed = 10;\r\n    this.rotateAngle = 0;\r\n    this.loadTexture(path).then(() => {\r\n      this._initPipeline();\r\n    })\r\n  }\r\n\r\n  async loadTexture(url) {\r\n    return new Promise(async (resolve, reject) => {\r\n      const img = await fetch(url).then(r => r.blob()).then(createImageBitmap);\r\n      const texture = this.device.createTexture({\r\n        size: [img.width, img.height, 1],\r\n        format: \"rgba8unorm\",\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: img},\r\n        {texture},\r\n        [img.width, img.height]\r\n      );\r\n\r\n      const sampler = this.device.createSampler({\r\n        magFilter: \"linear\",\r\n        minFilter: \"linear\",\r\n        addressModeU: \"repeat\",\r\n        addressModeV: \"repeat\"\r\n      });\r\n\r\n      this.texture = texture;\r\n      this.sampler = sampler;\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  _initPipeline() {\r\n    const {vertexData, uvData, indexData} = this;\r\n    // GPU buffers\r\n    this.vertexBuffer = this.device.createBuffer({\r\n      size: vertexData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n    this.uvBuffer = this.device.createBuffer({\r\n      size: uvData.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n    this.indexBuffer = this.device.createBuffer({\r\n      size: Math.ceil(indexData.byteLength / 4) * 4,\r\n      usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n    });\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n    this.indexCount = indexData.length;\r\n\r\n    this.cameraBuffer = this.device.createBuffer({\r\n      size: 64,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.instanceTargets = [];\r\n    this.lerpSpeed = 0.05;\r\n    this.maxInstances = 5;\r\n    this.instanceCount = 2;\r\n    this.floatsPerInstance = 16 + 4;\r\n\r\n    for(let x = 0;x < this.maxInstances;x++) {\r\n      this.instanceTargets.push({\r\n        index: x,\r\n        position: [0, 0, 0],\r\n        currentPosition: [0, 0, 0],\r\n        scale: [1, 1, 1],\r\n        currentScale: [1, 1, 1],\r\n        color: [0.6, 0.8, 1.0, 0.4],\r\n      });\r\n    }\r\n    this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n\r\n    this.modelBuffer = this.device.createBuffer({\r\n      size: this.instanceData.byteLength,\r\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n        {binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: {}},\r\n        {binding: 3, visibility: GPUShaderStage.FRAGMENT, texture: {}},\r\n      ],\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n        {binding: 2, resource: this.sampler},\r\n        {binding: 3, resource: this.texture.createView()},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: geoInstancedTexEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'less-equal', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    if(this.rotateEffect) {\r\n      this.rotateAngle = (this.rotateAngle ?? 0) + this.rotateEffectSpeed; // accumulate rotation\r\n      if (this.rotateAngle >= 360) {\r\n        this.rotateAngle = 0;\r\n      }\r\n    }\r\n    const count = Math.min(this.instanceCount, this.maxInstances);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // smooth interpolation of position & scale\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n      }\r\n      const local = mat4.identity();\r\n      if(this.rotateEffect == true) {\r\n        mat4.rotateY(local, this.rotateAngle, local);\r\n      }\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n      this.instanceData.set(finalMat, offset);\r\n      this.instanceData.set(t.color, offset + 16);\r\n    }\r\n    // IMPORTANT: upload ONLY the active range of floats to GPU to avoid leftover instances\r\n    const activeFloatCount = count * this.floatsPerInstance;\r\n    const activeBytes = activeFloatCount * 4;\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, this.instanceData.subarray(0, activeFloatCount));\r\n  };\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount, this.instanceCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n    this.draw(transPass, viewProjMatrix);\r\n  }\r\n}", "import {geoInstancedTexEffect} from \"../../shaders/standalone/geo.tex.js\";\r\nimport {GeometryFactory} from \"../geometry-factory.js\";\r\nimport {mat4} from \"wgpu-matrix\";\r\n\r\nexport class GenGeoTexture2 {\r\n  constructor(device, format, type = \"sphere\", path, scale = 1) {\r\n    this.device = device;\r\n    this.format = format;\r\n    const geom = GeometryFactory.create(type, scale);\r\n    this.vertexData = geom.positions;\r\n    this.uvData = geom.uvs;\r\n    this.indexData = geom.indices;\r\n    this.enabled = true;\r\n\r\n    this.rotateEffect = true;\r\n    this.rotateEffectSpeed = 10;\r\n    this.rotateAngle = 0;\r\n    this.loadTexture(path).then(() => {\r\n      this._initPipeline();\r\n    })\r\n  }\r\n\r\n  async loadTexture(url) {\r\n    return new Promise(async (resolve, reject) => {\r\n      const img = await fetch(url).then(r => r.blob()).then(createImageBitmap);\r\n      const texture = this.device.createTexture({\r\n        size: [img.width, img.height, 1],\r\n        format: \"rgba8unorm\",\r\n        usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT,\r\n      });\r\n\r\n      this.device.queue.copyExternalImageToTexture(\r\n        {source: img},\r\n        {texture},\r\n        [img.width, img.height]\r\n      );\r\n\r\n      const sampler = this.device.createSampler({\r\n        magFilter: \"linear\",\r\n        minFilter: \"linear\",\r\n        addressModeU: \"repeat\",\r\n        addressModeV: \"repeat\"\r\n      });\r\n\r\n      this.texture = texture;\r\n      this.sampler = sampler;\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  _initPipeline() {\r\n    const {vertexData, uvData, indexData} = this;\r\n\r\n  // --- POSITION BUFFER (aligned)\r\n  this.vertexBuffer = this.device.createBuffer({\r\n    size: Math.ceil(vertexData.byteLength / 4) * 4,\r\n    usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n  });\r\n  this.device.queue.writeBuffer(this.vertexBuffer, 0, vertexData);\r\n\r\n  // --- UV BUFFER (aligned)\r\n  this.uvBuffer = this.device.createBuffer({\r\n    size: Math.ceil(uvData.byteLength / 4) * 4,\r\n    usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n  });\r\n  this.device.queue.writeBuffer(this.uvBuffer, 0, uvData);\r\n\r\n  // --- INDEX BUFFER (aligned)\r\n  const alignedIndexSize = Math.ceil(indexData.byteLength / 4) * 4;\r\n  this.indexBuffer = this.device.createBuffer({\r\n    size: alignedIndexSize,\r\n    usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST\r\n  });\r\n\r\n  // Create a temporary padded buffer if necessary\r\n  if (indexData.byteLength !== alignedIndexSize) {\r\n    const tmp = new Uint8Array(alignedIndexSize);\r\n    tmp.set(new Uint8Array(indexData.buffer));\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, tmp);\r\n  } else {\r\n    this.device.queue.writeBuffer(this.indexBuffer, 0, indexData);\r\n  }\r\n\r\n  this.indexCount = indexData.length;\r\n\r\n  // --- rest of your setup (no change)\r\n  this.cameraBuffer = this.device.createBuffer({\r\n    size: 64,\r\n    usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST\r\n  });\r\n\r\n  this.instanceTargets = [];\r\n  this.lerpSpeed = 0.05;\r\n  this.maxInstances = 5;\r\n  this.instanceCount = 2;\r\n  this.floatsPerInstance = 16 + 4;\r\n\r\n  for (let x = 0; x < this.maxInstances; x++) {\r\n    this.instanceTargets.push({\r\n      index: x,\r\n      position: [0, 0, 0],\r\n      currentPosition: [0, 0, 0],\r\n      scale: [1, 1, 1],\r\n      currentScale: [1, 1, 1],\r\n      color: [0.6, 0.8, 1.0, 0.4],\r\n    });\r\n  }\r\n\r\n  this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n  this.modelBuffer = this.device.createBuffer({\r\n    size: Math.ceil(this.instanceData.byteLength / 4) * 4,\r\n    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n  });\r\n\r\n\r\n    const bindGroupLayout = this.device.createBindGroupLayout({\r\n      entries: [\r\n        {binding: 0, visibility: GPUShaderStage.VERTEX, buffer: {}},\r\n        {binding: 1, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n        {binding: 2, visibility: GPUShaderStage.FRAGMENT, sampler: {}},\r\n        {binding: 3, visibility: GPUShaderStage.FRAGMENT, texture: {}},\r\n      ],\r\n    });\r\n\r\n    this.bindGroup = this.device.createBindGroup({\r\n      layout: bindGroupLayout,\r\n      entries: [\r\n        {binding: 0, resource: {buffer: this.cameraBuffer}},\r\n        {binding: 1, resource: {buffer: this.modelBuffer}},\r\n        {binding: 2, resource: this.sampler},\r\n        {binding: 3, resource: this.texture.createView()},\r\n      ]\r\n    });\r\n\r\n    const shaderModule = this.device.createShaderModule({code: geoInstancedTexEffect});\r\n    const pipelineLayout = this.device.createPipelineLayout({bindGroupLayouts: [bindGroupLayout]});\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      layout: pipelineLayout,\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: 'vsMain',\r\n        buffers: [\r\n          {arrayStride: 3 * 4, attributes: [{shaderLocation: 0, offset: 0, format: 'float32x3'}]},\r\n          {arrayStride: 2 * 4, attributes: [{shaderLocation: 1, offset: 0, format: 'float32x2'}]}\r\n        ]\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: 'fsMain',\r\n        targets: [{\r\n          format: this.format,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }]\r\n      },\r\n      primitive: {topology: 'triangle-list'},\r\n      depthStencil: {depthWriteEnabled: false, depthCompare: 'less-equal', format: 'depth24plus'}\r\n    });\r\n  }\r\n\r\n  updateInstanceData = (baseModelMatrix) => {\r\n    if(this.rotateEffect) {\r\n      this.rotateAngle = (this.rotateAngle ?? 0) + this.rotateEffectSpeed; // accumulate rotation\r\n      if (this.rotateAngle >= 360) {\r\n        this.rotateAngle = 0;\r\n      }\r\n    }\r\n    const count = Math.min(this.instanceCount, this.maxInstances);\r\n    for(let i = 0;i < count;i++) {\r\n      const t = this.instanceTargets[i];\r\n      // smooth interpolation of position & scale\r\n      for(let j = 0;j < 3;j++) {\r\n        t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n        t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n      }\r\n      const local = mat4.identity();\r\n      if(this.rotateEffect == true) {\r\n        mat4.rotateY(local, this.rotateAngle, local);\r\n      }\r\n      mat4.translate(local, t.currentPosition, local);\r\n      mat4.scale(local, t.currentScale, local);\r\n      const finalMat = mat4.identity();\r\n      mat4.multiply(baseModelMatrix, local, finalMat);\r\n      const offset = i * this.floatsPerInstance;\r\n      this.instanceData.set(finalMat, offset);\r\n      this.instanceData.set(t.color, offset + 16);\r\n    }\r\n    // IMPORTANT: upload ONLY the active range of floats to GPU to avoid leftover instances\r\n    const activeFloatCount = count * this.floatsPerInstance;\r\n    const activeBytes = activeFloatCount * 4;\r\n    this.device.queue.writeBuffer(this.modelBuffer, 0, this.instanceData.subarray(0, activeFloatCount));\r\n  };\r\n\r\n  draw(pass, cameraMatrix) {\r\n    this.device.queue.writeBuffer(this.cameraBuffer, 0, cameraMatrix);\r\n    pass.setPipeline(this.pipeline);\r\n    pass.setBindGroup(0, this.bindGroup);\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.uvBuffer);\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    pass.drawIndexed(this.indexCount, this.instanceCount);\r\n  }\r\n\r\n  render(transPass, mesh, viewProjMatrix) {\r\n    this.draw(transPass, viewProjMatrix);\r\n  }\r\n}", "import {mat4, vec3} from 'wgpu-matrix';\r\nimport {Position, Rotation} from \"../matrix-class\";\r\nimport {degToRad, genName, LOG_FUNNY_SMALL} from '../utils';\r\nimport {fragmentVideoWGSL} from '../../shaders/fragment.video.wgsl';\r\nimport {PointerEffect} from '../effects/pointerEffect';\r\nimport MaterialsInstanced from './materials-instanced';\r\nimport {vertexWGSLInstanced} from '../../shaders/instanced/vertex.instanced.wgsl';\r\nimport {BVHPlayerInstances} from '../loaders/bvh-instaced';\r\nimport {GenGeo} from '../effects/gen';\r\nimport {HPBarEffect} from '../effects/energy-bar';\r\nimport {MANABarEffect} from '../effects/mana-bar';\r\nimport {FlameEffect} from '../effects/flame';\r\nimport {FlameEmitter} from '../effects/flame-emmiter';\r\nimport {GenGeoTexture} from '../effects/gen-tex';\r\nimport {GenGeoTexture2} from '../effects/gen-tex2';\r\n\r\nexport default class MEMeshObjInstances extends MaterialsInstanced {\r\n  constructor(canvas, device, context, o, inputHandler, globalAmbient, _glbFile = null, primitiveIndex = null, skinnedNodeIndex = null) {\r\n    super(device, o.material, _glbFile);\r\n    if(typeof o.name === 'undefined') o.name = genName(3);\r\n    if(typeof o.raycast === 'undefined') {\r\n      this.raycast = {enabled: false, radius: 2};\r\n    } else {\r\n      this.raycast = o.raycast;\r\n    }\r\n    // console.info('WHAT IS [MEMeshObjInstances]', o.pointerEffect)\r\n    this.pointerEffect = o.pointerEffect;\r\n    this.name = o.name;\r\n    this.done = false;\r\n    this.canvas = canvas;\r\n    this.device = device;\r\n    this.context = context;\r\n    this.entityArgPass = o.entityArgPass;\r\n    this.clearColor = \"red\";\r\n    this.video = null;\r\n    this.FINISH_VIDIO_INIT = false;\r\n    this.globalAmbient = [...globalAmbient];\r\n\r\n    this.blendInstanced = false;\r\n\r\n    if(typeof o.material.useTextureFromGlb === 'undefined' ||\r\n      typeof o.material.useTextureFromGlb !== \"boolean\") {\r\n      o.material.useTextureFromGlb = false;\r\n    }\r\n    // console.log('Material class arg:', o.material)\r\n    this.material = o.material;\r\n\r\n    // Mesh stuff - for single mesh or t-posed (fiktive-first in loading order)\r\n    this.mesh = o.mesh;\r\n    if(_glbFile != null) {\r\n      if(typeof this.mesh == 'undefined') {\r\n        this.mesh = {};\r\n        this.mesh.feedFromRealGlb = true;\r\n      }\r\n      // V\r\n      const verView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].positions.view;\r\n      const byteOffsetV = verView.byteOffset || 0;\r\n      const byteLengthV = verView.buffer.byteLength;\r\n      const vertices = new Float32Array(\r\n        verView.buffer.buffer,\r\n        byteOffsetV,\r\n        byteLengthV / 4\r\n      );\r\n      this.mesh.vertices = vertices;\r\n      //N\r\n      const norView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].normals.view;\r\n      const normalsUint8 = norView.buffer;\r\n      const byteOffsetN = norView.byteOffset || 0; // if your loader provides it\r\n      const byteLengthN = normalsUint8.byteLength;\r\n      const normals = new Float32Array(\r\n        normalsUint8.buffer,\r\n        byteOffsetN,\r\n        byteLengthN / 4\r\n      );\r\n      this.mesh.vertexNormals = normals;\r\n      //UV\r\n      let accessor = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].texcoords[0];\r\n      const bufferView = accessor.view;\r\n      const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n      const count = accessor.count * 2; // VEC2 = 2 floats per vertex\r\n      const uvFloatArray = new Float32Array(bufferView.buffer.buffer, byteOffset, count);\r\n      this.mesh.uvs = uvFloatArray;\r\n      this.mesh.textures = uvFloatArray;\r\n      // I\r\n      let binaryI = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].indices;\r\n      const indicesView = binaryI.view;\r\n      const indicesUint8 = indicesView.buffer;\r\n      const byteOffsetI = indicesView.byteOffset || 0;\r\n      const byteLengthI = indicesUint8.byteLength;\r\n      // Decide on type from accessor.componentType\r\n      // (5121 = UNSIGNED_BYTE, 5123 = UNSIGNED_SHORT, 5125 = UNSIGNED_INT)\r\n      let indicesArray;\r\n      switch(binaryI.componentType) {\r\n        case 5121: // UNSIGNED_BYTE\r\n          indicesArray = new Uint8Array(indicesUint8.buffer, byteOffsetI, byteLengthI);\r\n          break;\r\n        case 5123: // UNSIGNED_SHORT\r\n          indicesArray = new Uint16Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 2);\r\n          break;\r\n        case 5125: // UNSIGNED_INT\r\n          indicesArray = new Uint32Array(indicesUint8.buffer, byteOffsetI, byteLengthI / 4);\r\n          break;\r\n        default:\r\n          throw new Error(\"Unknown index componentType\");\r\n      }\r\n      this.mesh.indices = indicesArray;\r\n      // W\r\n      let weightsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].weights.view;\r\n      this.mesh.weightsView = weightsView;\r\n      let primitive = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex];\r\n      let finalRoundedWeights = this.getAccessorArray(_glbFile, primitive.weights.weightsAccessIndex);\r\n      const weightsArray = finalRoundedWeights;\r\n      // Normalize each group of 4\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const sum = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(sum > 0) {\r\n          const inv = 1 / sum;\r\n          weightsArray[i] *= inv;\r\n          weightsArray[i + 1] *= inv;\r\n          weightsArray[i + 2] *= inv;\r\n          weightsArray[i + 3] *= inv;\r\n        } else {\r\n          weightsArray[i] = 1; weightsArray[i + 1] = 0;\r\n          weightsArray[i + 2] = 0; weightsArray[i + 3] = 0;\r\n        }\r\n      }\r\n      for(let i = 0;i < weightsArray.length;i += 4) {\r\n        const s = weightsArray[i] + weightsArray[i + 1] + weightsArray[i + 2] + weightsArray[i + 3];\r\n        if(Math.abs(s - 1.0) > 0.001) console.warn(\"Weight not normalized!\", i, s);\r\n      }\r\n      this.mesh.weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer real data\",\r\n        size: weightsArray.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(this.mesh.weightsBuffer.getMappedRange()).set(weightsArray);\r\n      this.mesh.weightsBuffer.unmap();\r\n      let jointsView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].joints.view;\r\n      this.mesh.jointsView = jointsView;\r\n      // Create typed array from the buffer (Uint16Array or Uint8Array depending on GLB)\r\n      let jointsArray16 = new Uint16Array(\r\n        jointsView.buffer,\r\n        jointsView.byteOffset || 0,\r\n        jointsView.byteLength / 2 // in Uint16 elements\r\n      );\r\n      const jointsArray32 = new Uint32Array(jointsArray16.length);\r\n      for(let i = 0;i < jointsArray16.length;i++) {\r\n        jointsArray32[i] = jointsArray16[i];\r\n      }\r\n      // Create GPU buffer for joints\r\n      this.mesh.jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer[real-data]\",\r\n        size: jointsArray32.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      // Upload the data to GPU\r\n      new Uint32Array(this.mesh.jointsBuffer.getMappedRange()).set(jointsArray32);\r\n      this.mesh.jointsBuffer.unmap();\r\n\r\n      // TANGENTS\r\n      let tangentArray = null;\r\n      if(_glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents) {\r\n        const tangentView = _glbFile.skinnedMeshNodes[skinnedNodeIndex].mesh.primitives[primitiveIndex].tangents.view;\r\n        const byteOffsetT = tangentView.byteOffset || 0;\r\n        const byteLengthT = tangentView.buffer.byteLength;\r\n        tangentArray = new Float32Array(\r\n          tangentView.buffer,\r\n          byteOffsetT,\r\n          byteLengthT / 4\r\n        );\r\n        this.mesh.tangents = tangentArray;\r\n\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer[real-data]\",\r\n          size: tangentArray.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(tangentArray);\r\n        this.mesh.tangentsBuffer.unmap();\r\n      } else {\r\n        // \uD83D\uDFE2 dummy fallback\r\n        const dummyTangents = new Float32Array(this.mesh.vertices.length / 3 * 4);\r\n        for(let i = 0;i < dummyTangents.length;i += 4) {\r\n          dummyTangents[i + 0] = 1.0; // T = (1,0,0)\r\n          dummyTangents[i + 1] = 0.0;\r\n          dummyTangents[i + 2] = 0.0;\r\n          dummyTangents[i + 3] = 1.0; // handedness\r\n        }\r\n        this.mesh.tangentsBuffer = this.device.createBuffer({\r\n          label: \"tangentsBuffer dummy\",\r\n          size: dummyTangents.byteLength,\r\n          usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n          mappedAtCreation: true,\r\n        });\r\n        new Float32Array(this.mesh.tangentsBuffer.getMappedRange()).set(dummyTangents);\r\n        this.mesh.tangentsBuffer.unmap();\r\n        console.warn(\"GLTF primitive has no TANGENT attribute (normal map won\u2019t work properly).\");\r\n      }\r\n    } else {\r\n      this.mesh.uvs = this.mesh.textures;\r\n    }\r\n    // console.log(`%cMesh: ${o.name}`, LOG_FUNNY_SMALL);\r\n    // ObjSequence animation\r\n    if(typeof o.objAnim !== 'undefined' && o.objAnim != null) {\r\n      this.objAnim = o.objAnim;\r\n      for(var key in this.objAnim.animations) {\r\n        if(key != 'active') this.objAnim.animations[key].speedCounter = 0;\r\n      }\r\n      console.log(`%c Mesh objAnim exist: ${o.objAnim}`, LOG_FUNNY_SMALL);\r\n      this.drawElements = this.drawElementsAnim;\r\n    }\r\n    this.inputHandler = inputHandler;\r\n    this.cameras = o.cameras;\r\n    this.mainCameraParams = {\r\n      type: o.mainCameraParams.type,\r\n      responseCoef: o.mainCameraParams.responseCoef\r\n    };\r\n    this.lastFrameMS = 0;\r\n    this.texturesPaths = [];\r\n    o.texturesPaths.forEach((t) => {this.texturesPaths.push(t)})\r\n    this.presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n    this.position = new Position(o.position.x, o.position.y, o.position.z);\r\n    this.rotation = new Rotation(o.rotation.x, o.rotation.y, o.rotation.z);\r\n    this.rotation.rotationSpeed.x = o.rotationSpeed.x;\r\n    this.rotation.rotationSpeed.y = o.rotationSpeed.y;\r\n    this.rotation.rotationSpeed.z = o.rotationSpeed.z;\r\n    this.scale = o.scale;\r\n    // new dummy for skin mesh\r\n    if(!this.joints) {\r\n      const jointsData = new Uint32Array((this.mesh.vertices.length / 3) * 4);\r\n      const jointsBuffer = this.device.createBuffer({\r\n        label: \"jointsBuffer\",\r\n        size: jointsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint32Array(jointsBuffer.getMappedRange()).set(jointsData);\r\n      jointsBuffer.unmap();\r\n      this.joints = {\r\n        data: jointsData,\r\n        buffer: jointsBuffer,\r\n        stride: 16, // vec4<u32>\r\n      };\r\n      const numVerts = this.mesh.vertices.length / 3;\r\n      // Weights data (vec4<f32>) \u2013 default all weight to bone 0\r\n      const weightsData = new Float32Array(numVerts * 4);\r\n      for(let i = 0;i < numVerts;i++) {\r\n        weightsData[i * 4 + 0] = 1.0; // 100% influence of bone 0\r\n        weightsData[i * 4 + 1] = 0.0;\r\n        weightsData[i * 4 + 2] = 0.0;\r\n        weightsData[i * 4 + 3] = 0.0;\r\n      }\r\n      // GPU buffer\r\n      const weightsBuffer = this.device.createBuffer({\r\n        label: \"weightsBuffer dummy\",\r\n        size: weightsData.byteLength,\r\n        usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(weightsBuffer.getMappedRange()).set(weightsData);\r\n      weightsBuffer.unmap();\r\n      this.weights = {\r\n        data: weightsData,\r\n        buffer: weightsBuffer,\r\n        stride: 16, // vec4<f32>\r\n      };\r\n    }\r\n\r\n    this.runProgram = () => {\r\n      return new Promise(async (resolve) => {\r\n        this.shadowDepthTextureSize = 1024;\r\n        this.modelViewProjectionMatrix = mat4.create();\r\n        this.loadTex0(this.texturesPaths).then(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    }\r\n\r\n    this.runProgram().then(() => {\r\n      this.context.configure({\r\n        device: this.device,\r\n        format: this.presentationFormat,\r\n        alphaMode: 'premultiplied',\r\n      });\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexBuffer.getMappedRange()).set(this.mesh.vertices);\r\n        this.vertexBuffer.unmap();\r\n      }\r\n\r\n      // Create the model vertex buffer.\r\n      this.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: this.mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexNormalsBuffer.getMappedRange()).set(this.mesh.vertexNormals);\r\n        this.vertexNormalsBuffer.unmap();\r\n      }\r\n\r\n      this.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: this.mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      {\r\n        new Float32Array(this.vertexTexCoordsBuffer.getMappedRange()).set(this.mesh.textures);\r\n        this.vertexTexCoordsBuffer.unmap();\r\n      }\r\n\r\n      // Create the model index buffer.\r\n      this.indexCount = this.mesh.indices.length;\r\n      const indexCount = this.mesh.indices.length;\r\n      const size = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n\r\n      this.indexBuffer = this.device.createBuffer({\r\n        size,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true\r\n      });\r\n\r\n      new Uint16Array(this.indexBuffer.getMappedRange()).set(this.mesh.indices);\r\n      this.indexBuffer.unmap();\r\n      this.indexCount = indexCount;\r\n      let glbInfo = {\r\n        arrayStride: 4 * 4, // vec4<f32> = 4 * 4 bytes\r\n        attributes: [{format: 'float32x4', offset: 0, shaderLocation: 4}]\r\n      }\r\n\r\n      this.vertexBuffers = [\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [\r\n            {\r\n              // position\r\n              shaderLocation: 0,\r\n              offset: 0,\r\n              format: \"float32x3\",\r\n            }\r\n          ],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 3,\r\n          attributes: [\r\n            {\r\n              // normal\r\n              shaderLocation: 1,\r\n              offset: 0,\r\n              format: \"float32x3\",\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          arrayStride: Float32Array.BYTES_PER_ELEMENT * 2,\r\n          attributes: [\r\n            {\r\n              // uvs\r\n              shaderLocation: 2,\r\n              offset: 0,\r\n              format: \"float32x2\",\r\n            },\r\n          ],\r\n        },\r\n        // joint indices\r\n        {\r\n          arrayStride: 4 * 4, // vec4<u32> = 4 * 4 bytes\r\n          attributes: [{format: 'uint32x4', offset: 0, shaderLocation: 3}]\r\n        },\r\n        // weights\r\n        glbInfo,\r\n      ];\r\n\r\n      if(this.mesh.tangentsBuffer) {\r\n        this.vertexBuffers.push({\r\n          arrayStride: 4 * 4,\r\n          attributes: [\r\n            {shaderLocation: 5, format: \"float32x4\", offset: 0}\r\n          ]\r\n        });\r\n      } else {\r\n        // for non glb - non skinned use basic shaders\r\n      }\r\n\r\n      // Note: The frontFace and cullMode values have no effect on the \r\n      // \"point-list\", \"line-list\", or \"line-strip\" topologies.\r\n      this.primitive = {\r\n        topology: 'triangle-list',\r\n        cullMode: 'back', // typical for shadow passes\r\n        frontFace: 'ccw'\r\n      }\r\n\r\n      // Selected effect\r\n      this.selectedBuffer = device.createBuffer({\r\n        size: 4, // just one float\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.selectedBindGroupLayout = device.createBindGroupLayout({\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {}},\r\n        ],\r\n      });\r\n\r\n      this.selectedBindGroup = device.createBindGroup({\r\n        layout: this.selectedBindGroupLayout,\r\n        entries: [{binding: 0, resource: {buffer: this.selectedBuffer}}],\r\n      });\r\n\r\n      this.setSelectedEffect = (selected = false) => {\r\n        this.device.queue.writeBuffer(this.selectedBuffer, 0, new Float32Array([selected ? 1.0 : 0.0]));\r\n      };\r\n      // 0 default\r\n      this.setSelectedEffect();\r\n\r\n      // Create a bind group layout which holds the scene uniforms and\r\n      // the texture+sampler for depth. We create it manually because the WebPU\r\n      // implementation doesn't infer this from the shader (yet).\r\n      this.createLayoutForRender();\r\n\r\n      // EDIT INSTANCED PART\r\n      this.instanceTargets = [];\r\n      this.lerpSpeed = 0.05;\r\n      this.lerpSpeedAlpha = 0.05;\r\n      this.maxInstances = 5;\r\n      this.instanceCount = 2;\r\n      this.floatsPerInstance = 16 + 4;\r\n\r\n      for(let x = 0;x < this.maxInstances;x++) {\r\n        this.instanceTargets.push({\r\n          index: x,\r\n          position: [0, 0, 0],\r\n          currentPosition: [0, 0, 0],\r\n          scale: [1, 1, 1],\r\n          currentScale: [1, 1, 1],\r\n          color: [0.6, 0.8, 1.0, 0.4],\r\n          currentColor: [0.6, 0.8, 1.0, 0.4],\r\n        });\r\n      }\r\n\r\n      this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n      this.instanceBuffer = device.createBuffer({\r\n        size: this.instanceData.byteLength,\r\n        usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.updateInstanceData = (modelMatrix) => {\r\n        // original (base instance)\r\n        this.instanceData.set(modelMatrix, 0);\r\n        this.instanceData.set([1, 1, 1, 1], 16);\r\n\r\n        // instanced clones\r\n        for(let i = 1;i < this.instanceCount;i++) {\r\n          const t = this.instanceTargets[i];\r\n          const ghost = new Float32Array(modelMatrix);\r\n          // --- Smooth interpolate position\r\n          for(let j = 0;j < 3;j++) {\r\n            t.currentPosition[j] += (t.position[j] - t.currentPosition[j]) * this.lerpSpeed;\r\n            t.currentScale[j] += (t.scale[j] - t.currentScale[j]) * this.lerpSpeed;\r\n            t.currentColor[j] += (t.color[j] - t.currentColor[j]) * this.lerpSpeed;\r\n            if(j == 2) {\r\n              t.currentColor[j + 1] += (t.color[j + 1] - t.currentColor[j + 1]) * this.lerpSpeedAlpha;\r\n            }\r\n          }\r\n          // Apply smoothed transforms\r\n          ghost[0] *= t.currentScale[0];\r\n          ghost[5] *= t.currentScale[1];\r\n          ghost[10] *= t.currentScale[2];\r\n          // pos\r\n          ghost[12] += t.currentPosition[0]; // X\r\n          ghost[13] += t.currentPosition[1]; // Y\r\n          ghost[14] += t.currentPosition[2]; // Z\r\n\r\n          // t.color[0] += t.currentColor[0]//r;\r\n          // t.color[1] += t.currentColor[1]//r;\r\n          // t.color[2] += t.currentColor[2]//r;\r\n          // t.color[3] += t.currentColor[3]//r;\r\n          // Write instance matrix + color\r\n          const offset = 20 * i;\r\n          this.instanceData.set(ghost, offset);\r\n          this.instanceData.set(t.currentColor, offset + 16);\r\n        }\r\n        device.queue.writeBuffer(this.instanceBuffer, 0, this.instanceData);\r\n      };\r\n\r\n      this.updateInstances = (newCount) => {\r\n        if(newCount > this.maxInstances) {\r\n          console.error(`Instance count ${newCount} exceeds buffer max ${this.maxInstances}`);\r\n          return;\r\n        }\r\n        this.instanceCount = newCount;\r\n        this.instanceData = new Float32Array(this.instanceCount * this.floatsPerInstance);\r\n        this.instanceBuffer = device.createBuffer({\r\n          size: this.instanceData.byteLength,\r\n          usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_DST,\r\n        });\r\n        let m = this.getModelMatrix(this.position);\r\n        this.updateInstanceData(m);\r\n\r\n        this.modelBindGroupInstanced = this.device.createBindGroup({\r\n          label: 'modelBindGroup in mesh [instanced]',\r\n          layout: this.uniformBufferBindGroupLayoutInstanced,\r\n          entries: [ //\r\n            {binding: 0, resource: {buffer: this.instanceBuffer, }},\r\n            {binding: 1, resource: {buffer: this.bonesBuffer}}\r\n          ],\r\n        });\r\n      };\r\n\r\n      this.updateMaxInstances = (newMax) => {\r\n        this.maxInstances = newMax;\r\n        for(let x = 0;x < this.maxInstances;x++) {\r\n          this.instanceTargets.push({\r\n            index: x,\r\n            position: [0, 0, 0],\r\n            currentPosition: [0, 0, 0],\r\n            scale: [1, 1, 1],\r\n            currentScale: [1, 1, 1],\r\n            color: [0.6, 0.8, 1.0, 0.4],\r\n            currentColor: [0.6, 0.8, 1.0, 0.4],\r\n          });\r\n        }\r\n      }\r\n      // end of instanced\r\n\r\n      this.modelUniformBuffer = this.device.createBuffer({\r\n        size: 4 * 16, // 4x4 matrix\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      this.sceneUniformBuffer = this.device.createBuffer({\r\n        label: 'sceneUniformBuffer per mesh',\r\n        size: 176,\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      // test MUST BE IF\r\n      this.uniformBufferBindGroupLayoutInstanced = this.device.createBindGroupLayout({\r\n        label: 'uniformBufferBindGroupLayout in mesh [instanced]',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT, buffer: {type: \"read-only-storage\"}},\r\n          {binding: 1, visibility: GPUShaderStage.VERTEX, buffer: {type: 'uniform'}, },\r\n        ],\r\n      });\r\n\r\n      this.uniformBufferBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'uniformBufferBindGroupLayout in mesh [regular]',\r\n        entries: [\r\n          {\r\n            binding: 0,\r\n            visibility: GPUShaderStage.VERTEX,\r\n            buffer: {\r\n              type: 'uniform',\r\n            },\r\n          },\r\n          {\r\n            binding: 1,\r\n            visibility: GPUShaderStage.VERTEX,\r\n            buffer: {\r\n              type: 'uniform',\r\n            },\r\n          },\r\n        ],\r\n      });\r\n\r\n      // dummy for non skin mesh like this class\r\n      function alignTo256(n) {\r\n        return Math.ceil(n / 256) * 256;\r\n      }\r\n\r\n      let MAX_BONES = 100;\r\n      this.MAX_BONES = MAX_BONES;\r\n      this.bonesBuffer = device.createBuffer({\r\n        label: \"bonesBuffer\",\r\n        size: alignTo256(64 * MAX_BONES),\r\n        usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n      });\r\n\r\n      const bones = new Float32Array(this.MAX_BONES * 16);\r\n      for(let i = 0;i < this.MAX_BONES;i++) {\r\n        // identity matrices\r\n        bones.set([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], i * 16);\r\n      }\r\n      this.device.queue.writeBuffer(this.bonesBuffer, 0, bones);\r\n\r\n      this.modelBindGroup = this.device.createBindGroup({\r\n        label: 'modelBindGroup in mesh',\r\n        layout: this.uniformBufferBindGroupLayout,\r\n        entries: [ //\r\n          {binding: 0, resource: {buffer: this.modelUniformBuffer, }},\r\n          {binding: 1, resource: {buffer: this.bonesBuffer}}\r\n        ],\r\n      });\r\n\r\n      this.modelBindGroupInstanced = this.device.createBindGroup({\r\n        label: 'modelBindGroup in mesh [instanced]',\r\n        layout: this.uniformBufferBindGroupLayoutInstanced,\r\n        entries: [ //\r\n          {binding: 0, resource: {buffer: this.instanceBuffer, }},\r\n          {binding: 1, resource: {buffer: this.bonesBuffer}}\r\n        ],\r\n      });\r\n\r\n      this.mainPassBindGroupLayout = this.device.createBindGroupLayout({\r\n        label: 'mainPassBindGroupLayout mesh [instaced]',\r\n        entries: [\r\n          {binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {sampleType: 'depth'}},\r\n          {binding: 1, visibility: GPUShaderStage.FRAGMENT, sampler: {type: 'comparison'}},\r\n        ],\r\n      });\r\n\r\n      this.effects = {};\r\n      // console.log('>>>>>>>>>>>>>EFFECTS>>>>>>>>>>>>>>>>>>>>>>>')\r\n      if(this.pointerEffect && this.pointerEffect.enabled === true) {\r\n        let pf = navigator.gpu.getPreferredCanvasFormat();\r\n        if(typeof this.pointerEffect.pointer !== 'undefined' && this.pointerEffect.pointer == true) {\r\n          this.effects.pointer = new PointerEffect(device, pf, this, true);\r\n        }\r\n        if(typeof this.pointerEffect.ballEffect !== 'undefined' && this.pointerEffect.ballEffect == true) {\r\n          this.effects.ballEffect = new GenGeo(device, pf, 'sphere');\r\n        }\r\n        if(typeof this.pointerEffect.energyBar !== 'undefined' && this.pointerEffect.energyBar == true) {\r\n          this.effects.energyBar = new HPBarEffect(device, pf);\r\n          this.effects.manaBar = new MANABarEffect(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.flameEffect !== 'undefined' && this.pointerEffect.flameEffect == true) {\r\n          this.effects.flameEffect = new FlameEffect(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.flameEmitter !== 'undefined' && this.pointerEffect.flameEmitter == true) {\r\n          this.effects.flameEmitter = new FlameEmitter(device, pf);\r\n        }\r\n        if(typeof this.pointerEffect.circlePlane !== 'undefined' && this.pointerEffect.circlePlane == true) {\r\n          this.effects.circlePlane = new GenGeo(device, pf, 'circlePlane');\r\n        }\r\n        if(typeof this.pointerEffect.circlePlaneTex !== 'undefined' && this.pointerEffect.circlePlaneTex == true) {\r\n          this.effects.circlePlaneTex = new GenGeoTexture(device, pf, 'ring', this.pointerEffect.circlePlaneTexPath);\r\n        }\r\n\r\n        if(typeof this.pointerEffect.circle !== 'undefined' && this.pointerEffect.circlePlaneTexPath !== 'undefined') {\r\n          this.effects.circle = new GenGeoTexture2(device, pf, 'circle2', this.pointerEffect.circlePlaneTexPath);\r\n        }\r\n      }\r\n\r\n      // Rotates the camera around the origin based on time.\r\n      this.getTransformationMatrix = (mainRenderBundle, spotLight, index) => {\r\n        const now = Date.now();\r\n        const dt = (now - this.lastFrameMS) / this.mainCameraParams.responseCoef;\r\n        this.lastFrameMS = now;\r\n        const camera = this.cameras[this.mainCameraParams.type];\r\n        if(index == 0) camera.update(dt, inputHandler());\r\n        const camVP = mat4.multiply(camera.projectionMatrix, camera.view);\r\n        const sceneData = new Float32Array(44);\r\n        // Light VP\r\n        sceneData.set(spotLight.viewProjMatrix, 0);\r\n        // Camera VP\r\n        sceneData.set(camVP, 16);\r\n        // Camera position + padding\r\n        sceneData.set([camera.position.x, camera.position.y, camera.position.z, 0.0], 32);\r\n        // Light position + padding\r\n        sceneData.set([spotLight.position[0], spotLight.position[1], spotLight.position[2], 0.0], 36);\r\n        sceneData.set([this.globalAmbient[0], this.globalAmbient[1], this.globalAmbient[2], 0.0], 40);\r\n        device.queue.writeBuffer(\r\n          this.sceneUniformBuffer,\r\n          0,\r\n          sceneData.buffer,\r\n          sceneData.byteOffset,\r\n          sceneData.byteLength\r\n        );\r\n      };\r\n\r\n      this.getModelMatrix = (pos) => {\r\n        let modelMatrix = mat4.identity();\r\n        mat4.translate(modelMatrix, [pos.x, pos.y, pos.z], modelMatrix);\r\n        if(this.itIsPhysicsBody) {\r\n          mat4.rotate(modelMatrix,\r\n            [this.rotation.axis.x, this.rotation.axis.y, this.rotation.axis.z],\r\n            degToRad(this.rotation.angle),\r\n            modelMatrix\r\n          );\r\n        } else {\r\n          mat4.rotateX(modelMatrix, this.rotation.getRotX(), modelMatrix);\r\n          mat4.rotateY(modelMatrix, this.rotation.getRotY(), modelMatrix);\r\n          mat4.rotateZ(modelMatrix, this.rotation.getRotZ(), modelMatrix);\r\n        }\r\n        // Apply scale if you have it, e.g.:\r\n        // console.warn('what is csle comes from user level not glb ', this.scale)\r\n        if(this.glb || this.objAnim) {\r\n          mat4.scale(modelMatrix, [this.scale[0], this.scale[1], this.scale[2]], modelMatrix);\r\n        }\r\n        return modelMatrix;\r\n      };\r\n\r\n      // looks like affect on transformations for now const 0\r\n      // const modelMatrix = mat4.translation([0, 0, 0]);\r\n      // const modelData = modelMatrix;\r\n      // this.device.queue.writeBuffer(\r\n      //   this.modelUniformBuffer,\r\n      //   0,\r\n      //   modelData.buffer,\r\n      //   modelData.byteOffset,\r\n      //   modelData.byteLength\r\n      // );\r\n      this.done = true;\r\n      try {\r\n        this.setupPipeline();\r\n      } catch(err) {console.log('err in create pipeline in init ', err)}\r\n    }).then(() => {\r\n      if(typeof this.objAnim !== 'undefined' && this.objAnim !== null) {\r\n        console.log('after all updateMeshListBuffers...')\r\n        this.updateMeshListBuffers();\r\n      }\r\n    })\r\n  }\r\n\r\n  setupPipeline = () => {\r\n    this.createBindGroupForRender();\r\n\r\n    const baseDesc = {\r\n      label: 'Mesh Pipeline Base',\r\n      layout: this.device.createPipelineLayout({\r\n        label: 'createPipelineLayout Mesh',\r\n        bindGroupLayouts: [\r\n          this.bglForRender,\r\n          this.uniformBufferBindGroupLayoutInstanced,\r\n          this.selectedBindGroupLayout\r\n        ],\r\n      }),\r\n      vertex: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: vertexWGSLInstanced,\r\n        }),\r\n        buffers: this.vertexBuffers,\r\n      },\r\n      fragment: {\r\n        entryPoint: 'main',\r\n        module: this.device.createShaderModule({\r\n          code: (this.isVideo == true ? fragmentVideoWGSL : this.getMaterial()),\r\n        }),\r\n        constants: {\r\n          shadowDepthTextureSize: this.shadowDepthTextureSize,\r\n        },\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: true,\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n      primitive: this.primitive,\r\n    };\r\n\r\n    // --- Normal (no blending)\r\n    this.pipeline = this.device.createRenderPipeline({\r\n      ...baseDesc,\r\n      label: 'Mesh Pipeline Opaque \u2705',\r\n      fragment: {\r\n        ...baseDesc.fragment,\r\n        targets: [{\r\n          format: this.presentationFormat,\r\n          blend: undefined,\r\n        }],\r\n      },\r\n    });\r\n\r\n    // --- Blended (alpha)\r\n    this.pipelineBlended = this.device.createRenderPipeline({\r\n      ...baseDesc,\r\n      label: 'Mesh Pipeline Blended \u2705',\r\n      fragment: {\r\n        ...baseDesc.fragment,\r\n        targets: [{\r\n          format: this.presentationFormat,\r\n          blend: {\r\n            color: {\r\n              srcFactor: 'src-alpha',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n            alpha: {\r\n              srcFactor: 'one',\r\n              dstFactor: 'one-minus-src-alpha',\r\n              operation: 'add',\r\n            },\r\n          },\r\n        }],\r\n      },\r\n      depthStencil: {\r\n        depthWriteEnabled: false, // <<< disable depth write for transparency\r\n        depthCompare: 'less',\r\n        format: 'depth24plus',\r\n      },\r\n    });\r\n\r\n    // console.log('\u2705Pipelines done');\r\n  };\r\n\r\n  updateModelUniformBuffer = () => {\r\n    // if(this.done == false) return;\r\n    // Per-object model matrix only\r\n    // const modelMatrix = this.getModelMatrix(this.position);\r\n    // this.device.queue.writeBuffer(\r\n    //   this.modelUniformBuffer,\r\n    //   0,\r\n    //   modelMatrix.buffer,\r\n    //   modelMatrix.byteOffset,\r\n    //   modelMatrix.byteLength\r\n    // );\r\n  }\r\n\r\n  createGPUBuffer(dataArray, usage) {\r\n    if(!dataArray || typeof dataArray.length !== 'number') {\r\n      throw new Error('Invalid data array passed to createGPUBuffer');\r\n    }\r\n\r\n    const size = dataArray.length * dataArray.BYTES_PER_ELEMENT;\r\n    if(!Number.isFinite(size) || size <= 0) {\r\n      throw new Error(`Invalid buffer size: ${size}`);\r\n    }\r\n\r\n    const buffer = this.device.createBuffer({\r\n      size,\r\n      usage,\r\n      mappedAtCreation: true,\r\n    });\r\n\r\n    const writeArray = dataArray.constructor === Float32Array\r\n      ? new Float32Array(buffer.getMappedRange())\r\n      : new Uint16Array(buffer.getMappedRange());\r\n    writeArray.set(dataArray);\r\n    buffer.unmap();\r\n    return buffer;\r\n  }\r\n\r\n  updateMeshListBuffers() {\r\n    for(const key in this.objAnim.meshList) {\r\n      const mesh = this.objAnim.meshList[key];\r\n      mesh.vertexBuffer = this.device.createBuffer({\r\n        size: mesh.vertices.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexBuffer.getMappedRange()).set(mesh.vertices);\r\n      mesh.vertexBuffer.unmap();\r\n      // Normals\r\n      mesh.vertexNormalsBuffer = this.device.createBuffer({\r\n        size: mesh.vertexNormals.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexNormalsBuffer.getMappedRange()).set(mesh.vertexNormals);\r\n      mesh.vertexNormalsBuffer.unmap();\r\n      // UVs\r\n      mesh.vertexTexCoordsBuffer = this.device.createBuffer({\r\n        size: mesh.textures.length * Float32Array.BYTES_PER_ELEMENT,\r\n        usage: GPUBufferUsage.VERTEX,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Float32Array(mesh.vertexTexCoordsBuffer.getMappedRange()).set(mesh.textures);\r\n      mesh.vertexTexCoordsBuffer.unmap();\r\n      // Indices\r\n      const indexCount = mesh.indices.length;\r\n      const indexSize = Math.ceil(indexCount * Uint16Array.BYTES_PER_ELEMENT / 4) * 4;\r\n      mesh.indexBuffer = this.device.createBuffer({\r\n        size: indexSize,\r\n        usage: GPUBufferUsage.INDEX | GPUBufferUsage.COPY_DST,\r\n        mappedAtCreation: true,\r\n      });\r\n      new Uint16Array(mesh.indexBuffer.getMappedRange()).set(mesh.indices);\r\n      mesh.indexBuffer.unmap();\r\n      mesh.indexCount = indexCount;\r\n    }\r\n  }\r\n\r\n  drawElements = (pass, lightContainer) => {\r\n    if(this.isVideo) {this.updateVideoTexture()}\r\n    pass.setBindGroup(0, this.sceneBindGroupForRender);\r\n\r\n    if(this instanceof BVHPlayerInstances) {\r\n      pass.setBindGroup(1, this.modelBindGroupInstanced);\r\n    } else {\r\n      pass.setBindGroup(1, this.modelBindGroup);\r\n    }\r\n\r\n    // Bind each light\u2019s shadow texture & sampler\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2;\r\n      for(const light of lightContainer) {\r\n        pass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    if(this.selectedBindGroup) {\r\n      pass.setBindGroup(2, this.selectedBindGroup);\r\n    }\r\n\r\n    pass.setVertexBuffer(0, this.vertexBuffer);\r\n    pass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    pass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    if(this.joints) {\r\n      if(this.constructor.name === \"BVHPlayer\" || this.constructor.name === \"BVHPlayerInstances\") {\r\n        pass.setVertexBuffer(3, this.mesh.jointsBuffer);  // real\r\n        pass.setVertexBuffer(4, this.mesh.weightsBuffer); //real\r\n      } else {\r\n        pass.setVertexBuffer(3, this.joints.buffer);  // new dummy\r\n        pass.setVertexBuffer(4, this.weights.buffer); // new dummy\r\n      }\r\n    }\r\n\r\n    if(this.mesh.tangentsBuffer) {\r\n      pass.setVertexBuffer(5, this.mesh.tangentsBuffer);\r\n    }\r\n\r\n    pass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    // pass.drawIndexed(this.indexCount, this.instanceCount, 0, 0, 0);\r\n    pass.drawIndexed(this.indexCount, 1, 0, 0, 0);\r\n\r\n    // pipelineBlended\r\n    if(this.blendInstanced == true) pass.setPipeline(this.pipelineBlended)\r\n    else pass.setPipeline(this.pipeline);\r\n\r\n    for(var ins = 1;ins < this.instanceCount;ins++) {\r\n      pass.drawIndexed(this.indexCount, 1, 0, 0, ins);\r\n    }\r\n  }\r\n\r\n  drawElementsAnim = (renderPass, lightContainer) => {\r\n    if(!this.sceneBindGroupForRender || !this.modelBindGroup) {console.log(' NULL 1'); return;}\r\n    if(!this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni]) {console.log(' NULL 2'); return;}\r\n\r\n    renderPass.setBindGroup(0, this.sceneBindGroupForRender);\r\n    renderPass.setBindGroup(1, this.modelBindGroup);\r\n    const mesh = this.objAnim.meshList[this.objAnim.id + this.objAnim.currentAni];\r\n\r\n    if(this.isVideo == false) {\r\n      let bindIndex = 2; // start after UBO & model\r\n      for(const light of lightContainer) {\r\n        renderPass.setBindGroup(bindIndex++, light.getMainPassBindGroup(this));\r\n      }\r\n    }\r\n\r\n    renderPass.setVertexBuffer(0, mesh.vertexBuffer);\r\n    renderPass.setVertexBuffer(1, mesh.vertexNormalsBuffer);\r\n    renderPass.setVertexBuffer(2, mesh.vertexTexCoordsBuffer);\r\n\r\n    if(this.constructor.name === \"BVHPlayer\") {\r\n      renderPass.setVertexBuffer(3, this.mesh.jointsBuffer); // real\r\n      renderPass.setVertexBuffer(4, this.mesh.weightsBuffer);// real\r\n    } else {\r\n      // dummy\r\n      renderPass.setVertexBuffer(3, this.joints.buffer);  // dummy\r\n      renderPass.setVertexBuffer(4, this.weights.buffer); // dummy\r\n    }\r\n\r\n    renderPass.setIndexBuffer(mesh.indexBuffer, 'uint16');\r\n    renderPass.drawIndexed(mesh.indexCount);\r\n\r\n    if(this.objAnim.playing == true) {\r\n      if(this.objAnim.animations[this.objAnim.animations.active].speedCounter >= this.objAnim.animations[this.objAnim.animations.active].speed) {\r\n        this.objAnim.currentAni++;\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter = 0;\r\n      } else {\r\n        this.objAnim.animations[this.objAnim.animations.active].speedCounter++;\r\n      }\r\n      if(this.objAnim.currentAni >= this.objAnim.animations[this.objAnim.animations.active].to) {\r\n        this.objAnim.currentAni = this.objAnim.animations[this.objAnim.animations.active].from;\r\n      }\r\n    }\r\n  }\r\n\r\n  drawShadows = (shadowPass) => {\r\n    shadowPass.setVertexBuffer(0, this.vertexBuffer);\r\n    shadowPass.setVertexBuffer(1, this.vertexNormalsBuffer);\r\n    shadowPass.setVertexBuffer(2, this.vertexTexCoordsBuffer);\r\n    shadowPass.setIndexBuffer(this.indexBuffer, 'uint16');\r\n    if(this instanceof BVHPlayerInstances) {\r\n      shadowPass.drawIndexed(this.indexCount, this.instanceCount, 0, 0, 0);\r\n    } else {\r\n      shadowPass.drawIndexed(this.indexCount);\r\n    }\r\n  }\r\n}", "// import MEBvh from \"bvh-loader\";\r\nimport {mat4, vec3, quat} from \"wgpu-matrix\";\r\nimport {GLTFBuffer} from \"./webgpu-gltf.js\";\r\nimport MEMeshObjInstances from \"../instanced/mesh-obj-instances.js\";\r\n// export var animBVH = new MEBvh();\r\n// export let loadBVH = (path) => {\r\n//   return new Promise((resolve, reject) => {\r\n//     animBVH.parse_file(path).then(() => {\r\n//       console.info(\"plot_hierarchy no function\")\r\n//       animBVH.plot_hierarchy();\r\n//       var r = animBVH.frame_pose(0);\r\n//       // Not in use at the moment next feature - change skeletal or indipended new class.\r\n//       // console.log(\"FINAL P => \", r[0].length)\r\n//       // console.log(\"FINAL R => \", r[1].length)\r\n//       var KEYS = animBVH.joint_names();\r\n//       for(var x = 0;x < r[0].length;x++) {\r\n//         // console.log(\"->\" + KEYS[x] + \"-> position: \" + r[0][x] + \" rotation: \" + r[1][x]);\r\n//       }\r\n//       var all = animBVH.all_frame_poses();\r\n//       // console.log(\"Final All -> \", all);\r\n//       resolve(animBVH);\r\n//     }).catch((err) => {reject(err)});\r\n//   })\r\n// }\r\n\r\n/**\r\n * @description\r\n * Skinning basic done animation can be changed with animation index.\r\n * Holder for GLB model with skinning.\r\n * @param {GLBModel} glb - Your loaded GLB\r\n * @param {Object} bvhBones - Mapping of boneName \u2192 BVH bone data\r\n * @param {GPUDevice} device - WebGPU device\r\n * @credits Chatgpt assist here.\r\n */\r\nexport class BVHPlayerInstances extends MEMeshObjInstances {\r\n  constructor(o, bvh, glb, primitiveIndex, skinnedNodeIndex, canvas, device, context, inputHandler, globalAmbient) {\r\n    super(canvas, device, context, o, inputHandler, globalAmbient, glb, primitiveIndex, skinnedNodeIndex);\r\n    // bvh arg not actula at the moment\r\n    this.bvh = {};\r\n    this.glb = glb;\r\n    this.currentFrame = 0;\r\n    this.fps = 30;\r\n    this.timeAccumulator = 0;\r\n    // debug\r\n    this.scaleBoneTest = 1;\r\n    this.primitiveIndex = primitiveIndex;\r\n    if(!this.bvh.sharedState) {\r\n      this.bvh.sharedState = {\r\n        emitAnimationEvent: false,\r\n        animationStarted: false,\r\n        currentFrame: 0,\r\n        timeAccumulator: 0,\r\n        animationFinished: false\r\n      };\r\n    }\r\n    this.sharedState = this.bvh.sharedState;\r\n    // Reference to the skinned node containing all bones\r\n    this.skinnedNode = this.glb.skinnedMeshNodes[skinnedNodeIndex];\r\n    // console.log('this.skinnedNode', this.skinnedNode)\r\n    this.nodeWorldMatrices = Array.from(\r\n      {length: this.glb.nodes.length},\r\n      () => mat4.identity()\r\n    );\r\n    this.startTime = performance.now() / 1000; // seconds - anim speed control\r\n    this.MAX_BONES = 100; // predefined\r\n    this.skeleton = []; // array of joint node indices\r\n    this.animationSpeed = 1000;\r\n    this.inverseBindMatrices = []; // Float32Array for each joint\r\n    this.initInverseBindMatrices();\r\n    this.makeSkeletal();\r\n  }\r\n\r\n  makeSkeletal() {\r\n    let skin = this.glb.skins[0];\r\n    const accessorIndex = skin.inverseBindMatrices;\r\n    if(accessorIndex == null) {\r\n      console.warn(\"No inverseBindMatrices, using identity matrices\");\r\n    }\r\n    // 1. Load all inverse bind matrices once\r\n    const invBindArray = this.inverseBindMatrices; // set earlier by initInverseBindMatrices()\r\n    // 2. Build skeleton array from skin.joints only\r\n    this.skeleton = skin.joints.slice(); // direct copy of indices\r\n    // 3. Assign inverseBindMatrix to each joint node correctly\r\n    for(let i = 0;i < skin.joints.length;i++) {\r\n      const jointIndex = skin.joints[i];\r\n      const jointNode = this.glb.nodes[jointIndex];\r\n      // assign only to bone nodes\r\n      jointNode.inverseBindMatrix = invBindArray.slice(i * 16, (i + 1) * 16);\r\n      // decompose node\u2019s transform once (if not already)\r\n      if(!jointNode.transform) {\r\n        jointNode.transform = new Float32Array([\r\n          1, 0, 0, 0,\r\n          0, 1, 0, 0,\r\n          0, 0, 1, 0,\r\n          0, 0, 0, 1\r\n        ]);\r\n      }\r\n      if(!jointNode.translation || !jointNode.rotation || !jointNode.scale) {\r\n        const {translation, rotation, scale} = this.decomposeMatrix(jointNode.transform);\r\n        jointNode.translation = translation;\r\n        jointNode.rotation = rotation;\r\n        jointNode.scale = scale;\r\n      }\r\n    }\r\n    // 4. For mesh nodes or armature parent nodes, leave them alone\r\n    // what is animation , check is it more - we look for Armature by defoult \r\n    // friendly blender\r\n    this.glb.animationIndex = 0;\r\n    for(let j = 0;j < this.glb.glbJsonData.animations.length;j++) {\r\n      if(this.glb.glbJsonData.animations[j].name.indexOf('Armature') !== -1) {\r\n        this.glb.animationIndex = j;\r\n      }\r\n    }\r\n  }\r\n\r\n  initInverseBindMatrices(skinIndex = 0) {\r\n    const skin = this.glb.skins[skinIndex];\r\n    const invBindAccessorIndex = skin.inverseBindMatrices; // number\r\n    if(invBindAccessorIndex === undefined || invBindAccessorIndex === null) {\r\n      console.warn('No inverseBindMatrices accessor for skin', skinIndex);\r\n      return;\r\n    }\r\n    const invBindArray = this.getAccessorArray(this.glb, invBindAccessorIndex);\r\n    this.inverseBindMatrices = invBindArray;\r\n  }\r\n\r\n  getNumberOfFramesCurAni() {\r\n    const anim = this.glb.glbJsonData.animations[this.glb.animationIndex];\r\n    let maxFrames = 0;\r\n    if (typeof anim == 'undefined') {\r\n      console.log('[anim undefined]', this.name)\r\n      return 1;\r\n    }\r\n    for(const sampler of anim.samplers) {\r\n      const inputAccessor = this.glb.glbJsonData.accessors[sampler.input];\r\n      if(inputAccessor.count > maxFrames) maxFrames = inputAccessor.count;\r\n    }\r\n    return maxFrames;\r\n  }\r\n\r\n  getAnimationLength(animation) {\r\n    let maxTime = 0;\r\n    for(const channel of animation.channels) {\r\n      const sampler = animation.samplers[channel.sampler];\r\n      const inputTimes = this.getAccessorArray(this.glb, sampler.input);\r\n      const lastTime = inputTimes[inputTimes.length - 1];\r\n      if(lastTime > maxTime) maxTime = lastTime;\r\n    }\r\n    return maxTime;\r\n  }\r\n\r\n  update(deltaTime) {\r\n    const frameTime = 1 / this.fps;\r\n    this.sharedState.timeAccumulator += deltaTime;\r\n    while(this.sharedState.timeAccumulator >= frameTime) {\r\n      this.sharedState.currentFrame = (this.sharedState.currentFrame + 1) % this.getNumberOfFramesCurAni();\r\n      this.sharedState.timeAccumulator -= frameTime;\r\n    }\r\n    // const test = this.getNumberOfFramesCurAni();\r\n    var inTime = this.getAnimationLength(this.glb.glbJsonData.animations[this.glb.animationIndex])\r\n    if(this.sharedState.animationStarted == false && this.sharedState.emitAnimationEvent == true) {\r\n      this.sharedState.animationStarted = true;\r\n      setTimeout(() => {\r\n        this.sharedState.animationStarted = false;\r\n        // specific rule for naming (some from blender source)\r\n        // let n = this.name;\r\n        // if(this.name.indexOf('_') != -1) {\r\n        //   n = this.name.split('_')[0];\r\n        // }\r\n        dispatchEvent(new CustomEvent(`animationEnd-${this.name}`, {\r\n          detail: {\r\n            animationName: this.glb.glbJsonData.animations[this.glb.animationIndex].name\r\n          }\r\n        }))\r\n      }, inTime * 1000)\r\n    }\r\n    const currentTime = performance.now() / this.animationSpeed - this.startTime;\r\n    const boneMatrices = new Float32Array(this.MAX_BONES * 16);\r\n    if(this.glb.glbJsonData.animations && this.glb.glbJsonData.animations.length > 0) {\r\n      this.updateSingleBoneCubeAnimation(this.glb.glbJsonData.animations[this.glb.animationIndex], this.glb.nodes, currentTime, boneMatrices)\r\n    }\r\n  }\r\n\r\n  getAccessorArray(glb, accessorIndex) {\r\n    const accessor = glb.glbJsonData.accessors[accessorIndex];\r\n    const bufferView = glb.glbJsonData.bufferViews[accessor.bufferView];\r\n    const byteOffset = (bufferView.byteOffset || 0) + (accessor.byteOffset || 0);\r\n    const byteLength =\r\n      accessor.count *\r\n      this.getNumComponents(accessor.type) *\r\n      (accessor.componentType === 5126 ? 4 : 2); // adjust per type\r\n    const bufferDef = glb.glbBinaryBuffer;\r\n    // \u2705 now just slice:\r\n    const slice = this.getBufferSlice(bufferDef, byteOffset, byteLength);\r\n    switch(accessor.componentType) {\r\n      case 5126: // FLOAT\r\n        return new Float32Array(slice);\r\n      case 5123: // UNSIGNED_SHORT\r\n        return new Uint16Array(slice);\r\n      case 5121: // UNSIGNED_BYTE\r\n        return new Uint8Array(slice);\r\n      default:\r\n        throw new Error(\"Unsupported componentType: \" + accessor.componentType);\r\n    }\r\n  }\r\n\r\n  getAccessorTypeForChannel(path) {\r\n    switch(path) {\r\n      case \"translation\": return \"VEC3\";\r\n      case \"rotation\": return \"VEC4\";\r\n      case \"scale\": return \"VEC3\";\r\n      case \"weights\": return \"VECN\"; // if needed\r\n      default: throw new Error(\"Unknown channel path: \" + path);\r\n    }\r\n  }\r\n\r\n  getNumComponents(type) {\r\n    switch(type) {\r\n      case \"SCALAR\": return 1;\r\n      case \"VEC2\": return 2;\r\n      case \"VEC3\": return 3;\r\n      case \"VEC4\": return 4;\r\n      case \"MAT4\": return 16;\r\n      default: throw new Error(\"Unknown type: \" + type);\r\n    }\r\n  }\r\n\r\n  getComponentSize(componentType) {\r\n    switch(componentType) {\r\n      case 5126: return 4; // float32\r\n      case 5123: return 2; // uint16\r\n      case 5121: return 1; // uint8\r\n      default: throw new Error(\"Unknown componentType: \" + componentType);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *  @description\r\n   *  Get a typed slice of the raw binary buffer from glTF buffer definitions.\r\n   * @param {Object} bufferDef - the glTF buffer definition (usually gltfJson.buffers[0])\r\n   * @param {Number} byteOffset - byte offset into the buffer\r\n   * @param {Number} byteLength - byte length to slice\r\n   * @returns {ArrayBuffer} sliced array buffer\r\n   **/\r\n  getBufferSlice(bufferDef, byteOffset, byteLength) {\r\n    // GLTFBuffer instance:\r\n    if(bufferDef instanceof GLTFBuffer) {\r\n      // Use .arrayBuffer + .byteOffset:\r\n      return bufferDef.arrayBuffer.slice(\r\n        bufferDef.byteOffset + (byteOffset || 0),\r\n        bufferDef.byteOffset + (byteOffset || 0) + byteLength\r\n      );\r\n    }\r\n\r\n    // Already have a raw ArrayBuffer:\r\n    if(bufferDef instanceof ArrayBuffer) {\r\n      return bufferDef.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n\r\n    // Some loaders store it as .data or ._data:\r\n    if(bufferDef && bufferDef.data instanceof ArrayBuffer) {\r\n      return bufferDef.data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n    if(bufferDef && bufferDef._data instanceof ArrayBuffer) {\r\n      return bufferDef._data.slice(byteOffset, byteOffset + byteLength);\r\n    }\r\n\r\n    throw new Error(\"No binary data found in GLB buffer[0]\");\r\n  }\r\n\r\n  // --- helpers\r\n  lerpVec(a, b, t) {\r\n    return a.map((v, i) => v * (1 - t) + b[i] * t);\r\n  }\r\n\r\n  // Example quaternion slerp (a,b = [x,y,z,w])\r\n  quatSlerp(a, b, t) {\r\n    // naive slerp for small demo, normalize result\r\n    let dot = a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n    if(dot < 0) {b = b.map(v => -v); dot = -dot;}\r\n    if(dot > 0.9995) return lerpVec(a, b, t);\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n    return a.map((v, i) => s0 * v + s1 * b[i]);\r\n  }\r\n\r\n  // naive quaternion to 4x4 matrix\r\n  quatToMat4(q) {\r\n    const [x, y, z, w] = q;\r\n    const xx = x * x, yy = y * y, zz = z * z;\r\n    const xy = x * y, xz = x * z, yz = y * z, wx = w * x, wy = w * y, wz = w * z;\r\n    return new Float32Array([\r\n      1 - 2 * (yy + zz), 2 * (xy + wz), 2 * (xz - wy), 0,\r\n      2 * (xy - wz), 1 - 2 * (xx + zz), 2 * (yz + wx), 0,\r\n      2 * (xz + wy), 2 * (yz - wx), 1 - 2 * (xx + yy), 0,\r\n      0, 0, 0, 1\r\n    ]);\r\n  }\r\n\r\n  // Compose TRS to a 4\u00D74\r\n  composeMatrix(translation, rotationQuat, scale) {\r\n    const m = mat4.identity();\r\n    mat4.translate(m, translation, m);\r\n    const rot = mat4.fromQuat(rotationQuat);\r\n    mat4.multiply(m, rot, m);\r\n    mat4.scale(m, scale, m);\r\n    return m;\r\n\r\n    // const m = mat4.identity();\r\n    // mat4.translate(m, translation, m);\r\n    // const rot = mat4.fromQuat(rotationQuat);\r\n    // mat4.multiply(m, rot, m);\r\n    // mat4.scale(m, scale, m);\r\n\r\n    // // Flip Y globally\r\n    // const flipY = mat4.identity();\r\n    // mat4.scale(flipY, [1, 1, -1], flipY);\r\n    // mat4.multiply(m, flipY, m);\r\n\r\n    // return m;\r\n\r\n  }\r\n\r\n  decomposeMatrix(m) {\r\n    // m is column-major: indices:\r\n    // [ m0 m4 m8  m12\r\n    //   m1 m5 m9  m13\r\n    //   m2 m6 m10 m14\r\n    //   m3 m7 m11 m15 ]\r\n    const t = new Float32Array([m[12], m[13], m[14]]);\r\n\r\n    // Extract the 3 column vectors (upper-left 3x3)\r\n    const cx = [m[0], m[1], m[2]];\r\n    const cy = [m[4], m[5], m[6]];\r\n    const cz = [m[8], m[9], m[10]];\r\n\r\n    // Lengths = scales\r\n    const len = v => Math.hypot(v[0], v[1], v[2]);\r\n    let sx = len(cx), sy = len(cy), sz = len(cz);\r\n\r\n    // If any scale nearly zero, avoid divide-by-zero\r\n    if(sx === 0) sx = 1.0;\r\n    if(sy === 0) sy = 1.0;\r\n    if(sz === 0) sz = 1.0;\r\n\r\n    // Normalize columns to produce a pure rotation matrix\r\n    const r00 = m[0] / sx, r01 = m[4] / sy, r02 = m[8] / sz;\r\n    const r10 = m[1] / sx, r11 = m[5] / sy, r12 = m[9] / sz;\r\n    const r20 = m[2] / sx, r21 = m[6] / sy, r22 = m[10] / sz;\r\n\r\n    // Fix negative-scale (reflection) case: if determinant < 0, flip sign of one scale and corresponding column\r\n    const det3 = r00 * (r11 * r22 - r12 * r21) - r01 * (r10 * r22 - r12 * r20) + r02 * (r10 * r21 - r11 * r20);\r\n    if(det3 < 0) {\r\n      // flip Z\r\n      sz = -sz;\r\n      // flip third column sign\r\n      // multiply cz by -1 => r02,r12,r22 *= -1\r\n      // recompute normalized r* accordingly:\r\n      // since we only need a valid rotation matrix for quaternion conversion,\r\n      // just invert the third column\r\n      // (alternatively flip sx or sy\u2014this is a convention choice)\r\n      // Here we flip the third column:\r\n      // r02 = -r02; r12 = -r12; r22 = -r22;\r\n    }\r\n\r\n    // Build quaternion from rotation matrix (r00..r22)\r\n    // Using standard conversion (column-major rotation)\r\n    const trace = r00 + r11 + r22;\r\n    let qx, qy, qz, qw;\r\n    if(trace > 0.00001) {\r\n      const s = Math.sqrt(trace + 1.0) * 2; // s=4*qw\r\n      qw = 0.25 * s;\r\n      qx = (r21 - r12) / s;\r\n      qy = (r02 - r20) / s;\r\n      qz = (r10 - r01) / s;\r\n    } else if(r00 > r11 && r00 > r22) {\r\n      const s = Math.sqrt(1.0 + r00 - r11 - r22) * 2; // s=4*qx\r\n      qw = (r21 - r12) / s;\r\n      qx = 0.25 * s;\r\n      qy = (r01 + r10) / s;\r\n      qz = (r02 + r20) / s;\r\n    } else if(r11 > r22) {\r\n      const s = Math.sqrt(1.0 + r11 - r00 - r22) * 2; // s=4*qy\r\n      qw = (r02 - r20) / s;\r\n      qx = (r01 + r10) / s;\r\n      qy = 0.25 * s;\r\n      qz = (r12 + r21) / s;\r\n    } else {\r\n      const s = Math.sqrt(1.0 + r22 - r00 - r11) * 2; // s=4*qz\r\n      qw = (r10 - r01) / s;\r\n      qx = (r02 + r20) / s;\r\n      qy = (r12 + r21) / s;\r\n      qz = 0.25 * s;\r\n    }\r\n\r\n    const rot = new Float32Array([qx, qy, qz, qw]);\r\n    const scale = new Float32Array([sx, sy, sz]);\r\n    return {translation: t, rotation: rot, scale: scale};\r\n  }\r\n\r\n  slerp(q0, q1, t, out) {\r\n    let dot = q0[0] * q1[0] + q0[1] * q1[1] + q0[2] * q1[2] + q0[3] * q1[3];\r\n    if(dot < 0) {dot = -dot; q1 = [-q1[0], -q1[1], -q1[2], -q1[3]];}\r\n\r\n    if(dot > 0.9995) {\r\n      // linear\r\n      for(let i = 0;i < 4;i++) out[i] = q0[i] + t * (q1[i] - q0[i]);\r\n      // normalize\r\n      const len = Math.hypot(...out);\r\n      for(let i = 0;i < 4;i++) out[i] /= len;\r\n      return;\r\n    }\r\n\r\n    const theta0 = Math.acos(dot);\r\n    const theta = theta0 * t;\r\n    const sinTheta = Math.sin(theta);\r\n    const sinTheta0 = Math.sin(theta0);\r\n\r\n    const s0 = Math.cos(theta) - dot * sinTheta / sinTheta0;\r\n    const s1 = sinTheta / sinTheta0;\r\n\r\n    for(let i = 0;i < 4;i++) {\r\n      out[i] = s0 * q0[i] + s1 * q1[i];\r\n    }\r\n  }\r\n\r\n  updateSingleBoneCubeAnimation(glbAnimation, nodes, time, boneMatrices) {\r\n    const channels = glbAnimation.channels;\r\n    const samplers = glbAnimation.samplers;\r\n    // --- Map channels per node for faster lookup\r\n    const nodeChannels = new Map();\r\n    for(const channel of channels) {\r\n      if(!nodeChannels.has(channel.target.node)) nodeChannels.set(channel.target.node, []);\r\n      nodeChannels.get(channel.target.node).push(channel);\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const nodeIndex = this.skeleton[j];\r\n      const node = nodes[nodeIndex];\r\n\r\n      // --- Initialize node TRS if needed\r\n      if(!node.translation) node.translation = new Float32Array([0, 0, 0]);\r\n      if(!node.rotation) node.rotation = quat.create();\r\n      if(!node.scale) node.scale = new Float32Array([1, 1, 1]);\r\n\r\n      // --- Keep original TRS for additive animation\r\n      if(!node.originalTranslation) node.originalTranslation = node.translation.slice();\r\n      if(!node.originalRotation) node.originalRotation = node.rotation.slice();\r\n      if(!node.originalScale) node.originalScale = node.scale.slice();\r\n\r\n      const channelsForNode = nodeChannels.get(nodeIndex) || [];\r\n\r\n      for(const channel of channelsForNode) {\r\n        const path = channel.target.path; // \"translation\" | \"rotation\" | \"scale\"\r\n        const sampler = samplers[channel.sampler];\r\n        // --- Get input/output arrays\r\n        const inputTimes = this.getAccessorArray(this.glb, sampler.input);\r\n        const outputArray = this.getAccessorArray(this.glb, sampler.output);\r\n        const numComponents = path === \"rotation\" ? 4 : 3;\r\n        // --- Find keyframe interval\r\n        const animTime = time % inputTimes[inputTimes.length - 1];\r\n        let i = 0;\r\n        while(i < inputTimes.length - 1 && inputTimes[i + 1] <= animTime) i++;\r\n        const t0 = inputTimes[i];\r\n        const t1 = inputTimes[Math.min(i + 1, inputTimes.length - 1)];\r\n        const factor = t1 !== t0 ? (animTime - t0) / (t1 - t0) : 0;\r\n        // --- Interpolated keyframe values\r\n        const v0 = outputArray.subarray(i * numComponents, (i + 1) * numComponents);\r\n        const v1 = outputArray.subarray(\r\n          Math.min(i + 1, inputTimes.length - 1) * numComponents,\r\n          Math.min(i + 2, inputTimes.length) * numComponents\r\n        );\r\n        // --- Apply animation\r\n        if(path === \"translation\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.translation[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"scale\") {\r\n          for(let k = 0;k < 3;k++)\r\n            node.scale[k] = v0[k] * (1 - factor) + v1[k] * factor;\r\n        } else if(path === \"rotation\") {\r\n          this.slerp(v0, v1, factor, node.rotation);\r\n        }\r\n      }\r\n      // --- Recompose local transform\r\n      node.transform = this.composeMatrix(node.translation, node.rotation, node.scale);\r\n    }\r\n    const computeWorld = (nodeIndex) => {\r\n      const node = nodes[nodeIndex];\r\n      if(!node.worldMatrix) node.worldMatrix = mat4.create();\r\n      let parentWorld = node.parent !== null ? nodes[node.parent].worldMatrix : null;\r\n      if(parentWorld) {\r\n        // multiply parent * local\r\n        mat4.multiply(parentWorld, node.transform, node.worldMatrix);\r\n      } else {\r\n        mat4.copy(node.transform, node.worldMatrix);\r\n      }\r\n\r\n      // maybe no need to exist...\r\n      mat4.scale(node.worldMatrix, [this.scaleBoneTest, this.scaleBoneTest, this.scaleBoneTest], node.worldMatrix);\r\n\r\n      if(node.children) {\r\n        for(const childIndex of node.children) computeWorld(childIndex);\r\n      }\r\n    };\r\n    for(let i = 0;i < nodes.length;i++) {\r\n      if(nodes[i].parent === null || nodes[i].parent === undefined) {\r\n        computeWorld(i);\r\n      }\r\n    }\r\n    for(let j = 0;j < this.skeleton.length;j++) {\r\n      const jointNode = nodes[this.skeleton[j]];\r\n      const finalMat = mat4.create();\r\n      mat4.multiply(jointNode.worldMatrix, jointNode.inverseBindMatrix, finalMat);\r\n      boneMatrices.set(finalMat, j * 16);\r\n    }\r\n    // --- Upload to GPU\r\n    this.device.queue.writeBuffer(this.bonesBuffer, 0, boneMatrices);\r\n    return boneMatrices;\r\n  }\r\n}", "import {mb} from \"../../engine/utils\";\r\n\r\nexport class MEEditorClient {\r\n\r\n  ws = null;\r\n\r\n  constructor(typeOfRun, name) {\r\n    this.ws = new WebSocket(\"ws://localhost:1243\");\r\n\r\n    this.ws.onopen = () => {\r\n      if(typeOfRun == 'created from editor') {\r\n        //\r\n        console.info('wATCH project <signal>');\r\n        let o = {\r\n          action: \"watch\",\r\n          name: name\r\n        };\r\n        o = JSON.stringify(o);\r\n        this.ws.send(o);\r\n\r\n        o = {\r\n          action: \"list\",\r\n          path: name\r\n        };\r\n        o = JSON.stringify(o);\r\n        this.ws.send(o);\r\n\r\n      }\r\n      console.log(\"%c[WS OPEN] [Attach events]\", \"color: lime; font-weight: bold\");\r\n    };\r\n\r\n    this.ws.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        console.log(\"%c[WS MESSAGE]\", \"color: yellow\", data);\r\n        if(data && data.ok == true && data.payload && data.payload.redirect == true) {\r\n          setTimeout(() => location.assign(data.name + \".html\"), 2000);\r\n        } else if(data.payload && data.payload == \"stop-watch done\") {\r\n          mb.show(\"watch-stoped\");\r\n        } else if(data.listAssets) {\r\n          document.dispatchEvent(new CustomEvent('la', {\r\n            detail: data\r\n          }))\r\n        } else if(data.projects) {\r\n          data.payload.forEach((item) => {\r\n            console.log('.....' + item.name);\r\n            if(item.name != 'readme.md') {\r\n              let txt = `Project list: \\n\r\n                - ${item.name}  \\n\r\n               \\n\r\n               Choose project name:\r\n              `;\r\n              let projectName = prompt(txt);\r\n              if(projectName !== null) {\r\n                console.log(\"Project name:\", projectName);\r\n                projectName += \".html\";\r\n                location.assign(projectName);\r\n              } else {\r\n                console.error('Something wrong with load project input!');\r\n              }\r\n            }\r\n          });\r\n        } else if(data.details) {\r\n          document.dispatchEvent(new CustomEvent('file-detail-data', {\r\n            detail: data\r\n          }))\r\n        } else {\r\n          mb.show(\"from editor:\" + data.payload);\r\n        }\r\n      } catch(e) {\r\n        console.error(\"[WS ERROR PARSE]\", e);\r\n      }\r\n    };\r\n\r\n    this.ws.onerror = (err) => {\r\n      console.error(\"%c[WS ERROR]\", \"color: red\", err);\r\n      document.dispatchEvent(new CustomEvent(\"editor-not-running\", {detail: {}}));\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      console.log(\"%c[WS CLOSED]\", \"color: gray\");\r\n    }\r\n\r\n    this.attachEvents();\r\n  }\r\n\r\n  attachEvents() {\r\n\r\n    document.addEventListener('lp', (e) => {\r\n      console.info('Load project <signal>');\r\n      let o = {\r\n        action: \"lp\"\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    })\r\n\r\n    document.addEventListener('cnp', (e) => {\r\n      console.info('Create new project <signal>');\r\n      let o = {\r\n        action: \"cnp\",\r\n        name: e.detail.name,\r\n        features: e.detail.features\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    })\r\n\r\n    document.addEventListener('stop-watch', (e) => {\r\n      console.info('stop-watch <signal>');\r\n      let o = {\r\n        action: \"stop-watch\",\r\n        name: e.detail.name\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    })\r\n\r\n    document.addEventListener('start-watch', (e) => {\r\n      console.info('start-watch <signal>');\r\n      let o = {\r\n        action: \"watch\",\r\n        name: e.detail.name\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n\r\n    document.addEventListener('nav-folder', (e) => {\r\n      console.info('nav-folder <signal>');\r\n      let o = {\r\n        action: \"nav-folder\",\r\n        name: e.detail.name,\r\n        rootFolder: e.detail.rootFolder\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('file-detail', (e) => {\r\n      console.info('file-detail <signal>');\r\n      let o = {\r\n        action: \"file-detail\",\r\n        name: e.detail.name,\r\n        rootFolder: e.detail.rootFolder\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n    });\r\n\r\n    document.addEventListener('web.editor.addCube', (e) => {\r\n      console.log(\"[web.editor.addCube]: \", e.detail);\r\n      // downloadMeshes({cube: \"./res/meshes/blender/cube.obj\"}, (m) => {\r\n      //   const texturesPaths = ['./res/meshes/blender/cube.png'];\r\n      //   this.core.addMeshObj({\r\n      //     position: {x: 0, y: 0, z: -20},\r\n      //     rotation: {x: 0, y: 0, z: 0},\r\n      //     rotationSpeed: {x: 0, y: 0, z: 0},\r\n      //     texturesPaths: [texturesPaths],\r\n      //     // useUVShema4x2: true,\r\n      //     name: 'Cube_' + app.mainRenderBundle.length,\r\n      //     mesh: m.cube,\r\n      //     raycast: {enabled: true, radius: 2},\r\n      //     physics: {\r\n      //       enabled: true,\r\n      //       geometry: \"Cube\"\r\n      //     }\r\n      //   })\r\n      // }, {scale: [1, 1, 1]});\r\n\r\n      console.info('addCube <signal>');\r\n      let o = {\r\n        action: \"addCube\",\r\n        projectName: location.href.split('/public/')[1].split(\".\")[0]\r\n      };\r\n      o = JSON.stringify(o);\r\n      this.ws.send(o);\r\n\r\n\r\n    });\r\n\r\n  }\r\n}\r\n", "import {downloadMeshes} from \"../../engine/loader-obj\";\r\n\r\n/**\r\n * @description\r\n * For now it is posible for editor to work on fly\r\n * with no memory/saves.\r\n */\r\n\r\nexport default class EditorProvider {\r\n  constructor(core) {\r\n    this.core = core;\r\n    this.addEditorEvents();\r\n  }\r\n\r\n  addEditorEvents() {\r\n    document.addEventListener('web.editor.input', (e) => {\r\n      console.log(\"[EDITOR] sceneObj: \", e.detail.inputFor);\r\n      // InFly Method\r\n      let sceneObj = this.core.getSceneObjectByName(e.detail.inputFor);\r\n      if(sceneObj) {\r\n        sceneObj[e.detail.propertyId][e.detail.property] = e.detail.value;\r\n      } else {\r\n        console.warn(\"EditorProvider input error\");\r\n        return;\r\n      }\r\n    });\r\n\r\n    document.addEventListener('web.editor.addCube', (e) => {\r\n      // console.log(\"[web.editor.addCube]: \", e.detail);\r\n      // downloadMeshes({cube: \"./res/meshes/blender/cube.obj\"}, (m) => {\r\n      //   const texturesPaths = ['./res/meshes/blender/cube.png'];\r\n      //   this.core.addMeshObj({\r\n      //     position: {x: 0, y: 0, z: -20},\r\n      //     rotation: {x: 0, y: 0, z: 0},\r\n      //     rotationSpeed: {x: 0, y: 0, z: 0},\r\n      //     texturesPaths: [texturesPaths],\r\n      //     // useUVShema4x2: true,\r\n      //     name: 'Cube_' + app.mainRenderBundle.length,\r\n      //     mesh: m.cube,\r\n      //     raycast: {enabled: true, radius: 2},\r\n      //     physics: {\r\n      //       enabled: true,\r\n      //       geometry: \"Cube\"\r\n      //     }\r\n      //   })\r\n      // }, {scale: [1, 1, 1]});\r\n    });\r\n  }\r\n}", "import {byId, FullscreenManager, isMobile, jsonHeaders, mb} from \"../../engine/utils.js\";\r\n/**\r\n * @Author NIkola Lukic\r\n * @description\r\n * Web Editor for matrix-engine-wgpu\r\n * Using \"file protocol\" in direct way no virtual/syntetic assets\r\n */\r\nexport default class EditorHud {\r\n  constructor(core, a) {\r\n    this.core = core;\r\n    this.sceneContainer = null;\r\n    this.FS = new FullscreenManager();\r\n\r\n    if(a == 'infly') {\r\n      this.createTopMenuInFly();\r\n    } else if(a == \"created from editor\") {\r\n      this.createTopMenu();\r\n      this.createAssets();\r\n    } else if(a == \"pre editor\") {\r\n      this.createTopMenuPre();\r\n    } else {\r\n      throw console.error('Editor err');\r\n    }\r\n    this.createEditorSceneContainer();\r\n    this.createScenePropertyBox();\r\n    this.currentProperties = [];\r\n\r\n    document.addEventListener('editor-not-running', () => {\r\n      this.noEditorConn();\r\n    });\r\n\r\n    document.addEventListener('file-detail-data', (e) => {\r\n      console.log(e.detail.details)\r\n      let s = \"\";\r\n      for(let key in e.detail.details) {\r\n        if(key == \"path\") {\r\n          s += key + \":\" + e.detail.details[key].split(\"public\")[1] + \"\\n\";\r\n        } else {\r\n          s += key + \":\" + e.detail.details[key] + \"\\n\";\r\n        }\r\n\r\n      }\r\n      mb.show(s)\r\n    });\r\n\r\n  }\r\n\r\n  noEditorConn() {\r\n\r\n    this.errorForm = document.createElement(\"div\");\r\n    this.errorForm.id = \"errorForm\";\r\n    Object.assign(this.errorForm.style, {\r\n      position: \"absolute\",\r\n      top: \"10%\",\r\n      left: \"25%\",\r\n      width: \"50%\",\r\n      height: \"30vh\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\",\r\n      justifyContent: 'center',\r\n      alignItems: 'center'\r\n    });\r\n\r\n    this.errorForm.innerHTML = `\r\n       <h2 class='fancy-label'>No connection with editor node app.</h2>\r\n       <h3 class='fancy-label'>Run from root [npm run editorx] \\n \r\n          or run from ./src/tools/editor/backend [npm run editorx] \\n\r\n          Than refresh page [clear default cache browser with CTRL+F5] </h3>\r\n    `;\r\n    document.body.appendChild(this.errorForm);\r\n  }\r\n\r\n  createTopMenu() {\r\n    this.editorMenu = document.createElement(\"div\");\r\n    this.editorMenu.id = \"editorMenu\";\r\n    Object.assign(this.editorMenu.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"20%\",\r\n      width: \"60%\",\r\n      height: \"50px;\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      // overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.editorMenu.innerHTML = \" PROJECT MENU  \";\r\n    // document.body.appendChild(this.editorMenu);\r\n\r\n    this.editorMenu.innerHTML = `\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Project \u25BE</div>\r\n      <div class=\"dropdown\">\r\n      <div id=\"start-watch\" class=\"drop-item\">\uD83D\uDEE0\uFE0F Watch</div>\r\n      <div id=\"stop-watch\" class=\"drop-item\">\uD83D\uDEE0\uFE0F Stop Watch</div>\r\n      <div class=\"drop-item\">\uD83D\uDEE0\uFE0F Build</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Insert \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"addCube\" class=\"drop-item\">\uD83E\uDDCA Cube</div>\r\n        <div class=\"drop-item\">\u26AA Sphere</div>\r\n        <div class=\"drop-item\">\uD83D\uDCE6 GLB (model)</div>\r\n        <div class=\"drop-item\">\uD83D\uDCA1 Light</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Settings \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"cameraBox\" class=\"drop-item\">\r\n           <p>\uD83D\uDCFD\uFE0FCamera</p>\r\n           <div>Pitch: <input id=\"camera-settings-pitch\" step='0.1' type='number' value='0' /></div>\r\n           <div>Yaw: <input id=\"camera-settings-yaw\" step='0.1' type='number' value='0' /></div>\r\n           <div> Position :  </br>\r\n            \\n \r\n            X: <input id=\"camera-settings-pos-x\" step='0.5' type='number' value='0' /> \\n\r\n            Y: <input id=\"camera-settings-pos-y\" step='0.5' type='number' value='0' /> \\n\r\n            Z: <input id=\"camera-settings-pos-z\" step='0.5' type='number' value='0' />\r\n           </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">View \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"hideEditorBtn\" class=\"drop-item\">\r\n           <p>Hide Editor UI</p>\r\n           <small>To show editor press F4 \u2328\uFE0F</small>\r\n        </div>\r\n        <div id=\"fullScreenBtn\" class=\"drop-item\">FullScreen</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">About \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAboutEditor\" class=\"drop-item\">matrix-engine-wgpu</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    document.body.appendChild(this.editorMenu);\r\n\r\n    // Mobile friendly toggles\r\n    this.editorMenu.querySelectorAll(\".top-btn\").forEach(btn => {\r\n      btn.addEventListener(\"click\", e => {\r\n        const menu = e.target.nextElementSibling;\r\n\r\n        // close others\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          if(d !== menu) d.style.display = \"none\";\r\n        });\r\n\r\n        // toggle\r\n        menu.style.display =\r\n          menu.style.display === \"block\" ? \"none\" : \"block\";\r\n      });\r\n    });\r\n\r\n    // Close on outside tap\r\n    document.addEventListener(\"click\", e => {\r\n      if(!this.editorMenu.contains(e.target)) {\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          d.style.display = \"none\";\r\n        });\r\n      }\r\n    });\r\n\r\n    byId('fullScreenBtn').addEventListener('click', () => {\r\n      this.FS.request()\r\n    })\r\n\r\n    byId('hideEditorBtn').addEventListener('click', () => {\r\n      this.editorMenu.style.display = 'none';\r\n      this.assetsBox.style.display = 'none';\r\n      this.sceneProperty.style.display = 'none';\r\n      this.sceneContainer.style.display = 'none';\r\n    })\r\n\r\n    if(byId('stop-watch')) byId('stop-watch').addEventListener('click', () => {\r\n      document.dispatchEvent(new CustomEvent('stop-watch', {\r\n        detail: {}\r\n      }));\r\n    })\r\n\r\n    if(byId('start-watch')) byId('start-watch').addEventListener('click', () => {\r\n      document.dispatchEvent(new CustomEvent('start-watch', {\r\n        detail: {}\r\n      }));\r\n    })\r\n\r\n    if(byId('cnpBtn')) byId('cnpBtn').addEventListener('click', () => {\r\n\r\n      let name = prompt(\"\uD83D\uDCE6 Project name :\", \"MyProject1\");\r\n      let features = {\r\n        physics: false,\r\n        networking: false\r\n      };\r\n\r\n      if(confirm(\"\u269B Enable physics (Ammo)?\")) {\r\n        features.physics = true;\r\n      }\r\n\r\n      if(confirm(\"\uD83D\uDD0C Enable networking (kurento/ov)?\")) {\r\n        features.networking = true;\r\n      }\r\n\r\n      console.log(features);\r\n\r\n      document.dispatchEvent(new CustomEvent('cnp', {\r\n        detail: {\r\n          name: name,\r\n          features: features\r\n        }\r\n      }));\r\n    });\r\n\r\n    // OBJECT LEVEL\r\n    if(byId('addCube')) byId('addCube').addEventListener('click', () => {\r\n      document.dispatchEvent(new CustomEvent('web.editor.addCube', {\r\n        detail: {}\r\n      }));\r\n    })\r\n\r\n    // settings\r\n    setTimeout(() => {\r\n      this.core.cameras.WASD.pitch = byId('camera-settings-pitch').value;\r\n      this.core.cameras.WASD.yaw = byId('camera-settings-yaw').value;\r\n    }, 1500);\r\n\r\n    byId('camera-settings-pitch').addEventListener('change', (e) => {\r\n      console.log('setting camera pitch ', e);\r\n      this.core.cameras.WASD.pitch = e.target.value;\r\n    })\r\n    byId('camera-settings-yaw').addEventListener('change', (e) => {\r\n      console.log('setting camera', e)\r\n      this.core.cameras.WASD.yaw = e.target.value;\r\n    })\r\n\r\n    this.showAboutModal = () => {\r\n      alert(`\r\n  \u2714\uFE0F Support for 3D objects and scene transformations\r\n  \u2714\uFE0F Ammo.js physics full integration\r\n  \u2714\uFE0F Networking with Kurento/OpenVidu/Own middleware Nodejs -> frontend\r\n  \uD83C\uDFAF Save system - direct code line [file-protocol]\r\n     Source code: https://github.com/zlatnaspirala/matrix-engine-wgpu\r\n     More at https://maximumroulette.com\r\n        `);\r\n    }\r\n    byId('showAboutEditor').addEventListener('click', this.showAboutModal);\r\n\r\n  }\r\n\r\n  createAssets() {\r\n    this.assetsBox = document.createElement(\"div\");\r\n    this.assetsBox.id = \"assetsBox\";\r\n    Object.assign(this.assetsBox.style, {\r\n      position: \"absolute\",\r\n      bottom: \"0\",\r\n      left: \"20%\",\r\n      width: \"60%\",\r\n      height: \"250px\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      // overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n    this.assetsBox.innerHTML = \"ASSTES\";\r\n    // document.body.appendChild(this.editorMenu);\r\n\r\n    // <div id=\"cnpBtn\" class=\"drop-item\">\uD83D\uDCE6 Create new project</div>\r\n    //   <div class=\"drop-item\">\uD83D\uDCC2 Load</div>\r\n    this.assetsBox.innerHTML = `\r\n    <div id=\"folderTitle\" >Root</div>\r\n    <div id=\"folderBack\" class=\"scenePropItem\" >...</div>\r\n    <div id='res-folder' class=\"file-browser\">\r\n    </div>`\r\n      ;\r\n\r\n    document.body.appendChild(this.assetsBox);\r\n\r\n    byId('folderBack').addEventListener('click', () => {\r\n      let getCurrent = byId('res-folder').getAttribute('data-root-folder');\r\n      const t = getCurrent.substring(0, getCurrent.lastIndexOf(\"\\\\\"));\r\n      const last = t.substring(t.lastIndexOf(\"\\\\\") + 1);\r\n      if(last == \"public\") {\r\n        console.log(last + \"<<<<<<<<<<<<<<<<<PREVENTED<<\");\r\n        return;\r\n      }\r\n      document.dispatchEvent(new CustomEvent(\"nav-folder\", {\r\n        detail: {\r\n          rootFolder: t || \"\",\r\n          name: ''\r\n        }\r\n      }));\r\n    })\r\n\r\n    document.addEventListener('la', (e) => {\r\n      console.log('root folder ', e.detail.rootFolder)\r\n      byId('res-folder').setAttribute('data-root-folder', e.detail.rootFolder);\r\n      byId('res-folder').innerHTML = '';\r\n      e.detail.payload.forEach((i) => {\r\n        let item = document.createElement('div');\r\n        item.classList.add('file-item');\r\n        if(i.isDir == true) {\r\n          item.classList.add('folder');\r\n        } else if(i.name.split('.')[1] == 'jpg' ||\r\n          i.name.split('.')[1] == 'png' ||\r\n          i.name.split('.')[1] == 'jpeg') {\r\n          item.classList.add('png');\r\n        } else if(i.name.split('.')[1] == 'mp3') {\r\n          item.classList.add('mp3');\r\n        } else if(i.name.split('.')[1] == 'js') {\r\n          item.classList.add('js');\r\n        } else if(i.name.split('.')[1] == 'ttf' ||\r\n          i.name.split('.')[1] == 'ttf' ||\r\n          i.name.split('.')[1] == 'TTF' ||\r\n          i.name.split('.')[1] == 'otf' ||\r\n          i.name.split('.')[1] == 'woff' ||\r\n          i.name.split('.')[1] == 'woff2') {\r\n          item.classList.add('ttf');\r\n        } else {\r\n          item.classList.add('unknown');\r\n        }\r\n\r\n        item.innerHTML = \"<p>\" + i.name + \"</p>\";\r\n        byId('res-folder').appendChild(item);\r\n        item.addEventListener('click', (e) => {\r\n\r\n          if(i.isDir == true) document.dispatchEvent(new CustomEvent(\"nav-folder\", {\r\n            detail: {\r\n              rootFolder: byId('res-folder').getAttribute('data-root-folder') || \"\",\r\n              name: item.children[0].innerText\r\n            }\r\n          }));\r\n\r\n          if(i.isDir == false) document.dispatchEvent(new CustomEvent(\"file-detail\", {\r\n            detail: {\r\n              rootFolder: byId('res-folder').getAttribute('data-root-folder') || \"\",\r\n              name: item.innerText\r\n            }\r\n          }));\r\n        });\r\n      });\r\n      document.querySelectorAll('.file-item').forEach(el => {\r\n        el.addEventListener('click', () => {\r\n          document.querySelectorAll('.file-item').forEach(x => x.classList.remove('selected'));\r\n          el.classList.add('selected');\r\n        });\r\n      });\r\n    })\r\n  }\r\n\r\n  createTopMenuPre() {\r\n    this.editorMenu = document.createElement(\"div\");\r\n    this.editorMenu.id = \"editorMenu\";\r\n    Object.assign(this.editorMenu.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"20%\",\r\n      width: \"60%\",\r\n      height: \"50px;\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      // overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.editorMenu.innerHTML = \" PROJECT MENU  \";\r\n    // document.body.appendChild(this.editorMenu);\r\n\r\n    this.editorMenu.innerHTML = `\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">Project \u25BE</div>\r\n      <div class=\"dropdown\">\r\n      <div id=\"cnpBtn\" class=\"drop-item\">\uD83D\uDCE6 Create new project</div>\r\n      <div id=\"loadProjectBtn\" class=\"drop-item\">\uD83D\uDCC2 Load</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">About \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAboutEditor\" class=\"drop-item\">matrix-engine-wgpu</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    document.body.appendChild(this.editorMenu);\r\n\r\n    // Mobile friendly toggles\r\n    this.editorMenu.querySelectorAll(\".top-btn\").forEach(btn => {\r\n      btn.addEventListener(\"click\", e => {\r\n        const menu = e.target.nextElementSibling;\r\n\r\n        // close others\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          if(d !== menu) d.style.display = \"none\";\r\n        });\r\n\r\n        // toggle\r\n        menu.style.display =\r\n          menu.style.display === \"block\" ? \"none\" : \"block\";\r\n      });\r\n    });\r\n\r\n    // Close on outside tap\r\n    document.addEventListener(\"click\", e => {\r\n      if(!this.editorMenu.contains(e.target)) {\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          d.style.display = \"none\";\r\n        });\r\n      }\r\n    });\r\n\r\n\r\n\r\n    if(byId('loadProjectBtn')) byId('loadProjectBtn').addEventListener('click', () => {\r\n      // ***************************\r\n      // ---------------------------\r\n      document.dispatchEvent(new CustomEvent('lp', {\r\n        detail: {}\r\n      }));\r\n    });\r\n\r\n    if(byId('cnpBtn')) byId('cnpBtn').addEventListener('click', () => {\r\n\r\n      let name = prompt(\"\uD83D\uDCE6 Project name :\", \"MyProject1\");\r\n\r\n      let features = {\r\n        physics: false,\r\n        networking: false\r\n      };\r\n\r\n      if(confirm(\"\u269B Enable physics (Ammo)?\")) {\r\n        features.physics = true;\r\n      }\r\n\r\n      if(confirm(\"\uD83D\uDD0C Enable networking (kurento/ov)?\")) {\r\n        features.networking = true;\r\n      }\r\n\r\n      console.log(features);\r\n\r\n      document.dispatchEvent(new CustomEvent('cnp', {\r\n        detail: {\r\n          name: name,\r\n          features: features\r\n        }\r\n      }));\r\n    });\r\n\r\n\r\n    this.showAboutModal = () => {\r\n      alert(`\r\n  \u2714\uFE0F Support for 3D objects and scene transformations\r\n  \u2714\uFE0F Ammo.js physics full integration\r\n  \u2714\uFE0F Networking with Kurento/OpenVidu/Own middleware Nodejs -> frontend\r\n  \uD83C\uDFAF Replicate matrix-engine (WebGL) features\r\n        `);\r\n    }\r\n    byId('showAboutEditor').addEventListener('click', this.showAboutModal);\r\n\r\n  }\r\n\r\n  createTopMenuInFly() {\r\n    this.editorMenu = document.createElement(\"div\");\r\n    this.editorMenu.id = \"editorMenu\";\r\n    Object.assign(this.editorMenu.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"20%\",\r\n      width: \"60%\",\r\n      height: \"50px;\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      // overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"row\"\r\n    });\r\n    this.editorMenu.innerHTML = \" PROJECT MENU  \";\r\n    // document.body.appendChild(this.editorMenu);\r\n\r\n    this.editorMenu.innerHTML = `\r\n    <div>INFLY Regime of work no saves. Nice for runtime debugging or get data for map setup.</div>\r\n    <div class=\"top-item\">\r\n      <div class=\"top-btn\">About \u25BE</div>\r\n      <div class=\"dropdown\">\r\n        <div id=\"showAboutEditor\" class=\"drop-item\">matrix-engine-wgpu</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    document.body.appendChild(this.editorMenu);\r\n\r\n    // Mobile friendly toggles\r\n    this.editorMenu.querySelectorAll(\".top-btn\").forEach(btn => {\r\n      btn.addEventListener(\"click\", e => {\r\n        const menu = e.target.nextElementSibling;\r\n\r\n        // close others\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          if(d !== menu) d.style.display = \"none\";\r\n        });\r\n\r\n        // toggle\r\n        menu.style.display =\r\n          menu.style.display === \"block\" ? \"none\" : \"block\";\r\n      });\r\n    });\r\n\r\n    // Close on outside tap\r\n    document.addEventListener(\"click\", e => {\r\n      if(!this.editorMenu.contains(e.target)) {\r\n        this.editorMenu.querySelectorAll(\".dropdown\").forEach(d => {\r\n          d.style.display = \"none\";\r\n        });\r\n      }\r\n    });\r\n\r\n    this.showAboutModal = () => {\r\n      alert(`\r\n  \u2714\uFE0F Support for 3D objects and scene transformations\r\n  \u2714\uFE0F Ammo.js physics full integration\r\n  \u2714\uFE0F Networking with Kurento/OpenVidu/Own middleware Nodejs -> frontend\r\n  \uD83C\uDFAF Replicate matrix-engine (WebGL) features\r\n        `);\r\n    }\r\n    byId('showAboutEditor').addEventListener('click', this.showAboutModal);\r\n\r\n  }\r\n\r\n  createEditorSceneContainer() {\r\n    this.sceneContainer = document.createElement(\"div\");\r\n    this.sceneContainer.id = \"sceneContainer\";\r\n    Object.assign(this.sceneContainer.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      left: \"0\",\r\n      width: \"20%\",\r\n      height: \"100vh\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.scene = document.createElement(\"div\");\r\n    this.scene.id = \"scene\";\r\n    Object.assign(this.scene.style, {\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.sceneContainerTitle = document.createElement(\"div\");\r\n    this.sceneContainerTitle.style.height = '40px';\r\n    this.sceneContainerTitle.style.fontSize = (isMobile() == true ? \"x-larger\" : \"larger\");\r\n    this.sceneContainerTitle.style.padding = '5px';\r\n    this.sceneContainerTitle.innerHTML = 'Scene container';\r\n    this.sceneContainer.appendChild(this.sceneContainerTitle);\r\n    this.sceneContainer.appendChild(this.scene);\r\n    document.body.appendChild(this.sceneContainer);\r\n  }\r\n\r\n  updateSceneContainer() {\r\n    this.scene.innerHTML = ``;\r\n    this.core.mainRenderBundle.forEach(sceneObj => {\r\n      let so = document.createElement('div');\r\n      so.style.height = '20px';\r\n      so.classList.add('sceneContainerItem');\r\n      so.innerHTML = sceneObj.name;\r\n      so.addEventListener('click', this.updateSceneObjProperties);\r\n      this.scene.appendChild(so);\r\n    });\r\n  }\r\n\r\n  createScenePropertyBox() {\r\n    this.sceneProperty = document.createElement(\"div\");\r\n    this.sceneProperty.id = \"sceneProperty\";\r\n    this.sceneProperty.classList.add('scenePropItem');\r\n    Object.assign(this.sceneProperty.style, {\r\n      position: \"absolute\",\r\n      top: \"0\",\r\n      right: \"0\",\r\n      width: \"20%\",\r\n      height: \"100vh\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      overflow: \"auto\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.objectProperies = document.createElement(\"div\");\r\n    this.objectProperies.id = \"objectProperies\";\r\n    Object.assign(this.objectProperies.style, {\r\n      width: \"100%\",\r\n      height: \"auto\",\r\n      backgroundColor: \"rgba(0,0,0,0.85)\",\r\n      display: \"flex\",\r\n      alignItems: \"start\",\r\n      color: \"white\",\r\n      fontFamily: \"'Orbitron', sans-serif\",\r\n      zIndex: \"15\",\r\n      padding: \"2px\",\r\n      boxSizing: \"border-box\",\r\n      flexDirection: \"column\"\r\n    });\r\n\r\n    this.objectProperiesTitle = document.createElement(\"div\");\r\n    this.objectProperiesTitle.style.height = '40px';\r\n    this.objectProperiesTitle.style.fontSize = '120%';\r\n    this.objectProperiesTitle.innerHTML = 'Scene object properties';\r\n    this.sceneProperty.appendChild(this.objectProperiesTitle);\r\n    this.sceneProperty.appendChild(this.objectProperies);\r\n    document.body.appendChild(this.sceneProperty);\r\n  }\r\n\r\n  updateSceneObjProperties = (e) => {\r\n    this.currentProperties = [];\r\n    this.objectProperiesTitle.style.fontSize = '120%';\r\n    this.objectProperiesTitle.innerHTML = `Scene object properties`;\r\n    this.objectProperies.innerHTML = ``;\r\n    const currentSO = this.core.getSceneObjectByName(e.target.innerHTML);\r\n    this.objectProperiesTitle.innerHTML = `<span style=\"color:lime;\">Name: ${e.target.innerHTML}</span> \r\n      <span style=\"color:yellow;\"> [${currentSO.constructor.name}]`;\r\n    const OK = Object.keys(currentSO);\r\n    OK.forEach((prop) => {\r\n      // console.log('[key]:', prop);\r\n      if(prop == 'glb' && typeof currentSO[prop] !== 'undefined' && currentSO[prop] != null) {\r\n        this.currentProperties.push(new SceneObjectProperty(this.objectProperies, 'glb', currentSO));\r\n      } else {\r\n        this.currentProperties.push(new SceneObjectProperty(this.objectProperies, prop, currentSO));\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nclass SceneObjectProperty {\r\n  constructor(parentDOM, propName, currSceneObj) {\r\n    this.subObjectsProps = [];\r\n    this.propName = document.createElement(\"div\");\r\n    this.propName.style.width = '100%';\r\n    // console.log(\"init : \" + propName)\r\n    // Register\r\n    if(propName == \"device\" || propName == \"position\" || propName == \"rotation\"\r\n      || propName == \"raycast\" || propName == \"entityArgPass\" || propName == \"scale\"\r\n      || propName == \"maxInstances\" || propName == \"texturesPaths\" || propName == \"glb\"\r\n    ) {\r\n      this.propName.style.overflow = 'hidden';\r\n      this.propName.style.height = '20px';\r\n      this.propName.style.borderBottom = 'solid lime 2px';\r\n      this.propName.addEventListener('click', (e) => {\r\n        if(e.currentTarget.style.height != 'fit-content') {\r\n          this.propName.style.overflow = 'unset';\r\n          e.currentTarget.style.height = 'fit-content';\r\n        } else {\r\n          this.propName.style.overflow = 'hidden';\r\n          e.currentTarget.style.height = '20px';\r\n        }\r\n      })\r\n\r\n      if(propName == \"position\" || propName == \"scale\" || propName == \"rotation\" || propName == \"glb\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:purple;\">sceneObj</span>\r\n        <span style=\"border-radius:6px;background:gray;\">More info\uD83D\uDD3D</span></div>`;\r\n      } else if(propName == \"entityArgPass\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:brown;\">webGPU props</span>\r\n        <span style=\"border-radius:6px;background:gray;\">More info\uD83D\uDD3D</span></div>`;\r\n      } else if(propName == \"maxInstances\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:brown;\">instanced</span>\r\n        <span style=\"border-radius:6px;background:gray;\"> <input type=\"number\" value=\"${currSceneObj[propName]}\" /> </span></div>`;\r\n      } else if(propName == \"texturesPaths\") {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:purple;\">sceneObj</span>\r\n         <span style=\"border-radius:6px;background:gray;\"> \r\n           Path: ${currSceneObj[propName]} \r\n         </span>\r\n           <div style=\"text-align:center;padding:5px;margin:5px;\"> <img src=\"${currSceneObj[propName]}\" width=\"256px\" height=\"auto\" /> </div>\r\n        </div>`;\r\n      } else {\r\n        this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:red;\">sys</span> \r\n        <span style=\"border-radius:6px;background:gray;\">${currSceneObj[propName]}</span></div>`;\r\n      }\r\n      // console.log('[propName] ', propName);\r\n      if(typeof currSceneObj[propName].adapterInfo !== 'undefined') {\r\n        this.exploreSubObject(currSceneObj[propName].adapterInfo, 'adapterInfo').forEach((item) => {\r\n          if(typeof item === 'string') {\r\n            this.propName.innerHTML += `<div style=\"text-align:left;\"> ${item.split(':'[1])} </div>`;\r\n          } else {\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.appendChild(item);\r\n          }\r\n        })\r\n      } else if(\r\n        propName == 'position' ||\r\n        propName == 'rotation' ||\r\n        propName == \"raycast\" ||\r\n        propName == \"entityArgPass\" ||\r\n        propName == \"scale\") {\r\n\r\n        // console.log('currSceneObj[propName] ', currSceneObj[propName]);\r\n        this.exploreSubObject(currSceneObj[propName], propName, currSceneObj).forEach((item) => {\r\n          if(typeof item === 'string') {\r\n            this.propName.innerHTML += `<div style=\"text-align:left;\"> ${item.split(':'[1])} </div>`;\r\n          } else {\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.appendChild(item);\r\n          }\r\n        })\r\n      } else if(propName == 'glb') {\r\n        this.exploreGlb(currSceneObj[propName], propName, currSceneObj).forEach((item) => {\r\n          if(typeof item === 'string') {\r\n            this.propName.innerHTML += `<div style=\"text-align:left;\"> ${item.split(':'[1])} </div>`;\r\n          } else {\r\n            item.addEventListener('click', (event) => {\r\n              event.stopPropagation();\r\n            });\r\n            this.propName.appendChild(item);\r\n          }\r\n        });\r\n      }\r\n\r\n      parentDOM.appendChild(this.propName);\r\n\r\n    } else if(propName == \"isVideo\") {\r\n      this.propName.style.borderBottom = 'solid lime 2px';\r\n      this.propName.innerHTML = `<div style=\"text-align:left;\" >${propName} <span style=\"border-radius:7px;background:deepskyblue;\">boolean</span>\r\n        <span style=\"border-radius:6px;background:gray;\">${currSceneObj[propName]}</span></div>`;\r\n      parentDOM.appendChild(this.propName);\r\n    } else {\r\n      // this.propName.innerHTML = `<div>${propName}</div>`;\r\n      // this.propName.innerHTML += `<div>${currSceneObj[propName]}</div>`;\r\n    }\r\n  }\r\n\r\n  exploreSubObject(subobj, rootKey, currSceneObj) {\r\n    let a = []; let __ = [];\r\n    for(const key in subobj) {\r\n      __.push(key);\r\n    }\r\n    __.forEach((prop, index) => {\r\n      if(index == 0) a.push(`${rootKey}`);\r\n      let d = null;\r\n      d = document.createElement(\"div\");\r\n      d.style.textAlign = \"left\";\r\n      d.style.display = \"flex\";\r\n      if(typeof subobj[prop] === 'number') {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;\" > \r\n\r\n         <input class=\"inputEditor\" name=\"${prop}\" \r\n          onchange=\"console.log(this.value, 'change fired'); \r\n          document.dispatchEvent(new CustomEvent('web.editor.input', {detail: {\r\n           'inputFor': ${currSceneObj ? \"'\" + currSceneObj.name + \"'\" : \"'no info'\"} ,\r\n           'propertyId': ${currSceneObj ? \"'\" + rootKey + \"'\" : \"'no info'\"} ,\r\n           'property': ${currSceneObj ? \"'\" + prop + \"'\" : \"'no info'\"} ,\r\n           'value': ${currSceneObj ? \"this.value\" : \"'no info'\"}\r\n          }}))\" \r\n         ${(rootKey == \"adapterInfo\" ? \" disabled='true'\" : \" \")} type=\"number\" value=\"${subobj[prop]}\" /> \r\n        \r\n         </div>`;\r\n      } else if(Array.isArray(subobj[prop])) {\r\n        d.innerHTML += `<div style=\"width:50%\">${prop}</div> \r\n         <div style=\"width:${(subobj[prop].length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > ${(subobj[prop].length == 0 ? \"[Empty array]\" : subobj[prop])} </div>`;\r\n      } else if(subobj[prop] === null) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      } else if(subobj[prop] == false) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >false</div>`;\r\n      } else if(subobj[prop] == \"\") {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >none</div>`;\r\n      } else {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      }\r\n\r\n      a.push(d);\r\n    });\r\n    // this.subObjectsProps.push(a);\r\n    return a;\r\n  }\r\n\r\n  exploreGlb(subobj, rootKey, currSceneObj) {\r\n    let a = []; let __ = [];\r\n    for(const key in subobj) {\r\n      __.push(key);\r\n    }\r\n    __.forEach((prop, index) => {\r\n      if(index == 0) a.push(`${rootKey}`);\r\n      let d = null;\r\n      d = document.createElement(\"div\");\r\n      d.style.textAlign = \"left\";\r\n      d.style.display = \"flex\";\r\n      d.style.flexWrap = \"wrap\";\r\n      if(typeof subobj[prop] === 'number') {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;\" >\r\n           <input\r\n           class=\"inputEditor\" name=\"${prop}\" \r\n           ${(prop === \"animationIndex\" ? \"max='\" + subobj['glbJsonData']['animations'].length - 1 + \"'\" : \"\")}\r\n             onchange=\"console.log(this.value, 'change fired'); \r\n            document.dispatchEvent(new CustomEvent('web.editor.input', {detail: {\r\n             'inputFor': ${currSceneObj ? \"'\" + currSceneObj.name + \"'\" : \"'no info'\"} ,\r\n             'propertyId': ${currSceneObj ? \"'\" + rootKey + \"'\" : \"'no info'\"} ,\r\n             'property': ${currSceneObj ? \"'\" + prop + \"'\" : \"'no info'\"} ,\r\n             'value': ${currSceneObj ? \"this.value\" : \"'no info'\"}\r\n            }}))\" \r\n           ${(rootKey == \"adapterInfo\" ? \"disabled='true'\" : \"\")}\" type=\"number\" value=\"${subobj[prop]}\" /> \r\n           </div>`;\r\n      } else if(Array.isArray(subobj[prop]) && prop == \"nodes\") {\r\n        console.log(\"init prop: \" + rootKey)\r\n        d.innerHTML += `<div style=\"width:50%\">${prop}</div> \r\n         <div style=\"width:${(subobj[prop].length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].length == 0 ? \"[Empty array]\" : subobj[prop].length)}\r\n         </div>`;\r\n      } else if(Array.isArray(subobj[prop]) && prop == \"skins\") {\r\n        console.log(\"init prop: \" + rootKey)\r\n        d.innerHTML += `<div style=\"width:50%\">${prop}</div> \r\n         <div style=\"width:${(subobj[prop].length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].length == 0 ? \"[Empty array]\" :\r\n            subobj[prop]\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return item.name + \" Joints:\" + item.joints.length + \"\\n inverseBindMatrices:\" + item.inverseBindMatrices;\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>`;\r\n      } else if(prop == \"glbJsonData\") {\r\n        console.log(\"init glbJsonData: \" + rootKey)\r\n\r\n        d.innerHTML += `<div style=\"width:50%\">Animations:</div> \r\n\r\n         <div style=\"width:${(subobj[prop].animations.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].animations.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].animations\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return item.name;\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n         \\n\r\n         <div style=\"width:50%\">Skinned meshes:</div> \r\n         <div style=\"width:${(subobj[prop].meshes.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].meshes.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].meshes\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return item.name + \" \\n Primitives : \" + item.primitives.length;\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n          \\n\r\n         <div style=\"width:50%\">Images:</div> \r\n         <div style=\"width:${(subobj[prop].images.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].images.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].images\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return \"<div>\" + item.name + \" \\n mimeType: \" + item.mimeType + \"</div>\";\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n\r\n         \\n\r\n         <div style=\"width:50%\">Materials:</div> \r\n         <div style=\"width:${(subobj[prop].materials.length == 0 ? \"unset\" : \"48%\")}; background:lime;color:black;border-radius:5px;\" > \r\n            ${(subobj[prop].materials.length == 0 ? \"[Empty array]\" :\r\n            subobj[prop].materials\r\n              .map(item => {\r\n                if(item && typeof item === \"object\" && \"name\" in item) {\r\n                  return \"<div>\" + item.name + \" \\n metallicFactor: \" + item.pbrMetallicRoughness.metallicFactor +\r\n                    \" \\n roughnessFactor: \" + item.pbrMetallicRoughness.roughnessFactor + \"</div>\";\r\n                }\r\n                return String(item);\r\n              })\r\n              .join(\", \")\r\n          )}\r\n         </div>\r\n         \r\n         `;\r\n\r\n\r\n\r\n      } else if(subobj[prop] === null) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      } else if(subobj[prop] == false) {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >false</div>`;\r\n      } else if(subobj[prop] == \"\") {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:unset; background:lime;color:black;padding:1px;border-radius:5px;\" >none</div>`;\r\n      } else {\r\n        d.innerHTML += `<div style=\"width:50%;\">${prop}</div> \r\n         <div style=\"width:48%; background:lime;color:black;padding:1px;border-radius:5px;\" >${subobj[prop]}</div>`;\r\n      }\r\n\r\n      a.push(d);\r\n    });\r\n    // this.subObjectsProps.push(a);\r\n    return a;\r\n  }\r\n}", "import {MEEditorClient} from \"./client\";\r\nimport EditorProvider from \"./editor.provider\";\r\nimport EditorHud from \"./hud\";\r\n\r\nexport class Editor {\r\n\r\n  constructor(core, a, projName) {\r\n    this.core = core;\r\n    this.editorHud = new EditorHud(core, this.check(a));\r\n    this.editorProvider = new EditorProvider(core, this.check(a));\r\n    if(this.check(a) == 'pre editor') {\r\n      this.client = new MEEditorClient(this.check(a));\r\n    } else if(this.check(a) == 'created from editor') {\r\n      this.client = new MEEditorClient(this.check(a), projName);\r\n    }\r\n  }\r\n\r\n  check(a) {\r\n    if(typeof a !== 'undefined' && a == \"created from editor\") {\r\n      return a;\r\n    } else if(typeof a !== 'undefined' && a == \"pre editor\") {\r\n      return a;\r\n    } else {\r\n      return \"infly\";\r\n    }\r\n  }\r\n}", "import {mat4, vec3} from \"wgpu-matrix\";\r\nimport MEBall from \"./engine/ball.js\";\r\nimport MECube from './engine/cube.js';\r\nimport {ArcballCamera, RPGCamera, WASDCamera} from \"./engine/engine.js\";\r\nimport {createInputHandler} from \"./engine/engine.js\";\r\nimport MEMeshObj from \"./engine/mesh-obj.js\";\r\nimport MatrixAmmo from \"./physics/matrix-ammo.js\";\r\nimport {LOG_FUNNY_SMALL, LOG_WARN, genName, mb, scriptManager, urlQuery} from \"./engine/utils.js\";\r\nimport {MultiLang} from \"./multilang/lang.js\";\r\nimport {MatrixSounds} from \"./sounds/sounds.js\";\r\nimport {play} from \"./engine/loader-obj.js\";\r\nimport {SpotLight} from \"./engine/lights.js\";\r\nimport {BVHPlayer} from \"./engine/loaders/bvh.js\";\r\nimport {BVHPlayerInstances} from \"./engine/loaders/bvh-instaced.js\";\r\nimport {Editor} from \"./tools/editor/editor.js\";\r\n\r\n/**\r\n * @description\r\n * Main engine root class.\r\n * @author Nikola Lukic 2025\r\n * @email zlatnaspirala@gmail.com\r\n * @web https://maximumroulette.com\r\n * @github zlatnaspirala\r\n */\r\nexport default class MatrixEngineWGPU {\r\n\r\n  mainRenderBundle = [];\r\n  lightContainer = [];\r\n  frame = () => {};\r\n  entityHolder = [];\r\n  lastTime = 0;\r\n  entityArgPass = {\r\n    loadOp: 'clear',\r\n    storeOp: 'store',\r\n    depthLoadOp: 'clear',\r\n    depthStoreOp: 'store'\r\n  }\r\n  // matrixAmmo = new MatrixAmmo();\r\n  matrixSounds = new MatrixSounds();\r\n\r\n  constructor(options, callback) {\r\n    if(typeof options == 'undefined' || typeof options == \"function\") {\r\n      this.options = {\r\n        useSingleRenderPass: true,\r\n        canvasSize: 'fullscreen',\r\n        canvasId: 'canvas1',\r\n        mainCameraParams: {\r\n          type: 'WASD',\r\n          responseCoef: 2000\r\n        },\r\n        clearColor: {r: 0.584, g: 0, b: 0.239, a: 1.0}\r\n      }\r\n      callback = options;\r\n    }\r\n    if(typeof options.clearColor === 'undefined') {\r\n      options.clearColor = {r: 0.584, g: 0, b: 0.239, a: 1.0};\r\n    }\r\n    if(typeof options.canvasId === 'undefined') {\r\n      options.canvasId = 'canvas1';\r\n    }\r\n    if(typeof options.mainCameraParams === 'undefined') {\r\n      options.mainCameraParams = {\r\n        type: 'WASD',\r\n        responseCoef: 2000\r\n      }\r\n    }\r\n\r\n    if(typeof options.dontUsePhysics == 'undefined') {\r\n      this.matrixAmmo = new MatrixAmmo();\r\n    }\r\n\r\n    this.editor = undefined;\r\n    if(typeof options.useEditor !== \"undefined\") {\r\n      if(typeof options.projectType !== \"undefined\" && options.projectType == \"created from editor\") {\r\n        this.editor = new Editor(this, \"created from editor\", options.projectName);\r\n      } else if(typeof options.projectType !== \"undefined\" && options.projectType == \"pre editor\") {\r\n        this.editor = new Editor(this, options.projectType);\r\n      } else {\r\n        this.editor = new Editor(this, \"infly\");\r\n      }\r\n\r\n    }\r\n\r\n    window.addEventListener('keydown', e => {\r\n      if(e.code == \"F4\") {\r\n        e.preventDefault();\r\n        mb.error(`Activated WebEditor, you can use it infly there is no saves for now.`);\r\n        app.activateEditor();\r\n        return false;\r\n      }\r\n    });\r\n\r\n    this.activateEditor = () => {\r\n      if(this.editor == null || typeof this.editor === 'undefined') {\r\n        if(typeof options.projectType !== \"undefined\" && options.projectType == \"created from editor\") {\r\n          this.editor = new Editor(this, \"created from editor\");\r\n        } else if(typeof options.projectType !== \"undefined\" && options.projectType == \"pre editor\") {\r\n          this.editor = new Editor(this, options.projectType);\r\n        } else {\r\n          this.editor = new Editor(this, \"infly\");\r\n        }\r\n        this.editor.editorHud.updateSceneContainer();\r\n      } else {\r\n        // nikola\r\n        this.editor.editorHud.editorMenu.style.display = 'flex';\r\n        this.editor.editorHud.assetsBox.style.display = 'flex';\r\n        this.editor.editorHud.sceneProperty.style.display = 'flex';\r\n        this.editor.editorHud.sceneContainer.style.display = 'flex';\r\n      }\r\n\r\n    };\r\n\r\n    this.options = options;\r\n    this.mainCameraParams = options.mainCameraParams;\r\n\r\n    const target = this.options.appendTo || document.body;\r\n    var canvas = document.createElement('canvas');\r\n    canvas.id = this.options.canvasId;\r\n    if(this.options.canvasSize == 'fullscreen') {\r\n      canvas.width = window.innerWidth;\r\n      canvas.height = window.innerHeight;\r\n    } else {\r\n      canvas.width = this.options.canvasSize.w;\r\n      canvas.height = this.options.canvasSize.h;\r\n    }\r\n    target.append(canvas);\r\n\r\n    // The camera types\r\n    const initialCameraPosition = vec3.create(0, 0, 0);\r\n    this.mainCameraParams = {\r\n      type: this.options.mainCameraParams.type,\r\n      responseCoef: this.options.mainCameraParams.responseCoef\r\n    };\r\n\r\n    this.cameras = {\r\n      arcball: new ArcballCamera({position: initialCameraPosition}),\r\n      WASD: new WASDCamera({position: initialCameraPosition, canvas: canvas}),\r\n      RPG: new RPGCamera({position: initialCameraPosition, canvas: canvas}),\r\n    };\r\n\r\n    this.label = new MultiLang()\r\n    if(urlQuery.lang != null) {\r\n      this.label.loadMultilang(urlQuery.lang).then((r) => {\r\n        this.label.get = r;\r\n      }).catch((r) => {\r\n        this.label.get = r;\r\n      });\r\n    } else {\r\n      this.label.loadMultilang().then((r) => {\r\n        this.label.get = r;\r\n      }).catch((r) => {\r\n        this.label.get = r;\r\n      });;\r\n    }\r\n    this.init({canvas, callback})\r\n  }\r\n\r\n  init = async ({canvas, callback}) => {\r\n    this.canvas = canvas;\r\n    this.adapter = await navigator.gpu.requestAdapter();\r\n    this.device = await this.adapter.requestDevice({\r\n      extensions: [\"ray_tracing\"]\r\n    });\r\n\r\n    this.context = canvas.getContext('webgpu');\r\n    // this.context = canvas.getContext('webgpu', { alphaMode: 'opaque' });\r\n    // this.context = canvas.getContext('webgpu', { alphaMode: 'premultiplied' });\r\n    const devicePixelRatio = window.devicePixelRatio;\r\n    canvas.width = canvas.clientWidth * devicePixelRatio;\r\n    canvas.height = canvas.clientHeight * devicePixelRatio;\r\n    const presentationFormat = navigator.gpu.getPreferredCanvasFormat();\r\n\r\n    this.context.configure({\r\n      device: this.device,\r\n      format: presentationFormat,\r\n      alphaMode: 'premultiplied',\r\n    });\r\n\r\n    if(this.options.useSingleRenderPass == true) {\r\n      this.frame = this.frameSinglePass;\r\n    } else {\r\n      this.frame = this.framePassPerObject;\r\n    }\r\n\r\n    this.globalAmbient = vec3.create(0.5, 0.5, 0.5);\r\n    this.MAX_SPOTLIGHTS = 20;\r\n    this.inputHandler = createInputHandler(window, canvas);\r\n    this.createGlobalStuff();\r\n    this.run(callback)\r\n  };\r\n\r\n  createGlobalStuff() {\r\n    this.spotlightUniformBuffer = this.device.createBuffer({\r\n      label: 'spotlightUniformBufferGLOBAL',\r\n      size: this.MAX_SPOTLIGHTS * 144,\r\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\r\n    });\r\n\r\n    this.SHADOW_RES = 1024;\r\n    this.createTexArrayForShadows()\r\n\r\n    this.mainDepthTexture = this.device.createTexture({\r\n      size: [this.canvas.width, this.canvas.height],\r\n      format: 'depth24plus',\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n    });\r\n\r\n    this.mainDepthView = this.mainDepthTexture.createView();\r\n\r\n    this.mainRenderPassDesc = {\r\n      label: 'mainRenderPassDesc',\r\n      colorAttachments: [{\r\n        view: undefined,                // set each frame\r\n        loadOp: 'clear',\r\n        storeOp: 'store',\r\n        clearValue: [0.02, 0.02, 0.02, 1],\r\n      }],\r\n      depthStencilAttachment: {\r\n        view: this.mainDepthView,       // fixed\r\n        depthLoadOp: 'clear',\r\n        depthStoreOp: 'store',\r\n        depthClearValue: 1.0,\r\n      },\r\n    };\r\n\r\n    // pointer effect-not in use\r\n    const depthTexture = this.device.createTexture({\r\n      size: [this.canvas.width, this.canvas.height],\r\n      format: \"depth24plus\",\r\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\r\n    });\r\n\r\n    this.depthTextureViewTrail = depthTexture.createView();\r\n  }\r\n  createTexArrayForShadows() {\r\n    let numberOfLights = this.lightContainer.length;\r\n    if(this.lightContainer.length == 0) {\r\n      setTimeout(() => {\r\n        // console.info('Test light again...')\r\n        this.createMe();\r\n      }, 800);\r\n    }\r\n\r\n    this.createMe = () => {\r\n      Math.max(1, this.lightContainer.length);\r\n      if(this.lightContainer.length == 0) {\r\n        setTimeout(() => {\r\n          // console.info('Create now test...')\r\n          this.createMe();\r\n        }, 800);\r\n        return;\r\n      }\r\n\r\n      // console.warn('Create this.shadowTextureArray...')\r\n      this.shadowTextureArray = this.device.createTexture({\r\n        label: `shadowTextureArray[GLOBAL] num of light ${numberOfLights}`,\r\n        size: {\r\n          width: 1024,\r\n          height: 1024,\r\n          depthOrArrayLayers: numberOfLights, // at least 1\r\n        },\r\n        dimension: '2d',\r\n        format: 'depth32float',\r\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n      });\r\n\r\n      this.shadowArrayView = this.shadowTextureArray.createView({\r\n        dimension: '2d-array'\r\n      });\r\n\r\n      this.shadowVideoTexture = this.device.createTexture({\r\n        size: [1024, 1024],\r\n        format: \"depth32float\",\r\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\r\n      });\r\n\r\n      this.shadowVideoView = this.shadowVideoTexture.createView({\r\n        dimension: \"2d\",\r\n      });\r\n    }\r\n\r\n    this.createMe();\r\n  }\r\n\r\n  getSceneObjectByName(name) {\r\n    return this.mainRenderBundle.find((sceneObject) => sceneObject.name === name)\r\n  }\r\n\r\n  // Not in use for now\r\n  addCube = (o) => {\r\n    if(typeof o === 'undefined') {\r\n      var o = {\r\n        scale: 1,\r\n        position: {x: 0, y: 0, z: -4},\r\n        texturesPaths: ['./res/textures/default.png'],\r\n        rotation: {x: 0, y: 0, z: 0},\r\n        rotationSpeed: {x: 0, y: 0, z: 0},\r\n        entityArgPass: this.entityArgPass,\r\n        cameras: this.cameras,\r\n        mainCameraParams: this.mainCameraParams\r\n      }\r\n    } else {\r\n      if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n      if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n      if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n      if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n      if(typeof o.scale === 'undefined') {o.scale = 1;}\r\n      if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n      o.entityArgPass = this.entityArgPass;\r\n      o.cameras = this.cameras;\r\n    }\r\n\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\",\r\n        radius: o.scale,\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.position !== 'undefined') {o.physics.position = o.position;}\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Sphere\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n\r\n    let myCube1 = new MECube(this.canvas, this.device, this.context, o)\r\n    if(o.physics.enabled == true) {\r\n      this.matrixAmmo.addPhysics(myCube1, o.physics);\r\n    }\r\n    this.mainRenderBundle.push(myCube1);\r\n  }\r\n\r\n  // Not in use for now\r\n  addBall = (o) => {\r\n    if(typeof o === 'undefined') {\r\n      var o = {\r\n        scale: 1,\r\n        position: {x: 0, y: 0, z: -4},\r\n        texturesPaths: ['./res/textures/default.png'],\r\n        rotation: {x: 0, y: 0, z: 0},\r\n        rotationSpeed: {x: 0, y: 0, z: 0},\r\n        entityArgPass: this.entityArgPass,\r\n        cameras: this.cameras,\r\n        mainCameraParams: this.mainCameraParams\r\n      }\r\n    } else {\r\n      if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n      if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n      if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n      if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n      if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n      if(typeof o.scale === 'undefined') {o.scale = 1;}\r\n      o.entityArgPass = this.entityArgPass;\r\n      o.cameras = this.cameras;\r\n    }\r\n\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\",\r\n        radius: o.scale,\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.position !== 'undefined') {o.physics.position = o.position;}\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Sphere\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n\r\n    let myBall1 = new MEBall(this.canvas, this.device, this.context, o);\r\n    if(o.physics.enabled == true) {\r\n      this.matrixAmmo.addPhysics(myBall1, o.physics)\r\n    }\r\n    this.mainRenderBundle.push(myBall1);\r\n  }\r\n\r\n  addLight(o) {\r\n    const camera = this.cameras[this.mainCameraParams.type];\r\n    let newLight = new SpotLight(camera, this.inputHandler, this.device);\r\n    this.lightContainer.push(newLight);\r\n    this.createTexArrayForShadows();\r\n    console.log(`%cAdd light: ${newLight}`, LOG_FUNNY_SMALL);\r\n  }\r\n\r\n  addMeshObj = (o, clearColor = this.options.clearColor) => {\r\n    if(typeof o.name === 'undefined') {o.name = genName(9)}\r\n    if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n    if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n    if(typeof o.material === 'undefined') {o.material = {type: 'standard'}}\r\n    if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n    if(typeof o.scale === 'undefined') {o.scale = [1, 1, 1];}\r\n    if(typeof o.raycast === 'undefined') {o.raycast = {enabled: false, radius: 2}}\r\n    o.entityArgPass = this.entityArgPass;\r\n    o.cameras = this.cameras;\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\",//                   must be fixed<<\r\n        radius: (typeof o.scale == Number ? o.scale : o.scale[0]),\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Cube\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n    o.physics.position = o.position;\r\n    if(typeof o.objAnim == 'undefined' || typeof o.objAnim == null) {\r\n      o.objAnim = null;\r\n    } else {\r\n      if(typeof o.objAnim.animations !== 'undefined') {\r\n        o.objAnim.play = play;\r\n      }\r\n      // no need for single test it in future\r\n      o.objAnim.meshList = o.objAnim.meshList;\r\n      if(typeof o.mesh === 'undefined') {\r\n        o.mesh = o.objAnim.meshList[0];\r\n        console.info('objSeq animation is active.');\r\n      }\r\n      // scale for all second option!\r\n      o.objAnim.scaleAll = function(s) {\r\n        for(var k in this.meshList) {\r\n          // console.log('SCALE meshList');\r\n          this.meshList[k].setScale(s);\r\n        }\r\n      }\r\n    }\r\n\r\n    let AM = this.globalAmbient.slice();\r\n    let myMesh1 = new MEMeshObj(this.canvas, this.device, this.context, o, this.inputHandler, AM);\r\n    myMesh1.spotlightUniformBuffer = this.spotlightUniformBuffer;\r\n    myMesh1.clearColor = clearColor;\r\n    if(o.physics.enabled == true) {\r\n      this.matrixAmmo.addPhysics(myMesh1, o.physics)\r\n    }\r\n    this.mainRenderBundle.push(myMesh1);\r\n\r\n    if(typeof this.editor !== 'undefined') {\r\n      this.editor.editorHud.updateSceneContainer();\r\n    }\r\n  }\r\n\r\n  run(callback) {\r\n    setTimeout(() => {requestAnimationFrame(this.frame)}, 500)\r\n    setTimeout(() => {callback(this)}, 20)\r\n  }\r\n\r\n  destroyProgram = () => {\r\n    this.mainRenderBundle = [];\r\n    this.canvas.remove();\r\n  }\r\n\r\n  updateLights() {\r\n    const floatsPerLight = 36; // not 20 anymore\r\n    const data = new Float32Array(this.MAX_SPOTLIGHTS * floatsPerLight);\r\n    for(let i = 0;i < this.MAX_SPOTLIGHTS;i++) {\r\n      if(i < this.lightContainer.length) {\r\n        const buf = this.lightContainer[i].getLightDataBuffer();\r\n        data.set(buf, i * floatsPerLight);\r\n      } else {\r\n        data.set(new Float32Array(floatsPerLight), i * floatsPerLight);\r\n      }\r\n    }\r\n    this.device.queue.writeBuffer(this.spotlightUniformBuffer, 0, data.buffer);\r\n  }\r\n\r\n  frameSinglePass = () => {\r\n    if(typeof this.mainRenderBundle == 'undefined' || this.mainRenderBundle.length == 0) {\r\n      setTimeout(() => {requestAnimationFrame(this.frame)}, 100);\r\n      return;\r\n    }\r\n    this.mainRenderBundle.forEach((meItem, index) => {\r\n      if(meItem.isVideo == true) {\r\n        if(!meItem.externalTexture) { // || meItem.video.readyState < 2) {\r\n          // console.log('no rendere for video not ready')\r\n          // this.externalTexture = this.device.importExternalTexture({source: this.video});\r\n          meItem.createBindGroupForRender();\r\n          setTimeout(() => {\r\n            requestAnimationFrame(this.frame)\r\n          }, 1000)\r\n          return;\r\n        }\r\n      }\r\n    })\r\n\r\n    try {\r\n      let commandEncoder = this.device.createCommandEncoder();\r\n      this.updateLights()\r\n      // 1\uFE0F\u20E3 Update light data (position, direction, uniforms)\r\n      for(const light of this.lightContainer) {\r\n        light.update()\r\n        this.mainRenderBundle.forEach((meItem, index) => {\r\n          meItem.updateModelUniformBuffer()\r\n          meItem.getTransformationMatrix(this.mainRenderBundle, light, index)\r\n        })\r\n      }\r\n      if(this.matrixAmmo) this.matrixAmmo.updatePhysics();\r\n\r\n      let now, deltaTime;\r\n\r\n      for(let i = 0;i < this.lightContainer.length;i++) {\r\n        const light = this.lightContainer[i];\r\n        let ViewPerLightRenderShadowPass = this.shadowTextureArray.createView({\r\n          dimension: '2d',\r\n          baseArrayLayer: i,\r\n          arrayLayerCount: 1, // must be > 0\r\n          baseMipLevel: 0,\r\n          mipLevelCount: 1,\r\n        });\r\n\r\n        const shadowPass = commandEncoder.beginRenderPass({\r\n          label: \"shadowPass\",\r\n          colorAttachments: [],\r\n          depthStencilAttachment: {\r\n            view: ViewPerLightRenderShadowPass,\r\n            depthLoadOp: 'clear',\r\n            depthStoreOp: 'store',\r\n            depthClearValue: 1.0,\r\n          }\r\n        });\r\n\r\n        now = performance.now() / 1000;\r\n        // shadowPass.setPipeline(light.shadowPipeline);\r\n        for(const [meshIndex, mesh] of this.mainRenderBundle.entries()) {\r\n          if(mesh instanceof BVHPlayerInstances) {\r\n            mesh.updateInstanceData(mesh.getModelMatrix(mesh.position))\r\n            shadowPass.setPipeline(light.shadowPipelineInstanced);\r\n          } else {\r\n            // must be base meshObj\r\n            shadowPass.setPipeline(light.shadowPipeline);\r\n          }\r\n\r\n          if(mesh.videoIsReady == 'NONE') {\r\n            shadowPass.setBindGroup(0, light.getShadowBindGroup(mesh, meshIndex));\r\n            // if(mesh.glb && mesh.glb.skinnedMeshNodes) {\r\n            // shadowPass.setBindGroup(1, light.getShadowBindGroup_bones(meshIndex));\r\n            // } else {\r\n            if(mesh instanceof BVHPlayerInstances) {\r\n              shadowPass.setBindGroup(1, mesh.modelBindGroupInstanced);\r\n            } else {\r\n              shadowPass.setBindGroup(1, mesh.modelBindGroup);\r\n            }\r\n            // }\r\n            mesh.drawShadows(shadowPass, light);\r\n          }\r\n        }\r\n        shadowPass.end();\r\n      }\r\n      const currentTextureView = this.context.getCurrentTexture().createView();\r\n      this.mainRenderPassDesc.colorAttachments[0].view = currentTextureView;\r\n      let pass = commandEncoder.beginRenderPass(this.mainRenderPassDesc);\r\n      // Loop over each mesh\r\n\r\n      for(const mesh of this.mainRenderBundle) {\r\n        mesh.position.update()\r\n        if(mesh.update) {\r\n          now = performance.now() / 1000; // seconds\r\n          deltaTime = now - (this.lastTime || now);\r\n          this.lastTime = now;\r\n          mesh.update(deltaTime); // glb\r\n        }\r\n        pass.setPipeline(mesh.pipeline);\r\n        if(!mesh.sceneBindGroupForRender || (mesh.FINISH_VIDIO_INIT == false && mesh.isVideo == true)) {\r\n          for(const m of this.mainRenderBundle) {\r\n            if(m.isVideo == true) {\r\n              console.log('\u2705shadowVideoView', this.shadowVideoView)\r\n              m.shadowDepthTextureView = this.shadowVideoView;\r\n              m.FINISH_VIDIO_INIT = true;\r\n              m.setupPipeline();\r\n            } else {\r\n              m.shadowDepthTextureView = this.shadowArrayView;\r\n              m.setupPipeline();\r\n            }\r\n          }\r\n        }\r\n        mesh.drawElements(pass, this.lightContainer);\r\n      }\r\n      pass.end();\r\n\r\n      // 3) resolve collisions AFTER positions changed\r\n      if(this.collisionSystem) this.collisionSystem.update();\r\n      // 4) render / send network updates / animations etc\r\n\r\n      // transparent pointerEffect pass (load color, load depth)\r\n      const transPassDesc = {\r\n        colorAttachments: [{view: currentTextureView, loadOp: 'load', storeOp: 'store'}],\r\n        depthStencilAttachment: {\r\n          view: this.mainDepthView,\r\n          depthLoadOp: 'load',\r\n          depthStoreOp: 'store',\r\n          depthClearValue: 1.0,\r\n        }\r\n      };\r\n      const transPass = commandEncoder.beginRenderPass(transPassDesc);\r\n      const viewProjMatrix = mat4.multiply(this.cameras[this.mainCameraParams.type].projectionMatrix,\r\n        this.cameras[this.mainCameraParams.type].view, mat4.identity());\r\n      for(const mesh of this.mainRenderBundle) {\r\n        if(mesh.effects) Object.keys(mesh.effects).forEach(effect_ => {\r\n          const effect = mesh.effects[effect_];\r\n          if(effect.enabled == false) return;\r\n          let md = mesh.getModelMatrix(mesh.position);\r\n          if(effect.updateInstanceData) effect.updateInstanceData(md);\r\n          effect.render(transPass, mesh, viewProjMatrix)\r\n        });\r\n      }\r\n      transPass.end();\r\n\r\n      this.device.queue.submit([commandEncoder.finish()]);\r\n      requestAnimationFrame(this.frame);\r\n    } catch(err) {\r\n      console.log('%cLoop(err):' + err + \" info : \" + err.stack, LOG_WARN)\r\n      requestAnimationFrame(this.frame);\r\n    }\r\n  }\r\n\r\n  framePassPerObject = () => {\r\n    let commandEncoder = this.device.createCommandEncoder();\r\n    if(this.matrixAmmo.rigidBodies && this.matrixAmmo.rigidBodies.length > 0) this.matrixAmmo.updatePhysics();\r\n    this.mainRenderBundle.forEach((meItem, index) => {\r\n      if(index === 0) {\r\n        if(meItem.renderPassDescriptor) meItem.renderPassDescriptor.colorAttachments[0].loadOp = 'clear';\r\n      } else {\r\n        if(meItem.renderPassDescriptor) meItem.renderPassDescriptor.colorAttachments[0].loadOp = 'load';\r\n      }\r\n      // Update transforms, physics, etc. (optional)\r\n      meItem.draw(commandEncoder);\r\n      if(meItem.renderBundle) {\r\n        // Set up view per object\r\n        meItem.renderPassDescriptor.colorAttachments[0].view =\r\n          this.context.getCurrentTexture().createView();\r\n        const passEncoder = commandEncoder.beginRenderPass(meItem.renderPassDescriptor);\r\n        passEncoder.executeBundles([meItem.renderBundle]); // \u2705 Use only this bundle\r\n        passEncoder.end();\r\n      } else {\r\n        meItem.draw(commandEncoder);\r\n      }\r\n    });\r\n    this.device.queue.submit([commandEncoder.finish()]);\r\n    requestAnimationFrame(this.frame);\r\n  }\r\n\r\n  // ---------------------------------------\r\n  addGlbObj = (o, BVHANIM, glbFile, clearColor = this.options.clearColor) => {\r\n    if(typeof o.name === 'undefined') {o.name = genName(9)}\r\n    if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n    if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n    if(typeof o.material === 'undefined') {o.material = {type: 'standard'}}\r\n    if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n    if(typeof o.scale === 'undefined') {o.scale = [1, 1, 1];}\r\n    if(typeof o.raycast === 'undefined') {o.raycast = {enabled: false, radius: 2}}\r\n    if(typeof o.pointerEffect === 'undefined') {o.pointerEffect = {enabled: false};}\r\n\r\n    o.entityArgPass = this.entityArgPass;\r\n    o.cameras = this.cameras;\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\",//                   must be fixed<<\r\n        radius: (typeof o.scale == Number ? o.scale : o.scale[0]),\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Cube\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n    o.physics.position = o.position;\r\n    if(typeof o.objAnim == 'undefined' || typeof o.objAnim == null) {\r\n      o.objAnim = null;\r\n    } else {\r\n      alert('GLB not use objAnim (it is only for obj sequence). GLB use BVH skeletal for animation');\r\n    }\r\n    let skinnedNodeIndex = 0;\r\n    for(const skinnedNode of glbFile.skinnedMeshNodes) {\r\n      let c = 0;\r\n      for(const primitive of skinnedNode.mesh.primitives) {\r\n        // console.log(`count: ${c} primitive-glb: ${primitive}`);\r\n        // primitive is mesh - probably with own material . material/texture per primitive\r\n        // create scene object for each skinnedNode\r\n        o.name = o.name + \"-\" + skinnedNode.name + '-' + c;\r\n        const bvhPlayer = new BVHPlayer(\r\n          o,\r\n          BVHANIM,\r\n          glbFile,\r\n          c,\r\n          skinnedNodeIndex,\r\n          this.canvas,\r\n          this.device,\r\n          this.context,\r\n          this.inputHandler,\r\n          this.globalAmbient.slice());\r\n        skinnedNodeIndex++;\r\n        // console.log(`bvhPlayer!!!!!: ${bvhPlayer}`);\r\n        bvhPlayer.spotlightUniformBuffer = this.spotlightUniformBuffer;\r\n        bvhPlayer.clearColor = clearColor;\r\n        // if(o.physics.enabled == true) {\r\n        //   this.matrixAmmo.addPhysics(myMesh1, o.physics)\r\n        // }\r\n        // make it soft\r\n        setTimeout(() => {this.mainRenderBundle.push(bvhPlayer)}, 800);\r\n        // this.mainRenderBundle.push(bvhPlayer)\r\n        c++;\r\n      }\r\n    }\r\n    if(typeof this.editor !== 'undefined') {\r\n      this.editor.editorHud.updateSceneContainer();\r\n    }\r\n  }\r\n\r\n  // NEW TEST INSTANCED DRAWS\r\n  addGlbObjInctance = (o, BVHANIM, glbFile, clearColor = this.options.clearColor) => {\r\n    if(typeof o.name === 'undefined') {o.name = genName(9)}\r\n    if(typeof o.position === 'undefined') {o.position = {x: 0, y: 0, z: -4}}\r\n    if(typeof o.rotation === 'undefined') {o.rotation = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.rotationSpeed === 'undefined') {o.rotationSpeed = {x: 0, y: 0, z: 0}}\r\n    if(typeof o.texturesPaths === 'undefined') {o.texturesPaths = ['./res/textures/default.png']}\r\n    if(typeof o.material === 'undefined') {o.material = {type: 'standard'}}\r\n    if(typeof o.mainCameraParams === 'undefined') {o.mainCameraParams = this.mainCameraParams}\r\n    if(typeof o.scale === 'undefined') {o.scale = [1, 1, 1];}\r\n    if(typeof o.raycast === 'undefined') {o.raycast = {enabled: false, radius: 2}}\r\n    if(typeof o.pointerEffect === 'undefined') {\r\n      o.pointerEffect = {\r\n        enabled: false,\r\n        pointer: false,\r\n        ballEffect: false\r\n      };\r\n    }\r\n    o.entityArgPass = this.entityArgPass;\r\n    o.cameras = this.cameras;\r\n    if(typeof o.physics === 'undefined') {\r\n      o.physics = {\r\n        scale: [1, 1, 1],\r\n        enabled: true,\r\n        geometry: \"Sphere\",//                   must be fixed<<\r\n        radius: (typeof o.scale == Number ? o.scale : o.scale[0]),\r\n        name: o.name,\r\n        rotation: o.rotation\r\n      }\r\n    }\r\n    if(typeof o.physics.enabled === 'undefined') {o.physics.enabled = true}\r\n    if(typeof o.physics.geometry === 'undefined') {o.physics.geometry = \"Cube\"}\r\n    if(typeof o.physics.radius === 'undefined') {o.physics.radius = o.scale}\r\n    if(typeof o.physics.mass === 'undefined') {o.physics.mass = 1;}\r\n    if(typeof o.physics.name === 'undefined') {o.physics.name = o.name;}\r\n    if(typeof o.physics.scale === 'undefined') {o.physics.scale = o.scale;}\r\n    if(typeof o.physics.rotation === 'undefined') {o.physics.rotation = o.rotation;}\r\n    o.physics.position = o.position;\r\n    if(typeof o.objAnim == 'undefined' || typeof o.objAnim == null) {\r\n      o.objAnim = null;\r\n    } else {\r\n      console.warn('GLB not use objAnim (it is only for obj sequence). GLB use BVH skeletal for animation');\r\n    }\r\n\r\n    let skinnedNodeIndex = 0;\r\n    for(const skinnedNode of glbFile.skinnedMeshNodes) {\r\n      let c = 0;\r\n      for(const primitive of skinnedNode.mesh.primitives) {\r\n        // console.log(`count: ${c} primitive-glb: ${primitive}`);\r\n        // primitive is mesh - probably with own material . material/texture per primitive\r\n        // create scene object for each skinnedNode\r\n        o.name = o.name + \"_\" + skinnedNode.name;\r\n        // maybe later add logic from constructor\r\n        // always fisrt sub mesh(skinnedmeg-vert group how comes from loaders)\r\n        if(skinnedNodeIndex == 0) {} else {\r\n          o.pointerEffect = {enabled: false};\r\n        }\r\n        const bvhPlayer = new BVHPlayerInstances(\r\n          o,\r\n          BVHANIM,\r\n          glbFile,\r\n          c,\r\n          skinnedNodeIndex,\r\n          this.canvas,\r\n          this.device,\r\n          this.context,\r\n          this.inputHandler,\r\n          this.globalAmbient.slice());\r\n        // console.log(`bvhPlayer!!!!!: ${bvhPlayer}`);\r\n        bvhPlayer.spotlightUniformBuffer = this.spotlightUniformBuffer;\r\n        bvhPlayer.clearColor = clearColor;\r\n        // if(o.physics.enabled == true) {\r\n        //   this.matrixAmmo.addPhysics(myMesh1, o.physics)\r\n        // }\r\n        // make it soft\r\n        setTimeout(() => {this.mainRenderBundle.push(bvhPlayer)}, 200)\r\n        c++;\r\n      }\r\n      skinnedNodeIndex++;\r\n    }\r\n    if(typeof this.editor !== 'undefined') {\r\n      this.editor.editorHud.updateSceneContainer();\r\n    }\r\n  }\r\n}", "import MatrixEngineWGPU from \"../../src/world.js\";\nimport {downloadMeshes} from '../../src/engine/loader-obj.js';\nimport {uploadGLBModel} from \"../../src/engine/loaders/webgpu-gltf.js\";\n\nlet app = new MatrixEngineWGPU(\n  {\n    useEditor: true,\n    projectType: \"created from editor\",\n    projectName: 'MM',\n    useSingleRenderPass: true,\n    canvasSize: 'fullscreen',\n    mainCameraParams: {\n      type: 'WASD',\n      responseCoef: 1000\n    },\n    clearColor: {r: 0, b: 0.1, g: 0.1, a: 1}\n  } , (app) => {\n    addEventListener('AmmoReady', async () => {\n      // [light]\n      app.addLight();\n\n      downloadMeshes({cube: \"./res/meshes/blender/cube.obj\"}, (m) => {\n        const texturesPaths = ['./res/meshes/blender/cube.png'];\n        app.addMeshObj({\n          position: {x: 0, y: 0, z: -20}, rotation: {x: 0, y: 0, z: 0}, rotationSpeed: {x: 0, y: 0, z: 0},\n          texturesPaths: [texturesPaths],\n          name: 'Cube_' + app.mainRenderBundle.length,\n          mesh: m.cube,\n          raycast: {enabled: true, radius: 2},\n          physics: {enabled: true, geometry: \"Cube\"}\n        });\n      }, {scale: [1, 1, 1]});\n      \n       downloadMeshes({cube: \"./res/meshes/blender/cube.obj\"}, (m) => { \n   const texturesPaths = ['./res/meshes/blender/cube.png']; \n   this.core.addMeshObj({\n     position: {x: 0, y: 0, z: -20}, rotation: {x: 0, y: 0, z: 0}, rotationSpeed: {x: 0, y: 0, z: 0},\n     texturesPaths: [texturesPaths],\n     name: 'Cube_' + app.mainRenderBundle.length,\n     mesh: m.cube,\n     raycast: {enabled: true, radius: 2},\n     physics: {enabled: true, geometry: \"Cube\"}\n   }); \n }, {scale: [1, 1, 1]});  \n \n\n      // [MAIN_REPLACE2]\n\n\n      \n      \n    })\n  })\nwindow.app = app;\n"],
  "mappings": ";;;;;;;;;AE2DM,SAAUA,iBAAe,MAA6B;AAC1D,QAAM,UAAUC;AAChBA,cAAU;AACV,SAAO;AACT;SASgBC,SAAO,GAAY,GAAY,GAAU;AACvD,QAAM,MAAM,IAAID,UAAQ,CAAC;AACzB,MAAI,MAAM,QAAW;AACnB,QAAI,CAAC,IAAI;AACT,QAAI,MAAM,QAAW;AACnB,UAAI,CAAC,IAAI;AACT,UAAI,MAAM,QAAW;AACnB,YAAI,CAAC,IAAI;MACV;IACF;EACF;AACD,SAAO;AACT;AGnCM,SAAUE,MAAI,GAAW,GAAW,GAAW,KAAU;AAC7D,QAAM,OAAO,IAAIF,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AAET,SAAO;AACT;AAQgB,SAAAG,OAAK,GAAS,KAAU;AACtC,QAAM,OAAO,IAAIH,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC,CAAC;AACvB,MAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC,CAAC;AACvB,MAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC,CAAC;AAEvB,SAAO;AACT;AAQgB,SAAAI,QAAM,GAAS,KAAU;AACvC,QAAM,OAAO,IAAIJ,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AACxB,MAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AACxB,MAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AAExB,SAAO;AACT;AAQgB,SAAAK,QAAM,GAAS,KAAU;AACvC,QAAM,OAAO,IAAIL,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AACxB,MAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AACxB,MAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AAExB,SAAO;AACT;AAUgB,SAAAM,QAAM,GAAS,MAAM,GAAG,MAAM,GAAG,KAAU;AACzD,QAAM,OAAO,IAAIN,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC;AAC1C,MAAI,CAAC,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC;AAC1C,MAAI,CAAC,IAAI,KAAK,IAAI,KAAK,KAAK,IAAI,KAAK,EAAE,CAAC,CAAC,CAAC;AAE1C,SAAO;AACT;SASgBO,MAAI,GAAS,GAAS,KAAU;AAC9C,QAAM,OAAO,IAAIP,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AAEnB,SAAO;AACT;AAUM,SAAUQ,YAAU,GAAS,GAAS,OAAe,KAAU;AACnE,QAAM,OAAO,IAAIR,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI;AACvB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI;AACvB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI;AAEvB,SAAO;AACT;AAQgB,SAAAS,QAAM,GAAS,GAAO;AACpC,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAClD,QAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAClD,QAAM,MAAM,OAAO;AACnB,QAAM,SAAS,OAAOC,MAAI,GAAG,CAAC,IAAI;AAClC,SAAO,KAAK,KAAK,MAAM;AACzB;SASgBC,WAAS,GAAS,GAAS,KAAU;AACnD,QAAM,OAAO,IAAIX,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AAEnB,SAAO;AACT;AAiBgB,SAAAY,sBAAoB,GAAS,GAAO;AAClD,SAAO,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIC,WACxB,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIA,WACxB,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIA;AACjC;AAQgB,SAAAC,SAAO,GAAS,GAAO;AACrC,SAAO,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,CAAC;AACvD;AAYM,SAAUC,OAAK,GAAS,GAAS,GAAW,KAAU;AAC1D,QAAM,OAAO,IAAIf,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAC/B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAC/B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAE/B,SAAO;AACT;AAYM,SAAUgB,QAAM,GAAS,GAAS,GAAS,KAAU;AACzD,QAAM,OAAO,IAAIhB,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAClC,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAClC,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAElC,SAAO;AACT;SAWgBiB,MAAI,GAAS,GAAS,KAAU;AAC9C,QAAM,OAAO,IAAIjB,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AAC5B,MAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AAC5B,MAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AAE5B,SAAO;AACT;SAWgBkB,MAAI,GAAS,GAAS,KAAU;AAC9C,QAAM,OAAO,IAAIlB,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AAC5B,MAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AAC5B,MAAI,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AAE5B,SAAO;AACT;SASgBmB,YAAU,GAAS,GAAW,KAAU;AACtD,QAAM,OAAO,IAAInB,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAEhB,SAAO;AACT;SAkBgBoB,YAAU,GAAS,GAAW,KAAU;AACtD,QAAM,OAAO,IAAIpB,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAEhB,SAAO;AACT;AAQgB,SAAAqB,UAAQ,GAAS,KAAU;AACzC,QAAM,OAAO,IAAIrB,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,IAAI,EAAE,CAAC;AAChB,MAAI,CAAC,IAAI,IAAI,EAAE,CAAC;AAChB,MAAI,CAAC,IAAI,IAAI,EAAE,CAAC;AAEhB,SAAO;AACT;SAkBgB,MAAM,GAAS,GAAS,KAAU;AAChD,QAAM,OAAO,IAAIA,UAAQ,CAAC;AAE1B,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnC,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnC,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACjC,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AAET,SAAO;AACT;AASgB,SAAAU,MAAI,GAAS,GAAO;AAClC,SAAQ,EAAE,CAAC,IAAI,EAAE,CAAC,IAAM,EAAE,CAAC,IAAI,EAAE,CAAC,IAAM,EAAE,CAAC,IAAI,EAAE,CAAC;AACpD;AAOM,SAAUY,SAAO,GAAO;AAC5B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,SAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C;AAcM,SAAUC,WAAS,GAAO;AAC9B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,SAAO,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;AAegB,SAAAC,WAAS,GAAS,GAAO;AACvC,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AACrB,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AACrB,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AACrB,SAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C;AAgBgB,SAAAC,aAAW,GAAS,GAAO;AACzC,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AACrB,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AACrB,QAAM,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AACrB,SAAO,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;AAgBgB,SAAAC,YAAU,GAAS,KAAU;AAC3C,QAAM,OAAO,IAAI1B,UAAQ,CAAC;AAE1B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,MAAM,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAEjD,MAAI,MAAM,MAAS;AACjB,QAAI,CAAC,IAAI,KAAK;AACd,QAAI,CAAC,IAAI,KAAK;AACd,QAAI,CAAC,IAAI,KAAK;EACf,OAAM;AACL,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;EACV;AAGD,SAAO;AACT;AAQgB,SAAA2B,SAAO,GAAS,KAAU;AACxC,QAAM,OAAO,IAAI3B,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AACb,MAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AACb,MAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AAEb,SAAO;AACT;AASgB,SAAA4B,OAAK,GAAS,KAAU;AACtC,QAAM,OAAO,IAAI5B,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC;AACZ,MAAI,CAAC,IAAI,EAAE,CAAC;AACZ,MAAI,CAAC,IAAI,EAAE,CAAC;AAEZ,SAAO;AACT;SAmBgB6B,WAAS,GAAS,GAAS,KAAU;AACnD,QAAM,OAAO,IAAI7B,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AAEnB,SAAO;AACT;SAoBgB8B,SAAO,GAAS,GAAS,KAAU;AACjD,QAAM,OAAO,IAAI9B,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AAEnB,SAAO;AACT;SAkBgB,OAAO,QAAQ,GAAG,KAAU;AAC1C,QAAM,OAAO,IAAIA,UAAQ,CAAC;AAE1B,QAAMS,SAAQ,KAAK,OAAM,IAAK,IAAI,KAAK;AACvC,QAAM,IAAI,KAAK,OAAM,IAAK,IAAI;AAC9B,QAAM,SAAS,KAAK,KAAK,IAAI,IAAI,CAAC,IAAI;AACtC,MAAI,CAAC,IAAI,KAAK,IAAIA,MAAK,IAAI;AAC3B,MAAI,CAAC,IAAI,KAAK,IAAIA,MAAK,IAAI;AAC3B,MAAI,CAAC,IAAI,IAAI;AAEb,SAAO;AACT;AAOM,SAAUsB,OAAK,KAAU;AAC7B,QAAM,OAAO,IAAI/B,UAAQ,CAAC;AAE1B,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AAET,SAAO;AACT;SAUgBgC,gBAAc,GAAS,GAAS,KAAU;AACxD,QAAM,OAAO,IAAIhC,UAAQ,CAAC;AAE1B,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAK,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,EAAE,IAAI,IAAI,EAAE,EAAE,KAAM;AAEvD,MAAI,CAAC,KAAK,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,EAAE,KAAK;AACpD,MAAI,CAAC,KAAK,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,EAAE,KAAK;AACpD,MAAI,CAAC,KAAK,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,EAAE,IAAI,IAAI,EAAE,EAAE,KAAK;AAErD,SAAO;AACT;SASgB,sBAAsB,GAAS,GAAS,KAAU;AAChE,QAAM,OAAO,IAAIA,UAAQ,CAAC;AAE1B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,MAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AACjE,MAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AACjE,MAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAEjE,SAAO;AACT;SAUgB,cAAc,GAAS,GAAS,KAAU;AACxD,QAAM,OAAO,IAAIA,UAAQ,CAAC;AAE1B,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAI,EAAE,CAAC;AAEb,MAAI,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC;AACtC,MAAI,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC;AACtC,MAAI,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,EAAE;AAEvC,SAAO;AACT;SASgB,cAAc,GAAS,GAAS,KAAU;AACxD,QAAM,OAAO,IAAIA,UAAQ,CAAC;AAE1B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC,IAAI;AAElB,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAI,EAAE,CAAC;AACb,QAAM,IAAI,EAAE,CAAC;AAEb,QAAM,MAAM,KAAK,IAAI,KAAK;AAC1B,QAAM,MAAM,KAAK,IAAI,KAAK;AAC1B,QAAM,MAAM,KAAK,IAAI,KAAK;AAE1B,MAAI,CAAC,IAAI,IAAI,MAAM,MAAM,KAAK,MAAM,KAAK,OAAO;AAChD,MAAI,CAAC,IAAI,IAAI,MAAM,MAAM,KAAK,MAAM,KAAK,OAAO;AAChD,MAAI,CAAC,IAAI,IAAI,MAAM,MAAM,KAAK,MAAM,KAAK,OAAO;AAEhD,SAAO;AACT;AASgB,SAAAiC,iBAAe,GAAS,KAAU;AAC9C,QAAM,OAAO,IAAIjC,UAAQ,CAAC;AAC1B,MAAI,CAAC,IAAI,EAAE,EAAE;AACb,MAAI,CAAC,IAAI,EAAE,EAAE;AACb,MAAI,CAAC,IAAI,EAAE,EAAE;AACb,SAAO;AACX;SAOgBkC,UAAQ,GAAS,MAAc,KAAU;AACrD,QAAM,OAAO,IAAIlC,UAAQ,CAAC;AAC1B,QAAM,MAAM,OAAO;AACnB,MAAI,CAAC,IAAI,EAAE,MAAM,CAAC;AAClB,MAAI,CAAC,IAAI,EAAE,MAAM,CAAC;AAClB,MAAI,CAAC,IAAI,EAAE,MAAM,CAAC;AAClB,SAAO;AACX;AAMgB,SAAAmC,aAAW,GAAS,KAAS;AACzC,QAAM,OAAO,IAAInC,UAAQ,CAAC;AAC1B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,EAAE;AACf,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C,SAAO;AACX;AC3uBM,SAAUD,iBAAe,MAA6B;AAC1D,QAAM,UAAU;AAChB,YAAU;AACV,SAAO;AACT;AA2CgB,SAAAE,SACZ,IAAa,IAAa,IAAa,IACvC,IAAa,IAAa,IAAa,IACvC,IAAa,IAAa,KAAc,KACxC,KAAc,KAAc,KAAc,KAAY;AACxD,QAAM,MAAM,IAAI,QAAQ,EAAE;AAC1B,MAAI,OAAO,QAAW;AACpB,QAAI,CAAC,IAAI;AACT,QAAI,OAAO,QAAW;AACpB,UAAI,CAAC,IAAI;AACT,UAAI,OAAO,QAAW;AACpB,YAAI,CAAC,IAAI;AACT,YAAI,OAAO,QAAW;AACpB,cAAI,CAAC,IAAI;AACT,cAAI,OAAO,QAAW;AACpB,gBAAI,CAAC,IAAI;AACT,gBAAI,OAAO,QAAW;AACpB,kBAAI,CAAC,IAAI;AACT,kBAAI,OAAO,QAAW;AACpB,oBAAI,CAAC,IAAI;AACT,oBAAI,OAAO,QAAW;AACpB,sBAAI,CAAC,IAAI;AACT,sBAAI,OAAO,QAAW;AACpB,wBAAI,CAAC,IAAI;AACT,wBAAI,OAAO,QAAW;AACpB,0BAAI,CAAC,IAAI;AACT,0BAAI,QAAQ,QAAW;AACrB,4BAAI,EAAE,IAAI;AACV,4BAAI,QAAQ,QAAW;AACrB,8BAAI,EAAE,IAAI;AACV,8BAAI,QAAQ,QAAW;AACrB,gCAAI,EAAE,IAAI;AACV,gCAAI,QAAQ,QAAW;AACrB,kCAAI,EAAE,IAAI;AACV,kCAAI,QAAQ,QAAW;AACrB,oCAAI,EAAE,IAAI;AACV,oCAAI,QAAQ,QAAW;AACrB,sCAAI,EAAE,IAAI;gCACX;8BACF;4BACF;0BACF;wBACF;sBACF;oBACF;kBACF;gBACF;cACF;YACF;UACF;QACF;MACF;IACF;EACF;AACD,SAAO;AACT;AAyBgB,SAAAC,MACZ,IAAY,IAAY,IAAY,IACpC,IAAY,IAAY,IAAY,IACpC,IAAY,IAAY,KAAa,KACrC,KAAa,KAAa,KAAa,KACvC,KAAU;AACZ,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAC1D,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAC1D,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAC1D,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAE1D,SAAO;AACT;AAQgB,SAAA,SAAS,IAAU,KAAU;AAC3C,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI,GAAG,CAAC;AAAI,MAAK,CAAC,IAAI,GAAG,CAAC;AAAI,MAAK,CAAC,IAAI,GAAI,CAAC;AAAI,MAAK,CAAC,IAAI;AACjE,MAAK,CAAC,IAAI,GAAG,CAAC;AAAI,MAAK,CAAC,IAAI,GAAG,CAAC;AAAI,MAAK,CAAC,IAAI,GAAI,CAAC;AAAI,MAAK,CAAC,IAAI;AACjE,MAAK,CAAC,IAAI,GAAG,CAAC;AAAI,MAAK,CAAC,IAAI,GAAG,CAAC;AAAI,MAAI,EAAE,IAAI,GAAG,EAAE;AAAI,MAAI,EAAE,IAAI;AACjE,MAAI,EAAE,IAAI;AAAQ,MAAI,EAAE,IAAI;AAAQ,MAAI,EAAE,IAAI;AAAS,MAAI,EAAE,IAAI;AAEjE,SAAO;AACT;AAQgB,SAAA,SAAS,GAAS,KAAU;AAC1C,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,IAAI,EAAE,CAAC;AAAG,QAAM,IAAI,EAAE,CAAC;AAAG,QAAM,IAAI,EAAE,CAAC;AAAG,QAAM,IAAI,EAAE,CAAC;AAC7D,QAAM,KAAK,IAAI;AAAG,QAAM,KAAK,IAAI;AAAG,QAAM,KAAK,IAAI;AAEnD,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AAEf,MAAK,CAAC,IAAI,IAAI,KAAK;AAAK,MAAK,CAAC,IAAI,KAAK;AAAS,MAAK,CAAC,IAAI,KAAK;AAAS,MAAK,CAAC,IAAI;AAClF,MAAK,CAAC,IAAI,KAAK;AAAS,MAAK,CAAC,IAAI,IAAI,KAAK;AAAK,MAAK,CAAC,IAAI,KAAK;AAAS,MAAK,CAAC,IAAI;AAClF,MAAK,CAAC,IAAI,KAAK;AAAS,MAAK,CAAC,IAAI,KAAK;AAAS,MAAI,EAAE,IAAI,IAAI,KAAK;AAAK,MAAI,EAAE,IAAI;AAClF,MAAI,EAAE,IAAI;AAAc,MAAI,EAAE,IAAI;AAAc,MAAI,EAAE,IAAI;AAAc,MAAI,EAAE,IAAI;AAElF,SAAO;AACT;AAQgB,SAAAyB,SAAO,GAAS,KAAU;AACxC,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AACxE,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AACxE,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,CAAC,EAAG,CAAC;AAAI,MAAI,EAAE,IAAI,CAAC,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,CAAC,EAAE,EAAE;AACxE,MAAI,EAAE,IAAI,CAAC,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,CAAC,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,CAAC,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,CAAC,EAAE,EAAE;AAExE,SAAO;AACT;AASgB,SAAAC,OAAK,GAAS,KAAU;AACtC,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AACpE,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AACpE,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAK,CAAC,IAAI,EAAG,CAAC;AAAI,MAAI,EAAE,IAAI,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,EAAE,EAAE;AACpE,MAAI,EAAE,IAAI,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,EAAE,EAAE;AAAI,MAAI,EAAE,IAAI,EAAE,EAAE;AAEpE,SAAO;AACT;AAiBgB,SAAAhB,sBAAoB,GAAS,GAAO;AAClD,SAAO,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIC,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAG,CAAC,IAAI,EAAG,CAAC,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,IAAIA,WAC1B,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,IAAIA;AACnC;AAQgB,SAAAC,SAAO,GAAS,GAAO;AACrC,SAAO,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAG,CAAC,MAAM,EAAG,CAAC,KACd,EAAE,EAAE,MAAM,EAAE,EAAE,KACd,EAAE,EAAE,MAAM,EAAE,EAAE,KACd,EAAE,EAAE,MAAM,EAAE,EAAE,KACd,EAAE,EAAE,MAAM,EAAE,EAAE,KACd,EAAE,EAAE,MAAM,EAAE,EAAE,KACd,EAAE,EAAE,MAAM,EAAE,EAAE;AACvB;AAQM,SAAUsB,WAAS,KAAU;AACjC,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACpD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACpD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AACpD,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAEpD,SAAO;AACT;AAQgB,SAAA,UAAU,GAAS,KAAU;AAC3C,QAAM,OAAO,IAAI,QAAQ,EAAE;AAC3B,MAAI,QAAQ,GAAG;AACb,QAAI;AAEJ,QAAI,EAAE,CAAC;AACP,MAAE,CAAC,IAAI,EAAE,CAAC;AACV,MAAE,CAAC,IAAI;AAEP,QAAI,EAAE,CAAC;AACP,MAAE,CAAC,IAAI,EAAE,CAAC;AACV,MAAE,CAAC,IAAI;AAEP,QAAI,EAAE,CAAC;AACP,MAAE,CAAC,IAAI,EAAE,EAAE;AACX,MAAE,EAAE,IAAI;AAER,QAAI,EAAE,CAAC;AACP,MAAE,CAAC,IAAI,EAAE,CAAC;AACV,MAAE,CAAC,IAAI;AAEP,QAAI,EAAE,CAAC;AACP,MAAE,CAAC,IAAI,EAAE,EAAE;AACX,MAAE,EAAE,IAAI;AAER,QAAI,EAAE,EAAE;AACR,MAAE,EAAE,IAAI,EAAE,EAAE;AACZ,MAAE,EAAE,IAAI;AACR,WAAO;EACR;AAED,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AAEvB,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAC1D,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAC1D,MAAK,CAAC,IAAI;AAAM,MAAK,CAAC,IAAI;AAAM,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAC1D,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAAM,MAAI,EAAE,IAAI;AAE1D,SAAO;AACT;AAQgB,SAAAf,UAAQ,GAAS,KAAU;AACzC,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AAEpB,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,OAAO,OACxC,OAAO,MAAM,OAAO,MAAM,OAAO;AACtC,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,OAAO,OACxC,OAAO,MAAM,OAAO,MAAM,OAAO;AACtC,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,OACzC,OAAO,MAAM,OAAO,MAAM,QAAQ;AACvC,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,OACzC,OAAO,MAAM,OAAO,MAAM,QAAQ;AAEvC,QAAM,IAAI,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM;AAEtD,MAAK,CAAC,IAAI,IAAI;AACd,MAAK,CAAC,IAAI,IAAI;AACd,MAAK,CAAC,IAAI,IAAI;AACd,MAAK,CAAC,IAAI,IAAI;AACd,MAAK,CAAC,IAAI,KAAM,OAAO,MAAM,OAAO,MAAM,OAAO,OACxC,OAAO,MAAM,OAAO,MAAM,OAAO;AAC1C,MAAK,CAAC,IAAI,KAAM,OAAO,MAAM,OAAO,MAAM,OAAO,OACxC,OAAO,MAAM,OAAO,MAAM,OAAO;AAC1C,MAAK,CAAC,IAAI,KAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,OACzC,OAAO,MAAM,OAAO,MAAM,QAAQ;AAC3C,MAAK,CAAC,IAAI,KAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,OACzC,OAAO,MAAM,OAAO,MAAM,QAAQ;AAC3C,MAAK,CAAC,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAK,CAAC,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAI,EAAE,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAI,EAAE,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAI,EAAE,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAI,EAAE,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAI,EAAE,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAC7C,MAAI,EAAE,IAAI,KAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ,OAC3C,QAAQ,MAAM,QAAQ,MAAM,QAAQ;AAE7C,SAAO;AACT;AAOM,SAAU,YAAY,GAAO;AACjC,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AAEvB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,OAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AACpB,QAAM,QAAQ,MAAM;AAEpB,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,OAAO,OACjC,OAAO,MAAM,OAAO,MAAM,OAAO;AAC7C,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,OAAO,OACjC,OAAO,MAAM,OAAO,MAAM,OAAO;AAC7C,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,OAClC,OAAO,MAAM,OAAO,MAAM,QAAQ;AAC9C,QAAM,KAAM,OAAO,MAAM,OAAO,MAAM,QAAQ,OAClC,OAAO,MAAM,OAAO,MAAM,QAAQ;AAE9C,SAAO,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM;AAChD;SAiBgBQ,WAAS,GAAS,GAAS,KAAU;AACnD,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAG,IAAI,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AACpB,QAAM,MAAM,EAAE,KAAK,CAAC;AAEpB,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AACpD,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM;AAEpD,SAAO;AACT;SAmBgB,eAAe,GAAS,GAAS,KAAU;AACzD,QAAM,OAAOO,WAAQ;AACrB,MAAI,MAAM,KAAK;AACb,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AACD,MAAI,EAAE,IAAI,EAAE,CAAC;AACb,MAAI,EAAE,IAAI,EAAE,CAAC;AACb,MAAI,EAAE,IAAI,EAAE,CAAC;AACb,MAAI,EAAE,IAAI;AACV,SAAO;AACT;AASgB,SAAA,eAAe,GAAS,KAAU;AAChD,QAAM,OAAOC,SAAW;AACxB,MAAI,CAAC,IAAI,EAAE,EAAE;AACb,MAAI,CAAC,IAAI,EAAE,EAAE;AACb,MAAI,CAAC,IAAI,EAAE,EAAE;AACb,SAAO;AACT;SAQgB,QAAQ,GAAS,MAAc,KAAU;AACvD,QAAM,OAAOA,SAAW;AACxB,QAAM,MAAM,OAAO;AACnB,MAAI,CAAC,IAAI,EAAE,MAAM,CAAC;AAClB,MAAI,CAAC,IAAI,EAAE,MAAM,CAAC;AAClB,MAAI,CAAC,IAAI,EAAE,MAAM,CAAC;AAClB,SAAO;AACT;AAUM,SAAU,QAAQ,GAAS,GAAS,MAAc,KAAS;AAC/D,MAAI,QAAQ,GAAG;AACb,UAAMT,OAAK,GAAG,GAAG;EAClB;AACD,QAAM,MAAM,OAAO;AACnB,MAAI,MAAM,CAAC,IAAI,EAAE,CAAC;AAClB,MAAI,MAAM,CAAC,IAAI,EAAE,CAAC;AAClB,MAAI,MAAM,CAAC,IAAI,EAAE,CAAC;AAClB,SAAO;AACT;AAOgB,SAAA,WAAW,GAAS,KAAU;AAC5C,QAAM,OAAOS,SAAW;AAExB,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,EAAE;AAEf,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAE9C,SAAO;AACT;AA2BM,SAAU,YAAY,uBAA+B,QAAgB,OAAe,MAAc,KAAU;AAChH,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,IAAI,KAAK,IAAI,KAAK,KAAK,MAAM,MAAM,qBAAqB;AAE9D,MAAI,CAAC,IAAK,IAAI;AACd,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AAEV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AAEV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AACV,MAAI,EAAE,IAAI;AAEV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AAEV,MAAI,SAAS,UAAU;AACrB,QAAI,EAAE,IAAI;AACV,QAAI,EAAE,IAAI,CAAC;EACZ,OAAM;AACL,UAAM,WAAW,KAAK,QAAQ;AAC9B,QAAI,EAAE,IAAI,OAAO;AACjB,QAAI,EAAE,IAAI,OAAO,QAAQ;EAC1B;AAED,SAAO;AACT;AAiBgB,SAAA,MAAM,MAAc,OAAe,QAAgB,KAAa,MAAc,KAAa,KAAU;AACnH,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAI,CAAC,IAAK,KAAK,QAAQ;AACvB,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AAEV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK,KAAK,MAAM;AACrB,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AAEV,MAAI,CAAC,IAAK;AACV,MAAI,CAAC,IAAK;AACV,MAAI,EAAE,IAAI,KAAK,OAAO;AACtB,MAAI,EAAE,IAAI;AAEV,MAAI,EAAE,KAAK,QAAQ,SAAS,OAAO;AACnC,MAAI,EAAE,KAAK,MAAM,WAAW,SAAS;AACrC,MAAI,EAAE,IAAI,QAAQ,OAAO;AACzB,MAAI,EAAE,IAAI;AAEV,SAAO;AACT;AAoBgB,SAAA,QAAQ,MAAc,OAAe,QAAgB,KAAa,MAAc,KAAa,KAAU;AACrH,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,KAAM,QAAQ;AACpB,QAAM,KAAM,MAAM;AAClB,QAAM,KAAM,OAAO;AAEnB,MAAK,CAAC,IAAI,IAAI,OAAO;AACrB,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI,IAAI,OAAO;AACrB,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,KAAK,OAAO,SAAS;AAC3B,MAAK,CAAC,KAAK,MAAM,UAAU;AAC3B,MAAI,EAAE,IAAI,MAAM;AAChB,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI,OAAO,MAAM;AACvB,MAAI,EAAE,IAAI;AAEV,SAAO;AACT;AAoBM,SAAU,IAAI,UAAgB,QAAc,IAAU,KAAU;AACpE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,UAAQ,SAASA,SAAW;AAC5B,UAAQ,SAASA,SAAW;AAC5B,UAAQ,SAASA,SAAW;AAE5BC,cAAeC,WAAc,QAAQ,UAAU,KAAK,GAAG,KAAK;AAC5DD,cAAeE,MAAW,IAAI,OAAO,KAAK,GAAG,KAAK;AAClDF,cAAeE,MAAW,OAAO,OAAO,KAAK,GAAG,KAAK;AAErD,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI;AAClF,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI;AAClF,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAI,EAAE,IAAI,MAAM,CAAC;AAAO,MAAI,EAAE,IAAI;AAClF,MAAI,EAAE,IAAI,SAAS,CAAC;AAAI,MAAI,EAAE,IAAI,SAAS,CAAC;AAAI,MAAI,EAAE,IAAI,SAAS,CAAC;AAAI,MAAI,EAAE,IAAI;AAElF,SAAO;AACT;AAgBM,SAAU,UAAU,KAAW,QAAc,IAAU,KAAU;AACrE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,UAAQ,SAASH,SAAW;AAC5B,UAAQ,SAASA,SAAW;AAC5B,UAAQ,SAASA,SAAW;AAE5BC,cAAeC,WAAc,KAAK,QAAQ,KAAK,GAAG,KAAK;AACvDD,cAAeE,MAAW,IAAI,OAAO,KAAK,GAAG,KAAK;AAClDF,cAAeE,MAAW,OAAO,OAAO,KAAK,GAAG,KAAK;AAErD,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI;AAClF,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI;AAClF,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAK,CAAC,IAAI,MAAM,CAAC;AAAO,MAAI,EAAE,IAAI,MAAM,CAAC;AAAO,MAAI,EAAE,IAAI;AAClF,MAAI,EAAE,IAAI,IAAI,CAAC;AAAI,MAAI,EAAE,IAAI,IAAI,CAAC;AAAI,MAAI,EAAE,IAAI,IAAI,CAAC;AAAI,MAAI,EAAE,IAAI;AAEnE,SAAO;AACT;AAcM,SAAU,OAAO,KAAW,QAAc,IAAU,KAAU;AAClE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,UAAQ,SAASH,SAAW;AAC5B,UAAQ,SAASA,SAAW;AAC5B,UAAQ,SAASA,SAAW;AAE5BC,cAAeC,WAAc,KAAK,QAAQ,KAAK,GAAG,KAAK;AACvDD,cAAeE,MAAW,IAAI,OAAO,KAAK,GAAG,KAAK;AAClDF,cAAeE,MAAW,OAAO,OAAO,KAAK,GAAG,KAAK;AAErD,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI;AACzE,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI;AACzE,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAK,CAAC,IAAI,MAAM,CAAC;AAAI,MAAI,EAAE,IAAI,MAAM,CAAC;AAAI,MAAI,EAAE,IAAI;AAEzE,MAAI,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC;AACpE,MAAI,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC;AACpE,MAAI,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,IAAI,CAAC;AACpE,MAAI,EAAE,IAAI;AAEV,SAAO;AACT;AASgB,SAAA,YAAY,GAAS,KAAU;AAC7C,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAC7D,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAC7D,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAI,EAAE,IAAI;AAAO,MAAI,EAAE,IAAI;AAC7D,MAAI,EAAE,IAAI,EAAE,CAAC;AAAI,MAAI,EAAE,IAAI,EAAE,CAAC;AAAI,MAAI,EAAE,IAAI,EAAE,CAAC;AAAI,MAAI,EAAE,IAAI;AAE7D,SAAO;AACT;SAUgB,UAAU,GAAS,GAAS,KAAU;AACpD,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AAEvB,MAAI,MAAM,KAAK;AACb,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAK,CAAC,IAAI;AACV,QAAI,EAAE,IAAI;AACV,QAAI,EAAE,IAAI;EACX;AAED,MAAI,EAAE,IAAI,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK;AAC3C,MAAI,EAAE,IAAI,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK;AAC3C,MAAI,EAAE,IAAI,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK;AAC3C,MAAI,EAAE,IAAI,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK;AAE3C,SAAO;AACT;AAQgB,SAAA,UAAU,gBAAwB,KAAU;AAC1D,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AAEjC,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAK;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACrD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAK;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACrD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI,CAAC;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AACrD,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAK;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAErD,SAAO;AACT;SAUgBC,UAAQ,GAAS,gBAAwB,KAAU;AACjE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,EAAE;AAChB,QAAM,MAAM,EAAE,EAAE;AAChB,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AAEjC,MAAI,CAAC,IAAK,IAAI,MAAM,IAAI;AACxB,MAAI,CAAC,IAAK,IAAI,MAAM,IAAI;AACxB,MAAI,CAAC,IAAK,IAAI,MAAM,IAAI;AACxB,MAAI,CAAC,IAAK,IAAI,MAAM,IAAI;AACxB,MAAI,CAAC,IAAK,IAAI,MAAM,IAAI;AACxB,MAAI,CAAC,IAAK,IAAI,MAAM,IAAI;AACxB,MAAI,EAAE,IAAI,IAAI,MAAM,IAAI;AACxB,MAAI,EAAE,IAAI,IAAI,MAAM,IAAI;AAExB,MAAI,MAAM,KAAK;AACb,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AAED,SAAO;AACT;AAQgB,SAAA,UAAU,gBAAwB,KAAU;AAC1D,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AAEjC,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI,CAAC;AAAI,MAAK,CAAC,IAAI;AACrD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAK;AAAI,MAAK,CAAC,IAAI;AACrD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAI,EAAE,IAAK;AAAI,MAAI,EAAE,IAAI;AACrD,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAK;AAAI,MAAI,EAAE,IAAI;AAErD,SAAO;AACT;SAUgBC,UAAQ,GAAS,gBAAwB,KAAU;AACjE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AAEjC,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAI,EAAE,IAAI,IAAI,MAAM,IAAI;AACxB,MAAI,EAAE,IAAI,IAAI,MAAM,IAAI;AAExB,MAAI,MAAM,KAAK;AACb,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AAED,SAAO;AACT;AAQgB,SAAA,UAAU,gBAAwB,KAAU;AAC1D,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AAEjC,MAAK,CAAC,IAAK;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACrD,MAAK,CAAC,IAAI,CAAC;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACrD,MAAK,CAAC,IAAK;AAAI,MAAK,CAAC,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AACrD,MAAI,EAAE,IAAK;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAErD,SAAO;AACT;SAUgBC,UAAQ,GAAS,gBAAwB,KAAU;AACjE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,MAAM,EAAE,IAAI,IAAI,CAAC;AACvB,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AAEjC,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AACxB,MAAK,CAAC,IAAI,IAAI,MAAM,IAAI;AAExB,MAAI,MAAM,KAAK;AACb,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAK,CAAC,IAAI,EAAG,CAAC;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AAED,SAAO;AACT;SAYgB,aAAa,MAAY,gBAAwB,KAAU;AACzE,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAI,IAAI,KAAK,CAAC;AACd,MAAI,IAAI,KAAK,CAAC;AACd,MAAI,IAAI,KAAK,CAAC;AACd,QAAM,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC;AACzC,OAAK;AACL,OAAK;AACL,OAAK;AACL,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,iBAAiB,IAAI;AAE3B,MAAK,CAAC,IAAI,MAAM,IAAI,MAAM;AAC1B,MAAK,CAAC,IAAI,IAAI,IAAI,iBAAiB,IAAI;AACvC,MAAK,CAAC,IAAI,IAAI,IAAI,iBAAiB,IAAI;AACvC,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI,IAAI,IAAI,iBAAiB,IAAI;AACvC,MAAK,CAAC,IAAI,MAAM,IAAI,MAAM;AAC1B,MAAK,CAAC,IAAI,IAAI,IAAI,iBAAiB,IAAI;AACvC,MAAK,CAAC,IAAI;AACV,MAAK,CAAC,IAAI,IAAI,IAAI,iBAAiB,IAAI;AACvC,MAAK,CAAC,IAAI,IAAI,IAAI,iBAAiB,IAAI;AACvC,MAAI,EAAE,IAAI,MAAM,IAAI,MAAM;AAC1B,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AACV,MAAI,EAAE,IAAI;AAEV,SAAO;AACT;AAwBM,SAAU,WAAW,GAAS,MAAY,gBAAwB,KAAU;AAChF,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAI,IAAI,KAAK,CAAC;AACd,MAAI,IAAI,KAAK,CAAC;AACd,MAAI,IAAI,KAAK,CAAC;AACd,QAAM,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC;AACzC,OAAK;AACL,OAAK;AACL,OAAK;AACL,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,KAAK,IAAI;AACf,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,IAAI,KAAK,IAAI,cAAc;AACjC,QAAM,iBAAiB,IAAI;AAE3B,QAAM,MAAM,MAAM,IAAI,MAAM;AAC5B,QAAM,MAAM,IAAI,IAAI,iBAAiB,IAAI;AACzC,QAAM,MAAM,IAAI,IAAI,iBAAiB,IAAI;AACzC,QAAM,MAAM,IAAI,IAAI,iBAAiB,IAAI;AACzC,QAAM,MAAM,MAAM,IAAI,MAAM;AAC5B,QAAM,MAAM,IAAI,IAAI,iBAAiB,IAAI;AACzC,QAAM,MAAM,IAAI,IAAI,iBAAiB,IAAI;AACzC,QAAM,MAAM,IAAI,IAAI,iBAAiB,IAAI;AACzC,QAAM,MAAM,MAAM,IAAI,MAAM;AAE5B,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,CAAC;AACf,QAAM,MAAM,EAAE,EAAE;AAChB,QAAM,MAAM,EAAE,EAAE;AAEhB,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAK,CAAC,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AACxC,MAAI,EAAE,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM;AAExC,MAAI,MAAM,KAAK;AACb,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AAED,SAAO;AACT;AAuBgB,SAAA,QAAQ,GAAS,KAAU;AACzC,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI,EAAE,CAAC;AAAI,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAC7D,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI,EAAE,CAAC;AAAI,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAC7D,MAAK,CAAC,IAAI;AAAO,MAAK,CAAC,IAAI;AAAO,MAAI,EAAE,IAAI,EAAE,CAAC;AAAI,MAAI,EAAE,IAAI;AAC7D,MAAI,EAAE,IAAI;AAAO,MAAI,EAAE,IAAI;AAAO,MAAI,EAAE,IAAI;AAAO,MAAI,EAAE,IAAI;AAE7D,SAAO;AACT;SAYgBC,QAAM,GAAS,GAAS,KAAU;AAChD,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAK,CAAC,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAI,EAAE,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAC1B,MAAI,EAAE,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC;AAE1B,MAAI,MAAM,KAAK;AACb,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AAED,SAAO;AACT;AAQgB,SAAA,eAAe,GAAW,KAAU;AAClD,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACpD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AACpD,MAAK,CAAC,IAAI;AAAI,MAAK,CAAC,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AACpD,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAAI,MAAI,EAAE,IAAI;AAEpD,SAAO;AACT;SASgB,aAAa,GAAS,GAAW,KAAU;AACzD,QAAM,OAAO,IAAI,QAAQ,EAAE;AAE3B,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAK,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAI,EAAE,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AACzB,MAAI,EAAE,IAAI,IAAI,EAAE,IAAI,IAAI,CAAC;AAEzB,MAAI,MAAM,KAAK;AACb,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;AACd,QAAI,EAAE,IAAI,EAAE,EAAE;EACf;AAED,SAAO;AACT;ACj6CM,SAAU7C,iBAAe,MAA6B;AAC1D,QAAM,UAAU;AAChB,aAAW;AACX,SAAO;AACT;AAUM,SAAUE,SAAO,GAAY,GAAY,GAAY,GAAU;AACnE,QAAM,MAAM,IAAI,SAAS,CAAC;AAC1B,MAAI,MAAM,QAAW;AACnB,QAAI,CAAC,IAAI;AACT,QAAI,MAAM,QAAW;AACnB,UAAI,CAAC,IAAI;AACT,UAAI,MAAM,QAAW;AACnB,YAAI,CAAC,IAAI;AACT,YAAI,MAAM,QAAW;AACnB,cAAI,CAAC,IAAI;QACV;MACF;IACF;EACF;AACD,SAAO;AACT;AClCM,SAAUC,MAAI,GAAW,GAAW,GAAW,GAAW,KAAU;AACxE,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AAET,SAAO;AACT;SAWgB,cAAc,MAAY,gBAAwB,KAAU;AAC1E,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,YAAY,iBAAiB;AACnC,QAAM,IAAI,KAAK,IAAI,SAAS;AAE5B,MAAI,CAAC,IAAI,IAAI,KAAK,CAAC;AACnB,MAAI,CAAC,IAAI,IAAI,KAAK,CAAC;AACnB,MAAI,CAAC,IAAI,IAAI,KAAK,CAAC;AACnB,MAAI,CAAC,IAAI,KAAK,IAAI,SAAS;AAE3B,SAAO;AACT;AAQgB,SAAA,YAAY,GAAS,KAAU;AAC7C,QAAM,OAAOmC,SAAY,CAAC;AAE1B,QAAM5B,SAAQ,KAAK,KAAK,EAAE,CAAC,CAAC,IAAI;AAChC,QAAM,IAAI,KAAK,IAAIA,SAAQ,GAAG;AAC9B,MAAI,IAAII,SAAe;AACrB,QAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,QAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,QAAI,CAAC,IAAI,EAAE,CAAC,IAAI;EACjB,OAAM;AACL,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;EACV;AAED,SAAO,EAAE,OAAAJ,QAAO,MAAM,IAAG;AAC3B;AAQgB,SAAA,MAAM,GAAS,GAAO;AACpC,QAAM,IAAIC,MAAI,GAAG,CAAC;AAClB,SAAO,KAAK,KAAK,IAAI,IAAI,IAAI,CAAC;AAChC;SAUgBmB,WAAS,GAAS,GAAS,KAAU;AACnD,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAC5C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAC5C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAC5C,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAE5C,SAAO;AACT;SAmBgB,QAAQ,GAAS,gBAAwB,KAAU;AACjE,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,YAAY,iBAAiB;AAEnC,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,QAAM,KAAK,KAAK,IAAI,SAAS;AAC7B,QAAM,KAAK,KAAK,IAAI,SAAS;AAE7B,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AAExB,SAAO;AACT;SASgB,QAAQ,GAAS,gBAAwB,KAAU;AACjE,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,YAAY,iBAAiB;AAEnC,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,QAAM,KAAK,KAAK,IAAI,SAAS;AAC7B,QAAM,KAAK,KAAK,IAAI,SAAS;AAE7B,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AAExB,SAAO;AACT;SASgB,QAAQ,GAAS,gBAAwB,KAAU;AACjE,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,YAAY,iBAAiB;AAEnC,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,QAAM,KAAK,KAAK,IAAI,SAAS;AAC7B,QAAM,KAAK,KAAK,IAAI,SAAS;AAE7B,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AACxB,MAAI,CAAC,IAAI,KAAK,KAAK,KAAK;AAExB,SAAO;AACT;AAWM,SAAU,MAAM,GAAS,GAAS,GAAW,KAAU;AAC3D,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,MAAI,KAAK,EAAE,CAAC;AACZ,MAAI,KAAK,EAAE,CAAC;AACZ,MAAI,KAAK,EAAE,CAAC;AACZ,MAAI,KAAK,EAAE,CAAC;AAEZ,MAAI,WAAW,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAElD,MAAI,WAAW,GAAG;AAChB,eAAW,CAAC;AACZ,SAAK,CAAC;AACN,SAAK,CAAC;AACN,SAAK,CAAC;AACN,SAAK,CAAC;EACP;AAED,MAAI;AACJ,MAAI;AAEJ,MAAI,IAAM,WAAWhB,SAAe;AAClC,UAAM,QAAQ,KAAK,KAAK,QAAQ;AAChC,UAAM,WAAW,KAAK,IAAI,KAAK;AAC/B,aAAS,KAAK,KAAK,IAAI,KAAK,KAAK,IAAI;AACrC,aAAS,KAAK,IAAI,IAAI,KAAK,IAAI;EAChC,OAAM;AACL,aAAS,IAAM;AACf,aAAS;EACV;AAED,MAAI,CAAC,IAAI,SAAS,KAAK,SAAS;AAChC,MAAI,CAAC,IAAI,SAAS,KAAK,SAAS;AAChC,MAAI,CAAC,IAAI,SAAS,KAAK,SAAS;AAChC,MAAI,CAAC,IAAI,SAAS,KAAK,SAAS;AAEhC,SAAO;AACT;AAQgB,SAAAQ,UAAQ,GAAS,KAAU;AACzC,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AAEd,QAAM,MAAM,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAC/C,QAAM,SAAS,MAAM,IAAI,MAAM;AAE/B,MAAI,CAAC,IAAI,CAAC,KAAK;AACf,MAAI,CAAC,IAAI,CAAC,KAAK;AACf,MAAI,CAAC,IAAI,CAAC,KAAK;AACf,MAAI,CAAC,IAAK,KAAK;AAEf,SAAO;AACT;AAWgB,SAAA,UAAU,GAAS,KAAU;AAC3C,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AACb,MAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AACb,MAAI,CAAC,IAAI,CAAC,EAAE,CAAC;AACb,MAAI,CAAC,IAAK,EAAE,CAAC;AAEb,SAAO;AACT;AAWgB,SAAA,QAAQ,GAAgB,KAAU;AAChD,QAAM,OAAO,IAAI,SAAS,CAAC;AAc3B,QAAM,QAAQ,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,EAAE;AAEhC,MAAI,QAAQ,GAAK;AAEf,UAAM,OAAO,KAAK,KAAK,QAAQ,CAAC;AAChC,QAAI,CAAC,IAAI,MAAM;AACf,UAAM,UAAU,MAAM;AAEtB,QAAI,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK;AACzB,QAAI,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK;AACzB,QAAI,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK;EAC1B,OAAM;AAEL,QAAI,IAAI;AAER,QAAI,EAAE,CAAC,IAAI,EAAE,CAAC,GAAG;AACf,UAAI;IACL;AACD,QAAI,EAAE,EAAE,IAAI,EAAE,IAAI,IAAI,CAAC,GAAG;AACxB,UAAI;IACL;AAED,UAAM,KAAK,IAAI,KAAK;AACpB,UAAM,KAAK,IAAI,KAAK;AAEpB,UAAM,OAAO,KAAK,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,IAAI,CAAG;AACvE,QAAI,CAAC,IAAI,MAAM;AAEf,UAAM,UAAU,MAAM;AAEtB,QAAI,CAAC,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,KAAK;AACzC,QAAI,CAAC,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,KAAK;AACzC,QAAI,CAAC,KAAK,EAAE,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC,KAAK;EAC1C;AAED,SAAO;AACT;AAYM,SAAU,UACZ,iBACA,iBACA,iBACA,OACA,KAAU;AACZ,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,aAAa,kBAAkB;AACrC,QAAM,aAAa,kBAAkB;AACrC,QAAM,aAAa,kBAAkB;AAErC,QAAM,KAAK,KAAK,IAAI,UAAU;AAC9B,QAAM,KAAK,KAAK,IAAI,UAAU;AAC9B,QAAM,KAAK,KAAK,IAAI,UAAU;AAC9B,QAAM,KAAK,KAAK,IAAI,UAAU;AAC9B,QAAM,KAAK,KAAK,IAAI,UAAU;AAC9B,QAAM,KAAK,KAAK,IAAI,UAAU;AAE9B,UAAQ,OAAK;IACX,KAAK;AACH,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;IAEF,KAAK;AACH,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;IAEF,KAAK;AACH,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;IAEF,KAAK;AACH,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;IAEF,KAAK;AACH,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;IAEF,KAAK;AACH,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClC;IAEF;AACE,YAAM,IAAI,MAAM,2BAA2B,KAAK,EAAE;EACrD;AAED,SAAO;AACT;AASgB,SAAAO,OAAK,GAAS,KAAU;AACtC,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,EAAE,CAAC;AACZ,MAAI,CAAC,IAAI,EAAE,CAAC;AACZ,MAAI,CAAC,IAAI,EAAE,CAAC;AACZ,MAAI,CAAC,IAAI,EAAE,CAAC;AAEZ,SAAO;AACT;SAkBgBrB,MAAI,GAAS,GAAS,KAAU;AAC9C,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AAEnB,SAAO;AACT;SASgBI,WAAS,GAAS,GAAS,KAAU;AACnD,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AACnB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;AAEnB,SAAO;AACT;SAkBgBQ,YAAU,GAAS,GAAW,KAAU;AACtD,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAEhB,SAAO;AACT;SAkBgBC,YAAU,GAAS,GAAW,KAAU;AACtD,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAChB,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI;AAEhB,SAAO;AACT;AAQgB,SAAAV,MAAI,GAAS,GAAO;AAClC,SAAQ,EAAE,CAAC,IAAI,EAAE,CAAC,IAAM,EAAE,CAAC,IAAI,EAAE,CAAC,IAAM,EAAE,CAAC,IAAI,EAAE,CAAC,IAAM,EAAE,CAAC,IAAI,EAAE,CAAC;AACpE;AAYM,SAAUK,OAAK,GAAS,GAAS,GAAW,KAAU;AAC1D,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAC/B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAC/B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAC/B,MAAI,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,EAAE,CAAC;AAE/B,SAAO;AACT;AAOM,SAAUO,SAAO,GAAO;AAC5B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,SAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AACxD;AAcM,SAAUC,WAAS,GAAO;AAC9B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,SAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK;AAC5C;AAegB,SAAAG,YAAU,GAAS,KAAU;AAC3C,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,KAAK,EAAE,CAAC;AACd,QAAM,MAAM,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAE3D,MAAI,MAAM,MAAS;AACjB,QAAI,CAAC,IAAI,KAAK;AACd,QAAI,CAAC,IAAI,KAAK;AACd,QAAI,CAAC,IAAI,KAAK;AACd,QAAI,CAAC,IAAI,KAAK;EACf,OAAM;AACL,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;EACV;AAED,SAAO;AACT;AAQgB,SAAAd,sBAAoB,GAAS,GAAO;AAClD,SAAO,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIC,WACxB,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIA,WACxB,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIA,WACxB,KAAK,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,IAAIA;AACjC;AAQgB,SAAAC,SAAO,GAAS,GAAO;AACrC,SAAO,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,CAAC;AACxE;AAOM,SAAU,SAAS,KAAU;AACjC,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AACT,MAAI,CAAC,IAAI;AAET,SAAO;AACT;SAcgB,WAAW,OAAa,OAAa,KAAU;AAC7D,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,aAAW,YAAYuB,SAAW;AAClC,cAAY,aAAaA,SAAY,GAAG,GAAG,CAAC;AAC5C,cAAY,aAAaA,SAAY,GAAG,GAAG,CAAC;AAE5C,QAAM,MAAMQ,MAAS,OAAO,KAAK;AACjC,MAAI,MAAM,WAAW;AACnBL,UAAW,WAAW,OAAO,QAAQ;AACrC,QAAIM,MAAS,QAAQ,IAAI,MAAU;AACjCN,YAAW,WAAW,OAAO,QAAQ;IACtC;AAEDF,gBAAe,UAAU,QAAQ;AACjC,kBAAc,UAAU,KAAK,IAAI,GAAG;AAEpC,WAAO;EACR,WAAU,MAAM,UAAU;AACzB,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AACT,QAAI,CAAC,IAAI;AAET,WAAO;EACR,OAAM;AACLE,UAAW,OAAO,OAAO,QAAQ;AAEjC,QAAI,CAAC,IAAI,SAAS,CAAC;AACnB,QAAI,CAAC,IAAI,SAAS,CAAC;AACnB,QAAI,CAAC,IAAI,SAAS,CAAC;AACnB,QAAI,CAAC,IAAI,IAAI;AAEb,WAAOd,YAAU,KAAK,GAAG;EAC1B;AACH;AAegB,SAAA,OACZ,GACA,GACA,GACA,GACA,GACA,KAAU;AACZ,QAAM,OAAO,IAAI,SAAS,CAAC;AAE3B,cAAY,aAAa,IAAI,SAAS,CAAC;AACvC,cAAY,aAAa,IAAI,SAAS,CAAC;AAEvC,QAAM,GAAG,GAAG,GAAG,SAAS;AACxB,QAAM,GAAG,GAAG,GAAG,SAAS;AACxB,QAAM,WAAW,WAAW,IAAI,KAAK,IAAI,IAAI,GAAG;AAEhD,SAAO;AACT;IR/xBW,SE8BA1B,WEQL,SAKF,SC5BS+C,cAuKAC,OA8HAJ,SAyCAK,UAkDAC,OAmBAC,SAqBAC,QAqBAC,UAsEAC,SA4BAC,OA4BAC,iBC9jBT,SA+OSF,SAsRAL,UAwEAM,OA6PT,OACA,OACA,OA2aS,UAqFA,kBC1zCF,UCXER,cAuHAQ,OA8VAD,SA6CAN,OA2BAJ,SAqEAM,OAoBAC,SAuET,UACA,WACA,WA+CA,WACA;;;ARlwBG,IAAI,UAAU;AE8Bd,IAAInD,YAAmC;AEQ9C,IAAM,UAAU,oBAAI,IAA6B;MAC/C,CAAC,cAAc,MAAM,IAAI,aAAa,EAAE,CAAC;MACzC,CAAC,cAAc,MAAM,IAAI,aAAa,EAAE,CAAC;MACzC,CAAC,OAAO,MAAM,IAAI,MAAM,EAAE,EAAE,KAAK,CAAC,CAAC;IACpC,CAAA;AACD,IAAI,UAAsB,QAAQ,IAAI,YAAY;AC5B3C,IAAM+C,eAAa9C;AAuKnB,IAAM+C,QAAMrC;AA8HZ,IAAMiC,UAAQzB;AAyCd,IAAM8B,WAAS5B;AAkDf,IAAM6B,QAAM5B;AAmBZ,IAAM6B,UAAQ5B;AAqBd,IAAM6B,SAAO5B;AAqBb,IAAM6B,WAAS5B;AAsEf,IAAM6B,UAAQ1B;AA4Bd,IAAM2B,QAAM1B;AA4BZ,IAAM2B,QAAM1B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9jBnB,IAAI,UAAwB;AA+OrB,IAAMwB,UAAQ1B;AAsRd,IAAMqB,WAAS5B;AAwEf,IAAMkC,QAAM1B;AA0qBZ,IAAM,WAAW;AAqFjB,IAAM,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1zCf,IAAI,WAAoC;ACXxC,IAAMkB,eAAa9C;AAuHnB,IAAMsD,QAAM1B;AA8VZ,IAAMyB,UAAQ1B;AA6Cd,IAAMoB,QAAMrC;AA2BZ,IAAMiC,UAAQzB;AAqEd,IAAM+B,QAAM5B;AAoBZ,IAAM6B,UAAQ5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AI/pBrB,IAKa;AALb;AAAA;AAKO,IAAM,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACFrB,SAAS,WAAW;AAC1B,MAAG,iBAAiB,KAAM,QAAO;AACjC,QAAM,UAAU,CAAC,YAAY,UAAU,WAAW,SAAS,SAAS,eAAe,gBAAgB;AACnG,SAAO,QAAQ,KAAK,iBAAe;AAClC,WAAO,UAAU,UAAU,MAAM,WAAW;AAAA,EAC7C,CAAC;AACF;AAmWO,SAAS,SAAS,SAAS;AAAC,SAAQ,UAAU,KAAK,KAAM;AAAG;AAE5D,SAAS,SAAS,GAAG;AAAC,MAAI,KAAK,KAAK;AAAI,SAAO,KAAK,MAAM;AAAG;AAwE7D,SAAS,WAAW,KAAK,KAAK,MAAM;AACzC,OAAI,OAAO,QAAQ,YAAY,OAAO,QAAQ,cAAc,OAAO,QAAQ,YAAY,OAAO,QAAQ,cAAc,OAAO,SAAS,YAAY,OAAO,SAAS,WAAW;AACzK,QAAI,OAAO;AACX,SAAK,MAAM,WAAW,GAAG;AACzB,SAAK,MAAM,WAAW,GAAG;AACzB,SAAK,OAAO,WAAW,IAAI;AAC3B,SAAK,SAAS,WAAW,GAAG;AAC5B,SAAK,SAAS;AACd,SAAK,mBAAmB,WAAW;AAAA,IAAC;AACpC,SAAK,mBAAmB,WAAW;AAAA,IAAC;AACpC,SAAK,SAAS,SAAS,SAAS;AAC9B,UAAG,YAAY,QAAW;AACxB,YAAG,KAAK,UAAU,KAAK,KAAK,SAAS,KAAK,KAAK;AAC7C,eAAK,SAAS,KAAK,SAAS,KAAK;AACjC,cAAG,KAAK,UAAU,KAAK,KAAK;AAC1B,iBAAK,SAAS,KAAK;AACnB,iBAAK,SAAS;AACd,iBAAK,iBAAiB;AAAA,UACxB;AACA,iBAAO,KAAK;AAAA,QACd,WAAU,KAAK,UAAU,KAAK,KAAK,SAAS,KAAK,KAAK;AACpD,eAAK,SAAS,KAAK,SAAS,KAAK;AACjC,cAAG,KAAK,UAAU,KAAK,KAAK;AAC1B,iBAAK,SAAS,KAAK;AACnB,iBAAK,SAAS;AACd,iBAAK,iBAAiB;AAAA,UACxB;AACA,iBAAO,KAAK;AAAA,QACd;AAAA,MACF,OAAO;AACL,eAAO,KAAK;AAAA,MACd;AAAA,IACF;AAAA,EACF,OAAO;AACL,YAAQ,IAAI,kBAAkB;AAAA,EAChC;AACF;AAqCO,SAAS,kBAAkB,KAAK,KAAK;AAAC,SAAO,KAAK,OAAO,KAAK,MAAM,OAAO;AAAI;AAE/E,SAAS,gBAAgB,KAAK,KAAK;AACxC,MAAG,OAAO,QAAQ,YAAY,OAAO,QAAQ,UAAU;AACrD,YAAQ;AAAA,MACN,qEAAqE,OAAO,MAAM,UAAU,OAAO,MAAM;AAAA,IAC3G;AAAA,EACF,WAAU,OAAO,QAAQ,eAAe,OAAO,QAAQ,aAAa;AAClE,YAAQ;AAAA,MACN,iFAAiF,OAAO,MAAM,UAAU,OAAO,MAAM;AAAA,IACvH;AAAA,EACF,OAAO;AACL,WAAO,KAAK,MAAM,KAAK,OAAO,KAAK,MAAM,MAAM,KAAK,GAAG;AAAA,EACzD;AACF;AAuFO,SAAS,2BAA2B,GAAG;AAa5C,MAAI,KAAK,EAAE,CAAC;AACZ,MAAI,KAAK,EAAE,CAAC;AACZ,MAAI,KAAK,EAAE,CAAC;AACZ,MAAI,KAAK,EAAE,CAAC;AAGZ,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK,MAAM;AACpC,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK;AAC9B,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK;AAG9B,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK;AAC9B,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK,MAAM;AACpC,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK;AAG9B,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK;AAC9B,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK;AAC9B,MAAI,MAAM,KAAK,KAAK,KAAK,KAAK,MAAM;AAGpC,MAAI,aAAa;AAAA,IAAC,CAAC,KAAK,KAAK,GAAG;AAAA,IAChC,CAAC,KAAK,KAAK,GAAG;AAAA,IACd,CAAC,KAAK,KAAK,GAAG;AAAA,EAAC;AAEf,SAAO;AACT;AASO,SAAS,QAAQ,QAAQ;AAC9B,QAAM,QAAQ;AACd,MAAI,SAAS;AACb,WAAQ,IAAI,GAAE,IAAI,QAAO,KAAK;AAC5B,cAAU,MAAM,OAAO,KAAK,MAAM,KAAK,OAAO,IAAI,MAAM,MAAM,CAAC;AAAA,EACjE;AACA,SAAO;AACT;AA3pBA,IACW,eA6XA,eAgIA,MAiBA,UA+HE,UAEA,YACA,WACA,iBAWF,IAgSE,aAKA,YAiEA;AAngCb;AAAA;AACO,IAAI,gBAAgB,kBAAkB,UAAU,UAAU;AA6X1D,IAAI,gBAAgB;AAAA,MACzB,WAAW;AAAA,MACX,MAAM,SAAS,UAAU,KAAK,IAAI,MAAM,QAAQ,UAAU;AACxD,YAAI,IAAI,SAAS,cAAc,QAAQ;AACvC,UAAE,SAAS,WAAW;AAEpB,cAAG,OAAO,YAAY,YAAa,UAAS;AAAA,QAC9C;AACA,YAAG,OAAO,SAAS,aAAa;AAC9B,YAAE,aAAa,QAAQ,IAAI;AAC3B,YAAE,YAAY;AAAA,QAChB,OAAO;AAAC,YAAE,aAAa,OAAO,GAAG;AAAA,QAAC;AAClC,YAAG,OAAO,OAAO,aAAa;AAAC,YAAE,aAAa,MAAM,EAAE;AAAA,QAAC;AACvD,YAAG,OAAO,WAAW,aAAa;AAChC,mBAAS,eAAe,MAAM,EAAE,YAAY,CAAC;AAC7C,cAAG,OAAO,YAAY,YAAa,UAAS;AAAA,QAC9C,OAAO;AACL,mBAAS,KAAK,YAAY,CAAC;AAAA,QAC7B;AAAA,MACF;AAAA,MACA,YAAY,SAASkC,WAAU,KAAK,IAAI,MAAM,QAAQ;AACpD,gBAAQ,IAAI,wBAAwB;AACpC,YAAI,IAAI,SAAS,cAAc,QAAQ;AACvC,UAAE,SAAS,WAAW;AACpB,wBAAc;AAAA,QAChB;AAEA,YAAG,OAAO,SAAS,aAAa;AAC9B,YAAE,aAAa,QAAQ,QAAQ;AAC/B,YAAE,aAAa,OAAO,GAAG;AAAA,QAC3B,OAAO;AACL,YAAE,aAAa,QAAQ,IAAI;AAC3B,YAAE,YAAY;AAAA,QAChB;AAEA,UAAE,aAAa,OAAO,GAAG;AACzB,YAAG,OAAO,OAAO,aAAa;AAC5B,YAAE,aAAa,MAAM,EAAE;AAAA,QACzB;AAEA,YAAG,OAAO,WAAW,aAAa;AAChC,mBAAS,eAAe,MAAM,EAAE,YAAY,CAAC;AAAA,QAC/C,OAAO;AACL,mBAAS,KAAK,YAAY,CAAC;AAAA,QAC7B;AAAA,MACF;AAAA,MACA,UAAU,SAAS,KAAK;AACtB,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,gBAAM,GAAG,EAAE,KAAK,CAAC,SAAS;AACxB,oBAAQ,KAAK,KAAK,CAAC;AAAA,UACrB,CAAC;AAAA,QACH,CAAC;AAAA,MACH;AAAA,IACF;AA2EO,IAAI,OAAO,SAAS,IAAI;AAAC,aAAO,SAAS,eAAe,EAAE;AAAA,IAAC;AAiB3D,IAAI,YAAY,WAAW;AAChC,UAAI,eAAe,CAAC;AACpB,UAAI,QAAQ,OAAO,SAAS,OAAO,UAAU,CAAC;AAC9C,UAAI,OAAO,MAAM,MAAM,GAAG;AAC1B,eAAQ,IAAI,GAAE,IAAI,KAAK,QAAO,KAAK;AACjC,YAAI,OAAO,KAAK,CAAC,EAAE,MAAM,GAAG;AAC5B,YAAG,OAAO,aAAa,KAAK,CAAC,CAAC,MAAM,aAAa;AAC/C,uBAAa,KAAK,CAAC,CAAC,IAAI,mBAAmB,KAAK,CAAC,CAAC;AAAA,QACpD,WAAU,OAAO,aAAa,KAAK,CAAC,CAAC,MAAM,UAAU;AACnD,cAAI,MAAM,CAAC,aAAa,KAAK,CAAC,CAAC,GAAG,mBAAmB,KAAK,CAAC,CAAC,CAAC;AAC7D,uBAAa,KAAK,CAAC,CAAC,IAAI;AAAA,QAC1B,OAAO;AACL,uBAAa,KAAK,CAAC,CAAC,EAAE,KAAK,mBAAmB,KAAK,CAAC,CAAC,CAAC;AAAA,QACxD;AAAA,MACF;AACA,aAAO;AAAA,IACT,GAAG;AA+GI,IAAM,WAAW;AAEjB,IAAM,aAAa;AACnB,IAAM,YAAY;AAClB,IAAM,kBAAkB;AAWxB,IAAI,KAAK;AAAA,MACd,MAAM,MAAM,KAAK,QAAQ;AAAA,MACzB,UAAU,MAAM,KAAK,aAAa;AAAA,MAClC,MAAM,WAAW;AACf,kBAAU,UAAU,UAAU,GAAG,KAAK,EAAE,SAAS,CAAC,EAAE,SAAS;AAAA,MAC/D;AAAA,MACA,GAAG;AAAA,MAAG,IAAI;AAAA,MAAG,GAAG,CAAC;AAAA,MACjB,YAAY,SAAS,SAAS,GAAG;AAC/B,YAAI,OAAO,SAAS,cAAc,KAAK;AACvC,aAAK,YAAY;AACjB,aAAK,KAAK,cAAc,GAAG,CAAC;AAC5B,WAAG,KAAK,EAAE,YAAY,IAAI;AAC1B,aAAK,UAAU,IAAI,UAAU;AAC7B,YAAG,KAAK,MAAM;AACZ,eAAK,QAAQ;AAAA,QACf,OAAO;AACL,eAAK,QAAQ;AAAA,QACf;AAAA,MACF;AAAA,MACA,MAAM,WAAW;AACf,WAAG,KAAK,EAAE,OAAO;AAAA,MACnB;AAAA,MACA,MAAM,SAAS,SAAS,GAAG;AACzB,WAAG,WAAW,SAAS,CAAC;AACxB,WAAG,KAAK,EAAE,MAAM,UAAU;AAC1B,YAAI,OAAO,GAAG;AACd,mBAAW,WAAW;AACpB,eAAK,cAAc,IAAI,EAAE,EAAE,UAAU,OAAO,YAAY;AACxD,eAAK,cAAc,IAAI,EAAE,EAAE,UAAU,IAAI,SAAS;AAClD,qBAAW,WAAW;AACpB,iBAAK,cAAc,IAAI,EAAE,EAAE,MAAM,UAAU;AAC3C,iBAAK,cAAc,IAAI,EAAE,EAAE,UAAU,OAAO,SAAS;AAErD,iBAAK,cAAc,IAAI,EAAE,EAAE,OAAO;AAClC,eAAG;AACH,gBAAG,GAAG,KAAK,GAAG,IAAI;AAChB,iBAAG,KAAK,EAAE,MAAM,UAAU;AAAA,YAC5B;AAAA,UACF,GAAG,GAAI;AAAA,QACT,GAAG,GAAI;AACP,WAAG;AAAA,MACL;AAAA,MACA,OAAO,SAAS,SAAS;AACvB,YAAG,GAAG,KAAK,KAAK,KAAM;AACtB,WAAG,KAAK,EAAE,UAAU,OAAO,SAAS;AACpC,WAAG,KAAK,EAAE,UAAU,IAAI,OAAO;AAC/B,WAAG,KAAK,EAAE,UAAU,IAAI,YAAY;AACpC,WAAG,KAAK,SAAS,KAAK;AAAA,MACxB;AAAA,MACA,SAAS,SAAS,SAAS;AACzB,YAAG,GAAG,KAAK,KAAK,KAAM;AACtB,WAAG,KAAK,EAAE,UAAU,OAAO,OAAO;AAClC,WAAG,KAAK,EAAE,UAAU,IAAI,SAAS;AACjC,WAAG,KAAK,EAAE,UAAU,IAAI,YAAY;AACpC,WAAG,KAAK,SAAS,IAAI;AAAA,MACvB;AAAA,IACF;AAwOO,IAAM,cAAc,IAAI,QAAQ;AAAA,MACtC,gBAAgB;AAAA,MAChB,UAAU;AAAA,IACX,CAAC;AAEM,IAAM,aAAa,IAAI,QAAQ;AAAA,MACrC,gBAAgB;AAAA,MAChB,UAAU;AAAA,IACX,CAAC;AA8DM,IAAM,oBAAN,MAAwB;AAAA,MAC7B,cAAc;AACZ,aAAK,SAAS,SAAS;AAAA,MACzB;AAAA,MAEA,eAAe;AACb,eAAO,CAAC,EACN,SAAS,qBACT,SAAS,2BACT,SAAS,wBACT,SAAS;AAAA,MAEb;AAAA,MAEA,UAAU;AACR,cAAM,KAAK,KAAK;AAChB,eACE,GAAG,oBAAoB,KACvB,GAAG,0BAA0B,KAC7B,GAAG,uBAAuB,KAC1B,GAAG,sBAAsB;AAAA,MAE7B;AAAA,MAEA,OAAO;AACL,eACE,SAAS,iBAAiB,KAC1B,SAAS,uBAAuB,KAChC,SAAS,sBAAsB,KAC/B,SAAS,mBAAmB;AAAA,MAEhC;AAAA,MAEA,SAAS;AACP,eAAO,KAAK,aAAa,IAAI,KAAK,KAAK,IAAI,KAAK,QAAQ;AAAA,MAC1D;AAAA,MAEA,SAAS,UAAU;AACjB;AAAA,UACE;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF,EAAE;AAAA,UAAQ,SACR,SAAS,iBAAiB,KAAK,MAAM;AACnC,qBAAS,KAAK,aAAa,CAAC;AAAA,UAC9B,CAAC;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAAA;AAAA;;;ACpjCA,IASa,UA4MA;AArNb;AAAA;AAAA;AASO,IAAM,WAAN,MAAe;AAAA,MACpB,YAAY,GAAG,GAAG,GAAG;AAEnB,aAAK,aAAa;AAClB,aAAK,YAAY;AACjB,aAAK,WAAW,CAAC;AACjB,aAAK,QAAQ,CAAC;AAEd,aAAK,eAAe;AACpB,aAAK,iBAAiB;AAEtB,YAAG,OAAO,KAAK,YAAa,KAAI;AAChC,YAAG,OAAO,KAAK,YAAa,KAAI;AAChC,YAAG,OAAO,KAAK,YAAa,KAAI;AAEhC,aAAK,IAAI,WAAW,CAAC;AACrB,aAAK,IAAI,WAAW,CAAC;AACrB,aAAK,IAAI,WAAW,CAAC;AAErB,aAAK,OAAO;AACZ,aAAK,OAAO;AACZ,aAAK,OAAO;AACZ,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAC3B,aAAK,UAAU,WAAW,CAAC;AAC3B,aAAK,UAAU,WAAW,CAAC;AAC3B,aAAK,SAAS;AAEd,eAAO;AAAA,MACT;AAAA,MAEA,SAAS,GAAG;AACV,YAAG,OAAO,MAAM,UAAU;AACxB,eAAK,SAAS;AAAA,QAChB,OAAO;AACL,kBAAQ,IAAI,uDAAuD;AAAA,QACrE;AAAA,MACF;AAAA,MAEA,aAAa,GAAG;AACd,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAAA,MAC7B;AAAA,MAEA,aAAa,GAAG;AACd,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAAA,MAC7B;AAAA,MAEA,aAAa,GAAG;AACd,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAAA,MAC7B;AAAA,MAEA,cAAc,GAAG,GAAG;AAClB,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAC3B,aAAK,UAAU,WAAW,CAAC;AAAA,MAC7B;AAAA,MAEA,cAAc,GAAG,GAAG;AAClB,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAC3B,aAAK,UAAU,WAAW,CAAC;AAAA,MAC7B;AAAA,MAEA,cAAc,GAAG,GAAG;AAClB,aAAK,SAAS;AACd,aAAK,UAAU,WAAW,CAAC;AAC3B,aAAK,UAAU,WAAW,CAAC;AAAA,MAC7B;AAAA,MAEA,wBAAwB;AAAA,MAAC;AAAA,MAEzB,SAAS;AACP,YAAI,KAAK,WAAW,KAAK,OAAO,IAAI,WAAW,KAAK,CAAC,GACnD,KAAK,WAAW,KAAK,OAAO,IAAI,WAAW,KAAK,CAAC,GACjD,KAAK,WAAW,KAAK,OAAO,IAAI,WAAW,KAAK,CAAC,GACjD,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE;AAC9C,aAAK,OAAQ,KAAK,OAAQ,KAAK;AAC/B,aAAK,OAAQ,KAAK,OAAQ,KAAK;AAC/B,aAAK,OAAQ,KAAK,OAAQ,KAAK;AAC/B,YAAG,KAAK,UAAU,MAAM;AACtB,cAAG,OAAO,KAAK,QAAQ;AACrB,iBAAK,KAAK,KAAK;AACf,iBAAK,KAAK,KAAK;AACf,iBAAK,KAAK,KAAK;AACf,gBAAG,KAAK,aAAa,MAAM;AACzB,kBAAG,KAAK,iBAAiB,KAAK,cAAc;AAE1C,oBAAG,KAAK,MAAM,UAAU,GAAG;AACzB,sBAAI,IAAI,KAAK;AAAA,oBACX,UAAU,KAAK;AAAA;AAAA,oBACf,YAAY,KAAK;AAAA;AAAA,oBACjB,WAAW,KAAK;AAAA,oBAChB,QAAQ,EAAC,GAAG,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,KAAK,EAAC;AAAA,kBAC1C,CAAC;AAAA,gBACH,OAAO;AAEL,sBAAG,KAAK,MAAM,SAAS;AAAG,wBAAG,KAAK,MAAM,CAAC,EAAE,SAAS,EAAG,KAAI,IAAI,KAAK;AAAA,sBAClE,UAAU,KAAK,MAAM,CAAC;AAAA;AAAA,sBACtB,WAAW,KAAK;AAAA;AAAA,sBAChB,QAAQ,EAAC,GAAG,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,KAAK,EAAC;AAAA,oBAC1C,CAAC;AAAA;AAED,sBAAG,KAAK,MAAM,SAAS;AAAG,wBAAG,KAAK,MAAM,CAAC,EAAE,SAAS,EAAG,KAAI,IAAI,KAAK;AAAA,sBAClE,UAAU,KAAK,MAAM,CAAC;AAAA;AAAA,sBACtB,YAAY,KAAK;AAAA;AAAA,sBACjB,WAAW,KAAK;AAAA;AAAA,sBAChB,QAAQ,EAAC,GAAG,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,KAAK,EAAC;AAAA,oBAC1C,CAAC;AAAA;AAAA,gBACH;AACA,qBAAK,iBAAiB;AAAA,cACxB,OAAO;AACL,qBAAK;AAAA,cACP;AAAA,YACF;AAAA,UACF,OAAO;AACL,iBAAK,IAAI,KAAK;AACd,iBAAK,IAAI,KAAK;AACd,iBAAK,IAAI,KAAK;AACd,iBAAK,SAAS;AACd,iBAAK,sBAAsB;AAC3B,gBAAG,KAAK,aAAa,MAAM;AACzB,kBAAG,KAAK,iBAAiB,KAAK,cAAc;AAG1C,oBAAG,KAAK,MAAM,UAAU,GAAG;AACzB,sBAAI,IAAI,KAAK;AAAA,oBACX,UAAU,KAAK;AAAA;AAAA,oBACf,YAAY,KAAK;AAAA;AAAA,oBACjB,WAAW,KAAK;AAAA,oBAChB,QAAQ,EAAC,GAAG,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,KAAK,EAAC;AAAA,kBAC1C,CAAC;AAAA,gBACH,OAAO;AAEL,sBAAG,KAAK,MAAM,CAAC,EAAE,SAAS,EAAG,KAAI,IAAI,KAAK;AAAA,oBACxC,UAAU,KAAK,MAAM,CAAC;AAAA,oBACtB,WAAW,KAAK;AAAA,oBAChB,QAAQ,EAAC,GAAG,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,KAAK,EAAC;AAAA,kBAC1C,CAAC;AACD,sBAAG,KAAK,MAAM,CAAC,EAAE,SAAS,EAAG,KAAI,IAAI,KAAK;AAAA;AAAA,oBAExC,UAAU,KAAK,MAAM,CAAC;AAAA;AAAA,oBACtB,YAAY,KAAK;AAAA;AAAA,oBACjB,WAAW,KAAK;AAAA;AAAA,oBAChB,QAAQ,EAAC,GAAG,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,KAAK,EAAC;AAAA,kBAC1C,CAAC;AAAA,gBACH;AAEA,qBAAK,iBAAiB;AAAA,cACxB,OAAO;AACL,qBAAK;AAAA,cACP;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,MAEA,IAAI,gBAAgB;AAClB,eAAO,CAAC,WAAW,KAAK,CAAC,GAAG,WAAW,KAAK,CAAC,GAAG,WAAW,KAAK,CAAC,CAAC;AAAA,MACpE;AAAA,MAEA,KAAK,MAAM,IAAI;AACb,aAAK,IAAI;AACT,aAAK,UAAU;AACf,aAAK,SAAS;AAAA,MAChB;AAAA,MAEA,KAAK,MAAM,IAAI;AACb,aAAK,IAAI;AACT,aAAK,UAAU;AACf,aAAK,SAAS;AAAA,MAChB;AAAA,MAEA,KAAK,MAAM,IAAI;AACb,aAAK,IAAI;AACT,aAAK,UAAU;AACf,aAAK,SAAS;AAAA,MAChB;AAAA,MAEA,IAAI,IAAI;AACN,eAAO,WAAW,KAAK,CAAC;AAAA,MAC1B;AAAA,MAEA,IAAI,IAAI;AACN,eAAO,WAAW,KAAK,CAAC;AAAA,MAC1B;AAAA,MAEA,IAAI,IAAI;AACN,eAAO,WAAW,KAAK,CAAC;AAAA,MAC1B;AAAA,MAEA,YAAY,MAAM,MAAM,MAAM;AAC5B,aAAK,IAAI;AACT,aAAK,IAAI;AACT,aAAK,IAAI;AACT,aAAK,UAAU;AACf,aAAK,UAAU;AACf,aAAK,UAAU;AACf,aAAK,SAAS;AAAA,MAChB;AAAA,IACF;AAEO,IAAM,WAAN,MAAe;AAAA,MACpB,YAAY,GAAG,GAAG,GAAG;AACnB,aAAK,WAAW,CAAC;AACjB,aAAK,QAAQ,CAAC;AACd,aAAK,aAAa;AAClB,aAAK,QAAQ;AACb,aAAK,QAAQ;AACb,aAAK,QAAQ;AACb,YAAG,OAAO,KAAK,YAAa,KAAI;AAChC,YAAG,OAAO,KAAK,YAAa,KAAI;AAChC,YAAG,OAAO,KAAK,YAAa,KAAI;AAChC,aAAK,IAAI;AACT,aAAK,IAAI;AACT,aAAK,IAAI;AACT,aAAK,OAAO;AACZ,aAAK,OAAO;AACZ,aAAK,OAAO;AACZ,aAAK,gBAAgB,EAAC,GAAG,GAAG,GAAG,GAAG,GAAG,EAAC;AACtC,aAAK,QAAQ;AACb,aAAK,OAAO,EAAC,GAAG,GAAG,GAAG,GAAG,GAAG,EAAC;AAE7B,aAAK,iBAAiB;AAAA,MACxB;AAAA,MAEA,WAAW;AAOT,eAAO,CAAC,SAAS,KAAK,KAAK,CAAC,GAAG,SAAS,KAAK,KAAK,CAAC,GAAG,SAAS,KAAK,KAAK,CAAC,CAAC;AAAA,MAC7E;AAAA,MAEA,YAAY;AACV,eAAO,KAAK,IAAI,SAAS,KAAK,KAAK,CAAC,IAAI,CAAC;AAAA,MAC3C;AAAA,MAEA,YAAY;AACV,eAAO,KAAK,IAAI,SAAS,KAAK,KAAK,CAAC,IAAI,CAAC;AAAA,MAC3C;AAAA,MAEA,YAAY;AACV,eAAO,KAAK,IAAI,SAAS,KAAK,KAAK,CAAC,IAAI,CAAC;AAAA,MAC3C;AAAA,MAEA,UAAU;AACR,YAAG,KAAK,cAAc,KAAK,GAAG;AAC5B,cAAG,KAAK,QAAQ,KAAK,KAAK,KAAK,OAAO;AACpC,gBAAI,IAAI,KAAK;AAAA,cACX,YAAY,KAAK;AAAA,cACjB,WAAW,KAAK;AAAA,cAChB,SAAS,KAAK;AAAA,YAChB,CAAC;AAAA,UACH;AACA,eAAK,OAAO,KAAK;AACjB,iBAAO,SAAS,KAAK,CAAC;AAAA,QACxB,OAAO;AACL,eAAK,IAAI,KAAK,IAAI,KAAK,cAAc,IAAI;AACzC,iBAAO,SAAS,KAAK,CAAC;AAAA,QACxB;AAAA,MACF;AAAA,MAEA,UAAU;AACR,YAAG,KAAK,cAAc,KAAK,GAAG;AAC5B,cAAG,KAAK,QAAQ,KAAK,KAAK,KAAK,OAAO;AAEpC,gBAAG,KAAK,MAAM,UAAU,GAAG;AACzB,kBAAI,IAAI,KAAK;AAAA,gBACX,UAAU,KAAK;AAAA,gBACf,YAAY,KAAK;AAAA,gBACjB,WAAW,KAAK;AAAA,gBAChB,SAAS,KAAK;AAAA,cAChB,CAAC;AACD,mBAAK,OAAO,KAAK;AAAA,YACnB,OAAO;AACL,kBAAG,KAAK,MAAM,CAAC,EAAE,SAAS,EAAG,KAAI,IAAI,KAAK;AAAA,gBACxC,UAAU,KAAK,MAAM,CAAC;AAAA,gBACtB,WAAW,KAAK;AAAA,gBAChB,SAAS,KAAK;AAAA,cAChB,CAAC;AACD,kBAAG,KAAK,MAAM,CAAC,EAAE,SAAS,EAAG,KAAI,IAAI,KAAK;AAAA,gBACxC,UAAU,KAAK,MAAM,CAAC;AAAA,gBACtB,YAAY,KAAK;AAAA,gBACjB,WAAW,KAAK;AAAA,gBAChB,SAAS,KAAK;AAAA,cAChB,CAAC;AACD,mBAAK,OAAO,KAAK;AAAA,YACnB;AAAA,UAEF;AAEA,iBAAO,SAAS,KAAK,CAAC;AAAA,QACxB,OAAO;AACL,eAAK,IAAI,KAAK,IAAI,KAAK,cAAc,IAAI;AACzC,iBAAO,SAAS,KAAK,CAAC;AAAA,QACxB;AAAA,MACF;AAAA,MAEA,UAAU;AACR,YAAG,KAAK,cAAc,KAAK,GAAG;AAC5B,cAAG,KAAK,QAAQ,KAAK,KAAK,KAAK,OAAO;AACpC,gBAAI,IAAI,KAAK;AAAA,cACX,YAAY,KAAK;AAAA,cACjB,WAAW,KAAK;AAAA,cAChB,SAAS,KAAK;AAAA,YAChB,CAAC;AAAA,UACH;AACA,eAAK,OAAO,KAAK;AACjB,iBAAO,SAAS,KAAK,CAAC;AAAA,QACxB,OAAO;AACL,eAAK,IAAI,KAAK,IAAI,KAAK,cAAc,IAAI;AACzC,iBAAO,SAAS,KAAK,CAAC;AAAA,QACxB;AAAA,MACF;AAAA,IAEF;AAAA;AAAA;;;ACLA,SAAS,MAAM,GAAG,KAAK,KAAK;AAC1B,SAAO,KAAK,IAAI,KAAK,IAAI,GAAG,GAAG,GAAG,GAAG;AACvC;AAGA,SAAS,IAAI,GAAG,KAAK;AACnB,SAAO,IAAI,KAAK,MAAM,KAAK,IAAI,CAAC,IAAI,GAAG,IAAI,MAAM,KAAK,KAAK,CAAC;AAC9D;AAGA,SAASC,QAAO,KAAK,MAAMC,QAAO;AAChC,SAAO,SAAK,sBAAsB,KAAK,SAAK,SAAS,MAAMA,MAAK,CAAC;AACnE;AAGA,SAAS,KAAK,GAAG,GAAG,GAAG;AACrB,SAAO,SAAK,UAAU,GAAG,SAAK,IAAI,GAAG,CAAC,GAAG,CAAC;AAC5C;AAEO,SAAS,mBAAmBC,SAAQ,QAAQ;AACjD,MAAI,UAAU;AAAA,IACZ,SAAS;AAAA,IACT,UAAU;AAAA,IACV,MAAM;AAAA,IACN,OAAO;AAAA,IACP,IAAI;AAAA,IACJ,MAAM;AAAA,EACR;AACA,MAAI,SAAS;AAAA,IACX,GAAG;AAAA,IACH,GAAG;AAAA,IACH,MAAM;AAAA,EACR;AACA,MAAI,YAAY;AAEhB,QAAM,aAAa,CAAC,GAAG,UAAU;AAC/B,YAAO,EAAE,MAAM;AAAA,MACb,KAAK;AAAQ,gBAAQ,UAAU;AAAO;AAAA,MACtC,KAAK;AAAQ,gBAAQ,WAAW;AAAO;AAAA,MACvC,KAAK;AAAQ,gBAAQ,OAAO;AAAO;AAAA,MACnC,KAAK;AAAQ,gBAAQ,QAAQ;AAAO;AAAA,MACpC,KAAK;AAAS,gBAAQ,KAAK;AAAO;AAAA,MAClC,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAQ,gBAAQ,OAAO;AAAO;AAAA,IACrC;AAIA,MAAE,gBAAgB;AAAA,EACpB;AAEA,EAAAA,QAAO,iBAAiB,WAAW,CAAC,MAAM,WAAW,GAAG,IAAI,CAAC;AAC7D,EAAAA,QAAO,iBAAiB,SAAS,CAAC,MAAM,WAAW,GAAG,KAAK,CAAC;AAE5D,SAAO,MAAM,cAAc;AAC3B,SAAO,iBAAiB,eAAe,MAAM;AAAC,gBAAY;AAAA,EAAK,CAAC;AAChE,SAAO,iBAAiB,aAAa,MAAM;AAAC,gBAAY;AAAA,EAAM,CAAC;AAC/D,SAAO,iBAAiB,eAAe,CAAC,MAAM;AAC5C,gBAAY,EAAE,gBAAgB,WAAW,EAAE,UAAU,OAAO,IAAI;AAChE,QAAG,WAAW;AACZ,aAAO,KAAK,EAAE,YAAY;AAC1B,aAAO,KAAK,EAAE,YAAY;AAAA,IAC5B;AAAA,EACF,CAAC;AAED,SAAO,iBAAiB,SAAS,CAAC,MAAM;AAAA,EAMxC,GAAG,EAAC,SAAS,MAAK,CAAC;AAEnB,SAAO,MAAM;AAEX,UAAM,QAAQ,OAAO,KAAK;AAC1B,UAAM,QAAQ,OAAO,KAAK;AAC1B,UAAM,MAAM;AAAA,MACV;AAAA,MACA,QAAQ;AAAA,QACN,GAAG;AAAA,QACH,GAAG;AAAA,QACH,MAAM,OAAO;AAAA,QACb,UAAU;AAAA,MACZ;AAAA,IACF;AAEA,WAAO,IAAI;AACX,WAAO,IAAI;AACX,WAAO,OAAO;AACd,WAAO;AAAA,EACT;AACF;AAjaA,IAOM,YA+EO,YAmHA,eA0NA;AAnab;AAAA;AAGA;AACA;AAGA,IAAM,aAAN,MAAiB;AAAA;AAAA,MAEf,UAAU,IAAI,aAAa;AAAA,QACzB;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,MAC/C,CAAC;AAAA;AAAA,MAGD,QAAQ,SAAK,OAAO;AAAA;AAAA,MAGpB,SAAS,IAAI,aAAa,KAAK,QAAQ,QAAQ,IAAI,GAAG,CAAC;AAAA,MACvD,MAAM,IAAI,aAAa,KAAK,QAAQ,QAAQ,IAAI,GAAG,CAAC;AAAA,MACpD,QAAQ,IAAI,aAAa,KAAK,QAAQ,QAAQ,IAAI,GAAG,CAAC;AAAA,MACtD,YAAY,IAAI,aAAa,KAAK,QAAQ,QAAQ,IAAI,IAAI,CAAC;AAAA;AAAA,MAG3D,IAAI,SAAS;AACX,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAEA,IAAI,OAAO,KAAK;AACd,iBAAK,KAAK,KAAK,KAAK,OAAO;AAAA,MAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,MAOA,IAAI,OAAO;AACT,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAEA,IAAI,KAAK,KAAK;AACZ,iBAAK,KAAK,KAAK,KAAK,KAAK;AAAA,MAC3B;AAAA;AAAA,MAGA,IAAI,QAAQ;AACV,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAGA,IAAI,MAAM,KAAK;AACb,iBAAK,KAAK,KAAK,KAAK,MAAM;AAAA,MAC5B;AAAA;AAAA,MAGA,IAAI,KAAK;AACP,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAGA,IAAI,GAAG,KAAK;AACV,iBAAK,KAAK,KAAK,KAAK,GAAG;AAAA,MACzB;AAAA;AAAA,MAGA,IAAI,OAAO;AACT,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAGA,IAAI,KAAK,KAAK;AACZ,iBAAK,KAAK,KAAK,KAAK,KAAK;AAAA,MAC3B;AAAA;AAAA,MAGA,IAAI,WAAW;AACb,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAGA,IAAI,SAAS,KAAK;AAChB,iBAAK,KAAK,KAAK,KAAK,SAAS;AAAA,MAC/B;AAAA,IACF;AAGO,IAAM,aAAN,cAAyB,WAAW;AAAA;AAAA,MAEzC,QAAQ;AAAA;AAAA,MAER,MAAM;AAAA;AAAA,MAGN,YAAY,SAAK,OAAO;AAAA;AAAA,MAGxB,gBAAgB;AAAA;AAAA,MAGhB,gBAAgB;AAAA;AAAA;AAAA;AAAA,MAKhB,sBAAsB;AAAA;AAAA,MAGtB,IAAI,WAAW;AACb,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAEA,IAAI,SAAS,KAAK;AAChB,iBAAK,KAAK,KAAK,KAAK,SAAS;AAAA,MAC/B;AAAA,MAEA,cAAc,MAAO,IAAI,KAAK,KAAM,GAAG,SAAS,GAAG,OAAO,GAAG,MAAM,KAAM;AACvE,aAAK,mBAAmB,SAAK,YAAY,KAAK,QAAQ,MAAM,GAAG;AAAA,MACjE;AAAA,MAEA,YAAY,SAAS;AACnB,cAAM;AACN,YAAG,YAAY,QAAQ,YAAY,QAAQ,SAAS;AAClD,gBAAM,WAAW,QAAQ,YAAY,SAAK,OAAO,GAAG,GAAG,CAAC;AACxD,gBAAM,SAAS,QAAQ,UAAU,SAAK,OAAO,GAAG,GAAG,CAAC;AACpD,gBAAM,UAAU,SAAK,UAAU,SAAK,IAAI,QAAQ,QAAQ,CAAC;AACzD,eAAK,kBAAkB,OAAO;AAC9B,eAAK,WAAW;AAChB,eAAK,SAAS,QAAQ;AACtB,eAAK,SAAS,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AACpD,eAAK,cAAe,IAAI,KAAK,KAAM,GAAG,KAAK,QAAQ,GAAG,GAAI;AAAA,QAE5D;AAAA,MACF;AAAA;AAAA,MAGA,IAAI,SAAS;AACX,eAAO,MAAM;AAAA,MACf;AAAA;AAAA,MAGA,IAAI,OAAO,KAAK;AACd,cAAM,SAAS;AACf,aAAK,kBAAkB,KAAK,IAAI;AAAA,MAClC;AAAA,MAEA,OAAOC,YAAW,OAAO;AACvB,cAAM,OAAO,CAAC,UAAU,cACrB,WAAW,IAAI,MAAM,WAAW,IAAI;AAGvC,aAAK,OAAO,MAAM,OAAO,IAAIA,aAAY,KAAK;AAC9C,aAAK,SAAS,MAAM,OAAO,IAAIA,aAAY,KAAK;AAGhD,aAAK,MAAM,IAAI,KAAK,KAAK,KAAK,KAAK,CAAC;AAEpC,aAAK,QAAQ,MAAM,KAAK,OAAO,CAAC,KAAK,KAAK,GAAG,KAAK,KAAK,CAAC;AAGxD,cAAM,WAAW,SAAK,KAAK,KAAK,QAAQ;AAGxC,cAAM,SAAS,SAAK,QAAQ,SAAK,UAAU,KAAK,GAAG,GAAG,KAAK,KAAK;AAKhE,cAAM,UAAU,MAAM;AACtB,cAAM,aAAa,KAAK,QAAQ,OAAO,QAAQ,IAAI;AACnD,cAAM,UAAU,KAAK,QAAQ,IAAI,QAAQ,IAAI;AAC7C,cAAM,iBAAiB,SAAK,OAAO;AACnC,cAAM,YAAY,KAAK,QAAQ,UAAU,QAAQ,OAAO;AACxD,iBAAK,UAAU,gBAAgB,KAAK,OAAO,YAAY,cAAc;AACrE,iBAAK,UAAU,gBAAgB,KAAK,IAAI,SAAS,cAAc;AAC/D,iBAAK,UAAU,gBAAgB,KAAK,MAAM,WAAW,cAAc;AACnE,iBAAK,UAAU,gBAAgB,cAAc;AAC7C,iBAAK,UAAU,gBAAgB,KAAK,eAAe,cAAc;AAGjE,aAAK,WAAW;AAAA,UACd;AAAA,UACA,KAAK;AAAA,UACL,KAAK,IAAI,IAAI,KAAK,qBAAqBA,UAAS;AAAA,QAClD;AAGA,aAAK,WAAW,SAAK,UAAU,UAAU,KAAK,UAAUA,UAAS;AAGjE,aAAK,OAAO,SAAK,OAAO,KAAK,MAAM;AACnC,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAGA,kBAAkB,KAAK;AACrB,aAAK,MAAM,KAAK,MAAM,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;AACpC,aAAK,QAAQ,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC;AAAA,MAChC;AAAA,IACF;AAGO,IAAM,gBAAN,cAA4B,WAAW;AAAA;AAAA,MAE5C,WAAW;AAAA;AAAA,MAGX,kBAAkB;AAAA;AAAA,MAGlB,QAAQ,SAAK,OAAO;AAAA;AAAA,MAGpB,IAAI,OAAO;AACT,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAEA,IAAI,KAAK,KAAK;AACZ,iBAAK,KAAK,KAAK,KAAK,KAAK;AAAA,MAC3B;AAAA;AAAA,MAGA,gBAAgB;AAAA;AAAA,MAGhB,YAAY;AAAA;AAAA;AAAA;AAAA,MAKZ,sBAAsB;AAAA,MAEtB,cAAc,MAAO,IAAI,KAAK,KAAM,GAAG,SAAS,GAAG,OAAO,GAAG,MAAM,KAAM;AACvE,aAAK,mBAAmB,SAAK,YAAY,KAAK,QAAQ,MAAM,GAAG;AAAA,MACjE;AAAA;AAAA,MAEA,YAAY,SAAS;AACnB,cAAM;AACN,YAAG,WAAW,QAAQ,UAAU;AAC9B,eAAK,WAAW,QAAQ;AACxB,eAAK,WAAW,SAAK,IAAI,KAAK,QAAQ;AACtC,eAAK,OAAO,SAAK,UAAU,KAAK,QAAQ;AAExC,eAAK,cAAe,IAAI,KAAK,KAAM,GAAG,KAAK,QAAQ,GAAG,GAAI;AAE1D,eAAK,gBAAgB;AACrB,eAAK,aAAa;AAAA,QACpB;AAAA,MACF;AAAA;AAAA,MAGA,IAAI,SAAS;AACX,eAAO,MAAM;AAAA,MACf;AAAA;AAAA,MAGA,IAAI,OAAO,KAAK;AACd,cAAM,SAAS;AACf,aAAK,WAAW,SAAK,IAAI,KAAK,QAAQ;AAAA,MACxC;AAAA,MAEA,OAAOA,YAAW,OAAO;AACvB,cAAM,UAAU;AAEhB,YAAG,MAAM,OAAO,UAAU;AAExB,eAAK,kBAAkB;AAAA,QACzB,OAAO;AAEL,eAAK,mBAAmB,KAAK,IAAI,IAAI,KAAK,qBAAqBA,UAAS;AAAA,QAC1E;AAGA,cAAM,WAAW,SAAK,OAAO;AAC7B,iBAAK,UAAU,UAAU,KAAK,OAAO,MAAM,OAAO,GAAG,QAAQ;AAC7D,iBAAK,UAAU,UAAU,KAAK,IAAI,CAAC,MAAM,OAAO,GAAG,QAAQ;AAG3D,cAAM,eAAe,SAAK,MAAM,UAAU,KAAK,IAAI;AAGnD,cAAM,YAAY,SAAK,IAAI,YAAY;AAEvC,YAAG,YAAY,SAAS;AAEtB,eAAK,OAAO,SAAK,MAAM,cAAc,IAAI,SAAS;AAGlD,eAAK,kBAAkB,YAAY,KAAK;AAAA,QAC1C;AAGA,cAAM,gBAAgB,KAAK,kBAAkBA;AAC7C,YAAG,gBAAgB,SAAS;AAI1B,eAAK,OAAO,SAAK,UAAUH,QAAO,KAAK,MAAM,KAAK,MAAM,aAAa,CAAC;AACtE,eAAK,gBAAgB;AACrB,eAAK,aAAa;AAAA,QACpB;AAGA,YAAG,MAAM,OAAO,SAAS,GAAG;AAC1B,eAAK,YAAY,IAAI,MAAM,OAAO,OAAO,KAAK;AAAA,QAChD;AACA,aAAK,WAAW,SAAK,MAAM,KAAK,MAAM,KAAK,QAAQ;AAGnD,aAAK,OAAO,SAAK,OAAO,KAAK,MAAM;AACnC,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAGA,kBAAkB;AAChB,aAAK,QAAQ,SAAK,UAAU,SAAK,MAAM,KAAK,IAAI,KAAK,IAAI,CAAC;AAAA,MAC5D;AAAA;AAAA,MAGA,eAAe;AACb,aAAK,KAAK,SAAK,UAAU,SAAK,MAAM,KAAK,MAAM,KAAK,KAAK,CAAC;AAAA,MAC5D;AAAA,IACF;AAkGO,IAAM,YAAN,cAAwB,WAAW;AAAA,MACxC,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,YAAY,SAAK,OAAO;AAAA,MACxB,gBAAgB;AAAA,MAChB,gBAAgB;AAAA,MAChB,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,MAIjB,sBAAsB;AAAA;AAAA;AAAA,MAItB,UAAU;AAAA,MACV,OAAO;AAAA;AAAA,MACP,OAAO;AAAA;AAAA,MACP,cAAc;AAAA,MAId,IAAI,WAAW;AACb,eAAO,KAAK;AAAA,MACd;AAAA;AAAA,MAEA,IAAI,SAAS,KAAK;AAChB,iBAAK,KAAK,KAAK,KAAK,SAAS;AAAA,MAC/B;AAAA,MAEA,cAAc,MAAO,IAAI,KAAK,KAAM,GAAG,SAAS,GAAG,OAAO,GAAG,MAAM,KAAM;AACvE,aAAK,mBAAmB,SAAK,YAAY,KAAK,QAAQ,MAAM,GAAG;AAAA,MACjE;AAAA,MAEA,YAAY,SAAS;AACnB,cAAM;AACN,YAAG,YAAY,QAAQ,YAAY,QAAQ,SAAS;AAClD,gBAAM,WAAW,QAAQ,YAAY,SAAK,OAAO,GAAG,GAAG,CAAC;AACxD,gBAAM,SAAS,QAAQ,UAAU,SAAK,OAAO,GAAG,GAAG,CAAC;AACpD,gBAAM,UAAU,SAAK,UAAU,SAAK,IAAI,QAAQ,QAAQ,CAAC;AACzD,eAAK,kBAAkB,OAAO;AAC9B,eAAK,WAAW;AAChB,eAAK,SAAS,QAAQ;AACtB,eAAK,SAAS,QAAQ,OAAO,QAAQ,QAAQ,OAAO;AACpD,eAAK,cAAe,IAAI,KAAK,KAAM,GAAG,KAAK,QAAQ,GAAG,GAAI;AAG1D,eAAK,mBAAmB;AACxB,2BAAiB,SAAS,CAAC,MAAM;AAE/B,iBAAK,mBAAmB;AACxB,iBAAK,WAAW,EAAE,SAAS,KAAK,cAAc;AAE9C,iBAAK,UAAU,KAAK,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,MAAM,KAAK,OAAO,CAAC;AAAA,UACtE,CAAC;AAAA,QACH;AAAA,MACF;AAAA,MAEA,IAAI,SAAS;AACX,eAAO,MAAM;AAAA,MACf;AAAA;AAAA,MAGA,IAAI,OAAO,KAAK;AACd,cAAM,SAAS;AACf,aAAK,kBAAkB,KAAK,IAAI;AAAA,MAClC;AAAA,MAEA,OAAOG,YAAW,OAAO;AACvB,cAAM,OAAO,CAAC,UAAU,cACrB,WAAW,IAAI,MAAM,WAAW,IAAI;AAEvC,aAAK,MAAM;AACX,aAAK,QAAQ;AAEb,aAAK,MAAM,IAAI,KAAK,KAAK,KAAK,KAAK,CAAC;AAEpC,aAAK,QAAQ,MAAM,KAAK,OAAO,CAAC,KAAK,KAAK,GAAG,KAAK,KAAK,CAAC;AAExD,YAAG,KAAK,YAAY,QAAQ,KAAK,SAAS,WAAW,QACnD,KAAK,oBAAoB,MACzB;AAGA,eAAK,iBAAiB,KAAK;AAE3B,eAAK,SAAS,CAAC,IAAI,KAAK,SAAS;AACjC,eAAK,SAAS,CAAC,IAAI,KAAK,SAAS,IAAI,KAAK;AAC1C,cAAI,eAAe,CAAC,EAAE,SAAS,CAAC,IAAI,KAAK,SAAS;AAClD,cAAI,eAAe,CAAC,EAAE,SAAS,CAAC,IAAI,KAAK,SAAS;AAClD,cAAI,eAAe,CAAC,EAAE,OAAO,CAAC,IAAI,KAAK,SAAS;AAChD,cAAI,eAAe,CAAC,EAAE,OAAO,CAAC,IAAI,KAAK,SAAS;AAEhD,eAAK,mBAAmB;AAAA,QAC1B;AAGA,cAAM,eAAe;AACrB,aAAK,SAAS,CAAC,MAAM,KAAK,UAAU,KAAK,SAAS,CAAC,KAAK;AAExD,YAAI,WAAW,SAAK,KAAK,KAAK,QAAQ;AAEtC,cAAM,SAAS,SAAK,QAAQ,SAAK,UAAU,KAAK,GAAG,GAAG,KAAK,KAAK;AAEhE,cAAM,UAAU,MAAM;AACtB,cAAM,aAAa,KAAK,QAAQ,OAAO,QAAQ,IAAI;AACnD,cAAM,UAAU,KAAK,QAAQ,IAAI,QAAQ,IAAI;AAC7C,cAAM,iBAAiB,SAAK,OAAO;AACnC,cAAM,YAAY,KAAK,QAAQ,UAAU,QAAQ,OAAO;AAExD,YAAG,aAAa,IAAI;AAElB,mBAAS,CAAC,KAAK;AAAA,QACjB,WAAU,aAAa,GAAG;AACxB,mBAAS,CAAC,KAAK;AAAA,QACjB;AACA,iBAAS,CAAC,KAAK,aAAa;AAC5B,iBAAK,UAAU,gBAAgB,KAAK,OAAO,YAAY,cAAc;AACrE,iBAAK,UAAU,gBAAgB,KAAK,IAAI,SAAS,cAAc;AAC/D,iBAAK,UAAU,gBAAgB,cAAc;AAC7C,iBAAK,UAAU,gBAAgB,KAAK,eAAe,cAAc;AACjE,aAAK,WAAW;AAAA,UACd;AAAA,UACA,KAAK;AAAA,UACL,KAAK,IAAI,IAAI,KAAK,qBAAqBA,UAAS;AAAA,QAClD;AACA,aAAK,WAAW,SAAK,UAAU,UAAU,KAAK,UAAUA,UAAS;AACjE,aAAK,OAAO,SAAK,OAAO,KAAK,MAAM;AACnC,eAAO,KAAK;AAAA,MACd;AAAA,MAEA,kBAAkB,KAAK;AACrB,aAAK,MAAM,KAAK,MAAM,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;AACpC,aAAK,QAAQ,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC;AAAA,MAChC;AAAA,IACF;AAAA;AAAA;;;AC1iBA,IAKqB;AALrB;AAAA;AAAA;AACA;AACA;AACA;AAEA,IAAqB,SAArB,MAA4B;AAAA,MAE3B,YAAY,QAAQ,QAAQ,SAAS,GAAG;AACvC,aAAK,UAAU;AACf,aAAK,SAAS;AAGd,aAAK,eAAe,mBAAmB,QAAQ,MAAM;AACrD,aAAK,UAAU,EAAE;AACjB,aAAK,QAAQ,EAAE;AACf,gBAAQ,IAAI,6CAA6C,EAAE,iBAAiB,YAAY;AACxF,aAAK,mBAAmB;AAAA,UACvB,MAAM,EAAE,iBAAiB;AAAA,UACzB,cAAc,EAAE,iBAAiB;AAAA,QAClC;AAEA,aAAK,cAAc;AAEnB,aAAK,gBAAgB,EAAE;AAEvB,aAAK,eAAe;AAAA,UACnB,cAAc,IAAI;AAAA,UAClB,iBAAiB;AAAA,UACjB,cAAc,IAAI;AAAA,UAClB,UAAU,IAAI;AAAA,QACf;AAEA,YAAG,OAAO,EAAE,YAAY,aAAa;AACpC,eAAK,UAAU;AAAA,YACd,SAAS;AAAA,YACT,QAAQ;AAAA,UACT;AAAA,QACD,OAAO;AACN,eAAK,UAAU,EAAE;AAAA,QAClB;AAEA,aAAK,gBAAgB,CAAC;AAEtB,UAAE,cAAc,QAAQ,CAAC,MAAM;AAC9B,eAAK,cAAc,KAAK,CAAC;AAAA,QAC1B,CAAC;AAED,aAAK,WAAW,IAAI,SAAS,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,EAAE,SAAS,CAAC;AACrE,aAAK,WAAW,IAAI,SAAS,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,EAAE,SAAS,CAAC;AACrE,aAAK,SAAS,cAAc,IAAI,EAAE,cAAc;AAChD,aAAK,SAAS,cAAc,IAAI,EAAE,cAAc;AAChD,aAAK,SAAS,cAAc,IAAI,EAAE,cAAc;AAEhD,aAAK,eAAe,OAAO,mBAAmB,EAAC,MAAM,aAAY,CAAC;AAClE,aAAK,qBAAqB,UAAU,IAAI,yBAAyB;AAEjE,aAAK,WAAW,OAAO,qBAAqB;AAAA,UAC3C,QAAQ;AAAA,UACR,QAAQ;AAAA,YACP,QAAQ,KAAK;AAAA,YACb,YAAY;AAAA,YACZ,SAAS;AAAA,cACR;AAAA,gBACC,aAAa,KAAK,aAAa;AAAA,gBAC/B,YAAY;AAAA,kBACX;AAAA;AAAA,oBAEC,gBAAgB;AAAA,oBAChB,QAAQ,KAAK,aAAa;AAAA,oBAC1B,QAAQ;AAAA,kBACT;AAAA,kBACA;AAAA;AAAA,oBAEC,gBAAgB;AAAA,oBAChB,QAAQ,KAAK,aAAa;AAAA,oBAC1B,QAAQ;AAAA,kBACT;AAAA,kBACA;AAAA;AAAA,oBAEC,gBAAgB;AAAA,oBAChB,QAAQ,KAAK,aAAa;AAAA,oBAC1B,QAAQ;AAAA,kBACT;AAAA,gBACD;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAAA,UACA,UAAU;AAAA,YACT,QAAQ,KAAK;AAAA,YACb,YAAY;AAAA,YACZ,SAAS;AAAA,cACR;AAAA,gBACC,QAAQ,KAAK;AAAA,cACd;AAAA,YACD;AAAA,UACD;AAAA,UACA,WAAW;AAAA,YACV,UAAU;AAAA;AAAA;AAAA;AAAA,YAKV,UAAU;AAAA,UACX;AAAA;AAAA;AAAA,UAIA,cAAc;AAAA,YACb,mBAAmB;AAAA,YACnB,cAAc;AAAA,YACd,QAAQ;AAAA,UACT;AAAA,QACD,CAAC;AAED,aAAK,eAAe,OAAO,cAAc;AAAA,UACxC,MAAM,CAAC,OAAO,OAAO,OAAO,MAAM;AAAA,UAClC,QAAQ;AAAA,UACR,OAAO,gBAAgB;AAAA,QACxB,CAAC;AAED,aAAK,oBAAoB,IAAI;AAC7B,aAAK,gBAAgB,OAAO,aAAa;AAAA,UACxC,MAAM,KAAK;AAAA,UACX,OAAO,eAAe,UAAU,eAAe;AAAA,QAChD,CAAC;AAGD,aAAK,WAAW;AAChB,aAAK,cAAc;AAEnB,aAAK,WAAW;AAAA,UACf,kBAAkB;AAAA,UAClB,eAAe;AAAA,QAChB;AAEA,aAAK,SAAS,KAAK,eAAe,MAAM,EAAE,KAAK,MAAM;AACpD,eAAK,SAAS,KAAK,eAAe,MAAM,EAAE,KAAK,MAAM;AACpD,iBAAK,UAAU,OAAO,cAAc;AAAA,cACnC,WAAW;AAAA,cACX,WAAW;AAAA,YACZ,CAAC;AAED,iBAAK,YAAY,SAAK,OAAO;AAC7B,qBAAK,SAAS,KAAK,SAAS;AAG5B,iBAAK,SAAS,KAAK,eAAe,KAAK,KAAK;AAC5C,iBAAK,OAAO,YAAY,KAAK,sBAAsB,KAAK,UAAU,KAAK,SAAS;AAEhF,gBAAI,YAAY;AAAA,cACf,KAAK,eAAe,IAAI,GAAG,GAAG,IAAI;AAAA,YACnC;AAEA,iBAAK,cAAc,CAAC,KAAK,MAAM;AAG/B,iBAAK,uBAAuB;AAAA,cAC3B,kBAAkB;AAAA,gBACjB;AAAA,kBACC,MAAM;AAAA,kBACN,YAAY,EAAC,GAAG,GAAK,GAAG,GAAK,GAAG,GAAK,GAAG,EAAG;AAAA,kBAC3C,QAAQ,KAAK,cAAc;AAAA,kBAC3B,SAAS,KAAK,cAAc;AAAA,gBAC7B;AAAA,cACD;AAAA,cACA,wBAAwB;AAAA,gBACvB,MAAM,KAAK,aAAa,WAAW;AAAA,gBACnC,iBAAiB;AAAA,gBACjB,aAAa,KAAK,cAAc;AAAA,gBAChC,cAAc,KAAK,cAAc;AAAA,cAClC;AAAA,YACD;AAEA,kBAAM,SAAS,OAAO,QAAQ,OAAO;AACrC,iBAAK,mBAAmB,SAAK,YAAa,IAAI,KAAK,KAAM,GAAG,QAAQ,GAAG,GAAK;AAC5E,iBAAK,4BAA4B,SAAK,OAAO;AAE7C,iBAAK,iBAAiB,OAAO,gBAAgB;AAAA,cAC5C,QAAQ,KAAK,SAAS,mBAAmB,CAAC;AAAA,cAC1C,SAAS;AAAA,gBACR;AAAA,kBACC,SAAS;AAAA,kBACT,UAAU;AAAA,oBACT,QAAQ,KAAK;AAAA,kBACd;AAAA,gBACD;AAAA,cACD;AAAA,YACD,CAAC;AAcD,iBAAK;AACL,iBAAK,mBAAmB;AAAA,UAEzB,CAAC;AAAA,QACF,CAAC;AAAA,MAEF;AAAA,MAEA,sBAAsB,WAAW,WAAW;AAC3C,iBAAQ,IAAI,KAAK,YAAY,QAAO,KAAK,KAAK,SAAS,eAAc,EAAE,GAAG;AAEzE,gBAAM,SAAS,KAAK,OAAO,IAAI,MAAM;AACrC,gBAAMC,SAAQ,KAAK,OAAO,IAAI,KAAK,KAAK;AACxC,gBAAM,IAAI,KAAK,IAAIA,MAAK,IAAI;AAC5B,gBAAM,KAAK,KAAK,OAAO,IAAI,OAAO;AAClC,gBAAM,IAAI,KAAK,IAAIA,MAAK,IAAI;AAE5B,mBAAK,SAAS,SAAS;AACvB,mBAAK,UAAU,WAAW,CAAC,GAAG,GAAG,CAAC,GAAG,SAAS;AAC9C,mBAAK,QAAQ,WAAW,KAAK,OAAO,IAAI,KAAK,IAAI,SAAS;AAC1D,mBAAK,QAAQ,WAAW,KAAK,OAAO,IAAI,KAAK,IAAI,SAAS;AAC1D,eAAK,YAAY,KAAK;AAAA,YACrB,GAAG,UAAU,IAAI,UAAU,MAAM;AAAA,YACjC,WAAW,KAAK,sBAAsB,KAAK,aAAa,SAAS;AAAA,UAClE,CAAC;AAAA,QACF;AAAA,MACD;AAAA,MAEA,qBAAqB;AACpB,gBAAQ,IAAI,oBAAoB;AAChC,cAAM,sBAAsB,KAAK,OAAO,0BAA0B;AAAA,UACjE,cAAc,CAAC,KAAK,kBAAkB;AAAA,UACtC,oBAAoB;AAAA,QACrB,CAAC;AACD,aAAK,YAAY,mBAAmB;AACpC,aAAK,eAAe,oBAAoB,OAAO;AAAA,MAChD;AAAA,MAEA,eAAe,QAAQ,gBAAgB,GAAG,iBAAiB,GAAG,aAAa,GAAG;AAE7E,cAAM,aAAa,KAAK,iBAAiB,QAAQ,eAAe,gBAAgB,UAAU;AAE1F,cAAM,WAAW,KAAK,OAAO,aAAa;AAAA,UACzC,MAAM,WAAW,SAAS;AAAA,UAC1B,OAAO,eAAe;AAAA,UACtB,kBAAkB;AAAA,QACnB,CAAC;AACD,YAAI,aAAa,SAAS,eAAe,CAAC,EAAE,IAAI,WAAW,QAAQ;AACnE,iBAAS,MAAM;AAEf,cAAM,UAAU,KAAK,OAAO,aAAa;AAAA,UACxC,MAAM,WAAW,QAAQ;AAAA,UACzB,OAAO,eAAe;AAAA,UACtB,kBAAkB;AAAA,QACnB,CAAC;AACD,YAAI,YAAY,QAAQ,eAAe,CAAC,EAAE,IAAI,WAAW,OAAO;AAChE,gBAAQ,MAAM;AAEd,eAAO;AAAA,UACN;AAAA,UACA;AAAA,UACA,YAAY,WAAW,QAAQ;AAAA,QAChC;AAAA,MACD;AAAA,MAEA,sBAAsB,SAAS,WAAW;AAEzC,cAAM,oBAAoB,IAAI;AAC9B,cAAM,gBAAgB,KAAK,OAAO,aAAa;AAAA,UAC9C,MAAM;AAAA,UACN,OAAO,eAAe,UAAU,eAAe;AAAA,UAC/C,kBAAkB;AAAA,QACnB,CAAC;AACD,YAAI,aAAa,cAAc,eAAe,CAAC,EAAE,IAAI,SAAS;AAC9D,sBAAc,MAAM;AAEpB,cAAM,YAAY,KAAK,OAAO,gBAAgB;AAAA,UAC7C,QAAQ,KAAK,SAAS,mBAAmB,CAAC;AAAA,UAC1C,SAAS;AAAA,YACR;AAAA,cACC,SAAS;AAAA,cACT,UAAU;AAAA,gBACT,QAAQ;AAAA,cACT;AAAA,YACD;AAAA,YACA;AAAA,cACC,SAAS;AAAA,cACT,UAAU,KAAK;AAAA,YAChB;AAAA,YACA;AAAA,cACC,SAAS;AAAA,cACT,UAAU,QAAQ,WAAW;AAAA,YAC9B;AAAA,UACD;AAAA,QACD,CAAC;AAED,eAAO;AAAA,MACR;AAAA,MAEA,wBAAwB,KAAK;AAE5B,cAAM,MAAM,KAAK,IAAI;AACrB,cAAMC,cAAa,MAAM,KAAK,eAAe,KAAK,iBAAiB;AACnE,aAAK,cAAc;AAGnB,cAAM,SAAS,KAAK,QAAQ,KAAK,iBAAiB,IAAI;AACtD,cAAM,aAAa,OAAO,OAAOA,YAAW,KAAK,aAAa,CAAC;AAE/D,iBAAK,UAAU,YAAY,SAAK,WAAW,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,GAAG,UAAU;AAE3E,iBAAK,QAAQ,YAAY,KAAK,KAAK,KAAK,SAAS,QAAQ,GAAG,UAAU;AACtE,iBAAK,QAAQ,YAAY,KAAK,KAAK,KAAK,SAAS,QAAQ,GAAG,UAAU;AACtE,iBAAK,QAAQ,YAAY,KAAK,KAAK,KAAK,SAAS,QAAQ,GAAG,UAAU;AAEtE,iBAAK,SAAS,KAAK,kBAAkB,YAAY,KAAK,yBAAyB;AAC/E,eAAO,KAAK;AAAA,MACb;AAAA,MAEA,MAAM,SAAS,UAAU,QAAQ;AAChC,eAAO,IAAI,QAAQ,OAAO,YAAY;AACrC,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC,CAAC;AACxC,gBAAM,cAAc,MAAM,kBAAkB,MAAM,SAAS,KAAK,CAAC;AAEjE,eAAK,cAAc,OAAO,cAAc;AAAA,YACvC,MAAM,CAAC,YAAY,OAAO,YAAY,QAAQ,CAAC;AAAA,YAC/C,QAAQ;AAAA,YACR,OACC,gBAAgB,kBAChB,gBAAgB,WAChB,gBAAgB;AAAA,UAClB,CAAC;AACD,cAAI,cAAc,KAAK;AACvB,iBAAO,MAAM;AAAA,YACZ,EAAC,QAAQ,YAAW;AAAA,YACpB,EAAC,SAAS,YAAW;AAAA,YACrB,CAAC,YAAY,OAAO,YAAY,MAAM;AAAA,UACvC;AACA,kBAAQ;AAAA,QACT,CAAC;AAAA,MACF;AAAA,MAEA,MAAM,SAAS,OAAO,QAAQ;AAC7B,eAAO,IAAI,QAAQ,OAAO,YAAY;AACrC,gBAAM,WAAW,MAAM,MAAM,MAAM,CAAC,CAAC;AACrC,gBAAM,cAAc,MAAM,kBAAkB,MAAM,SAAS,KAAK,CAAC;AACjE,kBAAQ,IAAI,6BAA6B,IAAI;AAC7C,eAAK,WAAW,OAAO,cAAc;AAAA,YACpC,MAAM,CAAC,YAAY,OAAO,YAAY,QAAQ,CAAC;AAAA,YAC/C,QAAQ;AAAA,YACR,OACC,gBAAgB,kBAChB,gBAAgB,WAChB,gBAAgB;AAAA,UAClB,CAAC;AACD,cAAI,WAAW,KAAK;AACpB,iBAAO,MAAM;AAAA,YACZ,EAAC,QAAQ,YAAW;AAAA,YACpB,EAAC,SAAS,SAAQ;AAAA,YAClB,CAAC,YAAY,OAAO,YAAY,MAAM;AAAA,UACvC;AACA,kBAAQ;AAAA,QACT,CAAC;AAAA,MAEF;AAAA,MAEA,iBAAiB,QAAQ,gBAAgB,GAAG,iBAAiB,GAAG,aAAa,GAAG;AAC/E,cAAM,WAAW,CAAC;AAClB,cAAM,UAAU,CAAC;AAEjB,wBAAgB,KAAK,IAAI,GAAG,KAAK,MAAM,aAAa,CAAC;AACrD,yBAAiB,KAAK,IAAI,GAAG,KAAK,MAAM,cAAc,CAAC;AAEvD,cAAM,cAAc,SAAK,OAAO;AAChC,cAAM,SAAS,SAAK,OAAO;AAC3B,cAAM,SAAS,SAAK,OAAO;AAE3B,YAAI,QAAQ;AACZ,cAAM,OAAO,CAAC;AAGd,iBAAQ,KAAK,GAAE,MAAM,gBAAe,MAAM;AACzC,gBAAM,cAAc,CAAC;AACrB,gBAAM,IAAI,KAAK;AAEf,cAAI,UAAU;AACd,cAAG,OAAO,GAAG;AACZ,sBAAU,MAAM;AAAA,UACjB,WAAU,OAAO,gBAAgB;AAChC,sBAAU,OAAO;AAAA,UAClB;AAEA,mBAAQ,KAAK,GAAE,MAAM,eAAc,MAAM;AACxC,kBAAM,IAAI,KAAK;AAEf,gBAAG,MAAM,eAAe;AACvB,uBAAK,KAAK,aAAa,MAAM;AAAA,YAC9B,WAAU,MAAM,KAAM,MAAM,KAAK,OAAO,gBAAiB;AACxD,oBAAM,KAAK,UAAU,KAAK,OAAO,IAAI,OAAO,IAAI,aAAa;AAE7D,qBAAO,CAAC,IAAI,CAAC,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,EAAE;AAClE,qBAAO,CAAC,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,EAAE;AACrC,qBAAO,CAAC,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,EAAE;AACjE,kBAAG,MAAM,GAAG;AACX,yBAAK,KAAK,QAAQ,WAAW;AAAA,cAC9B;AAAA,YACD;AACA,qBAAS,KAAK,GAAG,MAAM;AAGvB,qBAAK,KAAK,QAAQ,MAAM;AACxB,qBAAK,UAAU,QAAQ,MAAM;AAC7B,qBAAS,KAAK,GAAG,MAAM;AAEvB,qBAAS,KAAK,IAAI,SAAS,IAAI,CAAC;AAChC,wBAAY,KAAK,OAAO;AAAA,UACzB;AACA,eAAK,KAAK,WAAW;AAAA,QACtB;AAEA,iBAAQ,KAAK,GAAE,KAAK,gBAAe,MAAM;AACxC,mBAAQ,KAAK,GAAE,KAAK,eAAc,MAAM;AACvC,kBAAM,IAAI,KAAK,EAAE,EAAE,KAAK,CAAC;AACzB,kBAAM,IAAI,KAAK,EAAE,EAAE,EAAE;AACrB,kBAAM,IAAI,KAAK,KAAK,CAAC,EAAE,EAAE;AACzB,kBAAM,IAAI,KAAK,KAAK,CAAC,EAAE,KAAK,CAAC;AAE7B,gBAAG,OAAO,EAAG,SAAQ,KAAK,GAAG,GAAG,CAAC;AACjC,gBAAG,OAAO,iBAAiB,EAAG,SAAQ,KAAK,GAAG,GAAG,CAAC;AAAA,UACnD;AAAA,QACD;AAEA,eAAO;AAAA,UACN,UAAU,IAAI,aAAa,QAAQ;AAAA,UACnC,SAAS,IAAI,YAAY,OAAO;AAAA,QACjC;AAAA,MACD;AAAA;AAAA;AAAA,MAIA,YAAY,aAAa;AACxB,YAAG,OAAO,KAAK,gBAAgB,YAAa;AAC5C,oBAAY,YAAY,KAAK,QAAQ;AACrC,oBAAY,aAAa,GAAG,KAAK,cAAc;AAO/C,YAAI,QAAQ;AACZ,mBAAU,cAAc,KAAK,aAAa;AACzC,sBAAY,aAAa,GAAG,WAAW,SAAS;AAChD,sBAAY,gBAAgB,GAAG,WAAW,QAAQ;AAClD,sBAAY,eAAe,WAAW,SAAS,QAAQ;AACvD,sBAAY,YAAY,WAAW,UAAU;AAE7C,cAAG,EAAE,QAAQ,KAAK,SAAS,eAAe;AACzC;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,MAEA,OAAO,MAAM;AACZ,YAAG,KAAK,eAAe,MAAM;AAE5B;AAAA,QACD;AACA,cAAM,uBAAuB,KAAK,wBAAwB,KAAK,QAAQ;AACvE,aAAK,OAAO,MAAM;AAAA,UACjB,KAAK;AAAA,UACL;AAAA,UACA,qBAAqB;AAAA,UACrB,qBAAqB;AAAA,UACrB,qBAAqB;AAAA,QACtB;AACA,aAAK,qBAAqB,iBAAiB,CAAC,EAAE,OAAO,KAAK,QACxD,kBAAkB,EAClB,WAAW;AAAA,MACd;AAAA,IACD;AAAA;AAAA;;;ACjeA,IAKI,cAOiB;AAZrB;AAAA;AAAA;AACA;AACA;AACA;AAEA,IAAI,eAAe;AAAA,MAClB,cAAc,IAAI;AAAA,MAClB,iBAAiB;AAAA,MACjB,cAAc,IAAI;AAAA,MAClB,UAAU,IAAI;AAAA,IACf;AAEA,IAAqB,SAArB,MAA4B;AAAA,MAE3B,YAAY,QAAQ,QAAQ,SAAS,GAAG;AACvC,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,gBAAgB,EAAE;AACvB,aAAK,eAAe,mBAAmB,QAAQ,MAAM;AACrD,aAAK,UAAU,EAAE;AACjB,gBAAQ,IAAI,6CAA6C,EAAE,iBAAiB,YAAY;AACxF,aAAK,mBAAmB;AAAA,UACvB,MAAM,EAAE,iBAAiB;AAAA,UACzB,cAAc,EAAE,iBAAiB;AAAA,QAClC;AAEA,aAAK,cAAc;AACnB,aAAK,eAAe,OAAO,mBAAmB;AAAA,UAC7C,MAAM;AAAA,QACP,CAAC;AAED,aAAK,gBAAgB,CAAC;AAEtB,YAAG,OAAO,EAAE,YAAY,aAAa;AACpC,eAAK,UAAU;AAAA,YACd,SAAS;AAAA,YACT,QAAQ;AAAA,UACT;AAAA,QACD,OAAO;AACN,eAAK,UAAU,EAAE;AAAA,QAClB;AAIA,UAAE,cAAc,QAAQ,CAAC,MAAM;AAC9B,eAAK,cAAc,KAAK,CAAC;AAAA,QAC1B,CAAC;AAED,aAAK,qBAAqB,UAAU,IAAI,yBAAyB;AACjE,aAAK,WAAW,IAAI,SAAS,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,EAAE,SAAS,CAAC;AACrE,gBAAQ,IAAI,wBAAwB,KAAK,QAAQ;AACjD,aAAK,WAAW,IAAI,SAAS,EAAE,SAAS,GAAG,EAAE,SAAS,GAAG,EAAE,SAAS,CAAC;AACrE,aAAK,SAAS,cAAc,IAAI,EAAE,cAAc;AAChD,aAAK,SAAS,cAAc,IAAI,EAAE,cAAc;AAChD,aAAK,SAAS,cAAc,IAAI,EAAE,cAAc;AAEhD,aAAK,QAAQ,EAAE;AACf,aAAK,WAAW,OAAO,qBAAqB;AAAA,UAC3C,QAAQ;AAAA,UACR,QAAQ;AAAA,YACP,QAAQ,KAAK;AAAA,YACb,YAAY;AAAA,YACZ,SAAS;AAAA,cACR;AAAA,gBACC,aAAa,aAAa;AAAA,gBAC1B,YAAY;AAAA;AAAA,kBAEX,EAAC,gBAAgB,GAAG,QAAQ,aAAa,iBAAiB,QAAQ,YAAW;AAAA;AAAA,kBAE7E,EAAC,gBAAgB,GAAG,QAAQ,aAAa,cAAc,QAAQ,YAAW;AAAA;AAAA,kBAE1E,EAAC,gBAAgB,GAAG,QAAQ,aAAa,UAAU,QAAQ,YAAa;AAAA,gBACzE;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAAA,UACA,UAAU;AAAA,YACT,QAAQ,KAAK;AAAA,YACb,YAAY;AAAA,YACZ,SAAS,CAAC,EAAC,QAAQ,KAAK,mBAAoB,CAAE;AAAA,UAC/C;AAAA,UACA,WAAW;AAAA,YACV,UAAU;AAAA;AAAA;AAAA;AAAA,YAIV,UAAU;AAAA,UACX;AAAA;AAAA;AAAA,UAGA,cAAc;AAAA,YACb,mBAAmB;AAAA,YACnB,cAAc;AAAA,YACd,QAAQ;AAAA,UACT;AAAA,QACD,CAAC;AAED,aAAK,eAAe,OAAO,cAAc;AAAA,UACxC,MAAM,CAAC,OAAO,OAAO,OAAO,MAAM;AAAA,UAClC,QAAQ;AAAA,UACR,OAAO,gBAAgB;AAAA,QACxB,CAAC;AAED,aAAK,oBAAoB,IAAI;AAC7B,aAAK,gBAAgB,OAAO,aAAa;AAAA,UACxC,MAAM,KAAK;AAAA,UACX,OAAO,eAAe,UAAU,eAAe;AAAA,QAChD,CAAC;AAGD,aAAK,WAAW;AAChB,aAAK,cAAc;AAEnB,aAAK,WAAW;AAAA,UACf,kBAAkB;AAAA,UAClB,eAAe;AAAA,QAChB;AAEA,aAAK,SAAS,KAAK,eAAe,MAAM,EAAE,KAAK,MAAM;AACpD,eAAK,SAAS,KAAK,eAAe,MAAM,EAAE,KAAK,MAAM;AAEpD,iBAAK,UAAU,OAAO,cAAc;AAAA,cACnC,WAAW;AAAA,cACX,WAAW;AAAA,YACZ,CAAC;AAED,iBAAK,YAAY,SAAK,OAAO;AAC7B,qBAAK,SAAS,KAAK,SAAS;AAE5B,iBAAK,SAAS,KAAK,eAAe;AAAA,cACjC,OAAO,KAAK;AAAA,cACZ,eAAe;AAAA,YAChB,CAAC;AACD,iBAAK,OAAO,YAAY,KAAK,sBAAsB,KAAK,UAAU,KAAK,SAAS;AAGhF,gBAAI,YAAY;AAAA;AAAA,YAEhB;AAEA,iBAAK,cAAc,CAAC,KAAK,MAAM;AAE/B,iBAAK,uBAAuB;AAAA,cAC3B,kBAAkB;AAAA,gBACjB;AAAA,kBACC,MAAM;AAAA,kBACN,YAAY,EAAC,GAAG,GAAK,GAAG,GAAK,GAAG,GAAK,GAAG,EAAG;AAAA,kBAC3C,QAAQ,KAAK,cAAc;AAAA,kBAC3B,SAAS,KAAK,cAAc;AAAA,gBAC7B;AAAA,cACD;AAAA,cACA,wBAAwB;AAAA,gBACvB,MAAM,KAAK,aAAa,WAAW;AAAA,gBACnC,iBAAiB;AAAA,gBACjB,aAAa,KAAK,cAAc;AAAA,gBAChC,cAAc,KAAK,cAAc;AAAA,cAClC;AAAA,YACD;AAEA,kBAAM,SAAS,OAAO,QAAQ,OAAO;AACrC,iBAAK,mBAAmB,SAAK,YAAa,IAAI,KAAK,KAAM,GAAG,QAAQ,GAAG,GAAM;AAC7E,iBAAK,4BAA4B,SAAK,OAAO;AAE7C,iBAAK,iBAAiB,OAAO,gBAAgB;AAAA,cAC5C,QAAQ,KAAK,SAAS,mBAAmB,CAAC;AAAA,cAC1C,SAAS;AAAA,gBACR;AAAA,kBACC,SAAS;AAAA,kBACT,UAAU,EAAC,QAAQ,KAAK,cAAe;AAAA,gBACxC;AAAA,cACD;AAAA,YACD,CAAC;AAaD,iBAAK;AACL,iBAAK,mBAAmB;AAAA,UACzB,CAAC;AAAA,QACF,CAAC;AAAA,MACF;AAAA,MAEA,sBAAsB,WAAW,WAAW;AAC3C,iBAAQ,IAAI,KAAK,YAAY,QAAO,KAAK,KAAK,SAAS,eAAc,EAAE,GAAG;AAEzE,gBAAM,SAAS,KAAK,OAAO,IAAI,MAAM;AACrC,gBAAMC,SAAQ,KAAK,OAAO,IAAI,KAAK,KAAK;AACxC,gBAAM,IAAI,KAAK,IAAIA,MAAK,IAAI;AAC5B,gBAAM,KAAK,KAAK,OAAO,IAAI,OAAO;AAClC,gBAAM,IAAI,KAAK,IAAIA,MAAK,IAAI;AAE5B,mBAAK,SAAS,SAAS;AACvB,mBAAK,UAAU,WAAW,CAAC,GAAG,GAAG,CAAC,GAAG,SAAS;AAC9C,mBAAK,QAAQ,WAAW,KAAK,OAAO,IAAI,KAAK,IAAI,SAAS;AAC1D,mBAAK,QAAQ,WAAW,KAAK,OAAO,IAAI,KAAK,IAAI,SAAS;AAC1D,eAAK,YAAY,KAAK;AAAA,YACrB,GAAG,UAAU,IAAI,UAAU,MAAM;AAAA,YACjC,WAAW,KAAK,sBAAsB,KAAK,aAAa,SAAS;AAAA,UAClE,CAAC;AAAA,QACF;AAAA,MACD;AAAA,MAEA,qBAAqB;AACpB,gBAAQ,IAAI,2BAA2B;AACvC,cAAM,sBAAsB,KAAK,OAAO,0BAA0B;AAAA,UACjE,cAAc,CAAC,KAAK,kBAAkB;AAAA,UACtC,oBAAoB;AAAA,QACrB,CAAC;AACD,aAAK,YAAY,mBAAmB;AACpC,aAAK,eAAe,oBAAoB,OAAO;AAAA,MAChD;AAAA,MAEA,eAAe,SAAS;AACvB,cAAM,OAAO,KAAK,mBAAmB,OAAO;AAE5C,cAAM,WAAW,KAAK,OAAO,aAAa;AAAA,UACzC,MAAM,KAAK,SAAS;AAAA,UACpB,OAAO,eAAe;AAAA,UACtB,kBAAkB;AAAA,QACnB,CAAC;AACD,YAAI,aAAa,SAAS,eAAe,CAAC,EAAE,IAAI,KAAK,QAAQ;AAC7D,iBAAS,MAAM;AAEf,cAAM,UAAU,KAAK,OAAO,aAAa;AAAA,UACxC,MAAM,KAAK,QAAQ;AAAA,UACnB,OAAO,eAAe;AAAA,UACtB,kBAAkB;AAAA,QACnB,CAAC;AACD,YAAI,YAAY,QAAQ,eAAe,CAAC,EAAE,IAAI,KAAK,OAAO;AAC1D,gBAAQ,MAAM;AAEd,eAAO;AAAA,UACN;AAAA,UACA;AAAA,UACA,YAAY,KAAK,QAAQ;AAAA,QAC1B;AAAA,MACD;AAAA,MAEA,sBAAsB,SAAS,WAAW;AAEzC,cAAM,oBAAoB,IAAI;AAC9B,cAAM,gBAAgB,KAAK,OAAO,aAAa;AAAA,UAC9C,MAAM;AAAA,UACN,OAAO,eAAe,UAAU,eAAe;AAAA,UAC/C,kBAAkB;AAAA,QACnB,CAAC;AACD,YAAI,aAAa,cAAc,eAAe,CAAC,EAAE,IAAI,SAAS;AAC9D,sBAAc,MAAM;AAEpB,cAAM,YAAY,KAAK,OAAO,gBAAgB;AAAA,UAC7C,QAAQ,KAAK,SAAS,mBAAmB,CAAC;AAAA,UAC1C,SAAS;AAAA,YACR;AAAA,cACC,SAAS;AAAA,cACT,UAAU;AAAA,gBACT,QAAQ;AAAA,cACT;AAAA,YACD;AAAA,YACA;AAAA,cACC,SAAS;AAAA,cACT,UAAU,KAAK;AAAA,YAChB;AAAA,YACA;AAAA,cACC,SAAS;AAAA,cACT,UAAU,QAAQ,WAAW;AAAA,YAC9B;AAAA,UACD;AAAA,QACD,CAAC;AAED,eAAO;AAAA,MACR;AAAA;AAAA,MAIA,gBAAgB;AACf,cAAM,SAAS,KAAK,QAAQ,KAAK,iBAAiB,IAAI;AACtD,cAAM,aAAa,OAAO,OAAO,WAAW,KAAK,aAAa,CAAC;AAC/D,eAAO;AAAA,MACR;AAAA,MAEA,wBAAwB,KAAK;AAC5B,cAAM,MAAM,KAAK,IAAI;AACrB,cAAMC,cAAa,MAAM,KAAK,eAAe,KAAK,iBAAiB;AACnE,aAAK,cAAc;AAGnB,cAAM,SAAS,KAAK,QAAQ,KAAK,iBAAiB,IAAI;AACtD,cAAM,aAAa,OAAO,OAAOA,YAAW,KAAK,aAAa,CAAC;AAE/D,iBAAK,UAAU,YAAY,SAAK,WAAW,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,GAAG,UAAU;AAC3E,iBAAK,QAAQ,YAAY,KAAK,KAAK,KAAK,SAAS,QAAQ,GAAG,UAAU;AACtE,iBAAK,QAAQ,YAAY,KAAK,KAAK,KAAK,SAAS,QAAQ,GAAG,UAAU;AACtE,iBAAK,QAAQ,YAAY,KAAK,KAAK,KAAK,SAAS,QAAQ,GAAG,UAAU;AACtE,iBAAK,SAAS,KAAK,kBAAkB,YAAY,KAAK,yBAAyB;AAE/E,eAAO,KAAK;AAAA,MACb;AAAA,MAEA,MAAM,SAAS,UAAU,QAAQ;AAChC,eAAO,IAAI,QAAQ,OAAO,YAAY;AACrC,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC,CAAC;AACxC,gBAAM,cAAc,MAAM,kBAAkB,MAAM,SAAS,KAAK,CAAC;AACjE,eAAK,cAAc,OAAO,cAAc;AAAA,YACvC,MAAM,CAAC,YAAY,OAAO,YAAY,QAAQ,CAAC;AAAA,YAC/C,QAAQ;AAAA,YACR,OACC,gBAAgB,kBAChB,gBAAgB,WAChB,gBAAgB;AAAA,UAClB,CAAC;AACD,cAAI,cAAc,KAAK;AACvB,iBAAO,MAAM;AAAA,YACZ,EAAC,QAAQ,YAAW;AAAA,YACpB,EAAC,SAAS,YAAW;AAAA,YACrB,CAAC,YAAY,OAAO,YAAY,MAAM;AAAA,UACvC;AACA,kBAAQ;AAAA,QACT,CAAC;AAAA,MACF;AAAA,MAEA,MAAM,SAAS,eAAe,QAAQ;AACrC,eAAO,IAAI,QAAQ,OAAO,YAAY;AACrC,gBAAM,WAAW,MAAM,MAAM,cAAc,CAAC,CAAC;AAC7C,gBAAM,cAAc,MAAM,kBAAkB,MAAM,SAAS,KAAK,CAAC;AACjE,kBAAQ,IAAI,iBAAiB,IAAI;AACjC,eAAK,WAAW,OAAO,cAAc;AAAA,YACpC,MAAM,CAAC,YAAY,OAAO,YAAY,QAAQ,CAAC;AAAA,YAC/C,QAAQ;AAAA,YACR,OACC,gBAAgB,kBAChB,gBAAgB,WAChB,gBAAgB;AAAA,UAClB,CAAC;AACD,cAAI,WAAW,KAAK;AACpB,iBAAO,MAAM;AAAA,YACZ,EAAC,QAAQ,YAAW;AAAA,YACpB,EAAC,SAAS,SAAQ;AAAA,YAClB,CAAC,YAAY,OAAO,YAAY,MAAM;AAAA,UACvC;AACA,kBAAQ;AAAA,QACT,CAAC;AAAA,MAEF;AAAA;AAAA;AAAA,MAKA,YAAY,aAAa;AAExB,YAAG,OAAO,KAAK,gBAAgB,YAAa;AAC5C,oBAAY,YAAY,KAAK,QAAQ;AACrC,oBAAY,aAAa,GAAG,KAAK,cAAc;AAQ/C,YAAI,QAAQ;AACZ,mBAAU,cAAc,KAAK,aAAa;AACzC,sBAAY,aAAa,GAAG,WAAW,SAAS;AAChD,sBAAY,gBAAgB,GAAG,WAAW,QAAQ;AAClD,sBAAY,eAAe,WAAW,SAAS,QAAQ;AACvD,sBAAY,YAAY,WAAW,UAAU;AAC7C,cAAG,EAAE,QAAQ,KAAK,SAAS,eAAe;AACzC;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,MAEA,mBAAmB,SAAS;AAC3B,YAAG,OAAO,YAAY,aAAa;AAClC,cAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,eAAe;AAAA,UAChB;AAAA,QACD;AACA,YAAG,OAAO,QAAQ,UAAU,YAAa,SAAQ,QAAQ;AAEzD,YAAI;AACJ,YAAG,QAAQ,iBAAiB,MAAM;AACjC,qBAAW,IAAI,aAAa;AAAA;AAAA;AAAA;AAAA,YAI3B;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtB;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvB;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YACxB;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA;AAAA,YAEzB;AAAA,YAAG;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YACzB;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA,YACvB;AAAA,YAAG;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YAC1B;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA;AAAA,YAExB;AAAA,YAAG;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA,YACxB;AAAA,YAAG;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA,YACzB;AAAA,YAAI;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YAC1B;AAAA,YAAI;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA;AAAA,YAE3B;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtB;AAAA,YAAI;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YAC1B;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvB;AAAA,YAAI;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA;AAAA,YAE3B;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YACzB;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA,YACzB;AAAA,YAAG;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YAC1B;AAAA,YAAI;AAAA,YAAI;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA;AAAA,YAE1B;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA,YACxB;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,YACxB;AAAA,YAAI;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAK;AAAA,YACzB;AAAA,YAAG;AAAA,YAAG;AAAA,YAAI;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAM;AAAA,UAC1B,CAAC;AAAA,QACF,OAAO;AACN,qBAAW,IAAI,aAAa;AAAA;AAAA;AAAA;AAAA,YAI3B,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtE,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACrE,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA;AAAA,YAEtE,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtE,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACrE,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA;AAAA,YAEtE,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtE,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA;AAAA,YAExE,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtE,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA;AAAA,YAExE,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACtE,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,IAAI,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,IAAI,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,YAAO;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YAAG;AAAA,YACvE,KAAK,QAAQ;AAAA,YAAO,KAAK,QAAQ;AAAA,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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACA1B,IAAW;AAAX;AAAA;AAAO,IAAI,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACA/B,IAAW;AAAX;AAAA;AAAO,IAAI,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAnC,IAAW;AAAX;AAAA;AAAO,IAAI,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": ["setDefaultType", "VecType", "create", "set", "ceil", "floor", "round", "clamp", "add", "addScaled", "angle", "dot", "subtract", "equalsApproximately", "utils.EPSILON", "equals", "lerp", "lerpV", "max", "min", "mulScalar", "divScalar", "inverse", "length", "lengthSq", "distance", "distanceSq", "normalize", "negate", "copy", "multiply", "divide", "zero", "transformMat4", "getTranslation", "getAxis", "getScaling", "identity", "vec3.create", "vec3.normalize", "vec3.subtract", "vec3.cross", "rotateX", "rotateY", "rotateZ", "scale", "vec3.dot", "vec3.len", "fromValues", "sub", "invert", "len", "lenSq", "dist", "distSq", "clone", "mul", "div", "addScript", "rotate", "angle", "window", "deltaTime", "angle", "deltaTime", "angle", "deltaTime", "modelMatrix", "Ammo", "fov", "aspect", "near", "far", "create", "VecType", "subtract", "cross", "normalize", "setDefaultType", "MatType", "negate", "copy", "equalsApproximately", "utils.EPSILON", "equals", "identity", "transpose", "inverse", "determinant", "multiply", "setTranslation", "getTranslation", "vec3.create", "getAxis", "setAxis", "getScaling", "perspective", "ortho", "frustum", "lookAt", "xAxis", "yAxis", "zAxis", "vec3.normalize", "vec3.subtract", "vec3.cross", "translation", "translate", "rotationX", "rotateX", "rotationY", "rotateY", "rotationZ", "rotateZ", "axisRotation", "axisRotate", "scaling", "scale", "EPSILON", "ctorMap", "newMat3", "clone", "invert", "mul", "rotation", "rotate", "degToRad", "byId", "init_wgpu_matrix_module", "mat4Impl", "rotation", "item", "init_bvh_loader", "init_bvh_loader", "translation", "rotation", "deltaTime", "i", "angle", "translation", "rotation", "deltaTime", "e", "deltaTime", "app"]
}
